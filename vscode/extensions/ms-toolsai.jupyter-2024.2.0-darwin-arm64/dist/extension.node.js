"use strict";var eY=Object.create;var mS=Object.defineProperty;var lj=Object.getOwnPropertyDescriptor;var tY=Object.getOwnPropertyNames;var rY=Object.getPrototypeOf,nY=Object.prototype.hasOwnProperty;var iY=(r,e)=>()=>(r&&(e=r(r=0)),e);var M=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),uj=(r,e)=>{for(var t in e)mS(r,t,{get:e[t],enumerable:!0})},pj=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of tY(e))!nY.call(r,i)&&i!==t&&mS(r,i,{get:()=>e[i],enumerable:!(n=lj(e,i))||n.enumerable});return r};var _=(r,e,t)=>(t=r!=null?eY(rY(r)):{},pj(e||!r||!r.__esModule?mS(t,"default",{value:r,enumerable:!0}):t,r)),dj=r=>pj(mS({},"__esModule",{value:!0}),r),v=(r,e,t,n)=>{for(var i=n>1?void 0:n?lj(e,t):e,o=r.length-1,s;o>=0;o--)(s=r[o])&&(i=(n?s(e,t,i):s(i))||i);return n&&i&&mS(e,t,i),i},d=(r,e)=>(t,n)=>e(t,n,r);var fj=M(()=>{var mj;(function(r){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=i(r);typeof t.Reflect>"u"?t.Reflect=r:n=i(t.Reflect,n),e(n);function i(o,s){return function(a,c){typeof o[a]!="function"&&Object.defineProperty(o,a,{configurable:!0,writable:!0,value:c}),s&&s(a,c)}}})(function(e){var t=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",i=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",s=typeof Object.create=="function",a={__proto__:[]}instanceof Array,c=!s&&!a,l={create:s?function(){return rn(Object.create(null))}:a?function(){return rn({__proto__:null})}:function(){return rn({})},has:c?function(H,ie){return t.call(H,ie)}:function(H,ie){return ie in H},get:c?function(H,ie){return t.call(H,ie)?H[ie]:void 0}:function(H,ie){return H[ie]}},u=Object.getPrototypeOf(Function),p=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",m=!p&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:wr(),h=!p&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Wr(),g=!p&&typeof WeakMap=="function"?WeakMap:Dr(),b=new g;function w(H,ie,ge,Ee){if(Et(ge)){if(!Cl(H))throw new TypeError;if(!B(ie))throw new TypeError;return we(H,ie)}else{if(!Cl(H))throw new TypeError;if(!Vt(ie))throw new TypeError;if(!Vt(Ee)&&!Et(Ee)&&!jr(Ee))throw new TypeError;return jr(Ee)&&(Ee=void 0),ge=Xn(ge),Ue(H,ie,ge,Ee)}}e("decorate",w);function k(H,ie){function ge(Ee,He){if(!Vt(Ee))throw new TypeError;if(!Et(He)&&!Ie(He))throw new TypeError;Z(H,ie,Ee,He)}return ge}e("metadata",k);function N(H,ie,ge,Ee){if(!Vt(ge))throw new TypeError;return Et(Ee)||(Ee=Xn(Ee)),Z(H,ie,ge,Ee)}e("defineMetadata",N);function D(H,ie,ge){if(!Vt(ie))throw new TypeError;return Et(ge)||(ge=Xn(ge)),ft(H,ie,ge)}e("hasMetadata",D);function V(H,ie,ge){if(!Vt(ie))throw new TypeError;return Et(ge)||(ge=Xn(ge)),rt(H,ie,ge)}e("hasOwnMetadata",V);function oe(H,ie,ge){if(!Vt(ie))throw new TypeError;return Et(ge)||(ge=Xn(ge)),ae(H,ie,ge)}e("getMetadata",oe);function G(H,ie,ge){if(!Vt(ie))throw new TypeError;return Et(ge)||(ge=Xn(ge)),ke(H,ie,ge)}e("getOwnMetadata",G);function pe(H,ie){if(!Vt(H))throw new TypeError;return Et(ie)||(ie=Xn(ie)),ve(H,ie)}e("getMetadataKeys",pe);function de(H,ie){if(!Vt(H))throw new TypeError;return Et(ie)||(ie=Xn(ie)),Be(H,ie)}e("getOwnMetadataKeys",de);function te(H,ie,ge){if(!Vt(ie))throw new TypeError;Et(ge)||(ge=Xn(ge));var Ee=ct(ie,ge,!1);if(Et(Ee)||!Ee.delete(H))return!1;if(Ee.size>0)return!0;var He=b.get(ie);return He.delete(ge),He.size>0||b.delete(ie),!0}e("deleteMetadata",te);function we(H,ie){for(var ge=H.length-1;ge>=0;--ge){var Ee=H[ge],He=Ee(ie);if(!Et(He)&&!jr(He)){if(!B(He))throw new TypeError;ie=He}}return ie}function Ue(H,ie,ge,Ee){for(var He=H.length-1;He>=0;--He){var nn=H[He],Pt=nn(ie,ge,Ee);if(!Et(Pt)&&!jr(Pt)){if(!Vt(Pt))throw new TypeError;Ee=Pt}}return Ee}function ct(H,ie,ge){var Ee=b.get(H);if(Et(Ee)){if(!ge)return;Ee=new m,b.set(H,Ee)}var He=Ee.get(ie);if(Et(He)){if(!ge)return;He=new m,Ee.set(ie,He)}return He}function ft(H,ie,ge){var Ee=rt(H,ie,ge);if(Ee)return!0;var He=Ot(ie);return jr(He)?!1:ft(H,He,ge)}function rt(H,ie,ge){var Ee=ct(ie,ge,!1);return Et(Ee)?!1:Mt(Ee.has(H))}function ae(H,ie,ge){var Ee=rt(H,ie,ge);if(Ee)return ke(H,ie,ge);var He=Ot(ie);if(!jr(He))return ae(H,He,ge)}function ke(H,ie,ge){var Ee=ct(ie,ge,!1);if(!Et(Ee))return Ee.get(H)}function Z(H,ie,ge,Ee){var He=ct(ge,Ee,!0);He.set(H,ie)}function ve(H,ie){var ge=Be(H,ie),Ee=Ot(H);if(Ee===null)return ge;var He=ve(Ee,ie);if(He.length<=0)return ge;if(ge.length<=0)return He;for(var nn=new h,Pt=[],Dt=0,ot=ge;Dt<ot.length;Dt++){var Ut=ot[Dt],se=nn.has(Ut);se||(nn.add(Ut),Pt.push(Ut))}for(var fe=0,q=He;fe<q.length;fe++){var Ut=q[fe],se=nn.has(Ut);se||(nn.add(Ut),Pt.push(Ut))}return Pt}function Be(H,ie){var ge=[],Ee=ct(H,ie,!1);if(Et(Ee))return ge;for(var He=Ee.keys(),nn=nt(He),Pt=0;;){var Dt=Ht(nn);if(!Dt)return ge.length=Pt,ge;var ot=tn(Dt);try{ge[Pt]=ot}catch(Ut){try{jt(nn)}finally{throw Ut}}Pt++}}function dn(H){if(H===null)return 1;switch(typeof H){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return H===null?1:6;default:return 6}}function Et(H){return H===void 0}function jr(H){return H===null}function ls(H){return typeof H=="symbol"}function Vt(H){return typeof H=="object"?H!==null:typeof H=="function"}function en(H,ie){switch(dn(H)){case 0:return H;case 1:return H;case 2:return H;case 3:return H;case 4:return H;case 5:return H}var ge=ie===3?"string":ie===5?"number":"default",Ee=Me(H,i);if(Ee!==void 0){var He=Ee.call(H,ge);if(Vt(He))throw new TypeError;return He}return Fi(H,ge==="default"?"number":ge)}function Fi(H,ie){if(ie==="string"){var ge=H.toString;if(L(ge)){var Ee=ge.call(H);if(!Vt(Ee))return Ee}var He=H.valueOf;if(L(He)){var Ee=He.call(H);if(!Vt(Ee))return Ee}}else{var He=H.valueOf;if(L(He)){var Ee=He.call(H);if(!Vt(Ee))return Ee}var nn=H.toString;if(L(nn)){var Ee=nn.call(H);if(!Vt(Ee))return Ee}}throw new TypeError}function Mt(H){return!!H}function or(H){return""+H}function Xn(H){var ie=en(H,3);return ls(ie)?ie:or(ie)}function Cl(H){return Array.isArray?Array.isArray(H):H instanceof Object?H instanceof Array:Object.prototype.toString.call(H)==="[object Array]"}function L(H){return typeof H=="function"}function B(H){return typeof H=="function"}function Ie(H){switch(dn(H)){case 3:return!0;case 4:return!0;default:return!1}}function Me(H,ie){var ge=H[ie];if(ge!=null){if(!L(ge))throw new TypeError;return ge}}function nt(H){var ie=Me(H,o);if(!L(ie))throw new TypeError;var ge=ie.call(H);if(!Vt(ge))throw new TypeError;return ge}function tn(H){return H.value}function Ht(H){var ie=H.next();return ie.done?!1:ie}function jt(H){var ie=H.return;ie&&ie.call(H)}function Ot(H){var ie=Object.getPrototypeOf(H);if(typeof H!="function"||H===u||ie!==u)return ie;var ge=H.prototype,Ee=ge&&Object.getPrototypeOf(ge);if(Ee==null||Ee===Object.prototype)return ie;var He=Ee.constructor;return typeof He!="function"||He===H?ie:He}function wr(){var H={},ie=[],ge=function(){function Pt(Dt,ot,Ut){this._index=0,this._keys=Dt,this._values=ot,this._selector=Ut}return Pt.prototype["@@iterator"]=function(){return this},Pt.prototype[o]=function(){return this},Pt.prototype.next=function(){var Dt=this._index;if(Dt>=0&&Dt<this._keys.length){var ot=this._selector(this._keys[Dt],this._values[Dt]);return Dt+1>=this._keys.length?(this._index=-1,this._keys=ie,this._values=ie):this._index++,{value:ot,done:!1}}return{value:void 0,done:!0}},Pt.prototype.throw=function(Dt){throw this._index>=0&&(this._index=-1,this._keys=ie,this._values=ie),Dt},Pt.prototype.return=function(Dt){return this._index>=0&&(this._index=-1,this._keys=ie,this._values=ie),{value:Dt,done:!0}},Pt}();return function(){function Pt(){this._keys=[],this._values=[],this._cacheKey=H,this._cacheIndex=-2}return Object.defineProperty(Pt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Pt.prototype.has=function(Dt){return this._find(Dt,!1)>=0},Pt.prototype.get=function(Dt){var ot=this._find(Dt,!1);return ot>=0?this._values[ot]:void 0},Pt.prototype.set=function(Dt,ot){var Ut=this._find(Dt,!0);return this._values[Ut]=ot,this},Pt.prototype.delete=function(Dt){var ot=this._find(Dt,!1);if(ot>=0){for(var Ut=this._keys.length,se=ot+1;se<Ut;se++)this._keys[se-1]=this._keys[se],this._values[se-1]=this._values[se];return this._keys.length--,this._values.length--,Dt===this._cacheKey&&(this._cacheKey=H,this._cacheIndex=-2),!0}return!1},Pt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=H,this._cacheIndex=-2},Pt.prototype.keys=function(){return new ge(this._keys,this._values,Ee)},Pt.prototype.values=function(){return new ge(this._keys,this._values,He)},Pt.prototype.entries=function(){return new ge(this._keys,this._values,nn)},Pt.prototype["@@iterator"]=function(){return this.entries()},Pt.prototype[o]=function(){return this.entries()},Pt.prototype._find=function(Dt,ot){return this._cacheKey!==Dt&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Dt)),this._cacheIndex<0&&ot&&(this._cacheIndex=this._keys.length,this._keys.push(Dt),this._values.push(void 0)),this._cacheIndex},Pt}();function Ee(Pt,Dt){return Pt}function He(Pt,Dt){return Dt}function nn(Pt,Dt){return[Pt,Dt]}}function Wr(){return function(){function H(){this._map=new m}return Object.defineProperty(H.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),H.prototype.has=function(ie){return this._map.has(ie)},H.prototype.add=function(ie){return this._map.set(ie,ie),this},H.prototype.delete=function(ie){return this._map.delete(ie)},H.prototype.clear=function(){this._map.clear()},H.prototype.keys=function(){return this._map.keys()},H.prototype.values=function(){return this._map.values()},H.prototype.entries=function(){return this._map.entries()},H.prototype["@@iterator"]=function(){return this.keys()},H.prototype[o]=function(){return this.keys()},H}()}function Dr(){var H=16,ie=l.create(),ge=Ee();return function(){function ot(){this._key=Ee()}return ot.prototype.has=function(Ut){var se=He(Ut,!1);return se!==void 0?l.has(se,this._key):!1},ot.prototype.get=function(Ut){var se=He(Ut,!1);return se!==void 0?l.get(se,this._key):void 0},ot.prototype.set=function(Ut,se){var fe=He(Ut,!0);return fe[this._key]=se,this},ot.prototype.delete=function(Ut){var se=He(Ut,!1);return se!==void 0?delete se[this._key]:!1},ot.prototype.clear=function(){this._key=Ee()},ot}();function Ee(){var ot;do ot="@@WeakMap@@"+Dt();while(l.has(ie,ot));return ie[ot]=!0,ot}function He(ot,Ut){if(!t.call(ot,ge)){if(!Ut)return;Object.defineProperty(ot,ge,{value:l.create()})}return ot[ge]}function nn(ot,Ut){for(var se=0;se<Ut;++se)ot[se]=Math.random()*255|0;return ot}function Pt(ot){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(ot)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(ot)):nn(new Uint8Array(ot),ot):nn(new Array(ot),ot)}function Dt(){var ot=Pt(H);ot[6]=ot[6]&79|64,ot[8]=ot[8]&191|128;for(var Ut="",se=0;se<H;++se){var fe=ot[se];(se===4||se===6||se===8)&&(Ut+="-"),fe<16&&(Ut+="0"),Ut+=fe.toString(16).toLowerCase()}return Ut}}function rn(H){return H.__=void 0,delete H.__,H}})})(mj||(mj={}))});var hj={};uj(hj,{isPreRelesVersionOfJupyterExtension:()=>oY});var oY,gj=iY(()=>{"use strict";oY=!1});var Cn=M(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.NON_CUSTOM_TAG_KEYS=Xt.PRE_DESTROY=Xt.POST_CONSTRUCT=Xt.DESIGN_PARAM_TYPES=Xt.PARAM_TYPES=Xt.TAGGED_PROP=Xt.TAGGED=Xt.MULTI_INJECT_TAG=Xt.INJECT_TAG=Xt.OPTIONAL_TAG=Xt.UNMANAGED_TAG=Xt.NAME_TAG=Xt.NAMED_TAG=void 0;Xt.NAMED_TAG="named";Xt.NAME_TAG="name";Xt.UNMANAGED_TAG="unmanaged";Xt.OPTIONAL_TAG="optional";Xt.INJECT_TAG="inject";Xt.MULTI_INJECT_TAG="multi_inject";Xt.TAGGED="inversify:tagged";Xt.TAGGED_PROP="inversify:tagged_props";Xt.PARAM_TYPES="inversify:paramtypes";Xt.DESIGN_PARAM_TYPES="design:paramtypes";Xt.POST_CONSTRUCT="post_construct";Xt.PRE_DESTROY="pre_destroy";function LY(){return[Xt.INJECT_TAG,Xt.MULTI_INJECT_TAG,Xt.NAME_TAG,Xt.UNMANAGED_TAG,Xt.NAMED_TAG,Xt.OPTIONAL_TAG]}Xt.NON_CUSTOM_TAG_KEYS=LY()});var sa=M(Yu=>{"use strict";Object.defineProperty(Yu,"__esModule",{value:!0});Yu.TargetTypeEnum=Yu.BindingTypeEnum=Yu.BindingScopeEnum=void 0;var UY={Request:"Request",Singleton:"Singleton",Transient:"Transient"};Yu.BindingScopeEnum=UY;var jY={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};Yu.BindingTypeEnum=jY;var WY={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};Yu.TargetTypeEnum=WY});var Xu=M($w=>{"use strict";Object.defineProperty($w,"__esModule",{value:!0});$w.id=void 0;var VY=0;function BY(){return VY++}$w.id=BY});var a2=M(Hw=>{"use strict";Object.defineProperty(Hw,"__esModule",{value:!0});Hw.Binding=void 0;var s2=sa(),qY=Xu(),JY=function(){function r(e,t){this.id=(0,qY.id)(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=s2.BindingTypeEnum.Invalid,this.constraint=function(n){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}return r.prototype.clone=function(){var e=new r(this.serviceIdentifier,this.scope);return e.activated=e.scope===s2.BindingScopeEnum.Singleton?this.activated:!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.onDeactivation=this.onDeactivation,e.cache=this.cache,e},r}();Hw.Binding=JY});var Si=M(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.STACK_OVERFLOW=je.CIRCULAR_DEPENDENCY_IN_FACTORY=je.ON_DEACTIVATION_ERROR=je.PRE_DESTROY_ERROR=je.POST_CONSTRUCT_ERROR=je.ASYNC_UNBIND_REQUIRED=je.MULTIPLE_POST_CONSTRUCT_METHODS=je.MULTIPLE_PRE_DESTROY_METHODS=je.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=je.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=je.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=je.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=je.ARGUMENTS_LENGTH_MISMATCH=je.INVALID_DECORATOR_OPERATION=je.INVALID_TO_SELF_VALUE=je.LAZY_IN_SYNC=je.INVALID_FUNCTION_BINDING=je.INVALID_MIDDLEWARE_RETURN=je.NO_MORE_SNAPSHOTS_AVAILABLE=je.INVALID_BINDING_TYPE=je.NOT_IMPLEMENTED=je.CIRCULAR_DEPENDENCY=je.UNDEFINED_INJECT_ANNOTATION=je.MISSING_INJECT_ANNOTATION=je.MISSING_INJECTABLE_ANNOTATION=je.NOT_REGISTERED=je.CANNOT_UNBIND=je.AMBIGUOUS_MATCH=je.KEY_NOT_FOUND=je.NULL_ARGUMENT=je.DUPLICATED_METADATA=je.DUPLICATED_INJECTABLE_DECORATOR=void 0;je.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.";je.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:";je.NULL_ARGUMENT="NULL argument";je.KEY_NOT_FOUND="Key Not Found";je.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:";je.CANNOT_UNBIND="Could not unbind serviceIdentifier:";je.NOT_REGISTERED="No matching bindings found for serviceIdentifier:";je.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:";je.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var $Y=function(r){return"@inject called with undefined this could mean that the class "+r+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};je.UNDEFINED_INJECT_ANNOTATION=$Y;je.CIRCULAR_DEPENDENCY="Circular dependency found:";je.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.";je.INVALID_BINDING_TYPE="Invalid binding type:";je.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.";je.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!";je.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!";var HY=function(r){return"You are attempting to construct '"+r+`' in a synchronous way
 but it has asynchronous dependencies.`};je.LAZY_IN_SYNC=HY;je.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier";je.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var GY=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return"The number of constructor arguments in the derived class "+(r[0]+" must be >= than the number of constructor arguments of its base class.")};je.ARGUMENTS_LENGTH_MISMATCH=GY;je.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.";je.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').";je.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean";je.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean";je.MULTIPLE_PRE_DESTROY_METHODS="Cannot apply @preDestroy decorator multiple times in the same class";je.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";je.ASYNC_UNBIND_REQUIRED="Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)";var zY=function(r,e){return"@postConstruct error in class "+r+": "+e};je.POST_CONSTRUCT_ERROR=zY;var QY=function(r,e){return"@preDestroy error in class "+r+": "+e};je.PRE_DESTROY_ERROR=QY;var YY=function(r,e){return"onDeactivation() error in class "+r+": "+e};je.ON_DEACTIVATION_ERROR=YY;var XY=function(r,e){return"It looks like there is a circular dependency in one of the '"+r+"' bindings. Please investigate bindings with"+("service identifier '"+e+"'.")};je.CIRCULAR_DEPENDENCY_IN_FACTORY=XY;je.STACK_OVERFLOW="Maximum call stack size exceeded"});var aA=M(Qa=>{"use strict";var ZY=Qa&&Qa.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),eX=Qa&&Qa.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),tX=Qa&&Qa.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&ZY(e,r,t);return eX(e,r),e};Object.defineProperty(Qa,"__esModule",{value:!0});Qa.MetadataReader=void 0;var sA=tX(Cn()),rX=function(){function r(){}return r.prototype.getConstructorMetadata=function(e){var t=Reflect.getMetadata(sA.PARAM_TYPES,e),n=Reflect.getMetadata(sA.TAGGED,e);return{compilerGeneratedMetadata:t,userGeneratedMetadata:n||{}}},r.prototype.getPropertiesMetadata=function(e){var t=Reflect.getMetadata(sA.TAGGED_PROP,e)||[];return t},r}();Qa.MetadataReader=rX});var c2=M(Gw=>{"use strict";Object.defineProperty(Gw,"__esModule",{value:!0});Gw.BindingCount=void 0;var nX={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};Gw.BindingCount=nX});var cA=M(fs=>{"use strict";var iX=fs&&fs.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),oX=fs&&fs.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),sX=fs&&fs.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&iX(e,r,t);return oX(e,r),e};Object.defineProperty(fs,"__esModule",{value:!0});fs.tryAndThrowErrorIfStackOverflow=fs.isStackOverflowExeption=void 0;var aX=sX(Si());function l2(r){return r instanceof RangeError||r.message===aX.STACK_OVERFLOW}fs.isStackOverflowExeption=l2;var cX=function(r,e){try{return r()}catch(t){throw l2(t)&&(t=e()),t}};fs.tryAndThrowErrorIfStackOverflow=cX});var Ch=M(wn=>{"use strict";var lX=wn&&wn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),uX=wn&&wn.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),pX=wn&&wn.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&lX(e,r,t);return uX(e,r),e};Object.defineProperty(wn,"__esModule",{value:!0});wn.getSymbolDescription=wn.circularDependencyToException=wn.listMetadataForTarget=wn.listRegisteredBindingsForServiceIdentifier=wn.getServiceIdentifierAsString=wn.getFunctionName=void 0;var dX=pX(Si());function u2(r){if(typeof r=="function"){var e=r;return e.name}else{if(typeof r=="symbol")return r.toString();var e=r;return e}}wn.getServiceIdentifierAsString=u2;function mX(r,e,t){var n="",i=t(r,e);return i.length!==0&&(n=`
Registered bindings:`,i.forEach(function(o){var s="Object";o.implementationType!==null&&(s=m2(o.implementationType)),n=n+`
 `+s,o.constraint.metaData&&(n=n+" - "+o.constraint.metaData)})),n}wn.listRegisteredBindingsForServiceIdentifier=mX;function p2(r,e){return r.parentRequest===null?!1:r.parentRequest.serviceIdentifier===e?!0:p2(r.parentRequest,e)}function fX(r){function e(n,i){i===void 0&&(i=[]);var o=u2(n.serviceIdentifier);return i.push(o),n.parentRequest!==null?e(n.parentRequest,i):i}var t=e(r);return t.reverse().join(" --> ")}function d2(r){r.childRequests.forEach(function(e){if(p2(e,e.serviceIdentifier)){var t=fX(e);throw new Error(dX.CIRCULAR_DEPENDENCY+" "+t)}else d2(e)})}wn.circularDependencyToException=d2;function hX(r,e){if(e.isTagged()||e.isNamed()){var t="",n=e.getNamedTag(),i=e.getCustomTags();return n!==null&&(t+=n.toString()+`
`),i!==null&&i.forEach(function(o){t+=o.toString()+`
`})," "+r+`
 `+r+" - "+t}else return" "+r}wn.listMetadataForTarget=hX;function m2(r){if(r.name)return r.name;var e=r.toString(),t=e.match(/^function\s*([^\s(]+)/);return t?t[1]:"Anonymous function: "+e}wn.getFunctionName=m2;function gX(r){return r.toString().slice(7,-1)}wn.getSymbolDescription=gX});var f2=M(zw=>{"use strict";Object.defineProperty(zw,"__esModule",{value:!0});zw.Context=void 0;var vX=Xu(),yX=function(){function r(e){this.id=(0,vX.id)(),this.container=e}return r.prototype.addPlan=function(e){this.plan=e},r.prototype.setCurrentRequest=function(e){this.currentRequest=e},r}();zw.Context=yX});var aa=M(Ya=>{"use strict";var bX=Ya&&Ya.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),IX=Ya&&Ya.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),SX=Ya&&Ya.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&bX(e,r,t);return IX(e,r),e};Object.defineProperty(Ya,"__esModule",{value:!0});Ya.Metadata=void 0;var xX=SX(Cn()),CX=function(){function r(e,t){this.key=e,this.value=t}return r.prototype.toString=function(){return this.key===xX.NAMED_TAG?"named: "+String(this.value).toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+String(this.value)+" }"},r}();Ya.Metadata=CX});var h2=M(Qw=>{"use strict";Object.defineProperty(Qw,"__esModule",{value:!0});Qw.Plan=void 0;var wX=function(){function r(e,t){this.parentContext=e,this.rootRequest=t}return r}();Qw.Plan=wX});var lA=M(Yw=>{"use strict";Object.defineProperty(Yw,"__esModule",{value:!0});Yw.LazyServiceIdentifer=void 0;var EX=function(){function r(e){this._cb=e}return r.prototype.unwrap=function(){return this._cb()},r}();Yw.LazyServiceIdentifer=EX});var g2=M(Xw=>{"use strict";Object.defineProperty(Xw,"__esModule",{value:!0});Xw.QueryableString=void 0;var PX=function(){function r(e){this.str=e}return r.prototype.startsWith=function(e){return this.str.indexOf(e)===0},r.prototype.endsWith=function(e){var t="",n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},r.prototype.contains=function(e){return this.str.indexOf(e)!==-1},r.prototype.equals=function(e){return this.str===e},r.prototype.value=function(){return this.str},r}();Xw.QueryableString=PX});var uA=M(Xa=>{"use strict";var kX=Xa&&Xa.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),_X=Xa&&Xa.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),DX=Xa&&Xa.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&kX(e,r,t);return _X(e,r),e};Object.defineProperty(Xa,"__esModule",{value:!0});Xa.Target=void 0;var Rl=DX(Cn()),TX=Xu(),RX=Ch(),v2=aa(),AX=g2(),NX=function(){function r(e,t,n,i){this.id=(0,TX.id)(),this.type=e,this.serviceIdentifier=n;var o=typeof t=="symbol"?(0,RX.getSymbolDescription)(t):t;this.name=new AX.QueryableString(o||""),this.identifier=t,this.metadata=new Array;var s=null;typeof i=="string"?s=new v2.Metadata(Rl.NAMED_TAG,i):i instanceof v2.Metadata&&(s=i),s!==null&&this.metadata.push(s)}return r.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){var i=n[t];if(i.key===e)return!0}return!1},r.prototype.isArray=function(){return this.hasTag(Rl.MULTI_INJECT_TAG)},r.prototype.matchesArray=function(e){return this.matchesTag(Rl.MULTI_INJECT_TAG)(e)},r.prototype.isNamed=function(){return this.hasTag(Rl.NAMED_TAG)},r.prototype.isTagged=function(){return this.metadata.some(function(e){return Rl.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})})},r.prototype.isOptional=function(){return this.matchesTag(Rl.OPTIONAL_TAG)(!0)},r.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(e){return e.key===Rl.NAMED_TAG})[0]:null},r.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(e){return Rl.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})}):null},r.prototype.matchesNamedTag=function(e){return this.matchesTag(Rl.NAMED_TAG)(e)},r.prototype.matchesTag=function(e){var t=this;return function(n){for(var i=0,o=t.metadata;i<o.length;i++){var s=o[i];if(s.key===e&&s.value===n)return!0}return!1}},r}();Xa.Target=NX});var E2=M(xi=>{"use strict";var MX=xi&&xi.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),OX=xi&&xi.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),y2=xi&&xi.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&MX(e,r,t);return OX(e,r),e},Zw=xi&&xi.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(xi,"__esModule",{value:!0});xi.getFunctionName=xi.getBaseClassDependencyCount=xi.getDependencies=void 0;var KX=lA(),pA=y2(Si()),b2=sa(),RS=y2(Cn()),dA=Ch();Object.defineProperty(xi,"getFunctionName",{enumerable:!0,get:function(){return dA.getFunctionName}});var I2=uA();function FX(r,e){var t=(0,dA.getFunctionName)(e);return S2(r,t,e,!1)}xi.getDependencies=FX;function S2(r,e,t,n){var i=r.getConstructorMetadata(t),o=i.compilerGeneratedMetadata;if(o===void 0){var s=pA.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(s)}var a=i.userGeneratedMetadata,c=Object.keys(a),l=t.length===0&&c.length>0,u=c.length>t.length,p=l||u?c.length:t.length,m=UX(n,e,o,a,p),h=x2(r,t,e),g=Zw(Zw([],m,!0),h,!0);return g}function LX(r,e,t,n,i){var o=i[r.toString()]||[],s=w2(o),a=s.unmanaged!==!0,c=n[r],l=s.inject||s.multiInject;if(c=l||c,c instanceof KX.LazyServiceIdentifer&&(c=c.unwrap()),a){var u=c===Object,p=c===Function,m=c===void 0,h=u||p||m;if(!e&&h){var g=pA.MISSING_INJECT_ANNOTATION+" argument "+r+" in class "+t+".";throw new Error(g)}var b=new I2.Target(b2.TargetTypeEnum.ConstructorArgument,s.targetName,c);return b.metadata=o,b}return null}function UX(r,e,t,n,i){for(var o=[],s=0;s<i;s++){var a=s,c=LX(a,r,e,t,n);c!==null&&o.push(c)}return o}function jX(r,e,t,n){var i=r||e;if(i===void 0){var o=pA.MISSING_INJECTABLE_ANNOTATION+" for property "+String(t)+" in class "+n+".";throw new Error(o)}return i}function x2(r,e,t){for(var n=r.getPropertiesMetadata(e),i=[],o=Object.getOwnPropertySymbols(n),s=Object.keys(n),a=s.concat(o),c=0,l=a;c<l.length;c++){var u=l[c],p=n[u],m=w2(p),h=m.targetName||u,g=jX(m.inject,m.multiInject,u,t),b=new I2.Target(b2.TargetTypeEnum.ClassProperty,h,g);b.metadata=p,i.push(b)}var w=Object.getPrototypeOf(e.prototype).constructor;if(w!==Object){var k=x2(r,w,t);i=Zw(Zw([],i,!0),k,!0)}return i}function C2(r,e){var t=Object.getPrototypeOf(e.prototype).constructor;if(t!==Object){var n=(0,dA.getFunctionName)(t),i=S2(r,n,t,!0),o=i.map(function(c){return c.metadata.filter(function(l){return l.key===RS.UNMANAGED_TAG})}),s=[].concat.apply([],o).length,a=i.length-s;return a>0?a:C2(r,t)}else return 0}xi.getBaseClassDependencyCount=C2;function w2(r){var e={};return r.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[RS.INJECT_TAG],multiInject:e[RS.MULTI_INJECT_TAG],targetName:e[RS.NAME_TAG],unmanaged:e[RS.UNMANAGED_TAG]}}});var P2=M(eE=>{"use strict";Object.defineProperty(eE,"__esModule",{value:!0});eE.Request=void 0;var WX=Xu(),VX=function(){function r(e,t,n,i,o){this.id=(0,WX.id)(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=n===null?new Map:null}return r.prototype.addChildRequest=function(e,t,n){var i=new r(e,this.parentContext,this,t,n);return this.childRequests.push(i),i},r}();eE.Request=VX});var vA=M(oo=>{"use strict";var BX=oo&&oo.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),qX=oo&&oo.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),D2=oo&&oo.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&BX(e,r,t);return qX(e,r),e};Object.defineProperty(oo,"__esModule",{value:!0});oo.getBindingDictionary=oo.createMockRequest=oo.plan=void 0;var tE=c2(),fA=D2(Si()),T2=sa(),k2=D2(Cn()),JX=cA(),wh=Ch(),R2=f2(),hA=aa(),$X=h2(),mA=E2(),gA=P2(),A2=uA();function N2(r){return r._bindingDictionary}oo.getBindingDictionary=N2;function HX(r,e,t,n,i,o){var s=r?k2.MULTI_INJECT_TAG:k2.INJECT_TAG,a=new hA.Metadata(s,t),c=new A2.Target(e,n,t,a);if(i!==void 0){var l=new hA.Metadata(i,o);c.metadata.push(l)}return c}function _2(r,e,t,n,i){var o=AS(t.container,i.serviceIdentifier),s=[];return o.length===tE.BindingCount.NoBindingsAvailable&&t.container.options.autoBindInjectable&&typeof i.serviceIdentifier=="function"&&r.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(i.serviceIdentifier).toSelf(),o=AS(t.container,i.serviceIdentifier)),e?s=o:s=o.filter(function(a){var c=new gA.Request(a.serviceIdentifier,t,n,a,i);return a.constraint(c)}),GX(i.serviceIdentifier,s,i,t.container),s}function GX(r,e,t,n){switch(e.length){case tE.BindingCount.NoBindingsAvailable:if(t.isOptional())return e;var i=(0,wh.getServiceIdentifierAsString)(r),o=fA.NOT_REGISTERED;throw o+=(0,wh.listMetadataForTarget)(i,t),o+=(0,wh.listRegisteredBindingsForServiceIdentifier)(n,i,AS),new Error(o);case tE.BindingCount.OnlyOneBindingAvailable:return e;case tE.BindingCount.MultipleBindingsAvailable:default:if(t.isArray())return e;var i=(0,wh.getServiceIdentifierAsString)(r),o=fA.AMBIGUOUS_MATCH+" "+i;throw o+=(0,wh.listRegisteredBindingsForServiceIdentifier)(n,i,AS),new Error(o)}}function M2(r,e,t,n,i,o){var s,a;if(i===null){s=_2(r,e,n,null,o),a=new gA.Request(t,n,null,s,o);var c=new $X.Plan(n,a);n.addPlan(c)}else s=_2(r,e,n,i,o),a=i.addChildRequest(o.serviceIdentifier,s,o);s.forEach(function(l){var u=null;if(o.isArray())u=a.addChildRequest(l.serviceIdentifier,l,o);else{if(l.cache)return;u=a}if(l.type===T2.BindingTypeEnum.Instance&&l.implementationType!==null){var p=(0,mA.getDependencies)(r,l.implementationType);if(!n.container.options.skipBaseClassChecks){var m=(0,mA.getBaseClassDependencyCount)(r,l.implementationType);if(p.length<m){var h=fA.ARGUMENTS_LENGTH_MISMATCH((0,mA.getFunctionName)(l.implementationType));throw new Error(h)}}p.forEach(function(g){M2(r,!1,g.serviceIdentifier,n,u,g)})}})}function AS(r,e){var t=[],n=N2(r);return n.hasKey(e)?t=n.get(e):r.parent!==null&&(t=AS(r.parent,e)),t}function zX(r,e,t,n,i,o,s,a){a===void 0&&(a=!1);var c=new R2.Context(e),l=HX(t,n,i,"",o,s);try{return M2(r,a,i,c,null,l),c}catch(u){throw(0,JX.isStackOverflowExeption)(u)&&(0,wh.circularDependencyToException)(c.plan.rootRequest),u}}oo.plan=zX;function QX(r,e,t,n){var i=new A2.Target(T2.TargetTypeEnum.Variable,"",e,new hA.Metadata(t,n)),o=new R2.Context(r),s=new gA.Request(e,o,null,[],i);return s}oo.createMockRequest=QX});var NS=M(Eh=>{"use strict";Object.defineProperty(Eh,"__esModule",{value:!0});Eh.isPromiseOrContainsPromise=Eh.isPromise=void 0;function yA(r){var e=typeof r=="object"&&r!==null||typeof r=="function";return e&&typeof r.then=="function"}Eh.isPromise=yA;function YX(r){return yA(r)?!0:Array.isArray(r)&&r.some(yA)}Eh.isPromiseOrContainsPromise=YX});var O2=M(Za=>{"use strict";var XX=Za&&Za.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},ZX=Za&&Za.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};Object.defineProperty(Za,"__esModule",{value:!0});Za.saveToScope=Za.tryGetFromScope=void 0;var rE=O(),eZ=NS(),tZ=function(r,e){return e.scope===rE.BindingScopeEnum.Singleton&&e.activated?e.cache:e.scope===rE.BindingScopeEnum.Request&&r.has(e.id)?r.get(e.id):null};Za.tryGetFromScope=tZ;var rZ=function(r,e,t){e.scope===rE.BindingScopeEnum.Singleton&&iZ(e,t),e.scope===rE.BindingScopeEnum.Request&&nZ(r,e,t)};Za.saveToScope=rZ;var nZ=function(r,e,t){r.has(e.id)||r.set(e.id,t)},iZ=function(r,e){r.cache=e,r.activated=!0,(0,eZ.isPromise)(e)&&oZ(r,e)},oZ=function(r,e){return XX(void 0,void 0,void 0,function(){var t,n;return ZX(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return t=i.sent(),r.cache=t,[3,3];case 2:throw n=i.sent(),r.cache=null,r.activated=!1,n;case 3:return[2]}})})}});var K2=M(MS=>{"use strict";Object.defineProperty(MS,"__esModule",{value:!0});MS.FactoryType=void 0;var sZ;(function(r){r.DynamicValue="toDynamicValue",r.Factory="toFactory",r.Provider="toProvider"})(sZ=MS.FactoryType||(MS.FactoryType={}))});var IA=M(so=>{"use strict";var aZ=so&&so.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),cZ=so&&so.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),lZ=so&&so.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&aZ(e,r,t);return cZ(e,r),e};Object.defineProperty(so,"__esModule",{value:!0});so.getFactoryDetails=so.ensureFullyBound=so.multiBindToService=void 0;var uZ=O(),pZ=lZ(Si()),ec=sa(),bA=K2(),dZ=function(r){return function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach(function(i){return r.bind(i).toService(e)})}}};so.multiBindToService=dZ;var mZ=function(r){var e=null;switch(r.type){case ec.BindingTypeEnum.ConstantValue:case ec.BindingTypeEnum.Function:e=r.cache;break;case ec.BindingTypeEnum.Constructor:case ec.BindingTypeEnum.Instance:e=r.implementationType;break;case ec.BindingTypeEnum.DynamicValue:e=r.dynamicValue;break;case ec.BindingTypeEnum.Provider:e=r.provider;break;case ec.BindingTypeEnum.Factory:e=r.factory;break}if(e===null){var t=(0,uZ.getServiceIdentifierAsString)(r.serviceIdentifier);throw new Error(pZ.INVALID_BINDING_TYPE+" "+t)}};so.ensureFullyBound=mZ;var fZ=function(r){switch(r.type){case ec.BindingTypeEnum.Factory:return{factory:r.factory,factoryType:bA.FactoryType.Factory};case ec.BindingTypeEnum.Provider:return{factory:r.provider,factoryType:bA.FactoryType.Provider};case ec.BindingTypeEnum.DynamicValue:return{factory:r.dynamicValue,factoryType:bA.FactoryType.DynamicValue};default:throw new Error("Unexpected factory type "+r.type)}};so.getFactoryDetails=fZ});var V2=M($n=>{"use strict";var Ph=$n&&$n.__assign||function(){return Ph=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ph.apply(this,arguments)},hZ=$n&&$n.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),gZ=$n&&$n.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),vZ=$n&&$n.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&hZ(e,r,t);return gZ(e,r),e},U2=$n&&$n.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},j2=$n&&$n.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},yZ=$n&&$n.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};Object.defineProperty($n,"__esModule",{value:!0});$n.resolveInstance=void 0;var SA=Si(),CA=sa(),xA=vZ(Cn()),wA=NS();function bZ(r,e){return r.reduce(function(t,n){var i=e(n),o=n.target.type;return o===CA.TargetTypeEnum.ConstructorArgument?t.constructorInjections.push(i):(t.propertyRequests.push(n),t.propertyInjections.push(i)),t.isAsync||(t.isAsync=(0,wA.isPromiseOrContainsPromise)(i)),t},{constructorInjections:[],propertyInjections:[],propertyRequests:[],isAsync:!1})}function IZ(r,e,t){var n;if(e.length>0){var i=bZ(e,t),o=Ph(Ph({},i),{constr:r});i.isAsync?n=SZ(o):n=W2(o)}else n=new r;return n}function W2(r){var e,t=new((e=r.constr).bind.apply(e,yZ([void 0],r.constructorInjections,!1)));return r.propertyRequests.forEach(function(n,i){var o=n.target.identifier,s=r.propertyInjections[i];t[o]=s}),t}function SZ(r){return U2(this,void 0,void 0,function(){var e,t;return j2(this,function(n){switch(n.label){case 0:return[4,F2(r.constructorInjections)];case 1:return e=n.sent(),[4,F2(r.propertyInjections)];case 2:return t=n.sent(),[2,W2(Ph(Ph({},r),{constructorInjections:e,propertyInjections:t}))]}})})}function F2(r){return U2(this,void 0,void 0,function(){var e,t,n,i;return j2(this,function(o){for(e=[],t=0,n=r;t<n.length;t++)i=n[t],Array.isArray(i)?e.push(Promise.all(i)):e.push(i);return[2,Promise.all(e)]})})}function L2(r,e){var t=xZ(r,e);return(0,wA.isPromise)(t)?t.then(function(){return e}):e}function xZ(r,e){var t,n;if(Reflect.hasMetadata(xA.POST_CONSTRUCT,r)){var i=Reflect.getMetadata(xA.POST_CONSTRUCT,r);try{return(n=(t=e)[i.value])===null||n===void 0?void 0:n.call(t)}catch(o){throw new Error((0,SA.POST_CONSTRUCT_ERROR)(r.name,o.message))}}}function CZ(r,e){r.scope!==CA.BindingScopeEnum.Singleton&&wZ(r,e)}function wZ(r,e){var t="Class cannot be instantiated in "+(r.scope===CA.BindingScopeEnum.Request?"request":"transient")+" scope.";if(typeof r.onDeactivation=="function")throw new Error((0,SA.ON_DEACTIVATION_ERROR)(e.name,t));if(Reflect.hasMetadata(xA.PRE_DESTROY,e))throw new Error((0,SA.PRE_DESTROY_ERROR)(e.name,t))}function EZ(r,e,t,n){CZ(r,e);var i=IZ(e,t,n);return(0,wA.isPromise)(i)?i.then(function(o){return L2(e,o)}):L2(e,i)}$n.resolveInstance=EZ});var H2=M(ao=>{"use strict";var PZ=ao&&ao.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),kZ=ao&&ao.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),_Z=ao&&ao.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&PZ(e,r,t);return kZ(e,r),e},DZ=ao&&ao.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},TZ=ao&&ao.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};Object.defineProperty(ao,"__esModule",{value:!0});ao.resolve=void 0;var RZ=_Z(Si()),nE=sa(),AZ=vA(),B2=O2(),EA=NS(),J2=IA(),NZ=cA(),MZ=V2(),PA=function(r){return function(e){e.parentContext.setCurrentRequest(e);var t=e.bindings,n=e.childRequests,i=e.target&&e.target.isArray(),o=!e.parentRequest||!e.parentRequest.target||!e.target||!e.parentRequest.target.matchesArray(e.target.serviceIdentifier);if(i&&o)return n.map(function(a){var c=PA(r);return c(a)});if(e.target.isOptional()&&t.length===0)return;var s=t[0];return LZ(r,e,s)}},OZ=function(r,e){var t=(0,J2.getFactoryDetails)(r);return(0,NZ.tryAndThrowErrorIfStackOverflow)(function(){return t.factory.bind(r)(e)},function(){return new Error(RZ.CIRCULAR_DEPENDENCY_IN_FACTORY(t.factoryType,e.currentRequest.serviceIdentifier.toString()))})},KZ=function(r,e,t){var n,i=e.childRequests;switch((0,J2.ensureFullyBound)(t),t.type){case nE.BindingTypeEnum.ConstantValue:case nE.BindingTypeEnum.Function:n=t.cache;break;case nE.BindingTypeEnum.Constructor:n=t.implementationType;break;case nE.BindingTypeEnum.Instance:n=(0,MZ.resolveInstance)(t,t.implementationType,i,PA(r));break;default:n=OZ(t,e.parentContext)}return n},FZ=function(r,e,t){var n=(0,B2.tryGetFromScope)(r,e);return n!==null||(n=t(),(0,B2.saveToScope)(r,e,n)),n},LZ=function(r,e,t){return FZ(r,t,function(){var n=KZ(r,e,t);return(0,EA.isPromise)(n)?n=n.then(function(i){return q2(e,t,i)}):n=q2(e,t,n),n})};function q2(r,e,t){var n=UZ(r.parentContext,e,t),i=VZ(r.parentContext.container),o,s=i.next();do{o=s.value;var a=r.parentContext,c=r.serviceIdentifier,l=WZ(o,c);(0,EA.isPromise)(n)?n=$2(l,a,n):n=jZ(l,a,n),s=i.next()}while(s.done!==!0&&!(0,AZ.getBindingDictionary)(o).hasKey(r.serviceIdentifier));return n}var UZ=function(r,e,t){var n;return typeof e.onActivation=="function"?n=e.onActivation(r,t):n=t,n},jZ=function(r,e,t){for(var n=r.next();!n.done;){if(t=n.value(e,t),(0,EA.isPromise)(t))return $2(r,e,t);n=r.next()}return t},$2=function(r,e,t){return DZ(void 0,void 0,void 0,function(){var n,i;return TZ(this,function(o){switch(o.label){case 0:return[4,t];case 1:n=o.sent(),i=r.next(),o.label=2;case 2:return i.done?[3,4]:[4,i.value(e,n)];case 3:return n=o.sent(),i=r.next(),[3,2];case 4:return[2,n]}})})},WZ=function(r,e){var t=r._activations;return t.hasKey(e)?t.get(e).values():[].values()},VZ=function(r){for(var e=[r],t=r.parent;t!==null;)e.push(t),t=t.parent;var n=function(){var o=e.pop();return o!==void 0?{done:!1,value:o}:{done:!0,value:void 0}},i={next:n};return i};function BZ(r){var e=PA(r.plan.rootRequest.requestScope);return e(r.plan.rootRequest)}ao.resolve=BZ});var kA=M(Ci=>{"use strict";var qZ=Ci&&Ci.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),JZ=Ci&&Ci.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),$Z=Ci&&Ci.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&qZ(e,r,t);return JZ(e,r),e};Object.defineProperty(Ci,"__esModule",{value:!0});Ci.typeConstraint=Ci.namedConstraint=Ci.taggedConstraint=Ci.traverseAncerstors=void 0;var HZ=$Z(Cn()),GZ=aa(),G2=function(r,e){var t=r.parentRequest;return t!==null?e(t)?!0:G2(t,e):!1};Ci.traverseAncerstors=G2;var z2=function(r){return function(e){var t=function(n){return n!==null&&n.target!==null&&n.target.matchesTag(r)(e)};return t.metaData=new GZ.Metadata(r,e),t}};Ci.taggedConstraint=z2;var zZ=z2(HZ.NAMED_TAG);Ci.namedConstraint=zZ;var QZ=function(r){return function(e){var t=null;if(e!==null)if(t=e.bindings[0],typeof r=="string"){var n=t.serviceIdentifier;return n===r}else{var i=e.bindings[0].implementationType;return r===i}return!1}};Ci.typeConstraint=QZ});var oE=M(iE=>{"use strict";Object.defineProperty(iE,"__esModule",{value:!0});iE.BindingWhenSyntax=void 0;var Vi=sE(),Nn=kA(),YZ=function(){function r(e){this._binding=e}return r.prototype.when=function(e){return this._binding.constraint=e,new Vi.BindingOnSyntax(this._binding)},r.prototype.whenTargetNamed=function(e){return this._binding.constraint=(0,Nn.namedConstraint)(e),new Vi.BindingOnSyntax(this._binding)},r.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){if(e===null)return!1;var t=e.target!==null&&!e.target.isNamed()&&!e.target.isTagged();return t},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=(0,Nn.taggedConstraint)(e)(t),new Vi.BindingOnSyntax(this._binding)},r.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Nn.typeConstraint)(e)(t.parentRequest)},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Nn.namedConstraint)(e)(t.parentRequest)},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return n!==null&&(0,Nn.taggedConstraint)(e)(t)(n.parentRequest)},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Nn.traverseAncerstors)(t,(0,Nn.typeConstraint)(e))},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Nn.traverseAncerstors)(t,(0,Nn.typeConstraint)(e))},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Nn.traverseAncerstors)(t,(0,Nn.namedConstraint)(e))},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Nn.traverseAncerstors)(t,(0,Nn.namedConstraint)(e))},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return n!==null&&(0,Nn.traverseAncerstors)(n,(0,Nn.taggedConstraint)(e)(t))},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return n!==null&&!(0,Nn.traverseAncerstors)(n,(0,Nn.taggedConstraint)(e)(t))},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Nn.traverseAncerstors)(t,e)},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Nn.traverseAncerstors)(t,e)},new Vi.BindingOnSyntax(this._binding)},r}();iE.BindingWhenSyntax=YZ});var sE=M(aE=>{"use strict";Object.defineProperty(aE,"__esModule",{value:!0});aE.BindingOnSyntax=void 0;var Q2=oE(),XZ=function(){function r(e){this._binding=e}return r.prototype.onActivation=function(e){return this._binding.onActivation=e,new Q2.BindingWhenSyntax(this._binding)},r.prototype.onDeactivation=function(e){return this._binding.onDeactivation=e,new Q2.BindingWhenSyntax(this._binding)},r}();aE.BindingOnSyntax=XZ});var _A=M(cE=>{"use strict";Object.defineProperty(cE,"__esModule",{value:!0});cE.BindingWhenOnSyntax=void 0;var ZZ=sE(),eee=oE(),tee=function(){function r(e){this._binding=e,this._bindingWhenSyntax=new eee.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ZZ.BindingOnSyntax(this._binding)}return r.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},r.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},r.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},r.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},r.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},r.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},r.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},r.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},r.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},r.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},r.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},r.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},r.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},r.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},r.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},r.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},r.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},r}();cE.BindingWhenOnSyntax=tee});var Y2=M(lE=>{"use strict";Object.defineProperty(lE,"__esModule",{value:!0});lE.BindingInSyntax=void 0;var DA=sa(),TA=_A(),ree=function(){function r(e){this._binding=e}return r.prototype.inRequestScope=function(){return this._binding.scope=DA.BindingScopeEnum.Request,new TA.BindingWhenOnSyntax(this._binding)},r.prototype.inSingletonScope=function(){return this._binding.scope=DA.BindingScopeEnum.Singleton,new TA.BindingWhenOnSyntax(this._binding)},r.prototype.inTransientScope=function(){return this._binding.scope=DA.BindingScopeEnum.Transient,new TA.BindingWhenOnSyntax(this._binding)},r}();lE.BindingInSyntax=ree});var X2=M(uE=>{"use strict";Object.defineProperty(uE,"__esModule",{value:!0});uE.BindingInWhenOnSyntax=void 0;var nee=Y2(),iee=sE(),oee=oE(),see=function(){function r(e){this._binding=e,this._bindingWhenSyntax=new oee.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new iee.BindingOnSyntax(this._binding),this._bindingInSyntax=new nee.BindingInSyntax(e)}return r.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},r.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},r.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},r.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},r.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},r.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},r.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},r.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},r.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},r.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},r.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},r.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},r.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},r.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},r.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},r.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},r.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},r.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},r.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},r.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},r}();uE.BindingInWhenOnSyntax=see});var tW=M(tc=>{"use strict";var aee=tc&&tc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),cee=tc&&tc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),lee=tc&&tc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&aee(e,r,t);return cee(e,r),e};Object.defineProperty(tc,"__esModule",{value:!0});tc.BindingToSyntax=void 0;var Z2=lee(Si()),Bi=sa(),eW=X2(),kh=_A(),uee=function(){function r(e){this._binding=e}return r.prototype.to=function(e){return this._binding.type=Bi.BindingTypeEnum.Instance,this._binding.implementationType=e,new eW.BindingInWhenOnSyntax(this._binding)},r.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Z2.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},r.prototype.toConstantValue=function(e){return this._binding.type=Bi.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Bi.BindingScopeEnum.Singleton,new kh.BindingWhenOnSyntax(this._binding)},r.prototype.toDynamicValue=function(e){return this._binding.type=Bi.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new eW.BindingInWhenOnSyntax(this._binding)},r.prototype.toConstructor=function(e){return this._binding.type=Bi.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=Bi.BindingScopeEnum.Singleton,new kh.BindingWhenOnSyntax(this._binding)},r.prototype.toFactory=function(e){return this._binding.type=Bi.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=Bi.BindingScopeEnum.Singleton,new kh.BindingWhenOnSyntax(this._binding)},r.prototype.toFunction=function(e){if(typeof e!="function")throw new Error(Z2.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=Bi.BindingTypeEnum.Function,this._binding.scope=Bi.BindingScopeEnum.Singleton,t},r.prototype.toAutoFactory=function(e){return this._binding.type=Bi.BindingTypeEnum.Factory,this._binding.factory=function(t){var n=function(){return t.container.get(e)};return n},this._binding.scope=Bi.BindingScopeEnum.Singleton,new kh.BindingWhenOnSyntax(this._binding)},r.prototype.toAutoNamedFactory=function(e){return this._binding.type=Bi.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(n){return t.container.getNamed(e,n)}},new kh.BindingWhenOnSyntax(this._binding)},r.prototype.toProvider=function(e){return this._binding.type=Bi.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=Bi.BindingScopeEnum.Singleton,new kh.BindingWhenOnSyntax(this._binding)},r.prototype.toService=function(e){this.toDynamicValue(function(t){return t.container.get(e)})},r}();tc.BindingToSyntax=uee});var rW=M(pE=>{"use strict";Object.defineProperty(pE,"__esModule",{value:!0});pE.ContainerSnapshot=void 0;var pee=function(){function r(){}return r.of=function(e,t,n,i,o){var s=new r;return s.bindings=e,s.middleware=t,s.deactivations=i,s.activations=n,s.moduleActivationStore=o,s},r}();pE.ContainerSnapshot=pee});var nW=M(dE=>{"use strict";Object.defineProperty(dE,"__esModule",{value:!0});dE.isClonable=void 0;function dee(r){return typeof r=="object"&&r!==null&&"clone"in r&&typeof r.clone=="function"}dE.isClonable=dee});var RA=M(rc=>{"use strict";var mee=rc&&rc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),fee=rc&&rc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),hee=rc&&rc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&mee(e,r,t);return fee(e,r),e};Object.defineProperty(rc,"__esModule",{value:!0});rc.Lookup=void 0;var nm=hee(Si()),gee=nW(),vee=function(){function r(){this._map=new Map}return r.prototype.getMap=function(){return this._map},r.prototype.add=function(e,t){if(e==null)throw new Error(nm.NULL_ARGUMENT);if(t==null)throw new Error(nm.NULL_ARGUMENT);var n=this._map.get(e);n!==void 0?n.push(t):this._map.set(e,[t])},r.prototype.get=function(e){if(e==null)throw new Error(nm.NULL_ARGUMENT);var t=this._map.get(e);if(t!==void 0)return t;throw new Error(nm.KEY_NOT_FOUND)},r.prototype.remove=function(e){if(e==null)throw new Error(nm.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(nm.KEY_NOT_FOUND)},r.prototype.removeIntersection=function(e){var t=this;this.traverse(function(n,i){var o=e.hasKey(n)?e.get(n):void 0;if(o!==void 0){var s=i.filter(function(a){return!o.some(function(c){return a===c})});t._setValue(n,s)}})},r.prototype.removeByCondition=function(e){var t=this,n=[];return this._map.forEach(function(i,o){for(var s=[],a=0,c=i;a<c.length;a++){var l=c[a],u=e(l);u?n.push(l):s.push(l)}t._setValue(o,s)}),n},r.prototype.hasKey=function(e){if(e==null)throw new Error(nm.NULL_ARGUMENT);return this._map.has(e)},r.prototype.clone=function(){var e=new r;return this._map.forEach(function(t,n){t.forEach(function(i){return e.add(n,(0,gee.isClonable)(i)?i.clone():i)})}),e},r.prototype.traverse=function(e){this._map.forEach(function(t,n){e(n,t)})},r.prototype._setValue=function(e,t){t.length>0?this._map.set(e,t):this._map.delete(e)},r}();rc.Lookup=vee});var oW=M(mE=>{"use strict";Object.defineProperty(mE,"__esModule",{value:!0});mE.ModuleActivationStore=void 0;var iW=RA(),yee=function(){function r(){this._map=new Map}return r.prototype.remove=function(e){if(this._map.has(e)){var t=this._map.get(e);return this._map.delete(e),t}return this._getEmptyHandlersStore()},r.prototype.addDeactivation=function(e,t,n){this._getModuleActivationHandlers(e).onDeactivations.add(t,n)},r.prototype.addActivation=function(e,t,n){this._getModuleActivationHandlers(e).onActivations.add(t,n)},r.prototype.clone=function(){var e=new r;return this._map.forEach(function(t,n){e._map.set(n,{onActivations:t.onActivations.clone(),onDeactivations:t.onDeactivations.clone()})}),e},r.prototype._getModuleActivationHandlers=function(e){var t=this._map.get(e);return t===void 0&&(t=this._getEmptyHandlersStore(),this._map.set(e,t)),t},r.prototype._getEmptyHandlersStore=function(){var e={onActivations:new iW.Lookup,onDeactivations:new iW.Lookup};return e},r}();mE.ModuleActivationStore=yee});var AA=M(Hn=>{"use strict";var hE=Hn&&Hn.__assign||function(){return hE=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},hE.apply(this,arguments)},bee=Hn&&Hn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Iee=Hn&&Hn.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),sW=Hn&&Hn.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&bee(e,r,t);return Iee(e,r),e},hs=Hn&&Hn.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},gs=Hn&&Hn.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},See=Hn&&Hn.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Hn,"__esModule",{value:!0});Hn.Container=void 0;var xee=a2(),ca=sW(Si()),_h=sa(),im=sW(Cn()),Cee=aA(),fE=vA(),wee=H2(),Eee=tW(),om=NS(),Pee=Xu(),kee=Ch(),_ee=rW(),OS=RA(),Dee=oW(),Tee=function(){function r(e){var t=e||{};if(typeof t!="object")throw new Error(""+ca.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(t.defaultScope===void 0)t.defaultScope=_h.BindingScopeEnum.Transient;else if(t.defaultScope!==_h.BindingScopeEnum.Singleton&&t.defaultScope!==_h.BindingScopeEnum.Transient&&t.defaultScope!==_h.BindingScopeEnum.Request)throw new Error(""+ca.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error(""+ca.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error(""+ca.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=(0,Pee.id)(),this._bindingDictionary=new OS.Lookup,this._snapshots=[],this._middleware=null,this._activations=new OS.Lookup,this._deactivations=new OS.Lookup,this.parent=null,this._metadataReader=new Cee.MetadataReader,this._moduleActivationStore=new Dee.ModuleActivationStore}return r.merge=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o=new r,s=See([e,t],n,!0).map(function(l){return(0,fE.getBindingDictionary)(l)}),a=(0,fE.getBindingDictionary)(o);function c(l,u){l.traverse(function(p,m){m.forEach(function(h){u.add(h.serviceIdentifier,h.clone())})})}return s.forEach(function(l){c(l,a)}),o},r.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),i=0,o=e;i<o.length;i++){var s=o[i],a=n(s.id);s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}},r.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return hs(this,void 0,void 0,function(){var n,i,o,s,a;return gs(this,function(c){switch(c.label){case 0:n=this._getContainerModuleHelpersFactory(),i=0,o=e,c.label=1;case 1:return i<o.length?(s=o[i],a=n(s.id),[4,s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)]):[3,4];case 2:c.sent(),c.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},r.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach(function(i){var o=e._removeModuleBindings(i.id);e._deactivateSingletons(o),e._removeModuleHandlers(i.id)})},r.prototype.unloadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return hs(this,void 0,void 0,function(){var n,i,o,s;return gs(this,function(a){switch(a.label){case 0:n=0,i=e,a.label=1;case 1:return n<i.length?(o=i[n],s=this._removeModuleBindings(o.id),[4,this._deactivateSingletonsAsync(s)]):[3,4];case 2:a.sent(),this._removeModuleHandlers(o.id),a.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},r.prototype.bind=function(e){var t=this.options.defaultScope||_h.BindingScopeEnum.Transient,n=new xee.Binding(e,t);return this._bindingDictionary.add(e,n),new Eee.BindingToSyntax(n)},r.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},r.prototype.rebindAsync=function(e){return hs(this,void 0,void 0,function(){return gs(this,function(t){switch(t.label){case 0:return[4,this.unbindAsync(e)];case 1:return t.sent(),[2,this.bind(e)]}})})},r.prototype.unbind=function(e){if(this._bindingDictionary.hasKey(e)){var t=this._bindingDictionary.get(e);this._deactivateSingletons(t)}this._removeServiceFromDictionary(e)},r.prototype.unbindAsync=function(e){return hs(this,void 0,void 0,function(){var t;return gs(this,function(n){switch(n.label){case 0:return this._bindingDictionary.hasKey(e)?(t=this._bindingDictionary.get(e),[4,this._deactivateSingletonsAsync(t)]):[3,2];case 1:n.sent(),n.label=2;case 2:return this._removeServiceFromDictionary(e),[2]}})})},r.prototype.unbindAll=function(){var e=this;this._bindingDictionary.traverse(function(t,n){e._deactivateSingletons(n)}),this._bindingDictionary=new OS.Lookup},r.prototype.unbindAllAsync=function(){return hs(this,void 0,void 0,function(){var e,t=this;return gs(this,function(n){switch(n.label){case 0:return e=[],this._bindingDictionary.traverse(function(i,o){e.push(t._deactivateSingletonsAsync(o))}),[4,Promise.all(e)];case 1:return n.sent(),this._bindingDictionary=new OS.Lookup,[2]}})})},r.prototype.onActivation=function(e,t){this._activations.add(e,t)},r.prototype.onDeactivation=function(e,t){this._deactivations.add(e,t)},r.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},r.prototype.isCurrentBound=function(e){return this._bindingDictionary.hasKey(e)},r.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,im.NAMED_TAG,t)},r.prototype.isBoundTagged=function(e,t,n){var i=!1;if(this._bindingDictionary.hasKey(e)){var o=this._bindingDictionary.get(e),s=(0,fE.createMockRequest)(this,e,t,n);i=o.some(function(a){return a.constraint(s)})}return!i&&this.parent&&(i=this.parent.isBoundTagged(e,t,n)),i},r.prototype.snapshot=function(){this._snapshots.push(_ee.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))},r.prototype.restore=function(){var e=this._snapshots.pop();if(e===void 0)throw new Error(ca.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore},r.prototype.createChild=function(e){var t=new r(e||this.options);return t.parent=this,t},r.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce(function(i,o){return o(i)},n)},r.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},r.prototype.get=function(e){var t=this._getNotAllArgs(e,!1);return this._getButThrowIfAsync(t)},r.prototype.getAsync=function(e){return hs(this,void 0,void 0,function(){var t;return gs(this,function(n){return t=this._getNotAllArgs(e,!1),[2,this._get(t)]})})},r.prototype.getTagged=function(e,t,n){var i=this._getNotAllArgs(e,!1,t,n);return this._getButThrowIfAsync(i)},r.prototype.getTaggedAsync=function(e,t,n){return hs(this,void 0,void 0,function(){var i;return gs(this,function(o){return i=this._getNotAllArgs(e,!1,t,n),[2,this._get(i)]})})},r.prototype.getNamed=function(e,t){return this.getTagged(e,im.NAMED_TAG,t)},r.prototype.getNamedAsync=function(e,t){return this.getTaggedAsync(e,im.NAMED_TAG,t)},r.prototype.getAll=function(e){var t=this._getAllArgs(e);return this._getButThrowIfAsync(t)},r.prototype.getAllAsync=function(e){var t=this._getAllArgs(e);return this._getAll(t)},r.prototype.getAllTagged=function(e,t,n){var i=this._getNotAllArgs(e,!0,t,n);return this._getButThrowIfAsync(i)},r.prototype.getAllTaggedAsync=function(e,t,n){var i=this._getNotAllArgs(e,!0,t,n);return this._getAll(i)},r.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,im.NAMED_TAG,t)},r.prototype.getAllNamedAsync=function(e,t){return this.getAllTaggedAsync(e,im.NAMED_TAG,t)},r.prototype.resolve=function(e){var t=this.isBound(e);t||this.bind(e).toSelf();var n=this.get(e);return t||this.unbind(e),n},r.prototype._preDestroy=function(e,t){if(Reflect.hasMetadata(im.PRE_DESTROY,e)){var n=Reflect.getMetadata(im.PRE_DESTROY,e);return t[n.value]()}},r.prototype._removeModuleHandlers=function(e){var t=this._moduleActivationStore.remove(e);this._activations.removeIntersection(t.onActivations),this._deactivations.removeIntersection(t.onDeactivations)},r.prototype._removeModuleBindings=function(e){return this._bindingDictionary.removeByCondition(function(t){return t.moduleId===e})},r.prototype._deactivate=function(e,t){var n=this,i=Object.getPrototypeOf(t).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){var o=this._deactivateContainer(t,this._deactivations.get(e.serviceIdentifier).values());if((0,om.isPromise)(o))return this._handleDeactivationError(o.then(function(){return n._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,i)}),i)}var s=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,t,i);if((0,om.isPromise)(s))return this._handleDeactivationError(s,i)}catch(a){throw new Error(ca.ON_DEACTIVATION_ERROR(i.name,a.message))}},r.prototype._handleDeactivationError=function(e,t){return hs(this,void 0,void 0,function(){var n;return gs(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return i.sent(),[3,3];case 2:throw n=i.sent(),new Error(ca.ON_DEACTIVATION_ERROR(t.name,n.message));case 3:return[2]}})})},r.prototype._deactivateContainer=function(e,t){for(var n=this,i=t.next();i.value;){var o=i.value(e);if((0,om.isPromise)(o))return o.then(function(){return n._deactivateContainerAsync(e,t)});i=t.next()}},r.prototype._deactivateContainerAsync=function(e,t){return hs(this,void 0,void 0,function(){var n;return gs(this,function(i){switch(i.label){case 0:n=t.next(),i.label=1;case 1:return n.value?[4,n.value(e)]:[3,3];case 2:return i.sent(),n=t.next(),[3,1];case 3:return[2]}})})},r.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(u,p){u._binding.moduleId=p},n=function(u){return function(p){var m=e.bind(p);return t(m,u),m}},i=function(){return function(u){return e.unbind(u)}},o=function(){return function(u){return e.unbindAsync(u)}},s=function(){return function(u){return e.isBound(u)}},a=function(u){return function(p){var m=e.rebind(p);return t(m,u),m}},c=function(u){return function(p,m){e._moduleActivationStore.addActivation(u,p,m),e.onActivation(p,m)}},l=function(u){return function(p,m){e._moduleActivationStore.addDeactivation(u,p,m),e.onDeactivation(p,m)}};return function(u){return{bindFunction:n(u),isboundFunction:s(),onActivationFunction:c(u),onDeactivationFunction:l(u),rebindFunction:a(u),unbindFunction:i(),unbindAsyncFunction:o()}}},r.prototype._getAll=function(e){return Promise.all(this._get(e))},r.prototype._get=function(e){var t=hE(hE({},e),{contextInterceptor:function(i){return i},targetType:_h.TargetTypeEnum.Variable});if(this._middleware){var n=this._middleware(t);if(n==null)throw new Error(ca.INVALID_MIDDLEWARE_RETURN);return n}return this._planAndResolve()(t)},r.prototype._getButThrowIfAsync=function(e){var t=this._get(e);if((0,om.isPromiseOrContainsPromise)(t))throw new Error(ca.LAZY_IN_SYNC(e.serviceIdentifier));return t},r.prototype._getAllArgs=function(e){var t={avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e};return t},r.prototype._getNotAllArgs=function(e,t,n,i){var o={avoidConstraints:!1,isMultiInject:t,serviceIdentifier:e,key:n,value:i};return o},r.prototype._planAndResolve=function(){var e=this;return function(t){var n=(0,fE.plan)(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);n=t.contextInterceptor(n);var i=(0,wee.resolve)(n);return i}},r.prototype._deactivateIfSingleton=function(e){var t=this;if(e.activated)return(0,om.isPromise)(e.cache)?e.cache.then(function(n){return t._deactivate(e,n)}):this._deactivate(e,e.cache)},r.prototype._deactivateSingletons=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t],o=this._deactivateIfSingleton(i);if((0,om.isPromise)(o))throw new Error(ca.ASYNC_UNBIND_REQUIRED)}},r.prototype._deactivateSingletonsAsync=function(e){return hs(this,void 0,void 0,function(){var t=this;return gs(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(i){return t._deactivateIfSingleton(i)}))];case 1:return n.sent(),[2]}})})},r.prototype._propagateContainerDeactivationThenBindingAndPreDestroy=function(e,t,n){return this.parent?this._deactivate.bind(this.parent)(e,t):this._bindingDeactivationAndPreDestroy(e,t,n)},r.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync=function(e,t,n){return hs(this,void 0,void 0,function(){return gs(this,function(i){switch(i.label){case 0:return this.parent?[4,this._deactivate.bind(this.parent)(e,t)]:[3,2];case 1:return i.sent(),[3,4];case 2:return[4,this._bindingDeactivationAndPreDestroyAsync(e,t,n)];case 3:i.sent(),i.label=4;case 4:return[2]}})})},r.prototype._removeServiceFromDictionary=function(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(ca.CANNOT_UNBIND+" "+(0,kee.getServiceIdentifierAsString)(e))}},r.prototype._bindingDeactivationAndPreDestroy=function(e,t,n){var i=this;if(typeof e.onDeactivation=="function"){var o=e.onDeactivation(t);if((0,om.isPromise)(o))return o.then(function(){return i._preDestroy(n,t)})}return this._preDestroy(n,t)},r.prototype._bindingDeactivationAndPreDestroyAsync=function(e,t,n){return hs(this,void 0,void 0,function(){return gs(this,function(i){switch(i.label){case 0:return typeof e.onDeactivation!="function"?[3,2]:[4,e.onDeactivation(t)];case 1:i.sent(),i.label=2;case 2:return[4,this._preDestroy(n,t)];case 3:return i.sent(),[2]}})})},r}();Hn.Container=Tee});var cW=M(Dh=>{"use strict";Object.defineProperty(Dh,"__esModule",{value:!0});Dh.AsyncContainerModule=Dh.ContainerModule=void 0;var aW=Xu(),Ree=function(){function r(e){this.id=(0,aW.id)(),this.registry=e}return r}();Dh.ContainerModule=Ree;var Aee=function(){function r(e){this.id=(0,aW.id)(),this.registry=e}return r}();Dh.AsyncContainerModule=Aee});var lW=M(gE=>{"use strict";Object.defineProperty(gE,"__esModule",{value:!0});gE.getFirstArrayDuplicate=void 0;function Nee(r){for(var e=new Set,t=0,n=r;t<n.length;t++){var i=n[t];if(e.has(i))return i;e.add(i)}}gE.getFirstArrayDuplicate=Nee});var Al=M(wi=>{"use strict";var Mee=wi&&wi.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Oee=wi&&wi.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),pW=wi&&wi.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Mee(e,r,t);return Oee(e,r),e};Object.defineProperty(wi,"__esModule",{value:!0});wi.createTaggedDecorator=wi.tagProperty=wi.tagParameter=wi.decorate=void 0;var vE=pW(Si()),dW=pW(Cn()),Kee=lW();function Fee(r){return r.prototype!==void 0}function Lee(r){if(r!==void 0)throw new Error(vE.INVALID_DECORATOR_OPERATION)}function mW(r,e,t,n){Lee(e),hW(dW.TAGGED,r,t.toString(),n)}wi.tagParameter=mW;function fW(r,e,t){if(Fee(r))throw new Error(vE.INVALID_DECORATOR_OPERATION);hW(dW.TAGGED_PROP,r.constructor,e,t)}wi.tagProperty=fW;function Uee(r){var e=[];if(Array.isArray(r)){e=r;var t=(0,Kee.getFirstArrayDuplicate)(e.map(function(n){return n.key}));if(t!==void 0)throw new Error(vE.DUPLICATED_METADATA+" "+t.toString())}else e=[r];return e}function hW(r,e,t,n){var i=Uee(n),o={};Reflect.hasOwnMetadata(r,e)&&(o=Reflect.getMetadata(r,e));var s=o[t];if(s===void 0)s=[];else for(var a=function(p){if(i.some(function(m){return m.key===p.key}))throw new Error(vE.DUPLICATED_METADATA+" "+p.key.toString())},c=0,l=s;c<l.length;c++){var u=l[c];a(u)}s.push.apply(s,i),o[t]=s,Reflect.defineMetadata(r,o,e)}function jee(r){return function(e,t,n){typeof n=="number"?mW(e,t,n,r):fW(e,t,r)}}wi.createTaggedDecorator=jee;function uW(r,e){Reflect.decorate(r,e)}function Wee(r,e){return function(t,n){e(t,n,r)}}function Vee(r,e,t){typeof t=="number"?uW([Wee(t,r)],e):typeof t=="string"?Reflect.decorate([r],e,t):uW([r],e)}wi.decorate=Vee});var vW=M(nc=>{"use strict";var Bee=nc&&nc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),qee=nc&&nc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),gW=nc&&nc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Bee(e,r,t);return qee(e,r),e};Object.defineProperty(nc,"__esModule",{value:!0});nc.injectable=void 0;var Jee=gW(Si()),NA=gW(Cn());function $ee(){return function(r){if(Reflect.hasOwnMetadata(NA.PARAM_TYPES,r))throw new Error(Jee.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(NA.DESIGN_PARAM_TYPES,r)||[];return Reflect.defineMetadata(NA.PARAM_TYPES,e,r),r}}nc.injectable=$ee});var yW=M(yE=>{"use strict";Object.defineProperty(yE,"__esModule",{value:!0});yE.tagged=void 0;var Hee=aa(),Gee=Al();function zee(r,e){return(0,Gee.createTaggedDecorator)(new Hee.Metadata(r,e))}yE.tagged=zee});var bW=M(ic=>{"use strict";var Qee=ic&&ic.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Yee=ic&&ic.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Xee=ic&&ic.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Qee(e,r,t);return Yee(e,r),e};Object.defineProperty(ic,"__esModule",{value:!0});ic.named=void 0;var Zee=Xee(Cn()),ete=aa(),tte=Al();function rte(r){return(0,tte.createTaggedDecorator)(new ete.Metadata(Zee.NAMED_TAG,r))}ic.named=rte});var MA=M(bE=>{"use strict";Object.defineProperty(bE,"__esModule",{value:!0});bE.injectBase=void 0;var nte=Si(),ite=aa(),ote=Al();function ste(r){return function(e){return function(t,n,i){if(e===void 0){var o=typeof t=="function"?t.name:t.constructor.name;throw new Error((0,nte.UNDEFINED_INJECT_ANNOTATION)(o))}return(0,ote.createTaggedDecorator)(new ite.Metadata(r,e))(t,n,i)}}}bE.injectBase=ste});var IW=M(oc=>{"use strict";var ate=oc&&oc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),cte=oc&&oc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),lte=oc&&oc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&ate(e,r,t);return cte(e,r),e};Object.defineProperty(oc,"__esModule",{value:!0});oc.inject=void 0;var ute=lte(Cn()),pte=MA(),dte=(0,pte.injectBase)(ute.INJECT_TAG);oc.inject=dte});var SW=M(sc=>{"use strict";var mte=sc&&sc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),fte=sc&&sc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),hte=sc&&sc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&mte(e,r,t);return fte(e,r),e};Object.defineProperty(sc,"__esModule",{value:!0});sc.optional=void 0;var gte=hte(Cn()),vte=aa(),yte=Al();function bte(){return(0,yte.createTaggedDecorator)(new vte.Metadata(gte.OPTIONAL_TAG,!0))}sc.optional=bte});var xW=M(ac=>{"use strict";var Ite=ac&&ac.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Ste=ac&&ac.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),xte=ac&&ac.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Ite(e,r,t);return Ste(e,r),e};Object.defineProperty(ac,"__esModule",{value:!0});ac.unmanaged=void 0;var Cte=xte(Cn()),wte=aa(),Ete=Al();function Pte(){return function(r,e,t){var n=new wte.Metadata(Cte.UNMANAGED_TAG,!0);(0,Ete.tagParameter)(r,e,t,n)}}ac.unmanaged=Pte});var CW=M(cc=>{"use strict";var kte=cc&&cc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),_te=cc&&cc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Dte=cc&&cc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&kte(e,r,t);return _te(e,r),e};Object.defineProperty(cc,"__esModule",{value:!0});cc.multiInject=void 0;var Tte=Dte(Cn()),Rte=MA(),Ate=(0,Rte.injectBase)(Tte.MULTI_INJECT_TAG);cc.multiInject=Ate});var wW=M(lc=>{"use strict";var Nte=lc&&lc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Mte=lc&&lc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Ote=lc&&lc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Nte(e,r,t);return Mte(e,r),e};Object.defineProperty(lc,"__esModule",{value:!0});lc.targetName=void 0;var Kte=Ote(Cn()),Fte=aa(),Lte=Al();function Ute(r){return function(e,t,n){var i=new Fte.Metadata(Kte.NAME_TAG,r);(0,Lte.tagParameter)(e,t,n,i)}}lc.targetName=Ute});var OA=M(IE=>{"use strict";Object.defineProperty(IE,"__esModule",{value:!0});IE.propertyEventDecorator=void 0;var jte=aa();function Wte(r,e){return function(){return function(t,n){var i=new jte.Metadata(r,n);if(Reflect.hasOwnMetadata(r,t.constructor))throw new Error(e);Reflect.defineMetadata(r,i,t.constructor)}}}IE.propertyEventDecorator=Wte});var PW=M(uc=>{"use strict";var Vte=uc&&uc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Bte=uc&&uc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),EW=uc&&uc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Vte(e,r,t);return Bte(e,r),e};Object.defineProperty(uc,"__esModule",{value:!0});uc.postConstruct=void 0;var qte=EW(Si()),Jte=EW(Cn()),$te=OA(),Hte=(0,$te.propertyEventDecorator)(Jte.POST_CONSTRUCT,qte.MULTIPLE_POST_CONSTRUCT_METHODS);uc.postConstruct=Hte});var _W=M(pc=>{"use strict";var Gte=pc&&pc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),zte=pc&&pc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),kW=pc&&pc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Gte(e,r,t);return zte(e,r),e};Object.defineProperty(pc,"__esModule",{value:!0});pc.preDestroy=void 0;var Qte=kW(Si()),Yte=kW(Cn()),Xte=OA(),Zte=(0,Xte.propertyEventDecorator)(Yte.PRE_DESTROY,Qte.MULTIPLE_PRE_DESTROY_METHODS);pc.preDestroy=Zte});var DW=M(SE=>{"use strict";Object.defineProperty(SE,"__esModule",{value:!0});SE.interfaces=void 0;var KA;KA||(KA={});SE.interfaces=KA});var O=M(We=>{"use strict";var ere=We&&We.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),tre=We&&We.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),rre=We&&We.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&ere(e,r,t);return tre(e,r),e};Object.defineProperty(We,"__esModule",{value:!0});We.multiBindToService=We.getServiceIdentifierAsString=We.typeConstraint=We.namedConstraint=We.taggedConstraint=We.traverseAncerstors=We.decorate=We.interfaces=We.id=We.MetadataReader=We.preDestroy=We.postConstruct=We.targetName=We.multiInject=We.unmanaged=We.optional=We.LazyServiceIdentifer=We.inject=We.named=We.tagged=We.injectable=We.createTaggedDecorator=We.ContainerModule=We.AsyncContainerModule=We.TargetTypeEnum=We.BindingTypeEnum=We.BindingScopeEnum=We.Container=We.METADATA_KEY=void 0;var nre=rre(Cn());We.METADATA_KEY=nre;var ire=AA();Object.defineProperty(We,"Container",{enumerable:!0,get:function(){return ire.Container}});var FA=sa();Object.defineProperty(We,"BindingScopeEnum",{enumerable:!0,get:function(){return FA.BindingScopeEnum}});Object.defineProperty(We,"BindingTypeEnum",{enumerable:!0,get:function(){return FA.BindingTypeEnum}});Object.defineProperty(We,"TargetTypeEnum",{enumerable:!0,get:function(){return FA.TargetTypeEnum}});var TW=cW();Object.defineProperty(We,"AsyncContainerModule",{enumerable:!0,get:function(){return TW.AsyncContainerModule}});Object.defineProperty(We,"ContainerModule",{enumerable:!0,get:function(){return TW.ContainerModule}});var ore=Al();Object.defineProperty(We,"createTaggedDecorator",{enumerable:!0,get:function(){return ore.createTaggedDecorator}});var sre=vW();Object.defineProperty(We,"injectable",{enumerable:!0,get:function(){return sre.injectable}});var are=yW();Object.defineProperty(We,"tagged",{enumerable:!0,get:function(){return are.tagged}});var cre=bW();Object.defineProperty(We,"named",{enumerable:!0,get:function(){return cre.named}});var lre=IW();Object.defineProperty(We,"inject",{enumerable:!0,get:function(){return lre.inject}});var ure=lA();Object.defineProperty(We,"LazyServiceIdentifer",{enumerable:!0,get:function(){return ure.LazyServiceIdentifer}});var pre=SW();Object.defineProperty(We,"optional",{enumerable:!0,get:function(){return pre.optional}});var dre=xW();Object.defineProperty(We,"unmanaged",{enumerable:!0,get:function(){return dre.unmanaged}});var mre=CW();Object.defineProperty(We,"multiInject",{enumerable:!0,get:function(){return mre.multiInject}});var fre=wW();Object.defineProperty(We,"targetName",{enumerable:!0,get:function(){return fre.targetName}});var hre=PW();Object.defineProperty(We,"postConstruct",{enumerable:!0,get:function(){return hre.postConstruct}});var gre=_W();Object.defineProperty(We,"preDestroy",{enumerable:!0,get:function(){return gre.preDestroy}});var vre=aA();Object.defineProperty(We,"MetadataReader",{enumerable:!0,get:function(){return vre.MetadataReader}});var yre=Xu();Object.defineProperty(We,"id",{enumerable:!0,get:function(){return yre.id}});var bre=DW();Object.defineProperty(We,"interfaces",{enumerable:!0,get:function(){return bre.interfaces}});var Ire=Al();Object.defineProperty(We,"decorate",{enumerable:!0,get:function(){return Ire.decorate}});var xE=kA();Object.defineProperty(We,"traverseAncerstors",{enumerable:!0,get:function(){return xE.traverseAncerstors}});Object.defineProperty(We,"taggedConstraint",{enumerable:!0,get:function(){return xE.taggedConstraint}});Object.defineProperty(We,"namedConstraint",{enumerable:!0,get:function(){return xE.namedConstraint}});Object.defineProperty(We,"typeConstraint",{enumerable:!0,get:function(){return xE.typeConstraint}});var Sre=Ch();Object.defineProperty(We,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return Sre.getServiceIdentifierAsString}});var xre=IA();Object.defineProperty(We,"multiBindToService",{enumerable:!0,get:function(){return xre.multiBindToService}})});var OW=M(VS=>{VS.get=function(r){var e=Error.stackTraceLimit;Error.stackTraceLimit=1/0;var t={},n=Error.prepareStackTrace;Error.prepareStackTrace=function(o,s){return s},Error.captureStackTrace(t,r||VS.get);var i=t.stack;return Error.prepareStackTrace=n,Error.stackTraceLimit=e,i};VS.parse=function(r){if(!r.stack)return[];var e=this,t=r.stack.split(`
`).slice(1);return t.map(function(n){if(n.match(/^\s*[-]{4,}$/))return e._createParsedCallSite({fileName:n,lineNumber:null,functionName:null,typeName:null,methodName:null,columnNumber:null,native:null});var i=n.match(/at (?:(.+)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/);if(i){var o=null,s=null,a=null,c=null,l=null,u=i[5]==="native";if(i[1]){a=i[1];var p=a.lastIndexOf(".");if(a[p-1]=="."&&p--,p>0){o=a.substr(0,p),s=a.substr(p+1);var m=o.indexOf(".Module");m>0&&(a=a.substr(m+1),o=o.substr(0,m))}c=null}s&&(c=o,l=s),s==="<anonymous>"&&(l=null,a=null);var h={fileName:i[2]||null,lineNumber:parseInt(i[3],10)||null,functionName:a,typeName:c,methodName:l,columnNumber:parseInt(i[4],10)||null,native:u};return e._createParsedCallSite(h)}}).filter(function(n){return!!n})};function WS(r){for(var e in r)this[e]=r[e]}var wre=["this","typeName","functionName","methodName","fileName","lineNumber","columnNumber","function","evalOrigin"],Ere=["topLevel","eval","native","constructor"];wre.forEach(function(r){WS.prototype[r]=null,WS.prototype["get"+r[0].toUpperCase()+r.substr(1)]=function(){return this[r]}});Ere.forEach(function(r){WS.prototype[r]=!1,WS.prototype["is"+r[0].toUpperCase()+r.substr(1)]=function(){return this[r]}});VS._createParsedCallSite=function(r){return new WS(r)}});var qh=M((kt,pV)=>{kt=pV.exports=zt;var xr;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?xr=function(){var r=Array.prototype.slice.call(arguments,0);r.unshift("SEMVER"),console.log.apply(console,r)}:xr=function(){};kt.SEMVER_SPEC_VERSION="2.0.0";var JS=256,NE=Number.MAX_SAFE_INTEGER||9007199254740991,zA=16,Ooe=JS-6,$S=kt.re=[],Or=kt.safeRe=[],he=kt.src=[],qt=0,eN="[a-zA-Z0-9-]",QA=[["\\s",1],["\\d",JS],[eN,Ooe]];function UE(r){for(var e=0;e<QA.length;e++){var t=QA[e][0],n=QA[e][1];r=r.split(t+"*").join(t+"{0,"+n+"}").split(t+"+").join(t+"{1,"+n+"}")}return r}var Fh=qt++;he[Fh]="0|[1-9]\\d*";var Lh=qt++;he[Lh]="\\d+";var tN=qt++;he[tN]="\\d*[a-zA-Z-]"+eN+"*";var YW=qt++;he[YW]="("+he[Fh]+")\\.("+he[Fh]+")\\.("+he[Fh]+")";var XW=qt++;he[XW]="("+he[Lh]+")\\.("+he[Lh]+")\\.("+he[Lh]+")";var YA=qt++;he[YA]="(?:"+he[Fh]+"|"+he[tN]+")";var XA=qt++;he[XA]="(?:"+he[Lh]+"|"+he[tN]+")";var rN=qt++;he[rN]="(?:-("+he[YA]+"(?:\\."+he[YA]+")*))";var nN=qt++;he[nN]="(?:-?("+he[XA]+"(?:\\."+he[XA]+")*))";var ZA=qt++;he[ZA]=eN+"+";var GS=qt++;he[GS]="(?:\\+("+he[ZA]+"(?:\\."+he[ZA]+")*))";var iN=qt++,ZW="v?"+he[YW]+he[rN]+"?"+he[GS]+"?";he[iN]="^"+ZW+"$";var oN="[v=\\s]*"+he[XW]+he[nN]+"?"+he[GS]+"?",sN=qt++;he[sN]="^"+oN+"$";var Bh=qt++;he[Bh]="((?:<|>)?=?)";var ME=qt++;he[ME]=he[Lh]+"|x|X|\\*";var OE=qt++;he[OE]=he[Fh]+"|x|X|\\*";var cm=qt++;he[cm]="[v=\\s]*("+he[OE]+")(?:\\.("+he[OE]+")(?:\\.("+he[OE]+")(?:"+he[rN]+")?"+he[GS]+"?)?)?";var jh=qt++;he[jh]="[v=\\s]*("+he[ME]+")(?:\\.("+he[ME]+")(?:\\.("+he[ME]+")(?:"+he[nN]+")?"+he[GS]+"?)?)?";var eV=qt++;he[eV]="^"+he[Bh]+"\\s*"+he[cm]+"$";var tV=qt++;he[tV]="^"+he[Bh]+"\\s*"+he[jh]+"$";var rV=qt++;he[rV]="(?:^|[^\\d])(\\d{1,"+zA+"})(?:\\.(\\d{1,"+zA+"}))?(?:\\.(\\d{1,"+zA+"}))?(?:$|[^\\d])";var jE=qt++;he[jE]="(?:~>?)";var Wh=qt++;he[Wh]="(\\s*)"+he[jE]+"\\s+";$S[Wh]=new RegExp(he[Wh],"g");Or[Wh]=new RegExp(UE(he[Wh]),"g");var Koe="$1~",nV=qt++;he[nV]="^"+he[jE]+he[cm]+"$";var iV=qt++;he[iV]="^"+he[jE]+he[jh]+"$";var WE=qt++;he[WE]="(?:\\^)";var Vh=qt++;he[Vh]="(\\s*)"+he[WE]+"\\s+";$S[Vh]=new RegExp(he[Vh],"g");Or[Vh]=new RegExp(UE(he[Vh]),"g");var Foe="$1^",oV=qt++;he[oV]="^"+he[WE]+he[cm]+"$";var sV=qt++;he[sV]="^"+he[WE]+he[jh]+"$";var aN=qt++;he[aN]="^"+he[Bh]+"\\s*("+oN+")$|^$";var cN=qt++;he[cN]="^"+he[Bh]+"\\s*("+ZW+")$|^$";var lm=qt++;he[lm]="(\\s*)"+he[Bh]+"\\s*("+oN+"|"+he[cm]+")";$S[lm]=new RegExp(he[lm],"g");Or[lm]=new RegExp(UE(he[lm]),"g");var Loe="$1$2$3",aV=qt++;he[aV]="^\\s*("+he[cm]+")\\s+-\\s+("+he[cm]+")\\s*$";var cV=qt++;he[cV]="^\\s*("+he[jh]+")\\s+-\\s+("+he[jh]+")\\s*$";var lV=qt++;he[lV]="(<|>)?=?\\s*\\*";for(hc=0;hc<qt;hc++)xr(hc,he[hc]),$S[hc]||($S[hc]=new RegExp(he[hc]),Or[hc]=new RegExp(UE(he[hc])));var hc;kt.parse=um;function um(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof zt)return r;if(typeof r!="string"||r.length>JS)return null;var t=e.loose?Or[sN]:Or[iN];if(!t.test(r))return null;try{return new zt(r,e)}catch{return null}}kt.valid=Uoe;function Uoe(r,e){var t=um(r,e);return t?t.version:null}kt.clean=joe;function joe(r,e){var t=um(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null}kt.SemVer=zt;function zt(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof zt){if(r.loose===e.loose)return r;r=r.version}else if(typeof r!="string")throw new TypeError("Invalid Version: "+r);if(r.length>JS)throw new TypeError("version is longer than "+JS+" characters");if(!(this instanceof zt))return new zt(r,e);xr("SemVer",r,e),this.options=e,this.loose=!!e.loose;var t=r.trim().match(e.loose?Or[sN]:Or[iN]);if(!t)throw new TypeError("Invalid Version: "+r);if(this.raw=r,this.major=+t[1],this.minor=+t[2],this.patch=+t[3],this.major>NE||this.major<0)throw new TypeError("Invalid major version");if(this.minor>NE||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>NE||this.patch<0)throw new TypeError("Invalid patch version");t[4]?this.prerelease=t[4].split(".").map(function(n){if(/^[0-9]+$/.test(n)){var i=+n;if(i>=0&&i<NE)return i}return n}):this.prerelease=[],this.build=t[5]?t[5].split("."):[],this.format()}zt.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version};zt.prototype.toString=function(){return this.version};zt.prototype.compare=function(r){return xr("SemVer.compare",this.version,this.options,r),r instanceof zt||(r=new zt(r,this.options)),this.compareMain(r)||this.comparePre(r)};zt.prototype.compareMain=function(r){return r instanceof zt||(r=new zt(r,this.options)),Uh(this.major,r.major)||Uh(this.minor,r.minor)||Uh(this.patch,r.patch)};zt.prototype.comparePre=function(r){if(r instanceof zt||(r=new zt(r,this.options)),this.prerelease.length&&!r.prerelease.length)return-1;if(!this.prerelease.length&&r.prerelease.length)return 1;if(!this.prerelease.length&&!r.prerelease.length)return 0;var e=0;do{var t=this.prerelease[e],n=r.prerelease[e];if(xr("prerelease compare",e,t,n),t===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(t===void 0)return-1;if(t===n)continue;return Uh(t,n)}while(++e)};zt.prototype.inc=function(r,e){switch(r){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var t=this.prerelease.length;--t>=0;)typeof this.prerelease[t]=="number"&&(this.prerelease[t]++,t=-2);t===-1&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+r)}return this.format(),this.raw=this.version,this};kt.inc=Woe;function Woe(r,e,t,n){typeof t=="string"&&(n=t,t=void 0);try{return new zt(r,t).inc(e,n).version}catch{return null}}kt.diff=Voe;function Voe(r,e){if(lN(r,e))return null;var t=um(r),n=um(e),i="";if(t.prerelease.length||n.prerelease.length){i="pre";var o="prerelease"}for(var s in t)if((s==="major"||s==="minor"||s==="patch")&&t[s]!==n[s])return i+s;return o}kt.compareIdentifiers=Uh;var QW=/^[0-9]+$/;function Uh(r,e){var t=QW.test(r),n=QW.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1}kt.rcompareIdentifiers=Boe;function Boe(r,e){return Uh(e,r)}kt.major=qoe;function qoe(r,e){return new zt(r,e).major}kt.minor=Joe;function Joe(r,e){return new zt(r,e).minor}kt.patch=$oe;function $oe(r,e){return new zt(r,e).patch}kt.compare=Nl;function Nl(r,e,t){return new zt(r,t).compare(new zt(e,t))}kt.compareLoose=Hoe;function Hoe(r,e){return Nl(r,e,!0)}kt.rcompare=Goe;function Goe(r,e,t){return Nl(e,r,t)}kt.sort=zoe;function zoe(r,e){return r.sort(function(t,n){return kt.compare(t,n,e)})}kt.rsort=Qoe;function Qoe(r,e){return r.sort(function(t,n){return kt.rcompare(t,n,e)})}kt.gt=HS;function HS(r,e,t){return Nl(r,e,t)>0}kt.lt=KE;function KE(r,e,t){return Nl(r,e,t)<0}kt.eq=lN;function lN(r,e,t){return Nl(r,e,t)===0}kt.neq=uV;function uV(r,e,t){return Nl(r,e,t)!==0}kt.gte=uN;function uN(r,e,t){return Nl(r,e,t)>=0}kt.lte=pN;function pN(r,e,t){return Nl(r,e,t)<=0}kt.cmp=FE;function FE(r,e,t,n){switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return lN(r,t,n);case"!=":return uV(r,t,n);case">":return HS(r,t,n);case">=":return uN(r,t,n);case"<":return KE(r,t,n);case"<=":return pN(r,t,n);default:throw new TypeError("Invalid operator: "+e)}}kt.Comparator=ys;function ys(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof ys){if(r.loose===!!e.loose)return r;r=r.value}if(!(this instanceof ys))return new ys(r,e);r=r.trim().split(/\s+/).join(" "),xr("comparator",r,e),this.options=e,this.loose=!!e.loose,this.parse(r),this.semver===zS?this.value="":this.value=this.operator+this.semver.version,xr("comp",this)}var zS={};ys.prototype.parse=function(r){var e=this.options.loose?Or[aN]:Or[cN],t=r.match(e);if(!t)throw new TypeError("Invalid comparator: "+r);this.operator=t[1],this.operator==="="&&(this.operator=""),t[2]?this.semver=new zt(t[2],this.options.loose):this.semver=zS};ys.prototype.toString=function(){return this.value};ys.prototype.test=function(r){return xr("Comparator.test",r,this.options.loose),this.semver===zS?!0:(typeof r=="string"&&(r=new zt(r,this.options)),FE(r,this.operator,this.semver,this.options))};ys.prototype.intersects=function(r,e){if(!(r instanceof ys))throw new TypeError("a Comparator is required");(!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1});var t;if(this.operator==="")return t=new an(r.value,e),LE(this.value,t,e);if(r.operator==="")return t=new an(this.value,e),LE(r.semver,t,e);var n=(this.operator===">="||this.operator===">")&&(r.operator===">="||r.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(r.operator==="<="||r.operator==="<"),o=this.semver.version===r.semver.version,s=(this.operator===">="||this.operator==="<=")&&(r.operator===">="||r.operator==="<="),a=FE(this.semver,"<",r.semver,e)&&(this.operator===">="||this.operator===">")&&(r.operator==="<="||r.operator==="<"),c=FE(this.semver,">",r.semver,e)&&(this.operator==="<="||this.operator==="<")&&(r.operator===">="||r.operator===">");return n||i||o&&s||a||c};kt.Range=an;function an(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof an)return r.loose===!!e.loose&&r.includePrerelease===!!e.includePrerelease?r:new an(r.raw,e);if(r instanceof ys)return new an(r.value,e);if(!(this instanceof an))return new an(r,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=r.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(function(t){return this.parseRange(t.trim())},this).filter(function(t){return t.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+this.raw);this.format()}an.prototype.format=function(){return this.range=this.set.map(function(r){return r.join(" ").trim()}).join("||").trim(),this.range};an.prototype.toString=function(){return this.range};an.prototype.parseRange=function(r){var e=this.options.loose,t=e?Or[cV]:Or[aV];r=r.replace(t,sse),xr("hyphen replace",r),r=r.replace(Or[lm],Loe),xr("comparator trim",r,Or[lm]),r=r.replace(Or[Wh],Koe),r=r.replace(Or[Vh],Foe);var n=e?Or[aN]:Or[cN],i=r.split(" ").map(function(o){return Xoe(o,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(i=i.filter(function(o){return!!o.match(n)})),i=i.map(function(o){return new ys(o,this.options)},this),i};an.prototype.intersects=function(r,e){if(!(r instanceof an))throw new TypeError("a Range is required");return this.set.some(function(t){return t.every(function(n){return r.set.some(function(i){return i.every(function(o){return n.intersects(o,e)})})})})};kt.toComparators=Yoe;function Yoe(r,e){return new an(r,e).set.map(function(t){return t.map(function(n){return n.value}).join(" ").trim().split(" ")})}function Xoe(r,e){return xr("comp",r,e),r=tse(r,e),xr("caret",r),r=Zoe(r,e),xr("tildes",r),r=nse(r,e),xr("xrange",r),r=ose(r,e),xr("stars",r),r}function Ji(r){return!r||r.toLowerCase()==="x"||r==="*"}function Zoe(r,e){return r.trim().split(/\s+/).map(function(t){return ese(t,e)}).join(" ")}function ese(r,e){var t=e.loose?Or[iV]:Or[nV];return r.replace(t,function(n,i,o,s,a){xr("tilde",r,n,i,o,s,a);var c;return Ji(i)?c="":Ji(o)?c=">="+i+".0.0 <"+(+i+1)+".0.0":Ji(s)?c=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":a?(xr("replaceTilde pr",a),c=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0"):c=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0",xr("tilde return",c),c})}function tse(r,e){return r.trim().split(/\s+/).map(function(t){return rse(t,e)}).join(" ")}function rse(r,e){xr("caret",r,e);var t=e.loose?Or[sV]:Or[oV];return r.replace(t,function(n,i,o,s,a){xr("caret",r,n,i,o,s,a);var c;return Ji(i)?c="":Ji(o)?c=">="+i+".0.0 <"+(+i+1)+".0.0":Ji(s)?i==="0"?c=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":c=">="+i+"."+o+".0 <"+(+i+1)+".0.0":a?(xr("replaceCaret pr",a),i==="0"?o==="0"?c=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+o+"."+(+s+1):c=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0":c=">="+i+"."+o+"."+s+"-"+a+" <"+(+i+1)+".0.0"):(xr("no pr"),i==="0"?o==="0"?c=">="+i+"."+o+"."+s+" <"+i+"."+o+"."+(+s+1):c=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0":c=">="+i+"."+o+"."+s+" <"+(+i+1)+".0.0"),xr("caret return",c),c})}function nse(r,e){return xr("replaceXRanges",r,e),r.split(/\s+/).map(function(t){return ise(t,e)}).join(" ")}function ise(r,e){r=r.trim();var t=e.loose?Or[tV]:Or[eV];return r.replace(t,function(n,i,o,s,a,c){xr("xRange",r,n,i,o,s,a,c);var l=Ji(o),u=l||Ji(s),p=u||Ji(a),m=p;return i==="="&&m&&(i=""),l?i===">"||i==="<"?n="<0.0.0":n="*":i&&m?(u&&(s=0),a=0,i===">"?(i=">=",u?(o=+o+1,s=0,a=0):(s=+s+1,a=0)):i==="<="&&(i="<",u?o=+o+1:s=+s+1),n=i+o+"."+s+"."+a):u?n=">="+o+".0.0 <"+(+o+1)+".0.0":p&&(n=">="+o+"."+s+".0 <"+o+"."+(+s+1)+".0"),xr("xRange return",n),n})}function ose(r,e){return xr("replaceStars",r,e),r.trim().replace(Or[lV],"")}function sse(r,e,t,n,i,o,s,a,c,l,u,p,m){return Ji(t)?e="":Ji(n)?e=">="+t+".0.0":Ji(i)?e=">="+t+"."+n+".0":e=">="+e,Ji(c)?a="":Ji(l)?a="<"+(+c+1)+".0.0":Ji(u)?a="<"+c+"."+(+l+1)+".0":p?a="<="+c+"."+l+"."+u+"-"+p:a="<="+a,(e+" "+a).trim()}an.prototype.test=function(r){if(!r)return!1;typeof r=="string"&&(r=new zt(r,this.options));for(var e=0;e<this.set.length;e++)if(ase(this.set[e],r,this.options))return!0;return!1};function ase(r,e,t){for(var n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(n=0;n<r.length;n++)if(xr(r[n].semver),r[n].semver!==zS&&r[n].semver.prerelease.length>0){var i=r[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}kt.satisfies=LE;function LE(r,e,t){try{e=new an(e,t)}catch{return!1}return e.test(r)}kt.maxSatisfying=cse;function cse(r,e,t){var n=null,i=null;try{var o=new an(e,t)}catch{return null}return r.forEach(function(s){o.test(s)&&(!n||i.compare(s)===-1)&&(n=s,i=new zt(n,t))}),n}kt.minSatisfying=lse;function lse(r,e,t){var n=null,i=null;try{var o=new an(e,t)}catch{return null}return r.forEach(function(s){o.test(s)&&(!n||i.compare(s)===1)&&(n=s,i=new zt(n,t))}),n}kt.minVersion=use;function use(r,e){r=new an(r,e);var t=new zt("0.0.0");if(r.test(t)||(t=new zt("0.0.0-0"),r.test(t)))return t;t=null;for(var n=0;n<r.set.length;++n){var i=r.set[n];i.forEach(function(o){var s=new zt(o.semver.version);switch(o.operator){case">":s.prerelease.length===0?s.patch++:s.prerelease.push(0),s.raw=s.format();case"":case">=":(!t||HS(t,s))&&(t=s);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+o.operator)}})}return t&&r.test(t)?t:null}kt.validRange=pse;function pse(r,e){try{return new an(r,e).range||"*"}catch{return null}}kt.ltr=dse;function dse(r,e,t){return dN(r,e,"<",t)}kt.gtr=mse;function mse(r,e,t){return dN(r,e,">",t)}kt.outside=dN;function dN(r,e,t,n){r=new zt(r,n),e=new an(e,n);var i,o,s,a,c;switch(t){case">":i=HS,o=pN,s=KE,a=">",c=">=";break;case"<":i=KE,o=uN,s=HS,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(LE(r,e,n))return!1;for(var l=0;l<e.set.length;++l){var u=e.set[l],p=null,m=null;if(u.forEach(function(h){h.semver===zS&&(h=new ys(">=0.0.0")),p=p||h,m=m||h,i(h.semver,p.semver,n)?p=h:s(h.semver,m.semver,n)&&(m=h)}),p.operator===a||p.operator===c||(!m.operator||m.operator===a)&&o(r,m.semver))return!1;if(m.operator===c&&s(r,m.semver))return!1}return!0}kt.prerelease=fse;function fse(r,e){var t=um(r,e);return t&&t.prerelease.length?t.prerelease:null}kt.intersects=hse;function hse(r,e,t){return r=new an(r,t),e=new an(e,t),r.intersects(e)}kt.coerce=gse;function gse(r){if(r instanceof zt)return r;if(typeof r!="string")return null;var e=r.match(Or[rV]);return e==null?null:um(e[1]+"."+(e[2]||"0")+"."+(e[3]||"0"))}});var dV=M(rp=>{"use strict";Object.defineProperty(rp,"__esModule",{value:!0});rp.PythonExtension=rp.PVSC_EXTENSION_ID=void 0;var vse=require("vscode");rp.PVSC_EXTENSION_ID="ms-python.python";var yse;(function(r){async function e(){let t=vse.extensions.getExtension(rp.PVSC_EXTENSION_ID);if(t===void 0)throw new Error("Python extension is not installed or is disabled");return t.isActive||await t.activate(),t.exports}r.api=e})(yse=rp.PythonExtension||(rp.PythonExtension={}))});var yV=M((oEe,vV)=>{"use strict";vV.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}});var SV=M(fN=>{"use strict";var xse=Object.prototype.hasOwnProperty,Cse;function bV(r){try{return decodeURIComponent(r.replace(/\+/g," "))}catch{return null}}function IV(r){try{return encodeURIComponent(r)}catch{return null}}function wse(r){for(var e=/([^=?#&]+)=?([^&]*)/g,t={},n;n=e.exec(r);){var i=bV(n[1]),o=bV(n[2]);i===null||o===null||i in t||(t[i]=o)}return t}function Ese(r,e){e=e||"";var t=[],n,i;typeof e!="string"&&(e="?");for(i in r)if(xse.call(r,i)){if(n=r[i],!n&&(n===null||n===Cse||isNaN(n))&&(n=""),i=IV(i),n=IV(n),i===null||n===null)continue;t.push(i+"="+n)}return t.length?e+t.join("&"):""}fN.stringify=Ese;fN.parse=wse});var DV=M((aEe,_V)=>{"use strict";var CV=yV(),YE=SV(),Pse=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,wV=/[\n\r\t]/g,kse=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,EV=/:\d+$/,_se=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,Dse=/^[a-zA-Z]:/;function gN(r){return(r||"").toString().replace(Pse,"")}var hN=[["#","hash"],["?","query"],function(e,t){return gc(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],xV={hash:1,query:1};function PV(r){var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e={};var t=e.location||{};r=r||t;var n={},i=typeof r,o;if(r.protocol==="blob:")n=new vc(unescape(r.pathname),{});else if(i==="string"){n=new vc(r,{});for(o in xV)delete n[o]}else if(i==="object"){for(o in r)o in xV||(n[o]=r[o]);n.slashes===void 0&&(n.slashes=kse.test(r.href))}return n}function gc(r){return r==="file:"||r==="ftp:"||r==="http:"||r==="https:"||r==="ws:"||r==="wss:"}function kV(r,e){r=gN(r),r=r.replace(wV,""),e=e||{};var t=_se.exec(r),n=t[1]?t[1].toLowerCase():"",i=!!t[2],o=!!t[3],s=0,a;return i?o?(a=t[2]+t[3]+t[4],s=t[2].length+t[3].length):(a=t[2]+t[4],s=t[2].length):o?(a=t[3]+t[4],s=t[3].length):a=t[4],n==="file:"?s>=2&&(a=a.slice(2)):gc(n)?a=t[4]:n?i&&(a=a.slice(2)):s>=2&&gc(e.protocol)&&(a=t[4]),{protocol:n,slashes:i||gc(n),slashesCount:s,rest:a}}function Tse(r,e){if(r==="")return e;for(var t=(e||"/").split("/").slice(0,-1).concat(r.split("/")),n=t.length,i=t[n-1],o=!1,s=0;n--;)t[n]==="."?t.splice(n,1):t[n]===".."?(t.splice(n,1),s++):s&&(n===0&&(o=!0),t.splice(n,1),s--);return o&&t.unshift(""),(i==="."||i==="..")&&t.push(""),t.join("/")}function vc(r,e,t){if(r=gN(r),r=r.replace(wV,""),!(this instanceof vc))return new vc(r,e,t);var n,i,o,s,a,c,l=hN.slice(),u=typeof e,p=this,m=0;for(u!=="object"&&u!=="string"&&(t=e,e=null),t&&typeof t!="function"&&(t=YE.parse),e=PV(e),i=kV(r||"",e),n=!i.protocol&&!i.slashes,p.slashes=i.slashes||n&&e.slashes,p.protocol=i.protocol||e.protocol||"",r=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||Dse.test(r))||!i.slashes&&(i.protocol||i.slashesCount<2||!gc(p.protocol)))&&(l[3]=[/(.*)/,"pathname"]);m<l.length;m++){if(s=l[m],typeof s=="function"){r=s(r,p);continue}o=s[0],c=s[1],o!==o?p[c]=r:typeof o=="string"?(a=o==="@"?r.lastIndexOf(o):r.indexOf(o),~a&&(typeof s[2]=="number"?(p[c]=r.slice(0,a),r=r.slice(a+s[2])):(p[c]=r.slice(a),r=r.slice(0,a)))):(a=o.exec(r))&&(p[c]=a[1],r=r.slice(0,a.index)),p[c]=p[c]||n&&s[3]&&e[c]||"",s[4]&&(p[c]=p[c].toLowerCase())}t&&(p.query=t(p.query)),n&&e.slashes&&p.pathname.charAt(0)!=="/"&&(p.pathname!==""||e.pathname!=="")&&(p.pathname=Tse(p.pathname,e.pathname)),p.pathname.charAt(0)!=="/"&&gc(p.protocol)&&(p.pathname="/"+p.pathname),CV(p.port,p.protocol)||(p.host=p.hostname,p.port=""),p.username=p.password="",p.auth&&(a=p.auth.indexOf(":"),~a?(p.username=p.auth.slice(0,a),p.username=encodeURIComponent(decodeURIComponent(p.username)),p.password=p.auth.slice(a+1),p.password=encodeURIComponent(decodeURIComponent(p.password))):p.username=encodeURIComponent(decodeURIComponent(p.auth)),p.auth=p.password?p.username+":"+p.password:p.username),p.origin=p.protocol!=="file:"&&gc(p.protocol)&&p.host?p.protocol+"//"+p.host:"null",p.href=p.toString()}function Rse(r,e,t){var n=this;switch(r){case"query":typeof e=="string"&&e.length&&(e=(t||YE.parse)(e)),n[r]=e;break;case"port":n[r]=e,CV(e,n.protocol)?e&&(n.host=n.hostname+":"+e):(n.host=n.hostname,n[r]="");break;case"hostname":n[r]=e,n.port&&(e+=":"+n.port),n.host=e;break;case"host":n[r]=e,EV.test(e)?(e=e.split(":"),n.port=e.pop(),n.hostname=e.join(":")):(n.hostname=e,n.port="");break;case"protocol":n.protocol=e.toLowerCase(),n.slashes=!t;break;case"pathname":case"hash":if(e){var i=r==="pathname"?"/":"#";n[r]=e.charAt(0)!==i?i+e:e}else n[r]=e;break;case"username":case"password":n[r]=encodeURIComponent(e);break;case"auth":var o=e.indexOf(":");~o?(n.username=e.slice(0,o),n.username=encodeURIComponent(decodeURIComponent(n.username)),n.password=e.slice(o+1),n.password=encodeURIComponent(decodeURIComponent(n.password))):n.username=encodeURIComponent(decodeURIComponent(e))}for(var s=0;s<hN.length;s++){var a=hN[s];a[4]&&(n[a[1]]=n[a[1]].toLowerCase())}return n.auth=n.password?n.username+":"+n.password:n.username,n.origin=n.protocol!=="file:"&&gc(n.protocol)&&n.host?n.protocol+"//"+n.host:"null",n.href=n.toString(),n}function Ase(r){(!r||typeof r!="function")&&(r=YE.stringify);var e,t=this,n=t.host,i=t.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var o=i+(t.protocol&&t.slashes||gc(t.protocol)?"//":"");return t.username?(o+=t.username,t.password&&(o+=":"+t.password),o+="@"):t.password?(o+=":"+t.password,o+="@"):t.protocol!=="file:"&&gc(t.protocol)&&!n&&t.pathname!=="/"&&(o+="@"),(n[n.length-1]===":"||EV.test(t.hostname)&&!t.port)&&(n+=":"),o+=n+t.pathname,e=typeof t.query=="object"?r(t.query):t.query,e&&(o+=e.charAt(0)!=="?"?"?"+e:e),t.hash&&(o+=t.hash),o}vc.prototype={set:Rse,toString:Ase};vc.extractProtocol=kV;vc.location=PV;vc.trimLeft=gN;vc.qs=YE;_V.exports=vc});var vN=M((lEe,AV)=>{"use strict";var TV=Array.isArray,RV=Object.keys,Nse=Object.prototype.hasOwnProperty;AV.exports=function r(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=TV(e),i=TV(t),o,s,a;if(n&&i){if(s=e.length,s!=t.length)return!1;for(o=s;o--!==0;)if(!r(e[o],t[o]))return!1;return!0}if(n!=i)return!1;var c=e instanceof Date,l=t instanceof Date;if(c!=l)return!1;if(c&&l)return e.getTime()==t.getTime();var u=e instanceof RegExp,p=t instanceof RegExp;if(u!=p)return!1;if(u&&p)return e.toString()==t.toString();var m=RV(e);if(s=m.length,s!==RV(t).length)return!1;for(o=s;o--!==0;)if(!Nse.call(t,m[o]))return!1;for(o=s;o--!==0;)if(a=m[o],!r(e[a],t[a]))return!1;return!0}return e!==e&&t!==t}});var XV=M(Sc=>{"use strict";Object.defineProperty(Sc,"__esModule",{value:!0});Sc.EventEmitter=Sc.once=Sc.toPromise=void 0;function iae(r,e){return e?e.aborted?Promise.resolve(void 0):new Promise(t=>{let n=(0,Sc.once)(r,o=>{e.removeEventListener("abort",i),t(o)}),i=()=>{n.dispose(),e.removeEventListener("abort",i),t(void 0)};e.addEventListener("abort",i)}):new Promise(t=>(0,Sc.once)(r,t))}Sc.toPromise=iae;var oae=(r,e)=>{let t=r(n=>{e(n),t.dispose()});return t};Sc.once=oae;var wN=class{constructor(){this.event=(e,t,n)=>{let i=this.add(t?e.bind(t):e);return n?.push(i),i}}get size(){return this.listeners?typeof this.listeners=="function"?1:this.listeners.length:0}fire(e){if(this.listeners)if(typeof this.listeners=="function")this.listeners(e);else for(let t of this.listeners)t(e)}dispose(){this.listeners=void 0}add(e){return this.listeners?typeof this.listeners=="function"?this.listeners=[this.listeners,e]:this.listeners.push(e):this.listeners=e,{dispose:()=>this.rm(e)}}rm(e){if(!this.listeners)return;if(typeof this.listeners=="function"){this.listeners===e&&(this.listeners=void 0);return}let t=this.listeners.indexOf(e);t!==-1&&(this.listeners.length===2?this.listeners=t===0?this.listeners[1]:this.listeners[0]:this.listeners=this.listeners.slice(0,t).concat(this.listeners.slice(t+1)))}};Sc.EventEmitter=wN});var LN=M(Ip=>{"use strict";Object.defineProperty(Ip,"__esModule",{value:!0});Ip.TargetPopulation=Ip.Filters=Ip.VSCodeFilterProvider=void 0;var FP=require("vscode"),FN=class r{constructor(e,t,n){this.extensionName=e,this.extensionVersion=t,this.targetPopulation=n}static trimVersionSuffix(e){let t=/\-[a-zA-Z0-9]+$/;return e.split(t)[0]}getFilterValue(e){switch(e){case Ac.ApplicationVersion:return r.trimVersionSuffix(FP.version);case Ac.Build:return FP.env.appName;case Ac.ClientId:return FP.env.machineId;case Ac.ExtensionName:return this.extensionName;case Ac.ExtensionVersion:return r.trimVersionSuffix(this.extensionVersion);case Ac.Language:return FP.env.language;case Ac.TargetPopulation:return this.targetPopulation;default:return""}}getFilters(){let e=new Map,t=Object.values(Ac);for(let n of t)e.set(n,this.getFilterValue(n));return e}};Ip.VSCodeFilterProvider=FN;var Ac;(function(r){r.Market="X-MSEdge-Market",r.CorpNet="X-FD-Corpnet",r.ApplicationVersion="X-VSCode-AppVersion",r.Build="X-VSCode-Build",r.ClientId="X-MSEdge-ClientId",r.ExtensionName="X-VSCode-ExtensionName",r.ExtensionVersion="X-VSCode-ExtensionVersion",r.Language="X-VSCode-Language",r.TargetPopulation="X-VSCode-TargetPopulation"})(Ac||(Ip.Filters=Ac={}));var U9;(function(r){r.Team="team",r.Internal="internal",r.Insiders="insider",r.Public="public"})(U9||(Ip.TargetPopulation=U9={}))});var j9=M(LP=>{"use strict";Object.defineProperty(LP,"__esModule",{value:!0});LP.BaseFeatureProvider=void 0;var UN=class{constructor(e){this.telemetry=e,this.isFetching=!1}async getFeatures(){if(this.isFetching&&this.fetchPromise)return this.fetchPromise;this.fetchPromise=this.fetch();let e=await this.fetchPromise;return this.isFetching=!1,this.fetchPromise=void 0,e}};LP.BaseFeatureProvider=UN});var W9=M(UP=>{"use strict";Object.defineProperty(UP,"__esModule",{value:!0});UP.FilteredFeatureProvider=void 0;var vae=j9(),jN=class extends vae.BaseFeatureProvider{constructor(e,t){super(e),this.telemetry=e,this.filterProviders=t,this.cachedTelemetryEvents=[]}getFilters(){let e=new Map;for(let t of this.filterProviders){let n=t.getFilters();for(let i of n.keys()){let o=n.get(i);e.set(i,o)}}return e}PostEventToTelemetry(e){if(this.cachedTelemetryEvents.includes(e))return;let t=JSON.stringify(e);this.telemetry.postEvent("report-headers",new Map([["ABExp.headers",t]])),this.cachedTelemetryEvents.push(e)}};UP.FilteredFeatureProvider=jN});var V9=M(Sp=>{"use strict";Object.defineProperty(Sp,"__esModule",{value:!0});Sp.TasApiFeatureProvider=Sp.TASAPI_FETCHERROR_EVENTNAME=void 0;var yae=W9();Sp.TASAPI_FETCHERROR_EVENTNAME="call-tas-error";var WN="ErrorType",VN=class extends yae.FilteredFeatureProvider{constructor(e,t,n){super(t,n),this.httpClient=e,this.telemetry=t,this.filterProviders=n}async fetch(){let e=this.getFilters(),t={};for(let a of e.keys()){let c=e.get(a);t[a]=c}let n;try{n=await this.httpClient.get({headers:t})}catch(a){let c=a,l=new Map;c.response?l.set(WN,"ServerError"):c.request?l.set(WN,"NoResponse"):l.set(WN,"GenericError"),this.telemetry.postEvent(Sp.TASAPI_FETCHERROR_EVENTNAME,l)}if(!n)throw Error(Sp.TASAPI_FETCHERROR_EVENTNAME);e.keys.length>0&&this.PostEventToTelemetry(t);let i=n.data,o=i.Configs,s=[];for(let a of o)if(a.Parameters)for(let c of Object.keys(a.Parameters)){let l=c+(a.Parameters[c]?"":"cf");s.includes(l)||s.push(l)}return{features:s,assignmentContext:i.AssignmentContext,configs:o}}};Sp.TasApiFeatureProvider=VN});var J9=M((GTe,q9)=>{var B9=require("stream").Stream,bae=require("util");q9.exports=ha;function ha(){this.source=null,this.dataSize=0,this.maxDataSize=1024*1024,this.pauseStream=!0,this._maxDataSizeExceeded=!1,this._released=!1,this._bufferedEvents=[]}bae.inherits(ha,B9);ha.create=function(r,e){var t=new this;e=e||{};for(var n in e)t[n]=e[n];t.source=r;var i=r.emit;return r.emit=function(){return t._handleEmit(arguments),i.apply(r,arguments)},r.on("error",function(){}),t.pauseStream&&r.pause(),t};Object.defineProperty(ha.prototype,"readable",{configurable:!0,enumerable:!0,get:function(){return this.source.readable}});ha.prototype.setEncoding=function(){return this.source.setEncoding.apply(this.source,arguments)};ha.prototype.resume=function(){this._released||this.release(),this.source.resume()};ha.prototype.pause=function(){this.source.pause()};ha.prototype.release=function(){this._released=!0,this._bufferedEvents.forEach(function(r){this.emit.apply(this,r)}.bind(this)),this._bufferedEvents=[]};ha.prototype.pipe=function(){var r=B9.prototype.pipe.apply(this,arguments);return this.resume(),r};ha.prototype._handleEmit=function(r){if(this._released){this.emit.apply(this,r);return}r[0]==="data"&&(this.dataSize+=r[1].length,this._checkIfMaxDataSizeExceeded()),this._bufferedEvents.push(r)};ha.prototype._checkIfMaxDataSizeExceeded=function(){if(!this._maxDataSizeExceeded&&!(this.dataSize<=this.maxDataSize)){this._maxDataSizeExceeded=!0;var r="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this.emit("error",new Error(r))}}});var z9=M((zTe,G9)=>{var Iae=require("util"),H9=require("stream").Stream,$9=J9();G9.exports=bn;function bn(){this.writable=!1,this.readable=!0,this.dataSize=0,this.maxDataSize=2*1024*1024,this.pauseStreams=!0,this._released=!1,this._streams=[],this._currentStream=null,this._insideLoop=!1,this._pendingNext=!1}Iae.inherits(bn,H9);bn.create=function(r){var e=new this;r=r||{};for(var t in r)e[t]=r[t];return e};bn.isStreamLike=function(r){return typeof r!="function"&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"&&!Buffer.isBuffer(r)};bn.prototype.append=function(r){var e=bn.isStreamLike(r);if(e){if(!(r instanceof $9)){var t=$9.create(r,{maxDataSize:1/0,pauseStream:this.pauseStreams});r.on("data",this._checkDataSize.bind(this)),r=t}this._handleErrors(r),this.pauseStreams&&r.pause()}return this._streams.push(r),this};bn.prototype.pipe=function(r,e){return H9.prototype.pipe.call(this,r,e),this.resume(),r};bn.prototype._getNext=function(){if(this._currentStream=null,this._insideLoop){this._pendingNext=!0;return}this._insideLoop=!0;try{do this._pendingNext=!1,this._realGetNext();while(this._pendingNext)}finally{this._insideLoop=!1}};bn.prototype._realGetNext=function(){var r=this._streams.shift();if(typeof r>"u"){this.end();return}if(typeof r!="function"){this._pipeNext(r);return}var e=r;e(function(t){var n=bn.isStreamLike(t);n&&(t.on("data",this._checkDataSize.bind(this)),this._handleErrors(t)),this._pipeNext(t)}.bind(this))};bn.prototype._pipeNext=function(r){this._currentStream=r;var e=bn.isStreamLike(r);if(e){r.on("end",this._getNext.bind(this)),r.pipe(this,{end:!1});return}var t=r;this.write(t),this._getNext()};bn.prototype._handleErrors=function(r){var e=this;r.on("error",function(t){e._emitError(t)})};bn.prototype.write=function(r){this.emit("data",r)};bn.prototype.pause=function(){this.pauseStreams&&(this.pauseStreams&&this._currentStream&&typeof this._currentStream.pause=="function"&&this._currentStream.pause(),this.emit("pause"))};bn.prototype.resume=function(){this._released||(this._released=!0,this.writable=!0,this._getNext()),this.pauseStreams&&this._currentStream&&typeof this._currentStream.resume=="function"&&this._currentStream.resume(),this.emit("resume")};bn.prototype.end=function(){this._reset(),this.emit("end")};bn.prototype.destroy=function(){this._reset(),this.emit("close")};bn.prototype._reset=function(){this.writable=!1,this._streams=[],this._currentStream=null};bn.prototype._checkDataSize=function(){if(this._updateDataSize(),!(this.dataSize<=this.maxDataSize)){var r="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this._emitError(new Error(r))}};bn.prototype._updateDataSize=function(){this.dataSize=0;var r=this;this._streams.forEach(function(e){e.dataSize&&(r.dataSize+=e.dataSize)}),this._currentStream&&this._currentStream.dataSize&&(this.dataSize+=this._currentStream.dataSize)};bn.prototype._emitError=function(r){this._reset(),this.emit("error",r)}});var Q9=M((QTe,Sae)=>{Sae.exports={"application/1d-interleaved-parityfec":{source:"iana"},"application/3gpdash-qoe-report+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/3gpp-ims+xml":{source:"iana",compressible:!0},"application/3gpphal+json":{source:"iana",compressible:!0},"application/3gpphalforms+json":{source:"iana",compressible:!0},"application/a2l":{source:"iana"},"application/ace+cbor":{source:"iana"},"application/activemessage":{source:"iana"},"application/activity+json":{source:"iana",compressible:!0},"application/alto-costmap+json":{source:"iana",compressible:!0},"application/alto-costmapfilter+json":{source:"iana",compressible:!0},"application/alto-directory+json":{source:"iana",compressible:!0},"application/alto-endpointcost+json":{source:"iana",compressible:!0},"application/alto-endpointcostparams+json":{source:"iana",compressible:!0},"application/alto-endpointprop+json":{source:"iana",compressible:!0},"application/alto-endpointpropparams+json":{source:"iana",compressible:!0},"application/alto-error+json":{source:"iana",compressible:!0},"application/alto-networkmap+json":{source:"iana",compressible:!0},"application/alto-networkmapfilter+json":{source:"iana",compressible:!0},"application/alto-updatestreamcontrol+json":{source:"iana",compressible:!0},"application/alto-updatestreamparams+json":{source:"iana",compressible:!0},"application/aml":{source:"iana"},"application/andrew-inset":{source:"iana",extensions:["ez"]},"application/applefile":{source:"iana"},"application/applixware":{source:"apache",extensions:["aw"]},"application/at+jwt":{source:"iana"},"application/atf":{source:"iana"},"application/atfx":{source:"iana"},"application/atom+xml":{source:"iana",compressible:!0,extensions:["atom"]},"application/atomcat+xml":{source:"iana",compressible:!0,extensions:["atomcat"]},"application/atomdeleted+xml":{source:"iana",compressible:!0,extensions:["atomdeleted"]},"application/atomicmail":{source:"iana"},"application/atomsvc+xml":{source:"iana",compressible:!0,extensions:["atomsvc"]},"application/atsc-dwd+xml":{source:"iana",compressible:!0,extensions:["dwd"]},"application/atsc-dynamic-event-message":{source:"iana"},"application/atsc-held+xml":{source:"iana",compressible:!0,extensions:["held"]},"application/atsc-rdt+json":{source:"iana",compressible:!0},"application/atsc-rsat+xml":{source:"iana",compressible:!0,extensions:["rsat"]},"application/atxml":{source:"iana"},"application/auth-policy+xml":{source:"iana",compressible:!0},"application/bacnet-xdd+zip":{source:"iana",compressible:!1},"application/batch-smtp":{source:"iana"},"application/bdoc":{compressible:!1,extensions:["bdoc"]},"application/beep+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/calendar+json":{source:"iana",compressible:!0},"application/calendar+xml":{source:"iana",compressible:!0,extensions:["xcs"]},"application/call-completion":{source:"iana"},"application/cals-1840":{source:"iana"},"application/captive+json":{source:"iana",compressible:!0},"application/cbor":{source:"iana"},"application/cbor-seq":{source:"iana"},"application/cccex":{source:"iana"},"application/ccmp+xml":{source:"iana",compressible:!0},"application/ccxml+xml":{source:"iana",compressible:!0,extensions:["ccxml"]},"application/cdfx+xml":{source:"iana",compressible:!0,extensions:["cdfx"]},"application/cdmi-capability":{source:"iana",extensions:["cdmia"]},"application/cdmi-container":{source:"iana",extensions:["cdmic"]},"application/cdmi-domain":{source:"iana",extensions:["cdmid"]},"application/cdmi-object":{source:"iana",extensions:["cdmio"]},"application/cdmi-queue":{source:"iana",extensions:["cdmiq"]},"application/cdni":{source:"iana"},"application/cea":{source:"iana"},"application/cea-2018+xml":{source:"iana",compressible:!0},"application/cellml+xml":{source:"iana",compressible:!0},"application/cfw":{source:"iana"},"application/city+json":{source:"iana",compressible:!0},"application/clr":{source:"iana"},"application/clue+xml":{source:"iana",compressible:!0},"application/clue_info+xml":{source:"iana",compressible:!0},"application/cms":{source:"iana"},"application/cnrp+xml":{source:"iana",compressible:!0},"application/coap-group+json":{source:"iana",compressible:!0},"application/coap-payload":{source:"iana"},"application/commonground":{source:"iana"},"application/conference-info+xml":{source:"iana",compressible:!0},"application/cose":{source:"iana"},"application/cose-key":{source:"iana"},"application/cose-key-set":{source:"iana"},"application/cpl+xml":{source:"iana",compressible:!0,extensions:["cpl"]},"application/csrattrs":{source:"iana"},"application/csta+xml":{source:"iana",compressible:!0},"application/cstadata+xml":{source:"iana",compressible:!0},"application/csvm+json":{source:"iana",compressible:!0},"application/cu-seeme":{source:"apache",extensions:["cu"]},"application/cwt":{source:"iana"},"application/cybercash":{source:"iana"},"application/dart":{compressible:!0},"application/dash+xml":{source:"iana",compressible:!0,extensions:["mpd"]},"application/dash-patch+xml":{source:"iana",compressible:!0,extensions:["mpp"]},"application/dashdelta":{source:"iana"},"application/davmount+xml":{source:"iana",compressible:!0,extensions:["davmount"]},"application/dca-rft":{source:"iana"},"application/dcd":{source:"iana"},"application/dec-dx":{source:"iana"},"application/dialog-info+xml":{source:"iana",compressible:!0},"application/dicom":{source:"iana"},"application/dicom+json":{source:"iana",compressible:!0},"application/dicom+xml":{source:"iana",compressible:!0},"application/dii":{source:"iana"},"application/dit":{source:"iana"},"application/dns":{source:"iana"},"application/dns+json":{source:"iana",compressible:!0},"application/dns-message":{source:"iana"},"application/docbook+xml":{source:"apache",compressible:!0,extensions:["dbk"]},"application/dots+cbor":{source:"iana"},"application/dskpp+xml":{source:"iana",compressible:!0},"application/dssc+der":{source:"iana",extensions:["dssc"]},"application/dssc+xml":{source:"iana",compressible:!0,extensions:["xdssc"]},"application/dvcs":{source:"iana"},"application/ecmascript":{source:"iana",compressible:!0,extensions:["es","ecma"]},"application/edi-consent":{source:"iana"},"application/edi-x12":{source:"iana",compressible:!1},"application/edifact":{source:"iana",compressible:!1},"application/efi":{source:"iana"},"application/elm+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/elm+xml":{source:"iana",compressible:!0},"application/emergencycalldata.cap+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/emergencycalldata.comment+xml":{source:"iana",compressible:!0},"application/emergencycalldata.control+xml":{source:"iana",compressible:!0},"application/emergencycalldata.deviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.ecall.msd":{source:"iana"},"application/emergencycalldata.providerinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.serviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.subscriberinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.veds+xml":{source:"iana",compressible:!0},"application/emma+xml":{source:"iana",compressible:!0,extensions:["emma"]},"application/emotionml+xml":{source:"iana",compressible:!0,extensions:["emotionml"]},"application/encaprtp":{source:"iana"},"application/epp+xml":{source:"iana",compressible:!0},"application/epub+zip":{source:"iana",compressible:!1,extensions:["epub"]},"application/eshop":{source:"iana"},"application/exi":{source:"iana",extensions:["exi"]},"application/expect-ct-report+json":{source:"iana",compressible:!0},"application/express":{source:"iana",extensions:["exp"]},"application/fastinfoset":{source:"iana"},"application/fastsoap":{source:"iana"},"application/fdt+xml":{source:"iana",compressible:!0,extensions:["fdt"]},"application/fhir+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/fhir+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/fido.trusted-apps+json":{compressible:!0},"application/fits":{source:"iana"},"application/flexfec":{source:"iana"},"application/font-sfnt":{source:"iana"},"application/font-tdpfr":{source:"iana",extensions:["pfr"]},"application/font-woff":{source:"iana",compressible:!1},"application/framework-attributes+xml":{source:"iana",compressible:!0},"application/geo+json":{source:"iana",compressible:!0,extensions:["geojson"]},"application/geo+json-seq":{source:"iana"},"application/geopackage+sqlite3":{source:"iana"},"application/geoxacml+xml":{source:"iana",compressible:!0},"application/gltf-buffer":{source:"iana"},"application/gml+xml":{source:"iana",compressible:!0,extensions:["gml"]},"application/gpx+xml":{source:"apache",compressible:!0,extensions:["gpx"]},"application/gxf":{source:"apache",extensions:["gxf"]},"application/gzip":{source:"iana",compressible:!1,extensions:["gz"]},"application/h224":{source:"iana"},"application/held+xml":{source:"iana",compressible:!0},"application/hjson":{extensions:["hjson"]},"application/http":{source:"iana"},"application/hyperstudio":{source:"iana",extensions:["stk"]},"application/ibe-key-request+xml":{source:"iana",compressible:!0},"application/ibe-pkg-reply+xml":{source:"iana",compressible:!0},"application/ibe-pp-data":{source:"iana"},"application/iges":{source:"iana"},"application/im-iscomposing+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/index":{source:"iana"},"application/index.cmd":{source:"iana"},"application/index.obj":{source:"iana"},"application/index.response":{source:"iana"},"application/index.vnd":{source:"iana"},"application/inkml+xml":{source:"iana",compressible:!0,extensions:["ink","inkml"]},"application/iotp":{source:"iana"},"application/ipfix":{source:"iana",extensions:["ipfix"]},"application/ipp":{source:"iana"},"application/isup":{source:"iana"},"application/its+xml":{source:"iana",compressible:!0,extensions:["its"]},"application/java-archive":{source:"apache",compressible:!1,extensions:["jar","war","ear"]},"application/java-serialized-object":{source:"apache",compressible:!1,extensions:["ser"]},"application/java-vm":{source:"apache",compressible:!1,extensions:["class"]},"application/javascript":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["js","mjs"]},"application/jf2feed+json":{source:"iana",compressible:!0},"application/jose":{source:"iana"},"application/jose+json":{source:"iana",compressible:!0},"application/jrd+json":{source:"iana",compressible:!0},"application/jscalendar+json":{source:"iana",compressible:!0},"application/json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["json","map"]},"application/json-patch+json":{source:"iana",compressible:!0},"application/json-seq":{source:"iana"},"application/json5":{extensions:["json5"]},"application/jsonml+json":{source:"apache",compressible:!0,extensions:["jsonml"]},"application/jwk+json":{source:"iana",compressible:!0},"application/jwk-set+json":{source:"iana",compressible:!0},"application/jwt":{source:"iana"},"application/kpml-request+xml":{source:"iana",compressible:!0},"application/kpml-response+xml":{source:"iana",compressible:!0},"application/ld+json":{source:"iana",compressible:!0,extensions:["jsonld"]},"application/lgr+xml":{source:"iana",compressible:!0,extensions:["lgr"]},"application/link-format":{source:"iana"},"application/load-control+xml":{source:"iana",compressible:!0},"application/lost+xml":{source:"iana",compressible:!0,extensions:["lostxml"]},"application/lostsync+xml":{source:"iana",compressible:!0},"application/lpf+zip":{source:"iana",compressible:!1},"application/lxf":{source:"iana"},"application/mac-binhex40":{source:"iana",extensions:["hqx"]},"application/mac-compactpro":{source:"apache",extensions:["cpt"]},"application/macwriteii":{source:"iana"},"application/mads+xml":{source:"iana",compressible:!0,extensions:["mads"]},"application/manifest+json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["webmanifest"]},"application/marc":{source:"iana",extensions:["mrc"]},"application/marcxml+xml":{source:"iana",compressible:!0,extensions:["mrcx"]},"application/mathematica":{source:"iana",extensions:["ma","nb","mb"]},"application/mathml+xml":{source:"iana",compressible:!0,extensions:["mathml"]},"application/mathml-content+xml":{source:"iana",compressible:!0},"application/mathml-presentation+xml":{source:"iana",compressible:!0},"application/mbms-associated-procedure-description+xml":{source:"iana",compressible:!0},"application/mbms-deregister+xml":{source:"iana",compressible:!0},"application/mbms-envelope+xml":{source:"iana",compressible:!0},"application/mbms-msk+xml":{source:"iana",compressible:!0},"application/mbms-msk-response+xml":{source:"iana",compressible:!0},"application/mbms-protection-description+xml":{source:"iana",compressible:!0},"application/mbms-reception-report+xml":{source:"iana",compressible:!0},"application/mbms-register+xml":{source:"iana",compressible:!0},"application/mbms-register-response+xml":{source:"iana",compressible:!0},"application/mbms-schedule+xml":{source:"iana",compressible:!0},"application/mbms-user-service-description+xml":{source:"iana",compressible:!0},"application/mbox":{source:"iana",extensions:["mbox"]},"application/media-policy-dataset+xml":{source:"iana",compressible:!0,extensions:["mpf"]},"application/media_control+xml":{source:"iana",compressible:!0},"application/mediaservercontrol+xml":{source:"iana",compressible:!0,extensions:["mscml"]},"application/merge-patch+json":{source:"iana",compressible:!0},"application/metalink+xml":{source:"apache",compressible:!0,extensions:["metalink"]},"application/metalink4+xml":{source:"iana",compressible:!0,extensions:["meta4"]},"application/mets+xml":{source:"iana",compressible:!0,extensions:["mets"]},"application/mf4":{source:"iana"},"application/mikey":{source:"iana"},"application/mipc":{source:"iana"},"application/missing-blocks+cbor-seq":{source:"iana"},"application/mmt-aei+xml":{source:"iana",compressible:!0,extensions:["maei"]},"application/mmt-usd+xml":{source:"iana",compressible:!0,extensions:["musd"]},"application/mods+xml":{source:"iana",compressible:!0,extensions:["mods"]},"application/moss-keys":{source:"iana"},"application/moss-signature":{source:"iana"},"application/mosskey-data":{source:"iana"},"application/mosskey-request":{source:"iana"},"application/mp21":{source:"iana",extensions:["m21","mp21"]},"application/mp4":{source:"iana",extensions:["mp4s","m4p"]},"application/mpeg4-generic":{source:"iana"},"application/mpeg4-iod":{source:"iana"},"application/mpeg4-iod-xmt":{source:"iana"},"application/mrb-consumer+xml":{source:"iana",compressible:!0},"application/mrb-publish+xml":{source:"iana",compressible:!0},"application/msc-ivr+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msc-mixer+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msword":{source:"iana",compressible:!1,extensions:["doc","dot"]},"application/mud+json":{source:"iana",compressible:!0},"application/multipart-core":{source:"iana"},"application/mxf":{source:"iana",extensions:["mxf"]},"application/n-quads":{source:"iana",extensions:["nq"]},"application/n-triples":{source:"iana",extensions:["nt"]},"application/nasdata":{source:"iana"},"application/news-checkgroups":{source:"iana",charset:"US-ASCII"},"application/news-groupinfo":{source:"iana",charset:"US-ASCII"},"application/news-transmission":{source:"iana"},"application/nlsml+xml":{source:"iana",compressible:!0},"application/node":{source:"iana",extensions:["cjs"]},"application/nss":{source:"iana"},"application/oauth-authz-req+jwt":{source:"iana"},"application/oblivious-dns-message":{source:"iana"},"application/ocsp-request":{source:"iana"},"application/ocsp-response":{source:"iana"},"application/octet-stream":{source:"iana",compressible:!1,extensions:["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"]},"application/oda":{source:"iana",extensions:["oda"]},"application/odm+xml":{source:"iana",compressible:!0},"application/odx":{source:"iana"},"application/oebps-package+xml":{source:"iana",compressible:!0,extensions:["opf"]},"application/ogg":{source:"iana",compressible:!1,extensions:["ogx"]},"application/omdoc+xml":{source:"apache",compressible:!0,extensions:["omdoc"]},"application/onenote":{source:"apache",extensions:["onetoc","onetoc2","onetmp","onepkg"]},"application/opc-nodeset+xml":{source:"iana",compressible:!0},"application/oscore":{source:"iana"},"application/oxps":{source:"iana",extensions:["oxps"]},"application/p21":{source:"iana"},"application/p21+zip":{source:"iana",compressible:!1},"application/p2p-overlay+xml":{source:"iana",compressible:!0,extensions:["relo"]},"application/parityfec":{source:"iana"},"application/passport":{source:"iana"},"application/patch-ops-error+xml":{source:"iana",compressible:!0,extensions:["xer"]},"application/pdf":{source:"iana",compressible:!1,extensions:["pdf"]},"application/pdx":{source:"iana"},"application/pem-certificate-chain":{source:"iana"},"application/pgp-encrypted":{source:"iana",compressible:!1,extensions:["pgp"]},"application/pgp-keys":{source:"iana",extensions:["asc"]},"application/pgp-signature":{source:"iana",extensions:["asc","sig"]},"application/pics-rules":{source:"apache",extensions:["prf"]},"application/pidf+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pidf-diff+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pkcs10":{source:"iana",extensions:["p10"]},"application/pkcs12":{source:"iana"},"application/pkcs7-mime":{source:"iana",extensions:["p7m","p7c"]},"application/pkcs7-signature":{source:"iana",extensions:["p7s"]},"application/pkcs8":{source:"iana",extensions:["p8"]},"application/pkcs8-encrypted":{source:"iana"},"application/pkix-attr-cert":{source:"iana",extensions:["ac"]},"application/pkix-cert":{source:"iana",extensions:["cer"]},"application/pkix-crl":{source:"iana",extensions:["crl"]},"application/pkix-pkipath":{source:"iana",extensions:["pkipath"]},"application/pkixcmp":{source:"iana",extensions:["pki"]},"application/pls+xml":{source:"iana",compressible:!0,extensions:["pls"]},"application/poc-settings+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/postscript":{source:"iana",compressible:!0,extensions:["ai","eps","ps"]},"application/ppsp-tracker+json":{source:"iana",compressible:!0},"application/problem+json":{source:"iana",compressible:!0},"application/problem+xml":{source:"iana",compressible:!0},"application/provenance+xml":{source:"iana",compressible:!0,extensions:["provx"]},"application/prs.alvestrand.titrax-sheet":{source:"iana"},"application/prs.cww":{source:"iana",extensions:["cww"]},"application/prs.cyn":{source:"iana",charset:"7-BIT"},"application/prs.hpub+zip":{source:"iana",compressible:!1},"application/prs.nprend":{source:"iana"},"application/prs.plucker":{source:"iana"},"application/prs.rdf-xml-crypt":{source:"iana"},"application/prs.xsf+xml":{source:"iana",compressible:!0},"application/pskc+xml":{source:"iana",compressible:!0,extensions:["pskcxml"]},"application/pvd+json":{source:"iana",compressible:!0},"application/qsig":{source:"iana"},"application/raml+yaml":{compressible:!0,extensions:["raml"]},"application/raptorfec":{source:"iana"},"application/rdap+json":{source:"iana",compressible:!0},"application/rdf+xml":{source:"iana",compressible:!0,extensions:["rdf","owl"]},"application/reginfo+xml":{source:"iana",compressible:!0,extensions:["rif"]},"application/relax-ng-compact-syntax":{source:"iana",extensions:["rnc"]},"application/remote-printing":{source:"iana"},"application/reputon+json":{source:"iana",compressible:!0},"application/resource-lists+xml":{source:"iana",compressible:!0,extensions:["rl"]},"application/resource-lists-diff+xml":{source:"iana",compressible:!0,extensions:["rld"]},"application/rfc+xml":{source:"iana",compressible:!0},"application/riscos":{source:"iana"},"application/rlmi+xml":{source:"iana",compressible:!0},"application/rls-services+xml":{source:"iana",compressible:!0,extensions:["rs"]},"application/route-apd+xml":{source:"iana",compressible:!0,extensions:["rapd"]},"application/route-s-tsid+xml":{source:"iana",compressible:!0,extensions:["sls"]},"application/route-usd+xml":{source:"iana",compressible:!0,extensions:["rusd"]},"application/rpki-ghostbusters":{source:"iana",extensions:["gbr"]},"application/rpki-manifest":{source:"iana",extensions:["mft"]},"application/rpki-publication":{source:"iana"},"application/rpki-roa":{source:"iana",extensions:["roa"]},"application/rpki-updown":{source:"iana"},"application/rsd+xml":{source:"apache",compressible:!0,extensions:["rsd"]},"application/rss+xml":{source:"apache",compressible:!0,extensions:["rss"]},"application/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"application/rtploopback":{source:"iana"},"application/rtx":{source:"iana"},"application/samlassertion+xml":{source:"iana",compressible:!0},"application/samlmetadata+xml":{source:"iana",compressible:!0},"application/sarif+json":{source:"iana",compressible:!0},"application/sarif-external-properties+json":{source:"iana",compressible:!0},"application/sbe":{source:"iana"},"application/sbml+xml":{source:"iana",compressible:!0,extensions:["sbml"]},"application/scaip+xml":{source:"iana",compressible:!0},"application/scim+json":{source:"iana",compressible:!0},"application/scvp-cv-request":{source:"iana",extensions:["scq"]},"application/scvp-cv-response":{source:"iana",extensions:["scs"]},"application/scvp-vp-request":{source:"iana",extensions:["spq"]},"application/scvp-vp-response":{source:"iana",extensions:["spp"]},"application/sdp":{source:"iana",extensions:["sdp"]},"application/secevent+jwt":{source:"iana"},"application/senml+cbor":{source:"iana"},"application/senml+json":{source:"iana",compressible:!0},"application/senml+xml":{source:"iana",compressible:!0,extensions:["senmlx"]},"application/senml-etch+cbor":{source:"iana"},"application/senml-etch+json":{source:"iana",compressible:!0},"application/senml-exi":{source:"iana"},"application/sensml+cbor":{source:"iana"},"application/sensml+json":{source:"iana",compressible:!0},"application/sensml+xml":{source:"iana",compressible:!0,extensions:["sensmlx"]},"application/sensml-exi":{source:"iana"},"application/sep+xml":{source:"iana",compressible:!0},"application/sep-exi":{source:"iana"},"application/session-info":{source:"iana"},"application/set-payment":{source:"iana"},"application/set-payment-initiation":{source:"iana",extensions:["setpay"]},"application/set-registration":{source:"iana"},"application/set-registration-initiation":{source:"iana",extensions:["setreg"]},"application/sgml":{source:"iana"},"application/sgml-open-catalog":{source:"iana"},"application/shf+xml":{source:"iana",compressible:!0,extensions:["shf"]},"application/sieve":{source:"iana",extensions:["siv","sieve"]},"application/simple-filter+xml":{source:"iana",compressible:!0},"application/simple-message-summary":{source:"iana"},"application/simplesymbolcontainer":{source:"iana"},"application/sipc":{source:"iana"},"application/slate":{source:"iana"},"application/smil":{source:"iana"},"application/smil+xml":{source:"iana",compressible:!0,extensions:["smi","smil"]},"application/smpte336m":{source:"iana"},"application/soap+fastinfoset":{source:"iana"},"application/soap+xml":{source:"iana",compressible:!0},"application/sparql-query":{source:"iana",extensions:["rq"]},"application/sparql-results+xml":{source:"iana",compressible:!0,extensions:["srx"]},"application/spdx+json":{source:"iana",compressible:!0},"application/spirits-event+xml":{source:"iana",compressible:!0},"application/sql":{source:"iana"},"application/srgs":{source:"iana",extensions:["gram"]},"application/srgs+xml":{source:"iana",compressible:!0,extensions:["grxml"]},"application/sru+xml":{source:"iana",compressible:!0,extensions:["sru"]},"application/ssdl+xml":{source:"apache",compressible:!0,extensions:["ssdl"]},"application/ssml+xml":{source:"iana",compressible:!0,extensions:["ssml"]},"application/stix+json":{source:"iana",compressible:!0},"application/swid+xml":{source:"iana",compressible:!0,extensions:["swidtag"]},"application/tamp-apex-update":{source:"iana"},"application/tamp-apex-update-confirm":{source:"iana"},"application/tamp-community-update":{source:"iana"},"application/tamp-community-update-confirm":{source:"iana"},"application/tamp-error":{source:"iana"},"application/tamp-sequence-adjust":{source:"iana"},"application/tamp-sequence-adjust-confirm":{source:"iana"},"application/tamp-status-query":{source:"iana"},"application/tamp-status-response":{source:"iana"},"application/tamp-update":{source:"iana"},"application/tamp-update-confirm":{source:"iana"},"application/tar":{compressible:!0},"application/taxii+json":{source:"iana",compressible:!0},"application/td+json":{source:"iana",compressible:!0},"application/tei+xml":{source:"iana",compressible:!0,extensions:["tei","teicorpus"]},"application/tetra_isi":{source:"iana"},"application/thraud+xml":{source:"iana",compressible:!0,extensions:["tfi"]},"application/timestamp-query":{source:"iana"},"application/timestamp-reply":{source:"iana"},"application/timestamped-data":{source:"iana",extensions:["tsd"]},"application/tlsrpt+gzip":{source:"iana"},"application/tlsrpt+json":{source:"iana",compressible:!0},"application/tnauthlist":{source:"iana"},"application/token-introspection+jwt":{source:"iana"},"application/toml":{compressible:!0,extensions:["toml"]},"application/trickle-ice-sdpfrag":{source:"iana"},"application/trig":{source:"iana",extensions:["trig"]},"application/ttml+xml":{source:"iana",compressible:!0,extensions:["ttml"]},"application/tve-trigger":{source:"iana"},"application/tzif":{source:"iana"},"application/tzif-leap":{source:"iana"},"application/ubjson":{compressible:!1,extensions:["ubj"]},"application/ulpfec":{source:"iana"},"application/urc-grpsheet+xml":{source:"iana",compressible:!0},"application/urc-ressheet+xml":{source:"iana",compressible:!0,extensions:["rsheet"]},"application/urc-targetdesc+xml":{source:"iana",compressible:!0,extensions:["td"]},"application/urc-uisocketdesc+xml":{source:"iana",compressible:!0},"application/vcard+json":{source:"iana",compressible:!0},"application/vcard+xml":{source:"iana",compressible:!0},"application/vemmi":{source:"iana"},"application/vividence.scriptfile":{source:"apache"},"application/vnd.1000minds.decision-model+xml":{source:"iana",compressible:!0,extensions:["1km"]},"application/vnd.3gpp-prose+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-prose-pc3ch+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-v2x-local-service-information":{source:"iana"},"application/vnd.3gpp.5gnas":{source:"iana"},"application/vnd.3gpp.access-transfer-events+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.bsf+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gmop+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gtpc":{source:"iana"},"application/vnd.3gpp.interworking-data":{source:"iana"},"application/vnd.3gpp.lpp":{source:"iana"},"application/vnd.3gpp.mc-signalling-ear":{source:"iana"},"application/vnd.3gpp.mcdata-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-payload":{source:"iana"},"application/vnd.3gpp.mcdata-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-signalling":{source:"iana"},"application/vnd.3gpp.mcdata-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-floor-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-signed+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-init-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-transmission-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mid-call+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ngap":{source:"iana"},"application/vnd.3gpp.pfcp":{source:"iana"},"application/vnd.3gpp.pic-bw-large":{source:"iana",extensions:["plb"]},"application/vnd.3gpp.pic-bw-small":{source:"iana",extensions:["psb"]},"application/vnd.3gpp.pic-bw-var":{source:"iana",extensions:["pvb"]},"application/vnd.3gpp.s1ap":{source:"iana"},"application/vnd.3gpp.sms":{source:"iana"},"application/vnd.3gpp.sms+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-ext+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.state-and-event-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ussd+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.bcmcsinfo+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.sms":{source:"iana"},"application/vnd.3gpp2.tcap":{source:"iana",extensions:["tcap"]},"application/vnd.3lightssoftware.imagescal":{source:"iana"},"application/vnd.3m.post-it-notes":{source:"iana",extensions:["pwn"]},"application/vnd.accpac.simply.aso":{source:"iana",extensions:["aso"]},"application/vnd.accpac.simply.imp":{source:"iana",extensions:["imp"]},"application/vnd.acucobol":{source:"iana",extensions:["acu"]},"application/vnd.acucorp":{source:"iana",extensions:["atc","acutc"]},"application/vnd.adobe.air-application-installer-package+zip":{source:"apache",compressible:!1,extensions:["air"]},"application/vnd.adobe.flash.movie":{source:"iana"},"application/vnd.adobe.formscentral.fcdt":{source:"iana",extensions:["fcdt"]},"application/vnd.adobe.fxp":{source:"iana",extensions:["fxp","fxpl"]},"application/vnd.adobe.partial-upload":{source:"iana"},"application/vnd.adobe.xdp+xml":{source:"iana",compressible:!0,extensions:["xdp"]},"application/vnd.adobe.xfdf":{source:"iana",extensions:["xfdf"]},"application/vnd.aether.imp":{source:"iana"},"application/vnd.afpc.afplinedata":{source:"iana"},"application/vnd.afpc.afplinedata-pagedef":{source:"iana"},"application/vnd.afpc.cmoca-cmresource":{source:"iana"},"application/vnd.afpc.foca-charset":{source:"iana"},"application/vnd.afpc.foca-codedfont":{source:"iana"},"application/vnd.afpc.foca-codepage":{source:"iana"},"application/vnd.afpc.modca":{source:"iana"},"application/vnd.afpc.modca-cmtable":{source:"iana"},"application/vnd.afpc.modca-formdef":{source:"iana"},"application/vnd.afpc.modca-mediummap":{source:"iana"},"application/vnd.afpc.modca-objectcontainer":{source:"iana"},"application/vnd.afpc.modca-overlay":{source:"iana"},"application/vnd.afpc.modca-pagesegment":{source:"iana"},"application/vnd.age":{source:"iana",extensions:["age"]},"application/vnd.ah-barcode":{source:"iana"},"application/vnd.ahead.space":{source:"iana",extensions:["ahead"]},"application/vnd.airzip.filesecure.azf":{source:"iana",extensions:["azf"]},"application/vnd.airzip.filesecure.azs":{source:"iana",extensions:["azs"]},"application/vnd.amadeus+json":{source:"iana",compressible:!0},"application/vnd.amazon.ebook":{source:"apache",extensions:["azw"]},"application/vnd.amazon.mobi8-ebook":{source:"iana"},"application/vnd.americandynamics.acc":{source:"iana",extensions:["acc"]},"application/vnd.amiga.ami":{source:"iana",extensions:["ami"]},"application/vnd.amundsen.maze+xml":{source:"iana",compressible:!0},"application/vnd.android.ota":{source:"iana"},"application/vnd.android.package-archive":{source:"apache",compressible:!1,extensions:["apk"]},"application/vnd.anki":{source:"iana"},"application/vnd.anser-web-certificate-issue-initiation":{source:"iana",extensions:["cii"]},"application/vnd.anser-web-funds-transfer-initiation":{source:"apache",extensions:["fti"]},"application/vnd.antix.game-component":{source:"iana",extensions:["atx"]},"application/vnd.apache.arrow.file":{source:"iana"},"application/vnd.apache.arrow.stream":{source:"iana"},"application/vnd.apache.thrift.binary":{source:"iana"},"application/vnd.apache.thrift.compact":{source:"iana"},"application/vnd.apache.thrift.json":{source:"iana"},"application/vnd.api+json":{source:"iana",compressible:!0},"application/vnd.aplextor.warrp+json":{source:"iana",compressible:!0},"application/vnd.apothekende.reservation+json":{source:"iana",compressible:!0},"application/vnd.apple.installer+xml":{source:"iana",compressible:!0,extensions:["mpkg"]},"application/vnd.apple.keynote":{source:"iana",extensions:["key"]},"application/vnd.apple.mpegurl":{source:"iana",extensions:["m3u8"]},"application/vnd.apple.numbers":{source:"iana",extensions:["numbers"]},"application/vnd.apple.pages":{source:"iana",extensions:["pages"]},"application/vnd.apple.pkpass":{compressible:!1,extensions:["pkpass"]},"application/vnd.arastra.swi":{source:"iana"},"application/vnd.aristanetworks.swi":{source:"iana",extensions:["swi"]},"application/vnd.artisan+json":{source:"iana",compressible:!0},"application/vnd.artsquare":{source:"iana"},"application/vnd.astraea-software.iota":{source:"iana",extensions:["iota"]},"application/vnd.audiograph":{source:"iana",extensions:["aep"]},"application/vnd.autopackage":{source:"iana"},"application/vnd.avalon+json":{source:"iana",compressible:!0},"application/vnd.avistar+xml":{source:"iana",compressible:!0},"application/vnd.balsamiq.bmml+xml":{source:"iana",compressible:!0,extensions:["bmml"]},"application/vnd.balsamiq.bmpr":{source:"iana"},"application/vnd.banana-accounting":{source:"iana"},"application/vnd.bbf.usp.error":{source:"iana"},"application/vnd.bbf.usp.msg":{source:"iana"},"application/vnd.bbf.usp.msg+json":{source:"iana",compressible:!0},"application/vnd.bekitzur-stech+json":{source:"iana",compressible:!0},"application/vnd.bint.med-content":{source:"iana"},"application/vnd.biopax.rdf+xml":{source:"iana",compressible:!0},"application/vnd.blink-idb-value-wrapper":{source:"iana"},"application/vnd.blueice.multipass":{source:"iana",extensions:["mpm"]},"application/vnd.bluetooth.ep.oob":{source:"iana"},"application/vnd.bluetooth.le.oob":{source:"iana"},"application/vnd.bmi":{source:"iana",extensions:["bmi"]},"application/vnd.bpf":{source:"iana"},"application/vnd.bpf3":{source:"iana"},"application/vnd.businessobjects":{source:"iana",extensions:["rep"]},"application/vnd.byu.uapi+json":{source:"iana",compressible:!0},"application/vnd.cab-jscript":{source:"iana"},"application/vnd.canon-cpdl":{source:"iana"},"application/vnd.canon-lips":{source:"iana"},"application/vnd.capasystems-pg+json":{source:"iana",compressible:!0},"application/vnd.cendio.thinlinc.clientconf":{source:"iana"},"application/vnd.century-systems.tcp_stream":{source:"iana"},"application/vnd.chemdraw+xml":{source:"iana",compressible:!0,extensions:["cdxml"]},"application/vnd.chess-pgn":{source:"iana"},"application/vnd.chipnuts.karaoke-mmd":{source:"iana",extensions:["mmd"]},"application/vnd.ciedi":{source:"iana"},"application/vnd.cinderella":{source:"iana",extensions:["cdy"]},"application/vnd.cirpack.isdn-ext":{source:"iana"},"application/vnd.citationstyles.style+xml":{source:"iana",compressible:!0,extensions:["csl"]},"application/vnd.claymore":{source:"iana",extensions:["cla"]},"application/vnd.cloanto.rp9":{source:"iana",extensions:["rp9"]},"application/vnd.clonk.c4group":{source:"iana",extensions:["c4g","c4d","c4f","c4p","c4u"]},"application/vnd.cluetrust.cartomobile-config":{source:"iana",extensions:["c11amc"]},"application/vnd.cluetrust.cartomobile-config-pkg":{source:"iana",extensions:["c11amz"]},"application/vnd.coffeescript":{source:"iana"},"application/vnd.collabio.xodocuments.document":{source:"iana"},"application/vnd.collabio.xodocuments.document-template":{source:"iana"},"application/vnd.collabio.xodocuments.presentation":{source:"iana"},"application/vnd.collabio.xodocuments.presentation-template":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet-template":{source:"iana"},"application/vnd.collection+json":{source:"iana",compressible:!0},"application/vnd.collection.doc+json":{source:"iana",compressible:!0},"application/vnd.collection.next+json":{source:"iana",compressible:!0},"application/vnd.comicbook+zip":{source:"iana",compressible:!1},"application/vnd.comicbook-rar":{source:"iana"},"application/vnd.commerce-battelle":{source:"iana"},"application/vnd.commonspace":{source:"iana",extensions:["csp"]},"application/vnd.contact.cmsg":{source:"iana",extensions:["cdbcmsg"]},"application/vnd.coreos.ignition+json":{source:"iana",compressible:!0},"application/vnd.cosmocaller":{source:"iana",extensions:["cmc"]},"application/vnd.crick.clicker":{source:"iana",extensions:["clkx"]},"application/vnd.crick.clicker.keyboard":{source:"iana",extensions:["clkk"]},"application/vnd.crick.clicker.palette":{source:"iana",extensions:["clkp"]},"application/vnd.crick.clicker.template":{source:"iana",extensions:["clkt"]},"application/vnd.crick.clicker.wordbank":{source:"iana",extensions:["clkw"]},"application/vnd.criticaltools.wbs+xml":{source:"iana",compressible:!0,extensions:["wbs"]},"application/vnd.cryptii.pipe+json":{source:"iana",compressible:!0},"application/vnd.crypto-shade-file":{source:"iana"},"application/vnd.cryptomator.encrypted":{source:"iana"},"application/vnd.cryptomator.vault":{source:"iana"},"application/vnd.ctc-posml":{source:"iana",extensions:["pml"]},"application/vnd.ctct.ws+xml":{source:"iana",compressible:!0},"application/vnd.cups-pdf":{source:"iana"},"application/vnd.cups-postscript":{source:"iana"},"application/vnd.cups-ppd":{source:"iana",extensions:["ppd"]},"application/vnd.cups-raster":{source:"iana"},"application/vnd.cups-raw":{source:"iana"},"application/vnd.curl":{source:"iana"},"application/vnd.curl.car":{source:"apache",extensions:["car"]},"application/vnd.curl.pcurl":{source:"apache",extensions:["pcurl"]},"application/vnd.cyan.dean.root+xml":{source:"iana",compressible:!0},"application/vnd.cybank":{source:"iana"},"application/vnd.cyclonedx+json":{source:"iana",compressible:!0},"application/vnd.cyclonedx+xml":{source:"iana",compressible:!0},"application/vnd.d2l.coursepackage1p0+zip":{source:"iana",compressible:!1},"application/vnd.d3m-dataset":{source:"iana"},"application/vnd.d3m-problem":{source:"iana"},"application/vnd.dart":{source:"iana",compressible:!0,extensions:["dart"]},"application/vnd.data-vision.rdz":{source:"iana",extensions:["rdz"]},"application/vnd.datapackage+json":{source:"iana",compressible:!0},"application/vnd.dataresource+json":{source:"iana",compressible:!0},"application/vnd.dbf":{source:"iana",extensions:["dbf"]},"application/vnd.debian.binary-package":{source:"iana"},"application/vnd.dece.data":{source:"iana",extensions:["uvf","uvvf","uvd","uvvd"]},"application/vnd.dece.ttml+xml":{source:"iana",compressible:!0,extensions:["uvt","uvvt"]},"application/vnd.dece.unspecified":{source:"iana",extensions:["uvx","uvvx"]},"application/vnd.dece.zip":{source:"iana",extensions:["uvz","uvvz"]},"application/vnd.denovo.fcselayout-link":{source:"iana",extensions:["fe_launch"]},"application/vnd.desmume.movie":{source:"iana"},"application/vnd.dir-bi.plate-dl-nosuffix":{source:"iana"},"application/vnd.dm.delegation+xml":{source:"iana",compressible:!0},"application/vnd.dna":{source:"iana",extensions:["dna"]},"application/vnd.document+json":{source:"iana",compressible:!0},"application/vnd.dolby.mlp":{source:"apache",extensions:["mlp"]},"application/vnd.dolby.mobile.1":{source:"iana"},"application/vnd.dolby.mobile.2":{source:"iana"},"application/vnd.doremir.scorecloud-binary-document":{source:"iana"},"application/vnd.dpgraph":{source:"iana",extensions:["dpg"]},"application/vnd.dreamfactory":{source:"iana",extensions:["dfac"]},"application/vnd.drive+json":{source:"iana",compressible:!0},"application/vnd.ds-keypoint":{source:"apache",extensions:["kpxx"]},"application/vnd.dtg.local":{source:"iana"},"application/vnd.dtg.local.flash":{source:"iana"},"application/vnd.dtg.local.html":{source:"iana"},"application/vnd.dvb.ait":{source:"iana",extensions:["ait"]},"application/vnd.dvb.dvbisl+xml":{source:"iana",compressible:!0},"application/vnd.dvb.dvbj":{source:"iana"},"application/vnd.dvb.esgcontainer":{source:"iana"},"application/vnd.dvb.ipdcdftnotifaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess2":{source:"iana"},"application/vnd.dvb.ipdcesgpdd":{source:"iana"},"application/vnd.dvb.ipdcroaming":{source:"iana"},"application/vnd.dvb.iptv.alfec-base":{source:"iana"},"application/vnd.dvb.iptv.alfec-enhancement":{source:"iana"},"application/vnd.dvb.notif-aggregate-root+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-container+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-generic+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-msglist+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-request+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-response+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-init+xml":{source:"iana",compressible:!0},"application/vnd.dvb.pfr":{source:"iana"},"application/vnd.dvb.service":{source:"iana",extensions:["svc"]},"application/vnd.dxr":{source:"iana"},"application/vnd.dynageo":{source:"iana",extensions:["geo"]},"application/vnd.dzr":{source:"iana"},"application/vnd.easykaraoke.cdgdownload":{source:"iana"},"application/vnd.ecdis-update":{source:"iana"},"application/vnd.ecip.rlp":{source:"iana"},"application/vnd.eclipse.ditto+json":{source:"iana",compressible:!0},"application/vnd.ecowin.chart":{source:"iana",extensions:["mag"]},"application/vnd.ecowin.filerequest":{source:"iana"},"application/vnd.ecowin.fileupdate":{source:"iana"},"application/vnd.ecowin.series":{source:"iana"},"application/vnd.ecowin.seriesrequest":{source:"iana"},"application/vnd.ecowin.seriesupdate":{source:"iana"},"application/vnd.efi.img":{source:"iana"},"application/vnd.efi.iso":{source:"iana"},"application/vnd.emclient.accessrequest+xml":{source:"iana",compressible:!0},"application/vnd.enliven":{source:"iana",extensions:["nml"]},"application/vnd.enphase.envoy":{source:"iana"},"application/vnd.eprints.data+xml":{source:"iana",compressible:!0},"application/vnd.epson.esf":{source:"iana",extensions:["esf"]},"application/vnd.epson.msf":{source:"iana",extensions:["msf"]},"application/vnd.epson.quickanime":{source:"iana",extensions:["qam"]},"application/vnd.epson.salt":{source:"iana",extensions:["slt"]},"application/vnd.epson.ssf":{source:"iana",extensions:["ssf"]},"application/vnd.ericsson.quickcall":{source:"iana"},"application/vnd.espass-espass+zip":{source:"iana",compressible:!1},"application/vnd.eszigno3+xml":{source:"iana",compressible:!0,extensions:["es3","et3"]},"application/vnd.etsi.aoc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.asic-e+zip":{source:"iana",compressible:!1},"application/vnd.etsi.asic-s+zip":{source:"iana",compressible:!1},"application/vnd.etsi.cug+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvcommand+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-bc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-cod+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-npvr+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvservice+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsync+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvueprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mcid+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mheg5":{source:"iana"},"application/vnd.etsi.overload-control-policy-dataset+xml":{source:"iana",compressible:!0},"application/vnd.etsi.pstn+xml":{source:"iana",compressible:!0},"application/vnd.etsi.sci+xml":{source:"iana",compressible:!0},"application/vnd.etsi.simservs+xml":{source:"iana",compressible:!0},"application/vnd.etsi.timestamp-token":{source:"iana"},"application/vnd.etsi.tsl+xml":{source:"iana",compressible:!0},"application/vnd.etsi.tsl.der":{source:"iana"},"application/vnd.eu.kasparian.car+json":{source:"iana",compressible:!0},"application/vnd.eudora.data":{source:"iana"},"application/vnd.evolv.ecig.profile":{source:"iana"},"application/vnd.evolv.ecig.settings":{source:"iana"},"application/vnd.evolv.ecig.theme":{source:"iana"},"application/vnd.exstream-empower+zip":{source:"iana",compressible:!1},"application/vnd.exstream-package":{source:"iana"},"application/vnd.ezpix-album":{source:"iana",extensions:["ez2"]},"application/vnd.ezpix-package":{source:"iana",extensions:["ez3"]},"application/vnd.f-secure.mobile":{source:"iana"},"application/vnd.familysearch.gedcom+zip":{source:"iana",compressible:!1},"application/vnd.fastcopy-disk-image":{source:"iana"},"application/vnd.fdf":{source:"iana",extensions:["fdf"]},"application/vnd.fdsn.mseed":{source:"iana",extensions:["mseed"]},"application/vnd.fdsn.seed":{source:"iana",extensions:["seed","dataless"]},"application/vnd.ffsns":{source:"iana"},"application/vnd.ficlab.flb+zip":{source:"iana",compressible:!1},"application/vnd.filmit.zfc":{source:"iana"},"application/vnd.fints":{source:"iana"},"application/vnd.firemonkeys.cloudcell":{source:"iana"},"application/vnd.flographit":{source:"iana",extensions:["gph"]},"application/vnd.fluxtime.clip":{source:"iana",extensions:["ftc"]},"application/vnd.font-fontforge-sfd":{source:"iana"},"application/vnd.framemaker":{source:"iana",extensions:["fm","frame","maker","book"]},"application/vnd.frogans.fnc":{source:"iana",extensions:["fnc"]},"application/vnd.frogans.ltf":{source:"iana",extensions:["ltf"]},"application/vnd.fsc.weblaunch":{source:"iana",extensions:["fsc"]},"application/vnd.fujifilm.fb.docuworks":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.binder":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.container":{source:"iana"},"application/vnd.fujifilm.fb.jfi+xml":{source:"iana",compressible:!0},"application/vnd.fujitsu.oasys":{source:"iana",extensions:["oas"]},"application/vnd.fujitsu.oasys2":{source:"iana",extensions:["oa2"]},"application/vnd.fujitsu.oasys3":{source:"iana",extensions:["oa3"]},"application/vnd.fujitsu.oasysgp":{source:"iana",extensions:["fg5"]},"application/vnd.fujitsu.oasysprs":{source:"iana",extensions:["bh2"]},"application/vnd.fujixerox.art-ex":{source:"iana"},"application/vnd.fujixerox.art4":{source:"iana"},"application/vnd.fujixerox.ddd":{source:"iana",extensions:["ddd"]},"application/vnd.fujixerox.docuworks":{source:"iana",extensions:["xdw"]},"application/vnd.fujixerox.docuworks.binder":{source:"iana",extensions:["xbd"]},"application/vnd.fujixerox.docuworks.container":{source:"iana"},"application/vnd.fujixerox.hbpl":{source:"iana"},"application/vnd.fut-misnet":{source:"iana"},"application/vnd.futoin+cbor":{source:"iana"},"application/vnd.futoin+json":{source:"iana",compressible:!0},"application/vnd.fuzzysheet":{source:"iana",extensions:["fzs"]},"application/vnd.genomatix.tuxedo":{source:"iana",extensions:["txd"]},"application/vnd.gentics.grd+json":{source:"iana",compressible:!0},"application/vnd.geo+json":{source:"iana",compressible:!0},"application/vnd.geocube+xml":{source:"iana",compressible:!0},"application/vnd.geogebra.file":{source:"iana",extensions:["ggb"]},"application/vnd.geogebra.slides":{source:"iana"},"application/vnd.geogebra.tool":{source:"iana",extensions:["ggt"]},"application/vnd.geometry-explorer":{source:"iana",extensions:["gex","gre"]},"application/vnd.geonext":{source:"iana",extensions:["gxt"]},"application/vnd.geoplan":{source:"iana",extensions:["g2w"]},"application/vnd.geospace":{source:"iana",extensions:["g3w"]},"application/vnd.gerber":{source:"iana"},"application/vnd.globalplatform.card-content-mgt":{source:"iana"},"application/vnd.globalplatform.card-content-mgt-response":{source:"iana"},"application/vnd.gmx":{source:"iana",extensions:["gmx"]},"application/vnd.google-apps.document":{compressible:!1,extensions:["gdoc"]},"application/vnd.google-apps.presentation":{compressible:!1,extensions:["gslides"]},"application/vnd.google-apps.spreadsheet":{compressible:!1,extensions:["gsheet"]},"application/vnd.google-earth.kml+xml":{source:"iana",compressible:!0,extensions:["kml"]},"application/vnd.google-earth.kmz":{source:"iana",compressible:!1,extensions:["kmz"]},"application/vnd.gov.sk.e-form+xml":{source:"iana",compressible:!0},"application/vnd.gov.sk.e-form+zip":{source:"iana",compressible:!1},"application/vnd.gov.sk.xmldatacontainer+xml":{source:"iana",compressible:!0},"application/vnd.grafeq":{source:"iana",extensions:["gqf","gqs"]},"application/vnd.gridmp":{source:"iana"},"application/vnd.groove-account":{source:"iana",extensions:["gac"]},"application/vnd.groove-help":{source:"iana",extensions:["ghf"]},"application/vnd.groove-identity-message":{source:"iana",extensions:["gim"]},"application/vnd.groove-injector":{source:"iana",extensions:["grv"]},"application/vnd.groove-tool-message":{source:"iana",extensions:["gtm"]},"application/vnd.groove-tool-template":{source:"iana",extensions:["tpl"]},"application/vnd.groove-vcard":{source:"iana",extensions:["vcg"]},"application/vnd.hal+json":{source:"iana",compressible:!0},"application/vnd.hal+xml":{source:"iana",compressible:!0,extensions:["hal"]},"application/vnd.handheld-entertainment+xml":{source:"iana",compressible:!0,extensions:["zmm"]},"application/vnd.hbci":{source:"iana",extensions:["hbci"]},"application/vnd.hc+json":{source:"iana",compressible:!0},"application/vnd.hcl-bireports":{source:"iana"},"application/vnd.hdt":{source:"iana"},"application/vnd.heroku+json":{source:"iana",compressible:!0},"application/vnd.hhe.lesson-player":{source:"iana",extensions:["les"]},"application/vnd.hl7cda+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hl7v2+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hp-hpgl":{source:"iana",extensions:["hpgl"]},"application/vnd.hp-hpid":{source:"iana",extensions:["hpid"]},"application/vnd.hp-hps":{source:"iana",extensions:["hps"]},"application/vnd.hp-jlyt":{source:"iana",extensions:["jlt"]},"application/vnd.hp-pcl":{source:"iana",extensions:["pcl"]},"application/vnd.hp-pclxl":{source:"iana",extensions:["pclxl"]},"application/vnd.httphone":{source:"iana"},"application/vnd.hydrostatix.sof-data":{source:"iana",extensions:["sfd-hdstx"]},"application/vnd.hyper+json":{source:"iana",compressible:!0},"application/vnd.hyper-item+json":{source:"iana",compressible:!0},"application/vnd.hyperdrive+json":{source:"iana",compressible:!0},"application/vnd.hzn-3d-crossword":{source:"iana"},"application/vnd.ibm.afplinedata":{source:"iana"},"application/vnd.ibm.electronic-media":{source:"iana"},"application/vnd.ibm.minipay":{source:"iana",extensions:["mpy"]},"application/vnd.ibm.modcap":{source:"iana",extensions:["afp","listafp","list3820"]},"application/vnd.ibm.rights-management":{source:"iana",extensions:["irm"]},"application/vnd.ibm.secure-container":{source:"iana",extensions:["sc"]},"application/vnd.iccprofile":{source:"iana",extensions:["icc","icm"]},"application/vnd.ieee.1905":{source:"iana"},"application/vnd.igloader":{source:"iana",extensions:["igl"]},"application/vnd.imagemeter.folder+zip":{source:"iana",compressible:!1},"application/vnd.imagemeter.image+zip":{source:"iana",compressible:!1},"application/vnd.immervision-ivp":{source:"iana",extensions:["ivp"]},"application/vnd.immervision-ivu":{source:"iana",extensions:["ivu"]},"application/vnd.ims.imsccv1p1":{source:"iana"},"application/vnd.ims.imsccv1p2":{source:"iana"},"application/vnd.ims.imsccv1p3":{source:"iana"},"application/vnd.ims.lis.v2.result+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolconsumerprofile+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy.id+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings.simple+json":{source:"iana",compressible:!0},"application/vnd.informedcontrol.rms+xml":{source:"iana",compressible:!0},"application/vnd.informix-visionary":{source:"iana"},"application/vnd.infotech.project":{source:"iana"},"application/vnd.infotech.project+xml":{source:"iana",compressible:!0},"application/vnd.innopath.wamp.notification":{source:"iana"},"application/vnd.insors.igm":{source:"iana",extensions:["igm"]},"application/vnd.intercon.formnet":{source:"iana",extensions:["xpw","xpx"]},"application/vnd.intergeo":{source:"iana",extensions:["i2g"]},"application/vnd.intertrust.digibox":{source:"iana"},"application/vnd.intertrust.nncp":{source:"iana"},"application/vnd.intu.qbo":{source:"iana",extensions:["qbo"]},"application/vnd.intu.qfx":{source:"iana",extensions:["qfx"]},"application/vnd.iptc.g2.catalogitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.conceptitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.knowledgeitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsmessage+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.packageitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.planningitem+xml":{source:"iana",compressible:!0},"application/vnd.ipunplugged.rcprofile":{source:"iana",extensions:["rcprofile"]},"application/vnd.irepository.package+xml":{source:"iana",compressible:!0,extensions:["irp"]},"application/vnd.is-xpr":{source:"iana",extensions:["xpr"]},"application/vnd.isac.fcs":{source:"iana",extensions:["fcs"]},"application/vnd.iso11783-10+zip":{source:"iana",compressible:!1},"application/vnd.jam":{source:"iana",extensions:["jam"]},"application/vnd.japannet-directory-service":{source:"iana"},"application/vnd.japannet-jpnstore-wakeup":{source:"iana"},"application/vnd.japannet-payment-wakeup":{source:"iana"},"application/vnd.japannet-registration":{source:"iana"},"application/vnd.japannet-registration-wakeup":{source:"iana"},"application/vnd.japannet-setstore-wakeup":{source:"iana"},"application/vnd.japannet-verification":{source:"iana"},"application/vnd.japannet-verification-wakeup":{source:"iana"},"application/vnd.jcp.javame.midlet-rms":{source:"iana",extensions:["rms"]},"application/vnd.jisp":{source:"iana",extensions:["jisp"]},"application/vnd.joost.joda-archive":{source:"iana",extensions:["joda"]},"application/vnd.jsk.isdn-ngn":{source:"iana"},"application/vnd.kahootz":{source:"iana",extensions:["ktz","ktr"]},"application/vnd.kde.karbon":{source:"iana",extensions:["karbon"]},"application/vnd.kde.kchart":{source:"iana",extensions:["chrt"]},"application/vnd.kde.kformula":{source:"iana",extensions:["kfo"]},"application/vnd.kde.kivio":{source:"iana",extensions:["flw"]},"application/vnd.kde.kontour":{source:"iana",extensions:["kon"]},"application/vnd.kde.kpresenter":{source:"iana",extensions:["kpr","kpt"]},"application/vnd.kde.kspread":{source:"iana",extensions:["ksp"]},"application/vnd.kde.kword":{source:"iana",extensions:["kwd","kwt"]},"application/vnd.kenameaapp":{source:"iana",extensions:["htke"]},"application/vnd.kidspiration":{source:"iana",extensions:["kia"]},"application/vnd.kinar":{source:"iana",extensions:["kne","knp"]},"application/vnd.koan":{source:"iana",extensions:["skp","skd","skt","skm"]},"application/vnd.kodak-descriptor":{source:"iana",extensions:["sse"]},"application/vnd.las":{source:"iana"},"application/vnd.las.las+json":{source:"iana",compressible:!0},"application/vnd.las.las+xml":{source:"iana",compressible:!0,extensions:["lasxml"]},"application/vnd.laszip":{source:"iana"},"application/vnd.leap+json":{source:"iana",compressible:!0},"application/vnd.liberty-request+xml":{source:"iana",compressible:!0},"application/vnd.llamagraphics.life-balance.desktop":{source:"iana",extensions:["lbd"]},"application/vnd.llamagraphics.life-balance.exchange+xml":{source:"iana",compressible:!0,extensions:["lbe"]},"application/vnd.logipipe.circuit+zip":{source:"iana",compressible:!1},"application/vnd.loom":{source:"iana"},"application/vnd.lotus-1-2-3":{source:"iana",extensions:["123"]},"application/vnd.lotus-approach":{source:"iana",extensions:["apr"]},"application/vnd.lotus-freelance":{source:"iana",extensions:["pre"]},"application/vnd.lotus-notes":{source:"iana",extensions:["nsf"]},"application/vnd.lotus-organizer":{source:"iana",extensions:["org"]},"application/vnd.lotus-screencam":{source:"iana",extensions:["scm"]},"application/vnd.lotus-wordpro":{source:"iana",extensions:["lwp"]},"application/vnd.macports.portpkg":{source:"iana",extensions:["portpkg"]},"application/vnd.mapbox-vector-tile":{source:"iana",extensions:["mvt"]},"application/vnd.marlin.drm.actiontoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.conftoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.license+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.mdcf":{source:"iana"},"application/vnd.mason+json":{source:"iana",compressible:!0},"application/vnd.maxar.archive.3tz+zip":{source:"iana",compressible:!1},"application/vnd.maxmind.maxmind-db":{source:"iana"},"application/vnd.mcd":{source:"iana",extensions:["mcd"]},"application/vnd.medcalcdata":{source:"iana",extensions:["mc1"]},"application/vnd.mediastation.cdkey":{source:"iana",extensions:["cdkey"]},"application/vnd.meridian-slingshot":{source:"iana"},"application/vnd.mfer":{source:"iana",extensions:["mwf"]},"application/vnd.mfmp":{source:"iana",extensions:["mfm"]},"application/vnd.micro+json":{source:"iana",compressible:!0},"application/vnd.micrografx.flo":{source:"iana",extensions:["flo"]},"application/vnd.micrografx.igx":{source:"iana",extensions:["igx"]},"application/vnd.microsoft.portable-executable":{source:"iana"},"application/vnd.microsoft.windows.thumbnail-cache":{source:"iana"},"application/vnd.miele+json":{source:"iana",compressible:!0},"application/vnd.mif":{source:"iana",extensions:["mif"]},"application/vnd.minisoft-hp3000-save":{source:"iana"},"application/vnd.mitsubishi.misty-guard.trustweb":{source:"iana"},"application/vnd.mobius.daf":{source:"iana",extensions:["daf"]},"application/vnd.mobius.dis":{source:"iana",extensions:["dis"]},"application/vnd.mobius.mbk":{source:"iana",extensions:["mbk"]},"application/vnd.mobius.mqy":{source:"iana",extensions:["mqy"]},"application/vnd.mobius.msl":{source:"iana",extensions:["msl"]},"application/vnd.mobius.plc":{source:"iana",extensions:["plc"]},"application/vnd.mobius.txf":{source:"iana",extensions:["txf"]},"application/vnd.mophun.application":{source:"iana",extensions:["mpn"]},"application/vnd.mophun.certificate":{source:"iana",extensions:["mpc"]},"application/vnd.motorola.flexsuite":{source:"iana"},"application/vnd.motorola.flexsuite.adsi":{source:"iana"},"application/vnd.motorola.flexsuite.fis":{source:"iana"},"application/vnd.motorola.flexsuite.gotap":{source:"iana"},"application/vnd.motorola.flexsuite.kmr":{source:"iana"},"application/vnd.motorola.flexsuite.ttc":{source:"iana"},"application/vnd.motorola.flexsuite.wem":{source:"iana"},"application/vnd.motorola.iprm":{source:"iana"},"application/vnd.mozilla.xul+xml":{source:"iana",compressible:!0,extensions:["xul"]},"application/vnd.ms-3mfdocument":{source:"iana"},"application/vnd.ms-artgalry":{source:"iana",extensions:["cil"]},"application/vnd.ms-asf":{source:"iana"},"application/vnd.ms-cab-compressed":{source:"iana",extensions:["cab"]},"application/vnd.ms-color.iccprofile":{source:"apache"},"application/vnd.ms-excel":{source:"iana",compressible:!1,extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"application/vnd.ms-excel.addin.macroenabled.12":{source:"iana",extensions:["xlam"]},"application/vnd.ms-excel.sheet.binary.macroenabled.12":{source:"iana",extensions:["xlsb"]},"application/vnd.ms-excel.sheet.macroenabled.12":{source:"iana",extensions:["xlsm"]},"application/vnd.ms-excel.template.macroenabled.12":{source:"iana",extensions:["xltm"]},"application/vnd.ms-fontobject":{source:"iana",compressible:!0,extensions:["eot"]},"application/vnd.ms-htmlhelp":{source:"iana",extensions:["chm"]},"application/vnd.ms-ims":{source:"iana",extensions:["ims"]},"application/vnd.ms-lrm":{source:"iana",extensions:["lrm"]},"application/vnd.ms-office.activex+xml":{source:"iana",compressible:!0},"application/vnd.ms-officetheme":{source:"iana",extensions:["thmx"]},"application/vnd.ms-opentype":{source:"apache",compressible:!0},"application/vnd.ms-outlook":{compressible:!1,extensions:["msg"]},"application/vnd.ms-package.obfuscated-opentype":{source:"apache"},"application/vnd.ms-pki.seccat":{source:"apache",extensions:["cat"]},"application/vnd.ms-pki.stl":{source:"apache",extensions:["stl"]},"application/vnd.ms-playready.initiator+xml":{source:"iana",compressible:!0},"application/vnd.ms-powerpoint":{source:"iana",compressible:!1,extensions:["ppt","pps","pot"]},"application/vnd.ms-powerpoint.addin.macroenabled.12":{source:"iana",extensions:["ppam"]},"application/vnd.ms-powerpoint.presentation.macroenabled.12":{source:"iana",extensions:["pptm"]},"application/vnd.ms-powerpoint.slide.macroenabled.12":{source:"iana",extensions:["sldm"]},"application/vnd.ms-powerpoint.slideshow.macroenabled.12":{source:"iana",extensions:["ppsm"]},"application/vnd.ms-powerpoint.template.macroenabled.12":{source:"iana",extensions:["potm"]},"application/vnd.ms-printdevicecapabilities+xml":{source:"iana",compressible:!0},"application/vnd.ms-printing.printticket+xml":{source:"apache",compressible:!0},"application/vnd.ms-printschematicket+xml":{source:"iana",compressible:!0},"application/vnd.ms-project":{source:"iana",extensions:["mpp","mpt"]},"application/vnd.ms-tnef":{source:"iana"},"application/vnd.ms-windows.devicepairing":{source:"iana"},"application/vnd.ms-windows.nwprinting.oob":{source:"iana"},"application/vnd.ms-windows.printerpairing":{source:"iana"},"application/vnd.ms-windows.wsd.oob":{source:"iana"},"application/vnd.ms-wmdrm.lic-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.lic-resp":{source:"iana"},"application/vnd.ms-wmdrm.meter-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.meter-resp":{source:"iana"},"application/vnd.ms-word.document.macroenabled.12":{source:"iana",extensions:["docm"]},"application/vnd.ms-word.template.macroenabled.12":{source:"iana",extensions:["dotm"]},"application/vnd.ms-works":{source:"iana",extensions:["wps","wks","wcm","wdb"]},"application/vnd.ms-wpl":{source:"iana",extensions:["wpl"]},"application/vnd.ms-xpsdocument":{source:"iana",compressible:!1,extensions:["xps"]},"application/vnd.msa-disk-image":{source:"iana"},"application/vnd.mseq":{source:"iana",extensions:["mseq"]},"application/vnd.msign":{source:"iana"},"application/vnd.multiad.creator":{source:"iana"},"application/vnd.multiad.creator.cif":{source:"iana"},"application/vnd.music-niff":{source:"iana"},"application/vnd.musician":{source:"iana",extensions:["mus"]},"application/vnd.muvee.style":{source:"iana",extensions:["msty"]},"application/vnd.mynfc":{source:"iana",extensions:["taglet"]},"application/vnd.nacamar.ybrid+json":{source:"iana",compressible:!0},"application/vnd.ncd.control":{source:"iana"},"application/vnd.ncd.reference":{source:"iana"},"application/vnd.nearst.inv+json":{source:"iana",compressible:!0},"application/vnd.nebumind.line":{source:"iana"},"application/vnd.nervana":{source:"iana"},"application/vnd.netfpx":{source:"iana"},"application/vnd.neurolanguage.nlu":{source:"iana",extensions:["nlu"]},"application/vnd.nimn":{source:"iana"},"application/vnd.nintendo.nitro.rom":{source:"iana"},"application/vnd.nintendo.snes.rom":{source:"iana"},"application/vnd.nitf":{source:"iana",extensions:["ntf","nitf"]},"application/vnd.noblenet-directory":{source:"iana",extensions:["nnd"]},"application/vnd.noblenet-sealer":{source:"iana",extensions:["nns"]},"application/vnd.noblenet-web":{source:"iana",extensions:["nnw"]},"application/vnd.nokia.catalogs":{source:"iana"},"application/vnd.nokia.conml+wbxml":{source:"iana"},"application/vnd.nokia.conml+xml":{source:"iana",compressible:!0},"application/vnd.nokia.iptv.config+xml":{source:"iana",compressible:!0},"application/vnd.nokia.isds-radio-presets":{source:"iana"},"application/vnd.nokia.landmark+wbxml":{source:"iana"},"application/vnd.nokia.landmark+xml":{source:"iana",compressible:!0},"application/vnd.nokia.landmarkcollection+xml":{source:"iana",compressible:!0},"application/vnd.nokia.n-gage.ac+xml":{source:"iana",compressible:!0,extensions:["ac"]},"application/vnd.nokia.n-gage.data":{source:"iana",extensions:["ngdat"]},"application/vnd.nokia.n-gage.symbian.install":{source:"iana",extensions:["n-gage"]},"application/vnd.nokia.ncd":{source:"iana"},"application/vnd.nokia.pcd+wbxml":{source:"iana"},"application/vnd.nokia.pcd+xml":{source:"iana",compressible:!0},"application/vnd.nokia.radio-preset":{source:"iana",extensions:["rpst"]},"application/vnd.nokia.radio-presets":{source:"iana",extensions:["rpss"]},"application/vnd.novadigm.edm":{source:"iana",extensions:["edm"]},"application/vnd.novadigm.edx":{source:"iana",extensions:["edx"]},"application/vnd.novadigm.ext":{source:"iana",extensions:["ext"]},"application/vnd.ntt-local.content-share":{source:"iana"},"application/vnd.ntt-local.file-transfer":{source:"iana"},"application/vnd.ntt-local.ogw_remote-access":{source:"iana"},"application/vnd.ntt-local.sip-ta_remote":{source:"iana"},"application/vnd.ntt-local.sip-ta_tcp_stream":{source:"iana"},"application/vnd.oasis.opendocument.chart":{source:"iana",extensions:["odc"]},"application/vnd.oasis.opendocument.chart-template":{source:"iana",extensions:["otc"]},"application/vnd.oasis.opendocument.database":{source:"iana",extensions:["odb"]},"application/vnd.oasis.opendocument.formula":{source:"iana",extensions:["odf"]},"application/vnd.oasis.opendocument.formula-template":{source:"iana",extensions:["odft"]},"application/vnd.oasis.opendocument.graphics":{source:"iana",compressible:!1,extensions:["odg"]},"application/vnd.oasis.opendocument.graphics-template":{source:"iana",extensions:["otg"]},"application/vnd.oasis.opendocument.image":{source:"iana",extensions:["odi"]},"application/vnd.oasis.opendocument.image-template":{source:"iana",extensions:["oti"]},"application/vnd.oasis.opendocument.presentation":{source:"iana",compressible:!1,extensions:["odp"]},"application/vnd.oasis.opendocument.presentation-template":{source:"iana",extensions:["otp"]},"application/vnd.oasis.opendocument.spreadsheet":{source:"iana",compressible:!1,extensions:["ods"]},"application/vnd.oasis.opendocument.spreadsheet-template":{source:"iana",extensions:["ots"]},"application/vnd.oasis.opendocument.text":{source:"iana",compressible:!1,extensions:["odt"]},"application/vnd.oasis.opendocument.text-master":{source:"iana",extensions:["odm"]},"application/vnd.oasis.opendocument.text-template":{source:"iana",extensions:["ott"]},"application/vnd.oasis.opendocument.text-web":{source:"iana",extensions:["oth"]},"application/vnd.obn":{source:"iana"},"application/vnd.ocf+cbor":{source:"iana"},"application/vnd.oci.image.manifest.v1+json":{source:"iana",compressible:!0},"application/vnd.oftn.l10n+json":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessdownload+xml":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessstreaming+xml":{source:"iana",compressible:!0},"application/vnd.oipf.cspg-hexbinary":{source:"iana"},"application/vnd.oipf.dae.svg+xml":{source:"iana",compressible:!0},"application/vnd.oipf.dae.xhtml+xml":{source:"iana",compressible:!0},"application/vnd.oipf.mippvcontrolmessage+xml":{source:"iana",compressible:!0},"application/vnd.oipf.pae.gem":{source:"iana"},"application/vnd.oipf.spdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.oipf.spdlist+xml":{source:"iana",compressible:!0},"application/vnd.oipf.ueprofile+xml":{source:"iana",compressible:!0},"application/vnd.oipf.userprofile+xml":{source:"iana",compressible:!0},"application/vnd.olpc-sugar":{source:"iana",extensions:["xo"]},"application/vnd.oma-scws-config":{source:"iana"},"application/vnd.oma-scws-http-request":{source:"iana"},"application/vnd.oma-scws-http-response":{source:"iana"},"application/vnd.oma.bcast.associated-procedure-parameter+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.drm-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.imd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.ltkm":{source:"iana"},"application/vnd.oma.bcast.notification+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.provisioningtrigger":{source:"iana"},"application/vnd.oma.bcast.sgboot":{source:"iana"},"application/vnd.oma.bcast.sgdd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sgdu":{source:"iana"},"application/vnd.oma.bcast.simple-symbol-container":{source:"iana"},"application/vnd.oma.bcast.smartcard-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sprov+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.stkm":{source:"iana"},"application/vnd.oma.cab-address-book+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-feature-handler+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-pcc+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-subs-invite+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-user-prefs+xml":{source:"iana",compressible:!0},"application/vnd.oma.dcd":{source:"iana"},"application/vnd.oma.dcdc":{source:"iana"},"application/vnd.oma.dd2+xml":{source:"iana",compressible:!0,extensions:["dd2"]},"application/vnd.oma.drm.risd+xml":{source:"iana",compressible:!0},"application/vnd.oma.group-usage-list+xml":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+cbor":{source:"iana"},"application/vnd.oma.lwm2m+json":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+tlv":{source:"iana"},"application/vnd.oma.pal+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.detailed-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.final-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.groups+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.invocation-descriptor+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.optimized-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.push":{source:"iana"},"application/vnd.oma.scidm.messages+xml":{source:"iana",compressible:!0},"application/vnd.oma.xcap-directory+xml":{source:"iana",compressible:!0},"application/vnd.omads-email+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-file+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-folder+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omaloc-supl-init":{source:"iana"},"application/vnd.onepager":{source:"iana"},"application/vnd.onepagertamp":{source:"iana"},"application/vnd.onepagertamx":{source:"iana"},"application/vnd.onepagertat":{source:"iana"},"application/vnd.onepagertatp":{source:"iana"},"application/vnd.onepagertatx":{source:"iana"},"application/vnd.openblox.game+xml":{source:"iana",compressible:!0,extensions:["obgx"]},"application/vnd.openblox.game-binary":{source:"iana"},"application/vnd.openeye.oeb":{source:"iana"},"application/vnd.openofficeorg.extension":{source:"apache",extensions:["oxt"]},"application/vnd.openstreetmap.data+xml":{source:"iana",compressible:!0,extensions:["osm"]},"application/vnd.opentimestamps.ots":{source:"iana"},"application/vnd.openxmlformats-officedocument.custom-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.customxmlproperties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawing+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chart+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramcolors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramdata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramlayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramstyle+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.extended-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.commentauthors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.handoutmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesslide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{source:"iana",compressible:!1,extensions:["pptx"]},"application/vnd.openxmlformats-officedocument.presentationml.presentation.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slide":{source:"iana",extensions:["sldx"]},"application/vnd.openxmlformats-officedocument.presentationml.slide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidelayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidemaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideshow":{source:"iana",extensions:["ppsx"]},"application/vnd.openxmlformats-officedocument.presentationml.slideshow.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideupdateinfo+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tablestyles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tags+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.template":{source:"iana",extensions:["potx"]},"application/vnd.openxmlformats-officedocument.presentationml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.viewprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.calcchain+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.externallink+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcachedefinition+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcacherecords+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivottable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.querytable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionheaders+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionlog+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedstrings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{source:"iana",compressible:!1,extensions:["xlsx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetmetadata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.tablesinglecells+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.template":{source:"iana",extensions:["xltx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.usernames+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.volatiledependencies+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.theme+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.themeoverride+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.vmldrawing":{source:"iana"},"application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{source:"iana",compressible:!1,extensions:["docx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.glossary+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.fonttable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.template":{source:"iana",extensions:["dotx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.websettings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.core-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.digital-signature-xmlsignature+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.relationships+xml":{source:"iana",compressible:!0},"application/vnd.oracle.resource+json":{source:"iana",compressible:!0},"application/vnd.orange.indata":{source:"iana"},"application/vnd.osa.netdeploy":{source:"iana"},"application/vnd.osgeo.mapguide.package":{source:"iana",extensions:["mgp"]},"application/vnd.osgi.bundle":{source:"iana"},"application/vnd.osgi.dp":{source:"iana",extensions:["dp"]},"application/vnd.osgi.subsystem":{source:"iana",extensions:["esa"]},"application/vnd.otps.ct-kip+xml":{source:"iana",compressible:!0},"application/vnd.oxli.countgraph":{source:"iana"},"application/vnd.pagerduty+json":{source:"iana",compressible:!0},"application/vnd.palm":{source:"iana",extensions:["pdb","pqa","oprc"]},"application/vnd.panoply":{source:"iana"},"application/vnd.paos.xml":{source:"iana"},"application/vnd.patentdive":{source:"iana"},"application/vnd.patientecommsdoc":{source:"iana"},"application/vnd.pawaafile":{source:"iana",extensions:["paw"]},"application/vnd.pcos":{source:"iana"},"application/vnd.pg.format":{source:"iana",extensions:["str"]},"application/vnd.pg.osasli":{source:"iana",extensions:["ei6"]},"application/vnd.piaccess.application-licence":{source:"iana"},"application/vnd.picsel":{source:"iana",extensions:["efif"]},"application/vnd.pmi.widget":{source:"iana",extensions:["wg"]},"application/vnd.poc.group-advertisement+xml":{source:"iana",compressible:!0},"application/vnd.pocketlearn":{source:"iana",extensions:["plf"]},"application/vnd.powerbuilder6":{source:"iana",extensions:["pbd"]},"application/vnd.powerbuilder6-s":{source:"iana"},"application/vnd.powerbuilder7":{source:"iana"},"application/vnd.powerbuilder7-s":{source:"iana"},"application/vnd.powerbuilder75":{source:"iana"},"application/vnd.powerbuilder75-s":{source:"iana"},"application/vnd.preminet":{source:"iana"},"application/vnd.previewsystems.box":{source:"iana",extensions:["box"]},"application/vnd.proteus.magazine":{source:"iana",extensions:["mgz"]},"application/vnd.psfs":{source:"iana"},"application/vnd.publishare-delta-tree":{source:"iana",extensions:["qps"]},"application/vnd.pvi.ptid1":{source:"iana",extensions:["ptid"]},"application/vnd.pwg-multiplexed":{source:"iana"},"application/vnd.pwg-xhtml-print+xml":{source:"iana",compressible:!0},"application/vnd.qualcomm.brew-app-res":{source:"iana"},"application/vnd.quarantainenet":{source:"iana"},"application/vnd.quark.quarkxpress":{source:"iana",extensions:["qxd","qxt","qwd","qwt","qxl","qxb"]},"application/vnd.quobject-quoxdocument":{source:"iana"},"application/vnd.radisys.moml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conn+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-stream+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-base+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-detect+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-sendrecv+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-group+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-speech+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-transform+xml":{source:"iana",compressible:!0},"application/vnd.rainstor.data":{source:"iana"},"application/vnd.rapid":{source:"iana"},"application/vnd.rar":{source:"iana",extensions:["rar"]},"application/vnd.realvnc.bed":{source:"iana",extensions:["bed"]},"application/vnd.recordare.musicxml":{source:"iana",extensions:["mxl"]},"application/vnd.recordare.musicxml+xml":{source:"iana",compressible:!0,extensions:["musicxml"]},"application/vnd.renlearn.rlprint":{source:"iana"},"application/vnd.resilient.logic":{source:"iana"},"application/vnd.restful+json":{source:"iana",compressible:!0},"application/vnd.rig.cryptonote":{source:"iana",extensions:["cryptonote"]},"application/vnd.rim.cod":{source:"apache",extensions:["cod"]},"application/vnd.rn-realmedia":{source:"apache",extensions:["rm"]},"application/vnd.rn-realmedia-vbr":{source:"apache",extensions:["rmvb"]},"application/vnd.route66.link66+xml":{source:"iana",compressible:!0,extensions:["link66"]},"application/vnd.rs-274x":{source:"iana"},"application/vnd.ruckus.download":{source:"iana"},"application/vnd.s3sms":{source:"iana"},"application/vnd.sailingtracker.track":{source:"iana",extensions:["st"]},"application/vnd.sar":{source:"iana"},"application/vnd.sbm.cid":{source:"iana"},"application/vnd.sbm.mid2":{source:"iana"},"application/vnd.scribus":{source:"iana"},"application/vnd.sealed.3df":{source:"iana"},"application/vnd.sealed.csf":{source:"iana"},"application/vnd.sealed.doc":{source:"iana"},"application/vnd.sealed.eml":{source:"iana"},"application/vnd.sealed.mht":{source:"iana"},"application/vnd.sealed.net":{source:"iana"},"application/vnd.sealed.ppt":{source:"iana"},"application/vnd.sealed.tiff":{source:"iana"},"application/vnd.sealed.xls":{source:"iana"},"application/vnd.sealedmedia.softseal.html":{source:"iana"},"application/vnd.sealedmedia.softseal.pdf":{source:"iana"},"application/vnd.seemail":{source:"iana",extensions:["see"]},"application/vnd.seis+json":{source:"iana",compressible:!0},"application/vnd.sema":{source:"iana",extensions:["sema"]},"application/vnd.semd":{source:"iana",extensions:["semd"]},"application/vnd.semf":{source:"iana",extensions:["semf"]},"application/vnd.shade-save-file":{source:"iana"},"application/vnd.shana.informed.formdata":{source:"iana",extensions:["ifm"]},"application/vnd.shana.informed.formtemplate":{source:"iana",extensions:["itp"]},"application/vnd.shana.informed.interchange":{source:"iana",extensions:["iif"]},"application/vnd.shana.informed.package":{source:"iana",extensions:["ipk"]},"application/vnd.shootproof+json":{source:"iana",compressible:!0},"application/vnd.shopkick+json":{source:"iana",compressible:!0},"application/vnd.shp":{source:"iana"},"application/vnd.shx":{source:"iana"},"application/vnd.sigrok.session":{source:"iana"},"application/vnd.simtech-mindmapper":{source:"iana",extensions:["twd","twds"]},"application/vnd.siren+json":{source:"iana",compressible:!0},"application/vnd.smaf":{source:"iana",extensions:["mmf"]},"application/vnd.smart.notebook":{source:"iana"},"application/vnd.smart.teacher":{source:"iana",extensions:["teacher"]},"application/vnd.snesdev-page-table":{source:"iana"},"application/vnd.software602.filler.form+xml":{source:"iana",compressible:!0,extensions:["fo"]},"application/vnd.software602.filler.form-xml-zip":{source:"iana"},"application/vnd.solent.sdkm+xml":{source:"iana",compressible:!0,extensions:["sdkm","sdkd"]},"application/vnd.spotfire.dxp":{source:"iana",extensions:["dxp"]},"application/vnd.spotfire.sfs":{source:"iana",extensions:["sfs"]},"application/vnd.sqlite3":{source:"iana"},"application/vnd.sss-cod":{source:"iana"},"application/vnd.sss-dtf":{source:"iana"},"application/vnd.sss-ntf":{source:"iana"},"application/vnd.stardivision.calc":{source:"apache",extensions:["sdc"]},"application/vnd.stardivision.draw":{source:"apache",extensions:["sda"]},"application/vnd.stardivision.impress":{source:"apache",extensions:["sdd"]},"application/vnd.stardivision.math":{source:"apache",extensions:["smf"]},"application/vnd.stardivision.writer":{source:"apache",extensions:["sdw","vor"]},"application/vnd.stardivision.writer-global":{source:"apache",extensions:["sgl"]},"application/vnd.stepmania.package":{source:"iana",extensions:["smzip"]},"application/vnd.stepmania.stepchart":{source:"iana",extensions:["sm"]},"application/vnd.street-stream":{source:"iana"},"application/vnd.sun.wadl+xml":{source:"iana",compressible:!0,extensions:["wadl"]},"application/vnd.sun.xml.calc":{source:"apache",extensions:["sxc"]},"application/vnd.sun.xml.calc.template":{source:"apache",extensions:["stc"]},"application/vnd.sun.xml.draw":{source:"apache",extensions:["sxd"]},"application/vnd.sun.xml.draw.template":{source:"apache",extensions:["std"]},"application/vnd.sun.xml.impress":{source:"apache",extensions:["sxi"]},"application/vnd.sun.xml.impress.template":{source:"apache",extensions:["sti"]},"application/vnd.sun.xml.math":{source:"apache",extensions:["sxm"]},"application/vnd.sun.xml.writer":{source:"apache",extensions:["sxw"]},"application/vnd.sun.xml.writer.global":{source:"apache",extensions:["sxg"]},"application/vnd.sun.xml.writer.template":{source:"apache",extensions:["stw"]},"application/vnd.sus-calendar":{source:"iana",extensions:["sus","susp"]},"application/vnd.svd":{source:"iana",extensions:["svd"]},"application/vnd.swiftview-ics":{source:"iana"},"application/vnd.sycle+xml":{source:"iana",compressible:!0},"application/vnd.syft+json":{source:"iana",compressible:!0},"application/vnd.symbian.install":{source:"apache",extensions:["sis","sisx"]},"application/vnd.syncml+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xsm"]},"application/vnd.syncml.dm+wbxml":{source:"iana",charset:"UTF-8",extensions:["bdm"]},"application/vnd.syncml.dm+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xdm"]},"application/vnd.syncml.dm.notification":{source:"iana"},"application/vnd.syncml.dmddf+wbxml":{source:"iana"},"application/vnd.syncml.dmddf+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["ddf"]},"application/vnd.syncml.dmtnds+wbxml":{source:"iana"},"application/vnd.syncml.dmtnds+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.syncml.ds.notification":{source:"iana"},"application/vnd.tableschema+json":{source:"iana",compressible:!0},"application/vnd.tao.intent-module-archive":{source:"iana",extensions:["tao"]},"application/vnd.tcpdump.pcap":{source:"iana",extensions:["pcap","cap","dmp"]},"application/vnd.think-cell.ppttc+json":{source:"iana",compressible:!0},"application/vnd.tmd.mediaflex.api+xml":{source:"iana",compressible:!0},"application/vnd.tml":{source:"iana"},"application/vnd.tmobile-livetv":{source:"iana",extensions:["tmo"]},"application/vnd.tri.onesource":{source:"iana"},"application/vnd.trid.tpt":{source:"iana",extensions:["tpt"]},"application/vnd.triscape.mxs":{source:"iana",extensions:["mxs"]},"application/vnd.trueapp":{source:"iana",extensions:["tra"]},"application/vnd.truedoc":{source:"iana"},"application/vnd.ubisoft.webplayer":{source:"iana"},"application/vnd.ufdl":{source:"iana",extensions:["ufd","ufdl"]},"application/vnd.uiq.theme":{source:"iana",extensions:["utz"]},"application/vnd.umajin":{source:"iana",extensions:["umj"]},"application/vnd.unity":{source:"iana",extensions:["unityweb"]},"application/vnd.uoml+xml":{source:"iana",compressible:!0,extensions:["uoml"]},"application/vnd.uplanet.alert":{source:"iana"},"application/vnd.uplanet.alert-wbxml":{source:"iana"},"application/vnd.uplanet.bearer-choice":{source:"iana"},"application/vnd.uplanet.bearer-choice-wbxml":{source:"iana"},"application/vnd.uplanet.cacheop":{source:"iana"},"application/vnd.uplanet.cacheop-wbxml":{source:"iana"},"application/vnd.uplanet.channel":{source:"iana"},"application/vnd.uplanet.channel-wbxml":{source:"iana"},"application/vnd.uplanet.list":{source:"iana"},"application/vnd.uplanet.list-wbxml":{source:"iana"},"application/vnd.uplanet.listcmd":{source:"iana"},"application/vnd.uplanet.listcmd-wbxml":{source:"iana"},"application/vnd.uplanet.signal":{source:"iana"},"application/vnd.uri-map":{source:"iana"},"application/vnd.valve.source.material":{source:"iana"},"application/vnd.vcx":{source:"iana",extensions:["vcx"]},"application/vnd.vd-study":{source:"iana"},"application/vnd.vectorworks":{source:"iana"},"application/vnd.vel+json":{source:"iana",compressible:!0},"application/vnd.verimatrix.vcas":{source:"iana"},"application/vnd.veritone.aion+json":{source:"iana",compressible:!0},"application/vnd.veryant.thin":{source:"iana"},"application/vnd.ves.encrypted":{source:"iana"},"application/vnd.vidsoft.vidconference":{source:"iana"},"application/vnd.visio":{source:"iana",extensions:["vsd","vst","vss","vsw"]},"application/vnd.visionary":{source:"iana",extensions:["vis"]},"application/vnd.vividence.scriptfile":{source:"iana"},"application/vnd.vsf":{source:"iana",extensions:["vsf"]},"application/vnd.wap.sic":{source:"iana"},"application/vnd.wap.slc":{source:"iana"},"application/vnd.wap.wbxml":{source:"iana",charset:"UTF-8",extensions:["wbxml"]},"application/vnd.wap.wmlc":{source:"iana",extensions:["wmlc"]},"application/vnd.wap.wmlscriptc":{source:"iana",extensions:["wmlsc"]},"application/vnd.webturbo":{source:"iana",extensions:["wtb"]},"application/vnd.wfa.dpp":{source:"iana"},"application/vnd.wfa.p2p":{source:"iana"},"application/vnd.wfa.wsc":{source:"iana"},"application/vnd.windows.devicepairing":{source:"iana"},"application/vnd.wmc":{source:"iana"},"application/vnd.wmf.bootstrap":{source:"iana"},"application/vnd.wolfram.mathematica":{source:"iana"},"application/vnd.wolfram.mathematica.package":{source:"iana"},"application/vnd.wolfram.player":{source:"iana",extensions:["nbp"]},"application/vnd.wordperfect":{source:"iana",extensions:["wpd"]},"application/vnd.wqd":{source:"iana",extensions:["wqd"]},"application/vnd.wrq-hp3000-labelled":{source:"iana"},"application/vnd.wt.stf":{source:"iana",extensions:["stf"]},"application/vnd.wv.csp+wbxml":{source:"iana"},"application/vnd.wv.csp+xml":{source:"iana",compressible:!0},"application/vnd.wv.ssp+xml":{source:"iana",compressible:!0},"application/vnd.xacml+json":{source:"iana",compressible:!0},"application/vnd.xara":{source:"iana",extensions:["xar"]},"application/vnd.xfdl":{source:"iana",extensions:["xfdl"]},"application/vnd.xfdl.webform":{source:"iana"},"application/vnd.xmi+xml":{source:"iana",compressible:!0},"application/vnd.xmpie.cpkg":{source:"iana"},"application/vnd.xmpie.dpkg":{source:"iana"},"application/vnd.xmpie.plan":{source:"iana"},"application/vnd.xmpie.ppkg":{source:"iana"},"application/vnd.xmpie.xlim":{source:"iana"},"application/vnd.yamaha.hv-dic":{source:"iana",extensions:["hvd"]},"application/vnd.yamaha.hv-script":{source:"iana",extensions:["hvs"]},"application/vnd.yamaha.hv-voice":{source:"iana",extensions:["hvp"]},"application/vnd.yamaha.openscoreformat":{source:"iana",extensions:["osf"]},"application/vnd.yamaha.openscoreformat.osfpvg+xml":{source:"iana",compressible:!0,extensions:["osfpvg"]},"application/vnd.yamaha.remote-setup":{source:"iana"},"application/vnd.yamaha.smaf-audio":{source:"iana",extensions:["saf"]},"application/vnd.yamaha.smaf-phrase":{source:"iana",extensions:["spf"]},"application/vnd.yamaha.through-ngn":{source:"iana"},"application/vnd.yamaha.tunnel-udpencap":{source:"iana"},"application/vnd.yaoweme":{source:"iana"},"application/vnd.yellowriver-custom-menu":{source:"iana",extensions:["cmp"]},"application/vnd.youtube.yt":{source:"iana"},"application/vnd.zul":{source:"iana",extensions:["zir","zirz"]},"application/vnd.zzazz.deck+xml":{source:"iana",compressible:!0,extensions:["zaz"]},"application/voicexml+xml":{source:"iana",compressible:!0,extensions:["vxml"]},"application/voucher-cms+json":{source:"iana",compressible:!0},"application/vq-rtcpxr":{source:"iana"},"application/wasm":{source:"iana",compressible:!0,extensions:["wasm"]},"application/watcherinfo+xml":{source:"iana",compressible:!0,extensions:["wif"]},"application/webpush-options+json":{source:"iana",compressible:!0},"application/whoispp-query":{source:"iana"},"application/whoispp-response":{source:"iana"},"application/widget":{source:"iana",extensions:["wgt"]},"application/winhlp":{source:"apache",extensions:["hlp"]},"application/wita":{source:"iana"},"application/wordperfect5.1":{source:"iana"},"application/wsdl+xml":{source:"iana",compressible:!0,extensions:["wsdl"]},"application/wspolicy+xml":{source:"iana",compressible:!0,extensions:["wspolicy"]},"application/x-7z-compressed":{source:"apache",compressible:!1,extensions:["7z"]},"application/x-abiword":{source:"apache",extensions:["abw"]},"application/x-ace-compressed":{source:"apache",extensions:["ace"]},"application/x-amf":{source:"apache"},"application/x-apple-diskimage":{source:"apache",extensions:["dmg"]},"application/x-arj":{compressible:!1,extensions:["arj"]},"application/x-authorware-bin":{source:"apache",extensions:["aab","x32","u32","vox"]},"application/x-authorware-map":{source:"apache",extensions:["aam"]},"application/x-authorware-seg":{source:"apache",extensions:["aas"]},"application/x-bcpio":{source:"apache",extensions:["bcpio"]},"application/x-bdoc":{compressible:!1,extensions:["bdoc"]},"application/x-bittorrent":{source:"apache",extensions:["torrent"]},"application/x-blorb":{source:"apache",extensions:["blb","blorb"]},"application/x-bzip":{source:"apache",compressible:!1,extensions:["bz"]},"application/x-bzip2":{source:"apache",compressible:!1,extensions:["bz2","boz"]},"application/x-cbr":{source:"apache",extensions:["cbr","cba","cbt","cbz","cb7"]},"application/x-cdlink":{source:"apache",extensions:["vcd"]},"application/x-cfs-compressed":{source:"apache",extensions:["cfs"]},"application/x-chat":{source:"apache",extensions:["chat"]},"application/x-chess-pgn":{source:"apache",extensions:["pgn"]},"application/x-chrome-extension":{extensions:["crx"]},"application/x-cocoa":{source:"nginx",extensions:["cco"]},"application/x-compress":{source:"apache"},"application/x-conference":{source:"apache",extensions:["nsc"]},"application/x-cpio":{source:"apache",extensions:["cpio"]},"application/x-csh":{source:"apache",extensions:["csh"]},"application/x-deb":{compressible:!1},"application/x-debian-package":{source:"apache",extensions:["deb","udeb"]},"application/x-dgc-compressed":{source:"apache",extensions:["dgc"]},"application/x-director":{source:"apache",extensions:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"]},"application/x-doom":{source:"apache",extensions:["wad"]},"application/x-dtbncx+xml":{source:"apache",compressible:!0,extensions:["ncx"]},"application/x-dtbook+xml":{source:"apache",compressible:!0,extensions:["dtb"]},"application/x-dtbresource+xml":{source:"apache",compressible:!0,extensions:["res"]},"application/x-dvi":{source:"apache",compressible:!1,extensions:["dvi"]},"application/x-envoy":{source:"apache",extensions:["evy"]},"application/x-eva":{source:"apache",extensions:["eva"]},"application/x-font-bdf":{source:"apache",extensions:["bdf"]},"application/x-font-dos":{source:"apache"},"application/x-font-framemaker":{source:"apache"},"application/x-font-ghostscript":{source:"apache",extensions:["gsf"]},"application/x-font-libgrx":{source:"apache"},"application/x-font-linux-psf":{source:"apache",extensions:["psf"]},"application/x-font-pcf":{source:"apache",extensions:["pcf"]},"application/x-font-snf":{source:"apache",extensions:["snf"]},"application/x-font-speedo":{source:"apache"},"application/x-font-sunos-news":{source:"apache"},"application/x-font-type1":{source:"apache",extensions:["pfa","pfb","pfm","afm"]},"application/x-font-vfont":{source:"apache"},"application/x-freearc":{source:"apache",extensions:["arc"]},"application/x-futuresplash":{source:"apache",extensions:["spl"]},"application/x-gca-compressed":{source:"apache",extensions:["gca"]},"application/x-glulx":{source:"apache",extensions:["ulx"]},"application/x-gnumeric":{source:"apache",extensions:["gnumeric"]},"application/x-gramps-xml":{source:"apache",extensions:["gramps"]},"application/x-gtar":{source:"apache",extensions:["gtar"]},"application/x-gzip":{source:"apache"},"application/x-hdf":{source:"apache",extensions:["hdf"]},"application/x-httpd-php":{compressible:!0,extensions:["php"]},"application/x-install-instructions":{source:"apache",extensions:["install"]},"application/x-iso9660-image":{source:"apache",extensions:["iso"]},"application/x-iwork-keynote-sffkey":{extensions:["key"]},"application/x-iwork-numbers-sffnumbers":{extensions:["numbers"]},"application/x-iwork-pages-sffpages":{extensions:["pages"]},"application/x-java-archive-diff":{source:"nginx",extensions:["jardiff"]},"application/x-java-jnlp-file":{source:"apache",compressible:!1,extensions:["jnlp"]},"application/x-javascript":{compressible:!0},"application/x-keepass2":{extensions:["kdbx"]},"application/x-latex":{source:"apache",compressible:!1,extensions:["latex"]},"application/x-lua-bytecode":{extensions:["luac"]},"application/x-lzh-compressed":{source:"apache",extensions:["lzh","lha"]},"application/x-makeself":{source:"nginx",extensions:["run"]},"application/x-mie":{source:"apache",extensions:["mie"]},"application/x-mobipocket-ebook":{source:"apache",extensions:["prc","mobi"]},"application/x-mpegurl":{compressible:!1},"application/x-ms-application":{source:"apache",extensions:["application"]},"application/x-ms-shortcut":{source:"apache",extensions:["lnk"]},"application/x-ms-wmd":{source:"apache",extensions:["wmd"]},"application/x-ms-wmz":{source:"apache",extensions:["wmz"]},"application/x-ms-xbap":{source:"apache",extensions:["xbap"]},"application/x-msaccess":{source:"apache",extensions:["mdb"]},"application/x-msbinder":{source:"apache",extensions:["obd"]},"application/x-mscardfile":{source:"apache",extensions:["crd"]},"application/x-msclip":{source:"apache",extensions:["clp"]},"application/x-msdos-program":{extensions:["exe"]},"application/x-msdownload":{source:"apache",extensions:["exe","dll","com","bat","msi"]},"application/x-msmediaview":{source:"apache",extensions:["mvb","m13","m14"]},"application/x-msmetafile":{source:"apache",extensions:["wmf","wmz","emf","emz"]},"application/x-msmoney":{source:"apache",extensions:["mny"]},"application/x-mspublisher":{source:"apache",extensions:["pub"]},"application/x-msschedule":{source:"apache",extensions:["scd"]},"application/x-msterminal":{source:"apache",extensions:["trm"]},"application/x-mswrite":{source:"apache",extensions:["wri"]},"application/x-netcdf":{source:"apache",extensions:["nc","cdf"]},"application/x-ns-proxy-autoconfig":{compressible:!0,extensions:["pac"]},"application/x-nzb":{source:"apache",extensions:["nzb"]},"application/x-perl":{source:"nginx",extensions:["pl","pm"]},"application/x-pilot":{source:"nginx",extensions:["prc","pdb"]},"application/x-pkcs12":{source:"apache",compressible:!1,extensions:["p12","pfx"]},"application/x-pkcs7-certificates":{source:"apache",extensions:["p7b","spc"]},"application/x-pkcs7-certreqresp":{source:"apache",extensions:["p7r"]},"application/x-pki-message":{source:"iana"},"application/x-rar-compressed":{source:"apache",compressible:!1,extensions:["rar"]},"application/x-redhat-package-manager":{source:"nginx",extensions:["rpm"]},"application/x-research-info-systems":{source:"apache",extensions:["ris"]},"application/x-sea":{source:"nginx",extensions:["sea"]},"application/x-sh":{source:"apache",compressible:!0,extensions:["sh"]},"application/x-shar":{source:"apache",extensions:["shar"]},"application/x-shockwave-flash":{source:"apache",compressible:!1,extensions:["swf"]},"application/x-silverlight-app":{source:"apache",extensions:["xap"]},"application/x-sql":{source:"apache",extensions:["sql"]},"application/x-stuffit":{source:"apache",compressible:!1,extensions:["sit"]},"application/x-stuffitx":{source:"apache",extensions:["sitx"]},"application/x-subrip":{source:"apache",extensions:["srt"]},"application/x-sv4cpio":{source:"apache",extensions:["sv4cpio"]},"application/x-sv4crc":{source:"apache",extensions:["sv4crc"]},"application/x-t3vm-image":{source:"apache",extensions:["t3"]},"application/x-tads":{source:"apache",extensions:["gam"]},"application/x-tar":{source:"apache",compressible:!0,extensions:["tar"]},"application/x-tcl":{source:"apache",extensions:["tcl","tk"]},"application/x-tex":{source:"apache",extensions:["tex"]},"application/x-tex-tfm":{source:"apache",extensions:["tfm"]},"application/x-texinfo":{source:"apache",extensions:["texinfo","texi"]},"application/x-tgif":{source:"apache",extensions:["obj"]},"application/x-ustar":{source:"apache",extensions:["ustar"]},"application/x-virtualbox-hdd":{compressible:!0,extensions:["hdd"]},"application/x-virtualbox-ova":{compressible:!0,extensions:["ova"]},"application/x-virtualbox-ovf":{compressible:!0,extensions:["ovf"]},"application/x-virtualbox-vbox":{compressible:!0,extensions:["vbox"]},"application/x-virtualbox-vbox-extpack":{compressible:!1,extensions:["vbox-extpack"]},"application/x-virtualbox-vdi":{compressible:!0,extensions:["vdi"]},"application/x-virtualbox-vhd":{compressible:!0,extensions:["vhd"]},"application/x-virtualbox-vmdk":{compressible:!0,extensions:["vmdk"]},"application/x-wais-source":{source:"apache",extensions:["src"]},"application/x-web-app-manifest+json":{compressible:!0,extensions:["webapp"]},"application/x-www-form-urlencoded":{source:"iana",compressible:!0},"application/x-x509-ca-cert":{source:"iana",extensions:["der","crt","pem"]},"application/x-x509-ca-ra-cert":{source:"iana"},"application/x-x509-next-ca-cert":{source:"iana"},"application/x-xfig":{source:"apache",extensions:["fig"]},"application/x-xliff+xml":{source:"apache",compressible:!0,extensions:["xlf"]},"application/x-xpinstall":{source:"apache",compressible:!1,extensions:["xpi"]},"application/x-xz":{source:"apache",extensions:["xz"]},"application/x-zmachine":{source:"apache",extensions:["z1","z2","z3","z4","z5","z6","z7","z8"]},"application/x400-bp":{source:"iana"},"application/xacml+xml":{source:"iana",compressible:!0},"application/xaml+xml":{source:"apache",compressible:!0,extensions:["xaml"]},"application/xcap-att+xml":{source:"iana",compressible:!0,extensions:["xav"]},"application/xcap-caps+xml":{source:"iana",compressible:!0,extensions:["xca"]},"application/xcap-diff+xml":{source:"iana",compressible:!0,extensions:["xdf"]},"application/xcap-el+xml":{source:"iana",compressible:!0,extensions:["xel"]},"application/xcap-error+xml":{source:"iana",compressible:!0},"application/xcap-ns+xml":{source:"iana",compressible:!0,extensions:["xns"]},"application/xcon-conference-info+xml":{source:"iana",compressible:!0},"application/xcon-conference-info-diff+xml":{source:"iana",compressible:!0},"application/xenc+xml":{source:"iana",compressible:!0,extensions:["xenc"]},"application/xhtml+xml":{source:"iana",compressible:!0,extensions:["xhtml","xht"]},"application/xhtml-voice+xml":{source:"apache",compressible:!0},"application/xliff+xml":{source:"iana",compressible:!0,extensions:["xlf"]},"application/xml":{source:"iana",compressible:!0,extensions:["xml","xsl","xsd","rng"]},"application/xml-dtd":{source:"iana",compressible:!0,extensions:["dtd"]},"application/xml-external-parsed-entity":{source:"iana"},"application/xml-patch+xml":{source:"iana",compressible:!0},"application/xmpp+xml":{source:"iana",compressible:!0},"application/xop+xml":{source:"iana",compressible:!0,extensions:["xop"]},"application/xproc+xml":{source:"apache",compressible:!0,extensions:["xpl"]},"application/xslt+xml":{source:"iana",compressible:!0,extensions:["xsl","xslt"]},"application/xspf+xml":{source:"apache",compressible:!0,extensions:["xspf"]},"application/xv+xml":{source:"iana",compressible:!0,extensions:["mxml","xhvml","xvml","xvm"]},"application/yang":{source:"iana",extensions:["yang"]},"application/yang-data+json":{source:"iana",compressible:!0},"application/yang-data+xml":{source:"iana",compressible:!0},"application/yang-patch+json":{source:"iana",compressible:!0},"application/yang-patch+xml":{source:"iana",compressible:!0},"application/yin+xml":{source:"iana",compressible:!0,extensions:["yin"]},"application/zip":{source:"iana",compressible:!1,extensions:["zip"]},"application/zlib":{source:"iana"},"application/zstd":{source:"iana"},"audio/1d-interleaved-parityfec":{source:"iana"},"audio/32kadpcm":{source:"iana"},"audio/3gpp":{source:"iana",compressible:!1,extensions:["3gpp"]},"audio/3gpp2":{source:"iana"},"audio/aac":{source:"iana"},"audio/ac3":{source:"iana"},"audio/adpcm":{source:"apache",extensions:["adp"]},"audio/amr":{source:"iana",extensions:["amr"]},"audio/amr-wb":{source:"iana"},"audio/amr-wb+":{source:"iana"},"audio/aptx":{source:"iana"},"audio/asc":{source:"iana"},"audio/atrac-advanced-lossless":{source:"iana"},"audio/atrac-x":{source:"iana"},"audio/atrac3":{source:"iana"},"audio/basic":{source:"iana",compressible:!1,extensions:["au","snd"]},"audio/bv16":{source:"iana"},"audio/bv32":{source:"iana"},"audio/clearmode":{source:"iana"},"audio/cn":{source:"iana"},"audio/dat12":{source:"iana"},"audio/dls":{source:"iana"},"audio/dsr-es201108":{source:"iana"},"audio/dsr-es202050":{source:"iana"},"audio/dsr-es202211":{source:"iana"},"audio/dsr-es202212":{source:"iana"},"audio/dv":{source:"iana"},"audio/dvi4":{source:"iana"},"audio/eac3":{source:"iana"},"audio/encaprtp":{source:"iana"},"audio/evrc":{source:"iana"},"audio/evrc-qcp":{source:"iana"},"audio/evrc0":{source:"iana"},"audio/evrc1":{source:"iana"},"audio/evrcb":{source:"iana"},"audio/evrcb0":{source:"iana"},"audio/evrcb1":{source:"iana"},"audio/evrcnw":{source:"iana"},"audio/evrcnw0":{source:"iana"},"audio/evrcnw1":{source:"iana"},"audio/evrcwb":{source:"iana"},"audio/evrcwb0":{source:"iana"},"audio/evrcwb1":{source:"iana"},"audio/evs":{source:"iana"},"audio/flexfec":{source:"iana"},"audio/fwdred":{source:"iana"},"audio/g711-0":{source:"iana"},"audio/g719":{source:"iana"},"audio/g722":{source:"iana"},"audio/g7221":{source:"iana"},"audio/g723":{source:"iana"},"audio/g726-16":{source:"iana"},"audio/g726-24":{source:"iana"},"audio/g726-32":{source:"iana"},"audio/g726-40":{source:"iana"},"audio/g728":{source:"iana"},"audio/g729":{source:"iana"},"audio/g7291":{source:"iana"},"audio/g729d":{source:"iana"},"audio/g729e":{source:"iana"},"audio/gsm":{source:"iana"},"audio/gsm-efr":{source:"iana"},"audio/gsm-hr-08":{source:"iana"},"audio/ilbc":{source:"iana"},"audio/ip-mr_v2.5":{source:"iana"},"audio/isac":{source:"apache"},"audio/l16":{source:"iana"},"audio/l20":{source:"iana"},"audio/l24":{source:"iana",compressible:!1},"audio/l8":{source:"iana"},"audio/lpc":{source:"iana"},"audio/melp":{source:"iana"},"audio/melp1200":{source:"iana"},"audio/melp2400":{source:"iana"},"audio/melp600":{source:"iana"},"audio/mhas":{source:"iana"},"audio/midi":{source:"apache",extensions:["mid","midi","kar","rmi"]},"audio/mobile-xmf":{source:"iana",extensions:["mxmf"]},"audio/mp3":{compressible:!1,extensions:["mp3"]},"audio/mp4":{source:"iana",compressible:!1,extensions:["m4a","mp4a"]},"audio/mp4a-latm":{source:"iana"},"audio/mpa":{source:"iana"},"audio/mpa-robust":{source:"iana"},"audio/mpeg":{source:"iana",compressible:!1,extensions:["mpga","mp2","mp2a","mp3","m2a","m3a"]},"audio/mpeg4-generic":{source:"iana"},"audio/musepack":{source:"apache"},"audio/ogg":{source:"iana",compressible:!1,extensions:["oga","ogg","spx","opus"]},"audio/opus":{source:"iana"},"audio/parityfec":{source:"iana"},"audio/pcma":{source:"iana"},"audio/pcma-wb":{source:"iana"},"audio/pcmu":{source:"iana"},"audio/pcmu-wb":{source:"iana"},"audio/prs.sid":{source:"iana"},"audio/qcelp":{source:"iana"},"audio/raptorfec":{source:"iana"},"audio/red":{source:"iana"},"audio/rtp-enc-aescm128":{source:"iana"},"audio/rtp-midi":{source:"iana"},"audio/rtploopback":{source:"iana"},"audio/rtx":{source:"iana"},"audio/s3m":{source:"apache",extensions:["s3m"]},"audio/scip":{source:"iana"},"audio/silk":{source:"apache",extensions:["sil"]},"audio/smv":{source:"iana"},"audio/smv-qcp":{source:"iana"},"audio/smv0":{source:"iana"},"audio/sofa":{source:"iana"},"audio/sp-midi":{source:"iana"},"audio/speex":{source:"iana"},"audio/t140c":{source:"iana"},"audio/t38":{source:"iana"},"audio/telephone-event":{source:"iana"},"audio/tetra_acelp":{source:"iana"},"audio/tetra_acelp_bb":{source:"iana"},"audio/tone":{source:"iana"},"audio/tsvcis":{source:"iana"},"audio/uemclip":{source:"iana"},"audio/ulpfec":{source:"iana"},"audio/usac":{source:"iana"},"audio/vdvi":{source:"iana"},"audio/vmr-wb":{source:"iana"},"audio/vnd.3gpp.iufp":{source:"iana"},"audio/vnd.4sb":{source:"iana"},"audio/vnd.audiokoz":{source:"iana"},"audio/vnd.celp":{source:"iana"},"audio/vnd.cisco.nse":{source:"iana"},"audio/vnd.cmles.radio-events":{source:"iana"},"audio/vnd.cns.anp1":{source:"iana"},"audio/vnd.cns.inf1":{source:"iana"},"audio/vnd.dece.audio":{source:"iana",extensions:["uva","uvva"]},"audio/vnd.digital-winds":{source:"iana",extensions:["eol"]},"audio/vnd.dlna.adts":{source:"iana"},"audio/vnd.dolby.heaac.1":{source:"iana"},"audio/vnd.dolby.heaac.2":{source:"iana"},"audio/vnd.dolby.mlp":{source:"iana"},"audio/vnd.dolby.mps":{source:"iana"},"audio/vnd.dolby.pl2":{source:"iana"},"audio/vnd.dolby.pl2x":{source:"iana"},"audio/vnd.dolby.pl2z":{source:"iana"},"audio/vnd.dolby.pulse.1":{source:"iana"},"audio/vnd.dra":{source:"iana",extensions:["dra"]},"audio/vnd.dts":{source:"iana",extensions:["dts"]},"audio/vnd.dts.hd":{source:"iana",extensions:["dtshd"]},"audio/vnd.dts.uhd":{source:"iana"},"audio/vnd.dvb.file":{source:"iana"},"audio/vnd.everad.plj":{source:"iana"},"audio/vnd.hns.audio":{source:"iana"},"audio/vnd.lucent.voice":{source:"iana",extensions:["lvp"]},"audio/vnd.ms-playready.media.pya":{source:"iana",extensions:["pya"]},"audio/vnd.nokia.mobile-xmf":{source:"iana"},"audio/vnd.nortel.vbk":{source:"iana"},"audio/vnd.nuera.ecelp4800":{source:"iana",extensions:["ecelp4800"]},"audio/vnd.nuera.ecelp7470":{source:"iana",extensions:["ecelp7470"]},"audio/vnd.nuera.ecelp9600":{source:"iana",extensions:["ecelp9600"]},"audio/vnd.octel.sbc":{source:"iana"},"audio/vnd.presonus.multitrack":{source:"iana"},"audio/vnd.qcelp":{source:"iana"},"audio/vnd.rhetorex.32kadpcm":{source:"iana"},"audio/vnd.rip":{source:"iana",extensions:["rip"]},"audio/vnd.rn-realaudio":{compressible:!1},"audio/vnd.sealedmedia.softseal.mpeg":{source:"iana"},"audio/vnd.vmx.cvsd":{source:"iana"},"audio/vnd.wave":{compressible:!1},"audio/vorbis":{source:"iana",compressible:!1},"audio/vorbis-config":{source:"iana"},"audio/wav":{compressible:!1,extensions:["wav"]},"audio/wave":{compressible:!1,extensions:["wav"]},"audio/webm":{source:"apache",compressible:!1,extensions:["weba"]},"audio/x-aac":{source:"apache",compressible:!1,extensions:["aac"]},"audio/x-aiff":{source:"apache",extensions:["aif","aiff","aifc"]},"audio/x-caf":{source:"apache",compressible:!1,extensions:["caf"]},"audio/x-flac":{source:"apache",extensions:["flac"]},"audio/x-m4a":{source:"nginx",extensions:["m4a"]},"audio/x-matroska":{source:"apache",extensions:["mka"]},"audio/x-mpegurl":{source:"apache",extensions:["m3u"]},"audio/x-ms-wax":{source:"apache",extensions:["wax"]},"audio/x-ms-wma":{source:"apache",extensions:["wma"]},"audio/x-pn-realaudio":{source:"apache",extensions:["ram","ra"]},"audio/x-pn-realaudio-plugin":{source:"apache",extensions:["rmp"]},"audio/x-realaudio":{source:"nginx",extensions:["ra"]},"audio/x-tta":{source:"apache"},"audio/x-wav":{source:"apache",extensions:["wav"]},"audio/xm":{source:"apache",extensions:["xm"]},"chemical/x-cdx":{source:"apache",extensions:["cdx"]},"chemical/x-cif":{source:"apache",extensions:["cif"]},"chemical/x-cmdf":{source:"apache",extensions:["cmdf"]},"chemical/x-cml":{source:"apache",extensions:["cml"]},"chemical/x-csml":{source:"apache",extensions:["csml"]},"chemical/x-pdb":{source:"apache"},"chemical/x-xyz":{source:"apache",extensions:["xyz"]},"font/collection":{source:"iana",extensions:["ttc"]},"font/otf":{source:"iana",compressible:!0,extensions:["otf"]},"font/sfnt":{source:"iana"},"font/ttf":{source:"iana",compressible:!0,extensions:["ttf"]},"font/woff":{source:"iana",extensions:["woff"]},"font/woff2":{source:"iana",extensions:["woff2"]},"image/aces":{source:"iana",extensions:["exr"]},"image/apng":{compressible:!1,extensions:["apng"]},"image/avci":{source:"iana",extensions:["avci"]},"image/avcs":{source:"iana",extensions:["avcs"]},"image/avif":{source:"iana",compressible:!1,extensions:["avif"]},"image/bmp":{source:"iana",compressible:!0,extensions:["bmp"]},"image/cgm":{source:"iana",extensions:["cgm"]},"image/dicom-rle":{source:"iana",extensions:["drle"]},"image/emf":{source:"iana",extensions:["emf"]},"image/fits":{source:"iana",extensions:["fits"]},"image/g3fax":{source:"iana",extensions:["g3"]},"image/gif":{source:"iana",compressible:!1,extensions:["gif"]},"image/heic":{source:"iana",extensions:["heic"]},"image/heic-sequence":{source:"iana",extensions:["heics"]},"image/heif":{source:"iana",extensions:["heif"]},"image/heif-sequence":{source:"iana",extensions:["heifs"]},"image/hej2k":{source:"iana",extensions:["hej2"]},"image/hsj2":{source:"iana",extensions:["hsj2"]},"image/ief":{source:"iana",extensions:["ief"]},"image/jls":{source:"iana",extensions:["jls"]},"image/jp2":{source:"iana",compressible:!1,extensions:["jp2","jpg2"]},"image/jpeg":{source:"iana",compressible:!1,extensions:["jpeg","jpg","jpe"]},"image/jph":{source:"iana",extensions:["jph"]},"image/jphc":{source:"iana",extensions:["jhc"]},"image/jpm":{source:"iana",compressible:!1,extensions:["jpm"]},"image/jpx":{source:"iana",compressible:!1,extensions:["jpx","jpf"]},"image/jxr":{source:"iana",extensions:["jxr"]},"image/jxra":{source:"iana",extensions:["jxra"]},"image/jxrs":{source:"iana",extensions:["jxrs"]},"image/jxs":{source:"iana",extensions:["jxs"]},"image/jxsc":{source:"iana",extensions:["jxsc"]},"image/jxsi":{source:"iana",extensions:["jxsi"]},"image/jxss":{source:"iana",extensions:["jxss"]},"image/ktx":{source:"iana",extensions:["ktx"]},"image/ktx2":{source:"iana",extensions:["ktx2"]},"image/naplps":{source:"iana"},"image/pjpeg":{compressible:!1},"image/png":{source:"iana",compressible:!1,extensions:["png"]},"image/prs.btif":{source:"iana",extensions:["btif"]},"image/prs.pti":{source:"iana",extensions:["pti"]},"image/pwg-raster":{source:"iana"},"image/sgi":{source:"apache",extensions:["sgi"]},"image/svg+xml":{source:"iana",compressible:!0,extensions:["svg","svgz"]},"image/t38":{source:"iana",extensions:["t38"]},"image/tiff":{source:"iana",compressible:!1,extensions:["tif","tiff"]},"image/tiff-fx":{source:"iana",extensions:["tfx"]},"image/vnd.adobe.photoshop":{source:"iana",compressible:!0,extensions:["psd"]},"image/vnd.airzip.accelerator.azv":{source:"iana",extensions:["azv"]},"image/vnd.cns.inf2":{source:"iana"},"image/vnd.dece.graphic":{source:"iana",extensions:["uvi","uvvi","uvg","uvvg"]},"image/vnd.djvu":{source:"iana",extensions:["djvu","djv"]},"image/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"image/vnd.dwg":{source:"iana",extensions:["dwg"]},"image/vnd.dxf":{source:"iana",extensions:["dxf"]},"image/vnd.fastbidsheet":{source:"iana",extensions:["fbs"]},"image/vnd.fpx":{source:"iana",extensions:["fpx"]},"image/vnd.fst":{source:"iana",extensions:["fst"]},"image/vnd.fujixerox.edmics-mmr":{source:"iana",extensions:["mmr"]},"image/vnd.fujixerox.edmics-rlc":{source:"iana",extensions:["rlc"]},"image/vnd.globalgraphics.pgb":{source:"iana"},"image/vnd.microsoft.icon":{source:"iana",compressible:!0,extensions:["ico"]},"image/vnd.mix":{source:"iana"},"image/vnd.mozilla.apng":{source:"iana"},"image/vnd.ms-dds":{compressible:!0,extensions:["dds"]},"image/vnd.ms-modi":{source:"iana",extensions:["mdi"]},"image/vnd.ms-photo":{source:"apache",extensions:["wdp"]},"image/vnd.net-fpx":{source:"iana",extensions:["npx"]},"image/vnd.pco.b16":{source:"iana",extensions:["b16"]},"image/vnd.radiance":{source:"iana"},"image/vnd.sealed.png":{source:"iana"},"image/vnd.sealedmedia.softseal.gif":{source:"iana"},"image/vnd.sealedmedia.softseal.jpg":{source:"iana"},"image/vnd.svf":{source:"iana"},"image/vnd.tencent.tap":{source:"iana",extensions:["tap"]},"image/vnd.valve.source.texture":{source:"iana",extensions:["vtf"]},"image/vnd.wap.wbmp":{source:"iana",extensions:["wbmp"]},"image/vnd.xiff":{source:"iana",extensions:["xif"]},"image/vnd.zbrush.pcx":{source:"iana",extensions:["pcx"]},"image/webp":{source:"apache",extensions:["webp"]},"image/wmf":{source:"iana",extensions:["wmf"]},"image/x-3ds":{source:"apache",extensions:["3ds"]},"image/x-cmu-raster":{source:"apache",extensions:["ras"]},"image/x-cmx":{source:"apache",extensions:["cmx"]},"image/x-freehand":{source:"apache",extensions:["fh","fhc","fh4","fh5","fh7"]},"image/x-icon":{source:"apache",compressible:!0,extensions:["ico"]},"image/x-jng":{source:"nginx",extensions:["jng"]},"image/x-mrsid-image":{source:"apache",extensions:["sid"]},"image/x-ms-bmp":{source:"nginx",compressible:!0,extensions:["bmp"]},"image/x-pcx":{source:"apache",extensions:["pcx"]},"image/x-pict":{source:"apache",extensions:["pic","pct"]},"image/x-portable-anymap":{source:"apache",extensions:["pnm"]},"image/x-portable-bitmap":{source:"apache",extensions:["pbm"]},"image/x-portable-graymap":{source:"apache",extensions:["pgm"]},"image/x-portable-pixmap":{source:"apache",extensions:["ppm"]},"image/x-rgb":{source:"apache",extensions:["rgb"]},"image/x-tga":{source:"apache",extensions:["tga"]},"image/x-xbitmap":{source:"apache",extensions:["xbm"]},"image/x-xcf":{compressible:!1},"image/x-xpixmap":{source:"apache",extensions:["xpm"]},"image/x-xwindowdump":{source:"apache",extensions:["xwd"]},"message/cpim":{source:"iana"},"message/delivery-status":{source:"iana"},"message/disposition-notification":{source:"iana",extensions:["disposition-notification"]},"message/external-body":{source:"iana"},"message/feedback-report":{source:"iana"},"message/global":{source:"iana",extensions:["u8msg"]},"message/global-delivery-status":{source:"iana",extensions:["u8dsn"]},"message/global-disposition-notification":{source:"iana",extensions:["u8mdn"]},"message/global-headers":{source:"iana",extensions:["u8hdr"]},"message/http":{source:"iana",compressible:!1},"message/imdn+xml":{source:"iana",compressible:!0},"message/news":{source:"iana"},"message/partial":{source:"iana",compressible:!1},"message/rfc822":{source:"iana",compressible:!0,extensions:["eml","mime"]},"message/s-http":{source:"iana"},"message/sip":{source:"iana"},"message/sipfrag":{source:"iana"},"message/tracking-status":{source:"iana"},"message/vnd.si.simp":{source:"iana"},"message/vnd.wfa.wsc":{source:"iana",extensions:["wsc"]},"model/3mf":{source:"iana",extensions:["3mf"]},"model/e57":{source:"iana"},"model/gltf+json":{source:"iana",compressible:!0,extensions:["gltf"]},"model/gltf-binary":{source:"iana",compressible:!0,extensions:["glb"]},"model/iges":{source:"iana",compressible:!1,extensions:["igs","iges"]},"model/mesh":{source:"iana",compressible:!1,extensions:["msh","mesh","silo"]},"model/mtl":{source:"iana",extensions:["mtl"]},"model/obj":{source:"iana",extensions:["obj"]},"model/step":{source:"iana"},"model/step+xml":{source:"iana",compressible:!0,extensions:["stpx"]},"model/step+zip":{source:"iana",compressible:!1,extensions:["stpz"]},"model/step-xml+zip":{source:"iana",compressible:!1,extensions:["stpxz"]},"model/stl":{source:"iana",extensions:["stl"]},"model/vnd.collada+xml":{source:"iana",compressible:!0,extensions:["dae"]},"model/vnd.dwf":{source:"iana",extensions:["dwf"]},"model/vnd.flatland.3dml":{source:"iana"},"model/vnd.gdl":{source:"iana",extensions:["gdl"]},"model/vnd.gs-gdl":{source:"apache"},"model/vnd.gs.gdl":{source:"iana"},"model/vnd.gtw":{source:"iana",extensions:["gtw"]},"model/vnd.moml+xml":{source:"iana",compressible:!0},"model/vnd.mts":{source:"iana",extensions:["mts"]},"model/vnd.opengex":{source:"iana",extensions:["ogex"]},"model/vnd.parasolid.transmit.binary":{source:"iana",extensions:["x_b"]},"model/vnd.parasolid.transmit.text":{source:"iana",extensions:["x_t"]},"model/vnd.pytha.pyox":{source:"iana"},"model/vnd.rosette.annotated-data-model":{source:"iana"},"model/vnd.sap.vds":{source:"iana",extensions:["vds"]},"model/vnd.usdz+zip":{source:"iana",compressible:!1,extensions:["usdz"]},"model/vnd.valve.source.compiled-map":{source:"iana",extensions:["bsp"]},"model/vnd.vtu":{source:"iana",extensions:["vtu"]},"model/vrml":{source:"iana",compressible:!1,extensions:["wrl","vrml"]},"model/x3d+binary":{source:"apache",compressible:!1,extensions:["x3db","x3dbz"]},"model/x3d+fastinfoset":{source:"iana",extensions:["x3db"]},"model/x3d+vrml":{source:"apache",compressible:!1,extensions:["x3dv","x3dvz"]},"model/x3d+xml":{source:"iana",compressible:!0,extensions:["x3d","x3dz"]},"model/x3d-vrml":{source:"iana",extensions:["x3dv"]},"multipart/alternative":{source:"iana",compressible:!1},"multipart/appledouble":{source:"iana"},"multipart/byteranges":{source:"iana"},"multipart/digest":{source:"iana"},"multipart/encrypted":{source:"iana",compressible:!1},"multipart/form-data":{source:"iana",compressible:!1},"multipart/header-set":{source:"iana"},"multipart/mixed":{source:"iana"},"multipart/multilingual":{source:"iana"},"multipart/parallel":{source:"iana"},"multipart/related":{source:"iana",compressible:!1},"multipart/report":{source:"iana"},"multipart/signed":{source:"iana",compressible:!1},"multipart/vnd.bint.med-plus":{source:"iana"},"multipart/voice-message":{source:"iana"},"multipart/x-mixed-replace":{source:"iana"},"text/1d-interleaved-parityfec":{source:"iana"},"text/cache-manifest":{source:"iana",compressible:!0,extensions:["appcache","manifest"]},"text/calendar":{source:"iana",extensions:["ics","ifb"]},"text/calender":{compressible:!0},"text/cmd":{compressible:!0},"text/coffeescript":{extensions:["coffee","litcoffee"]},"text/cql":{source:"iana"},"text/cql-expression":{source:"iana"},"text/cql-identifier":{source:"iana"},"text/css":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["css"]},"text/csv":{source:"iana",compressible:!0,extensions:["csv"]},"text/csv-schema":{source:"iana"},"text/directory":{source:"iana"},"text/dns":{source:"iana"},"text/ecmascript":{source:"iana"},"text/encaprtp":{source:"iana"},"text/enriched":{source:"iana"},"text/fhirpath":{source:"iana"},"text/flexfec":{source:"iana"},"text/fwdred":{source:"iana"},"text/gff3":{source:"iana"},"text/grammar-ref-list":{source:"iana"},"text/html":{source:"iana",compressible:!0,extensions:["html","htm","shtml"]},"text/jade":{extensions:["jade"]},"text/javascript":{source:"iana",compressible:!0},"text/jcr-cnd":{source:"iana"},"text/jsx":{compressible:!0,extensions:["jsx"]},"text/less":{compressible:!0,extensions:["less"]},"text/markdown":{source:"iana",compressible:!0,extensions:["markdown","md"]},"text/mathml":{source:"nginx",extensions:["mml"]},"text/mdx":{compressible:!0,extensions:["mdx"]},"text/mizar":{source:"iana"},"text/n3":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["n3"]},"text/parameters":{source:"iana",charset:"UTF-8"},"text/parityfec":{source:"iana"},"text/plain":{source:"iana",compressible:!0,extensions:["txt","text","conf","def","list","log","in","ini"]},"text/provenance-notation":{source:"iana",charset:"UTF-8"},"text/prs.fallenstein.rst":{source:"iana"},"text/prs.lines.tag":{source:"iana",extensions:["dsc"]},"text/prs.prop.logic":{source:"iana"},"text/raptorfec":{source:"iana"},"text/red":{source:"iana"},"text/rfc822-headers":{source:"iana"},"text/richtext":{source:"iana",compressible:!0,extensions:["rtx"]},"text/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"text/rtp-enc-aescm128":{source:"iana"},"text/rtploopback":{source:"iana"},"text/rtx":{source:"iana"},"text/sgml":{source:"iana",extensions:["sgml","sgm"]},"text/shaclc":{source:"iana"},"text/shex":{source:"iana",extensions:["shex"]},"text/slim":{extensions:["slim","slm"]},"text/spdx":{source:"iana",extensions:["spdx"]},"text/strings":{source:"iana"},"text/stylus":{extensions:["stylus","styl"]},"text/t140":{source:"iana"},"text/tab-separated-values":{source:"iana",compressible:!0,extensions:["tsv"]},"text/troff":{source:"iana",extensions:["t","tr","roff","man","me","ms"]},"text/turtle":{source:"iana",charset:"UTF-8",extensions:["ttl"]},"text/ulpfec":{source:"iana"},"text/uri-list":{source:"iana",compressible:!0,extensions:["uri","uris","urls"]},"text/vcard":{source:"iana",compressible:!0,extensions:["vcard"]},"text/vnd.a":{source:"iana"},"text/vnd.abc":{source:"iana"},"text/vnd.ascii-art":{source:"iana"},"text/vnd.curl":{source:"iana",extensions:["curl"]},"text/vnd.curl.dcurl":{source:"apache",extensions:["dcurl"]},"text/vnd.curl.mcurl":{source:"apache",extensions:["mcurl"]},"text/vnd.curl.scurl":{source:"apache",extensions:["scurl"]},"text/vnd.debian.copyright":{source:"iana",charset:"UTF-8"},"text/vnd.dmclientscript":{source:"iana"},"text/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"text/vnd.esmertec.theme-descriptor":{source:"iana",charset:"UTF-8"},"text/vnd.familysearch.gedcom":{source:"iana",extensions:["ged"]},"text/vnd.ficlab.flt":{source:"iana"},"text/vnd.fly":{source:"iana",extensions:["fly"]},"text/vnd.fmi.flexstor":{source:"iana",extensions:["flx"]},"text/vnd.gml":{source:"iana"},"text/vnd.graphviz":{source:"iana",extensions:["gv"]},"text/vnd.hans":{source:"iana"},"text/vnd.hgl":{source:"iana"},"text/vnd.in3d.3dml":{source:"iana",extensions:["3dml"]},"text/vnd.in3d.spot":{source:"iana",extensions:["spot"]},"text/vnd.iptc.newsml":{source:"iana"},"text/vnd.iptc.nitf":{source:"iana"},"text/vnd.latex-z":{source:"iana"},"text/vnd.motorola.reflex":{source:"iana"},"text/vnd.ms-mediapackage":{source:"iana"},"text/vnd.net2phone.commcenter.command":{source:"iana"},"text/vnd.radisys.msml-basic-layout":{source:"iana"},"text/vnd.senx.warpscript":{source:"iana"},"text/vnd.si.uricatalogue":{source:"iana"},"text/vnd.sosi":{source:"iana"},"text/vnd.sun.j2me.app-descriptor":{source:"iana",charset:"UTF-8",extensions:["jad"]},"text/vnd.trolltech.linguist":{source:"iana",charset:"UTF-8"},"text/vnd.wap.si":{source:"iana"},"text/vnd.wap.sl":{source:"iana"},"text/vnd.wap.wml":{source:"iana",extensions:["wml"]},"text/vnd.wap.wmlscript":{source:"iana",extensions:["wmls"]},"text/vtt":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["vtt"]},"text/x-asm":{source:"apache",extensions:["s","asm"]},"text/x-c":{source:"apache",extensions:["c","cc","cxx","cpp","h","hh","dic"]},"text/x-component":{source:"nginx",extensions:["htc"]},"text/x-fortran":{source:"apache",extensions:["f","for","f77","f90"]},"text/x-gwt-rpc":{compressible:!0},"text/x-handlebars-template":{extensions:["hbs"]},"text/x-java-source":{source:"apache",extensions:["java"]},"text/x-jquery-tmpl":{compressible:!0},"text/x-lua":{extensions:["lua"]},"text/x-markdown":{compressible:!0,extensions:["mkd"]},"text/x-nfo":{source:"apache",extensions:["nfo"]},"text/x-opml":{source:"apache",extensions:["opml"]},"text/x-org":{compressible:!0,extensions:["org"]},"text/x-pascal":{source:"apache",extensions:["p","pas"]},"text/x-processing":{compressible:!0,extensions:["pde"]},"text/x-sass":{extensions:["sass"]},"text/x-scss":{extensions:["scss"]},"text/x-setext":{source:"apache",extensions:["etx"]},"text/x-sfv":{source:"apache",extensions:["sfv"]},"text/x-suse-ymp":{compressible:!0,extensions:["ymp"]},"text/x-uuencode":{source:"apache",extensions:["uu"]},"text/x-vcalendar":{source:"apache",extensions:["vcs"]},"text/x-vcard":{source:"apache",extensions:["vcf"]},"text/xml":{source:"iana",compressible:!0,extensions:["xml"]},"text/xml-external-parsed-entity":{source:"iana"},"text/yaml":{compressible:!0,extensions:["yaml","yml"]},"video/1d-interleaved-parityfec":{source:"iana"},"video/3gpp":{source:"iana",extensions:["3gp","3gpp"]},"video/3gpp-tt":{source:"iana"},"video/3gpp2":{source:"iana",extensions:["3g2"]},"video/av1":{source:"iana"},"video/bmpeg":{source:"iana"},"video/bt656":{source:"iana"},"video/celb":{source:"iana"},"video/dv":{source:"iana"},"video/encaprtp":{source:"iana"},"video/ffv1":{source:"iana"},"video/flexfec":{source:"iana"},"video/h261":{source:"iana",extensions:["h261"]},"video/h263":{source:"iana",extensions:["h263"]},"video/h263-1998":{source:"iana"},"video/h263-2000":{source:"iana"},"video/h264":{source:"iana",extensions:["h264"]},"video/h264-rcdo":{source:"iana"},"video/h264-svc":{source:"iana"},"video/h265":{source:"iana"},"video/iso.segment":{source:"iana",extensions:["m4s"]},"video/jpeg":{source:"iana",extensions:["jpgv"]},"video/jpeg2000":{source:"iana"},"video/jpm":{source:"apache",extensions:["jpm","jpgm"]},"video/jxsv":{source:"iana"},"video/mj2":{source:"iana",extensions:["mj2","mjp2"]},"video/mp1s":{source:"iana"},"video/mp2p":{source:"iana"},"video/mp2t":{source:"iana",extensions:["ts"]},"video/mp4":{source:"iana",compressible:!1,extensions:["mp4","mp4v","mpg4"]},"video/mp4v-es":{source:"iana"},"video/mpeg":{source:"iana",compressible:!1,extensions:["mpeg","mpg","mpe","m1v","m2v"]},"video/mpeg4-generic":{source:"iana"},"video/mpv":{source:"iana"},"video/nv":{source:"iana"},"video/ogg":{source:"iana",compressible:!1,extensions:["ogv"]},"video/parityfec":{source:"iana"},"video/pointer":{source:"iana"},"video/quicktime":{source:"iana",compressible:!1,extensions:["qt","mov"]},"video/raptorfec":{source:"iana"},"video/raw":{source:"iana"},"video/rtp-enc-aescm128":{source:"iana"},"video/rtploopback":{source:"iana"},"video/rtx":{source:"iana"},"video/scip":{source:"iana"},"video/smpte291":{source:"iana"},"video/smpte292m":{source:"iana"},"video/ulpfec":{source:"iana"},"video/vc1":{source:"iana"},"video/vc2":{source:"iana"},"video/vnd.cctv":{source:"iana"},"video/vnd.dece.hd":{source:"iana",extensions:["uvh","uvvh"]},"video/vnd.dece.mobile":{source:"iana",extensions:["uvm","uvvm"]},"video/vnd.dece.mp4":{source:"iana"},"video/vnd.dece.pd":{source:"iana",extensions:["uvp","uvvp"]},"video/vnd.dece.sd":{source:"iana",extensions:["uvs","uvvs"]},"video/vnd.dece.video":{source:"iana",extensions:["uvv","uvvv"]},"video/vnd.directv.mpeg":{source:"iana"},"video/vnd.directv.mpeg-tts":{source:"iana"},"video/vnd.dlna.mpeg-tts":{source:"iana"},"video/vnd.dvb.file":{source:"iana",extensions:["dvb"]},"video/vnd.fvt":{source:"iana",extensions:["fvt"]},"video/vnd.hns.video":{source:"iana"},"video/vnd.iptvforum.1dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.1dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.2dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.2dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.ttsavc":{source:"iana"},"video/vnd.iptvforum.ttsmpeg2":{source:"iana"},"video/vnd.motorola.video":{source:"iana"},"video/vnd.motorola.videop":{source:"iana"},"video/vnd.mpegurl":{source:"iana",extensions:["mxu","m4u"]},"video/vnd.ms-playready.media.pyv":{source:"iana",extensions:["pyv"]},"video/vnd.nokia.interleaved-multimedia":{source:"iana"},"video/vnd.nokia.mp4vr":{source:"iana"},"video/vnd.nokia.videovoip":{source:"iana"},"video/vnd.objectvideo":{source:"iana"},"video/vnd.radgamettools.bink":{source:"iana"},"video/vnd.radgamettools.smacker":{source:"iana"},"video/vnd.sealed.mpeg1":{source:"iana"},"video/vnd.sealed.mpeg4":{source:"iana"},"video/vnd.sealed.swf":{source:"iana"},"video/vnd.sealedmedia.softseal.mov":{source:"iana"},"video/vnd.uvvu.mp4":{source:"iana",extensions:["uvu","uvvu"]},"video/vnd.vivo":{source:"iana",extensions:["viv"]},"video/vnd.youtube.yt":{source:"iana"},"video/vp8":{source:"iana"},"video/vp9":{source:"iana"},"video/webm":{source:"apache",compressible:!1,extensions:["webm"]},"video/x-f4v":{source:"apache",extensions:["f4v"]},"video/x-fli":{source:"apache",extensions:["fli"]},"video/x-flv":{source:"apache",compressible:!1,extensions:["flv"]},"video/x-m4v":{source:"apache",extensions:["m4v"]},"video/x-matroska":{source:"apache",compressible:!1,extensions:["mkv","mk3d","mks"]},"video/x-mng":{source:"apache",extensions:["mng"]},"video/x-ms-asf":{source:"apache",extensions:["asf","asx"]},"video/x-ms-vob":{source:"apache",extensions:["vob"]},"video/x-ms-wm":{source:"apache",extensions:["wm"]},"video/x-ms-wmv":{source:"apache",compressible:!1,extensions:["wmv"]},"video/x-ms-wmx":{source:"apache",extensions:["wmx"]},"video/x-ms-wvx":{source:"apache",extensions:["wvx"]},"video/x-msvideo":{source:"apache",extensions:["avi"]},"video/x-sgi-movie":{source:"apache",extensions:["movie"]},"video/x-smv":{source:"apache",extensions:["smv"]},"x-conference/x-cooltalk":{source:"apache",extensions:["ice"]},"x-shader/x-fragment":{compressible:!0},"x-shader/x-vertex":{compressible:!0}}});var X9=M((YTe,Y9)=>{Y9.exports=Q9()});var t3=M(po=>{"use strict";var jP=X9(),xae=require("path").extname,Z9=/^\s*([^;\s]*)(?:;|\s|$)/,Cae=/^text\//i;po.charset=e3;po.charsets={lookup:e3};po.contentType=wae;po.extension=Eae;po.extensions=Object.create(null);po.lookup=Pae;po.types=Object.create(null);kae(po.extensions,po.types);function e3(r){if(!r||typeof r!="string")return!1;var e=Z9.exec(r),t=e&&jP[e[1].toLowerCase()];return t&&t.charset?t.charset:e&&Cae.test(e[1])?"UTF-8":!1}function wae(r){if(!r||typeof r!="string")return!1;var e=r.indexOf("/")===-1?po.lookup(r):r;if(!e)return!1;if(e.indexOf("charset")===-1){var t=po.charset(e);t&&(e+="; charset="+t.toLowerCase())}return e}function Eae(r){if(!r||typeof r!="string")return!1;var e=Z9.exec(r),t=e&&po.extensions[e[1].toLowerCase()];return!t||!t.length?!1:t[0]}function Pae(r){if(!r||typeof r!="string")return!1;var e=xae("x."+r).toLowerCase().substr(1);return e&&po.types[e]||!1}function kae(r,e){var t=["nginx","apache",void 0,"iana"];Object.keys(jP).forEach(function(i){var o=jP[i],s=o.extensions;if(!(!s||!s.length)){r[i]=s;for(var a=0;a<s.length;a++){var c=s[a];if(e[c]){var l=t.indexOf(jP[e[c]].source),u=t.indexOf(o.source);if(e[c]!=="application/octet-stream"&&(l>u||l===u&&e[c].substr(0,12)==="application/"))continue}e[c]=i}}})}});var n3=M((ZTe,r3)=>{r3.exports=_ae;function _ae(r){var e=typeof setImmediate=="function"?setImmediate:typeof process=="object"&&typeof process.nextTick=="function"?process.nextTick:null;e?e(r):setTimeout(r,0)}});var BN=M((e0e,o3)=>{var i3=n3();o3.exports=Dae;function Dae(r){var e=!1;return i3(function(){e=!0}),function(n,i){e?r(n,i):i3(function(){r(n,i)})}}});var qN=M((t0e,s3)=>{s3.exports=Tae;function Tae(r){Object.keys(r.jobs).forEach(Rae.bind(r)),r.jobs={}}function Rae(r){typeof this.jobs[r]=="function"&&this.jobs[r]()}});var JN=M((r0e,c3)=>{var a3=BN(),Aae=qN();c3.exports=Nae;function Nae(r,e,t,n){var i=t.keyedList?t.keyedList[t.index]:t.index;t.jobs[i]=Mae(e,i,r[i],function(o,s){i in t.jobs&&(delete t.jobs[i],o?Aae(t):t.results[i]=s,n(o,t.results))})}function Mae(r,e,t,n){var i;return r.length==2?i=r(t,a3(n)):i=r(t,e,a3(n)),i}});var $N=M((n0e,l3)=>{l3.exports=Oae;function Oae(r,e){var t=!Array.isArray(r),n={index:0,keyedList:t||e?Object.keys(r):null,jobs:{},results:t?{}:[],size:t?Object.keys(r).length:r.length};return e&&n.keyedList.sort(t?e:function(i,o){return e(r[i],r[o])}),n}});var HN=M((i0e,u3)=>{var Kae=qN(),Fae=BN();u3.exports=Lae;function Lae(r){Object.keys(this.jobs).length&&(this.index=this.size,Kae(this),Fae(r)(null,this.results))}});var d3=M((o0e,p3)=>{var Uae=JN(),jae=$N(),Wae=HN();p3.exports=Vae;function Vae(r,e,t){for(var n=jae(r);n.index<(n.keyedList||r).length;)Uae(r,e,n,function(i,o){if(i){t(i,o);return}if(Object.keys(n.jobs).length===0){t(null,n.results);return}}),n.index++;return Wae.bind(n,t)}});var GN=M((s0e,WP)=>{var m3=JN(),Bae=$N(),qae=HN();WP.exports=Jae;WP.exports.ascending=f3;WP.exports.descending=$ae;function Jae(r,e,t,n){var i=Bae(r,t);return m3(r,e,i,function o(s,a){if(s){n(s,a);return}if(i.index++,i.index<(i.keyedList||r).length){m3(r,e,i,o);return}n(null,i.results)}),qae.bind(i,n)}function f3(r,e){return r<e?-1:r>e?1:0}function $ae(r,e){return-1*f3(r,e)}});var g3=M((a0e,h3)=>{var Hae=GN();h3.exports=Gae;function Gae(r,e,t){return Hae(r,e,null,t)}});var y3=M((c0e,v3)=>{v3.exports={parallel:d3(),serial:g3(),serialOrdered:GN()}});var I3=M((l0e,b3)=>{b3.exports=function(r,e){return Object.keys(e).forEach(function(t){r[t]=r[t]||e[t]}),r}});var C3=M((u0e,x3)=>{var XN=z9(),S3=require("util"),zN=require("path"),zae=require("http"),Qae=require("https"),Yae=require("url").parse,Xae=require("fs"),Zae=require("stream").Stream,QN=t3(),ece=y3(),YN=I3();x3.exports=rr;S3.inherits(rr,XN);function rr(r){if(!(this instanceof rr))return new rr(r);this._overheadLength=0,this._valueLength=0,this._valuesToMeasure=[],XN.call(this),r=r||{};for(var e in r)this[e]=r[e]}rr.LINE_BREAK=`\r
`;rr.DEFAULT_CONTENT_TYPE="application/octet-stream";rr.prototype.append=function(r,e,t){t=t||{},typeof t=="string"&&(t={filename:t});var n=XN.prototype.append.bind(this);if(typeof e=="number"&&(e=""+e),S3.isArray(e)){this._error(new Error("Arrays are not supported."));return}var i=this._multiPartHeader(r,e,t),o=this._multiPartFooter();n(i),n(e),n(o),this._trackLength(i,e,t)};rr.prototype._trackLength=function(r,e,t){var n=0;t.knownLength!=null?n+=+t.knownLength:Buffer.isBuffer(e)?n=e.length:typeof e=="string"&&(n=Buffer.byteLength(e)),this._valueLength+=n,this._overheadLength+=Buffer.byteLength(r)+rr.LINE_BREAK.length,!(!e||!e.path&&!(e.readable&&e.hasOwnProperty("httpVersion"))&&!(e instanceof Zae))&&(t.knownLength||this._valuesToMeasure.push(e))};rr.prototype._lengthRetriever=function(r,e){r.hasOwnProperty("fd")?r.end!=null&&r.end!=1/0&&r.start!=null?e(null,r.end+1-(r.start?r.start:0)):Xae.stat(r.path,function(t,n){var i;if(t){e(t);return}i=n.size-(r.start?r.start:0),e(null,i)}):r.hasOwnProperty("httpVersion")?e(null,+r.headers["content-length"]):r.hasOwnProperty("httpModule")?(r.on("response",function(t){r.pause(),e(null,+t.headers["content-length"])}),r.resume()):e("Unknown stream")};rr.prototype._multiPartHeader=function(r,e,t){if(typeof t.header=="string")return t.header;var n=this._getContentDisposition(e,t),i=this._getContentType(e,t),o="",s={"Content-Disposition":["form-data",'name="'+r+'"'].concat(n||[]),"Content-Type":[].concat(i||[])};typeof t.header=="object"&&YN(s,t.header);var a;for(var c in s)s.hasOwnProperty(c)&&(a=s[c],a!=null&&(Array.isArray(a)||(a=[a]),a.length&&(o+=c+": "+a.join("; ")+rr.LINE_BREAK)));return"--"+this.getBoundary()+rr.LINE_BREAK+o+rr.LINE_BREAK};rr.prototype._getContentDisposition=function(r,e){var t,n;return typeof e.filepath=="string"?t=zN.normalize(e.filepath).replace(/\\/g,"/"):e.filename||r.name||r.path?t=zN.basename(e.filename||r.name||r.path):r.readable&&r.hasOwnProperty("httpVersion")&&(t=zN.basename(r.client._httpMessage.path||"")),t&&(n='filename="'+t+'"'),n};rr.prototype._getContentType=function(r,e){var t=e.contentType;return!t&&r.name&&(t=QN.lookup(r.name)),!t&&r.path&&(t=QN.lookup(r.path)),!t&&r.readable&&r.hasOwnProperty("httpVersion")&&(t=r.headers["content-type"]),!t&&(e.filepath||e.filename)&&(t=QN.lookup(e.filepath||e.filename)),!t&&typeof r=="object"&&(t=rr.DEFAULT_CONTENT_TYPE),t};rr.prototype._multiPartFooter=function(){return function(r){var e=rr.LINE_BREAK,t=this._streams.length===0;t&&(e+=this._lastBoundary()),r(e)}.bind(this)};rr.prototype._lastBoundary=function(){return"--"+this.getBoundary()+"--"+rr.LINE_BREAK};rr.prototype.getHeaders=function(r){var e,t={"content-type":"multipart/form-data; boundary="+this.getBoundary()};for(e in r)r.hasOwnProperty(e)&&(t[e.toLowerCase()]=r[e]);return t};rr.prototype.setBoundary=function(r){this._boundary=r};rr.prototype.getBoundary=function(){return this._boundary||this._generateBoundary(),this._boundary};rr.prototype.getBuffer=function(){for(var r=new Buffer.alloc(0),e=this.getBoundary(),t=0,n=this._streams.length;t<n;t++)typeof this._streams[t]!="function"&&(Buffer.isBuffer(this._streams[t])?r=Buffer.concat([r,this._streams[t]]):r=Buffer.concat([r,Buffer.from(this._streams[t])]),(typeof this._streams[t]!="string"||this._streams[t].substring(2,e.length+2)!==e)&&(r=Buffer.concat([r,Buffer.from(rr.LINE_BREAK)])));return Buffer.concat([r,Buffer.from(this._lastBoundary())])};rr.prototype._generateBoundary=function(){for(var r="--------------------------",e=0;e<24;e++)r+=Math.floor(Math.random()*10).toString(16);this._boundary=r};rr.prototype.getLengthSync=function(){var r=this._overheadLength+this._valueLength;return this._streams.length&&(r+=this._lastBoundary().length),this.hasKnownLength()||this._error(new Error("Cannot calculate proper length in synchronous way.")),r};rr.prototype.hasKnownLength=function(){var r=!0;return this._valuesToMeasure.length&&(r=!1),r};rr.prototype.getLength=function(r){var e=this._overheadLength+this._valueLength;if(this._streams.length&&(e+=this._lastBoundary().length),!this._valuesToMeasure.length){process.nextTick(r.bind(this,null,e));return}ece.parallel(this._valuesToMeasure,this._lengthRetriever,function(t,n){if(t){r(t);return}n.forEach(function(i){e+=i}),r(null,e)})};rr.prototype.submit=function(r,e){var t,n,i={method:"post"};return typeof r=="string"?(r=Yae(r),n=YN({port:r.port,path:r.pathname,host:r.hostname,protocol:r.protocol},i)):(n=YN(r,i),n.port||(n.port=n.protocol=="https:"?443:80)),n.headers=this.getHeaders(r.headers),n.protocol=="https:"?t=Qae.request(n):t=zae.request(n),this.getLength(function(o,s){if(o&&o!=="Unknown stream"){this._error(o);return}if(s&&t.setHeader("Content-Length",s),this.pipe(t),e){var a,c=function(l,u){return t.removeListener("error",c),t.removeListener("response",a),e.call(this,l,u)};a=c.bind(this,null),t.on("error",c),t.on("response",a)}}.bind(this)),t};rr.prototype._error=function(r){this.error||(this.error=r,this.pause(),this.emit("error",r))};rr.prototype.toString=function(){return"[object FormData]"}});var E3=M(w3=>{"use strict";var tce=require("url").parse,rce={ftp:21,gopher:70,http:80,https:443,ws:80,wss:443},nce=String.prototype.endsWith||function(r){return r.length<=this.length&&this.indexOf(r,this.length-r.length)!==-1};function ice(r){var e=typeof r=="string"?tce(r):r||{},t=e.protocol,n=e.host,i=e.port;if(typeof n!="string"||!n||typeof t!="string"||(t=t.split(":",1)[0],n=n.replace(/:\d*$/,""),i=parseInt(i)||rce[t]||0,!oce(n,i)))return"";var o=bg("npm_config_"+t+"_proxy")||bg(t+"_proxy")||bg("npm_config_proxy")||bg("all_proxy");return o&&o.indexOf("://")===-1&&(o=t+"://"+o),o}function oce(r,e){var t=(bg("npm_config_no_proxy")||bg("no_proxy")).toLowerCase();return t?t==="*"?!1:t.split(/[,\s]/).every(function(n){if(!n)return!0;var i=n.match(/^(.+):(\d+)$/),o=i?i[1]:n,s=i?parseInt(i[2]):0;return s&&s!==e?!0:/^[.*]/.test(o)?(o.charAt(0)==="*"&&(o=o.slice(1)),!nce.call(r,o)):r!==o}):!0}function bg(r){return process.env[r.toLowerCase()]||process.env[r.toUpperCase()]||""}w3.getProxyForUrl=ice});var BP=M((d0e,P3)=>{var Ig=1e3,Sg=Ig*60,xg=Sg*60,ym=xg*24,sce=ym*7,ace=ym*365.25;P3.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return cce(r);if(t==="number"&&isFinite(r))return e.long?uce(r):lce(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function cce(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*ace;case"weeks":case"week":case"w":return t*sce;case"days":case"day":case"d":return t*ym;case"hours":case"hour":case"hrs":case"hr":case"h":return t*xg;case"minutes":case"minute":case"mins":case"min":case"m":return t*Sg;case"seconds":case"second":case"secs":case"sec":case"s":return t*Ig;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function lce(r){var e=Math.abs(r);return e>=ym?Math.round(r/ym)+"d":e>=xg?Math.round(r/xg)+"h":e>=Sg?Math.round(r/Sg)+"m":e>=Ig?Math.round(r/Ig)+"s":r+"ms"}function uce(r){var e=Math.abs(r);return e>=ym?VP(r,e,ym,"day"):e>=xg?VP(r,e,xg,"hour"):e>=Sg?VP(r,e,Sg,"minute"):e>=Ig?VP(r,e,Ig,"second"):r+" ms"}function VP(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var ZN=M((m0e,k3)=>{function pce(r){t.debug=t,t.default=t,t.coerce=c,t.disable=o,t.enable=i,t.enabled=s,t.humanize=BP(),t.destroy=l,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let p=0;for(let m=0;m<u.length;m++)p=(p<<5)-p+u.charCodeAt(m),p|=0;return t.colors[Math.abs(p)%t.colors.length]}t.selectColor=e;function t(u){let p,m=null,h,g;function b(...w){if(!b.enabled)return;let k=b,N=Number(new Date),D=N-(p||N);k.diff=D,k.prev=p,k.curr=N,p=N,w[0]=t.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");let V=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,(G,pe)=>{if(G==="%%")return"%";V++;let de=t.formatters[pe];if(typeof de=="function"){let te=w[V];G=de.call(k,te),w.splice(V,1),V--}return G}),t.formatArgs.call(k,w),(k.log||t.log).apply(k,w)}return b.namespace=u,b.useColors=t.useColors(),b.color=t.selectColor(u),b.extend=n,b.destroy=t.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(h!==t.namespaces&&(h=t.namespaces,g=t.enabled(u)),g),set:w=>{m=w}}),typeof t.init=="function"&&t.init(b),b}function n(u,p){let m=t(this.namespace+(typeof p>"u"?":":p)+u);return m.log=this.log,m}function i(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let p,m=(typeof u=="string"?u:"").split(/[\s,]+/),h=m.length;for(p=0;p<h;p++)m[p]&&(u=m[p].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.slice(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function o(){let u=[...t.names.map(a),...t.skips.map(a).map(p=>"-"+p)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let p,m;for(p=0,m=t.skips.length;p<m;p++)if(t.skips[p].test(u))return!1;for(p=0,m=t.names.length;p<m;p++)if(t.names[p].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}k3.exports=pce});var _3=M((jo,qP)=>{jo.formatArgs=mce;jo.save=fce;jo.load=hce;jo.useColors=dce;jo.storage=gce();jo.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();jo.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function dce(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function mce(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+qP.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}jo.log=console.debug||console.log||(()=>{});function fce(r){try{r?jo.storage.setItem("debug",r):jo.storage.removeItem("debug")}catch{}}function hce(){let r;try{r=jo.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function gce(){try{return localStorage}catch{}}qP.exports=ZN()(jo);var{formatters:vce}=qP.exports;vce.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var T3=M((f0e,D3)=>{"use strict";D3.exports=(r,e)=>{e=e||process.argv;let t=r.startsWith("-")?"":r.length===1?"-":"--",n=e.indexOf(t+r),i=e.indexOf("--");return n!==-1&&(i===-1?!0:n<i)}});var JP=M((h0e,R3)=>{"use strict";var yce=require("os"),ga=T3(),Ti=process.env,Cg;ga("no-color")||ga("no-colors")||ga("color=false")?Cg=!1:(ga("color")||ga("colors")||ga("color=true")||ga("color=always"))&&(Cg=!0);"FORCE_COLOR"in Ti&&(Cg=Ti.FORCE_COLOR.length===0||parseInt(Ti.FORCE_COLOR,10)!==0);function bce(r){return r===0?!1:{level:r,hasBasic:!0,has256:r>=2,has16m:r>=3}}function Ice(r){if(Cg===!1)return 0;if(ga("color=16m")||ga("color=full")||ga("color=truecolor"))return 3;if(ga("color=256"))return 2;if(r&&!r.isTTY&&Cg!==!0)return 0;let e=Cg?1:0;if(process.platform==="win32"){let t=yce.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in Ti)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in Ti)||Ti.CI_NAME==="codeship"?1:e;if("TEAMCITY_VERSION"in Ti)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Ti.TEAMCITY_VERSION)?1:0;if(Ti.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Ti){let t=parseInt((Ti.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Ti.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Ti.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Ti.TERM)||"COLORTERM"in Ti?1:(Ti.TERM==="dumb",e)}function eM(r){let e=Ice(r);return bce(e)}R3.exports={supportsColor:eM,stdout:eM(process.stdout),stderr:eM(process.stderr)}});var N3=M((ii,HP)=>{var Sce=require("tty"),$P=require("util");ii.init=_ce;ii.log=Ece;ii.formatArgs=Cce;ii.save=Pce;ii.load=kce;ii.useColors=xce;ii.destroy=$P.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");ii.colors=[6,2,3,4,5,1];try{let r=JP();r&&(r.stderr||r).level>=2&&(ii.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}ii.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function xce(){return"colors"in ii.inspectOpts?!!ii.inspectOpts.colors:Sce.isatty(process.stderr.fd)}function Cce(r){let{namespace:e,useColors:t}=this;if(t){let n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o=`  ${i};1m${e} \x1B[0m`;r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+HP.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=wce()+e+" "+r[0]}function wce(){return ii.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Ece(...r){return process.stderr.write($P.format(...r)+`
`)}function Pce(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function kce(){return process.env.DEBUG}function _ce(r){r.inspectOpts={};let e=Object.keys(ii.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=ii.inspectOpts[e[t]]}HP.exports=ZN()(ii);var{formatters:A3}=HP.exports;A3.o=function(r){return this.inspectOpts.colors=this.useColors,$P.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};A3.O=function(r){return this.inspectOpts.colors=this.useColors,$P.inspect(r,this.inspectOpts)}});var M3=M((g0e,tM)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?tM.exports=_3():tM.exports=N3()});var K3=M((v0e,O3)=>{var cx;O3.exports=function(){if(!cx){try{cx=M3()("follow-redirects")}catch{}typeof cx!="function"&&(cx=function(){})}cx.apply(null,arguments)}});var W3=M((y0e,mM)=>{var px=require("url"),lx=px.URL,Dce=require("http"),Tce=require("https"),sM=require("stream").Writable,aM=require("assert"),F3=K3(),cM=!1;try{aM(new lx)}catch(r){cM=r.code==="ERR_INVALID_URL"}var Rce=["auth","host","hostname","href","path","pathname","port","protocol","query","search"],lM=["abort","aborted","connect","error","socket","timeout"],uM=Object.create(null);lM.forEach(function(r){uM[r]=function(e,t,n){this._redirectable.emit(r,e,t,n)}});var nM=dx("ERR_INVALID_URL","Invalid URL",TypeError),iM=dx("ERR_FR_REDIRECTION_FAILURE","Redirected request failed"),Ace=dx("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded",iM),Nce=dx("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),Mce=dx("ERR_STREAM_WRITE_AFTER_END","write after end"),Oce=sM.prototype.destroy||U3;function mo(r,e){sM.call(this),this._sanitizeOptions(r),this._options=r,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],e&&this.on("response",e);var t=this;this._onNativeResponse=function(n){try{t._processResponse(n)}catch(i){t.emit("error",i instanceof iM?i:new iM({cause:i}))}},this._performRequest()}mo.prototype=Object.create(sM.prototype);mo.prototype.abort=function(){dM(this._currentRequest),this._currentRequest.abort(),this.emit("abort")};mo.prototype.destroy=function(r){return dM(this._currentRequest,r),Oce.call(this,r),this};mo.prototype.write=function(r,e,t){if(this._ending)throw new Mce;if(!bm(r)&&!Lce(r))throw new TypeError("data should be a string, Buffer or Uint8Array");if(ux(e)&&(t=e,e=null),r.length===0){t&&t();return}this._requestBodyLength+r.length<=this._options.maxBodyLength?(this._requestBodyLength+=r.length,this._requestBodyBuffers.push({data:r,encoding:e}),this._currentRequest.write(r,e,t)):(this.emit("error",new Nce),this.abort())};mo.prototype.end=function(r,e,t){if(ux(r)?(t=r,r=e=null):ux(e)&&(t=e,e=null),!r)this._ended=this._ending=!0,this._currentRequest.end(null,null,t);else{var n=this,i=this._currentRequest;this.write(r,e,function(){n._ended=!0,i.end(null,null,t)}),this._ending=!0}};mo.prototype.setHeader=function(r,e){this._options.headers[r]=e,this._currentRequest.setHeader(r,e)};mo.prototype.removeHeader=function(r){delete this._options.headers[r],this._currentRequest.removeHeader(r)};mo.prototype.setTimeout=function(r,e){var t=this;function n(s){s.setTimeout(r),s.removeListener("timeout",s.destroy),s.addListener("timeout",s.destroy)}function i(s){t._timeout&&clearTimeout(t._timeout),t._timeout=setTimeout(function(){t.emit("timeout"),o()},r),n(s)}function o(){t._timeout&&(clearTimeout(t._timeout),t._timeout=null),t.removeListener("abort",o),t.removeListener("error",o),t.removeListener("response",o),t.removeListener("close",o),e&&t.removeListener("timeout",e),t.socket||t._currentRequest.removeListener("socket",i)}return e&&this.on("timeout",e),this.socket?i(this.socket):this._currentRequest.once("socket",i),this.on("socket",n),this.on("abort",o),this.on("error",o),this.on("response",o),this.on("close",o),this};["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach(function(r){mo.prototype[r]=function(e,t){return this._currentRequest[r](e,t)}});["aborted","connection","socket"].forEach(function(r){Object.defineProperty(mo.prototype,r,{get:function(){return this._currentRequest[r]}})});mo.prototype._sanitizeOptions=function(r){if(r.headers||(r.headers={}),r.host&&(r.hostname||(r.hostname=r.host),delete r.host),!r.pathname&&r.path){var e=r.path.indexOf("?");e<0?r.pathname=r.path:(r.pathname=r.path.substring(0,e),r.search=r.path.substring(e))}};mo.prototype._performRequest=function(){var r=this._options.protocol,e=this._options.nativeProtocols[r];if(!e)throw new TypeError("Unsupported protocol "+r);if(this._options.agents){var t=r.slice(0,-1);this._options.agent=this._options.agents[t]}var n=this._currentRequest=e.request(this._options,this._onNativeResponse);n._redirectable=this;for(var i of lM)n.on(i,uM[i]);if(this._currentUrl=/^\//.test(this._options.path)?px.format(this._options):this._options.path,this._isRedirect){var o=0,s=this,a=this._requestBodyBuffers;(function c(l){if(n===s._currentRequest)if(l)s.emit("error",l);else if(o<a.length){var u=a[o++];n.finished||n.write(u.data,u.encoding,c)}else s._ended&&n.end()})()}};mo.prototype._processResponse=function(r){var e=r.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:r.headers,statusCode:e});var t=r.headers.location;if(!t||this._options.followRedirects===!1||e<300||e>=400){r.responseUrl=this._currentUrl,r.redirects=this._redirects,this.emit("response",r),this._requestBodyBuffers=[];return}if(dM(this._currentRequest),r.destroy(),++this._redirectCount>this._options.maxRedirects)throw new Ace;var n,i=this._options.beforeRedirect;i&&(n=Object.assign({Host:r.req.getHeader("host")},this._options.headers));var o=this._options.method;((e===301||e===302)&&this._options.method==="POST"||e===303&&!/^(?:GET|HEAD)$/.test(this._options.method))&&(this._options.method="GET",this._requestBodyBuffers=[],rM(/^content-/i,this._options.headers));var s=rM(/^host$/i,this._options.headers),a=pM(this._currentUrl),c=s||a.host,l=/^\w+:/.test(t)?this._currentUrl:px.format(Object.assign(a,{host:c})),u=Kce(t,l);if(F3("redirecting to",u.href),this._isRedirect=!0,oM(u,this._options),(u.protocol!==a.protocol&&u.protocol!=="https:"||u.host!==c&&!Fce(u.host,c))&&rM(/^(?:authorization|cookie)$/i,this._options.headers),ux(i)){var p={headers:r.headers,statusCode:e},m={url:l,method:o,headers:n};i(this._options,p,m),this._sanitizeOptions(this._options)}this._performRequest()};function L3(r){var e={maxRedirects:21,maxBodyLength:10485760},t={};return Object.keys(r).forEach(function(n){var i=n+":",o=t[i]=r[n],s=e[n]=Object.create(o);function a(l,u,p){return Uce(l)?l=oM(l):bm(l)?l=oM(pM(l)):(p=u,u=j3(l),l={protocol:i}),ux(u)&&(p=u,u=null),u=Object.assign({maxRedirects:e.maxRedirects,maxBodyLength:e.maxBodyLength},l,u),u.nativeProtocols=t,!bm(u.host)&&!bm(u.hostname)&&(u.hostname="::1"),aM.equal(u.protocol,i,"protocol mismatch"),F3("options",u),new mo(u,p)}function c(l,u,p){var m=s.request(l,u,p);return m.end(),m}Object.defineProperties(s,{request:{value:a,configurable:!0,enumerable:!0,writable:!0},get:{value:c,configurable:!0,enumerable:!0,writable:!0}})}),e}function U3(){}function pM(r){var e;if(cM)e=new lx(r);else if(e=j3(px.parse(r)),!bm(e.protocol))throw new nM({input:r});return e}function Kce(r,e){return cM?new lx(r,e):pM(px.resolve(e,r))}function j3(r){if(/^\[/.test(r.hostname)&&!/^\[[:0-9a-f]+\]$/i.test(r.hostname))throw new nM({input:r.href||r});if(/^\[/.test(r.host)&&!/^\[[:0-9a-f]+\](:\d+)?$/i.test(r.host))throw new nM({input:r.href||r});return r}function oM(r,e){var t=e||{};for(var n of Rce)t[n]=r[n];return t.hostname.startsWith("[")&&(t.hostname=t.hostname.slice(1,-1)),t.port!==""&&(t.port=Number(t.port)),t.path=t.search?t.pathname+t.search:t.pathname,t}function rM(r,e){var t;for(var n in e)r.test(n)&&(t=e[n],delete e[n]);return t===null||typeof t>"u"?void 0:String(t).trim()}function dx(r,e,t){function n(i){Error.captureStackTrace(this,this.constructor),Object.assign(this,i||{}),this.code=r,this.message=this.cause?e+": "+this.cause.message:e}return n.prototype=new(t||Error),Object.defineProperties(n.prototype,{constructor:{value:n,enumerable:!1},name:{value:"Error ["+r+"]",enumerable:!1}}),n}function dM(r,e){for(var t of lM)r.removeListener(t,uM[t]);r.on("error",U3),r.destroy(e)}function Fce(r,e){aM(bm(r)&&bm(e));var t=r.length-e.length-1;return t>0&&r[t]==="."&&r.endsWith(e)}function bm(r){return typeof r=="string"||r instanceof String}function ux(r){return typeof r=="function"}function Lce(r){return typeof r=="object"&&"length"in r}function Uce(r){return lx&&r instanceof lx}mM.exports=L3({http:Dce,https:Tce});mM.exports.wrap=L3});var RB=M((b0e,TB)=>{"use strict";var jce=C3(),Wce=require("url"),Vce=E3(),Bce=require("http"),qce=require("https"),oB=require("util"),Jce=W3(),$ce=require("zlib"),sB=require("stream"),Hce=require("events");function jl(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var aB=jl(jce),Gce=jl(Wce),zce=jl(Bce),Qce=jl(qce),Yce=jl(oB),Xce=jl(Jce),Ep=jl($ce),Cp=jl(sB),Zce=jl(Hce);function cB(r,e){return function(){return r.apply(e,arguments)}}var{toString:ele}=Object.prototype,{getPrototypeOf:_M}=Object,ZP=(r=>e=>{let t=ele.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Nc=r=>(r=r.toLowerCase(),e=>ZP(e)===r),ek=r=>e=>typeof e===r,{isArray:kg}=Array,hx=ek("undefined");function tle(r){return r!==null&&!hx(r)&&r.constructor!==null&&!hx(r.constructor)&&_s(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}var lB=Nc("ArrayBuffer");function rle(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&lB(r.buffer),e}var nle=ek("string"),_s=ek("function"),uB=ek("number"),tk=r=>r!==null&&typeof r=="object",ile=r=>r===!0||r===!1,zP=r=>{if(ZP(r)!=="object")return!1;let e=_M(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},ole=Nc("Date"),sle=Nc("File"),ale=Nc("Blob"),cle=Nc("FileList"),lle=r=>tk(r)&&_s(r.pipe),ule=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||_s(r.append)&&((e=ZP(r))==="formdata"||e==="object"&&_s(r.toString)&&r.toString()==="[object FormData]"))},ple=Nc("URLSearchParams"),dle=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function vx(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r>"u")return;let n,i;if(typeof r!="object"&&(r=[r]),kg(r))for(n=0,i=r.length;n<i;n++)e.call(null,r[n],n,r);else{let o=t?Object.getOwnPropertyNames(r):Object.keys(r),s=o.length,a;for(n=0;n<s;n++)a=o[n],e.call(null,r[a],a,r)}}function pB(r,e){e=e.toLowerCase();let t=Object.keys(r),n=t.length,i;for(;n-- >0;)if(i=t[n],e===i.toLowerCase())return i;return null}var dB=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),mB=r=>!hx(r)&&r!==dB;function yM(){let{caseless:r}=mB(this)&&this||{},e={},t=(n,i)=>{let o=r&&pB(e,i)||i;zP(e[o])&&zP(n)?e[o]=yM(e[o],n):zP(n)?e[o]=yM({},n):kg(n)?e[o]=n.slice():e[o]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&vx(arguments[n],t);return e}var mle=(r,e,t,{allOwnKeys:n}={})=>(vx(e,(i,o)=>{t&&_s(i)?r[o]=cB(i,t):r[o]=i},{allOwnKeys:n}),r),fle=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),hle=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},gle=(r,e,t,n)=>{let i,o,s,a={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),o=i.length;o-- >0;)s=i[o],(!n||n(s,r,e))&&!a[s]&&(e[s]=r[s],a[s]=!0);r=t!==!1&&_M(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},vle=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;let n=r.indexOf(e,t);return n!==-1&&n===t},yle=r=>{if(!r)return null;if(kg(r))return r;let e=r.length;if(!uB(e))return null;let t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},ble=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&_M(Uint8Array)),Ile=(r,e)=>{let n=(r&&r[Symbol.iterator]).call(r),i;for(;(i=n.next())&&!i.done;){let o=i.value;e.call(r,o[0],o[1])}},Sle=(r,e)=>{let t,n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},xle=Nc("HTMLFormElement"),Cle=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),V3=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),wle=Nc("RegExp"),fB=(r,e)=>{let t=Object.getOwnPropertyDescriptors(r),n={};vx(t,(i,o)=>{let s;(s=e(i,o,r))!==!1&&(n[o]=s||i)}),Object.defineProperties(r,n)},Ele=r=>{fB(r,(e,t)=>{if(_s(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;let n=r[t];if(_s(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Ple=(r,e)=>{let t={},n=i=>{i.forEach(o=>{t[o]=!0})};return kg(r)?n(r):n(String(r).split(e)),t},kle=()=>{},_le=(r,e)=>(r=+r,Number.isFinite(r)?r:e),fM="abcdefghijklmnopqrstuvwxyz",B3="0123456789",hB={DIGIT:B3,ALPHA:fM,ALPHA_DIGIT:fM+fM.toUpperCase()+B3},Dle=(r=16,e=hB.ALPHA_DIGIT)=>{let t="",{length:n}=e;for(;r--;)t+=e[Math.random()*n|0];return t};function Tle(r){return!!(r&&_s(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}var Rle=r=>{let e=new Array(10),t=(n,i)=>{if(tk(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;let o=kg(n)?[]:{};return vx(n,(s,a)=>{let c=t(s,i+1);!hx(c)&&(o[a]=c)}),e[i]=void 0,o}}return n};return t(r,0)},Ale=Nc("AsyncFunction"),Nle=r=>r&&(tk(r)||_s(r))&&_s(r.then)&&_s(r.catch),ee={isArray:kg,isArrayBuffer:lB,isBuffer:tle,isFormData:ule,isArrayBufferView:rle,isString:nle,isNumber:uB,isBoolean:ile,isObject:tk,isPlainObject:zP,isUndefined:hx,isDate:ole,isFile:sle,isBlob:ale,isRegExp:wle,isFunction:_s,isStream:lle,isURLSearchParams:ple,isTypedArray:ble,isFileList:cle,forEach:vx,merge:yM,extend:mle,trim:dle,stripBOM:fle,inherits:hle,toFlatObject:gle,kindOf:ZP,kindOfTest:Nc,endsWith:vle,toArray:yle,forEachEntry:Ile,matchAll:Sle,isHTMLForm:xle,hasOwnProperty:V3,hasOwnProp:V3,reduceDescriptors:fB,freezeMethods:Ele,toObjectSet:Ple,toCamelCase:Cle,noop:kle,toFiniteNumber:_le,findKey:pB,global:dB,isContextDefined:mB,ALPHABET:hB,generateString:Dle,isSpecCompliantForm:Tle,toJSONObject:Rle,isAsyncFn:Ale,isThenable:Nle};function Qe(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i)}ee.inherits(Qe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ee.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var gB=Qe.prototype,vB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{vB[r]={value:r}});Object.defineProperties(Qe,vB);Object.defineProperty(gB,"isAxiosError",{value:!0});Qe.from=(r,e,t,n,i,o)=>{let s=Object.create(gB);return ee.toFlatObject(r,s,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),Qe.call(s,r.message,e,t,n,i),s.cause=r,s.name=r.name,o&&Object.assign(s,o),s};function bM(r){return ee.isPlainObject(r)||ee.isArray(r)}function yB(r){return ee.endsWith(r,"[]")?r.slice(0,-2):r}function q3(r,e,t){return r?r.concat(e).map(function(i,o){return i=yB(i),!t&&o?"["+i+"]":i}).join(t?".":""):e}function Mle(r){return ee.isArray(r)&&!r.some(bM)}var Ole=ee.toFlatObject(ee,{},null,function(e){return/^is[A-Z]/.test(e)});function rk(r,e,t){if(!ee.isObject(r))throw new TypeError("target must be an object");e=e||new(aB.default||FormData),t=ee.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,w){return!ee.isUndefined(w[b])});let n=t.metaTokens,i=t.visitor||u,o=t.dots,s=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&ee.isSpecCompliantForm(e);if(!ee.isFunction(i))throw new TypeError("visitor must be a function");function l(g){if(g===null)return"";if(ee.isDate(g))return g.toISOString();if(!c&&ee.isBlob(g))throw new Qe("Blob is not supported. Use a Buffer instead.");return ee.isArrayBuffer(g)||ee.isTypedArray(g)?c&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function u(g,b,w){let k=g;if(g&&!w&&typeof g=="object"){if(ee.endsWith(b,"{}"))b=n?b:b.slice(0,-2),g=JSON.stringify(g);else if(ee.isArray(g)&&Mle(g)||(ee.isFileList(g)||ee.endsWith(b,"[]"))&&(k=ee.toArray(g)))return b=yB(b),k.forEach(function(D,V){!(ee.isUndefined(D)||D===null)&&e.append(s===!0?q3([b],V,o):s===null?b:b+"[]",l(D))}),!1}return bM(g)?!0:(e.append(q3(w,b,o),l(g)),!1)}let p=[],m=Object.assign(Ole,{defaultVisitor:u,convertValue:l,isVisitable:bM});function h(g,b){if(!ee.isUndefined(g)){if(p.indexOf(g)!==-1)throw Error("Circular reference detected in "+b.join("."));p.push(g),ee.forEach(g,function(k,N){(!(ee.isUndefined(k)||k===null)&&i.call(e,k,ee.isString(N)?N.trim():N,b,m))===!0&&h(k,b?b.concat(N):[N])}),p.pop()}}if(!ee.isObject(r))throw new TypeError("data must be an object");return h(r),e}function J3(r){let e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function bB(r,e){this._pairs=[],r&&rk(r,this,e)}var IB=bB.prototype;IB.append=function(e,t){this._pairs.push([e,t])};IB.toString=function(e){let t=e?function(n){return e.call(this,n,J3)}:J3;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function Kle(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function DM(r,e,t){if(!e)return r;let n=t&&t.encode||Kle,i=t&&t.serialize,o;if(i?o=i(e,t):o=ee.isURLSearchParams(e)?e.toString():new bB(e,t).toString(n),o){let s=r.indexOf("#");s!==-1&&(r=r.slice(0,s)),r+=(r.indexOf("?")===-1?"?":"&")+o}return r}var IM=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ee.forEach(this.handlers,function(n){n!==null&&e(n)})}},$3=IM,TM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Fle=Gce.default.URLSearchParams,Lle={isNode:!0,classes:{URLSearchParams:Fle,FormData:aB.default,Blob:typeof Blob<"u"&&Blob||null},protocols:["http","https","file","data"]},SB=typeof window<"u"&&typeof document<"u",Ule=(r=>SB&&["ReactNative","NativeScript","NS"].indexOf(r)<0)(typeof navigator<"u"&&navigator.product),jle=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Wle=Object.freeze({__proto__:null,hasBrowserEnv:SB,hasStandardBrowserWebWorkerEnv:jle,hasStandardBrowserEnv:Ule}),ks={...Wle,...Lle};function Vle(r,e){return rk(r,new ks.classes.URLSearchParams,Object.assign({visitor:function(t,n,i,o){return ks.isNode&&ee.isBuffer(t)?(this.append(n,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function Ble(r){return ee.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function qle(r){let e={},t=Object.keys(r),n,i=t.length,o;for(n=0;n<i;n++)o=t[n],e[o]=r[o];return e}function xB(r){function e(t,n,i,o){let s=t[o++],a=Number.isFinite(+s),c=o>=t.length;return s=!s&&ee.isArray(i)?i.length:s,c?(ee.hasOwnProp(i,s)?i[s]=[i[s],n]:i[s]=n,!a):((!i[s]||!ee.isObject(i[s]))&&(i[s]=[]),e(t,n,i[s],o)&&ee.isArray(i[s])&&(i[s]=qle(i[s])),!a)}if(ee.isFormData(r)&&ee.isFunction(r.entries)){let t={};return ee.forEachEntry(r,(n,i)=>{e(Ble(n),i,t,0)}),t}return null}function Jle(r,e,t){if(ee.isString(r))try{return(e||JSON.parse)(r),ee.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}var RM={transitional:TM,adapter:["xhr","http"],transformRequest:[function(e,t){let n=t.getContentType()||"",i=n.indexOf("application/json")>-1,o=ee.isObject(e);if(o&&ee.isHTMLForm(e)&&(e=new FormData(e)),ee.isFormData(e))return i&&i?JSON.stringify(xB(e)):e;if(ee.isArrayBuffer(e)||ee.isBuffer(e)||ee.isStream(e)||ee.isFile(e)||ee.isBlob(e))return e;if(ee.isArrayBufferView(e))return e.buffer;if(ee.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Vle(e,this.formSerializer).toString();if((a=ee.isFileList(e))||n.indexOf("multipart/form-data")>-1){let c=this.env&&this.env.FormData;return rk(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return o||i?(t.setContentType("application/json",!1),Jle(e)):e}],transformResponse:[function(e){let t=this.transitional||RM.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&ee.isString(e)&&(n&&!this.responseType||i)){let s=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(s)throw a.name==="SyntaxError"?Qe.from(a,Qe.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ks.classes.FormData,Blob:ks.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ee.forEach(["delete","get","head","post","put","patch"],r=>{RM.headers[r]={}});var AM=RM,$le=ee.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Hle=r=>{let e={},t,n,i;return r&&r.split(`
`).forEach(function(s){i=s.indexOf(":"),t=s.substring(0,i).trim().toLowerCase(),n=s.substring(i+1).trim(),!(!t||e[t]&&$le[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},H3=Symbol("internals");function mx(r){return r&&String(r).trim().toLowerCase()}function QP(r){return r===!1||r==null?r:ee.isArray(r)?r.map(QP):String(r)}function Gle(r){let e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}var zle=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function hM(r,e,t,n,i){if(ee.isFunction(n))return n.call(this,e,t);if(i&&(e=t),!!ee.isString(e)){if(ee.isString(n))return e.indexOf(n)!==-1;if(ee.isRegExp(n))return n.test(e)}}function Qle(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function Yle(r,e){let t=ee.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(i,o,s){return this[n].call(this,e,i,o,s)},configurable:!0})})}var wg=class{constructor(e){e&&this.set(e)}set(e,t,n){let i=this;function o(a,c,l){let u=mx(c);if(!u)throw new Error("header name must be a non-empty string");let p=ee.findKey(i,u);(!p||i[p]===void 0||l===!0||l===void 0&&i[p]!==!1)&&(i[p||c]=QP(a))}let s=(a,c)=>ee.forEach(a,(l,u)=>o(l,u,c));return ee.isPlainObject(e)||e instanceof this.constructor?s(e,t):ee.isString(e)&&(e=e.trim())&&!zle(e)?s(Hle(e),t):e!=null&&o(t,e,n),this}get(e,t){if(e=mx(e),e){let n=ee.findKey(this,e);if(n){let i=this[n];if(!t)return i;if(t===!0)return Gle(i);if(ee.isFunction(t))return t.call(this,i,n);if(ee.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=mx(e),e){let n=ee.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||hM(this,this[n],n,t)))}return!1}delete(e,t){let n=this,i=!1;function o(s){if(s=mx(s),s){let a=ee.findKey(n,s);a&&(!t||hM(n,n[a],a,t))&&(delete n[a],i=!0)}}return ee.isArray(e)?e.forEach(o):o(e),i}clear(e){let t=Object.keys(this),n=t.length,i=!1;for(;n--;){let o=t[n];(!e||hM(this,this[o],o,e,!0))&&(delete this[o],i=!0)}return i}normalize(e){let t=this,n={};return ee.forEach(this,(i,o)=>{let s=ee.findKey(n,o);if(s){t[s]=QP(i),delete t[o];return}let a=e?Qle(o):String(o).trim();a!==o&&delete t[o],t[a]=QP(i),n[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let t=Object.create(null);return ee.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&ee.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){let n=new this(e);return t.forEach(i=>n.set(i)),n}static accessor(e){let n=(this[H3]=this[H3]={accessors:{}}).accessors,i=this.prototype;function o(s){let a=mx(s);n[a]||(Yle(i,s),n[a]=!0)}return ee.isArray(e)?e.forEach(o):o(e),this}};wg.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ee.reduceDescriptors(wg.prototype,({value:r},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(n){this[t]=n}}});ee.freezeMethods(wg);var Ds=wg;function gM(r,e){let t=this||AM,n=e||t,i=Ds.from(n.headers),o=n.data;return ee.forEach(r,function(a){o=a.call(t,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function CB(r){return!!(r&&r.__CANCEL__)}function Im(r,e,t){Qe.call(this,r??"canceled",Qe.ERR_CANCELED,e,t),this.name="CanceledError"}ee.inherits(Im,Qe,{__CANCEL__:!0});function fx(r,e,t){let n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new Qe("Request failed with status code "+t.status,[Qe.ERR_BAD_REQUEST,Qe.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Xle(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function Zle(r,e){return e?r.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):r}function NM(r,e){return r&&!Xle(e)?Zle(r,e):e}var XP="1.6.1";function wB(r){let e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}var eue=/^(?:([^;]+);)?(?:[^;]+;)?(base64|),([\s\S]*)$/;function tue(r,e,t){let n=t&&t.Blob||ks.classes.Blob,i=wB(r);if(e===void 0&&n&&(e=!0),i==="data"){r=i.length?r.slice(i.length+1):r;let o=eue.exec(r);if(!o)throw new Qe("Invalid URL",Qe.ERR_INVALID_URL);let s=o[1],a=o[2],c=o[3],l=Buffer.from(decodeURIComponent(c),a?"base64":"utf8");if(e){if(!n)throw new Qe("Blob is not supported",Qe.ERR_NOT_SUPPORT);return new n([l],{type:s})}return l}throw new Qe("Unsupported protocol "+i,Qe.ERR_NOT_SUPPORT)}function rue(r,e){let t=0,n=1e3/e,i=null;return function(s,a){let c=Date.now();if(s||c-t>n)return i&&(clearTimeout(i),i=null),t=c,r.apply(null,a);i||(i=setTimeout(()=>(i=null,t=Date.now(),r.apply(null,a)),n-(c-t)))}}function EB(r,e){r=r||10;let t=new Array(r),n=new Array(r),i=0,o=0,s;return e=e!==void 0?e:1e3,function(c){let l=Date.now(),u=n[o];s||(s=l),t[i]=c,n[i]=l;let p=o,m=0;for(;p!==i;)m+=t[p++],p=p%r;if(i=(i+1)%r,i===o&&(o=(o+1)%r),l-s<e)return;let h=u&&l-u;return h?Math.round(m*1e3/h):void 0}}var GP=Symbol("internals"),SM=class extends Cp.default.Transform{constructor(e){e=ee.toFlatObject(e,{maxRate:0,chunkSize:64*1024,minChunkSize:100,timeWindow:500,ticksRate:2,samplesCount:15},null,(a,c)=>!ee.isUndefined(c[a])),super({readableHighWaterMark:e.chunkSize});let t=this,n=this[GP]={length:e.length,timeWindow:e.timeWindow,ticksRate:e.ticksRate,chunkSize:e.chunkSize,maxRate:e.maxRate,minChunkSize:e.minChunkSize,bytesSeen:0,isCaptured:!1,notifiedBytesLoaded:0,ts:Date.now(),bytes:0,onReadCallback:null},i=EB(n.ticksRate*e.samplesCount,n.timeWindow);this.on("newListener",a=>{a==="progress"&&(n.isCaptured||(n.isCaptured=!0))});let o=0;n.updateProgress=rue(function(){let c=n.length,l=n.bytesSeen,u=l-o;if(!u||t.destroyed)return;let p=i(u);o=l,process.nextTick(()=>{t.emit("progress",{loaded:l,total:c,progress:c?l/c:void 0,bytes:u,rate:p||void 0,estimated:p&&c&&l<=c?(c-l)/p:void 0})})},n.ticksRate);let s=()=>{n.updateProgress(!0)};this.once("end",s),this.once("error",s)}_read(e){let t=this[GP];return t.onReadCallback&&t.onReadCallback(),super._read(e)}_transform(e,t,n){let i=this,o=this[GP],s=o.maxRate,a=this.readableHighWaterMark,c=o.timeWindow,l=1e3/c,u=s/l,p=o.minChunkSize!==!1?Math.max(o.minChunkSize,u*.01):0;function m(g,b){let w=Buffer.byteLength(g);o.bytesSeen+=w,o.bytes+=w,o.isCaptured&&o.updateProgress(),i.push(g)?process.nextTick(b):o.onReadCallback=()=>{o.onReadCallback=null,process.nextTick(b)}}let h=(g,b)=>{let w=Buffer.byteLength(g),k=null,N=a,D,V=0;if(s){let oe=Date.now();(!o.ts||(V=oe-o.ts)>=c)&&(o.ts=oe,D=u-o.bytes,o.bytes=D<0?-D:0,V=0),D=u-o.bytes}if(s){if(D<=0)return setTimeout(()=>{b(null,g)},c-V);D<N&&(N=D)}N&&w>N&&w-N>p&&(k=g.subarray(N),g=g.subarray(0,N)),m(g,k?()=>{process.nextTick(b,null,k)}:b)};h(e,function g(b,w){if(b)return n(b);w?h(w,g):n(null)})}setLength(e){return this[GP].length=+e,this}},G3=SM,{asyncIterator:z3}=Symbol,nue=async function*(r){r.stream?yield*r.stream():r.arrayBuffer?yield await r.arrayBuffer():r[z3]?yield*r[z3]():yield r},PB=nue,iue=ee.ALPHABET.ALPHA_DIGIT+"-_",gx=new oB.TextEncoder,wp=`\r
`,oue=gx.encode(wp),sue=2,xM=class{constructor(e,t){let{escapeName:n}=this.constructor,i=ee.isString(t),o=`Content-Disposition: form-data; name="${n(e)}"${!i&&t.name?`; filename="${n(t.name)}"`:""}${wp}`;i?t=gx.encode(String(t).replace(/\r?\n|\r\n?/g,wp)):o+=`Content-Type: ${t.type||"application/octet-stream"}${wp}`,this.headers=gx.encode(o+wp),this.contentLength=i?t.byteLength:t.size,this.size=this.headers.byteLength+this.contentLength+sue,this.name=e,this.value=t}async*encode(){yield this.headers;let{value:e}=this;ee.isTypedArray(e)?yield e:yield*PB(e),yield oue}static escapeName(e){return String(e).replace(/[\r\n"]/g,t=>({"\r":"%0D","\n":"%0A",'"':"%22"})[t])}},aue=(r,e,t)=>{let{tag:n="form-data-boundary",size:i=25,boundary:o=n+"-"+ee.generateString(i,iue)}=t||{};if(!ee.isFormData(r))throw TypeError("FormData instance required");if(o.length<1||o.length>70)throw Error("boundary must be 10-70 characters long");let s=gx.encode("--"+o+wp),a=gx.encode("--"+o+"--"+wp+wp),c=a.byteLength,l=Array.from(r.entries()).map(([p,m])=>{let h=new xM(p,m);return c+=h.size,h});c+=s.byteLength*l.length,c=ee.toFiniteNumber(c);let u={"Content-Type":`multipart/form-data; boundary=${o}`};return Number.isFinite(c)&&(u["Content-Length"]=c),e&&e(u),sB.Readable.from(async function*(){for(let p of l)yield s,yield*p.encode();yield a}())},cue=aue,CM=class extends Cp.default.Transform{__transform(e,t,n){this.push(e),n()}_transform(e,t,n){if(e.length!==0&&(this._transform=this.__transform,e[0]!==120)){let i=Buffer.alloc(2);i[0]=120,i[1]=156,this.push(i,t)}this.__transform(e,t,n)}},lue=CM,uue=(r,e)=>ee.isAsyncFn(r)?function(...t){let n=t.pop();r.apply(this,t).then(i=>{try{e?n(null,...e(i)):n(null,i)}catch(o){n(o)}},n)}:r,pue=uue,Q3={flush:Ep.default.constants.Z_SYNC_FLUSH,finishFlush:Ep.default.constants.Z_SYNC_FLUSH},due={flush:Ep.default.constants.BROTLI_OPERATION_FLUSH,finishFlush:Ep.default.constants.BROTLI_OPERATION_FLUSH},Y3=ee.isFunction(Ep.default.createBrotliDecompress),{http:mue,https:fue}=Xce.default,hue=/https:?/,X3=ks.protocols.map(r=>r+":");function gue(r){r.beforeRedirects.proxy&&r.beforeRedirects.proxy(r),r.beforeRedirects.config&&r.beforeRedirects.config(r)}function kB(r,e,t){let n=e;if(!n&&n!==!1){let i=Vce.getProxyForUrl(t);i&&(n=new URL(i))}if(n){if(n.username&&(n.auth=(n.username||"")+":"+(n.password||"")),n.auth){(n.auth.username||n.auth.password)&&(n.auth=(n.auth.username||"")+":"+(n.auth.password||""));let o=Buffer.from(n.auth,"utf8").toString("base64");r.headers["Proxy-Authorization"]="Basic "+o}r.headers.host=r.hostname+(r.port?":"+r.port:"");let i=n.hostname||n.host;r.hostname=i,r.host=i,r.port=n.port,r.path=t,n.protocol&&(r.protocol=n.protocol.includes(":")?n.protocol:`${n.protocol}:`)}r.beforeRedirects.proxy=function(o){kB(o,e,o.href)}}var vue=typeof process<"u"&&ee.kindOf(process)==="process",yue=r=>new Promise((e,t)=>{let n,i,o=(c,l)=>{i||(i=!0,n&&n(c,l))},s=c=>{o(c),e(c)},a=c=>{o(c,!0),t(c)};r(s,a,c=>n=c).catch(a)}),bue=({address:r,family:e})=>{if(!ee.isString(r))throw TypeError("address must be a string");return{address:r,family:e||(r.indexOf(".")<0?6:4)}},Z3=(r,e)=>bue(ee.isObject(r)?r:{address:r,family:e}),Iue=vue&&function(e){return yue(async function(n,i,o){let{data:s,lookup:a,family:c}=e,{responseType:l,responseEncoding:u}=e,p=e.method.toUpperCase(),m,h=!1,g;if(a){let Z=pue(a,ve=>ee.isArray(ve)?ve:[ve]);a=(ve,Be,dn)=>{Z(ve,Be,(Et,jr,ls)=>{let Vt=ee.isArray(jr)?jr.map(en=>Z3(en)):[Z3(jr,ls)];Be.all?dn(Et,Vt):dn(Et,Vt[0].address,Vt[0].family)})}}let b=new Zce.default,w=()=>{e.cancelToken&&e.cancelToken.unsubscribe(k),e.signal&&e.signal.removeEventListener("abort",k),b.removeAllListeners()};o((Z,ve)=>{m=!0,ve&&(h=!0,w())});function k(Z){b.emit("abort",!Z||Z.type?new Im(null,e,g):Z)}b.once("abort",i),(e.cancelToken||e.signal)&&(e.cancelToken&&e.cancelToken.subscribe(k),e.signal&&(e.signal.aborted?k():e.signal.addEventListener("abort",k)));let N=NM(e.baseURL,e.url),D=new URL(N,"http://localhost"),V=D.protocol||X3[0];if(V==="data:"){let Z;if(p!=="GET")return fx(n,i,{status:405,statusText:"method not allowed",headers:{},config:e});try{Z=tue(e.url,l==="blob",{Blob:e.env&&e.env.Blob})}catch(ve){throw Qe.from(ve,Qe.ERR_BAD_REQUEST,e)}return l==="text"?(Z=Z.toString(u),(!u||u==="utf8")&&(Z=ee.stripBOM(Z))):l==="stream"&&(Z=Cp.default.Readable.from(Z)),fx(n,i,{data:Z,status:200,statusText:"OK",headers:new Ds,config:e})}if(X3.indexOf(V)===-1)return i(new Qe("Unsupported protocol "+V,Qe.ERR_BAD_REQUEST,e));let oe=Ds.from(e.headers).normalize();oe.set("User-Agent","axios/"+XP,!1);let G=e.onDownloadProgress,pe=e.onUploadProgress,de=e.maxRate,te,we;if(ee.isSpecCompliantForm(s)){let Z=oe.getContentType(/boundary=([-_\w\d]{10,70})/i);s=cue(s,ve=>{oe.set(ve)},{tag:`axios-${XP}-boundary`,boundary:Z&&Z[1]||void 0})}else if(ee.isFormData(s)&&ee.isFunction(s.getHeaders)){if(oe.set(s.getHeaders()),!oe.hasContentLength())try{let Z=await Yce.default.promisify(s.getLength).call(s);Number.isFinite(Z)&&Z>=0&&oe.setContentLength(Z)}catch{}}else if(ee.isBlob(s))s.size&&oe.setContentType(s.type||"application/octet-stream"),oe.setContentLength(s.size||0),s=Cp.default.Readable.from(PB(s));else if(s&&!ee.isStream(s)){if(!Buffer.isBuffer(s))if(ee.isArrayBuffer(s))s=Buffer.from(new Uint8Array(s));else if(ee.isString(s))s=Buffer.from(s,"utf-8");else return i(new Qe("Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream",Qe.ERR_BAD_REQUEST,e));if(oe.setContentLength(s.length,!1),e.maxBodyLength>-1&&s.length>e.maxBodyLength)return i(new Qe("Request body larger than maxBodyLength limit",Qe.ERR_BAD_REQUEST,e))}let Ue=ee.toFiniteNumber(oe.getContentLength());ee.isArray(de)?(te=de[0],we=de[1]):te=we=de,s&&(pe||te)&&(ee.isStream(s)||(s=Cp.default.Readable.from(s,{objectMode:!1})),s=Cp.default.pipeline([s,new G3({length:Ue,maxRate:ee.toFiniteNumber(te)})],ee.noop),pe&&s.on("progress",Z=>{pe(Object.assign(Z,{upload:!0}))}));let ct;if(e.auth){let Z=e.auth.username||"",ve=e.auth.password||"";ct=Z+":"+ve}if(!ct&&D.username){let Z=D.username,ve=D.password;ct=Z+":"+ve}ct&&oe.delete("authorization");let ft;try{ft=DM(D.pathname+D.search,e.params,e.paramsSerializer).replace(/^\?/,"")}catch(Z){let ve=new Error(Z.message);return ve.config=e,ve.url=e.url,ve.exists=!0,i(ve)}oe.set("Accept-Encoding","gzip, compress, deflate"+(Y3?", br":""),!1);let rt={path:ft,method:p,headers:oe.toJSON(),agents:{http:e.httpAgent,https:e.httpsAgent},auth:ct,protocol:V,family:c,beforeRedirect:gue,beforeRedirects:{}};!ee.isUndefined(a)&&(rt.lookup=a),e.socketPath?rt.socketPath=e.socketPath:(rt.hostname=D.hostname,rt.port=D.port,kB(rt,e.proxy,V+"//"+D.hostname+(D.port?":"+D.port:"")+rt.path));let ae,ke=hue.test(rt.protocol);if(rt.agent=ke?e.httpsAgent:e.httpAgent,e.transport?ae=e.transport:e.maxRedirects===0?ae=ke?Qce.default:zce.default:(e.maxRedirects&&(rt.maxRedirects=e.maxRedirects),e.beforeRedirect&&(rt.beforeRedirects.config=e.beforeRedirect),ae=ke?fue:mue),e.maxBodyLength>-1?rt.maxBodyLength=e.maxBodyLength:rt.maxBodyLength=1/0,e.insecureHTTPParser&&(rt.insecureHTTPParser=e.insecureHTTPParser),g=ae.request(rt,function(ve){if(g.destroyed)return;let Be=[ve],dn=+ve.headers["content-length"];if(G){let en=new G3({length:ee.toFiniteNumber(dn),maxRate:ee.toFiniteNumber(we)});G&&en.on("progress",Fi=>{G(Object.assign(Fi,{download:!0}))}),Be.push(en)}let Et=ve,jr=ve.req||g;if(e.decompress!==!1&&ve.headers["content-encoding"])switch((p==="HEAD"||ve.statusCode===204)&&delete ve.headers["content-encoding"],(ve.headers["content-encoding"]||"").toLowerCase()){case"gzip":case"x-gzip":case"compress":case"x-compress":Be.push(Ep.default.createUnzip(Q3)),delete ve.headers["content-encoding"];break;case"deflate":Be.push(new lue),Be.push(Ep.default.createUnzip(Q3)),delete ve.headers["content-encoding"];break;case"br":Y3&&(Be.push(Ep.default.createBrotliDecompress(due)),delete ve.headers["content-encoding"])}Et=Be.length>1?Cp.default.pipeline(Be,ee.noop):Be[0];let ls=Cp.default.finished(Et,()=>{ls(),w()}),Vt={status:ve.statusCode,statusText:ve.statusMessage,headers:new Ds(ve.headers),config:e,request:jr};if(l==="stream")Vt.data=Et,fx(n,i,Vt);else{let en=[],Fi=0;Et.on("data",function(or){en.push(or),Fi+=or.length,e.maxContentLength>-1&&Fi>e.maxContentLength&&(h=!0,Et.destroy(),i(new Qe("maxContentLength size of "+e.maxContentLength+" exceeded",Qe.ERR_BAD_RESPONSE,e,jr)))}),Et.on("aborted",function(){if(h)return;let or=new Qe("maxContentLength size of "+e.maxContentLength+" exceeded",Qe.ERR_BAD_RESPONSE,e,jr);Et.destroy(or),i(or)}),Et.on("error",function(or){g.destroyed||i(Qe.from(or,null,e,jr))}),Et.on("end",function(){try{let or=en.length===1?en[0]:Buffer.concat(en);l!=="arraybuffer"&&(or=or.toString(u),(!u||u==="utf8")&&(or=ee.stripBOM(or))),Vt.data=or}catch(or){return i(Qe.from(or,null,e,Vt.request,Vt))}fx(n,i,Vt)})}b.once("abort",en=>{Et.destroyed||(Et.emit("error",en),Et.destroy())})}),b.once("abort",Z=>{i(Z),g.destroy(Z)}),g.on("error",function(ve){i(Qe.from(ve,null,e,g))}),g.on("socket",function(ve){ve.setKeepAlive(!0,1e3*60)}),e.timeout){let Z=parseInt(e.timeout,10);if(Number.isNaN(Z)){i(new Qe("error trying to parse `config.timeout` to int",Qe.ERR_BAD_OPTION_VALUE,e,g));return}g.setTimeout(Z,function(){if(m)return;let Be=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",dn=e.transitional||TM;e.timeoutErrorMessage&&(Be=e.timeoutErrorMessage),i(new Qe(Be,dn.clarifyTimeoutError?Qe.ETIMEDOUT:Qe.ECONNABORTED,e,g)),k()})}if(ee.isStream(s)){let Z=!1,ve=!1;s.on("end",()=>{Z=!0}),s.once("error",Be=>{ve=!0,g.destroy(Be)}),s.on("close",()=>{!Z&&!ve&&k(new Im("Request stream has been aborted",e,g))}),s.pipe(g)}else g.end(s)})},Sue=ks.hasStandardBrowserEnv?function(){return{write:function(t,n,i,o,s,a){let c=[];c.push(t+"="+encodeURIComponent(n)),ee.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),ee.isString(o)&&c.push("path="+o),ee.isString(s)&&c.push("domain="+s),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(t){let n=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),xue=ks.hasStandardBrowserEnv?function(){let e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a"),n;function i(o){let s=o;return e&&(t.setAttribute("href",s),s=t.href),t.setAttribute("href",s),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(s){let a=ee.isString(s)?i(s):s;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}();function eB(r,e){let t=0,n=EB(50,250);return i=>{let o=i.loaded,s=i.lengthComputable?i.total:void 0,a=o-t,c=n(a),l=o<=s;t=o;let u={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:c||void 0,estimated:c&&s&&l?(s-o)/c:void 0,event:i};u[e?"download":"upload"]=!0,r(u)}}var Cue=typeof XMLHttpRequest<"u",wue=Cue&&function(r){return new Promise(function(t,n){let i=r.data,o=Ds.from(r.headers).normalize(),s=r.responseType,a;function c(){r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}let l;if(ee.isFormData(i)){if(ks.hasStandardBrowserEnv||ks.hasStandardBrowserWebWorkerEnv)o.setContentType(!1);else if((l=o.getContentType())!==!1){let[g,...b]=l?l.split(";").map(w=>w.trim()).filter(Boolean):[];o.setContentType([g||"multipart/form-data",...b].join("; "))}}let u=new XMLHttpRequest;if(r.auth){let g=r.auth.username||"",b=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";o.set("Authorization","Basic "+btoa(g+":"+b))}let p=NM(r.baseURL,r.url);u.open(r.method.toUpperCase(),DM(p,r.params,r.paramsSerializer),!0),u.timeout=r.timeout;function m(){if(!u)return;let g=Ds.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),w={data:!s||s==="text"||s==="json"?u.responseText:u.response,status:u.status,statusText:u.statusText,headers:g,config:r,request:u};fx(function(N){t(N),c()},function(N){n(N),c()},w),u=null}if("onloadend"in u?u.onloadend=m:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(m)},u.onabort=function(){u&&(n(new Qe("Request aborted",Qe.ECONNABORTED,r,u)),u=null)},u.onerror=function(){n(new Qe("Network Error",Qe.ERR_NETWORK,r,u)),u=null},u.ontimeout=function(){let b=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded",w=r.transitional||TM;r.timeoutErrorMessage&&(b=r.timeoutErrorMessage),n(new Qe(b,w.clarifyTimeoutError?Qe.ETIMEDOUT:Qe.ECONNABORTED,r,u)),u=null},ks.hasStandardBrowserEnv){let g=xue(p)&&r.xsrfCookieName&&Sue.read(r.xsrfCookieName);g&&o.set(r.xsrfHeaderName,g)}i===void 0&&o.setContentType(null),"setRequestHeader"in u&&ee.forEach(o.toJSON(),function(b,w){u.setRequestHeader(w,b)}),ee.isUndefined(r.withCredentials)||(u.withCredentials=!!r.withCredentials),s&&s!=="json"&&(u.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&u.addEventListener("progress",eB(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",eB(r.onUploadProgress)),(r.cancelToken||r.signal)&&(a=g=>{u&&(n(!g||g.type?new Im(null,r,u):g),u.abort(),u=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));let h=wB(p);if(h&&ks.protocols.indexOf(h)===-1){n(new Qe("Unsupported protocol "+h+":",Qe.ERR_BAD_REQUEST,r));return}u.send(i||null)})},wM={http:Iue,xhr:wue};ee.forEach(wM,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});var tB=r=>`- ${r}`,Eue=r=>ee.isFunction(r)||r===null||r===!1,_B={getAdapter:r=>{r=ee.isArray(r)?r:[r];let{length:e}=r,t,n,i={};for(let o=0;o<e;o++){t=r[o];let s;if(n=t,!Eue(t)&&(n=wM[(s=String(t)).toLowerCase()],n===void 0))throw new Qe(`Unknown adapter '${s}'`);if(n)break;i[s||"#"+o]=n}if(!n){let o=Object.entries(i).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build")),s=e?o.length>1?`since :
`+o.map(tB).join(`
`):" "+tB(o[0]):"as no adapter specified";throw new Qe("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return n},adapters:wM};function vM(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Im(null,r)}function rB(r){return vM(r),r.headers=Ds.from(r.headers),r.data=gM.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),_B.getAdapter(r.adapter||AM.adapter)(r).then(function(n){return vM(r),n.data=gM.call(r,r.transformResponse,n),n.headers=Ds.from(n.headers),n},function(n){return CB(n)||(vM(r),n&&n.response&&(n.response.data=gM.call(r,r.transformResponse,n.response),n.response.headers=Ds.from(n.response.headers))),Promise.reject(n)})}var nB=r=>r instanceof Ds?r.toJSON():r;function Eg(r,e){e=e||{};let t={};function n(l,u,p){return ee.isPlainObject(l)&&ee.isPlainObject(u)?ee.merge.call({caseless:p},l,u):ee.isPlainObject(u)?ee.merge({},u):ee.isArray(u)?u.slice():u}function i(l,u,p){if(ee.isUndefined(u)){if(!ee.isUndefined(l))return n(void 0,l,p)}else return n(l,u,p)}function o(l,u){if(!ee.isUndefined(u))return n(void 0,u)}function s(l,u){if(ee.isUndefined(u)){if(!ee.isUndefined(l))return n(void 0,l)}else return n(void 0,u)}function a(l,u,p){if(p in e)return n(l,u);if(p in r)return n(void 0,l)}let c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(l,u)=>i(nB(l),nB(u),!0)};return ee.forEach(Object.keys(Object.assign({},r,e)),function(u){let p=c[u]||i,m=p(r[u],e[u],u);ee.isUndefined(m)&&p!==a||(t[u]=m)}),t}var MM={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{MM[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});var iB={};MM.transitional=function(e,t,n){function i(o,s){return"[Axios v"+XP+"] Transitional option '"+o+"'"+s+(n?". "+n:"")}return(o,s,a)=>{if(e===!1)throw new Qe(i(s," has been removed"+(t?" in "+t:"")),Qe.ERR_DEPRECATED);return t&&!iB[s]&&(iB[s]=!0,console.warn(i(s," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(o,s,a):!0}};function Pue(r,e,t){if(typeof r!="object")throw new Qe("options must be an object",Qe.ERR_BAD_OPTION_VALUE);let n=Object.keys(r),i=n.length;for(;i-- >0;){let o=n[i],s=e[o];if(s){let a=r[o],c=a===void 0||s(a,o,r);if(c!==!0)throw new Qe("option "+o+" must be "+c,Qe.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Qe("Unknown option "+o,Qe.ERR_BAD_OPTION)}}var EM={assertOptions:Pue,validators:MM},xp=EM.validators,Pg=class{constructor(e){this.defaults=e,this.interceptors={request:new $3,response:new $3}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Eg(this.defaults,t);let{transitional:n,paramsSerializer:i,headers:o}=t;n!==void 0&&EM.assertOptions(n,{silentJSONParsing:xp.transitional(xp.boolean),forcedJSONParsing:xp.transitional(xp.boolean),clarifyTimeoutError:xp.transitional(xp.boolean)},!1),i!=null&&(ee.isFunction(i)?t.paramsSerializer={serialize:i}:EM.assertOptions(i,{encode:xp.function,serialize:xp.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=o&&ee.merge(o.common,o[t.method]);o&&ee.forEach(["delete","get","head","post","put","patch","common"],g=>{delete o[g]}),t.headers=Ds.concat(s,o);let a=[],c=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(t)===!1||(c=c&&b.synchronous,a.unshift(b.fulfilled,b.rejected))});let l=[];this.interceptors.response.forEach(function(b){l.push(b.fulfilled,b.rejected)});let u,p=0,m;if(!c){let g=[rB.bind(this),void 0];for(g.unshift.apply(g,a),g.push.apply(g,l),m=g.length,u=Promise.resolve(t);p<m;)u=u.then(g[p++],g[p++]);return u}m=a.length;let h=t;for(p=0;p<m;){let g=a[p++],b=a[p++];try{h=g(h)}catch(w){b.call(this,w);break}}try{u=rB.call(this,h)}catch(g){return Promise.reject(g)}for(p=0,m=l.length;p<m;)u=u.then(l[p++],l[p++]);return u}getUri(e){e=Eg(this.defaults,e);let t=NM(e.baseURL,e.url);return DM(t,e.params,e.paramsSerializer)}};ee.forEach(["delete","get","head","options"],function(e){Pg.prototype[e]=function(t,n){return this.request(Eg(n||{},{method:e,url:t,data:(n||{}).data}))}});ee.forEach(["post","put","patch"],function(e){function t(n){return function(o,s,a){return this.request(Eg(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}Pg.prototype[e]=t(),Pg.prototype[e+"Form"]=t(!0)});var YP=Pg,PM=class r{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(o){t=o});let n=this;this.promise.then(i=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](i);n._listeners=null}),this.promise.then=i=>{let o,s=new Promise(a=>{n.subscribe(a),o=a}).then(i);return s.cancel=function(){n.unsubscribe(o)},s},e(function(o,s,a){n.reason||(n.reason=new Im(o,s,a),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new r(function(i){e=i}),cancel:e}}},kue=PM;function _ue(r){return function(t){return r.apply(null,t)}}function Due(r){return ee.isObject(r)&&r.isAxiosError===!0}var kM={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(kM).forEach(([r,e])=>{kM[e]=r});var Tue=kM;function DB(r){let e=new YP(r),t=cB(YP.prototype.request,e);return ee.extend(t,YP.prototype,e,{allOwnKeys:!0}),ee.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return DB(Eg(r,i))},t}var _n=DB(AM);_n.Axios=YP;_n.CanceledError=Im;_n.CancelToken=kue;_n.isCancel=CB;_n.VERSION=XP;_n.toFormData=rk;_n.AxiosError=Qe;_n.Cancel=_n.CanceledError;_n.all=function(e){return Promise.all(e)};_n.spread=_ue;_n.isAxiosError=Due;_n.mergeConfig=Eg;_n.AxiosHeaders=Ds;_n.formToJSON=r=>xB(ee.isHTMLForm(r)?new FormData(r):r);_n.getAdapter=_B.getAdapter;_n.HttpStatusCode=Tue;_n.default=_n;TB.exports=_n});var AB=M(nk=>{"use strict";Object.defineProperty(nk,"__esModule",{value:!0});nk.AxiosHttpClient=void 0;var Rue=RB(),OM=class{constructor(e){this.endpoint=e}get(e){return Rue.default.get(this.endpoint,Object.assign(Object.assign({},e),{proxy:!1}))}};nk.AxiosHttpClient=OM});var NB=M(ik=>{"use strict";Object.defineProperty(ik,"__esModule",{value:!0});ik.MemoryKeyValueStorage=void 0;var KM=class{constructor(){this.storage=new Map}async getValue(e,t){return this.storage.has(e)?await Promise.resolve(this.storage.get(e)):await Promise.resolve(t||void 0)}setValue(e,t){this.storage.set(e,t)}};ik.MemoryKeyValueStorage=KM});var MB=M(ok=>{"use strict";Object.defineProperty(ok,"__esModule",{value:!0});ok.ExperimentationServiceBase=void 0;var Aue=NB(),FM=class{get features(){return this._features}set features(e){this._features=e,this.telemetry&&this.telemetry.setSharedProperty(this.assignmentContextTelemetryPropertyName,this.features.assignmentContext)}constructor(e,t,n,i,o){this.telemetry=e,this.assignmentContextTelemetryPropertyName=t,this.telemetryEventName=n,this.storageKey=i,this.storage=o,this.featuresConsumed=!1,this.cachedTelemetryEvents=[],this._features={features:[],assignmentContext:"",configs:[]},this.storageKey||(this.storageKey="ABExp.Features"),this.storage||(o=new Aue.MemoryKeyValueStorage),this.loadCachePromise=this.loadCachedFeatureData(),this.initializePromise=this.loadCachePromise,this.initialFetch=new Promise((s,a)=>{this.resolveInitialFetchPromise=s})}async getFeaturesAsync(e=!1){if(this.fetchPromise!=null){try{await this.fetchPromise}catch{}return this.features}if(!this.featureProviders||this.featureProviders.length===0)return Promise.resolve({features:[],assignmentContext:"",configs:[]});try{this.fetchPromise=Promise.all(this.featureProviders.map(async n=>await n.getFeatures()));let t=await this.fetchPromise;this.updateFeatures(t,e)}catch{}return this.fetchPromise=void 0,this.resolveInitialFetchPromise&&(this.resolveInitialFetchPromise(),this.resolveInitialFetchPromise=void 0),this.features}updateFeatures(e,t=!1){let n={features:[],assignmentContext:"",configs:[]};for(let i of e){for(let o of i.features)n.features.includes(o)||n.features.push(o);for(let o of i.configs){let s=n.configs.find(a=>a.Id===o.Id);s?s.Parameters=Object.assign(Object.assign({},s.Parameters),o.Parameters):n.configs.push(o)}n.assignmentContext+=i.assignmentContext}(t||!this.featuresConsumed)&&(this.features=n),this.storage&&this.storage.setValue(this.storageKey,n)}async loadCachedFeatureData(){let e;this.storage&&(e=await this.storage.getValue(this.storageKey),e!==void 0&&e.configs===void 0&&(e.configs=[])),this.features.features.length===0&&(this.features=e||{features:[],assignmentContext:"",configs:[]})}isFlightEnabled(e){return this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isCachedFlightEnabled(e){return await this.loadCachePromise,this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isFlightEnabledAsync(e){let t=await this.getFeaturesAsync(!0);return this.featuresConsumed=!0,this.PostEventToTelemetry(e),t.features.includes(e)}getTreatmentVariable(e,t){this.featuresConsumed=!0,this.PostEventToTelemetry(`${e}.${t}`);let n=this.features.configs.find(i=>i.Id===e);return n?.Parameters[t]}async getTreatmentVariableAsync(e,t,n){if(n){let i=this.featuresConsumed,o=this.getTreatmentVariable(e,t);if(o===void 0)this.featuresConsumed=i;else return o}return await this.getFeaturesAsync(!0),this.getTreatmentVariable(e,t)}PostEventToTelemetry(e){this.cachedTelemetryEvents.includes(e)||(this.telemetry.postEvent(this.telemetryEventName,new Map([["ABExp.queriedFeature",e]])),this.cachedTelemetryEvents.push(e))}invokeInit(){this.init()}addFeatureProvider(...e){if(!(e==null||this.featureProviders==null))for(let t of e)this.featureProviders.push(t)}};ok.ExperimentationServiceBase=FM});var OB=M(sk=>{"use strict";Object.defineProperty(sk,"__esModule",{value:!0});sk.PollingService=void 0;var LM=class{constructor(e){this.fetchInterval=e}StopPolling(){clearInterval(this.intervalHandle),this.intervalHandle=void 0}OnPollTick(e){this.onTick=e}StartPolling(e=!1){this.intervalHandle&&this.StopPolling(),this.onTick!=null&&(e&&this.onTick().then(()=>{}).catch(()=>{}),this.intervalHandle=setInterval(async()=>{await this.onTick()},this.fetchInterval),this.intervalHandle.unref&&this.intervalHandle.unref())}};sk.PollingService=LM});var KB=M(ak=>{"use strict";Object.defineProperty(ak,"__esModule",{value:!0});ak.ExperimentationServiceAutoPolling=void 0;var Nue=MB(),Mue=OB(),UM=class extends Nue.ExperimentationServiceBase{constructor(e,t,n,i,o,s,a){if(super(e,i,o,s,a),this.telemetry=e,this.filterProviders=t,this.refreshRateMs=n,this.assignmentContextTelemetryPropertyName=i,this.telemetryEventName=o,this.storageKey=s,this.storage=a,n<1e3&&n!==0)throw new Error("The minimum refresh rate for polling is 1000 ms (1 second). If you wish to deactivate this auto-polling use value of 0.");n>0&&(this.pollingService=new Mue.PollingService(n),this.pollingService.OnPollTick(async()=>{await super.getFeaturesAsync()}))}init(){this.pollingService?this.pollingService.StartPolling(!0):super.getFeaturesAsync()}async getFeaturesAsync(e=!1){if(this.pollingService){this.pollingService.StopPolling();let t=await super.getFeaturesAsync(e);return this.pollingService.StartPolling(),t}else return await super.getFeaturesAsync(e)}};ak.ExperimentationServiceAutoPolling=UM});var FB=M(lk=>{"use strict";Object.defineProperty(lk,"__esModule",{value:!0});lk.ExperimentationService=void 0;var Oue=V9(),Kue=AB(),Fue=KB(),ck=class extends Fue.ExperimentationServiceAutoPolling{constructor(e){super(e.telemetry,e.filterProviders||[],e.refetchInterval!=null?e.refetchInterval:0,e.assignmentContextTelemetryPropertyName,e.telemetryEventName,e.storageKey,e.keyValueStorage),this.options=e,this.invokeInit()}init(){this.featureProviders=[],this.addFeatureProvider(new Oue.TasApiFeatureProvider(new Kue.AxiosHttpClient(this.options.endpoint),this.telemetry,this.filterProviders)),super.init()}};lk.ExperimentationService=ck;ck.REFRESH_RATE_IN_MINUTES=30});var LB=M(uk=>{"use strict";Object.defineProperty(uk,"__esModule",{value:!0});uk.ExperimentationService=void 0;var Lue=FB();Object.defineProperty(uk,"ExperimentationService",{enumerable:!0,get:function(){return Lue.ExperimentationService}})});var UB=M(pk=>{"use strict";Object.defineProperty(pk,"__esModule",{value:!0});pk.MementoKeyValueStorage=void 0;var jM=class{constructor(e){this.mementoGlobalStorage=e}async getValue(e,t){return await this.mementoGlobalStorage.get(e)||t}setValue(e,t){this.mementoGlobalStorage.update(e,t)}};pk.MementoKeyValueStorage=jM});var jB=M(VM=>{"use strict";Object.defineProperty(VM,"__esModule",{value:!0});var WM=class{constructor(){this.initializePromise=Promise.resolve(),this.initialFetch=Promise.resolve()}isFlightEnabled(e){return!1}isCachedFlightEnabled(e){return Promise.resolve(!1)}isFlightEnabledAsync(e){return Promise.resolve(!1)}getTreatmentVariable(e,t){}getTreatmentVariableAsync(e,t){return Promise.resolve(void 0)}};VM.default=WM});var VB=M(_g=>{"use strict";Object.defineProperty(_g,"__esModule",{value:!0});_g.getExperimentationServiceAsync=_g.getExperimentationService=void 0;var Uue=LN(),jue=LB(),BM=require("vscode"),Wue=UB(),Vue=jB(),Bue="https://default.exp-tas.com/vscode/ab",que="query-expfeature",Jue="abexp.assignmentcontext",$ue="VSCode.ABExp.FeatureData",Hue=1e3*60*30;function WB(r,e,t,n,i,...o){if(!i)throw new Error("Memento storage was not provided.");let s=BM.workspace.getConfiguration("telemetry");if(!(BM.env.isTelemetryEnabled===void 0?s.get("enableTelemetry",!0):BM.env.isTelemetryEnabled))return new Vue.default;let l=[new Uue.VSCodeFilterProvider(r,e,t),...o],u=new Wue.MementoKeyValueStorage(i);return new jue.ExperimentationService({filterProviders:l,telemetry:n,storageKey:$ue,keyValueStorage:u,featuresTelemetryPropertyName:"",assignmentContextTelemetryPropertyName:Jue,telemetryEventName:que,endpoint:Bue,refetchInterval:Hue})}_g.getExperimentationService=WB;async function Gue(r,e,t,n,i,...o){let s=WB(r,e,t,n,i,...o);return await s.initializePromise,s}_g.getExperimentationServiceAsync=Gue});var qB=M(Pp=>{"use strict";Object.defineProperty(Pp,"__esModule",{value:!0});Pp.TargetPopulation=Pp.getExperimentationServiceAsync=Pp.getExperimentationService=void 0;var BB=VB();Object.defineProperty(Pp,"getExperimentationService",{enumerable:!0,get:function(){return BB.getExperimentationService}});Object.defineProperty(Pp,"getExperimentationServiceAsync",{enumerable:!0,get:function(){return BB.getExperimentationServiceAsync}});var zue=LN();Object.defineProperty(Pp,"TargetPopulation",{enumerable:!0,get:function(){return zue.TargetPopulation}})});var ZB=M((A1e,XB)=>{"use strict";function Xue(){let r=[].slice.call(arguments).filter(t=>t),e=r.shift();return r.forEach(t=>{Object.keys(t).forEach(n=>{e[n]=t[n]})}),e}XB.exports=Xue});var ho=M(HM=>{"use strict";HM.fromCallback=function(r){return Object.defineProperty(function(){if(typeof arguments[arguments.length-1]=="function")r.apply(this,arguments);else return new Promise((e,t)=>{arguments[arguments.length]=(n,i)=>{if(n)return t(n);e(i)},arguments.length++,r.apply(this,arguments)})},"name",{value:r.name})};HM.fromPromise=function(r){return Object.defineProperty(function(){let e=arguments[arguments.length-1];if(typeof e!="function")return r.apply(this,arguments);r.apply(this,arguments).then(t=>e(null,t),e)},"name",{value:r.name})}});var t6=M((M1e,e6)=>{var Dp=require("constants"),Zue=process.cwd,vk=null,epe=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return vk||(vk=Zue.call(process)),vk};try{process.cwd()}catch{}typeof process.chdir=="function"&&(GM=process.chdir,process.chdir=function(r){vk=null,GM.call(process,r)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,GM));var GM;e6.exports=tpe;function tpe(r){Dp.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(r),r.lutimes||t(r),r.chown=o(r.chown),r.fchown=o(r.fchown),r.lchown=o(r.lchown),r.chmod=n(r.chmod),r.fchmod=n(r.fchmod),r.lchmod=n(r.lchmod),r.chownSync=s(r.chownSync),r.fchownSync=s(r.fchownSync),r.lchownSync=s(r.lchownSync),r.chmodSync=i(r.chmodSync),r.fchmodSync=i(r.fchmodSync),r.lchmodSync=i(r.lchmodSync),r.stat=a(r.stat),r.fstat=a(r.fstat),r.lstat=a(r.lstat),r.statSync=c(r.statSync),r.fstatSync=c(r.fstatSync),r.lstatSync=c(r.lstatSync),r.chmod&&!r.lchmod&&(r.lchmod=function(u,p,m){m&&process.nextTick(m)},r.lchmodSync=function(){}),r.chown&&!r.lchown&&(r.lchown=function(u,p,m,h){h&&process.nextTick(h)},r.lchownSync=function(){}),epe==="win32"&&(r.rename=typeof r.rename!="function"?r.rename:function(u){function p(m,h,g){var b=Date.now(),w=0;u(m,h,function k(N){if(N&&(N.code==="EACCES"||N.code==="EPERM")&&Date.now()-b<6e4){setTimeout(function(){r.stat(h,function(D,V){D&&D.code==="ENOENT"?u(m,h,k):g(N)})},w),w<100&&(w+=10);return}g&&g(N)})}return Object.setPrototypeOf&&Object.setPrototypeOf(p,u),p}(r.rename)),r.read=typeof r.read!="function"?r.read:function(u){function p(m,h,g,b,w,k){var N;if(k&&typeof k=="function"){var D=0;N=function(V,oe,G){if(V&&V.code==="EAGAIN"&&D<10)return D++,u.call(r,m,h,g,b,w,N);k.apply(this,arguments)}}return u.call(r,m,h,g,b,w,N)}return Object.setPrototypeOf&&Object.setPrototypeOf(p,u),p}(r.read),r.readSync=typeof r.readSync!="function"?r.readSync:function(u){return function(p,m,h,g,b){for(var w=0;;)try{return u.call(r,p,m,h,g,b)}catch(k){if(k.code==="EAGAIN"&&w<10){w++;continue}throw k}}}(r.readSync);function e(u){u.lchmod=function(p,m,h){u.open(p,Dp.O_WRONLY|Dp.O_SYMLINK,m,function(g,b){if(g){h&&h(g);return}u.fchmod(b,m,function(w){u.close(b,function(k){h&&h(w||k)})})})},u.lchmodSync=function(p,m){var h=u.openSync(p,Dp.O_WRONLY|Dp.O_SYMLINK,m),g=!0,b;try{b=u.fchmodSync(h,m),g=!1}finally{if(g)try{u.closeSync(h)}catch{}else u.closeSync(h)}return b}}function t(u){Dp.hasOwnProperty("O_SYMLINK")&&u.futimes?(u.lutimes=function(p,m,h,g){u.open(p,Dp.O_SYMLINK,function(b,w){if(b){g&&g(b);return}u.futimes(w,m,h,function(k){u.close(w,function(N){g&&g(k||N)})})})},u.lutimesSync=function(p,m,h){var g=u.openSync(p,Dp.O_SYMLINK),b,w=!0;try{b=u.futimesSync(g,m,h),w=!1}finally{if(w)try{u.closeSync(g)}catch{}else u.closeSync(g)}return b}):u.futimes&&(u.lutimes=function(p,m,h,g){g&&process.nextTick(g)},u.lutimesSync=function(){})}function n(u){return u&&function(p,m,h){return u.call(r,p,m,function(g){l(g)&&(g=null),h&&h.apply(this,arguments)})}}function i(u){return u&&function(p,m){try{return u.call(r,p,m)}catch(h){if(!l(h))throw h}}}function o(u){return u&&function(p,m,h,g){return u.call(r,p,m,h,function(b){l(b)&&(b=null),g&&g.apply(this,arguments)})}}function s(u){return u&&function(p,m,h){try{return u.call(r,p,m,h)}catch(g){if(!l(g))throw g}}}function a(u){return u&&function(p,m,h){typeof m=="function"&&(h=m,m=null);function g(b,w){w&&(w.uid<0&&(w.uid+=4294967296),w.gid<0&&(w.gid+=4294967296)),h&&h.apply(this,arguments)}return m?u.call(r,p,m,g):u.call(r,p,g)}}function c(u){return u&&function(p,m){var h=m?u.call(r,p,m):u.call(r,p);return h&&(h.uid<0&&(h.uid+=4294967296),h.gid<0&&(h.gid+=4294967296)),h}}function l(u){if(!u||u.code==="ENOSYS")return!0;var p=!process.getuid||process.getuid()!==0;return!!(p&&(u.code==="EINVAL"||u.code==="EPERM"))}}});var i6=M((O1e,n6)=>{var r6=require("stream").Stream;n6.exports=rpe;function rpe(r){return{ReadStream:e,WriteStream:t};function e(n,i){if(!(this instanceof e))return new e(n,i);r6.call(this);var o=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var s=Object.keys(i),a=0,c=s.length;a<c;a++){var l=s[a];this[l]=i[l]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){o._read()});return}r.open(this.path,this.flags,this.mode,function(u,p){if(u){o.emit("error",u),o.readable=!1;return}o.fd=p,o.emit("open",p),o._read()})}function t(n,i){if(!(this instanceof t))return new t(n,i);r6.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var o=Object.keys(i),s=0,a=o.length;s<a;s++){var c=o[s];this[c]=i[c]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=r.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var s6=M((K1e,o6)=>{"use strict";o6.exports=ipe;var npe=Object.getPrototypeOf||function(r){return r.__proto__};function ipe(r){if(r===null||typeof r!="object")return r;if(r instanceof Object)var e={__proto__:npe(r)};else var e=Object.create(null);return Object.getOwnPropertyNames(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}),e}});var Dn=M((F1e,YM)=>{var ln=require("fs"),ope=t6(),spe=i6(),ape=s6(),yk=require("util"),oi,Ik;typeof Symbol=="function"&&typeof Symbol.for=="function"?(oi=Symbol.for("graceful-fs.queue"),Ik=Symbol.for("graceful-fs.previous")):(oi="___graceful-fs.queue",Ik="___graceful-fs.previous");function cpe(){}function l6(r,e){Object.defineProperty(r,oi,{get:function(){return e}})}var Sm=cpe;yk.debuglog?Sm=yk.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Sm=function(){var r=yk.format.apply(yk,arguments);r="GFS4: "+r.split(/\n/).join(`
GFS4: `),console.error(r)});ln[oi]||(a6=global[oi]||[],l6(ln,a6),ln.close=function(r){function e(t,n){return r.call(ln,t,function(i){i||c6(),typeof n=="function"&&n.apply(this,arguments)})}return Object.defineProperty(e,Ik,{value:r}),e}(ln.close),ln.closeSync=function(r){function e(t){r.apply(ln,arguments),c6()}return Object.defineProperty(e,Ik,{value:r}),e}(ln.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){Sm(ln[oi]),require("assert").equal(ln[oi].length,0)}));var a6;global[oi]||l6(global,ln[oi]);YM.exports=zM(ape(ln));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!ln.__patched&&(YM.exports=zM(ln),ln.__patched=!0);function zM(r){ope(r),r.gracefulify=zM,r.createReadStream=oe,r.createWriteStream=G;var e=r.readFile;r.readFile=t;function t(te,we,Ue){return typeof we=="function"&&(Ue=we,we=null),ct(te,we,Ue);function ct(ft,rt,ae,ke){return e(ft,rt,function(Z){Z&&(Z.code==="EMFILE"||Z.code==="ENFILE")?Fg([ct,[ft,rt,ae],Z,ke||Date.now(),Date.now()]):typeof ae=="function"&&ae.apply(this,arguments)})}}var n=r.writeFile;r.writeFile=i;function i(te,we,Ue,ct){return typeof Ue=="function"&&(ct=Ue,Ue=null),ft(te,we,Ue,ct);function ft(rt,ae,ke,Z,ve){return n(rt,ae,ke,function(Be){Be&&(Be.code==="EMFILE"||Be.code==="ENFILE")?Fg([ft,[rt,ae,ke,Z],Be,ve||Date.now(),Date.now()]):typeof Z=="function"&&Z.apply(this,arguments)})}}var o=r.appendFile;o&&(r.appendFile=s);function s(te,we,Ue,ct){return typeof Ue=="function"&&(ct=Ue,Ue=null),ft(te,we,Ue,ct);function ft(rt,ae,ke,Z,ve){return o(rt,ae,ke,function(Be){Be&&(Be.code==="EMFILE"||Be.code==="ENFILE")?Fg([ft,[rt,ae,ke,Z],Be,ve||Date.now(),Date.now()]):typeof Z=="function"&&Z.apply(this,arguments)})}}var a=r.copyFile;a&&(r.copyFile=c);function c(te,we,Ue,ct){return typeof Ue=="function"&&(ct=Ue,Ue=0),ft(te,we,Ue,ct);function ft(rt,ae,ke,Z,ve){return a(rt,ae,ke,function(Be){Be&&(Be.code==="EMFILE"||Be.code==="ENFILE")?Fg([ft,[rt,ae,ke,Z],Be,ve||Date.now(),Date.now()]):typeof Z=="function"&&Z.apply(this,arguments)})}}var l=r.readdir;r.readdir=p;var u=/^v[0-5]\./;function p(te,we,Ue){typeof we=="function"&&(Ue=we,we=null);var ct=u.test(process.version)?function(ae,ke,Z,ve){return l(ae,ft(ae,ke,Z,ve))}:function(ae,ke,Z,ve){return l(ae,ke,ft(ae,ke,Z,ve))};return ct(te,we,Ue);function ft(rt,ae,ke,Z){return function(ve,Be){ve&&(ve.code==="EMFILE"||ve.code==="ENFILE")?Fg([ct,[rt,ae,ke],ve,Z||Date.now(),Date.now()]):(Be&&Be.sort&&Be.sort(),typeof ke=="function"&&ke.call(this,ve,Be))}}}if(process.version.substr(0,4)==="v0.8"){var m=spe(r);k=m.ReadStream,D=m.WriteStream}var h=r.ReadStream;h&&(k.prototype=Object.create(h.prototype),k.prototype.open=N);var g=r.WriteStream;g&&(D.prototype=Object.create(g.prototype),D.prototype.open=V),Object.defineProperty(r,"ReadStream",{get:function(){return k},set:function(te){k=te},enumerable:!0,configurable:!0}),Object.defineProperty(r,"WriteStream",{get:function(){return D},set:function(te){D=te},enumerable:!0,configurable:!0});var b=k;Object.defineProperty(r,"FileReadStream",{get:function(){return b},set:function(te){b=te},enumerable:!0,configurable:!0});var w=D;Object.defineProperty(r,"FileWriteStream",{get:function(){return w},set:function(te){w=te},enumerable:!0,configurable:!0});function k(te,we){return this instanceof k?(h.apply(this,arguments),this):k.apply(Object.create(k.prototype),arguments)}function N(){var te=this;de(te.path,te.flags,te.mode,function(we,Ue){we?(te.autoClose&&te.destroy(),te.emit("error",we)):(te.fd=Ue,te.emit("open",Ue),te.read())})}function D(te,we){return this instanceof D?(g.apply(this,arguments),this):D.apply(Object.create(D.prototype),arguments)}function V(){var te=this;de(te.path,te.flags,te.mode,function(we,Ue){we?(te.destroy(),te.emit("error",we)):(te.fd=Ue,te.emit("open",Ue))})}function oe(te,we){return new r.ReadStream(te,we)}function G(te,we){return new r.WriteStream(te,we)}var pe=r.open;r.open=de;function de(te,we,Ue,ct){return typeof Ue=="function"&&(ct=Ue,Ue=null),ft(te,we,Ue,ct);function ft(rt,ae,ke,Z,ve){return pe(rt,ae,ke,function(Be,dn){Be&&(Be.code==="EMFILE"||Be.code==="ENFILE")?Fg([ft,[rt,ae,ke,Z],Be,ve||Date.now(),Date.now()]):typeof Z=="function"&&Z.apply(this,arguments)})}}return r}function Fg(r){Sm("ENQUEUE",r[0].name,r[1]),ln[oi].push(r),QM()}var bk;function c6(){for(var r=Date.now(),e=0;e<ln[oi].length;++e)ln[oi][e].length>2&&(ln[oi][e][3]=r,ln[oi][e][4]=r);QM()}function QM(){if(clearTimeout(bk),bk=void 0,ln[oi].length!==0){var r=ln[oi].shift(),e=r[0],t=r[1],n=r[2],i=r[3],o=r[4];if(i===void 0)Sm("RETRY",e.name,t),e.apply(null,t);else if(Date.now()-i>=6e4){Sm("TIMEOUT",e.name,t);var s=t.pop();typeof s=="function"&&s.call(null,n)}else{var a=Date.now()-o,c=Math.max(o-i,1),l=Math.min(c*1.2,100);a>=l?(Sm("RETRY",e.name,t),e.apply(null,t.concat([i]))):ln[oi].push(r)}bk===void 0&&(bk=setTimeout(QM,0))}}});var XM=M(Lg=>{var lpe=ho().fromCallback,va=Dn(),upe=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchown","link","lstat","mkdir","mkdtemp","open","readFile","readdir","readlink","realpath","rename","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(r=>typeof va[r]=="function");Object.keys(va).forEach(r=>{Lg[r]=va[r]});upe.forEach(r=>{Lg[r]=lpe(va[r])});Lg.exists=function(r,e){return typeof e=="function"?va.exists(r,e):new Promise(t=>va.exists(r,t))};Lg.read=function(r,e,t,n,i,o){return typeof o=="function"?va.read(r,e,t,n,i,o):new Promise((s,a)=>{va.read(r,e,t,n,i,(c,l,u)=>{if(c)return a(c);s({bytesRead:l,buffer:u})})})};Lg.write=function(r,e,t,n,i,o){return typeof arguments[arguments.length-1]=="function"?va.write(r,e,t,n,i,o):typeof e=="string"?new Promise((s,a)=>{va.write(r,e,t,n,(c,l,u)=>{if(c)return a(c);s({bytesWritten:l,buffer:u})})}):new Promise((s,a)=>{va.write(r,e,t,n,i,(c,l,u)=>{if(c)return a(c);s({bytesWritten:l,buffer:u})})})}});var d6=M((U1e,p6)=>{"use strict";var Vo=Dn(),u6=require("os"),Sk=require("path");function ppe(){let r=Sk.join("millis-test-sync"+Date.now().toString()+Math.random().toString().slice(2));r=Sk.join(u6.tmpdir(),r);let e=new Date(1435410243862);Vo.writeFileSync(r,"https://github.com/jprichardson/node-fs-extra/pull/141");let t=Vo.openSync(r,"r+");return Vo.futimesSync(t,e,e),Vo.closeSync(t),Vo.statSync(r).mtime>1435410243e3}function dpe(r){let e=Sk.join("millis-test"+Date.now().toString()+Math.random().toString().slice(2));e=Sk.join(u6.tmpdir(),e);let t=new Date(1435410243862);Vo.writeFile(e,"https://github.com/jprichardson/node-fs-extra/pull/141",n=>{if(n)return r(n);Vo.open(e,"r+",(i,o)=>{if(i)return r(i);Vo.futimes(o,t,t,s=>{if(s)return r(s);Vo.close(o,a=>{if(a)return r(a);Vo.stat(e,(c,l)=>{if(c)return r(c);r(null,l.mtime>1435410243e3)})})})})})}function mpe(r){if(typeof r=="number")return Math.floor(r/1e3)*1e3;if(r instanceof Date)return new Date(Math.floor(r.getTime()/1e3)*1e3);throw new Error("fs-extra: timeRemoveMillis() unknown parameter type")}function fpe(r,e,t,n){Vo.open(r,"r+",(i,o)=>{if(i)return n(i);Vo.futimes(o,e,t,s=>{Vo.close(o,a=>{n&&n(s||a)})})})}p6.exports={hasMillisRes:dpe,hasMillisResSync:ppe,timeRemoveMillis:mpe,utimesMillis:fpe}});var ZM=M((j1e,m6)=>{var Bo=Dn(),Ix=require("path"),hpe=d6();function gpe(r,e,t,n){n||(n=t,t={});var i=process.cwd(),o=Ix.resolve(i,r),s=Ix.resolve(i,e),a=t.filter,c=t.transform,l=t.overwrite;l===void 0&&(l=t.clobber),l===void 0&&(l=!0);var u=t.errorOnExist,p=t.dereference,m=t.preserveTimestamps===!0,h=0,g=0,b=0,w=!1;k(o);function k(ae){if(h++,a){if(a instanceof RegExp){if(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),!a.test(ae))return rt(!0)}else if(typeof a=="function"&&!a(ae,e))return rt(!0)}return N(ae)}function N(ae){var ke=p?Bo.stat:Bo.lstat;b++,ke(ae,function(Z,ve){if(Z)return ft(Z);var Be={name:ae,mode:ve.mode,mtime:ve.mtime,atime:ve.atime,stats:ve};if(ve.isDirectory())return G(Be);if(ve.isFile()||ve.isCharacterDevice()||ve.isBlockDevice())return D(Be);if(ve.isSymbolicLink())return te(ae)})}function D(ae){var ke=ae.name.replace(o,s.replace("$","$$$$"));ct(ke,function(Z){Z?V(ae,ke):l?oe(ke,function(){V(ae,ke)}):u?ft(new Error(ke+" already exists")):rt()})}function V(ae,ke){var Z=Bo.createReadStream(ae.name),ve=Bo.createWriteStream(ke,{mode:ae.mode});Z.on("error",ft),ve.on("error",ft),c?c(Z,ve,ae):ve.on("open",function(){Z.pipe(ve)}),ve.once("close",function(){Bo.chmod(ke,ae.mode,function(Be){if(Be)return ft(Be);m?hpe.utimesMillis(ke,ae.atime,ae.mtime,function(dn){return dn?ft(dn):rt()}):rt()})})}function oe(ae,ke){Bo.unlink(ae,function(Z){return Z?ft(Z):ke()})}function G(ae){var ke=ae.name.replace(o,s.replace("$","$$$$"));ct(ke,function(Z){if(Z)return pe(ae,ke);de(ae.name)})}function pe(ae,ke){Bo.mkdir(ke,ae.mode,function(Z){if(Z)return ft(Z);Bo.chmod(ke,ae.mode,function(ve){if(ve)return ft(ve);de(ae.name)})})}function de(ae){Bo.readdir(ae,function(ke,Z){return ke?ft(ke):(Z.forEach(function(ve){k(Ix.join(ae,ve))}),rt())})}function te(ae){var ke=ae.replace(o,s);Bo.readlink(ae,function(Z,ve){if(Z)return ft(Z);we(ve,ke)})}function we(ae,ke){p&&(ae=Ix.resolve(i,ae)),ct(ke,function(Z){if(Z)return Ue(ae,ke);Bo.readlink(ke,function(ve,Be){return ve?ft(ve):(p&&(Be=Ix.resolve(i,Be)),Be===ae?rt():oe(ke,function(){Ue(ae,ke)}))})})}function Ue(ae,ke){Bo.symlink(ae,ke,function(Z){return Z?ft(Z):rt()})}function ct(ae,ke){Bo.lstat(ae,function(Z){return Z&&Z.code==="ENOENT"?ke(!0):ke(!1)})}function ft(ae){if(!w&&n!==void 0)return w=!0,n(ae)}function rt(ae){if(ae||b--,g++,h===g&&b===0&&n!==void 0)return n(null)}}m6.exports=gpe});var tO=M((W1e,h6)=>{"use strict";var eO=require("path");function f6(r){return r=eO.normalize(eO.resolve(r)).split(eO.sep),r.length>0?r[0]:null}var vpe=/[<>:"|?*]/;function ype(r){let e=f6(r);return r=r.replace(e,""),vpe.test(r)}h6.exports={getRootPath:f6,invalidWin32Path:ype}});var v6=M((V1e,g6)=>{"use strict";var bpe=Dn(),rO=require("path"),Ipe=tO().invalidWin32Path,Spe=parseInt("0777",8);function nO(r,e,t,n){if(typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e}),process.platform==="win32"&&Ipe(r)){let s=new Error(r+" contains invalid WIN32 path characters.");return s.code="EINVAL",t(s)}let i=e.mode,o=e.fs||bpe;i===void 0&&(i=Spe&~process.umask()),n||(n=null),t=t||function(){},r=rO.resolve(r),o.mkdir(r,i,s=>{if(!s)return n=n||r,t(null,n);switch(s.code){case"ENOENT":if(rO.dirname(r)===r)return t(s);nO(rO.dirname(r),e,(a,c)=>{a?t(a,c):nO(r,e,t,c)});break;default:o.stat(r,(a,c)=>{a||!c.isDirectory()?t(s,n):t(null,n)});break}})}g6.exports=nO});var b6=M((B1e,y6)=>{"use strict";var xpe=Dn(),iO=require("path"),Cpe=tO().invalidWin32Path,wpe=parseInt("0777",8);function oO(r,e,t){(!e||typeof e!="object")&&(e={mode:e});let n=e.mode,i=e.fs||xpe;if(process.platform==="win32"&&Cpe(r)){let o=new Error(r+" contains invalid WIN32 path characters.");throw o.code="EINVAL",o}n===void 0&&(n=wpe&~process.umask()),t||(t=null),r=iO.resolve(r);try{i.mkdirSync(r,n),t=t||r}catch(o){switch(o.code){case"ENOENT":if(iO.dirname(r)===r)throw o;t=oO(iO.dirname(r),e,t),oO(r,e,t);break;default:let s;try{s=i.statSync(r)}catch{throw o}if(!s.isDirectory())throw o;break}}return t}y6.exports=oO});var qo=M((q1e,I6)=>{"use strict";var Epe=ho().fromCallback,sO=Epe(v6()),aO=b6();I6.exports={mkdirs:sO,mkdirsSync:aO,mkdirp:sO,mkdirpSync:aO,ensureDir:sO,ensureDirSync:aO}});var Wl=M((J1e,x6)=>{"use strict";var Ppe=ho().fromPromise,S6=XM();function kpe(r){return S6.access(r).then(()=>!0).catch(()=>!1)}x6.exports={pathExists:Ppe(kpe),pathExistsSync:S6.existsSync}});var E6=M(($1e,w6)=>{"use strict";var _pe=Dn(),Sx=require("path"),C6=ZM(),Dpe=qo(),Tpe=Wl().pathExists;function Rpe(r,e,t,n){typeof t=="function"&&!n?(n=t,t={}):(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),n=n||function(){},t=t||{},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let i=process.cwd(),o=Sx.resolve(i,r),s=Sx.resolve(i,e);if(o===s)return n(new Error("Source and destination must not be the same."));_pe.lstat(r,(a,c)=>{if(a)return n(a);let l=null;if(c.isDirectory()){let u=e.split(Sx.sep);u.pop(),l=u.join(Sx.sep)}else l=Sx.dirname(e);Tpe(l,(u,p)=>{if(u)return n(u);if(p)return C6(r,e,t,n);Dpe.mkdirs(l,m=>{if(m)return n(m);C6(r,e,t,n)})})})}w6.exports=Rpe});var k6=M((H1e,P6)=>{var Ape=ho().fromCallback;P6.exports={copy:Ape(E6())}});var cO=M((G1e,_6)=>{_6.exports=function(r){if(typeof Buffer.allocUnsafe=="function")try{return Buffer.allocUnsafe(r)}catch{return new Buffer(r)}return new Buffer(r)}});var A6=M((z1e,R6)=>{"use strict";var Oc=Dn(),T6=64*1024,D6=cO()(T6);function Npe(r,e,t){let n=t.overwrite,i=t.errorOnExist,o=t.preserveTimestamps;if(Oc.existsSync(e))if(n)Oc.unlinkSync(e);else{if(i)throw new Error(`${e} already exists`);return}let s=Oc.openSync(r,"r"),a=Oc.fstatSync(s),c=Oc.openSync(e,"w",a.mode),l=1,u=0;for(;l>0;)l=Oc.readSync(s,D6,0,T6,u),Oc.writeSync(c,D6,0,l),u+=l;o&&Oc.futimesSync(c,a.atime,a.mtime),Oc.closeSync(s),Oc.closeSync(c)}R6.exports=Npe});var K6=M((Q1e,O6)=>{"use strict";var xm=Dn(),lO=require("path"),Mpe=A6(),N6=qo();function M6(r,e,t){(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),t=t||{},t.recursive=!!t.recursive,t.clobber="clobber"in t?!!t.clobber:!0,t.overwrite="overwrite"in t?!!t.overwrite:t.clobber,t.dereference="dereference"in t?!!t.dereference:!1,t.preserveTimestamps="preserveTimestamps"in t?!!t.preserveTimestamps:!1,t.filter=t.filter||function(){return!0},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let n=t.recursive&&!t.dereference?xm.lstatSync(r):xm.statSync(r),i=lO.dirname(e),o=xm.existsSync(i),s=!1;if(t.filter instanceof RegExp?(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),s=t.filter.test(r)):typeof t.filter=="function"&&(s=t.filter(r,e)),n.isFile()&&s)o||N6.mkdirsSync(i),Mpe(r,e,{overwrite:t.overwrite,errorOnExist:t.errorOnExist,preserveTimestamps:t.preserveTimestamps});else if(n.isDirectory()&&s)xm.existsSync(e)||N6.mkdirsSync(e),xm.readdirSync(r).forEach(c=>{let l=t;l.recursive=!0,M6(lO.join(r,c),lO.join(e,c),l)});else if(t.recursive&&n.isSymbolicLink()&&s){let a=xm.readlinkSync(r);xm.symlinkSync(a,e)}}O6.exports=M6});var uO=M((Y1e,F6)=>{F6.exports={copySync:K6()}});var $6=M((X1e,J6)=>{"use strict";var L6=Dn(),V6=require("path"),cr=require("assert"),xx=process.platform==="win32";function B6(r){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(t=>{r[t]=r[t]||L6[t],t=t+"Sync",r[t]=r[t]||L6[t]}),r.maxBusyTries=r.maxBusyTries||3}function pO(r,e,t){let n=0;typeof e=="function"&&(t=e,e={}),cr(r,"rimraf: missing path"),cr.equal(typeof r,"string","rimraf: path should be a string"),cr.equal(typeof t,"function","rimraf: callback function required"),cr(e,"rimraf: invalid options argument provided"),cr.equal(typeof e,"object","rimraf: options should be object"),B6(e),U6(r,e,function i(o){if(o){if((o.code==="EBUSY"||o.code==="ENOTEMPTY"||o.code==="EPERM")&&n<e.maxBusyTries){n++;let s=n*100;return setTimeout(()=>U6(r,e,i),s)}o.code==="ENOENT"&&(o=null)}t(o)})}function U6(r,e,t){cr(r),cr(e),cr(typeof t=="function"),e.lstat(r,(n,i)=>{if(n&&n.code==="ENOENT")return t(null);if(n&&n.code==="EPERM"&&xx)return j6(r,e,n,t);if(i&&i.isDirectory())return xk(r,e,n,t);e.unlink(r,o=>{if(o){if(o.code==="ENOENT")return t(null);if(o.code==="EPERM")return xx?j6(r,e,o,t):xk(r,e,o,t);if(o.code==="EISDIR")return xk(r,e,o,t)}return t(o)})})}function j6(r,e,t,n){cr(r),cr(e),cr(typeof n=="function"),t&&cr(t instanceof Error),e.chmod(r,438,i=>{i?n(i.code==="ENOENT"?null:t):e.stat(r,(o,s)=>{o?n(o.code==="ENOENT"?null:t):s.isDirectory()?xk(r,e,t,n):e.unlink(r,n)})})}function W6(r,e,t){let n;cr(r),cr(e),t&&cr(t instanceof Error);try{e.chmodSync(r,438)}catch(i){if(i.code==="ENOENT")return;throw t}try{n=e.statSync(r)}catch(i){if(i.code==="ENOENT")return;throw t}n.isDirectory()?Ck(r,e,t):e.unlinkSync(r)}function xk(r,e,t,n){cr(r),cr(e),t&&cr(t instanceof Error),cr(typeof n=="function"),e.rmdir(r,i=>{i&&(i.code==="ENOTEMPTY"||i.code==="EEXIST"||i.code==="EPERM")?Ope(r,e,n):i&&i.code==="ENOTDIR"?n(t):n(i)})}function Ope(r,e,t){cr(r),cr(e),cr(typeof t=="function"),e.readdir(r,(n,i)=>{if(n)return t(n);let o=i.length,s;if(o===0)return e.rmdir(r,t);i.forEach(a=>{pO(V6.join(r,a),e,c=>{if(!s){if(c)return t(s=c);--o===0&&e.rmdir(r,t)}})})})}function q6(r,e){let t;e=e||{},B6(e),cr(r,"rimraf: missing path"),cr.equal(typeof r,"string","rimraf: path should be a string"),cr(e,"rimraf: missing options"),cr.equal(typeof e,"object","rimraf: options should be object");try{t=e.lstatSync(r)}catch(n){if(n.code==="ENOENT")return;n.code==="EPERM"&&xx&&W6(r,e,n)}try{t&&t.isDirectory()?Ck(r,e,null):e.unlinkSync(r)}catch(n){if(n.code==="ENOENT")return;if(n.code==="EPERM")return xx?W6(r,e,n):Ck(r,e,n);if(n.code!=="EISDIR")throw n;Ck(r,e,n)}}function Ck(r,e,t){cr(r),cr(e),t&&cr(t instanceof Error);try{e.rmdirSync(r)}catch(n){if(n.code==="ENOTDIR")throw t;if(n.code==="ENOTEMPTY"||n.code==="EEXIST"||n.code==="EPERM")Kpe(r,e);else if(n.code!=="ENOENT")throw n}}function Kpe(r,e){cr(r),cr(e),e.readdirSync(r).forEach(i=>q6(V6.join(r,i),e));let t=xx?100:1,n=0;do{let i=!0;try{let o=e.rmdirSync(r,e);return i=!1,o}finally{if(++n<t&&i)continue}}while(!0)}J6.exports=pO;pO.sync=q6});var Cx=M((Z1e,G6)=>{"use strict";var Fpe=ho().fromCallback,H6=$6();G6.exports={remove:Fpe(H6),removeSync:H6.sync}});var X6=M((eRe,Y6)=>{var Ug;try{Ug=Dn()}catch{Ug=require("fs")}function Lpe(r,e,t){t==null&&(t=e,e={}),typeof e=="string"&&(e={encoding:e}),e=e||{};var n=e.fs||Ug,i=!0;"throws"in e&&(i=e.throws),n.readFile(r,e,function(o,s){if(o)return t(o);s=Q6(s);var a;try{a=JSON.parse(s,e?e.reviver:null)}catch(c){return i?(c.message=r+": "+c.message,t(c)):t(null,null)}t(null,a)})}function Upe(r,e){e=e||{},typeof e=="string"&&(e={encoding:e});var t=e.fs||Ug,n=!0;"throws"in e&&(n=e.throws);try{var i=t.readFileSync(r,e);return i=Q6(i),JSON.parse(i,e.reviver)}catch(o){if(n)throw o.message=r+": "+o.message,o;return null}}function z6(r,e){var t,n=`
`;typeof e=="object"&&e!==null&&(e.spaces&&(t=e.spaces),e.EOL&&(n=e.EOL));var i=JSON.stringify(r,e?e.replacer:null,t);return i.replace(/\n/g,n)+n}function jpe(r,e,t,n){n==null&&(n=t,t={}),t=t||{};var i=t.fs||Ug,o="";try{o=z6(e,t)}catch(s){n&&n(s,null);return}i.writeFile(r,o,t,n)}function Wpe(r,e,t){t=t||{};var n=t.fs||Ug,i=z6(e,t);return n.writeFileSync(r,i,t)}function Q6(r){return Buffer.isBuffer(r)&&(r=r.toString("utf8")),r=r.replace(/^\uFEFF/,""),r}var Vpe={readFile:Lpe,readFileSync:Upe,writeFile:jpe,writeFileSync:Wpe};Y6.exports=Vpe});var Ek=M((tRe,eq)=>{"use strict";var Z6=ho().fromCallback,wk=X6();eq.exports={readJson:Z6(wk.readFile),readJsonSync:wk.readFileSync,writeJson:Z6(wk.writeFile),writeJsonSync:wk.writeFileSync}});var nq=M((rRe,rq)=>{"use strict";var Bpe=require("path"),qpe=qo(),Jpe=Wl().pathExists,tq=Ek();function $pe(r,e,t,n){typeof t=="function"&&(n=t,t={});let i=Bpe.dirname(r);Jpe(i,(o,s)=>{if(o)return n(o);if(s)return tq.writeJson(r,e,t,n);qpe.mkdirs(i,a=>{if(a)return n(a);tq.writeJson(r,e,t,n)})})}rq.exports=$pe});var oq=M((nRe,iq)=>{"use strict";var Hpe=Dn(),Gpe=require("path"),zpe=qo(),Qpe=Ek();function Ype(r,e,t){let n=Gpe.dirname(r);Hpe.existsSync(n)||zpe.mkdirsSync(n),Qpe.writeJsonSync(r,e,t)}iq.exports=Ype});var aq=M((iRe,sq)=>{"use strict";var Xpe=ho().fromCallback,Qi=Ek();Qi.outputJson=Xpe(nq());Qi.outputJsonSync=oq();Qi.outputJSON=Qi.outputJson;Qi.outputJSONSync=Qi.outputJsonSync;Qi.writeJSON=Qi.writeJson;Qi.writeJSONSync=Qi.writeJsonSync;Qi.readJSON=Qi.readJson;Qi.readJSONSync=Qi.readJsonSync;sq.exports=Qi});var pq=M((oRe,uq)=>{"use strict";var Zpe=ho().fromCallback,Kc=Dn(),ede=ZM(),Cm=require("path"),Pk=Cx().remove,tde=qo().mkdirs;function dO(r,e,t,n){typeof t=="function"&&(n=t,t={});let i=t.overwrite||t.clobber||!1;nde(r,e,(s,a)=>{if(s)return n(s);if(a)return n(new Error(`Cannot move '${r}' to a subdirectory of itself, '${e}'.`));tde(Cm.dirname(e),c=>{if(c)return n(c);o()})});function o(){Cm.resolve(r)===Cm.resolve(e)?Kc.access(r,n):i?Kc.rename(r,e,s=>{if(!s)return n();if(s.code==="ENOTEMPTY"||s.code==="EEXIST"){Pk(e,a=>{if(a)return n(a);t.overwrite=!1,dO(r,e,t,n)});return}if(s.code==="EPERM"){setTimeout(()=>{Pk(e,a=>{if(a)return n(a);t.overwrite=!1,dO(r,e,t,n)})},200);return}if(s.code!=="EXDEV")return n(s);cq(r,e,i,n)}):Kc.link(r,e,s=>s?s.code==="EXDEV"||s.code==="EISDIR"||s.code==="EPERM"||s.code==="ENOTSUP"?cq(r,e,i,n):n(s):Kc.unlink(r,n))}}function cq(r,e,t,n){Kc.stat(r,(i,o)=>{if(i)return n(i);o.isDirectory()?lq(r,e,t,n):rde(r,e,t,n)})}function rde(r,e,t,n){let i=t?"w":"wx",o=Kc.createReadStream(r),s=Kc.createWriteStream(e,{flags:i});o.on("error",c=>{o.destroy(),s.destroy(),s.removeListener("close",a),Kc.unlink(e,()=>{c.code==="EISDIR"||c.code==="EPERM"?lq(r,e,t,n):n(c)})}),s.on("error",c=>{o.destroy(),s.destroy(),s.removeListener("close",a),n(c)}),s.once("close",a),o.pipe(s);function a(){Kc.unlink(r,n)}}function lq(r,e,t,n){let i={overwrite:!1};t?Pk(e,s=>{if(s)return n(s);o()}):o();function o(){ede(r,e,i,s=>{if(s)return n(s);Pk(r,n)})}}function nde(r,e,t){Kc.stat(r,(n,i)=>{if(n)return t(n);if(i.isDirectory()){let o=e.split(Cm.dirname(r)+Cm.sep)[1];if(o){let s=o.split(Cm.sep)[0];return s?t(null,r!==e&&e.indexOf(r)>-1&&s===Cm.basename(r)):t(null,!1)}return t(null,!1)}return t(null,!1)})}uq.exports={move:Zpe(dO)}});var hq=M((sRe,fq)=>{"use strict";var go=Dn(),wm=require("path"),ide=uO().copySync,mO=Cx().removeSync,ode=qo().mkdirsSync,sde=cO();function mq(r,e,t){t=t||{};let n=t.overwrite||t.clobber||!1;if(r=wm.resolve(r),e=wm.resolve(e),r===e)return go.accessSync(r);if(lde(r,e))throw new Error(`Cannot move '${r}' into itself '${e}'.`);ode(wm.dirname(e)),i();function i(){if(n)try{return go.renameSync(r,e)}catch(o){if(o.code==="ENOTEMPTY"||o.code==="EEXIST"||o.code==="EPERM")return mO(e),t.overwrite=!1,mq(r,e,t);if(o.code!=="EXDEV")throw o;return dq(r,e,n)}else try{return go.linkSync(r,e),go.unlinkSync(r)}catch(o){if(o.code==="EXDEV"||o.code==="EISDIR"||o.code==="EPERM"||o.code==="ENOTSUP")return dq(r,e,n);throw o}}}function dq(r,e,t){return go.statSync(r).isDirectory()?cde(r,e,t):ade(r,e,t)}function ade(r,e,t){let i=sde(65536),o=t?"w":"wx",s=go.openSync(r,"r"),a=go.fstatSync(s),c=go.openSync(e,o,a.mode),l=1,u=0;for(;l>0;)l=go.readSync(s,i,0,65536,u),go.writeSync(c,i,0,l),u+=l;return go.closeSync(s),go.closeSync(c),go.unlinkSync(r)}function cde(r,e,t){let n={overwrite:!1};t&&mO(e),i();function i(){return ide(r,e,n),mO(r)}}function lde(r,e){try{return go.statSync(r).isDirectory()&&r!==e&&e.indexOf(r)>-1&&e.split(wm.dirname(r)+wm.sep)[1].split(wm.sep)[0]===wm.basename(r)}catch{return!1}}fq.exports={moveSync:mq}});var Cq=M((aRe,xq)=>{"use strict";var ude=ho().fromCallback,yq=require("fs"),bq=require("path"),Iq=qo(),Sq=Cx(),gq=ude(function(e,t){t=t||function(){},yq.readdir(e,(n,i)=>{if(n)return Iq.mkdirs(e,t);i=i.map(s=>bq.join(e,s)),o();function o(){let s=i.pop();if(!s)return t();Sq.remove(s,a=>{if(a)return t(a);o()})}})});function vq(r){let e;try{e=yq.readdirSync(r)}catch{return Iq.mkdirsSync(r)}e.forEach(t=>{t=bq.join(r,t),Sq.removeSync(t)})}xq.exports={emptyDirSync:vq,emptydirSync:vq,emptyDir:gq,emptydir:gq}});var kq=M((cRe,Pq)=>{"use strict";var pde=ho().fromCallback,wq=require("path"),wx=Dn(),Eq=qo(),dde=Wl().pathExists;function mde(r,e){function t(){wx.writeFile(r,"",n=>{if(n)return e(n);e()})}wx.stat(r,(n,i)=>{if(!n&&i.isFile())return e();let o=wq.dirname(r);dde(o,(s,a)=>{if(s)return e(s);if(a)return t();Eq.mkdirs(o,c=>{if(c)return e(c);t()})})})}function fde(r){let e;try{e=wx.statSync(r)}catch{}if(e&&e.isFile())return;let t=wq.dirname(r);wx.existsSync(t)||Eq.mkdirsSync(t),wx.writeFileSync(r,"")}Pq.exports={createFile:pde(mde),createFileSync:fde}});var Aq=M((lRe,Rq)=>{"use strict";var hde=ho().fromCallback,Dq=require("path"),Em=Dn(),Tq=qo(),_q=Wl().pathExists;function gde(r,e,t){function n(i,o){Em.link(i,o,s=>{if(s)return t(s);t(null)})}_q(e,(i,o)=>{if(i)return t(i);if(o)return t(null);Em.lstat(r,(s,a)=>{if(s)return s.message=s.message.replace("lstat","ensureLink"),t(s);let c=Dq.dirname(e);_q(c,(l,u)=>{if(l)return t(l);if(u)return n(r,e);Tq.mkdirs(c,p=>{if(p)return t(p);n(r,e)})})})})}function vde(r,e,t){if(Em.existsSync(e))return;try{Em.lstatSync(r)}catch(s){throw s.message=s.message.replace("lstat","ensureLink"),s}let i=Dq.dirname(e);return Em.existsSync(i)||Tq.mkdirsSync(i),Em.linkSync(r,e)}Rq.exports={createLink:hde(gde),createLinkSync:vde}});var Mq=M((uRe,Nq)=>{"use strict";var Tp=require("path"),Ex=Dn(),yde=Wl().pathExists;function bde(r,e,t){if(Tp.isAbsolute(r))return Ex.lstat(r,(n,i)=>n?(n.message=n.message.replace("lstat","ensureSymlink"),t(n)):t(null,{toCwd:r,toDst:r}));{let n=Tp.dirname(e),i=Tp.join(n,r);return yde(i,(o,s)=>o?t(o):s?t(null,{toCwd:i,toDst:r}):Ex.lstat(r,(a,c)=>a?(a.message=a.message.replace("lstat","ensureSymlink"),t(a)):t(null,{toCwd:r,toDst:Tp.relative(n,r)})))}}function Ide(r,e){let t;if(Tp.isAbsolute(r)){if(t=Ex.existsSync(r),!t)throw new Error("absolute srcpath does not exist");return{toCwd:r,toDst:r}}else{let n=Tp.dirname(e),i=Tp.join(n,r);if(t=Ex.existsSync(i),t)return{toCwd:i,toDst:r};if(t=Ex.existsSync(r),!t)throw new Error("relative srcpath does not exist");return{toCwd:r,toDst:Tp.relative(n,r)}}}Nq.exports={symlinkPaths:bde,symlinkPathsSync:Ide}});var Fq=M((pRe,Kq)=>{"use strict";var Oq=Dn();function Sde(r,e,t){if(t=typeof e=="function"?e:t,e=typeof e=="function"?!1:e,e)return t(null,e);Oq.lstat(r,(n,i)=>{if(n)return t(null,"file");e=i&&i.isDirectory()?"dir":"file",t(null,e)})}function xde(r,e){let t;if(e)return e;try{t=Oq.lstatSync(r)}catch{return"file"}return t&&t.isDirectory()?"dir":"file"}Kq.exports={symlinkType:Sde,symlinkTypeSync:xde}});var qq=M((dRe,Bq)=>{"use strict";var Cde=ho().fromCallback,Uq=require("path"),jg=Dn(),jq=qo(),wde=jq.mkdirs,Ede=jq.mkdirsSync,Wq=Mq(),Pde=Wq.symlinkPaths,kde=Wq.symlinkPathsSync,Vq=Fq(),_de=Vq.symlinkType,Dde=Vq.symlinkTypeSync,Lq=Wl().pathExists;function Tde(r,e,t,n){n=typeof t=="function"?t:n,t=typeof t=="function"?!1:t,Lq(e,(i,o)=>{if(i)return n(i);if(o)return n(null);Pde(r,e,(s,a)=>{if(s)return n(s);r=a.toDst,_de(a.toCwd,t,(c,l)=>{if(c)return n(c);let u=Uq.dirname(e);Lq(u,(p,m)=>{if(p)return n(p);if(m)return jg.symlink(r,e,l,n);wde(u,h=>{if(h)return n(h);jg.symlink(r,e,l,n)})})})})})}function Rde(r,e,t,n){if(n=typeof t=="function"?t:n,t=typeof t=="function"?!1:t,jg.existsSync(e))return;let o=kde(r,e);r=o.toDst,t=Dde(o.toCwd,t);let s=Uq.dirname(e);return jg.existsSync(s)||Ede(s),jg.symlinkSync(r,e,t)}Bq.exports={createSymlink:Cde(Tde),createSymlinkSync:Rde}});var $q=M((mRe,Jq)=>{"use strict";var kk=kq(),_k=Aq(),Dk=qq();Jq.exports={createFile:kk.createFile,createFileSync:kk.createFileSync,ensureFile:kk.createFile,ensureFileSync:kk.createFileSync,createLink:_k.createLink,createLinkSync:_k.createLinkSync,ensureLink:_k.createLink,ensureLinkSync:_k.createLinkSync,createSymlink:Dk.createSymlink,createSymlinkSync:Dk.createSymlinkSync,ensureSymlink:Dk.createSymlink,ensureSymlinkSync:Dk.createSymlinkSync}});var Qq=M((fRe,zq)=>{"use strict";var Ade=ho().fromCallback,Pm=Dn(),Hq=require("path"),Gq=qo(),Nde=Wl().pathExists;function Mde(r,e,t,n){typeof t=="function"&&(n=t,t="utf8");let i=Hq.dirname(r);Nde(i,(o,s)=>{if(o)return n(o);if(s)return Pm.writeFile(r,e,t,n);Gq.mkdirs(i,a=>{if(a)return n(a);Pm.writeFile(r,e,t,n)})})}function Ode(r,e,t){let n=Hq.dirname(r);if(Pm.existsSync(n))return Pm.writeFileSync.apply(Pm,arguments);Gq.mkdirsSync(n),Pm.writeFileSync.apply(Pm,arguments)}zq.exports={outputFile:Ade(Mde),outputFileSync:Ode}});var Fc=M((hRe,Yq)=>{"use strict";var Ts=ZB(),Jo={};Ts(Jo,XM());Ts(Jo,k6());Ts(Jo,uO());Ts(Jo,qo());Ts(Jo,Cx());Ts(Jo,aq());Ts(Jo,pq());Ts(Jo,hq());Ts(Jo,Cq());Ts(Jo,$q());Ts(Jo,Qq());Ts(Jo,Wl());Yq.exports=Jo});var qk=M((wMe,kO)=>{"use strict";function Hde(r){var e=void 0;typeof r=="string"?e=[r]:e=r.raw;for(var t="",n=0;n<e.length;n++)t+=e[n].replace(/\\\n[ \t]*/g,"").replace(/\\`/g,"`"),n<(arguments.length<=1?0:arguments.length-1)&&(t+=arguments.length<=n+1?void 0:arguments[n+1]);var i=t.split(`
`),o=null;return i.forEach(function(s){var a=s.match(/^(\s+)\S+/);if(a){var c=a[1].length;o?o=Math.min(o,c):o=c}}),o!==null&&(t=i.map(function(s){return s[0]===" "?s.slice(o):s}).join(`
`)),t=t.trim(),t.replace(/\\n/g,`
`)}typeof kO<"u"&&(kO.exports=Hde)});var h8=M((yUe,f8)=>{f8.exports=function(r,e){for(var t=[],n=0;n<r.length;n++){var i=e(r[n],n);sme(i)?t.push.apply(t,i):t.push(i)}return t};var sme=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"}});var I8=M((bUe,b8)=>{"use strict";b8.exports=v8;function v8(r,e,t){r instanceof RegExp&&(r=g8(r,t)),e instanceof RegExp&&(e=g8(e,t));var n=y8(r,e,t);return n&&{start:n[0],end:n[1],pre:t.slice(0,n[0]),body:t.slice(n[0]+r.length,n[1]),post:t.slice(n[1]+e.length)}}function g8(r,e){var t=e.match(r);return t?t[0]:null}v8.range=y8;function y8(r,e,t){var n,i,o,s,a,c=t.indexOf(r),l=t.indexOf(e,c+1),u=c;if(c>=0&&l>0){if(r===e)return[c,l];for(n=[],o=t.length;u>=0&&!a;)u==c?(n.push(u),c=t.indexOf(r,u+1)):n.length==1?a=[n.pop(),l]:(i=n.pop(),i<o&&(o=i,s=l),l=t.indexOf(e,u+1)),u=c<l&&c>=0?c:l;n.length&&(a=[o,s])}return a}});var _8=M((IUe,k8)=>{var ame=h8(),S8=I8();k8.exports=ume;var x8="\0SLASH"+Math.random()+"\0",C8="\0OPEN"+Math.random()+"\0",JO="\0CLOSE"+Math.random()+"\0",w8="\0COMMA"+Math.random()+"\0",E8="\0PERIOD"+Math.random()+"\0";function qO(r){return parseInt(r,10)==r?parseInt(r,10):r.charCodeAt(0)}function cme(r){return r.split("\\\\").join(x8).split("\\{").join(C8).split("\\}").join(JO).split("\\,").join(w8).split("\\.").join(E8)}function lme(r){return r.split(x8).join("\\").split(C8).join("{").split(JO).join("}").split(w8).join(",").split(E8).join(".")}function P8(r){if(!r)return[""];var e=[],t=S8("{","}",r);if(!t)return r.split(",");var n=t.pre,i=t.body,o=t.post,s=n.split(",");s[s.length-1]+="{"+i+"}";var a=P8(o);return o.length&&(s[s.length-1]+=a.shift(),s.push.apply(s,a)),e.push.apply(e,s),e}function ume(r){return r?(r.substr(0,2)==="{}"&&(r="\\{\\}"+r.substr(2)),fv(cme(r),!0).map(lme)):[]}function pme(r){return"{"+r+"}"}function dme(r){return/^-?0\d/.test(r)}function mme(r,e){return r<=e}function fme(r,e){return r>=e}function fv(r,e){var t=[],n=S8("{","}",r);if(!n||/\$$/.test(n.pre))return[r];var i=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),o=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),s=i||o,a=n.body.indexOf(",")>=0;if(!s&&!a)return n.post.match(/,.*\}/)?(r=n.pre+"{"+n.body+JO+n.post,fv(r)):[r];var c;if(s)c=n.body.split(/\.\./);else if(c=P8(n.body),c.length===1&&(c=fv(c[0],!1).map(pme),c.length===1)){var u=n.post.length?fv(n.post,!1):[""];return u.map(function(Ue){return n.pre+c[0]+Ue})}var l=n.pre,u=n.post.length?fv(n.post,!1):[""],p;if(s){var m=qO(c[0]),h=qO(c[1]),g=Math.max(c[0].length,c[1].length),b=c.length==3?Math.abs(qO(c[2])):1,w=mme,k=h<m;k&&(b*=-1,w=fme);var N=c.some(dme);p=[];for(var D=m;w(D,h);D+=b){var V;if(o)V=String.fromCharCode(D),V==="\\"&&(V="");else if(V=String(D),N){var oe=g-V.length;if(oe>0){var G=new Array(oe+1).join("0");D<0?V="-"+G+V.slice(1):V=G+V}}p.push(V)}}else p=ame(c,function(we){return fv(we,!1)});for(var pe=0;pe<p.length;pe++)for(var de=0;de<u.length;de++){var te=l+p[pe]+u[de];(!e||s||te)&&t.push(te)}return t}});var Kx=M((SUe,N8)=>{N8.exports=Ho;Ho.Minimatch=ai;var Ox=function(){try{return require("path")}catch{}}()||{sep:"/"};Ho.sep=Ox.sep;var GO=Ho.GLOBSTAR=ai.GLOBSTAR={},hme=_8(),D8={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},$O="[^/]",HO=$O+"*?",gme="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",vme="(?:(?!(?:\\/|^)\\.).)*?",T8=yme("().*{}+?[]^$\\!");function yme(r){return r.split("").reduce(function(e,t){return e[t]=!0,e},{})}var R8=/\/+/;Ho.filter=bme;function bme(r,e){return e=e||{},function(t,n,i){return Ho(t,r,e)}}function Up(r,e){e=e||{};var t={};return Object.keys(r).forEach(function(n){t[n]=r[n]}),Object.keys(e).forEach(function(n){t[n]=e[n]}),t}Ho.defaults=function(r){if(!r||typeof r!="object"||!Object.keys(r).length)return Ho;var e=Ho,t=function(i,o,s){return e(i,o,Up(r,s))};return t.Minimatch=function(i,o){return new e.Minimatch(i,Up(r,o))},t.Minimatch.defaults=function(i){return e.defaults(Up(r,i)).Minimatch},t.filter=function(i,o){return e.filter(i,Up(r,o))},t.defaults=function(i){return e.defaults(Up(r,i))},t.makeRe=function(i,o){return e.makeRe(i,Up(r,o))},t.braceExpand=function(i,o){return e.braceExpand(i,Up(r,o))},t.match=function(n,i,o){return e.match(n,i,Up(r,o))},t};ai.defaults=function(r){return Ho.defaults(r).Minimatch};function Ho(r,e,t){return h_(e),t||(t={}),!t.nocomment&&e.charAt(0)==="#"?!1:new ai(e,t).match(r)}function ai(r,e){if(!(this instanceof ai))return new ai(r,e);h_(r),e||(e={}),r=r.trim(),!e.allowWindowsEscape&&Ox.sep!=="/"&&(r=r.split(Ox.sep).join("/")),this.options=e,this.set=[],this.pattern=r,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.make()}ai.prototype.debug=function(){};ai.prototype.make=Ime;function Ime(){var r=this.pattern,e=this.options;if(!e.nocomment&&r.charAt(0)==="#"){this.comment=!0;return}if(!r){this.empty=!0;return}this.parseNegate();var t=this.globSet=this.braceExpand();e.debug&&(this.debug=function(){console.error.apply(console,arguments)}),this.debug(this.pattern,t),t=this.globParts=t.map(function(n){return n.split(R8)}),this.debug(this.pattern,t),t=t.map(function(n,i,o){return n.map(this.parse,this)},this),this.debug(this.pattern,t),t=t.filter(function(n){return n.indexOf(!1)===-1}),this.debug(this.pattern,t),this.set=t}ai.prototype.parseNegate=Sme;function Sme(){var r=this.pattern,e=!1,t=this.options,n=0;if(!t.nonegate){for(var i=0,o=r.length;i<o&&r.charAt(i)==="!";i++)e=!e,n++;n&&(this.pattern=r.substr(n)),this.negate=e}}Ho.braceExpand=function(r,e){return A8(r,e)};ai.prototype.braceExpand=A8;function A8(r,e){return e||(this instanceof ai?e=this.options:e={}),r=typeof r>"u"?this.pattern:r,h_(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:hme(r)}var xme=1024*64,h_=function(r){if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>xme)throw new TypeError("pattern is too long")};ai.prototype.parse=Cme;var f_={};function Cme(r,e){h_(r);var t=this.options;if(r==="**")if(t.noglobstar)r="*";else return GO;if(r==="")return"";var n="",i=!!t.nocase,o=!1,s=[],a=[],c,l=!1,u=-1,p=-1,m=r.charAt(0)==="."?"":t.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",h=this;function g(){if(c){switch(c){case"*":n+=HO,i=!0;break;case"?":n+=$O,i=!0;break;default:n+="\\"+c;break}h.debug("clearStateChar %j %j",c,n),c=!1}}for(var b=0,w=r.length,k;b<w&&(k=r.charAt(b));b++){if(this.debug("%s	%s %s %j",r,b,n,k),o&&T8[k]){n+="\\"+k,o=!1;continue}switch(k){case"/":return!1;case"\\":g(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",r,b,n,k),l){this.debug("  in class"),k==="!"&&b===p+1&&(k="^"),n+=k;continue}h.debug("call clearStateChar %j",c),g(),c=k,t.noext&&g();continue;case"(":if(l){n+="(";continue}if(!c){n+="\\(";continue}s.push({type:c,start:b-1,reStart:n.length,open:D8[c].open,close:D8[c].close}),n+=c==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",c,n),c=!1;continue;case")":if(l||!s.length){n+="\\)";continue}g(),i=!0;var N=s.pop();n+=N.close,N.type==="!"&&a.push(N),N.reEnd=n.length;continue;case"|":if(l||!s.length||o){n+="\\|",o=!1;continue}g(),n+="|";continue;case"[":if(g(),l){n+="\\"+k;continue}l=!0,p=b,u=n.length,n+=k;continue;case"]":if(b===p+1||!l){n+="\\"+k,o=!1;continue}var D=r.substring(p+1,b);try{RegExp("["+D+"]")}catch{var V=this.parse(D,f_);n=n.substr(0,u)+"\\["+V[0]+"\\]",i=i||V[1],l=!1;continue}i=!0,l=!1,n+=k;continue;default:g(),o?o=!1:T8[k]&&!(k==="^"&&l)&&(n+="\\"),n+=k}}for(l&&(D=r.substr(p+1),V=this.parse(D,f_),n=n.substr(0,u)+"\\["+V[0],i=i||V[1]),N=s.pop();N;N=s.pop()){var oe=n.slice(N.reStart+N.open.length);this.debug("setting tail",n,N),oe=oe.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(dn,Et,jr){return jr||(jr="\\"),Et+Et+jr+"|"}),this.debug(`tail=%j
   %s`,oe,oe,N,n);var G=N.type==="*"?HO:N.type==="?"?$O:"\\"+N.type;i=!0,n=n.slice(0,N.reStart)+G+"\\("+oe}g(),o&&(n+="\\\\");var pe=!1;switch(n.charAt(0)){case"[":case".":case"(":pe=!0}for(var de=a.length-1;de>-1;de--){var te=a[de],we=n.slice(0,te.reStart),Ue=n.slice(te.reStart,te.reEnd-8),ct=n.slice(te.reEnd-8,te.reEnd),ft=n.slice(te.reEnd);ct+=ft;var rt=we.split("(").length-1,ae=ft;for(b=0;b<rt;b++)ae=ae.replace(/\)[+*?]?/,"");ft=ae;var ke="";ft===""&&e!==f_&&(ke="$");var Z=we+Ue+ft+ke+ct;n=Z}if(n!==""&&i&&(n="(?=.)"+n),pe&&(n=m+n),e===f_)return[n,i];if(!i)return Eme(r);var ve=t.nocase?"i":"";try{var Be=new RegExp("^"+n+"$",ve)}catch{return new RegExp("$.")}return Be._glob=r,Be._src=n,Be}Ho.makeRe=function(r,e){return new ai(r,e||{}).makeRe()};ai.prototype.makeRe=wme;function wme(){if(this.regexp||this.regexp===!1)return this.regexp;var r=this.set;if(!r.length)return this.regexp=!1,this.regexp;var e=this.options,t=e.noglobstar?HO:e.dot?gme:vme,n=e.nocase?"i":"",i=r.map(function(o){return o.map(function(s){return s===GO?t:typeof s=="string"?Pme(s):s._src}).join("\\/")}).join("|");i="^(?:"+i+")$",this.negate&&(i="^(?!"+i+").*$");try{this.regexp=new RegExp(i,n)}catch{this.regexp=!1}return this.regexp}Ho.match=function(r,e,t){t=t||{};var n=new ai(e,t);return r=r.filter(function(i){return n.match(i)}),n.options.nonull&&!r.length&&r.push(e),r};ai.prototype.match=function(e,t){if(typeof t>"u"&&(t=this.partial),this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;var n=this.options;Ox.sep!=="/"&&(e=e.split(Ox.sep).join("/")),e=e.split(R8),this.debug(this.pattern,"split",e);var i=this.set;this.debug(this.pattern,"set",i);var o,s;for(s=e.length-1;s>=0&&(o=e[s],!o);s--);for(s=0;s<i.length;s++){var a=i[s],c=e;n.matchBase&&a.length===1&&(c=[o]);var l=this.matchOne(c,a,t);if(l)return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate};ai.prototype.matchOne=function(r,e,t){var n=this.options;this.debug("matchOne",{this:this,file:r,pattern:e}),this.debug("matchOne",r.length,e.length);for(var i=0,o=0,s=r.length,a=e.length;i<s&&o<a;i++,o++){this.debug("matchOne loop");var c=e[o],l=r[i];if(this.debug(e,c,l),c===!1)return!1;if(c===GO){this.debug("GLOBSTAR",[e,c,l]);var u=i,p=o+1;if(p===a){for(this.debug("** at the end");i<s;i++)if(r[i]==="."||r[i]===".."||!n.dot&&r[i].charAt(0)===".")return!1;return!0}for(;u<s;){var m=r[u];if(this.debug(`
globstar while`,r,u,e,p,m),this.matchOne(r.slice(u),e.slice(p),t))return this.debug("globstar found match!",u,s,m),!0;if(m==="."||m===".."||!n.dot&&m.charAt(0)==="."){this.debug("dot detected!",r,u,e,p);break}this.debug("globstar swallow a segment, and continue"),u++}return!!(t&&(this.debug(`
>>> no match, partial?`,r,u,e,p),u===s))}var h;if(typeof c=="string"?(h=l===c,this.debug("string match",c,l,h)):(h=l.match(c),this.debug("pattern match",c,l,h)),!h)return!1}if(i===s&&o===a)return!0;if(i===s)return t;if(o===a)return i===s-1&&r[i]==="";throw new Error("wtf?")};function Eme(r){return r.replace(/\\(.)/g,"$1")}function Pme(r){return r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}});var W8=M(QO=>{var Nm=require("path"),Wp=process.platform==="win32",jp=require("fs"),Tme=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function Rme(){var r;if(Tme){var e=new Error;r=t}else r=n;return r;function t(i){i&&(e.message=i.message,i=e,n(i))}function n(i){if(i){if(process.throwDeprecation)throw i;if(!process.noDeprecation){var o="fs: missing callback "+(i.stack||i.message);process.traceDeprecation?console.trace(o):console.error(o)}}}}function Ame(r){return typeof r=="function"?r:Rme()}var l2e=Nm.normalize;Wp?zl=/(.*?)(?:[\/\\]+|$)/g:zl=/(.*?)(?:[\/]+|$)/g;var zl;Wp?Wx=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/:Wx=/^[\/]*/;var Wx;QO.realpathSync=function(e,t){if(e=Nm.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return t[e];var n=e,i={},o={},s,a,c,l;u();function u(){var w=Wx.exec(e);s=w[0].length,a=w[0],c=w[0],l="",Wp&&!o[c]&&(jp.lstatSync(c),o[c]=!0)}for(;s<e.length;){zl.lastIndex=s;var p=zl.exec(e);if(l=a,a+=p[0],c=l+p[1],s=zl.lastIndex,!(o[c]||t&&t[c]===c)){var m;if(t&&Object.prototype.hasOwnProperty.call(t,c))m=t[c];else{var h=jp.lstatSync(c);if(!h.isSymbolicLink()){o[c]=!0,t&&(t[c]=c);continue}var g=null;if(!Wp){var b=h.dev.toString(32)+":"+h.ino.toString(32);i.hasOwnProperty(b)&&(g=i[b])}g===null&&(jp.statSync(c),g=jp.readlinkSync(c)),m=Nm.resolve(l,g),t&&(t[c]=m),Wp||(i[b]=g)}e=Nm.resolve(m,e.slice(s)),u()}}return t&&(t[n]=e),e};QO.realpath=function(e,t,n){if(typeof n!="function"&&(n=Ame(t),t=null),e=Nm.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return process.nextTick(n.bind(null,null,t[e]));var i=e,o={},s={},a,c,l,u;p();function p(){var w=Wx.exec(e);a=w[0].length,c=w[0],l=w[0],u="",Wp&&!s[l]?jp.lstat(l,function(k){if(k)return n(k);s[l]=!0,m()}):process.nextTick(m)}function m(){if(a>=e.length)return t&&(t[i]=e),n(null,e);zl.lastIndex=a;var w=zl.exec(e);return u=c,c+=w[0],l=u+w[1],a=zl.lastIndex,s[l]||t&&t[l]===l?process.nextTick(m):t&&Object.prototype.hasOwnProperty.call(t,l)?b(t[l]):jp.lstat(l,h)}function h(w,k){if(w)return n(w);if(!k.isSymbolicLink())return s[l]=!0,t&&(t[l]=l),process.nextTick(m);if(!Wp){var N=k.dev.toString(32)+":"+k.ino.toString(32);if(o.hasOwnProperty(N))return g(null,o[N],l)}jp.stat(l,function(D){if(D)return n(D);jp.readlink(l,function(V,oe){Wp||(o[N]=oe),g(V,oe)})})}function g(w,k,N){if(w)return n(w);var D=Nm.resolve(u,k);t&&(t[N]=D),b(D)}function b(w){e=Nm.resolve(w,e.slice(a)),p()}}});var eK=M((p2e,J8)=>{J8.exports=Vp;Vp.realpath=Vp;Vp.sync=ZO;Vp.realpathSync=ZO;Vp.monkeypatch=Mme;Vp.unmonkeypatch=Ome;var Ev=require("fs"),YO=Ev.realpath,XO=Ev.realpathSync,Nme=process.version,V8=/^v[0-5]\./.test(Nme),B8=W8();function q8(r){return r&&r.syscall==="realpath"&&(r.code==="ELOOP"||r.code==="ENOMEM"||r.code==="ENAMETOOLONG")}function Vp(r,e,t){if(V8)return YO(r,e,t);typeof e=="function"&&(t=e,e=null),YO(r,e,function(n,i){q8(n)?B8.realpath(r,e,t):t(n,i)})}function ZO(r,e){if(V8)return XO(r,e);try{return XO(r,e)}catch(t){if(q8(t))return B8.realpathSync(r,e);throw t}}function Mme(){Ev.realpath=Vp,Ev.realpathSync=ZO}function Ome(){Ev.realpath=YO,Ev.realpathSync=XO}});var $8=M((d2e,tK)=>{typeof Object.create=="function"?tK.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:tK.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}});var H8=M((m2e,nK)=>{try{if(rK=require("util"),typeof rK.inherits!="function")throw"";nK.exports=rK.inherits}catch{nK.exports=$8()}var rK});var b_=M((f2e,y_)=>{"use strict";function G8(r){return r.charAt(0)==="/"}function z8(r){var e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,t=e.exec(r),n=t[1]||"",i=!!(n&&n.charAt(1)!==":");return!!(t[2]||i)}y_.exports=process.platform==="win32"?z8:G8;y_.exports.posix=G8;y_.exports.win32=z8});var oK=M(Bp=>{Bp.setopts=Wme;Bp.ownProp=Q8;Bp.makeAbs=Vx;Bp.finish=Vme;Bp.mark=Bme;Bp.isIgnored=X8;Bp.childrenIgnored=qme;function Q8(r,e){return Object.prototype.hasOwnProperty.call(r,e)}var Kme=require("fs"),Pv=require("path"),Fme=Kx(),Y8=b_(),iK=Fme.Minimatch;function Lme(r,e){return r.localeCompare(e,"en")}function Ume(r,e){r.ignore=e.ignore||[],Array.isArray(r.ignore)||(r.ignore=[r.ignore]),r.ignore.length&&(r.ignore=r.ignore.map(jme))}function jme(r){var e=null;if(r.slice(-3)==="/**"){var t=r.replace(/(\/\*\*)+$/,"");e=new iK(t,{dot:!0})}return{matcher:new iK(r,{dot:!0}),gmatcher:e}}function Wme(r,e,t){if(t||(t={}),t.matchBase&&e.indexOf("/")===-1){if(t.noglobstar)throw new Error("base matching requires globstar");e="**/"+e}r.silent=!!t.silent,r.pattern=e,r.strict=t.strict!==!1,r.realpath=!!t.realpath,r.realpathCache=t.realpathCache||Object.create(null),r.follow=!!t.follow,r.dot=!!t.dot,r.mark=!!t.mark,r.nodir=!!t.nodir,r.nodir&&(r.mark=!0),r.sync=!!t.sync,r.nounique=!!t.nounique,r.nonull=!!t.nonull,r.nosort=!!t.nosort,r.nocase=!!t.nocase,r.stat=!!t.stat,r.noprocess=!!t.noprocess,r.absolute=!!t.absolute,r.fs=t.fs||Kme,r.maxLength=t.maxLength||1/0,r.cache=t.cache||Object.create(null),r.statCache=t.statCache||Object.create(null),r.symlinks=t.symlinks||Object.create(null),Ume(r,t),r.changedCwd=!1;var n=process.cwd();Q8(t,"cwd")?(r.cwd=Pv.resolve(t.cwd),r.changedCwd=r.cwd!==n):r.cwd=n,r.root=t.root||Pv.resolve(r.cwd,"/"),r.root=Pv.resolve(r.root),process.platform==="win32"&&(r.root=r.root.replace(/\\/g,"/")),r.cwdAbs=Y8(r.cwd)?r.cwd:Vx(r,r.cwd),process.platform==="win32"&&(r.cwdAbs=r.cwdAbs.replace(/\\/g,"/")),r.nomount=!!t.nomount,t.nonegate=!0,t.nocomment=!0,r.minimatch=new iK(e,t),r.options=r.minimatch.options}function Vme(r){for(var e=r.nounique,t=e?[]:Object.create(null),n=0,i=r.matches.length;n<i;n++){var o=r.matches[n];if(!o||Object.keys(o).length===0){if(r.nonull){var s=r.minimatch.globSet[n];e?t.push(s):t[s]=!0}}else{var a=Object.keys(o);e?t.push.apply(t,a):a.forEach(function(c){t[c]=!0})}}if(e||(t=Object.keys(t)),r.nosort||(t=t.sort(Lme)),r.mark){for(var n=0;n<t.length;n++)t[n]=r._mark(t[n]);r.nodir&&(t=t.filter(function(c){var l=!/\/$/.test(c),u=r.cache[c]||r.cache[Vx(r,c)];return l&&u&&(l=u!=="DIR"&&!Array.isArray(u)),l}))}r.ignore.length&&(t=t.filter(function(c){return!X8(r,c)})),r.found=t}function Bme(r,e){var t=Vx(r,e),n=r.cache[t],i=e;if(n){var o=n==="DIR"||Array.isArray(n),s=e.slice(-1)==="/";if(o&&!s?i+="/":!o&&s&&(i=i.slice(0,-1)),i!==e){var a=Vx(r,i);r.statCache[a]=r.statCache[t],r.cache[a]=r.cache[t]}}return i}function Vx(r,e){var t=e;return e.charAt(0)==="/"?t=Pv.join(r.root,e):Y8(e)||e===""?t=e:r.changedCwd?t=Pv.resolve(r.cwd,e):t=Pv.resolve(e),process.platform==="win32"&&(t=t.replace(/\\/g,"/")),t}function X8(r,e){return r.ignore.length?r.ignore.some(function(t){return t.matcher.match(e)||!!(t.gmatcher&&t.gmatcher.match(e))}):!1}function qme(r,e){return r.ignore.length?r.ignore.some(function(t){return!!(t.gmatcher&&t.gmatcher.match(e))}):!1}});var n7=M((b2e,r7)=>{r7.exports=t7;t7.GlobSync=Kn;var Jme=eK(),Z8=Kx(),g2e=Z8.Minimatch,v2e=cK().Glob,y2e=require("util"),sK=require("path"),e7=require("assert"),I_=b_(),Mm=oK(),$me=Mm.setopts,aK=Mm.ownProp,Hme=Mm.childrenIgnored,Gme=Mm.isIgnored;function t7(r,e){if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);return new Kn(r,e).found}function Kn(r,e){if(!r)throw new Error("must provide pattern");if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);if(!(this instanceof Kn))return new Kn(r,e);if($me(this,r,e),this.noprocess)return this;var t=this.minimatch.set.length;this.matches=new Array(t);for(var n=0;n<t;n++)this._process(this.minimatch.set[n],n,!1);this._finish()}Kn.prototype._finish=function(){if(e7(this instanceof Kn),this.realpath){var r=this;this.matches.forEach(function(e,t){var n=r.matches[t]=Object.create(null);for(var i in e)try{i=r._makeAbs(i);var o=Jme.realpathSync(i,r.realpathCache);n[o]=!0}catch(s){if(s.syscall==="stat")n[r._makeAbs(i)]=!0;else throw s}})}Mm.finish(this)};Kn.prototype._process=function(r,e,t){e7(this instanceof Kn);for(var n=0;typeof r[n]=="string";)n++;var i;switch(n){case r.length:this._processSimple(r.join("/"),e);return;case 0:i=null;break;default:i=r.slice(0,n).join("/");break}var o=r.slice(n),s;i===null?s=".":((I_(i)||I_(r.join("/")))&&(!i||!I_(i))&&(i="/"+i),s=i);var a=this._makeAbs(s);if(!Hme(this,s)){var c=o[0]===Z8.GLOBSTAR;c?this._processGlobStar(i,s,a,o,e,t):this._processReaddir(i,s,a,o,e,t)}};Kn.prototype._processReaddir=function(r,e,t,n,i,o){var s=this._readdir(t,o);if(s){for(var a=n[0],c=!!this.minimatch.negate,l=a._glob,u=this.dot||l.charAt(0)===".",p=[],m=0;m<s.length;m++){var h=s[m];if(h.charAt(0)!=="."||u){var g;c&&!r?g=!h.match(a):g=h.match(a),g&&p.push(h)}}var b=p.length;if(b!==0){if(n.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var m=0;m<b;m++){var h=p[m];r&&(r.slice(-1)!=="/"?h=r+"/"+h:h=r+h),h.charAt(0)==="/"&&!this.nomount&&(h=sK.join(this.root,h)),this._emitMatch(i,h)}return}n.shift();for(var m=0;m<b;m++){var h=p[m],w;r?w=[r,h]:w=[h],this._process(w.concat(n),i,o)}}}};Kn.prototype._emitMatch=function(r,e){if(!Gme(this,e)){var t=this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[r][e]){if(this.nodir){var n=this.cache[t];if(n==="DIR"||Array.isArray(n))return}this.matches[r][e]=!0,this.stat&&this._stat(e)}}};Kn.prototype._readdirInGlobStar=function(r){if(this.follow)return this._readdir(r,!1);var e,t,n;try{t=this.fs.lstatSync(r)}catch(o){if(o.code==="ENOENT")return null}var i=t&&t.isSymbolicLink();return this.symlinks[r]=i,!i&&t&&!t.isDirectory()?this.cache[r]="FILE":e=this._readdir(r,!1),e};Kn.prototype._readdir=function(r,e){var t;if(e&&!aK(this.symlinks,r))return this._readdirInGlobStar(r);if(aK(this.cache,r)){var n=this.cache[r];if(!n||n==="FILE")return null;if(Array.isArray(n))return n}try{return this._readdirEntries(r,this.fs.readdirSync(r))}catch(i){return this._readdirError(r,i),null}};Kn.prototype._readdirEntries=function(r,e){if(!this.mark&&!this.stat)for(var t=0;t<e.length;t++){var n=e[t];r==="/"?n=r+n:n=r+"/"+n,this.cache[n]=!0}return this.cache[r]=e,e};Kn.prototype._readdirError=function(r,e){switch(e.code){case"ENOTSUP":case"ENOTDIR":var t=this._makeAbs(r);if(this.cache[t]="FILE",t===this.cwdAbs){var n=new Error(e.code+" invalid cwd "+this.cwd);throw n.path=this.cwd,n.code=e.code,n}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(r)]=!1;break;default:if(this.cache[this._makeAbs(r)]=!1,this.strict)throw e;this.silent||console.error("glob error",e);break}};Kn.prototype._processGlobStar=function(r,e,t,n,i,o){var s=this._readdir(t,o);if(s){var a=n.slice(1),c=r?[r]:[],l=c.concat(a);this._process(l,i,!1);var u=s.length,p=this.symlinks[t];if(!(p&&o))for(var m=0;m<u;m++){var h=s[m];if(!(h.charAt(0)==="."&&!this.dot)){var g=c.concat(s[m],a);this._process(g,i,!0);var b=c.concat(s[m],n);this._process(b,i,!0)}}}};Kn.prototype._processSimple=function(r,e){var t=this._stat(r);if(this.matches[e]||(this.matches[e]=Object.create(null)),!!t){if(r&&I_(r)&&!this.nomount){var n=/[\/\\]$/.test(r);r.charAt(0)==="/"?r=sK.join(this.root,r):(r=sK.resolve(this.root,r),n&&(r+="/"))}process.platform==="win32"&&(r=r.replace(/\\/g,"/")),this._emitMatch(e,r)}};Kn.prototype._stat=function(r){var e=this._makeAbs(r),t=r.slice(-1)==="/";if(r.length>this.maxLength)return!1;if(!this.stat&&aK(this.cache,e)){var s=this.cache[e];if(Array.isArray(s)&&(s="DIR"),!t||s==="DIR")return s;if(t&&s==="FILE")return!1}var n,i=this.statCache[e];if(!i){var o;try{o=this.fs.lstatSync(e)}catch(a){if(a&&(a.code==="ENOENT"||a.code==="ENOTDIR"))return this.statCache[e]=!1,!1}if(o&&o.isSymbolicLink())try{i=this.fs.statSync(e)}catch{i=o}else i=o}this.statCache[e]=i;var s=!0;return i&&(s=i.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,t&&s==="FILE"?!1:s};Kn.prototype._mark=function(r){return Mm.mark(this,r)};Kn.prototype._makeAbs=function(r){return Mm.makeAbs(this,r)}});var lK=M((I2e,o7)=>{o7.exports=i7;function i7(r,e){if(r&&e)return i7(r)(e);if(typeof r!="function")throw new TypeError("need wrapper function");return Object.keys(r).forEach(function(n){t[n]=r[n]}),t;function t(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];var o=r.apply(this,n),s=n[n.length-1];return typeof o=="function"&&o!==s&&Object.keys(s).forEach(function(a){o[a]=s[a]}),o}}});var pK=M((S2e,uK)=>{var s7=lK();uK.exports=s7(S_);uK.exports.strict=s7(a7);S_.proto=S_(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return S_(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return a7(this)},configurable:!0})});function S_(r){var e=function(){return e.called?e.value:(e.called=!0,e.value=r.apply(this,arguments))};return e.called=!1,e}function a7(r){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=r.apply(this,arguments)},t=r.name||"Function wrapped with `once`";return e.onceError=t+" shouldn't be called more than once",e.called=!1,e}});var l7=M((x2e,c7)=>{var zme=lK(),Bx=Object.create(null),Qme=pK();c7.exports=zme(Yme);function Yme(r,e){return Bx[r]?(Bx[r].push(e),null):(Bx[r]=[e],Xme(r))}function Xme(r){return Qme(function e(){var t=Bx[r],n=t.length,i=Zme(arguments);try{for(var o=0;o<n;o++)t[o].apply(null,i)}finally{t.length>n?(t.splice(0,n),process.nextTick(function(){e.apply(null,i)})):delete Bx[r]}})}function Zme(r){for(var e=r.length,t=[],n=0;n<e;n++)t[n]=r[n];return t}});var cK=M((E2e,p7)=>{p7.exports=Om;var efe=eK(),u7=Kx(),C2e=u7.Minimatch,tfe=H8(),rfe=require("events").EventEmitter,dK=require("path"),mK=require("assert"),qx=b_(),hK=n7(),Km=oK(),nfe=Km.setopts,fK=Km.ownProp,gK=l7(),w2e=require("util"),ife=Km.childrenIgnored,ofe=Km.isIgnored,sfe=pK();function Om(r,e,t){if(typeof e=="function"&&(t=e,e={}),e||(e={}),e.sync){if(t)throw new TypeError("callback provided to sync glob");return hK(r,e)}return new vr(r,e,t)}Om.sync=hK;var afe=Om.GlobSync=hK.GlobSync;Om.glob=Om;function cfe(r,e){if(e===null||typeof e!="object")return r;for(var t=Object.keys(e),n=t.length;n--;)r[t[n]]=e[t[n]];return r}Om.hasMagic=function(r,e){var t=cfe({},e);t.noprocess=!0;var n=new vr(r,t),i=n.minimatch.set;if(!r)return!1;if(i.length>1)return!0;for(var o=0;o<i[0].length;o++)if(typeof i[0][o]!="string")return!0;return!1};Om.Glob=vr;tfe(vr,rfe);function vr(r,e,t){if(typeof e=="function"&&(t=e,e=null),e&&e.sync){if(t)throw new TypeError("callback provided to sync glob");return new afe(r,e)}if(!(this instanceof vr))return new vr(r,e,t);nfe(this,r,e),this._didRealPath=!1;var n=this.minimatch.set.length;this.matches=new Array(n),typeof t=="function"&&(t=sfe(t),this.on("error",t),this.on("end",function(c){t(null,c)}));var i=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(n===0)return a();for(var o=!0,s=0;s<n;s++)this._process(this.minimatch.set[s],s,!1,a);o=!1;function a(){--i._processing,i._processing<=0&&(o?process.nextTick(function(){i._finish()}):i._finish())}}vr.prototype._finish=function(){if(mK(this instanceof vr),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();Km.finish(this),this.emit("end",this.found)}};vr.prototype._realpath=function(){if(this._didRealpath)return;this._didRealpath=!0;var r=this.matches.length;if(r===0)return this._finish();for(var e=this,t=0;t<this.matches.length;t++)this._realpathSet(t,n);function n(){--r===0&&e._finish()}};vr.prototype._realpathSet=function(r,e){var t=this.matches[r];if(!t)return e();var n=Object.keys(t),i=this,o=n.length;if(o===0)return e();var s=this.matches[r]=Object.create(null);n.forEach(function(a,c){a=i._makeAbs(a),efe.realpath(a,i.realpathCache,function(l,u){l?l.syscall==="stat"?s[a]=!0:i.emit("error",l):s[u]=!0,--o===0&&(i.matches[r]=s,e())})})};vr.prototype._mark=function(r){return Km.mark(this,r)};vr.prototype._makeAbs=function(r){return Km.makeAbs(this,r)};vr.prototype.abort=function(){this.aborted=!0,this.emit("abort")};vr.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))};vr.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var r=this._emitQueue.slice(0);this._emitQueue.length=0;for(var e=0;e<r.length;e++){var t=r[e];this._emitMatch(t[0],t[1])}}if(this._processQueue.length){var n=this._processQueue.slice(0);this._processQueue.length=0;for(var e=0;e<n.length;e++){var i=n[e];this._processing--,this._process(i[0],i[1],i[2],i[3])}}}};vr.prototype._process=function(r,e,t,n){if(mK(this instanceof vr),mK(typeof n=="function"),!this.aborted){if(this._processing++,this.paused){this._processQueue.push([r,e,t,n]);return}for(var i=0;typeof r[i]=="string";)i++;var o;switch(i){case r.length:this._processSimple(r.join("/"),e,n);return;case 0:o=null;break;default:o=r.slice(0,i).join("/");break}var s=r.slice(i),a;o===null?a=".":((qx(o)||qx(r.join("/")))&&(!o||!qx(o))&&(o="/"+o),a=o);var c=this._makeAbs(a);if(ife(this,a))return n();var l=s[0]===u7.GLOBSTAR;l?this._processGlobStar(o,a,c,s,e,t,n):this._processReaddir(o,a,c,s,e,t,n)}};vr.prototype._processReaddir=function(r,e,t,n,i,o,s){var a=this;this._readdir(t,o,function(c,l){return a._processReaddir2(r,e,t,n,i,o,l,s)})};vr.prototype._processReaddir2=function(r,e,t,n,i,o,s,a){if(!s)return a();for(var c=n[0],l=!!this.minimatch.negate,u=c._glob,p=this.dot||u.charAt(0)===".",m=[],h=0;h<s.length;h++){var g=s[h];if(g.charAt(0)!=="."||p){var b;l&&!r?b=!g.match(c):b=g.match(c),b&&m.push(g)}}var w=m.length;if(w===0)return a();if(n.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var h=0;h<w;h++){var g=m[h];r&&(r!=="/"?g=r+"/"+g:g=r+g),g.charAt(0)==="/"&&!this.nomount&&(g=dK.join(this.root,g)),this._emitMatch(i,g)}return a()}n.shift();for(var h=0;h<w;h++){var g=m[h],k;r&&(r!=="/"?g=r+"/"+g:g=r+g),this._process([g].concat(n),i,o,a)}a()};vr.prototype._emitMatch=function(r,e){if(!this.aborted&&!ofe(this,e)){if(this.paused){this._emitQueue.push([r,e]);return}var t=qx(e)?e:this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[r][e]){if(this.nodir){var n=this.cache[t];if(n==="DIR"||Array.isArray(n))return}this.matches[r][e]=!0;var i=this.statCache[t];i&&this.emit("stat",e,i),this.emit("match",e)}}};vr.prototype._readdirInGlobStar=function(r,e){if(this.aborted)return;if(this.follow)return this._readdir(r,!1,e);var t="lstat\0"+r,n=this,i=gK(t,o);i&&n.fs.lstat(r,i);function o(s,a){if(s&&s.code==="ENOENT")return e();var c=a&&a.isSymbolicLink();n.symlinks[r]=c,!c&&a&&!a.isDirectory()?(n.cache[r]="FILE",e()):n._readdir(r,!1,e)}};vr.prototype._readdir=function(r,e,t){if(!this.aborted&&(t=gK("readdir\0"+r+"\0"+e,t),!!t)){if(e&&!fK(this.symlinks,r))return this._readdirInGlobStar(r,t);if(fK(this.cache,r)){var n=this.cache[r];if(!n||n==="FILE")return t();if(Array.isArray(n))return t(null,n)}var i=this;i.fs.readdir(r,lfe(this,r,t))}};function lfe(r,e,t){return function(n,i){n?r._readdirError(e,n,t):r._readdirEntries(e,i,t)}}vr.prototype._readdirEntries=function(r,e,t){if(!this.aborted){if(!this.mark&&!this.stat)for(var n=0;n<e.length;n++){var i=e[n];r==="/"?i=r+i:i=r+"/"+i,this.cache[i]=!0}return this.cache[r]=e,t(null,e)}};vr.prototype._readdirError=function(r,e,t){if(!this.aborted){switch(e.code){case"ENOTSUP":case"ENOTDIR":var n=this._makeAbs(r);if(this.cache[n]="FILE",n===this.cwdAbs){var i=new Error(e.code+" invalid cwd "+this.cwd);i.path=this.cwd,i.code=e.code,this.emit("error",i),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(r)]=!1;break;default:this.cache[this._makeAbs(r)]=!1,this.strict&&(this.emit("error",e),this.abort()),this.silent||console.error("glob error",e);break}return t()}};vr.prototype._processGlobStar=function(r,e,t,n,i,o,s){var a=this;this._readdir(t,o,function(c,l){a._processGlobStar2(r,e,t,n,i,o,l,s)})};vr.prototype._processGlobStar2=function(r,e,t,n,i,o,s,a){if(!s)return a();var c=n.slice(1),l=r?[r]:[],u=l.concat(c);this._process(u,i,!1,a);var p=this.symlinks[t],m=s.length;if(p&&o)return a();for(var h=0;h<m;h++){var g=s[h];if(!(g.charAt(0)==="."&&!this.dot)){var b=l.concat(s[h],c);this._process(b,i,!0,a);var w=l.concat(s[h],n);this._process(w,i,!0,a)}}a()};vr.prototype._processSimple=function(r,e,t){var n=this;this._stat(r,function(i,o){n._processSimple2(r,e,i,o,t)})};vr.prototype._processSimple2=function(r,e,t,n,i){if(this.matches[e]||(this.matches[e]=Object.create(null)),!n)return i();if(r&&qx(r)&&!this.nomount){var o=/[\/\\]$/.test(r);r.charAt(0)==="/"?r=dK.join(this.root,r):(r=dK.resolve(this.root,r),o&&(r+="/"))}process.platform==="win32"&&(r=r.replace(/\\/g,"/")),this._emitMatch(e,r),i()};vr.prototype._stat=function(r,e){var t=this._makeAbs(r),n=r.slice(-1)==="/";if(r.length>this.maxLength)return e();if(!this.stat&&fK(this.cache,t)){var i=this.cache[t];if(Array.isArray(i)&&(i="DIR"),!n||i==="DIR")return e(null,i);if(n&&i==="FILE")return e()}var o,s=this.statCache[t];if(s!==void 0){if(s===!1)return e(null,s);var a=s.isDirectory()?"DIR":"FILE";return n&&a==="FILE"?e():e(null,a,s)}var c=this,l=gK("stat\0"+t,u);l&&c.fs.lstat(t,l);function u(p,m){if(m&&m.isSymbolicLink())return c.fs.stat(t,function(h,g){h?c._stat2(r,t,null,m,e):c._stat2(r,t,h,g,e)});c._stat2(r,t,p,m,e)}};vr.prototype._stat2=function(r,e,t,n,i){if(t&&(t.code==="ENOENT"||t.code==="ENOTDIR"))return this.statCache[e]=!1,i();var o=r.slice(-1)==="/";if(this.statCache[e]=n,e.slice(-1)==="/"&&n&&!n.isDirectory())return i(null,!1,n);var s=!0;return n&&(s=n.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,o&&s==="FILE"?i():i(null,s,n)}});var f7=M((P2e,m7)=>{"use strict";var d7=process.platform==="win32",ufe=d7?/[^:]\\$/:/.\/$/;m7.exports=function(){var r;return d7?r=process.env.TEMP||process.env.TMP||(process.env.SystemRoot||process.env.windir)+"\\temp":r=process.env.TMPDIR||process.env.TMP||process.env.TEMP||"/tmp",ufe.test(r)&&(r=r.slice(0,-1)),r}});var _7=M((k2e,Ql)=>{var bo=require("fs"),vK=require("path"),h7=require("crypto"),pfe=f7(),Jx=require("constants"),yK=pfe(),g7="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",bK=/XXXXXX/,y7=3,b7=Jx.O_CREAT|Jx.O_EXCL|Jx.O_RDWR,I7=448,S7=384,kv=[],x7=!1,IK=!1;function v7(r){var e=[],t=null;try{t=h7.randomBytes(r)}catch{t=h7.pseudoRandomBytes(r)}for(var n=0;n<r;n++)e.push(g7[t[n]%g7.length]);return e.join("")}function dfe(r){return typeof r>"u"}function _v(r,e){if(typeof r=="function"){var t=r;r=e||{},e=t}else typeof r>"u"&&(r={});return[r,e]}function C7(r){if(r.name)return vK.join(r.dir||yK,r.name);if(r.template)return r.template.replace(bK,v7(6));var e=[r.prefix||"tmp-",process.pid,v7(12),r.postfix||""].join("");return vK.join(r.dir||yK,e)}function SK(r,e){var t=_v(r,e),n=t[0],i=t[1],o=n.tries||y7;if(isNaN(o)||o<0)return i(new Error("Invalid tries"));if(n.template&&!n.template.match(bK))return i(new Error("Invalid template provided"));(function s(){var a=C7(n);bo.stat(a,function(c){if(!c)return o-- >0?s():i(new Error("Could not get a unique tmp filename, max tries reached "+a));i(null,a)})})()}function xK(r){var e=_v(r),t=e[0],n=t.tries||y7;if(isNaN(n)||n<0)throw new Error("Invalid tries");if(t.template&&!t.template.match(bK))throw new Error("Invalid template provided");do{var i=C7(t);try{bo.statSync(i)}catch{return i}}while(n-- >0);throw new Error("Could not get a unique tmp filename, max tries reached")}function mfe(r,e){var t=_v(r,e),n=t[0],i=t[1];n.postfix=dfe(n.postfix)?".tmp":n.postfix,SK(n,function(s,a){if(s)return i(s);bo.open(a,b7,n.mode||S7,function(l,u){if(l)return i(l);i(null,a,u,w7(a,u,n))})})}function ffe(r){var e=_v(r),t=e[0];t.postfix=t.postfix||".tmp";var n=xK(t),i=bo.openSync(n,b7,t.mode||S7);return{name:n,fd:i,removeCallback:w7(n,i,t)}}function hfe(r){var e=[r];do{for(var t=e.pop(),n=!1,i=bo.readdirSync(t),o=0,s=i.length;o<s;o++){var a=vK.join(t,i[o]),c=bo.lstatSync(a);c.isDirectory()?(n||(n=!0,e.push(t)),e.push(a)):bo.unlinkSync(a)}n||bo.rmdirSync(t)}while(e.length!==0)}function gfe(r,e){var t=_v(r,e),n=t[0],i=t[1];SK(n,function(s,a){if(s)return i(s);bo.mkdir(a,n.mode||I7,function(l){if(l)return i(l);i(null,a,E7(a,n))})})}function vfe(r){var e=_v(r),t=e[0],n=xK(t);return bo.mkdirSync(n,t.mode||I7),{name:n,removeCallback:E7(n,t)}}function w7(r,e,t){var n=P7(function(o){try{bo.closeSync(o[0])}catch(s){if(s.errno!=-Jx.EBADF&&s.errno!=-Jx.ENOENT)throw s}bo.unlinkSync(o[1])},[e,r]);return t.keep||kv.unshift(n),n}function E7(r,e){var t=e.unsafeCleanup?hfe:bo.rmdirSync.bind(bo),n=P7(t,r);return e.keep||kv.unshift(n),n}function P7(r,e){var t=!1;return function n(){if(!t){var i=kv.indexOf(n);i>=0&&kv.splice(i,1),t=!0,r(e)}}}function k7(){if(!(IK&&!x7))for(var r=0,e=kv.length;r<e;r++)try{kv[r].call(null)}catch{}}function yfe(){x7=!0}var x_=process.versions.node.split(".").map(function(r){return parseInt(r,10)});x_[0]===0&&(x_[1]<9||x_[1]===9&&x_[2]<5)&&process.addListener("uncaughtException",function(e){throw IK=!0,k7(),e});process.addListener("exit",function(e){e&&(IK=!0),k7()});Ql.exports.tmpdir=yK;Ql.exports.dir=gfe;Ql.exports.dirSync=vfe;Ql.exports.file=mfe;Ql.exports.fileSync=ffe;Ql.exports.tmpName=SK;Ql.exports.tmpNameSync=xK;Ql.exports.setGracefulCleanup=yfe});var T7=M((Fm,D7)=>{var $x=require("node-fetch"),bfe=$x.default||$x,C_=function(r,e){return/^\/\//.test(r)&&(r="https:"+r),bfe.call(this,r,e)};C_.ponyfill=!0;D7.exports=Fm=C_;Fm.fetch=C_;Fm.Headers=$x.Headers;Fm.Request=$x.Request;Fm.Response=$x.Response;Fm.default=C_});var v$=M((kJe,g$)=>{var Nfe=require("crypto");g$.exports=function(){return Nfe.randomBytes(16)}});var I$=M((_Je,b$)=>{var y$=[];for(rC=0;rC<256;++rC)y$[rC]=(rC+256).toString(16).substr(1);var rC;function Mfe(r,e){var t=e||0,n=y$;return[n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]]].join("")}b$.exports=Mfe});var So=M((DJe,S$)=>{var Ofe=v$(),Kfe=I$();function Ffe(r,e,t){var n=e&&t||0;typeof r=="string"&&(e=r==="binary"?new Array(16):null,r=null),r=r||{};var i=r.random||(r.rng||Ofe)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e)for(var o=0;o<16;++o)e[n+o]=i[o];return e||Kfe(i)}S$.exports=Ffe});var k$=M((P7e,P$)=>{"use strict";function Ym(r){if(!(this instanceof Ym))return new Ym(r);r=r||{},this.concurrency=r.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=jfe.bind(this)}var Ufe=["push","unshift","splice"];Ufe.forEach(function(r){Ym.prototype[r]=function(){var e=Array.prototype[r].apply(this.jobs,arguments);return this._run(),e}});Object.defineProperty(Ym.prototype,"length",{get:function(){return this.pending+this.jobs.length}});Ym.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var r=this.jobs.shift();this.pending++,r(this._done),this._run()}if(this.pending===0)for(;this.cbs.length!==0;){var e=this.cbs.pop();process.nextTick(e)}}};Ym.prototype.onDone=function(r){typeof r=="function"&&(this.cbs.push(r),this._run())};function jfe(){this.pending--,this._run()}P$.exports=Ym});var Xm=M((k7e,_$)=>{"use strict";_$.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}});var q$=M((_7e,B$)=>{var A$=require("fs"),ru=require("path"),N$=require("os"),M$=typeof __webpack_require__=="function"?__non_webpack_require__:require,Wfe=process.config&&process.config.variables||{},Vfe=!!process.env.PREBUILDS_ONLY,D$=process.versions.modules,LK=Jfe()?"electron":qfe()?"node-webkit":"node",UK=process.env.npm_config_arch||N$.arch(),jK=process.env.npm_config_platform||N$.platform(),O$=process.env.LIBC||($fe(jK)?"musl":"glibc"),WK=process.env.ARM_VERSION||(UK==="arm64"?"8":Wfe.arm_version)||"",K$=(process.versions.uv||"").split(".")[0];B$.exports=zc;function zc(r){return M$(zc.resolve(r))}zc.resolve=zc.path=function(r){r=ru.resolve(r||".");try{var e=M$(ru.join(r,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[e+"_PREBUILD"]&&(r=process.env[e+"_PREBUILD"])}catch{}if(!Vfe){var t=T$(ru.join(r,"build/Release"),R$);if(t)return t;var n=T$(ru.join(r,"build/Debug"),R$);if(n)return n}var i=a(r);if(i)return i;var o=a(ru.dirname(process.execPath));if(o)return o;var s=["platform="+jK,"arch="+UK,"runtime="+LK,"abi="+D$,"uv="+K$,WK?"armv="+WK:"","libc="+O$,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+s+`
    loaded from: `+r+`
`);function a(c){var l=VK(ru.join(c,"prebuilds")).map(F$),u=l.filter(L$(jK,UK)).sort(U$)[0];if(u){var p=ru.join(c,"prebuilds",u.name),m=VK(p).map(j$),h=m.filter(W$(LK,D$)),g=h.sort(V$(LK))[0];if(g)return ru.join(p,g.file)}}};function VK(r){try{return A$.readdirSync(r)}catch{return[]}}function T$(r,e){var t=VK(r).filter(e);return t[0]&&ru.join(r,t[0])}function R$(r){return/\.node$/.test(r)}function F$(r){var e=r.split("-");if(e.length===2){var t=e[0],n=e[1].split("+");if(t&&n.length&&n.every(Boolean))return{name:r,platform:t,architectures:n}}}function L$(r,e){return function(t){return t==null||t.platform!==r?!1:t.architectures.includes(e)}}function U$(r,e){return r.architectures.length-e.architectures.length}function j$(r){var e=r.split("."),t=e.pop(),n={file:r,specificity:0};if(t==="node"){for(var i=0;i<e.length;i++){var o=e[i];if(o==="node"||o==="electron"||o==="node-webkit")n.runtime=o;else if(o==="napi")n.napi=!0;else if(o.slice(0,3)==="abi")n.abi=o.slice(3);else if(o.slice(0,2)==="uv")n.uv=o.slice(2);else if(o.slice(0,4)==="armv")n.armv=o.slice(4);else if(o==="glibc"||o==="musl")n.libc=o;else continue;n.specificity++}return n}}function W$(r,e){return function(t){return!(t==null||t.runtime!==r&&!Bfe(t)||t.abi!==e&&!t.napi||t.uv&&t.uv!==K$||t.armv&&t.armv!==WK||t.libc&&t.libc!==O$)}}function Bfe(r){return r.runtime==="node"&&r.napi}function V$(r){return function(e,t){return e.runtime!==t.runtime?e.runtime===r?-1:1:e.abi!==t.abi?e.abi?-1:1:e.specificity!==t.specificity?e.specificity>t.specificity?-1:1:0}}function qfe(){return!!(process.versions&&process.versions.nw)}function Jfe(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function $fe(r){return r==="linux"&&A$.existsSync("/etc/alpine-release")}zc.parseTags=j$;zc.matchTags=W$;zc.compareTags=V$;zc.parseTuple=F$;zc.matchTuple=L$;zc.compareTuples=U$});var qK=M((D7e,BK)=>{typeof process.addon=="function"?BK.exports=process.addon.bind(process):BK.exports=q$()});var $$=M((T7e,J$)=>{"use strict";var Hfe=(r,e,t,n,i)=>{for(var o=0;o<i;o++)t[n+o]=r[o]^e[o&3]},Gfe=(r,e)=>{let t=r.length;for(var n=0;n<t;n++)r[n]^=e[n&3]};J$.exports={mask:Hfe,unmask:Gfe}});var H$=M((R7e,JK)=>{"use strict";try{JK.exports=qK()(__dirname)}catch{JK.exports=$$()}});var Q_=M((A7e,$K)=>{"use strict";var{EMPTY_BUFFER:zfe}=Xm();function G$(r,e){if(r.length===0)return zfe;if(r.length===1)return r[0];let t=Buffer.allocUnsafe(e);for(var n=0,i=0;i<r.length;i++){let o=r[i];o.copy(t,n),n+=o.length}return t}function z$(r,e,t,n,i){for(var o=0;o<i;o++)t[n+o]=r[o]^e[o&3]}function Q$(r,e){let t=r.length;for(var n=0;n<t;n++)r[n]^=e[n&3]}function Y$(r){return r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}function z_(r){if(z_.readOnly=!0,Buffer.isBuffer(r))return r;var e;return r instanceof ArrayBuffer?e=Buffer.from(r):ArrayBuffer.isView(r)?e=Qfe(r):(e=Buffer.from(r),z_.readOnly=!1),e}function Qfe(r){let e=Buffer.from(r.buffer);return r.byteLength!==r.buffer.byteLength?e.slice(r.byteOffset,r.byteOffset+r.byteLength):e}try{let r=H$(),e=r.BufferUtil||r;$K.exports={concat:G$,mask(t,n,i,o,s){s<48?z$(t,n,i,o,s):e.mask(t,n,i,o,s)},toArrayBuffer:Y$,toBuffer:z_,unmask(t,n){t.length<32?Q$(t,n):e.unmask(t,n)}}}catch{$K.exports={concat:G$,mask:z$,toArrayBuffer:Y$,toBuffer:z_,unmask:Q$}}});var sC=M((N7e,r5)=>{"use strict";var Yfe=k$(),oC=require("zlib"),X$=Q_(),{kStatusCode:Z$,NOOP:Xfe}=Xm(),Zfe=Buffer.from([0,0,255,255]),ehe=Buffer.from([0]),X_=Symbol("permessage-deflate"),nu=Symbol("total-length"),e5=Symbol("callback"),ed=Symbol("buffers"),HK=Symbol("error"),Y_,GK=class{constructor(e,t,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!Y_){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Y_=new Yfe({concurrency:i})}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate&&(this._deflate.close(),this._deflate=null)}acceptAsServer(e){let t=this._options,n=e.find(i=>!(t.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>i.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!i.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(n.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?n.client_max_window_bits=t.clientMaxWindowBits:(n.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(n=>{var i=t[n];if(i.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(i=i[0],n==="client_max_window_bits"){if(i!==!0){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=o}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else if(n==="server_max_window_bits"){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=o}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(i!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else throw new Error(`Unknown parameter "${n}"`);t[n]=i})}),e}decompress(e,t,n){Y_.push(i=>{this._decompress(e,t,(o,s)=>{i(),n(o,s)})})}compress(e,t,n){Y_.push(i=>{this._compress(e,t,(o,s)=>{i(),n(o,s)})})}_decompress(e,t,n){let i=this._isServer?"client":"server";if(!this._inflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?oC.Z_DEFAULT_WINDOWBITS:this.params[o];this._inflate=oC.createInflateRaw(Object.assign({},this._options.zlibInflateOptions,{windowBits:s})),this._inflate[X_]=this,this._inflate[nu]=0,this._inflate[ed]=[],this._inflate.on("error",rhe),this._inflate.on("data",t5)}this._inflate[e5]=n,this._inflate.write(e),t&&this._inflate.write(Zfe),this._inflate.flush(()=>{let o=this._inflate[HK];if(o){this._inflate.close(),this._inflate=null,n(o);return}let s=X$.concat(this._inflate[ed],this._inflate[nu]);t&&this.params[`${i}_no_context_takeover`]?(this._inflate.close(),this._inflate=null):(this._inflate[nu]=0,this._inflate[ed]=[]),n(null,s)})}_compress(e,t,n){if(!e||e.length===0){process.nextTick(n,null,ehe);return}let i=this._isServer?"server":"client";if(!this._deflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?oC.Z_DEFAULT_WINDOWBITS:this.params[o];this._deflate=oC.createDeflateRaw(Object.assign({},this._options.zlibDeflateOptions,{windowBits:s})),this._deflate[nu]=0,this._deflate[ed]=[],this._deflate.on("error",Xfe),this._deflate.on("data",the)}this._deflate.write(e),this._deflate.flush(oC.Z_SYNC_FLUSH,()=>{if(this._deflate){var o=X$.concat(this._deflate[ed],this._deflate[nu]);t&&(o=o.slice(0,o.length-4)),t&&this.params[`${i}_no_context_takeover`]?(this._deflate.close(),this._deflate=null):(this._deflate[nu]=0,this._deflate[ed]=[]),n(null,o)}})}};r5.exports=GK;function the(r){this[ed].push(r),this[nu]+=r.length}function t5(r){if(this[nu]+=r.length,this[X_]._maxPayload<1||this[nu]<=this[X_]._maxPayload){this[ed].push(r);return}this[HK]=new RangeError("Max payload size exceeded"),this[HK][Z$]=1009,this.removeListener("data",t5),this.reset()}function rhe(r){this[X_]._inflate=null,r[Z$]=1007,this[e5](r)}});var i5=M((M7e,n5)=>{"use strict";var ay=class{constructor(e,t){this.target=t,this.type=e}},zK=class extends ay{constructor(e,t){super("message",t),this.data=e}},QK=class extends ay{constructor(e,t,n){super("close",n),this.wasClean=n._closeFrameReceived&&n._closeFrameSent,this.reason=t,this.code=e}},YK=class extends ay{constructor(e){super("open",e)}},XK=class extends ay{constructor(e,t){super("error",t),this.message=e.message,this.error=e}},nhe={addEventListener(r,e){if(typeof e!="function")return;function t(s){e.call(this,new zK(s,this))}function n(s,a){e.call(this,new QK(s,a,this))}function i(s){e.call(this,new XK(s,this))}function o(){e.call(this,new YK(this))}r==="message"?(t._listener=e,this.on(r,t)):r==="close"?(n._listener=e,this.on(r,n)):r==="error"?(i._listener=e,this.on(r,i)):r==="open"?(o._listener=e,this.on(r,o)):this.on(r,e)},removeEventListener(r,e){let t=this.listeners(r);for(var n=0;n<t.length;n++)(t[n]===e||t[n]._listener===e)&&this.removeListener(r,t[n])}};n5.exports=nhe});var ZK=M((O7e,o5)=>{"use strict";var aC=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Qc(r,e,t){Object.prototype.hasOwnProperty.call(r,e)?r[e].push(t):r[e]=[t]}function ihe(r){let e={};if(r===void 0||r==="")return e;for(var t={},n=!1,i=!1,o=!1,s,a,c=-1,l=-1,u=0;u<r.length;u++){let h=r.charCodeAt(u);if(s===void 0)if(l===-1&&aC[h]===1)c===-1&&(c=u);else if(h===32||h===9)l===-1&&c!==-1&&(l=u);else if(h===59||h===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1&&(l=u);let g=r.slice(c,l);h===44?(Qc(e,g,t),t={}):s=g,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${u}`);else if(a===void 0)if(l===-1&&aC[h]===1)c===-1&&(c=u);else if(h===32||h===9)l===-1&&c!==-1&&(l=u);else if(h===59||h===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1&&(l=u),Qc(t,r.slice(c,l),!0),h===44&&(Qc(e,s,t),t={},s=void 0),c=l=-1}else if(h===61&&c!==-1&&l===-1)a=r.slice(c,u),c=l=-1;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(i){if(aC[h]!==1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1?c=u:n||(n=!0),i=!1}else if(o)if(aC[h]===1)c===-1&&(c=u);else if(h===34&&c!==-1)o=!1,l=u;else if(h===92)i=!0;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(h===34&&r.charCodeAt(u-1)===61)o=!0;else if(l===-1&&aC[h]===1)c===-1&&(c=u);else if(c!==-1&&(h===32||h===9))l===-1&&(l=u);else if(h===59||h===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1&&(l=u);var p=r.slice(c,l);n&&(p=p.replace(/\\/g,""),n=!1),Qc(t,a,p),h===44&&(Qc(e,s,t),t={},s=void 0),a=void 0,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${u}`)}if(c===-1||o)throw new SyntaxError("Unexpected end of input");l===-1&&(l=u);let m=r.slice(c,l);return s===void 0?Qc(e,m,{}):(a===void 0?Qc(t,m,!0):n?Qc(t,a,m.replace(/\\/g,"")):Qc(t,a,m),Qc(e,s,t)),e}function ohe(r){return Object.keys(r).map(e=>{var t=r[e];return Array.isArray(t)||(t=[t]),t.map(n=>[e].concat(Object.keys(n).map(i=>{var o=n[i];return Array.isArray(o)||(o=[o]),o.map(s=>s===!0?i:`${i}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}o5.exports={format:ohe,parse:ihe}});var a5=M((K7e,s5)=>{"use strict";function she(r){let e=r.length,t=0;for(;t<e;)if(!(r[t]&128))t++;else if((r[t]&224)===192){if(t+1===e||(r[t+1]&192)!==128||(r[t]&254)===192)return!1;t+=2}else if((r[t]&240)===224){if(t+2>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||r[t]===224&&(r[t+1]&224)===128||r[t]===237&&(r[t+1]&224)===160)return!1;t+=3}else if((r[t]&248)===240){if(t+3>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||(r[t+3]&192)!==128||r[t]===240&&(r[t+1]&240)===128||r[t]===244&&r[t+1]>143||r[t]>244)return!1;t+=4}else return!1;return!0}s5.exports=she});var c5=M((F7e,eF)=>{"use strict";try{eF.exports=qK()(__dirname)}catch{eF.exports=a5()}});var tF=M(Z_=>{"use strict";try{let r=c5();Z_.isValidUTF8=typeof r=="object"?r.Validation.isValidUTF8:r}catch{Z_.isValidUTF8=()=>!0}Z_.isValidStatusCode=r=>r>=1e3&&r<=1013&&r!==1004&&r!==1005&&r!==1006||r>=3e3&&r<=4999});var oF=M((U7e,f5)=>{"use strict";var{Writable:ahe}=require("stream"),l5=sC(),{BINARY_TYPES:che,EMPTY_BUFFER:lhe,kStatusCode:uhe,kWebSocket:phe}=Xm(),{concat:rF,toArrayBuffer:dhe,unmask:mhe}=Q_(),{isValidStatusCode:fhe,isValidUTF8:u5}=tF(),cC=0,p5=1,d5=2,m5=3,nF=4,hhe=5,iF=class extends ahe{constructor(e,t,n){super(),this._binaryType=e||che[0],this[phe]=void 0,this._extensions=t||{},this._maxPayload=n|0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=cC,this._loop=!1}_write(e,t,n){if(this._opcode===8&&this._state==cC)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=n.slice(e),n.slice(0,e)}let t=Buffer.allocUnsafe(e);do{let n=this._buffers[0];e>=n.length?this._buffers.shift().copy(t,t.length-e):(n.copy(t,t.length-e,0,e),this._buffers[0]=n.slice(e)),e-=n.length}while(e>0);return t}startLoop(e){var t;this._loop=!0;do switch(this._state){case cC:t=this.getInfo();break;case p5:t=this.getPayloadLength16();break;case d5:t=this.getPayloadLength64();break;case m5:this.getMask();break;case nF:t=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let e=this.consume(2);if(e[0]&48)return this._loop=!1,ui(RangeError,"RSV2 and RSV3 must be clear",!0,1002);let t=(e[0]&64)===64;if(t&&!this._extensions[l5.extensionName])return this._loop=!1,ui(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(t)return this._loop=!1,ui(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,ui(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,ui(RangeError,`invalid opcode ${this._opcode}`,!0,1002);this._compressed=t}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,ui(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,ui(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,ui(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002)}else return this._loop=!1,ui(RangeError,`invalid opcode ${this._opcode}`,!0,1002);if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._payloadLength===126)this._state=p5;else if(this._payloadLength===127)this._state=d5;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,53-32)-1?(this._loop=!1,ui(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,ui(RangeError,"Max payload size exceeded",!1,1009);this._masked?this._state=m5:this._state=nF}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=nF}getData(e){var t=lhe;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&mhe(t,this._mask)}if(this._opcode>7)return this.controlMessage(t);if(this._compressed){this._state=hhe,this.decompress(t,e);return}return t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage()}decompress(e,t){this._extensions[l5.extensionName].decompress(e,this._fin,(i,o)=>{if(i)return t(i);if(o.length){if(this._messageLength+=o.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(ui(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(o)}let s=this.dataMessage();if(s)return t(s);this.startLoop(t)})}dataMessage(){if(this._fin){let t=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){var e;this._binaryType==="nodebuffer"?e=rF(n,t):this._binaryType==="arraybuffer"?e=dhe(rF(n,t)):e=n,this.emit("message",e)}else{let i=rF(n,t);if(!u5(i))return this._loop=!1,ui(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",i.toString())}}this._state=cC}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,""),this.end();else{if(e.length===1)return ui(RangeError,"invalid payload length 1",!0,1002);{let t=e.readUInt16BE(0);if(!fhe(t))return ui(RangeError,`invalid status code ${t}`,!0,1002);let n=e.slice(2);if(!u5(n))return ui(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,n.toString()),this.end()}}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=cC}};f5.exports=iF;function ui(r,e,t,n){let i=new r(t?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(i,ui),i[uhe]=n,i}});var aF=M((j7e,v5)=>{"use strict";var{randomBytes:ghe}=require("crypto"),h5=sC(),{EMPTY_BUFFER:vhe}=Xm(),{isValidStatusCode:yhe}=tF(),{mask:g5,toBuffer:iu}=Q_(),sF=class r{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let n=t.mask&&t.readOnly;var i=t.mask?6:2,o=e.length;e.length>=65536?(i+=8,o=127):e.length>125&&(i+=2,o=126);let s=Buffer.allocUnsafe(n?e.length+i:i);if(s[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(s[0]|=64),s[1]=o,o===126?s.writeUInt16BE(e.length,2):o===127&&(s.writeUInt32BE(0,2),s.writeUInt32BE(e.length,6)),!t.mask)return[s,e];let a=ghe(4);return s[1]|=128,s[i-4]=a[0],s[i-3]=a[1],s[i-2]=a[2],s[i-1]=a[3],n?(g5(e,a,s,i,e.length),[s]):(g5(e,a,e,0,e.length),[s,e])}close(e,t,n,i){var o;if(e===void 0)o=vhe;else{if(typeof e!="number"||!yhe(e))throw new TypeError("First argument must be a valid error code number");t===void 0||t===""?(o=Buffer.allocUnsafe(2),o.writeUInt16BE(e,0)):(o=Buffer.allocUnsafe(2+Buffer.byteLength(t)),o.writeUInt16BE(e,0),o.write(t,2))}this._deflating?this.enqueue([this.doClose,o,n,i]):this.doClose(o,n,i)}doClose(e,t,n){this.sendFrame(r.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),n)}ping(e,t,n){let i=iu(e);this._deflating?this.enqueue([this.doPing,i,t,iu.readOnly,n]):this.doPing(i,t,iu.readOnly,n)}doPing(e,t,n,i){this.sendFrame(r.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:n}),i)}pong(e,t,n){let i=iu(e);this._deflating?this.enqueue([this.doPong,i,t,iu.readOnly,n]):this.doPong(i,t,iu.readOnly,n)}doPong(e,t,n,i){this.sendFrame(r.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:n}),i)}send(e,t,n){let i=iu(e),o=this._extensions[h5.extensionName];var s=t.binary?2:1,a=t.compress;if(this._firstFragment?(this._firstFragment=!1,a&&o&&(a=i.length>=o._threshold),this._compress=a):(a=!1,s=0),t.fin&&(this._firstFragment=!0),o){let c={fin:t.fin,rsv1:a,opcode:s,mask:t.mask,readOnly:iu.readOnly};this._deflating?this.enqueue([this.dispatch,i,this._compress,c,n]):this.dispatch(i,this._compress,c,n)}else this.sendFrame(r.frame(i,{fin:t.fin,rsv1:!1,opcode:s,mask:t.mask,readOnly:iu.readOnly}),n)}dispatch(e,t,n,i){if(!t){this.sendFrame(r.frame(e,n),i);return}let o=this._extensions[h5.extensionName];this._deflating=!0,o.compress(e,n.fin,(s,a)=>{this._deflating=!1,n.readOnly=!1,this.sendFrame(r.frame(a,n),i),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[1].length,e[0].apply(this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};v5.exports=sF});var uF=M((W7e,_5)=>{"use strict";var bhe=require("events"),y5=require("crypto"),Ihe=require("https"),She=require("http"),xhe=require("net"),Che=require("tls"),cy=require("url"),td=sC(),x5=i5(),b5=ZK(),whe=oF(),Ehe=aF(),{BINARY_TYPES:I5,EMPTY_BUFFER:cF,GUID:Phe,kStatusCode:khe,kWebSocket:Co,NOOP:C5}=Xm(),eD=["CONNECTING","OPEN","CLOSING","CLOSED"],lF=[8,13],_he=30*1e3,wo=class r extends bhe{constructor(e,t,n){super(),this.readyState=r.CONNECTING,this.protocol="",this._binaryType=I5[0],this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._closeCode=1006,this._extensions={},this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._isServer=!1,this._redirects=0,Array.isArray(t)?t=t.join(", "):typeof t=="object"&&t!==null&&(n=t,t=void 0),w5(this,e,t,n)):this._isServer=!0}get CONNECTING(){return r.CONNECTING}get CLOSING(){return r.CLOSING}get CLOSED(){return r.CLOSED}get OPEN(){return r.OPEN}get binaryType(){return this._binaryType}set binaryType(e){I5.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?(this._socket.bufferSize||0)+this._sender._bufferedBytes:0}get extensions(){return Object.keys(this._extensions).join()}setSocket(e,t,n){let i=new whe(this._binaryType,this._extensions,n);this._sender=new Ehe(e,this._extensions),this._receiver=i,this._socket=e,i[Co]=this,e[Co]=this,i.on("conclude",Rhe),i.on("drain",Ahe),i.on("error",Nhe),i.on("message",Mhe),i.on("ping",Ohe),i.on("pong",Khe),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",E5),e.on("data",tD),e.on("end",P5),e.on("error",k5),this.readyState=r.OPEN,this.emit("open")}emitClose(){if(this.readyState=r.CLOSED,!this._socket){this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[td.extensionName]&&this._extensions[td.extensionName].cleanup(),this._receiver.removeAllListeners(),this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){let n="WebSocket was closed before the connection was established";return ou(this,this._req,n)}if(this.readyState===r.CLOSING){this._closeFrameSent&&this._closeFrameReceived&&this._socket.end();return}this.readyState=r.CLOSING,this._sender.close(e,t,!this._isServer,n=>{n||(this._closeFrameSent=!0,this._closeFrameReceived&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),_he)}}ping(e,t,n){if(typeof e=="function"?(n=e,e=t=void 0):typeof t=="function"&&(n=t,t=void 0),this.readyState!==r.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${eD[this.readyState]})`);if(n)return n(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.ping(e||cF,t,n)}pong(e,t,n){if(typeof e=="function"?(n=e,e=t=void 0):typeof t=="function"&&(n=t,t=void 0),this.readyState!==r.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${eD[this.readyState]})`);if(n)return n(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.pong(e||cF,t,n)}send(e,t,n){if(typeof t=="function"&&(n=t,t={}),this.readyState!==r.OPEN){let o=new Error(`WebSocket is not open: readyState ${this.readyState} (${eD[this.readyState]})`);if(n)return n(o);throw o}typeof e=="number"&&(e=e.toString());let i=Object.assign({binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[td.extensionName]||(i.compress=!1),this._sender.send(e||cF,i,n)}terminate(){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){let e="WebSocket was closed before the connection was established";return ou(this,this._req,e)}this._socket&&(this.readyState=r.CLOSING,this._socket.destroy())}}};eD.forEach((r,e)=>{wo[r]=e});["open","error","close","message"].forEach(r=>{Object.defineProperty(wo.prototype,`on${r}`,{get(){let e=this.listeners(r);for(var t=0;t<e.length;t++)if(e[t]._listener)return e[t]._listener},set(e){let t=this.listeners(r);for(var n=0;n<t.length;n++)t[n]._listener&&this.removeListener(r,t[n]);this.addEventListener(r,e)}})});wo.prototype.addEventListener=x5.addEventListener;wo.prototype.removeEventListener=x5.removeEventListener;_5.exports=wo;function w5(r,e,t,n){let i=Object.assign({protocolVersion:lF[1],maxPayload:104857600,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10},n,{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,auth:void 0,host:void 0,path:void 0,port:void 0});if(!lF.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${lF.join(", ")})`);var o;typeof e=="object"&&e.href!==void 0?(o=e,r.url=e.href):(o=cy.URL?new cy.URL(e):cy.parse(e),r.url=e);let s=o.protocol==="ws+unix:";if(!o.host&&(!s||!o.pathname))throw new Error(`Invalid URL: ${r.url}`);let a=o.protocol==="wss:"||o.protocol==="https:",c=a?443:80,l=y5.randomBytes(16).toString("base64"),u=a?Ihe.get:She.get,p=o.search?`${o.pathname||"/"}${o.search}`:o.pathname||"/";var m;if(i.createConnection=a?The:Dhe,i.defaultPort=i.defaultPort||c,i.port=o.port||c,i.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,i.headers=Object.assign({"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":l,Connection:"Upgrade",Upgrade:"websocket"},i.headers),i.path=p,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(m=new td(i.perMessageDeflate!==!0?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=b5.format({[td.extensionName]:m.offer()})),t&&(i.headers["Sec-WebSocket-Protocol"]=t),i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),o.auth?i.auth=o.auth:(o.username||o.password)&&(i.auth=`${o.username}:${o.password}`),s){let g=p.split(":");i.socketPath=g[0],i.path=g[1]}var h=r._req=u(i);i.timeout&&h.on("timeout",()=>{ou(r,h,"Opening handshake has timed out")}),h.on("error",g=>{r._req.aborted||(h=r._req=null,r.readyState=wo.CLOSING,r.emit("error",g),r.emitClose())}),h.on("response",g=>{let b=g.headers.location,w=g.statusCode;if(b&&i.followRedirects&&w>=300&&w<400){if(++r._redirects>i.maxRedirects){ou(r,h,"Maximum redirects exceeded");return}h.abort();let k=cy.URL?new cy.URL(b,e):cy.resolve(e,b);w5(r,k,t,n)}else r.emit("unexpected-response",h,g)||ou(r,h,`Unexpected server response: ${g.statusCode}`)}),h.on("upgrade",(g,b,w)=>{if(r.emit("upgrade",g),r.readyState!==wo.CONNECTING)return;h=r._req=null;let k=y5.createHash("sha1").update(l+Phe).digest("base64");if(g.headers["sec-websocket-accept"]!==k){ou(r,b,"Invalid Sec-WebSocket-Accept header");return}let N=g.headers["sec-websocket-protocol"],D=(t||"").split(/, */);var V;if(!t&&N?V="Server sent a subprotocol but none was requested":t&&!N?V="Server sent no subprotocol":N&&!D.includes(N)&&(V="Server sent an invalid subprotocol"),V){ou(r,b,V);return}if(N&&(r.protocol=N),m)try{let oe=b5.parse(g.headers["sec-websocket-extensions"]);oe[td.extensionName]&&(m.accept(oe[td.extensionName]),r._extensions[td.extensionName]=m)}catch{ou(r,b,"Invalid Sec-WebSocket-Extensions header");return}r.setSocket(b,w,i.maxPayload)})}function Dhe(r){return r.protocolVersion&&(r.path=r.socketPath),xhe.connect(r)}function The(r){return r.path=void 0,r.servername=r.servername||r.host,Che.connect(r)}function ou(r,e,t){r.readyState=wo.CLOSING;let n=new Error(t);Error.captureStackTrace(n,ou),e.setHeader?(e.abort(),e.once("abort",r.emitClose.bind(r)),r.emit("error",n)):(e.destroy(n),e.once("error",r.emit.bind(r,"error")),e.once("close",r.emitClose.bind(r)))}function Rhe(r,e){let t=this[Co];t._socket.removeListener("data",tD),t._socket.resume(),t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=r,r===1005?t.close():t.close(r,e)}function Ahe(){this[Co]._socket.resume()}function Nhe(r){let e=this[Co];e._socket.removeListener("data",tD),e.readyState=wo.CLOSING,e._closeCode=r[khe],e.emit("error",r),e._socket.destroy()}function S5(){this[Co].emitClose()}function Mhe(r){this[Co].emit("message",r)}function Ohe(r){let e=this[Co];e.pong(r,!e._isServer,C5),e.emit("ping",r)}function Khe(r){this[Co].emit("pong",r)}function E5(){let r=this[Co];this.removeListener("close",E5),this.removeListener("end",P5),r.readyState=wo.CLOSING,r._socket.read(),r._receiver.end(),this.removeListener("data",tD),this[Co]=void 0,clearTimeout(r._closeTimer),r._receiver._writableState.finished||r._receiver._writableState.errorEmitted?r.emitClose():(r._receiver.on("error",S5),r._receiver.on("finish",S5))}function tD(r){this[Co]._receiver.write(r)||this.pause()}function P5(){let r=this[Co];r.readyState=wo.CLOSING,r._receiver.end(),this.end()}function k5(){let r=this[Co];this.removeListener("error",k5),this.on("error",C5),r.readyState=wo.CLOSING,this.destroy()}});var R5=M((V7e,T5)=>{"use strict";var Fhe=require("events"),Lhe=require("crypto"),nD=require("http"),Zm=sC(),D5=ZK(),Uhe=uF(),{GUID:jhe}=Xm(),Whe=/^[+/0-9A-Za-z]{22}==$/,pF=class extends Fhe{constructor(e,t){if(super(),e=Object.assign({maxPayload:100*1024*1024,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},e),e.port==null&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');e.port!=null?(this._server=nD.createServer((n,i)=>{let o=nD.STATUS_CODES[426];i.writeHead(426,{"Content-Length":o.length,"Content-Type":"text/plain"}),i.end(o)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server&&(this._removeListeners=Vhe(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,i,o)=>{this.handleUpgrade(n,i,o,s=>{this.emit("connection",s,n)})}})),e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(e&&this.once("close",e),this.clients)for(let n of this.clients)n.terminate();let t=this._server;if(t&&(this._removeListeners(),this._removeListeners=this._server=null,this.options.port!=null)){t.close(()=>this.emit("close"));return}process.nextTick(Bhe,this)}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,i){t.on("error",dF);let o=e.headers["sec-websocket-key"]!==void 0?e.headers["sec-websocket-key"].trim():!1,s=+e.headers["sec-websocket-version"],a={};if(e.method!=="GET"||e.headers.upgrade.toLowerCase()!=="websocket"||!o||!Whe.test(o)||s!==8&&s!==13||!this.shouldHandle(e))return rD(t,400);if(this.options.perMessageDeflate){let c=new Zm(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let l=D5.parse(e.headers["sec-websocket-extensions"]);l[Zm.extensionName]&&(c.accept(l[Zm.extensionName]),a[Zm.extensionName]=c)}catch{return rD(t,400)}}if(this.options.verifyClient){let c={origin:e.headers[`${s===8?"sec-websocket-origin":"origin"}`],secure:!!(e.connection.authorized||e.connection.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(c,(l,u,p,m)=>{if(!l)return rD(t,u||401,p,m);this.completeUpgrade(o,a,e,t,n,i)});return}if(!this.options.verifyClient(c))return rD(t,401)}this.completeUpgrade(o,a,e,t,n,i)}completeUpgrade(e,t,n,i,o,s){if(!i.readable||!i.writable)return i.destroy();let c=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Lhe.createHash("sha1").update(e+jhe).digest("base64")}`],l=new Uhe(null);var u=n.headers["sec-websocket-protocol"];if(u&&(u=u.split(",").map(qhe),this.options.handleProtocols?u=this.options.handleProtocols(u,n):u=u[0],u&&(c.push(`Sec-WebSocket-Protocol: ${u}`),l.protocol=u)),t[Zm.extensionName]){let p=t[Zm.extensionName].params,m=D5.format({[Zm.extensionName]:[p]});c.push(`Sec-WebSocket-Extensions: ${m}`),l._extensions=t}this.emit("headers",c,n),i.write(c.concat(`\r
`).join(`\r
`)),i.removeListener("error",dF),l.setSocket(i,o,this.options.maxPayload),this.clients&&(this.clients.add(l),l.on("close",()=>this.clients.delete(l))),s(l)}};T5.exports=pF;function Vhe(r,e){for(let t of Object.keys(e))r.on(t,e[t]);return function(){for(let n of Object.keys(e))r.removeListener(n,e[n])}}function Bhe(r){r.emit("close")}function dF(){this.destroy()}function rD(r,e,t,n){r.writable&&(t=t||nD.STATUS_CODES[e],n=Object.assign({Connection:"close","Content-type":"text/html","Content-Length":Buffer.byteLength(t)},n),r.write(`HTTP/1.1 ${e} ${nD.STATUS_CODES[e]}\r
`+Object.keys(n).map(i=>`${i}: ${n[i]}`).join(`\r
`)+`\r
\r
`+t)),r.removeListener("error",dF),r.destroy()}function qhe(r){return r.trim()}});var N5=M((B7e,A5)=>{"use strict";var iD=uF();iD.Server=R5();iD.Receiver=oF();iD.Sender=aF();A5.exports=iD});var O5=M((q7e,M5)=>{"use strict";M5.exports=N5()});var V5=M((lD,W5)=>{(function(r,e){typeof lD=="object"&&typeof W5<"u"?e(lD):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.lumino_algorithm={}))})(lD,function(r){"use strict";r.ArrayExt=void 0,function(L){function B(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=se.length;if(re===0)return-1;q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1);var _e;J<q?_e=J+1+(re-q):_e=J-q+1;for(var Le=0;Le<_e;++Le){var ur=(q+Le)%re;if(se[ur]===fe)return ur}return-1}L.firstIndexOf=B;function Ie(se,fe,q,J){q===void 0&&(q=-1),J===void 0&&(J=0);var re=se.length;if(re===0)return-1;q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1);var _e;q<J?_e=q+1+(re-J):_e=q-J+1;for(var Le=0;Le<_e;++Le){var ur=(q-Le+re)%re;if(se[ur]===fe)return ur}return-1}L.lastIndexOf=Ie;function Me(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=se.length;if(re===0)return-1;q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1);var _e;J<q?_e=J+1+(re-q):_e=J-q+1;for(var Le=0;Le<_e;++Le){var ur=(q+Le)%re;if(fe(se[ur],ur))return ur}return-1}L.findFirstIndex=Me;function nt(se,fe,q,J){q===void 0&&(q=-1),J===void 0&&(J=0);var re=se.length;if(re===0)return-1;q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1);var _e;q<J?_e=q+1+(re-J):_e=q-J+1;for(var Le=0;Le<_e;++Le){var ur=(q-Le+re)%re;if(fe(se[ur],ur))return ur}return-1}L.findLastIndex=nt;function tn(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=Me(se,fe,q,J);return re!==-1?se[re]:void 0}L.findFirstValue=tn;function Ht(se,fe,q,J){q===void 0&&(q=-1),J===void 0&&(J=0);var re=nt(se,fe,q,J);return re!==-1?se[re]:void 0}L.findLastValue=Ht;function jt(se,fe,q,J,re){J===void 0&&(J=0),re===void 0&&(re=-1);var _e=se.length;if(_e===0)return 0;J<0?J=Math.max(0,J+_e):J=Math.min(J,_e-1),re<0?re=Math.max(0,re+_e):re=Math.min(re,_e-1);for(var Le=J,ur=re-J+1;ur>0;){var vi=ur>>1,wl=Le+vi;q(se[wl],fe)<0?(Le=wl+1,ur-=vi+1):ur=vi}return Le}L.lowerBound=jt;function Ot(se,fe,q,J,re){J===void 0&&(J=0),re===void 0&&(re=-1);var _e=se.length;if(_e===0)return 0;J<0?J=Math.max(0,J+_e):J=Math.min(J,_e-1),re<0?re=Math.max(0,re+_e):re=Math.min(re,_e-1);for(var Le=J,ur=re-J+1;ur>0;){var vi=ur>>1,wl=Le+vi;q(se[wl],fe)>0?ur=vi:(Le=wl+1,ur-=vi+1)}return Le}L.upperBound=Ot;function wr(se,fe,q){if(se===fe)return!0;if(se.length!==fe.length)return!1;for(var J=0,re=se.length;J<re;++J)if(q?!q(se[J],fe[J]):se[J]!==fe[J])return!1;return!0}L.shallowEqual=wr;function Wr(se,fe){fe===void 0&&(fe={});var q=fe.start,J=fe.stop,re=fe.step;if(re===void 0&&(re=1),re===0)throw new Error("Slice `step` cannot be zero.");var _e=se.length;q===void 0?q=re<0?_e-1:0:q<0?q=Math.max(q+_e,re<0?-1:0):q>=_e&&(q=re<0?_e-1:_e),J===void 0?J=re<0?-1:_e:J<0?J=Math.max(J+_e,re<0?-1:0):J>=_e&&(J=re<0?_e-1:_e);var Le;re<0&&J>=q||re>0&&q>=J?Le=0:re<0?Le=Math.floor((J-q+1)/re+1):Le=Math.floor((J-q-1)/re+1);for(var ur=[],vi=0;vi<Le;++vi)ur[vi]=se[q+vi*re];return ur}L.slice=Wr;function Dr(se,fe,q){var J=se.length;if(!(J<=1)&&(fe<0?fe=Math.max(0,fe+J):fe=Math.min(fe,J-1),q<0?q=Math.max(0,q+J):q=Math.min(q,J-1),fe!==q)){for(var re=se[fe],_e=fe<q?1:-1,Le=fe;Le!==q;Le+=_e)se[Le]=se[Le+_e];se[q]=re}}L.move=Dr;function rn(se,fe,q){fe===void 0&&(fe=0),q===void 0&&(q=-1);var J=se.length;if(!(J<=1))for(fe<0?fe=Math.max(0,fe+J):fe=Math.min(fe,J-1),q<0?q=Math.max(0,q+J):q=Math.min(q,J-1);fe<q;){var re=se[fe],_e=se[q];se[fe++]=_e,se[q--]=re}}L.reverse=rn;function H(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=se.length;if(!(re<=1)&&(q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1),!(q>=J))){var _e=J-q+1;if(fe>0?fe=fe%_e:fe<0&&(fe=(fe%_e+_e)%_e),fe!==0){var Le=q+fe;rn(se,q,Le-1),rn(se,Le,J),rn(se,q,J)}}}L.rotate=H;function ie(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=se.length;if(re!==0){q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1);var _e;J<q?_e=J+1+(re-q):_e=J-q+1;for(var Le=0;Le<_e;++Le)se[(q+Le)%re]=fe}}L.fill=ie;function ge(se,fe,q){var J=se.length;fe<0?fe=Math.max(0,fe+J):fe=Math.min(fe,J);for(var re=J;re>fe;--re)se[re]=se[re-1];se[fe]=q}L.insert=ge;function Ee(se,fe){var q=se.length;if(fe<0&&(fe+=q),!(fe<0||fe>=q)){for(var J=se[fe],re=fe+1;re<q;++re)se[re-1]=se[re];return se.length=q-1,J}}L.removeAt=Ee;function He(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=B(se,fe,q,J);return re!==-1&&Ee(se,re),re}L.removeFirstOf=He;function nn(se,fe,q,J){q===void 0&&(q=-1),J===void 0&&(J=0);var re=Ie(se,fe,q,J);return re!==-1&&Ee(se,re),re}L.removeLastOf=nn;function Pt(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=se.length;if(re===0)return 0;q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1);for(var _e=0,Le=0;Le<re;++Le)q<=J&&Le>=q&&Le<=J&&se[Le]===fe||J<q&&(Le<=J||Le>=q)&&se[Le]===fe?_e++:_e>0&&(se[Le-_e]=se[Le]);return _e>0&&(se.length=re-_e),_e}L.removeAllOf=Pt;function Dt(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re,_e=Me(se,fe,q,J);return _e!==-1&&(re=Ee(se,_e)),{index:_e,value:re}}L.removeFirstWhere=Dt;function ot(se,fe,q,J){q===void 0&&(q=-1),J===void 0&&(J=0);var re,_e=nt(se,fe,q,J);return _e!==-1&&(re=Ee(se,_e)),{index:_e,value:re}}L.removeLastWhere=ot;function Ut(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=se.length;if(re===0)return 0;q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1);for(var _e=0,Le=0;Le<re;++Le)q<=J&&Le>=q&&Le<=J&&fe(se[Le],Le)||J<q&&(Le<=J||Le>=q)&&fe(se[Le],Le)?_e++:_e>0&&(se[Le-_e]=se[Le]);return _e>0&&(se.length=re-_e),_e}L.removeAllWhere=Ut}(r.ArrayExt||(r.ArrayExt={}));function e(L){var B;return typeof L.iter=="function"?B=L.iter():B=new p(L),B}function t(L){return new m(L)}function n(L){return new h(L)}function i(L){return new g(L)}function o(L){return new b(L)}function s(L,B){for(var Ie=0,Me=e(L),nt;(nt=Me.next())!==void 0;)if(B(nt,Ie++)===!1)return}function a(L,B){for(var Ie=0,Me=e(L),nt;(nt=Me.next())!==void 0;)if(!B(nt,Ie++))return!1;return!0}function c(L,B){for(var Ie=0,Me=e(L),nt;(nt=Me.next())!==void 0;)if(B(nt,Ie++))return!0;return!1}function l(L){for(var B=0,Ie=[],Me=e(L),nt;(nt=Me.next())!==void 0;)Ie[B++]=nt;return Ie}function u(L){for(var B=e(L),Ie,Me={};(Ie=B.next())!==void 0;)Me[Ie[0]]=Ie[1];return Me}var p=function(){function L(B){this._index=0,this._source=B}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var B=new L(this._source);return B._index=this._index,B},L.prototype.next=function(){if(!(this._index>=this._source.length))return this._source[this._index++]},L}(),m=function(){function L(B,Ie){Ie===void 0&&(Ie=Object.keys(B)),this._index=0,this._source=B,this._keys=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var B=new L(this._source,this._keys);return B._index=this._index,B},L.prototype.next=function(){if(!(this._index>=this._keys.length)){var B=this._keys[this._index++];return B in this._source?B:this.next()}},L}(),h=function(){function L(B,Ie){Ie===void 0&&(Ie=Object.keys(B)),this._index=0,this._source=B,this._keys=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var B=new L(this._source,this._keys);return B._index=this._index,B},L.prototype.next=function(){if(!(this._index>=this._keys.length)){var B=this._keys[this._index++];return B in this._source?this._source[B]:this.next()}},L}(),g=function(){function L(B,Ie){Ie===void 0&&(Ie=Object.keys(B)),this._index=0,this._source=B,this._keys=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var B=new L(this._source,this._keys);return B._index=this._index,B},L.prototype.next=function(){if(!(this._index>=this._keys.length)){var B=this._keys[this._index++];return B in this._source?[B,this._source[B]]:this.next()}},L}(),b=function(){function L(B){this._fn=B}return L.prototype.iter=function(){return this},L.prototype.clone=function(){throw new Error("An `FnIterator` cannot be cloned.")},L.prototype.next=function(){return this._fn.call(void 0)},L}();function w(){for(var L=[],B=0;B<arguments.length;B++)L[B]=arguments[B];return new k(e(L.map(e)))}var k=function(){function L(B){this._cloned=!1,this._source=B,this._active=void 0}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var B=new L(this._source.clone());return B._active=this._active&&this._active.clone(),B._cloned=!0,this._cloned=!0,B},L.prototype.next=function(){if(this._active===void 0){var B=this._source.next();if(B===void 0)return;this._active=this._cloned?B.clone():B}var Ie=this._active.next();return Ie!==void 0?Ie:(this._active=void 0,this.next())},L}();function N(){return new D}var D=function(){function L(){}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L},L.prototype.next=function(){},L}();function V(L,B){return B===void 0&&(B=0),new oe(e(L),B)}var oe=function(){function L(B,Ie){this._source=B,this._index=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.clone(),this._index)},L.prototype.next=function(){var B=this._source.next();if(B!==void 0)return[this._index++,B]},L}();function G(L,B){return new pe(e(L),B)}var pe=function(){function L(B,Ie){this._index=0,this._source=B,this._fn=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var B=new L(this._source.clone(),this._fn);return B._index=this._index,B},L.prototype.next=function(){for(var B=this._fn,Ie=this._source,Me;(Me=Ie.next())!==void 0;)if(B(Me,this._index++))return Me},L}();function de(L,B){for(var Ie=0,Me=e(L),nt;(nt=Me.next())!==void 0;)if(B(nt,Ie++))return nt}function te(L,B){for(var Ie=0,Me=e(L),nt;(nt=Me.next())!==void 0;)if(B(nt,Ie++))return Ie-1;return-1}function we(L,B){var Ie=e(L),Me=Ie.next();if(Me!==void 0){for(var nt=Me;(Me=Ie.next())!==void 0;)B(Me,nt)<0&&(nt=Me);return nt}}function Ue(L,B){var Ie=e(L),Me=Ie.next();if(Me!==void 0){for(var nt=Me;(Me=Ie.next())!==void 0;)B(Me,nt)>0&&(nt=Me);return nt}}function ct(L,B){var Ie=e(L),Me=Ie.next();if(Me!==void 0){for(var nt=Me,tn=Me;(Me=Ie.next())!==void 0;)B(Me,nt)<0?nt=Me:B(Me,tn)>0&&(tn=Me);return[nt,tn]}}function ft(L,B){return new rt(e(L),B)}var rt=function(){function L(B,Ie){this._index=0,this._source=B,this._fn=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var B=new L(this._source.clone(),this._fn);return B._index=this._index,B},L.prototype.next=function(){var B=this._source.next();if(B!==void 0)return this._fn.call(void 0,B,this._index++)},L}();function ae(L,B,Ie){return B===void 0?new ke(0,L,1):Ie===void 0?new ke(L,B,1):new ke(L,B,Ie)}var ke=function(){function L(B,Ie,Me){this._index=0,this._start=B,this._stop=Ie,this._step=Me,this._length=Z.rangeLength(B,Ie,Me)}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var B=new L(this._start,this._stop,this._step);return B._index=this._index,B},L.prototype.next=function(){if(!(this._index>=this._length))return this._start+this._step*this._index++},L}(),Z;(function(L){function B(Ie,Me,nt){return nt===0?1/0:Ie>Me&&nt>0||Ie<Me&&nt<0?0:Math.ceil((Me-Ie)/nt)}L.rangeLength=B})(Z||(Z={}));function ve(L,B,Ie){var Me=0,nt=e(L),tn=nt.next();if(tn===void 0&&Ie===void 0)throw new TypeError("Reduce of empty iterable with no initial value.");if(tn===void 0)return Ie;var Ht=nt.next();if(Ht===void 0&&Ie===void 0)return tn;if(Ht===void 0)return B(Ie,tn,Me++);var jt;Ie===void 0?jt=B(tn,Ht,Me++):jt=B(B(Ie,tn,Me++),Ht,Me++);for(var Ot;(Ot=nt.next())!==void 0;)jt=B(jt,Ot,Me++);return jt}function Be(L,B){return new Et(L,B)}function dn(L){return new Et(L,1)}var Et=function(){function L(B,Ie){this._value=B,this._count=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._value,this._count)},L.prototype.next=function(){if(!(this._count<=0))return this._count--,this._value},L}();function jr(L){var B;return typeof L.retro=="function"?B=L.retro():B=new ls(L),B}var ls=function(){function L(B){this._source=B,this._index=B.length-1}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var B=new L(this._source);return B._index=this._index,B},L.prototype.next=function(){if(!(this._index<0||this._index>=this._source.length))return this._source[this._index--]},L}();function Vt(L){var B=[],Ie=new Set,Me=new Map;return s(L,nt),Me.forEach(function(Ht,jt){tn(jt)}),B;function nt(Ht){var jt=Ht[0],Ot=Ht[1],wr=Me.get(Ot);wr?wr.push(jt):Me.set(Ot,[jt])}function tn(Ht){if(!Ie.has(Ht)){Ie.add(Ht);var jt=Me.get(Ht);jt&&jt.forEach(tn),B.push(Ht)}}}function en(L,B){return new Fi(e(L),B)}var Fi=function(){function L(B,Ie){this._source=B,this._step=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.clone(),this._step)},L.prototype.next=function(){for(var B=this._source.next(),Ie=this._step-1;Ie>0;--Ie)this._source.next();return B},L}();r.StringExt=void 0,function(L){function B(Ht,jt,Ot){Ot===void 0&&(Ot=0);for(var wr=new Array(jt.length),Wr=0,Dr=Ot,rn=jt.length;Wr<rn;++Wr,++Dr){if(Dr=Ht.indexOf(jt[Wr],Dr),Dr===-1)return null;wr[Wr]=Dr}return wr}L.findIndices=B;function Ie(Ht,jt,Ot){Ot===void 0&&(Ot=0);var wr=B(Ht,jt,Ot);if(!wr)return null;for(var Wr=0,Dr=0,rn=wr.length;Dr<rn;++Dr){var H=wr[Dr]-Ot;Wr+=H*H}return{score:Wr,indices:wr}}L.matchSumOfSquares=Ie;function Me(Ht,jt,Ot){Ot===void 0&&(Ot=0);var wr=B(Ht,jt,Ot);if(!wr)return null;for(var Wr=0,Dr=Ot-1,rn=0,H=wr.length;rn<H;++rn){var ie=wr[rn];Wr+=ie-Dr-1,Dr=ie}return{score:Wr,indices:wr}}L.matchSumOfDeltas=Me;function nt(Ht,jt,Ot){for(var wr=[],Wr=0,Dr=0,rn=jt.length;Wr<rn;){for(var H=jt[Wr],ie=jt[Wr];++Wr<rn&&jt[Wr]===ie+1;)ie++;Dr<H&&wr.push(Ht.slice(Dr,H)),H<ie+1&&wr.push(Ot(Ht.slice(H,ie+1))),Dr=ie+1}return Dr<Ht.length&&wr.push(Ht.slice(Dr)),wr}L.highlight=nt;function tn(Ht,jt){return Ht<jt?-1:Ht>jt?1:0}L.cmp=tn}(r.StringExt||(r.StringExt={}));function Mt(L,B){return new or(e(L),B)}var or=function(){function L(B,Ie){this._source=B,this._count=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.clone(),this._count)},L.prototype.next=function(){if(!(this._count<=0)){var B=this._source.next();if(B!==void 0)return this._count--,B}},L}();function Xn(){for(var L=[],B=0;B<arguments.length;B++)L[B]=arguments[B];return new Cl(L.map(e))}var Cl=function(){function L(B){this._source=B}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.map(function(B){return B.clone()}))},L.prototype.next=function(){for(var B=new Array(this._source.length),Ie=0,Me=this._source.length;Ie<Me;++Ie){var nt=this._source[Ie].next();if(nt===void 0)return;B[Ie]=nt}return B},L}();r.ArrayIterator=p,r.ChainIterator=k,r.EmptyIterator=D,r.EnumerateIterator=oe,r.FilterIterator=pe,r.FnIterator=b,r.ItemIterator=g,r.KeyIterator=m,r.MapIterator=rt,r.RangeIterator=ke,r.RepeatIterator=Et,r.RetroArrayIterator=ls,r.StrideIterator=Fi,r.TakeIterator=or,r.ValueIterator=h,r.ZipIterator=Cl,r.chain=w,r.each=s,r.empty=N,r.enumerate=V,r.every=a,r.filter=G,r.find=de,r.findIndex=te,r.iter=e,r.iterFn=o,r.iterItems=i,r.iterKeys=t,r.iterValues=n,r.map=ft,r.max=Ue,r.min=we,r.minmax=ct,r.once=dn,r.range=ae,r.reduce=ve,r.repeat=Be,r.retro=jr,r.some=c,r.stride=en,r.take=Mt,r.toArray=l,r.toObject=u,r.topologicSort=Vt,r.zip=Xn,Object.defineProperty(r,"__esModule",{value:!0})})});var q5=M((uD,B5)=>{(function(r,e){typeof uD=="object"&&typeof B5<"u"?e(uD):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.lumino_properties={}))})(uD,function(r){"use strict";r.AttachedProperty=function(){function t(n){this._pid=e.nextPID(),this.name=n.name,this._create=n.create,this._coerce=n.coerce||null,this._compare=n.compare||null,this._changed=n.changed||null}return t.prototype.get=function(n){var i,o=e.ensureMap(n);return this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(n),i},t.prototype.set=function(n,i){var o,s=e.ensureMap(n);this._pid in s?o=s[this._pid]:o=s[this._pid]=this._createValue(n);var a=this._coerceValue(n,i);this._maybeNotify(n,o,s[this._pid]=a)},t.prototype.coerce=function(n){var i,o=e.ensureMap(n);this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(n);var s=this._coerceValue(n,i);this._maybeNotify(n,i,o[this._pid]=s)},t.prototype._createValue=function(n){var i=this._create;return i(n)},t.prototype._coerceValue=function(n,i){var o=this._coerce;return o?o(n,i):i},t.prototype._compareValue=function(n,i){var o=this._compare;return o?o(n,i):n===i},t.prototype._maybeNotify=function(n,i,o){var s=this._changed;s&&!this._compareValue(i,o)&&s(n,i,o)},t}(),function(t){function n(i){e.ownerData.delete(i)}t.clearData=n}(r.AttachedProperty||(r.AttachedProperty={}));var e;(function(t){t.ownerData=new WeakMap,t.nextPID=function(){var i=0;return function(){var o=Math.random(),s=(""+o).slice(2);return"pid-"+s+"-"+i++}}();function n(i){var o=t.ownerData.get(i);return o||(o=Object.create(null),t.ownerData.set(i,o),o)}t.ensureMap=n})(e||(e={})),Object.defineProperty(r,"__esModule",{value:!0})})});var dD=M((pD,J5)=>{(function(r,e){typeof pD=="object"&&typeof J5<"u"?e(pD,V5(),q5()):typeof define=="function"&&define.amd?define(["exports","@lumino/algorithm","@lumino/properties"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.lumino_signaling={},r.lumino_algorithm,r.lumino_properties))})(pD,function(r,e,t){"use strict";r.Signal=function(){function i(o){this._blockedCount=0,this.sender=o}return i.prototype.block=function(o){this._blockedCount++;try{o()}finally{this._blockedCount--}},i.prototype.connect=function(o,s){return n.connect(this,o,s)},i.prototype.disconnect=function(o,s){return n.disconnect(this,o,s)},i.prototype.emit=function(o){this._blockedCount||n.emit(this,o)},i}(),function(i){function o(h,g){var b=n.blockedProperty;b.set(h,b.get(h)+1);try{g()}finally{b.set(h,b.get(h)-1)}}i.blockAll=o;function s(h,g){n.disconnectBetween(h,g)}i.disconnectBetween=s;function a(h){n.disconnectSender(h)}i.disconnectSender=a;function c(h){n.disconnectReceiver(h)}i.disconnectReceiver=c;function l(h){n.disconnectAll(h)}i.disconnectAll=l;function u(h){n.disconnectAll(h)}i.clearData=u;function p(){return n.exceptionHandler}i.getExceptionHandler=p;function m(h){var g=n.exceptionHandler;return n.exceptionHandler=h,g}i.setExceptionHandler=m}(r.Signal||(r.Signal={}));var n;(function(i){i.exceptionHandler=function(G){console.error(G)};function o(G,pe,de){de=de||void 0;var te=m.get(G.sender);if(te||(te=[],m.set(G.sender,te)),w(te,G,pe,de))return!1;var we=de||pe,Ue=h.get(we);Ue||(Ue=[],h.set(we,Ue));var ct={signal:G,slot:pe,thisArg:de};return te.push(ct),Ue.push(ct),!0}i.connect=o;function s(G,pe,de){de=de||void 0;var te=m.get(G.sender);if(!te||te.length===0)return!1;var we=w(te,G,pe,de);if(!we)return!1;var Ue=de||pe,ct=h.get(Ue);return we.signal=null,N(te),N(ct),!0}i.disconnect=s;function a(G,pe){var de=m.get(G);if(!(!de||de.length===0)){var te=h.get(pe);!te||te.length===0||(e.each(te,function(we){we.signal&&we.signal.sender===G&&(we.signal=null)}),N(de),N(te))}}i.disconnectBetween=a;function c(G){var pe=m.get(G);!pe||pe.length===0||(e.each(pe,function(de){if(de.signal){var te=de.thisArg||de.slot;de.signal=null,N(h.get(te))}}),N(pe))}i.disconnectSender=c;function l(G){var pe=h.get(G);!pe||pe.length===0||(e.each(pe,function(de){if(de.signal){var te=de.signal.sender;de.signal=null,N(m.get(te))}}),N(pe))}i.disconnectReceiver=l;function u(G){c(G),l(G)}i.disconnectAll=u;function p(G,pe){if(!(i.blockedProperty.get(G.sender)>0)){var de=m.get(G.sender);if(!(!de||de.length===0))for(var te=0,we=de.length;te<we;++te){var Ue=de[te];Ue.signal===G&&k(Ue,pe)}}}i.emit=p;var m=new WeakMap,h=new WeakMap,g=new Set,b=function(){var G=typeof requestAnimationFrame=="function";return G?requestAnimationFrame:setImmediate}();function w(G,pe,de,te){return e.find(G,function(we){return we.signal===pe&&we.slot===de&&we.thisArg===te})}function k(G,pe){var de=G.signal,te=G.slot,we=G.thisArg;try{te.call(we,de.sender,pe)}catch(Ue){i.exceptionHandler(Ue)}}function N(G){g.size===0&&b(D),g.add(G)}function D(){g.forEach(V),g.clear()}function V(G){e.ArrayExt.removeAllWhere(G,oe)}function oe(G){return G.signal===null}i.blockedProperty=new t.AttachedProperty({name:"blocked",create:function(){return 0}})})(n||(n={})),Object.defineProperty(r,"__esModule",{value:!0})})});var eH=M((qQe,Z5)=>{"use strict";Z5.exports=({onlyFirst:r=!1}={})=>{let e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,r?void 0:"g")}});var _F=M((Uet,hH)=>{"use strict";var vge=require("child_process").spawn;function yge(r){if(r){r=r.trim();var e=/your \d+x\d+ screen size is bogus\. expect trouble/gi;return r=r.replace(e,""),r.trim()}}function bge(r,e,t,n){typeof t=="function"&&(n=t,t=void 0);var i=!1,o=vge(r,e,t),s="",a="";o.stdout.on("data",function(c){s+=c.toString()}),o.stderr.on("data",function(c){a+=c.toString()}),o.on("error",function(c){i||(i=!0,n(new Error(c)))}),o.on("close",function(c){if(!i){if(i=!0,a=yge(a),a)return n(new Error(a));n(null,s,c)}})}hH.exports=bge});var vH=M((jet,gH)=>{"use strict";var Ige=require("os"),Sge=_F();function xge(r){var e=["-A","-o","ppid,pid"];Sge("ps",e,function(t,n,i){if(t)return r(t);if(i!==0)return r(new Error("pidtree ps command exited with code "+i));try{n=n.split(Ige.EOL);for(var o=[],s=1;s<n.length;s++)n[s]=n[s].trim(),n[s]&&(n[s]=n[s].split(/\s+/),n[s][0]=parseInt(n[s][0],10),n[s][1]=parseInt(n[s][1],10),o.push(n[s]));r(null,o)}catch(a){r(a)}})}gH.exports=xge});var bH=M((Wet,yH)=>{"use strict";var Cge=require("os"),wge=_F();function Ege(r){var e=["PROCESS","get","ParentProcessId,ProcessId"],t={windowsHide:!0,windowsVerbatimArguments:!0};wge("wmic",e,t,function(n,i,o){if(n){r(n);return}if(o!==0){r(new Error("pidtree wmic command exited with code "+o));return}try{i=i.split(Cge.EOL);for(var s=[],a=1;a<i.length;a++)i[a]=i[a].trim(),i[a]&&(i[a]=i[a].split(/\s+/),i[a][0]=parseInt(i[a][0],10),i[a][1]=parseInt(i[a][1],10),s.push(i[a]));r(null,s)}catch(c){r(c)}})}yH.exports=Ege});var CH=M((Vet,xH)=>{"use strict";var SH=require("os"),Pge={darwin:"ps",sunos:"ps",freebsd:"ps",netbsd:"ps",win:"wmic",linux:"ps",aix:"ps"},kge={ps:()=>vH(),wmic:()=>bH()},DF=SH.platform();DF.startsWith("win")&&(DF="win");var IH=Pge[DF];function _ge(r){IH===void 0&&r(new Error(SH.platform()+" is not supported yet, please open an issue (https://github.com/simonepri/pidtree)"));var e=kge[IH]();e(r)}xH.exports=_ge});var EH=M((Bet,wH)=>{"use strict";var Dge=CH();function Tge(r,e,t){if(typeof e=="function"&&(t=e,e={}),typeof e!="object"&&(e={}),r=parseInt(r,10),isNaN(r)||r<-1){t(new TypeError("The pid provided is invalid"));return}Dge(function(n,i){if(n){t(n);return}if(r===-1){for(var o=0;o<i.length;o++)i[o]=e.advanced?{ppid:i[o][0],pid:i[o][1]}:i[o]=i[o][1];t(null,i);return}for(var s,a=0;a<i.length;a++){if(i[a][1]===r){s=e.advanced?{ppid:i[a][0],pid:r}:r;break}i[a][0]===r&&(s=e.advanced?{pid:r}:r)}if(!s){t(new Error("No matching pid found"));return}for(var c={};i.length>0;){var l=i.pop();c[l[0]]?c[l[0]].push(l[1]):c[l[0]]=[l[1]]}for(var u=0,p=[s];u<p.length;){var m=e.advanced?p[u++].pid:p[u++];if(c[m]){for(var h=c[m].length,g=0;g<h;g++)p.push(e.advanced?{ppid:m,pid:c[m][g]}:c[m][g]);delete c[m]}}e.root||p.shift(),t(null,p)})}wH.exports=Tge});var _H=M((qet,kH)=>{"use strict";function Rge(r,e,t){return new Promise(function(n,i){r(e,t,function(o,s){if(o)return i(o);n(s)})})}String.prototype.startsWith||(String.prototype.startsWith=function(r){return this.substring(0,r.length)===r});var PH=EH();function Age(r,e,t){if(typeof e=="function"&&(t=e,e=void 0),typeof t=="function"){PH(r,e,t);return}return Rge(PH,r,e)}kH.exports=Age});var KH=M((Jet,OH)=>{var DH=Array.prototype.slice,TH=typeof Object.keys=="function"?Object.keys:function(r){var e=[];for(var t in r)e.push(t);return e},RH=OH.exports=function(r,e){return r===0&&e===0?Nge(r,e):r===e?!0:r instanceof Date&&e instanceof Date?r.getTime()===e.getTime():MH(r)?MH(e):typeof r!="object"&&typeof e!="object"?r==e:Mge(r,e)};function AH(r){return r==null}function NH(r){return Object.prototype.toString.call(r)=="[object Arguments]"}function MH(r){return typeof r=="number"&&r!==r}function Nge(r,e){return 1/r===1/e}function Mge(r,e){if(AH(r)||AH(e)||r.prototype!==e.prototype)return!1;if(NH(r))return NH(e)?(r=DH.call(r),e=DH.call(e),RH(r,e)):!1;try{var t=TH(r),n=TH(e),i,o}catch{return!1}if(t.length!=n.length)return!1;for(t.sort(),n.sort(),o=t.length-1;o>=0;o--)if(t[o]!=n[o])return!1;for(o=t.length-1;o>=0;o--)if(i=t[o],!RH(r[i],e[i]))return!1;return!0}});var UH=M(($et,LH)=>{"use strict";var FH="[a-fA-F\\d:]",cd=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${FH})|(?<=${FH})(?=\\s|$))`:"",_a="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",Tn="[a-fA-F\\d]{1,4}",jD=`
(?:
(?:${Tn}:){7}(?:${Tn}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${Tn}:){6}(?:${_a}|:${Tn}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${Tn}:){5}(?::${_a}|(?::${Tn}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${Tn}:){4}(?:(?::${Tn}){0,1}:${_a}|(?::${Tn}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${Tn}:){3}(?:(?::${Tn}){0,2}:${_a}|(?::${Tn}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${Tn}:){2}(?:(?::${Tn}){0,3}:${_a}|(?::${Tn}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${Tn}:){1}(?:(?::${Tn}){0,4}:${_a}|(?::${Tn}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${Tn}){0,5}:${_a}|(?::${Tn}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Oge=new RegExp(`(?:^${_a}$)|(?:^${jD}$)`),Kge=new RegExp(`^${_a}$`),Fge=new RegExp(`^${jD}$`),TF=r=>r&&r.exact?Oge:new RegExp(`(?:${cd(r)}${_a}${cd(r)})|(?:${cd(r)}${jD}${cd(r)})`,"g");TF.v4=r=>r&&r.exact?Kge:new RegExp(`${cd(r)}${_a}${cd(r)}`,"g");TF.v6=r=>r&&r.exact?Fge:new RegExp(`${cd(r)}${jD}${cd(r)}`,"g");LH.exports=TF});var jH=M((Het,Lge)=>{Lge.exports={name:"is2",version:"2.0.7",description:"A type checking library where each exported function returns either true or false and does not throw. Also added tests.",license:"MIT",tags:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],keywords:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],author:"Enrico Marino <enrico.marino@email.com>",maintainers:"Edmond Meinfelder <edmond@stdarg.com>, Chris Oyler <christopher.oyler@gmail.com>",homepage:"http://github.com/stdarg/is2",repository:{type:"git",url:"git@github.com:stdarg/is2.git"},bugs:{url:"http://github.com/stdarg/is/issues"},main:"./index.js",scripts:{test:"./node_modules/.bin/mocha -C --reporter list tests.js"},engines:{node:">=v0.10.0"},dependencies:{"deep-is":"^0.1.3","ip-regex":"^4.1.0","is-url":"^1.2.4"},devDependencies:{mocha:"6.1.4",mongodb:"3.2.4"}}});var VH=M((Get,WH)=>{WH.exports=Vge;var Uge=/^(?:\w+:)?\/\/(\S+)$/,jge=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,Wge=/^[^\s\.]+\.\S{2,}$/;function Vge(r){if(typeof r!="string")return!1;var e=r.match(Uge);if(!e)return!1;var t=e[1];return t?!!(jge.test(t)||Wge.test(t)):!1}});var JH=M(qH=>{"use strict";var BH={}.hasOwnProperty,yr={}.toString,S=qH,Bge=KH(),qge=UH();S.version=jH().version;S.browser=function(){return!S.node()&&typeof window<"u"&&yr.call(window)==="[object global]"};S.defined=function(r){return typeof r<"u"};S.def=S.defined;S.nodejs=function(){return process&&process.hasOwnProperty("version")&&process.hasOwnProperty("versions")};S.node=S.nodejs;S.undefined=function(r){return r===void 0};S.udef=S.undef=S.undefined;S.array=function(r){return yr.call(r)==="[object Array]"};S.arr=S.ary=S.arry=S.array;S.arrayLike=function(r){return S.nullOrUndef(r)?!1:r!==void 0&&BH.call(r,"length")&&isFinite(r.length)};S.arrLike=S.arryLike=S.aryLike=S.arraylike=S.arrayLike;S.arguments=function(r){return yr.call(r)==="[object Arguments]"};S.args=S.arguments;S.boolean=function(r){return yr.call(r)==="[object Boolean]"};S.bool=S.boolean;S.buffer=function(r){return S.nodejs()&&Buffer&&Buffer.hasOwnProperty("isBuffer")&&Buffer.isBuffer(r)};S.buff=S.buf=S.buffer;S.date=function(r){return yr.call(r)==="[object Date]"};S.error=function(r){return yr.call(r)==="[object Error]"};S.err=S.error;S.false=function(r){return r===!1};S.function=function(r){return S.syncFunction(r)||S.asyncFunction(r)};S.fun=S.func=S.function;S.asyncFunction=function(r){return yr.call(r)==="[object AsyncFunction]"};S.asyncFun=S.asyncFunc=S.asyncFunction;S.syncFunction=function(r){return yr.call(r)==="[object Function]"};S.syncFun=S.syncFunc=S.syncFunction;S.null=function(r){return r===null};S.nullOrUndefined=function(r){return r===null||typeof r>"u"};S.nullOrUndef=S.nullOrUndefined;S.number=function(r){return yr.call(r)==="[object Number]"};S.num=S.number;S.object=function(r){return yr.call(r)==="[object Object]"};S.obj=S.object;S.regExp=function(r){return yr.call(r)==="[object RegExp]"};S.re=S.regexp=S.regExp;S.string=function(r){return yr.call(r)==="[object String]"};S.str=S.string;S.true=function(r){return r===!0};var Jge=new RegExp("[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}","i");S.uuid=function(r){return Jge.test(r)};S.equal=function(r,e){var t=yr.call(r);return typeof r!=typeof e||t!==yr.call(e)?!1:t==="[object Object]"||t==="[object Array]"?Bge(r,e):t==="[object Function]"?r.prototype===e.prototype:t==="[object Date]"?r.getTime()===e.getTime():r===e};S.objEquals=S.eq=S.equal;var $ge={boolean:1,number:1,string:1,undefined:1};S.hosted=function(r,e){if(S.nullOrUndef(r))return!1;var t=typeof e[r];return t==="object"?!!e[r]:!$ge[t]};S.instanceOf=function(r,e){return S.nullOrUndef(r)||S.nullOrUndef(e)?!1:r instanceof e};S.instOf=S.instanceof=S.instanceOf;S.objectInstanceOf=function(r,e){try{return yr.call(r)==="[object Object]"&&r instanceof e}catch{return!1}};S.instOf=S.instanceOf=S.objInstOf=S.objectInstanceOf;S.type=function(r,e){return typeof r===e};S.a=S.type;S.empty=function(r){var e=yr.call(r);if(e==="[object Array]"||e==="[object Arguments]")return r.length===0;if(e==="[object Object]"){for(var t in r)if(BH.call(r,t))return!1;return!0}return e==="[object String]"?r==="":!1};S.emptyArguments=function(r){return yr.call(r)==="[object Arguments]"&&r.length===0};S.noArgs=S.emptyArgs=S.emptyArguments;S.emptyArray=function(r){return yr.call(r)==="[object Array]"&&r.length===0};S.emptyArry=S.emptyAry=S.emptyArray;S.emptyArrayLike=function(r){return r.length===0};S.emptyArrLike=S.emptyArrayLike;S.emptyString=function(r){return S.string(r)&&r.length===0};S.emptyStr=S.emptyString;S.nonEmptyArray=function(r){return yr.call(r)==="[object Array]"&&r.length>0};S.nonEmptyArr=S.nonEmptyArry=S.nonEmptyAry=S.nonEmptyArray;S.nonEmptyObject=function(r){return yr.call(r)==="[object Object]"&&Object.keys(r).length>0};S.nonEmptyObj=S.nonEmptyObject;S.emptyObject=function(r){return yr.call(r)==="[object Object]"&&Object.keys(r).length===0};S.emptyObj=S.emptyObject;S.nonEmptyString=function(r){return S.string(r)&&r.length>0};S.nonEmptyStr=S.nonEmptyString;S.even=function(r){return yr.call(r)==="[object Number]"&&r%2===0};S.decimal=function(r){return yr.call(r)==="[object Number]"&&r%1!==0};S.dec=S.decNum=S.decimal;S.integer=function(r){return yr.call(r)==="[object Number]"&&r%1===0};S.int=S.integer;S.notANumber=function(r){return!S.num(r)||r!==r};S.nan=S.notANum=S.notANumber;S.odd=function(r){return!S.decimal(r)&&yr.call(r)==="[object Number]"&&r%2!==0};S.oddNumber=S.oddNum=S.odd;S.positiveNumber=function(r){return yr.call(r)==="[object Number]"&&r>0};S.pos=S.positive=S.posNum=S.positiveNum=S.positiveNumber;S.negativeNumber=function(r){return yr.call(r)==="[object Number]"&&r<0};S.neg=S.negNum=S.negativeNum=S.negativeNumber;S.negativeInteger=function(r){return yr.call(r)==="[object Number]"&&r%1===0&&r<0};S.negativeInt=S.negInt=S.negativeInteger;S.positiveInteger=function(r){return yr.call(r)==="[object Number]"&&r%1===0&&r>0};S.posInt=S.positiveInt=S.positiveInteger;S.divisibleBy=function(r,e){return r===0?!1:yr.call(r)==="[object Number]"&&e!==0&&r%e===0};S.divBy=S.divisBy=S.divisibleBy;S.greaterOrEqualTo=function(r,e){return r>=e};S.greaterOrEqual=S.ge=S.greaterOrEqualTo;S.greaterThan=function(r,e){return r>e};S.gt=S.greaterThan;S.lessThanOrEqualTo=function(r,e){return r<=e};S.lessThanOrEq=S.lessThanOrEqual=S.le=S.lessThanOrEqualTo;S.lessThan=function(r,e){return r<e};S.lt=S.lessThan;S.maximum=function(r,e){if(!S.arrayLike(e)||!S.number(r))return!1;for(var t=e.length;--t>-1;)if(r<e[t])return!1;return!0};S.max=S.maximum;S.minimum=function(r,e){if(!S.arrayLike(e)||!S.number(r))return!1;for(var t=e.length;--t>-1;)if(r>e[t])return!1;return!0};S.min=S.minimum;S.within=function(r,e,t){return r>=e&&r<=t};S.withIn=S.within;S.prettyClose=function(r,e,t){return!S.number(r)||!S.number(e)||S.defined(t)&&!S.posInt(t)?!1:(S.undefined(t)&&(t=2),r.toFixed(t)===e.toFixed(t))};S.closish=S.near=S.prettyClose;S.dnsAddress=function(r){return!(!S.nonEmptyStr(r)||r.length>255||Gge.test(r)||!Hge.test(r))};S.dnsAddr=S.dns=S.dnsAddress;var Hge=/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$/,Gge=/^([0-9]|[0-9][0-9\-]{0,61}[0-9])(\.([0-9]|[0-9][0-9\-]{0,61}[0-9]))*$/;S.emailAddress=function(r){return S.nonEmptyStr(r)?zge.test(r):!1};S.email=S.emailAddr=S.emailAddress;var zge=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/;S.ipv4Address=function(r){if(!S.nonEmptyStr(r)||r.length>15)return!1;var e=r.split(".");if(!S.array(e)||e.length!==4)return!1;for(var t=0;t<e.length;t++){var n=parseInt(e[t],10);if(isNaN(n)||n<0||n>255)return!1}return!0};S.ipv4=S.ipv4Addr=S.ipv4Address;S.ipv6Address=function(r){return S.nonEmptyStr(r)?qge.v6({extract:!0}).test(r):!1};S.ipv6=S.ipv6Addr=S.ipv6Address;S.ipAddress=function(r){return S.nonEmptyStr(r)?S.ipv4Address(r)||S.ipv6Address(r):!1};S.ip=S.ipAddr=S.ipAddress;S.hostAddress=function(r){return S.nonEmptyStr(r)?S.dns(r)||S.ipv4(r)||S.ipv6(r):!1};S.host=S.hostIp=S.hostAddr=S.hostAddress;S.port=function(r){return!(!S.num(r)||S.negativeInt(r)||r>65535)};S.systemPort=function(r){return!!(S.port(r)&&r<1024)};S.sysPort=S.systemPort;S.userPort=function(r){return!!(S.port(r)&&r>1023)};S.creditCardNumber=function(r){if(!S.str(r))return!1;var e=r.split(""),t,n;for(t=e.length-1,n=1;t>-1;t--,n++)n%2===0&&(e[t]*=2);r=e.join("");var i=0;for(t=0;t<r.length;t++)i+=Math.floor(r[t]);return i%10===0};S.creditCard=S.creditCardNum=S.creditCardNumber;S.americanExpressCardNumber=function(r){if(!S.str(r)||r.length!==15)return!1;var e=Math.floor(r.slice(0,2));return!(e!==34&&e!==37||!S.creditCardNumber(r))};S.amexCard=S.amexCardNum=S.americanExpressCardNumber;S.chinaUnionPayCardNumber=function(r){if(!S.str(r)||r.length<16&&r.length>19)return!1;var e=Math.floor(r.slice(0,2));return!(e!==62&&e!==88)};S.chinaUnion=S.chinaUnionPayCard=S.chinaUnionPayCardNumber;S.dinersClubCarteBlancheCardNumber=function(r){if(!S.str(r)||r.length!==14)return!1;var e=Math.floor(r.slice(0,3));return!(e<300||e>305||!S.creditCardNumber(r))};S.dinersClubCB=S.dinersClubCarteBlancheCard=S.dinersClubCarteBlancheCardNumber;S.dinersClubInternationalCardNumber=function(r){if(!S.str(r)||r.length!==14)return!1;var e=Math.floor(r.slice(0,3)),t=Math.floor(r.slice(0,2));return!((e<300||e>305)&&e!==309&&t!==36&&(t<38||t>39)||!S.creditCardNumber(r))};S.dinersClubInt=S.dinersClubInternationalCard=S.dinersClubInternationalCardNumber;S.dinersClubUSACanadaCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,2));return!(e!==54&&e!==55||!S.creditCardNumber(r))};S.dinersClub=S.dinersClubUSACanCard=S.dinersClubUSACanadaCardNumber;S.discoverCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,6)),t=Math.floor(r.slice(0,3));return!(r.slice(0,4)!=="6011"&&(e<622126||e>622925)&&(t<644||t>649)&&r.slice(0,2)!=="65"||!S.creditCardNumber(r))};S.discover=S.discoverCard=S.discoverCardNumber;S.instaPaymentCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,3));return!(e<637||e>639||!S.creditCardNumber(r))};S.instaPayment=S.instaPaymentCardNumber;S.jcbCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,4));return!(e<3528||e>3589||!S.creditCardNumber(r))};S.jcb=S.jcbCard=S.jcbCardNumber;S.laserCardNumber=function(r){if(!S.str(r)||r.length<16&&r.length>19)return!1;var e=Math.floor(r.slice(0,4)),t=[6304,6706,6771,6709];return!(t.indexOf(e)===-1||!S.creditCardNumber(r))};S.laser=S.laserCard=S.laserCardNumber;S.maestroCardNumber=function(r){if(!S.str(r)||r.length<12||r.length>19)return!1;var e=r.slice(0,4),t=["5018","5020","5038","5612","5893","6304","6759","6761","6762","6763","0604","6390"];return!(t.indexOf(e)===-1||!S.creditCardNumber(r))};S.maestro=S.maestroCard=S.maestroCardNumber;S.dankortCardNumber=function(r){return!(!S.str(r)||r.length!==16||r.slice(0,4)!=="5019"||!S.creditCardNumber(r))};S.dankort=S.dankortCard=S.dankortCardNumber;S.masterCardCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,2));return!(e<50||e>55||!S.creditCardNumber(r))};S.masterCard=S.masterCardCard=S.masterCardCardNumber;S.visaCardNumber=function(r){return!(!S.str(r)||r.length!==13&&r.length!==16||r.slice(0,1)!=="4"||!S.creditCardNumber(r))};S.visa=S.visaCard=S.visaCardNumber;S.visaElectronCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,4)),t=[4026,4405,4508,4844,4913,4917];return r.slice(0,6)!=="417500"&&t.indexOf(e)===-1||!S.creditCardNumber(r),!1};S.visaElectron=S.visaElectronCard=S.visaElectronCardNumber;var Qge=/^[0-9a-fA-F]{24}$/;S.mongoId=S.objectId=S.objId=function(r){return!!r&&!Array.isArray(r)&&Qge.test(String(r))};S.matching=S.match=S.inArgs=function(r){if(arguments.length<2)return!1;for(var e=!1,t=1;t<arguments.length;t++){var n=S.equal(r,arguments[t]);e=e||n}return e};S.streetAddress=function(r){if(!S.str(r))return!1;var e=/\b\d+[\s](?:[A-Za-z0-9.-]+[\s]+)+\b(ALLEY|ALY|AVENUE|AVE|BEND|BND|BLUFFS?|BLFS?|BOULEVARD|BLVD|BRANCH|BR|CENTERS?|CTRS?|CIRCLES?|CIRS?|CLIFFS?|CLFS?|COURTS?|CTS?|COVES?|CVS?|CREEK|CRK|CRESCENT|CRES|CREST|CRST|CROSSING|XING|DRIVES?|DRS?|EXPRESSWAY|EXPY|FREEWAY|FWY|HEIGHTS|HTS|HIGHWAY|HWY|HILLS?|HLS?|LANE|LN|LOOP|MANORS?|MNRS?|MOTORWAY|MTWY|MOUNT|MT|PARKS?|PARKWAYS?|PKWY|PASS|PLACE|PL|PLAZA|PLZ|POINTS?|PTS?|RIDGES?|RDGS?|ROADS?|RDS?|ROUTE|RTE?|SHOALS?|SHLS?|SHORES?|SHRS?|SPRINGS?|SPGS?|SPURS?|STREETS?|STS?|SUMMIT|SMT|TERRACE|TER|THROUGHWAY|TRWY|TRAFFICWAY|TRFY|TRAIL|TRL|TURNPIKE|TPKE|VALLEYS?|VLYS?|WAYS?)+(?:[\.\-\s\,]?)*((APARTMENT|APT|APPT|#|NUMBER|NUM|FLOOR|FL|\s)?(\d)*)\b/ig;return e.test(r)};S.street=S.address=S.streetAddress;S.zipCode=function(r){if(S.undefined(r)||!(S.string(r)||S.number(r)))return!1;var e=/^\d{5}(?:-\d{4})?$/;return e.test(r)};S.zip=S.zipCode;S.phoneNumber=function(r){if(!S.string(r))return!1;var e=/(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:(\(?)(?:(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]‌​)\s*)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\)?)\s*(?:[.-]\s*)?)?([2-9]1[02-‌​9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})/g;return e.test(r)};S.phone=S.phoneNumber;var Yge=VH();S.url=function(r){return Yge(r)};S.uri=S.url;S.enumerator=function(r,e){var t=!1;if(!S.defined(r)||!S.defined(e)||!S.arrayLike(e))return t;for(var n=0,i=e.length;n<i;n++)if(S.equal(r,e[n])){t=!0;break}return t};S.enum=S.inArray=S.enumerator});var RF=M((Qet,$H)=>{function Xge(r){t.debug=t,t.default=t,t.coerce=c,t.disable=o,t.enable=i,t.enabled=s,t.humanize=BP(),t.destroy=l,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let p=0;for(let m=0;m<u.length;m++)p=(p<<5)-p+u.charCodeAt(m),p|=0;return t.colors[Math.abs(p)%t.colors.length]}t.selectColor=e;function t(u){let p,m=null;function h(...g){if(!h.enabled)return;let b=h,w=Number(new Date),k=w-(p||w);b.diff=k,b.prev=p,b.curr=w,p=w,g[0]=t.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let N=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,(V,oe)=>{if(V==="%%")return"%";N++;let G=t.formatters[oe];if(typeof G=="function"){let pe=g[N];V=G.call(b,pe),g.splice(N,1),N--}return V}),t.formatArgs.call(b,g),(b.log||t.log).apply(b,g)}return h.namespace=u,h.useColors=t.useColors(),h.color=t.selectColor(u),h.extend=n,h.destroy=t.destroy,Object.defineProperty(h,"enabled",{enumerable:!0,configurable:!1,get:()=>m===null?t.enabled(u):m,set:g=>{m=g}}),typeof t.init=="function"&&t.init(h),h}function n(u,p){let m=t(this.namespace+(typeof p>"u"?":":p)+u);return m.log=this.log,m}function i(u){t.save(u),t.names=[],t.skips=[];let p,m=(typeof u=="string"?u:"").split(/[\s,]+/),h=m.length;for(p=0;p<h;p++)m[p]&&(u=m[p].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function o(){let u=[...t.names.map(a),...t.skips.map(a).map(p=>"-"+p)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let p,m;for(p=0,m=t.skips.length;p<m;p++)if(t.skips[p].test(u))return!1;for(p=0,m=t.names.length;p<m;p++)if(t.names[p].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}$H.exports=Xge});var HH=M((rs,WD)=>{rs.formatArgs=eve;rs.save=tve;rs.load=rve;rs.useColors=Zge;rs.storage=nve();rs.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();rs.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Zge(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function eve(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+WD.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}rs.log=console.debug||console.log||(()=>{});function tve(r){try{r?rs.storage.setItem("debug",r):rs.storage.removeItem("debug")}catch{}}function rve(){let r;try{r=rs.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function nve(){try{return localStorage}catch{}}WD.exports=RF()(rs);var{formatters:ive}=WD.exports;ive.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var zH=M((di,BD)=>{var ove=require("tty"),VD=require("util");di.init=dve;di.log=lve;di.formatArgs=ave;di.save=uve;di.load=pve;di.useColors=sve;di.destroy=VD.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");di.colors=[6,2,3,4,5,1];try{let r=JP();r&&(r.stderr||r).level>=2&&(di.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}di.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function sve(){return"colors"in di.inspectOpts?!!di.inspectOpts.colors:ove.isatty(process.stderr.fd)}function ave(r){let{namespace:e,useColors:t}=this;if(t){let n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o=`  ${i};1m${e} \x1B[0m`;r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+BD.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=cve()+e+" "+r[0]}function cve(){return di.inspectOpts.hideDate?"":new Date().toISOString()+" "}function lve(...r){return process.stderr.write(VD.format(...r)+`
`)}function uve(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function pve(){return process.env.DEBUG}function dve(r){r.inspectOpts={};let e=Object.keys(di.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=di.inspectOpts[e[t]]}BD.exports=RF()(di);var{formatters:GH}=BD.exports;GH.o=function(r){return this.inspectOpts.colors=this.useColors,VD.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};GH.O=function(r){return this.inspectOpts.colors=this.useColors,VD.inspect(r,this.inspectOpts)}});var QH=M((Yet,AF)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?AF.exports=HH():AF.exports=zH()});var n4=M(lf=>{"use strict";lf.check=t4;lf.waitUntilFreeOnHost=fve;lf.waitUntilFree=hve;lf.waitUntilUsedOnHost=r4;lf.waitUntilUsed=gve;lf.waitForStatus=JD;var Da=JH(),mve=require("net"),YH=require("util"),qD=QH()("tcp-port-used"),XH=2e3,ZH=250;function e4(){var r,e,t=new Promise(function(n,i){r=n,e=i});return{resolve:r,reject:e,promise:t}}function Ry(r,e,t,n,i){var o={};return o.port=r,o.host=e,o.inUse=t,o.retryTimeMs=n,o.timeOutMs=i,o}function t4(r,e){var t=e4(),n=!0,i,o;if(Da.obj(r)?o=r:o=Ry(r,e),!Da.port(o.port))return qD("Error invalid port: "+YH.inspect(o.port)),t.reject(new Error("invalid port: "+YH.inspect(o.port))),t.promise;Da.nullOrUndefined(o.host)&&(qD("set host address to default 127.0.0.1"),o.host="127.0.0.1");function s(){i&&(i.removeAllListeners("connect"),i.removeAllListeners("error"),i.end(),i.destroy(),i.unref())}function a(){t.resolve(n),s()}function c(l){l.code!=="ECONNREFUSED"?t.reject(l):(n=!1,t.resolve(n)),s()}return i=new mve.Socket,i.once("connect",a),i.once("error",c),i.connect({port:o.port,host:o.host},function(){}),t.promise}function JD(r,e,t,n,i){var o=e4(),s,a=!1,c,l;if(Da.obj(r)?l=r:l=Ry(r,e,t,n,i),!Da.bool(l.inUse))return o.reject(new Error("inUse must be a boolean")),o.promise;Da.positiveInt(l.retryTimeMs)||(l.retryTimeMs=ZH,qD("set retryTime to default "+ZH+"ms")),Da.positiveInt(l.timeOutMs)||(l.timeOutMs=XH,qD("set timeOutMs to default "+XH+"ms"));function u(){s&&clearTimeout(s),c&&clearTimeout(c)}function p(){a=!0,u(),o.reject(new Error("timeout"))}s=setTimeout(p,l.timeOutMs);function m(){t4(l.port,l.host).then(function(h){if(!a)if(h===l.inUse){o.resolve(),u();return}else{c=setTimeout(function(){m()},l.retryTimeMs);return}},function(h){a||(o.reject(h),u())})}return m(),o.promise}function fve(r,e,t,n){var i;return Da.obj(r)?(i=r,i.inUse=!1):i=Ry(r,e,!1,t,n),JD(i)}function hve(r,e,t){var n;return Da.obj(r)?(n=r,n.host="127.0.0.1",n.inUse=!1):n=Ry(r,"127.0.0.1",!1,e,t),JD(n)}function r4(r,e,t,n){var i;return Da.obj(r)?(i=r,i.inUse=!0):i=Ry(r,e,!0,t,n),JD(i)}function gve(r,e,t){var n;return Da.obj(r)?(n=r,n.host="127.0.0.1",n.inUse=!0):n=Ry(r,"127.0.0.1",!0,e,t),r4(n)}});var u4=M(($D,nl)=>{(function(r,e){typeof $D=="object"&&typeof nl<"u"?e($D):typeof define=="function"&&define.amd?define(["exports"],e):e(r.async=r.async||{})})($D,function(r){"use strict";function e(I,P){P=P|0;for(var R=Math.max(I.length-P,0),K=Array(R),X=0;X<R;X++)K[X]=I[P+X];return K}var t=function(I){var P=e(arguments,1);return function(){var R=e(arguments);return I.apply(null,P.concat(R))}},n=function(I){return function(){var P=e(arguments),R=P.pop();I.call(this,P,R)}};function i(I){var P=typeof I;return I!=null&&(P=="object"||P=="function")}var o=typeof setImmediate=="function"&&setImmediate,s=typeof process=="object"&&typeof process.nextTick=="function";function a(I){setTimeout(I,0)}function c(I){return function(P){var R=e(arguments,1);I(function(){P.apply(null,R)})}}var l;o?l=setImmediate:s?l=process.nextTick:l=a;var u=c(l);function p(I){return n(function(P,R){var K;try{K=I.apply(this,P)}catch(X){return R(X)}i(K)&&typeof K.then=="function"?K.then(function(X){m(R,null,X)},function(X){m(R,X.message?X:new Error(X))}):R(null,K)})}function m(I,P,R){try{I(P,R)}catch(K){u(h,K)}}function h(I){throw I}var g=typeof Symbol=="function";function b(I){return g&&I[Symbol.toStringTag]==="AsyncFunction"}function w(I){return b(I)?p(I):I}function k(I){return function(P){var R=e(arguments,1),K=n(function(X,Y){var ce=this;return I(P,function(me,Re){w(me).apply(ce,X.concat(Re))},Y)});return R.length?K.apply(this,R):K}}var N=typeof global=="object"&&global&&global.Object===Object&&global,D=typeof self=="object"&&self&&self.Object===Object&&self,V=N||D||Function("return this")(),oe=V.Symbol,G=Object.prototype,pe=G.hasOwnProperty,de=G.toString,te=oe?oe.toStringTag:void 0;function we(I){var P=pe.call(I,te),R=I[te];try{I[te]=void 0;var K=!0}catch{}var X=de.call(I);return K&&(P?I[te]=R:delete I[te]),X}var Ue=Object.prototype,ct=Ue.toString;function ft(I){return ct.call(I)}var rt="[object Null]",ae="[object Undefined]",ke=oe?oe.toStringTag:void 0;function Z(I){return I==null?I===void 0?ae:rt:ke&&ke in Object(I)?we(I):ft(I)}var ve="[object AsyncFunction]",Be="[object Function]",dn="[object GeneratorFunction]",Et="[object Proxy]";function jr(I){if(!i(I))return!1;var P=Z(I);return P==Be||P==dn||P==ve||P==Et}var ls=9007199254740991;function Vt(I){return typeof I=="number"&&I>-1&&I%1==0&&I<=ls}function en(I){return I!=null&&Vt(I.length)&&!jr(I)}var Fi={};function Mt(){}function or(I){return function(){if(I!==null){var P=I;I=null,P.apply(this,arguments)}}}var Xn=typeof Symbol=="function"&&Symbol.iterator,Cl=function(I){return Xn&&I[Xn]&&I[Xn]()};function L(I,P){for(var R=-1,K=Array(I);++R<I;)K[R]=P(R);return K}function B(I){return I!=null&&typeof I=="object"}var Ie="[object Arguments]";function Me(I){return B(I)&&Z(I)==Ie}var nt=Object.prototype,tn=nt.hasOwnProperty,Ht=nt.propertyIsEnumerable,jt=Me(function(){return arguments}())?Me:function(I){return B(I)&&tn.call(I,"callee")&&!Ht.call(I,"callee")},Ot=Array.isArray;function wr(){return!1}var Wr=typeof r=="object"&&r&&!r.nodeType&&r,Dr=Wr&&typeof nl=="object"&&nl&&!nl.nodeType&&nl,rn=Dr&&Dr.exports===Wr,H=rn?V.Buffer:void 0,ie=H?H.isBuffer:void 0,ge=ie||wr,Ee=9007199254740991,He=/^(?:0|[1-9]\d*)$/;function nn(I,P){var R=typeof I;return P=P??Ee,!!P&&(R=="number"||R!="symbol"&&He.test(I))&&I>-1&&I%1==0&&I<P}var Pt="[object Arguments]",Dt="[object Array]",ot="[object Boolean]",Ut="[object Date]",se="[object Error]",fe="[object Function]",q="[object Map]",J="[object Number]",re="[object Object]",_e="[object RegExp]",Le="[object Set]",ur="[object String]",vi="[object WeakMap]",wl="[object ArrayBuffer]",O1="[object DataView]",K1="[object Float32Array]",F1="[object Float64Array]",Ce="[object Int8Array]",LL="[object Int16Array]",UL="[object Int32Array]",jL="[object Uint8Array]",WL="[object Uint8ClampedArray]",VL="[object Uint16Array]",BL="[object Uint32Array]",Nr={};Nr[K1]=Nr[F1]=Nr[Ce]=Nr[LL]=Nr[UL]=Nr[jL]=Nr[WL]=Nr[VL]=Nr[BL]=!0,Nr[Pt]=Nr[Dt]=Nr[wl]=Nr[ot]=Nr[O1]=Nr[Ut]=Nr[se]=Nr[fe]=Nr[q]=Nr[J]=Nr[re]=Nr[_e]=Nr[Le]=Nr[ur]=Nr[vi]=!1;function qL(I){return B(I)&&Vt(I.length)&&!!Nr[Z(I)]}function JL(I){return function(P){return I(P)}}var L1=typeof r=="object"&&r&&!r.nodeType&&r,Qf=L1&&typeof nl=="object"&&nl&&!nl.nodeType&&nl,$L=Qf&&Qf.exports===L1,pw=$L&&N.process,U1=function(){try{var I=Qf&&Qf.require&&Qf.require("util").types;return I||pw&&pw.binding&&pw.binding("util")}catch{}}(),j1=U1&&U1.isTypedArray,HL=j1?JL(j1):qL,GL=Object.prototype,zL=GL.hasOwnProperty;function QL(I,P){var R=Ot(I),K=!R&&jt(I),X=!R&&!K&&ge(I),Y=!R&&!K&&!X&&HL(I),ce=R||K||X||Y,me=ce?L(I.length,String):[],Re=me.length;for(var et in I)(P||zL.call(I,et))&&!(ce&&(et=="length"||X&&(et=="offset"||et=="parent")||Y&&(et=="buffer"||et=="byteLength"||et=="byteOffset")||nn(et,Re)))&&me.push(et);return me}var YL=Object.prototype;function XL(I){var P=I&&I.constructor,R=typeof P=="function"&&P.prototype||YL;return I===R}function ZL(I,P){return function(R){return I(P(R))}}var eU=ZL(Object.keys,Object),tU=Object.prototype,rU=tU.hasOwnProperty;function nU(I){if(!XL(I))return eU(I);var P=[];for(var R in Object(I))rU.call(I,R)&&R!="constructor"&&P.push(R);return P}function dw(I){return en(I)?QL(I):nU(I)}function iU(I){var P=-1,R=I.length;return function(){return++P<R?{value:I[P],key:P}:null}}function oU(I){var P=-1;return function(){var K=I.next();return K.done?null:(P++,{value:K.value,key:P})}}function sU(I){var P=dw(I),R=-1,K=P.length;return function X(){var Y=P[++R];return Y==="__proto__"?X():R<K?{value:I[Y],key:Y}:null}}function aU(I){if(en(I))return iU(I);var P=Cl(I);return P?oU(P):sU(I)}function ra(I){return function(){if(I===null)throw new Error("Callback was already called.");var P=I;I=null,P.apply(this,arguments)}}function $I(I){return function(P,R,K){if(K=or(K||Mt),I<=0||!P)return K(null);var X=aU(P),Y=!1,ce=0,me=!1;function Re(Ae,xt){if(ce-=1,Ae)Y=!0,K(Ae);else{if(xt===Fi||Y&&ce<=0)return Y=!0,K(null);me||et()}}function et(){for(me=!0;ce<I&&!Y;){var Ae=X();if(Ae===null){Y=!0,ce<=0&&K(null);return}ce+=1,R(Ae.value,Ae.key,ra(Re))}me=!1}et()}}function Fu(I,P,R,K){$I(P)(I,w(R),K)}function jn(I,P){return function(R,K,X){return I(R,P,K,X)}}function cU(I,P,R){R=or(R||Mt);var K=0,X=0,Y=I.length;Y===0&&R(null);function ce(me,Re){me?R(me):(++X===Y||Re===Fi)&&R(null)}for(;K<Y;K++)P(I[K],K,ra(ce))}var lU=jn(Fu,1/0),El=function(I,P,R){var K=en(I)?cU:lU;K(I,w(P),R)};function Bd(I){return function(P,R,K){return I(El,P,w(R),K)}}function W1(I,P,R,K){K=K||Mt,P=P||[];var X=[],Y=0,ce=w(R);I(P,function(me,Re,et){var Ae=Y++;ce(me,function(xt,Vr){X[Ae]=Vr,et(xt)})},function(me){K(me,X)})}var HI=Bd(W1),V1=k(HI);function qd(I){return function(P,R,K,X){return I($I(R),P,w(K),X)}}var Jd=qd(W1),mw=jn(Jd,1),B1=k(mw);function GI(I,P){for(var R=-1,K=I==null?0:I.length;++R<K&&P(I[R],R,I)!==!1;);return I}function uU(I){return function(P,R,K){for(var X=-1,Y=Object(P),ce=K(P),me=ce.length;me--;){var Re=ce[I?me:++X];if(R(Y[Re],Re,Y)===!1)break}return P}}var pU=uU();function Yf(I,P){return I&&pU(I,P,dw)}function dU(I,P,R,K){for(var X=I.length,Y=R+(K?1:-1);K?Y--:++Y<X;)if(P(I[Y],Y,I))return Y;return-1}function mU(I){return I!==I}function fU(I,P,R){for(var K=R-1,X=I.length;++K<X;)if(I[K]===P)return K;return-1}function zI(I,P,R){return P===P?fU(I,P,R):dU(I,mU,R)}var fw=function(I,P,R){typeof P=="function"&&(R=P,P=null),R=or(R||Mt);var K=dw(I),X=K.length;if(!X)return R(null);P||(P=X);var Y={},ce=0,me=!1,Re=Object.create(null),et=[],Ae=[],xt={};Yf(I,function(Gr,on){if(!Ot(Gr)){Vr(on,[Gr]),Ae.push(on);return}var Wn=Gr.slice(0,Gr.length-1),kl=Wn.length;if(kl===0){Vr(on,Gr),Ae.push(on);return}xt[on]=kl,GI(Wn,function(sh){if(!I[sh])throw new Error("async.auto task `"+on+"` has a non-existent dependency `"+sh+"` in "+Wn.join(", "));Wa(sh,function(){kl--,kl===0&&Vr(on,Gr)})})}),QQ(),yi();function Vr(Gr,on){et.push(function(){Va(Gr,on)})}function yi(){if(et.length===0&&ce===0)return R(null,Y);for(;et.length&&ce<P;){var Gr=et.shift();Gr()}}function Wa(Gr,on){var Wn=Re[Gr];Wn||(Wn=Re[Gr]=[]),Wn.push(on)}function ps(Gr){var on=Re[Gr]||[];GI(on,function(Wn){Wn()}),yi()}function Va(Gr,on){if(!me){var Wn=ra(function(sh,LR){if(ce--,arguments.length>2&&(LR=e(arguments,1)),sh){var UR={};Yf(Y,function(XQ,ZQ){UR[ZQ]=XQ}),UR[Gr]=LR,me=!0,Re=Object.create(null),R(sh,UR)}else Y[Gr]=LR,ps(Gr)});ce++;var kl=w(on[on.length-1]);on.length>1?kl(Y,Wn):kl(Wn)}}function QQ(){for(var Gr,on=0;Ae.length;)Gr=Ae.pop(),on++,GI(YQ(Gr),function(Wn){--xt[Wn]===0&&Ae.push(Wn)});if(on!==X)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}function YQ(Gr){var on=[];return Yf(I,function(Wn,kl){Ot(Wn)&&zI(Wn,Gr,0)>=0&&on.push(kl)}),on}};function $d(I,P){for(var R=-1,K=I==null?0:I.length,X=Array(K);++R<K;)X[R]=P(I[R],R,I);return X}var hU="[object Symbol]";function gU(I){return typeof I=="symbol"||B(I)&&Z(I)==hU}var vU=1/0,q1=oe?oe.prototype:void 0,J1=q1?q1.toString:void 0;function hw(I){if(typeof I=="string")return I;if(Ot(I))return $d(I,hw)+"";if(gU(I))return J1?J1.call(I):"";var P=I+"";return P=="0"&&1/I==-vU?"-0":P}function yU(I,P,R){var K=-1,X=I.length;P<0&&(P=-P>X?0:X+P),R=R>X?X:R,R<0&&(R+=X),X=P>R?0:R-P>>>0,P>>>=0;for(var Y=Array(X);++K<X;)Y[K]=I[K+P];return Y}function bU(I,P,R){var K=I.length;return R=R===void 0?K:R,!P&&R>=K?I:yU(I,P,R)}function IU(I,P){for(var R=I.length;R--&&zI(P,I[R],0)>-1;);return R}function SU(I,P){for(var R=-1,K=I.length;++R<K&&zI(P,I[R],0)>-1;);return R}function xU(I){return I.split("")}var CU="\\ud800-\\udfff",wU="\\u0300-\\u036f",EU="\\ufe20-\\ufe2f",PU="\\u20d0-\\u20ff",kU=wU+EU+PU,_U="\\ufe0e\\ufe0f",DU="\\u200d",TU=RegExp("["+DU+CU+kU+_U+"]");function RU(I){return TU.test(I)}var $1="\\ud800-\\udfff",AU="\\u0300-\\u036f",NU="\\ufe20-\\ufe2f",MU="\\u20d0-\\u20ff",OU=AU+NU+MU,KU="\\ufe0e\\ufe0f",FU="["+$1+"]",gw="["+OU+"]",vw="\\ud83c[\\udffb-\\udfff]",LU="(?:"+gw+"|"+vw+")",H1="[^"+$1+"]",G1="(?:\\ud83c[\\udde6-\\uddff]){2}",z1="[\\ud800-\\udbff][\\udc00-\\udfff]",UU="\\u200d",Q1=LU+"?",Y1="["+KU+"]?",jU="(?:"+UU+"(?:"+[H1,G1,z1].join("|")+")"+Y1+Q1+")*",WU=Y1+Q1+jU,VU="(?:"+[H1+gw+"?",gw,G1,z1,FU].join("|")+")",BU=RegExp(vw+"(?="+vw+")|"+VU+WU,"g");function qU(I){return I.match(BU)||[]}function X1(I){return RU(I)?qU(I):xU(I)}function JU(I){return I==null?"":hw(I)}var $U=/^\s+|\s+$/g;function HU(I,P,R){if(I=JU(I),I&&(R||P===void 0))return I.replace($U,"");if(!I||!(P=hw(P)))return I;var K=X1(I),X=X1(P),Y=SU(K,X),ce=IU(K,X)+1;return bU(K,Y,ce).join("")}var GU=/^(?:async\s+)?(function)?\s*[^\(]*\(\s*([^\)]*)\)/m,zU=/,/,QU=/(=.+)?(\s*)$/,YU=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;function XU(I){return I=I.toString().replace(YU,""),I=I.match(GU)[2].replace(" ",""),I=I?I.split(zU):[],I=I.map(function(P){return HU(P.replace(QU,""))}),I}function Z1(I,P){var R={};Yf(I,function(K,X){var Y,ce=b(K),me=!ce&&K.length===1||ce&&K.length===0;if(Ot(K))Y=K.slice(0,-1),K=K[K.length-1],R[X]=Y.concat(Y.length>0?Re:K);else if(me)R[X]=K;else{if(Y=XU(K),K.length===0&&!ce&&Y.length===0)throw new Error("autoInject task functions require explicit parameters.");ce||Y.pop(),R[X]=Y.concat(Re)}function Re(et,Ae){var xt=$d(Y,function(Vr){return et[Vr]});xt.push(Ae),w(K).apply(null,xt)}}),fw(R,P)}function us(){this.head=this.tail=null,this.length=0}function eR(I,P){I.length=1,I.head=I.tail=P}us.prototype.removeLink=function(I){return I.prev?I.prev.next=I.next:this.head=I.next,I.next?I.next.prev=I.prev:this.tail=I.prev,I.prev=I.next=null,this.length-=1,I},us.prototype.empty=function(){for(;this.head;)this.shift();return this},us.prototype.insertAfter=function(I,P){P.prev=I,P.next=I.next,I.next?I.next.prev=P:this.tail=P,I.next=P,this.length+=1},us.prototype.insertBefore=function(I,P){P.prev=I.prev,P.next=I,I.prev?I.prev.next=P:this.head=P,I.prev=P,this.length+=1},us.prototype.unshift=function(I){this.head?this.insertBefore(this.head,I):eR(this,I)},us.prototype.push=function(I){this.tail?this.insertAfter(this.tail,I):eR(this,I)},us.prototype.shift=function(){return this.head&&this.removeLink(this.head)},us.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},us.prototype.toArray=function(){for(var I=Array(this.length),P=this.head,R=0;R<this.length;R++)I[R]=P.data,P=P.next;return I},us.prototype.remove=function(I){for(var P=this.head;P;){var R=P.next;I(P)&&this.removeLink(P),P=R}return this};function tR(I,P,R){if(P==null)P=1;else if(P===0)throw new Error("Concurrency must not be zero");var K=w(I),X=0,Y=[],ce=!1;function me(xt,Vr,yi){if(yi!=null&&typeof yi!="function")throw new Error("task callback must be a function");if(Ae.started=!0,Ot(xt)||(xt=[xt]),xt.length===0&&Ae.idle())return u(function(){Ae.drain()});for(var Wa=0,ps=xt.length;Wa<ps;Wa++){var Va={data:xt[Wa],callback:yi||Mt};Vr?Ae._tasks.unshift(Va):Ae._tasks.push(Va)}ce||(ce=!0,u(function(){ce=!1,Ae.process()}))}function Re(xt){return function(Vr){X-=1;for(var yi=0,Wa=xt.length;yi<Wa;yi++){var ps=xt[yi],Va=zI(Y,ps,0);Va===0?Y.shift():Va>0&&Y.splice(Va,1),ps.callback.apply(ps,arguments),Vr!=null&&Ae.error(Vr,ps.data)}X<=Ae.concurrency-Ae.buffer&&Ae.unsaturated(),Ae.idle()&&Ae.drain(),Ae.process()}}var et=!1,Ae={_tasks:new us,concurrency:P,payload:R,saturated:Mt,unsaturated:Mt,buffer:P/4,empty:Mt,drain:Mt,error:Mt,started:!1,paused:!1,push:function(xt,Vr){me(xt,!1,Vr)},kill:function(){Ae.drain=Mt,Ae._tasks.empty()},unshift:function(xt,Vr){me(xt,!0,Vr)},remove:function(xt){Ae._tasks.remove(xt)},process:function(){if(!et){for(et=!0;!Ae.paused&&X<Ae.concurrency&&Ae._tasks.length;){var xt=[],Vr=[],yi=Ae._tasks.length;Ae.payload&&(yi=Math.min(yi,Ae.payload));for(var Wa=0;Wa<yi;Wa++){var ps=Ae._tasks.shift();xt.push(ps),Y.push(ps),Vr.push(ps.data)}X+=1,Ae._tasks.length===0&&Ae.empty(),X===Ae.concurrency&&Ae.saturated();var Va=ra(Re(xt));K(Vr,Va)}et=!1}},length:function(){return Ae._tasks.length},running:function(){return X},workersList:function(){return Y},idle:function(){return Ae._tasks.length+X===0},pause:function(){Ae.paused=!0},resume:function(){Ae.paused!==!1&&(Ae.paused=!1,u(Ae.process))}};return Ae}function rR(I,P){return tR(I,1,P)}var Hd=jn(Fu,1);function Pl(I,P,R,K){K=or(K||Mt);var X=w(R);Hd(I,function(Y,ce,me){X(P,Y,function(Re,et){P=et,me(Re)})},function(Y){K(Y,P)})}function yw(){var I=$d(arguments,w);return function(){var P=e(arguments),R=this,K=P[P.length-1];typeof K=="function"?P.pop():K=Mt,Pl(I,P,function(X,Y,ce){Y.apply(R,X.concat(function(me){var Re=e(arguments,1);ce(me,Re)}))},function(X,Y){K.apply(R,[X].concat(Y))})}}var nR=function(){return yw.apply(null,e(arguments).reverse())},ZU=Array.prototype.concat,QI=function(I,P,R,K){K=K||Mt;var X=w(R);Jd(I,P,function(Y,ce){X(Y,function(me){return me?ce(me):ce(null,e(arguments,1))})},function(Y,ce){for(var me=[],Re=0;Re<ce.length;Re++)ce[Re]&&(me=ZU.apply(me,ce[Re]));return K(Y,me)})},iR=jn(QI,1/0),oR=jn(QI,1),sR=function(){var I=e(arguments),P=[null].concat(I);return function(){var R=arguments[arguments.length-1];return R.apply(this,P)}};function Xf(I){return I}function Gd(I,P){return function(R,K,X,Y){Y=Y||Mt;var ce=!1,me;R(K,function(Re,et,Ae){X(Re,function(xt,Vr){xt?Ae(xt):I(Vr)&&!me?(ce=!0,me=P(!0,Re),Ae(null,Fi)):Ae()})},function(Re){Re?Y(Re):Y(null,ce?me:P(!1))})}}function aR(I,P){return P}var YI=Bd(Gd(Xf,aR)),Zf=qd(Gd(Xf,aR)),XI=jn(Zf,1);function cR(I){return function(P){var R=e(arguments,1);R.push(function(K){var X=e(arguments,1);typeof console=="object"&&(K?console.error&&console.error(K):console[I]&&GI(X,function(Y){console[I](Y)}))}),w(P).apply(null,R)}}var lR=cR("dir");function uR(I,P,R){R=ra(R||Mt);var K=w(I),X=w(P);function Y(me){if(me)return R(me);var Re=e(arguments,1);Re.push(ce),X.apply(this,Re)}function ce(me,Re){if(me)return R(me);if(!Re)return R(null);K(Y)}ce(null,!0)}function bw(I,P,R){R=ra(R||Mt);var K=w(I),X=function(Y){if(Y)return R(Y);var ce=e(arguments,1);if(P.apply(this,ce))return K(X);R.apply(null,[null].concat(ce))};K(X)}function pR(I,P,R){bw(I,function(){return!P.apply(this,arguments)},R)}function dR(I,P,R){R=ra(R||Mt);var K=w(P),X=w(I);function Y(me){if(me)return R(me);X(ce)}function ce(me,Re){if(me)return R(me);if(!Re)return R(null);K(Y)}X(ce)}function mR(I){return function(P,R,K){return I(P,K)}}function ZI(I,P,R){El(I,mR(w(P)),R)}function eh(I,P,R,K){$I(P)(I,mR(w(R)),K)}var th=jn(eh,1);function Iw(I){return b(I)?I:n(function(P,R){var K=!0;P.push(function(){var X=arguments;K?u(function(){R.apply(null,X)}):R.apply(null,X)}),I.apply(this,P),K=!1})}function eS(I){return!I}var tS=Bd(Gd(eS,eS)),rh=qd(Gd(eS,eS)),rS=jn(rh,1);function fR(I){return function(P){return P?.[I]}}function ej(I,P,R,K){var X=new Array(P.length);I(P,function(Y,ce,me){R(Y,function(Re,et){X[ce]=!!et,me(Re)})},function(Y){if(Y)return K(Y);for(var ce=[],me=0;me<P.length;me++)X[me]&&ce.push(P[me]);K(null,ce)})}function tj(I,P,R,K){var X=[];I(P,function(Y,ce,me){R(Y,function(Re,et){Re?me(Re):(et&&X.push({index:ce,value:Y}),me())})},function(Y){Y?K(Y):K(null,$d(X.sort(function(ce,me){return ce.index-me.index}),fR("value")))})}function Sw(I,P,R,K){var X=en(P)?ej:tj;X(I,P,w(R),K||Mt)}var nS=Bd(Sw),nh=qd(Sw),iS=jn(nh,1);function hR(I,P){var R=ra(P||Mt),K=w(Iw(I));function X(Y){if(Y)return R(Y);K(X)}X()}var oS=function(I,P,R,K){K=K||Mt;var X=w(R);Jd(I,P,function(Y,ce){X(Y,function(me,Re){return me?ce(me):ce(null,{key:Re,val:Y})})},function(Y,ce){for(var me={},Re=Object.prototype.hasOwnProperty,et=0;et<ce.length;et++)if(ce[et]){var Ae=ce[et].key,xt=ce[et].val;Re.call(me,Ae)?me[Ae].push(xt):me[Ae]=[xt]}return K(Y,me)})},gR=jn(oS,1/0),vR=jn(oS,1),yR=cR("log");function sS(I,P,R,K){K=or(K||Mt);var X={},Y=w(R);Fu(I,P,function(ce,me,Re){Y(ce,me,function(et,Ae){if(et)return Re(et);X[me]=Ae,Re()})},function(ce){K(ce,X)})}var bR=jn(sS,1/0),IR=jn(sS,1);function SR(I,P){return P in I}function xR(I,P){var R=Object.create(null),K=Object.create(null);P=P||Xf;var X=w(I),Y=n(function(me,Re){var et=P.apply(null,me);SR(R,et)?u(function(){Re.apply(null,R[et])}):SR(K,et)?K[et].push(Re):(K[et]=[Re],X.apply(null,me.concat(function(){var Ae=e(arguments);R[et]=Ae;var xt=K[et];delete K[et];for(var Vr=0,yi=xt.length;Vr<yi;Vr++)xt[Vr].apply(null,Ae)})))});return Y.memo=R,Y.unmemoized=I,Y}var aS;s?aS=process.nextTick:o?aS=setImmediate:aS=a;var CR=c(aS);function xw(I,P,R){R=R||Mt;var K=en(P)?[]:{};I(P,function(X,Y,ce){w(X)(function(me,Re){arguments.length>2&&(Re=e(arguments,1)),K[Y]=Re,ce(me)})},function(X){R(X,K)})}function wR(I,P){xw(El,I,P)}function ER(I,P,R){xw($I(P),I,R)}var Cw=function(I,P){var R=w(I);return tR(function(K,X){R(K[0],X)},P,1)},PR=function(I,P){var R=Cw(I,P);return R.push=function(K,X,Y){if(Y==null&&(Y=Mt),typeof Y!="function")throw new Error("task callback must be a function");if(R.started=!0,Ot(K)||(K=[K]),K.length===0)return u(function(){R.drain()});X=X||0;for(var ce=R._tasks.head;ce&&X>=ce.priority;)ce=ce.next;for(var me=0,Re=K.length;me<Re;me++){var et={data:K[me],priority:X,callback:Y};ce?R._tasks.insertBefore(ce,et):R._tasks.push(et)}u(R.process)},delete R.unshift,R};function kR(I,P){if(P=or(P||Mt),!Ot(I))return P(new TypeError("First argument to race must be an array of functions"));if(!I.length)return P();for(var R=0,K=I.length;R<K;R++)w(I[R])(P)}function cS(I,P,R,K){var X=e(I).reverse();Pl(X,P,R,K)}function lS(I){var P=w(I);return n(function(K,X){return K.push(function(ce,me){if(ce)X(null,{error:ce});else{var Re;arguments.length<=2?Re=me:Re=e(arguments,1),X(null,{value:Re})}}),P.apply(this,K)})}function _R(I){var P;return Ot(I)?P=$d(I,lS):(P={},Yf(I,function(R,K){P[K]=lS.call(this,R)})),P}function DR(I,P,R,K){Sw(I,P,function(X,Y){R(X,function(ce,me){Y(ce,!me)})},K)}var TR=Bd(DR),ww=qd(DR),RR=jn(ww,1);function AR(I){return function(){return I}}function uS(I,P,R){var K=5,X=0,Y={times:K,intervalFunc:AR(X)};function ce(Ae,xt){if(typeof xt=="object")Ae.times=+xt.times||K,Ae.intervalFunc=typeof xt.interval=="function"?xt.interval:AR(+xt.interval||X),Ae.errorFilter=xt.errorFilter;else if(typeof xt=="number"||typeof xt=="string")Ae.times=+xt||K;else throw new Error("Invalid arguments for async.retry")}if(arguments.length<3&&typeof I=="function"?(R=P||Mt,P=I):(ce(Y,I),R=R||Mt),typeof P!="function")throw new Error("Invalid arguments for async.retry");var me=w(P),Re=1;function et(){me(function(Ae){Ae&&Re++<Y.times&&(typeof Y.errorFilter!="function"||Y.errorFilter(Ae))?setTimeout(et,Y.intervalFunc(Re)):R.apply(null,arguments)})}et()}var NR=function(I,P){P||(P=I,I=null);var R=w(P);return n(function(K,X){function Y(ce){R.apply(null,K.concat(ce))}I?uS(I,Y,X):uS(Y,X)})};function MR(I,P){xw(Hd,I,P)}var pS=Bd(Gd(Boolean,Xf)),ih=qd(Gd(Boolean,Xf)),dS=jn(ih,1);function OR(I,P,R){var K=w(P);HI(I,function(Y,ce){K(Y,function(me,Re){if(me)return ce(me);ce(null,{value:Y,criteria:Re})})},function(Y,ce){if(Y)return R(Y);R(null,$d(ce.sort(X),fR("value")))});function X(Y,ce){var me=Y.criteria,Re=ce.criteria;return me<Re?-1:me>Re?1:0}}function KR(I,P,R){var K=w(I);return n(function(X,Y){var ce=!1,me;function Re(){var et=I.name||"anonymous",Ae=new Error('Callback function "'+et+'" timed out.');Ae.code="ETIMEDOUT",R&&(Ae.info=R),ce=!0,Y(Ae)}X.push(function(){ce||(Y.apply(null,arguments),clearTimeout(me))}),me=setTimeout(Re,P),K.apply(null,X)})}var T=Math.ceil,U=Math.max;function Ze(I,P,R,K){for(var X=-1,Y=U(T((P-I)/(R||1)),0),ce=Array(Y);Y--;)ce[K?Y:++X]=I,I+=R;return ce}function oh(I,P,R,K){var X=w(R);Jd(Ze(0,I,1),P,X,K)}var rj=jn(oh,1/0),nj=jn(oh,1);function ij(I,P,R,K){arguments.length<=3&&(K=R,R=P,P=Ot(I)?[]:{}),K=or(K||Mt);var X=w(R);El(I,function(Y,ce,me){X(P,Y,ce,me)},function(Y){K(Y,P)})}function oj(I,P){var R=null,K;P=P||Mt,th(I,function(X,Y){w(X)(function(ce,me){arguments.length>2?K=e(arguments,1):K=me,R=ce,Y(!ce)})},function(){P(R,K)})}function sj(I){return function(){return(I.unmemoized||I).apply(null,arguments)}}function FR(I,P,R){R=ra(R||Mt);var K=w(P);if(!I())return R(null);var X=function(Y){if(Y)return R(Y);if(I())return K(X);var ce=e(arguments,1);R.apply(null,[null].concat(ce))};K(X)}function aj(I,P,R){FR(function(){return!I.apply(this,arguments)},P,R)}var cj=function(I,P){if(P=or(P||Mt),!Ot(I))return P(new Error("First argument to waterfall must be an array of functions"));if(!I.length)return P();var R=0;function K(Y){var ce=w(I[R++]);Y.push(ra(X)),ce.apply(null,Y)}function X(Y){if(Y||R===I.length)return P.apply(null,arguments);K(e(arguments,1))}K([])},zQ={apply:t,applyEach:V1,applyEachSeries:B1,asyncify:p,auto:fw,autoInject:Z1,cargo:rR,compose:nR,concat:iR,concatLimit:QI,concatSeries:oR,constant:sR,detect:YI,detectLimit:Zf,detectSeries:XI,dir:lR,doDuring:uR,doUntil:pR,doWhilst:bw,during:dR,each:ZI,eachLimit:eh,eachOf:El,eachOfLimit:Fu,eachOfSeries:Hd,eachSeries:th,ensureAsync:Iw,every:tS,everyLimit:rh,everySeries:rS,filter:nS,filterLimit:nh,filterSeries:iS,forever:hR,groupBy:gR,groupByLimit:oS,groupBySeries:vR,log:yR,map:HI,mapLimit:Jd,mapSeries:mw,mapValues:bR,mapValuesLimit:sS,mapValuesSeries:IR,memoize:xR,nextTick:CR,parallel:wR,parallelLimit:ER,priorityQueue:PR,queue:Cw,race:kR,reduce:Pl,reduceRight:cS,reflect:lS,reflectAll:_R,reject:TR,rejectLimit:ww,rejectSeries:RR,retry:uS,retryable:NR,seq:yw,series:MR,setImmediate:u,some:pS,someLimit:ih,someSeries:dS,sortBy:OR,timeout:KR,times:rj,timesLimit:oh,timesSeries:nj,transform:ij,tryEach:oj,unmemoize:sj,until:aj,waterfall:cj,whilst:FR,all:tS,allLimit:rh,allSeries:rS,any:pS,anyLimit:ih,anySeries:dS,find:YI,findLimit:Zf,findSeries:XI,forEach:ZI,forEachSeries:th,forEachLimit:eh,forEachOf:El,forEachOfSeries:Hd,forEachOfLimit:Fu,inject:Pl,foldl:Pl,foldr:cS,select:nS,selectLimit:nh,selectSeries:iS,wrapSync:p};r.default=zQ,r.apply=t,r.applyEach=V1,r.applyEachSeries=B1,r.asyncify=p,r.auto=fw,r.autoInject=Z1,r.cargo=rR,r.compose=nR,r.concat=iR,r.concatLimit=QI,r.concatSeries=oR,r.constant=sR,r.detect=YI,r.detectLimit=Zf,r.detectSeries=XI,r.dir=lR,r.doDuring=uR,r.doUntil=pR,r.doWhilst=bw,r.during=dR,r.each=ZI,r.eachLimit=eh,r.eachOf=El,r.eachOfLimit=Fu,r.eachOfSeries=Hd,r.eachSeries=th,r.ensureAsync=Iw,r.every=tS,r.everyLimit=rh,r.everySeries=rS,r.filter=nS,r.filterLimit=nh,r.filterSeries=iS,r.forever=hR,r.groupBy=gR,r.groupByLimit=oS,r.groupBySeries=vR,r.log=yR,r.map=HI,r.mapLimit=Jd,r.mapSeries=mw,r.mapValues=bR,r.mapValuesLimit=sS,r.mapValuesSeries=IR,r.memoize=xR,r.nextTick=CR,r.parallel=wR,r.parallelLimit=ER,r.priorityQueue=PR,r.queue=Cw,r.race=kR,r.reduce=Pl,r.reduceRight=cS,r.reflect=lS,r.reflectAll=_R,r.reject=TR,r.rejectLimit=ww,r.rejectSeries=RR,r.retry=uS,r.retryable=NR,r.seq=yw,r.series=MR,r.setImmediate=u,r.some=pS,r.someLimit=ih,r.someSeries=dS,r.sortBy=OR,r.timeout=KR,r.times=rj,r.timesLimit=oh,r.timesSeries=nj,r.transform=ij,r.tryEach=oj,r.unmemoize=sj,r.until=aj,r.waterfall=cj,r.whilst=FR,r.all=tS,r.allLimit=rh,r.allSeries=rS,r.any=pS,r.anyLimit=ih,r.anySeries=dS,r.find=YI,r.findLimit=Zf,r.findSeries=XI,r.forEach=ZI,r.forEachSeries=th,r.forEachLimit=eh,r.forEachOf=El,r.forEachOfSeries=Hd,r.forEachOfLimit=Fu,r.inject=Pl,r.foldl=Pl,r.foldr=cS,r.select=nS,r.selectLimit=nh,r.selectSeries=iS,r.wrapSync=p,Object.defineProperty(r,"__esModule",{value:!0})})});var NF=M((Ett,p4)=>{"use strict";function vve(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=o,t.enabled=a,t.humanize=BP(),Object.keys(r).forEach(function(l){t[l]=r[l]}),t.instances=[],t.names=[],t.skips=[],t.formatters={};function e(l){for(var u=0,p=0;p<l.length;p++)u=(u<<5)-u+l.charCodeAt(p),u|=0;return t.colors[Math.abs(u)%t.colors.length]}t.selectColor=e;function t(l){var u;function p(){if(p.enabled){for(var m=arguments.length,h=new Array(m),g=0;g<m;g++)h[g]=arguments[g];var b=p,w=Number(new Date),k=w-(u||w);b.diff=k,b.prev=u,b.curr=w,u=w,h[0]=t.coerce(h[0]),typeof h[0]!="string"&&h.unshift("%O");var N=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,function(V,oe){if(V==="%%")return V;N++;var G=t.formatters[oe];if(typeof G=="function"){var pe=h[N];V=G.call(b,pe),h.splice(N,1),N--}return V}),t.formatArgs.call(b,h);var D=b.log||t.log;D.apply(b,h)}}return p.namespace=l,p.enabled=t.enabled(l),p.useColors=t.useColors(),p.color=e(l),p.destroy=n,p.extend=i,typeof t.init=="function"&&t.init(p),t.instances.push(p),p}function n(){var l=t.instances.indexOf(this);return l!==-1?(t.instances.splice(l,1),!0):!1}function i(l,u){return t(this.namespace+(typeof u>"u"?":":u)+l)}function o(l){t.save(l),t.names=[],t.skips=[];var u,p=(typeof l=="string"?l:"").split(/[\s,]+/),m=p.length;for(u=0;u<m;u++)p[u]&&(l=p[u].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.substr(1)+"$")):t.names.push(new RegExp("^"+l+"$")));for(u=0;u<t.instances.length;u++){var h=t.instances[u];h.enabled=t.enabled(h.namespace)}}function s(){t.enable("")}function a(l){if(l[l.length-1]==="*")return!0;var u,p;for(u=0,p=t.skips.length;u<p;u++)if(t.skips[u].test(l))return!1;for(u=0,p=t.names.length;u<p;u++)if(t.names[u].test(l))return!0;return!1}function c(l){return l instanceof Error?l.stack||l.message:l}return t.enable(t.load()),t}p4.exports=vve});var d4=M((Ws,GD)=>{"use strict";function HD(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?HD=function(t){return typeof t}:HD=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},HD(r)}Ws.log=Ive;Ws.formatArgs=bve;Ws.save=Sve;Ws.load=xve;Ws.useColors=yve;Ws.storage=Cve();Ws.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function yve(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function bve(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+GD.exports.humanize(this.diff),!!this.useColors){var e="color: "+this.color;r.splice(1,0,e,"color: inherit");var t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,function(i){i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}}function Ive(){var r;return(typeof console>"u"?"undefined":HD(console))==="object"&&console.log&&(r=console).log.apply(r,arguments)}function Sve(r){try{r?Ws.storage.setItem("debug",r):Ws.storage.removeItem("debug")}catch{}}function xve(){var r;try{r=Ws.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function Cve(){try{return localStorage}catch{}}GD.exports=NF()(Ws);var wve=GD.exports.formatters;wve.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var f4=M((Mi,YD)=>{"use strict";var Eve=require("tty"),QD=require("util");Mi.init=Ave;Mi.log=Dve;Mi.formatArgs=kve;Mi.save=Tve;Mi.load=Rve;Mi.useColors=Pve;Mi.colors=[6,2,3,4,5,1];try{zD=JP(),zD&&(zD.stderr||zD).level>=2&&(Mi.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}var zD;Mi.inspectOpts=Object.keys(process.env).filter(function(r){return/^debug_/i.test(r)}).reduce(function(r,e){var t=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(i,o){return o.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function Pve(){return"colors"in Mi.inspectOpts?!!Mi.inspectOpts.colors:Eve.isatty(process.stderr.fd)}function kve(r){var e=this.namespace,t=this.useColors;if(t){var n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o="  ".concat(i,";1m").concat(e," \x1B[0m");r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+YD.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=_ve()+e+" "+r[0]}function _ve(){return Mi.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Dve(){return process.stderr.write(QD.format.apply(QD,arguments)+`
`)}function Tve(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function Rve(){return process.env.DEBUG}function Ave(r){r.inspectOpts={};for(var e=Object.keys(Mi.inspectOpts),t=0;t<e.length;t++)r.inspectOpts[e[t]]=Mi.inspectOpts[e[t]]}YD.exports=NF()(Mi);var m4=YD.exports.formatters;m4.o=function(r){return this.inspectOpts.colors=this.useColors,QD.inspect(r,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};m4.O=function(r){return this.inspectOpts.colors=this.useColors,QD.inspect(r,this.inspectOpts)}});var h4=M((Ptt,MF)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?MF.exports=d4():MF.exports=f4()});var b4=M((ktt,y4)=>{var IC=require("path"),g4=require("fs"),v4=parseInt("0777",8);y4.exports=Oy.mkdirp=Oy.mkdirP=Oy;function Oy(r,e,t,n){typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e});var i=e.mode,o=e.fs||g4;i===void 0&&(i=v4),n||(n=null);var s=t||function(){};r=IC.resolve(r),o.mkdir(r,i,function(a){if(!a)return n=n||r,s(null,n);switch(a.code){case"ENOENT":if(IC.dirname(r)===r)return s(a);Oy(IC.dirname(r),e,function(c,l){c?s(c,l):Oy(r,e,s,l)});break;default:o.stat(r,function(c,l){c||!l.isDirectory()?s(a,n):s(null,n)});break}})}Oy.sync=function r(e,t,n){(!t||typeof t!="object")&&(t={mode:t});var i=t.mode,o=t.fs||g4;i===void 0&&(i=v4),n||(n=null),e=IC.resolve(e);try{o.mkdirSync(e,i),n=n||e}catch(a){switch(a.code){case"ENOENT":n=r(IC.dirname(e),t,n),r(e,t,n);break;default:var s;try{s=o.statSync(e)}catch{throw a}if(!s.isDirectory())throw a;break}}return n}});var x4=M(Cr=>{"use strict";var I4=require("fs"),Nve=require("os"),Mve=require("net"),XD=require("path"),S4=u4(),FF=h4(),Ove=b4().mkdirp,OF=FF("portfinder:testPort"),SC=FF("portfinder:getPort"),Kve=FF("portfinder:defaultHosts"),KF={};KF.testPort=function(r,e){e||(e=r,r={}),r.server=r.server||Mve.createServer(function(){}),OF("entered testPort(): trying",r.host,"port",r.port);function t(){OF("done w/ testPort(): OK",r.host,"port",r.port),r.server.removeListener("error",n),r.server.close(),e(null,r.port)}function n(i){if(OF("done w/ testPort(): failed",r.host,"w/ port",r.port,"with error",i.code),r.server.removeListener("listening",t),!(i.code=="EADDRINUSE"||i.code=="EACCES"))return e(i);var o=Cr.nextPort(r.port);if(o>Cr.highestPort)return e(new Error("No open ports available"));KF.testPort({port:o,host:r.host,server:r.server},e)}r.server.once("error",n),r.server.once("listening",t),r.host?r.server.listen(r.port,r.host):r.server.listen(r.port)};Cr.basePort=8e3;Cr.highestPort=65535;Cr.basePath="/tmp/portfinder";Cr.getPort=function(r,e){if(e||(e=r,r={}),r.port=Number(r.port)||Number(Cr.basePort),r.host=r.host||null,r.stopPort=Number(r.stopPort)||Number(Cr.highestPort),!r.startPort){if(r.startPort=Number(r.port),r.startPort<0)throw Error("Provided options.startPort("+r.startPort+") is less than 0, which are cannot be bound.");if(r.stopPort<r.startPort)throw Error("Provided options.stopPort("+r.stopPort+"is less than options.startPort ("+r.startPort+")")}if(r.host){for(var t,n=0;n<Cr._defaultHosts.length;n++)if(Cr._defaultHosts[n]===r.host){t=!0;break}t||Cr._defaultHosts.push(r.host)}var i=[],o;return S4.eachSeries(Cr._defaultHosts,function(s,a){return SC("in eachSeries() iteration callback: host is",s),KF.testPort({host:s,port:r.port},function(c,l){return c?(SC("in eachSeries() iteration callback testPort() callback","with an err:",c.code),o=s,a(c)):(SC("in eachSeries() iteration callback testPort() callback","with a success for port",l),i.push(l),a())})},function(s){if(s)if(SC("in eachSeries() result callback: err is",s),s.code==="EADDRNOTAVAIL"||s.code==="EINVAL")if(r.host===o){var a="Provided host "+r.host+" could NOT be bound. Please provide a different host address or hostname";return e(Error(a))}else{var c=Cr._defaultHosts.indexOf(o);return Cr._defaultHosts.splice(c,1),Cr.getPort(r,e)}else return e(s);if(i.sort(function(l,u){return l-u}),SC("in eachSeries() result callback: openPorts is",i),i[0]===i[i.length-1]){if(i[0]<=r.stopPort)return e(null,i[0]);var a="No open ports found in between "+r.startPort+" and "+r.stopPort;return e(Error(a))}else return Cr.getPort({port:i.pop(),host:r.host,startPort:r.startPort,stopPort:r.stopPort},e)})};Cr.getPortPromise=function(r){if(typeof Promise!="function")throw Error("Native promise support is not available in this version of node.Please install a polyfill and assign Promise to global.Promise before calling this method");return r||(r={}),new Promise(function(e,t){Cr.getPort(r,function(n,i){if(n)return t(n);e(i)})})};Cr.getPorts=function(r,e,t){t||(t=e,e={});var n=null;S4.timesSeries(r,function(i,o){n&&(e.port=Cr.nextPort(n)),Cr.getPort(e,function(s,a){s?o(s):(n=a,o(null,a))})},t)};Cr.getSocket=function(r,e){e||(e=r,r={}),r.mod=r.mod||parseInt(755,8),r.path=r.path||Cr.basePath+".sock";function t(){I4.stat(r.path,function(o){o?o.code=="ENOENT"?e(null,r.path):e(o):(r.path=Cr.nextSocket(r.path),Cr.getSocket(r,e))})}function n(o){Ove(o,r.mod,function(s){if(s)return e(s);r.exists=!0,t()})}function i(){var o=XD.dirname(r.path);I4.stat(o,function(s,a){if(s||!a.isDirectory())return n(o);r.exists=!0,t()})}return r.exists?t():i()};Cr.nextPort=function(r){return r+1};Cr.nextSocket=function(r){var e=XD.dirname(r),t=XD.basename(r,".sock"),n=t.match(/^([a-zA-z]+)(\d*)$/i),i=parseInt(n[2]),o=n[1];return isNaN(i)&&(i=0),i+=1,XD.join(e,o+i+".sock")};Cr._defaultHosts=function(){var r={};try{r=Nve.networkInterfaces()}catch(c){if(c.syscall!=="uv_interface_addresses")throw c}for(var e=Object.keys(r),t="0.0.0.0",n=[t],i=0;i<e.length;i++)for(var o=r[e[i]],s=0;s<o.length;s++){var a=o[s];n.push(a.address)}return n.push(null),Kve("exports._defaultHosts is: %o",n),n}()});var D4=M(Ky=>{"use strict";Object.defineProperty(Ky,"__esModule",{value:!0});Ky.encode=Ky.decode=void 0;var P4=require("crypto"),UF="<IDS|MSG>",Fve=5;function rT(r){return JSON.parse(r.toString())}function k4(r){return Object.assign({},{header:{},parent_header:{},metadata:{},content:{},idents:[],buffers:[]},r)}function _4(r){let e=r;switch(r){case"hmac-sha256":e="sha256";break}return e}function Lve(r,e,t="sha256"){var n=0;let i=[];for(n=0;n<r.length;n++){var o=r[n];if(o.toString()===UF)break;i.push(o)}if(r.length-n<Fve)throw new Error("Message Decoding: Not enough message frames");if(r[n].toString()!==UF)throw new Error("Message Decoding: Missing delimiter");if(e){let u=_4(t);var s=r[n+1].toString(),a=P4.createHmac(u,e);a.update(r[n+2]),a.update(r[n+3]),a.update(r[n+4]),a.update(r[n+5]);var c=a.digest("hex");if(c!==s)throw new Error(`Message Decoding: Incorrect;
Obtained "${s}"
Expected "${c}"`)}var l=k4({idents:i,header:rT(r[n+2]),parent_header:rT(r[n+3]),content:rT(r[n+5]),metadata:rT(r[n+4]),buffers:Array.prototype.slice.apply(r,[n+6])});return l}Ky.decode=Lve;function Uve(r,e,t="sha256"){let n=k4(r),i=_4(t),o=n.idents,s=Buffer.from(JSON.stringify(n.header),"utf-8"),a=Buffer.from(JSON.stringify(n.parent_header),"utf-8"),c=Buffer.from(JSON.stringify(n.metadata),"utf-8"),l=Buffer.from(JSON.stringify(n.content),"utf-8"),u="";if(e){let m=P4.createHmac(i,e);m.update(s),m.update(a),m.update(c),m.update(l),u=m.digest("hex")}var p=o.concat([Buffer.from(UF),Buffer.from(u),s,a,c,l]).concat(n.buffers);return p}Ky.encode=Uve});var fG=M((Ypt,mG)=>{"use strict";var cye=(r,e={})=>{let t=e.safe===!0||e.keepProtected===!0,n=!1,i=(o,s)=>{let a="",c,l;for(let u of o.nodes)switch(u.type){case"block":if(e.first&&n===!0){a+=i(u,o);break}if(e.preserveNewlines===!0){c=i(u,o),l=c.split(`
`),a+=`
`.repeat(l.length-1);break}if(t===!0&&u.protected===!0){a+=i(u,o);break}n=!0;break;case"line":if(e.first&&n===!0){a+=u.value;break}t===!0&&u.protected===!0&&(a+=u.value),n=!0;break;case"open":case"close":case"text":case"newline":default:{a+=u.value||"";break}}return a};return i(r)};mG.exports=cye});var gG=M((Xpt,hG)=>{"use strict";var KT=class{constructor(e){this.type=e.type,e.value&&(this.value=e.value),e.match&&(this.match=e.match),this.newline=e.newline||""}get protected(){return!!this.match&&this.match[1]==="!"}},QF=class extends KT{constructor(e){super(e),this.nodes=e.nodes||[]}push(e){this.nodes.push(e)}get protected(){return this.nodes.length>0&&this.nodes[0].protected===!0}};hG.exports={Node:KT,Block:QF}});var yG=M(vG=>{"use strict";vG.javascript={BLOCK_OPEN_REGEX:/^\/\*\*?(!?)/,BLOCK_CLOSE_REGEX:/^\*\/(\n?)/,LINE_REGEX:/^\/\/(!?).*/}});var SG=M((edt,IG)=>{"use strict";var{Node:vd,Block:bG}=gG(),lye=yG(),YF={ESCAPED_CHAR_REGEX:/^\\./,QUOTED_STRING_REGEX:/^(['"`])((?:\\.|[^\1])+?)(\1)/,NEWLINE_REGEX:/^\r*\n/},uye=(r,e={})=>{if(typeof r!="string")throw new TypeError("Expected input to be a string");let t=new bG({type:"root",nodes:[]}),n=[t],i=(e.language||"javascript").toLowerCase(),o=lye[i];if(typeof o>"u")throw new Error(`Language "${i}" is not supported by strip-comments`);let{LINE_REGEX:s,BLOCK_OPEN_REGEX:a,BLOCK_CLOSE_REGEX:c}=o,l=t,u=r,p,m,h=[a,c].filter(Boolean),g=!1;h.every(D=>D.source==='^"""')&&(g=!0);let b=(D=u[0]||"")=>(u=u.slice(D.length),D),w=(D,V="text")=>{let oe=D.exec(u);if(oe)return b(oe[0]),{type:V,value:oe[0],match:oe}},k=D=>{if(m&&m.type==="text"&&D.type==="text"){m.value+=D.value;return}l.push(D),D.nodes&&(n.push(D),l=D),m=D},N=()=>{if(l.type==="root")throw new SyntaxError("Unclosed block comment");n.pop(),l=n[n.length-1]};for(;u!=="";){if(p=w(YF.ESCAPED_CHAR_REGEX,"text")){k(new vd(p));continue}if(l.type!=="block"&&(!m||!/\w$/.test(m.value))&&!(g&&u.startsWith('"""'))&&(p=w(YF.QUOTED_STRING_REGEX,"text"))){k(new vd(p));continue}if(p=w(YF.NEWLINE_REGEX,"newline")){k(new vd(p));continue}if(a&&e.block&&!(g&&l.type==="block")&&(p=w(a,"open"))){k(new bG({type:"block"})),k(new vd(p));continue}if(c&&l.type==="block"&&e.block&&(p=w(c,"close"))){p.newline=p.match[1]||"",k(new vd(p)),N();continue}if(s&&l.type!=="block"&&e.line&&(p=w(s,"line"))){k(new vd(p));continue}if(p=w(/^[a-zABD-Z0-9\t ]+/,"text")){k(new vd(p));continue}k(new vd({type:"text",value:b(u[0])}))}return t};IG.exports=uye});var CG=M((tdt,xG)=>{"use strict";var FT=fG(),DC=SG(),LT=xG.exports=(r,e)=>{let t={...e,block:!0,line:!0};return FT(DC(r,t),t)};LT.block=(r,e)=>{let t={...e,block:!0};return FT(DC(r,t),t)};LT.line=(r,e)=>{let t={...e,line:!0};return FT(DC(r,t),t)};LT.first=(r,e)=>{let t={...e,block:!0,line:!0,first:!0};return FT(DC(r,t),t)};LT.parse=DC});var dz=M((TDt,pz)=>{var jye=typeof global=="object"&&global&&global.Object===Object&&global;pz.exports=jye});var fz=M((RDt,mz)=>{var Wye=dz(),Vye=typeof self=="object"&&self&&self.Object===Object&&self,Bye=Wye||Vye||Function("return this")();mz.exports=Bye});var R0=M((ADt,hz)=>{var qye=fz(),Jye=qye.Symbol;hz.exports=Jye});var vz=M((NDt,gz)=>{function $ye(r,e){for(var t=-1,n=r==null?0:r.length,i=Array(n);++t<n;)i[t]=e(r[t],t,r);return i}gz.exports=$ye});var bz=M((MDt,yz)=>{var Hye=Array.isArray;yz.exports=Hye});var Cz=M((ODt,xz)=>{var Iz=R0(),Sz=Object.prototype,Gye=Sz.hasOwnProperty,zye=Sz.toString,HC=Iz?Iz.toStringTag:void 0;function Qye(r){var e=Gye.call(r,HC),t=r[HC];try{r[HC]=void 0;var n=!0}catch{}var i=zye.call(r);return n&&(e?r[HC]=t:delete r[HC]),i}xz.exports=Qye});var Ez=M((KDt,wz)=>{var Yye=Object.prototype,Xye=Yye.toString;function Zye(r){return Xye.call(r)}wz.exports=Zye});var Dz=M((FDt,_z)=>{var Pz=R0(),ebe=Cz(),tbe=Ez(),rbe="[object Null]",nbe="[object Undefined]",kz=Pz?Pz.toStringTag:void 0;function ibe(r){return r==null?r===void 0?nbe:rbe:kz&&kz in Object(r)?ebe(r):tbe(r)}_z.exports=ibe});var Rz=M((LDt,Tz)=>{function obe(r){return r!=null&&typeof r=="object"}Tz.exports=obe});var Nz=M((UDt,Az)=>{var sbe=Dz(),abe=Rz(),cbe="[object Symbol]";function lbe(r){return typeof r=="symbol"||abe(r)&&sbe(r)==cbe}Az.exports=lbe});var Uz=M((jDt,Lz)=>{var Mz=R0(),ube=vz(),pbe=bz(),dbe=Nz(),mbe=1/0,Oz=Mz?Mz.prototype:void 0,Kz=Oz?Oz.toString:void 0;function Fz(r){if(typeof r=="string")return r;if(pbe(r))return ube(r,Fz)+"";if(dbe(r))return Kz?Kz.call(r):"";var e=r+"";return e=="0"&&1/r==-mbe?"-0":e}Lz.exports=Fz});var Wz=M((WDt,jz)=>{var fbe=Uz();function hbe(r){return r==null?"":fbe(r)}jz.exports=hbe});var qz=M((VDt,Bz)=>{var gbe=Wz(),Vz=/[\\^$.*+?()[\]{}|]/g,vbe=RegExp(Vz.source);function ybe(r){return r=gbe(r),r&&vbe.test(r)?r.replace(Vz,"\\$&"):r}Bz.exports=ybe});var AL=M((CVt,jQ)=>{jQ.exports=require("util").format});var mIe={};uj(mIe,{activate:()=>eIe,deactivate:()=>tIe});module.exports=dj(mIe);Reflect.metadata===void 0&&fj();function Lu(){try{return(gj(),dj(hj)).isPreRelesVersionOfJupyterExtension===!0?"true":"false"}catch{return"true"}}var fS={isExiting:!1},Ew="_builtin.JupyterServerSelectorForTesting",jR="_builtin.jupyterServerUrlProvider";var vj=!1;function yj(r){vj=r}function zd(){return vj}var bj=!1;function Ij(r){bj=r}function Br(){return bj}var xe="python",hS="markdown",_l="vscode-notebook-cell",sY={scheme:"untitled",language:xe},aY={scheme:"file",language:xe},Pw={language:xe},cY={scheme:_l,language:xe},Sj=[sY,aY,cY],kw="vscode-interactive-input",bt="jupyter-notebook",gt="interactive";var Ba="GitHub.codespaces",It="ms-toolsai.jupyter",ah="ms-toolsai.jupyter-hub",xj="0c6ae279ed8443289764825290e4f9e2-1a736e7c-1324-4338-be46-fc2a58ae4d14-7255",Uu="STANDARD_OUTPUT_CHANNEL",gS;(t=>(t.PythonInteractiveHelpLink="https://aka.ms/pyaiinstall",t.JupyterDataRateHelpLink="https://aka.ms/AA5ggm0"))(gS||={});var Li;(i=>(i.JupyterServerRemoteLaunchNameSeparator=`
`,i.JupyterServerRemoteLaunchService=It,i.JupyterServerUriListMax=10,i.IntellisenseTimeout=2e3))(Li||={});var Zn=!1;var lY=!1;function Tr(){return lY||vS()}var uY=!1;function vS(){return uY}var Ge;(b=>(b.GeneratedThemeName="ipython-theme",b.MatplotLibDefaultParams="_VSCode_defaultMatplotlib_Params",b.MatplotLibFigureFormats="_VSCode_matplotLib_FigureFormats",b.DefaultCodeCellMarker="# %%",b.DefaultCommTarget="jupyter.widget",b.ALL_VARIABLES="ALL_VARIABLES",b.KERNEL_VARIABLES="KERNEL_VARIABLES",b.DEBUGGER_VARIABLES="DEBUGGER_VARIABLES",b.PYTHON_VARIABLES_REQUESTER="PYTHON_VARIABLES_REQUESTER",b.MULTIPLEXING_DEBUGSERVICE="MULTIPLEXING_DEBUGSERVICE",b.RUN_BY_LINE_DEBUGSERVICE="RUN_BY_LINE_DEBUGSERVICE",b.REMOTE_URI="https://remote/",b.REMOTE_URI_ID_PARAM="id",b.REMOTE_URI_HANDLE_PARAM="uriHandle",b.REMOTE_URI_EXTENSION_ID_PARAM="extensionId"))(Ge||={});var qa;(i=>(i.ImportIPython=`{0}
from IPython import get_ipython

{1}`,i.MatplotLibInit=`import matplotlib
%matplotlib inline
${Ge.MatplotLibDefaultParams} = dict(matplotlib.rcParams)
`,i.UpdateCWDAndPath=`import os as _VSCODE_os
import sys as _VSCODE_sys
%cd "{0}"
if _VSCODE_os.getcwd() not in _VSCODE_sys.path:
    _VSCODE_sys.path.insert(0, _VSCODE_os.getcwd())

del _VSCODE_sys
del _VSCODE_os`,i.DisableJedi="%config Completer.use_jedi = False"))(qa||={});var ch="JUPYTER_OUTPUT_CHANNEL",WR="Default Light+",ei="ms-python.python",lh="ms-toolsai.jupyter-renderers",Qd="ms-python.vscode-pylance",Cj=["python","html","xml","javascript","markdown","latex","shellscript","bat","powershell","kusto","ruby","sql","perl","qsharp","raw"],wj=new Map([["bash","shellscript"],["c#","csharp"],["f#","fsharp"],["q#","qsharp"],["c++11","c++"],["c++12","c++"],["c++14","c++"]]),yS=["python","r","julia","c++","c#","f#","q#","powershell","java","scala","haskell","bash","cling","rust","sas","sos","ocaml"];var $;(Ce=>(Ce.RunAllCells="jupyter.runallcells",Ce.RunAllCellsAbove="jupyter.runallcellsabove",Ce.RunCellAndAllBelow="jupyter.runcellandallbelow",Ce.RunAllCellsAbovePalette="jupyter.runallcellsabove.palette",Ce.RunCellAndAllBelowPalette="jupyter.runcurrentcellandallbelow.palette",Ce.RunToLine="jupyter.runtoline",Ce.RunFromLine="jupyter.runfromline",Ce.RunCell="jupyter.runcell",Ce.RunCurrentCell="jupyter.runcurrentcell",Ce.RunCurrentCellAdvance="jupyter.runcurrentcelladvance",Ce.CreateNewInteractive="jupyter.createnewinteractive",Ce.ImportNotebook="jupyter.importnotebook",Ce.ImportNotebookFile="jupyter.importnotebookfile",Ce.ExportFileAsNotebook="jupyter.exportfileasnotebook",Ce.ExportFileAndOutputAsNotebook="jupyter.exportfileandoutputasnotebook",Ce.InterruptKernel="jupyter.interruptkernel",Ce.RestartKernel="jupyter.restartkernel",Ce.RestartKernelAndRunAllCells="jupyter.restartkernelandrunallcells",Ce.RestartKernelAndRunUpToSelectedCell="jupyter.restartkernelandrunuptoselectedcell",Ce.NotebookEditorRemoveAllCells="jupyter.notebookeditor.removeallcells",Ce.NotebookEditorRunAllCells="jupyter.notebookeditor.runallcells",Ce.NotebookEditorRunSelectedCell="jupyter.notebookeditor.runselectedcell",Ce.NotebookEditorAddCellBelow="jupyter.notebookeditor.addcellbelow",Ce.ExpandAllCells="jupyter.expandallcells",Ce.CollapseAllCells="jupyter.collapseallcells",Ce.ExportOutputAsNotebook="jupyter.exportoutputasnotebook",Ce.ExecSelectionInInteractiveWindow="jupyter.execSelectionInteractive",Ce.RunFileInInteractiveWindows="jupyter.runFileInteractive",Ce.DebugFileInInteractiveWindows="jupyter.debugFileInteractive",Ce.AddCellBelow="jupyter.addcellbelow",Ce.DebugCurrentCellPalette="jupyter.debugcurrentcell.palette",Ce.DebugCell="jupyter.debugcell",Ce.DebugStepOver="jupyter.debugstepover",Ce.DebugContinue="jupyter.debugcontinue",Ce.DebugStop="jupyter.debugstop",Ce.RunCurrentCellAndAddBelow="jupyter.runcurrentcellandaddbelow",Ce.InsertCellBelowPosition="jupyter.insertCellBelowPosition",Ce.InsertCellBelow="jupyter.insertCellBelow",Ce.InsertCellAbove="jupyter.insertCellAbove",Ce.DeleteCells="jupyter.deleteCells",Ce.SelectCell="jupyter.selectCell",Ce.SelectCellContents="jupyter.selectCellContents",Ce.ExtendSelectionByCellAbove="jupyter.extendSelectionByCellAbove",Ce.ExtendSelectionByCellBelow="jupyter.extendSelectionByCellBelow",Ce.MoveCellsUp="jupyter.moveCellsUp",Ce.MoveCellsDown="jupyter.moveCellsDown",Ce.ChangeCellToMarkdown="jupyter.changeCellToMarkdown",Ce.ChangeCellToCode="jupyter.changeCellToCode",Ce.GotoNextCellInFile="jupyter.gotoNextCellInFile",Ce.GotoPrevCellInFile="jupyter.gotoPrevCellInFile",Ce.ScrollToCell="jupyter.scrolltocell",Ce.CreateNewNotebook="jupyter.createnewnotebook",Ce.ViewJupyterOutput="jupyter.viewOutput",Ce.ExportAsPythonScript="jupyter.exportAsPythonScript",Ce.ExportToHTML="jupyter.exportToHTML",Ce.ExportToPDF="jupyter.exportToPDF",Ce.Export="jupyter.export",Ce.NativeNotebookExport="jupyter.notebookeditor.export",Ce.LatestExtension="jupyter.latestExtension",Ce.EnableLoadingWidgetsFrom3rdPartySource="jupyter.enableLoadingWidgetScriptsFromThirdPartySource",Ce.NotebookEditorExpandAllCells="jupyter.notebookeditor.expandallcells",Ce.NotebookEditorCollapseAllCells="jupyter.notebookeditor.collapseallcells",Ce.EnableDebugLogging="jupyter.enableDebugLogging",Ce.ResetLoggingLevel="jupyter.resetLoggingLevel",Ce.ShowDataViewer="jupyter.showDataViewer",Ce.RefreshDataViewer="jupyter.refreshDataViewer",Ce.ClearSavedJupyterUris="jupyter.clearSavedJupyterUris",Ce.OpenVariableView="jupyter.openVariableView",Ce.OpenOutlineView="jupyter.openOutlineView",Ce.InteractiveClearAll="jupyter.interactive.clearAllCells",Ce.InteractiveGoToCode="jupyter.interactive.goToCode",Ce.InteractiveCopyCell="jupyter.interactive.copyCell",Ce.InteractiveExportAsNotebook="jupyter.interactive.exportasnotebook",Ce.InteractiveExportAs="jupyter.interactive.exportas",Ce.RunByLine="jupyter.runByLine",Ce.RunAndDebugCell="jupyter.runAndDebugCell",Ce.RunByLineNext="jupyter.runByLineNext",Ce.RunByLineStop="jupyter.runByLineStop",Ce.ReplayPylanceLog="jupyter.replayPylanceLog",Ce.ReplayPylanceLogStep="jupyter.replayPylanceLogStep",Ce.InstallPythonExtensionViaKernelPicker="jupyter.installPythonExtensionViaKernelPicker",Ce.InstallPythonViaKernelPicker="jupyter.installPythonViaKernelPicker",Ce.ContinueEditSessionInCodespace="jupyter.continueEditSessionInCodespace"))($||={});var ju;(n=>(n.DefaultDesignLenses=[$.RunCurrentCell,$.RunAllCellsAbove,$.DebugCell],n.DefaultDebuggingLenses=[$.DebugContinue,$.DebugStop,$.DebugStepOver],n.DebuggerCommands=[$.DebugContinue,$.DebugStop,$.DebugStepOver]))(ju||={});var Ir;(de=>(de.HasCodeCells="jupyter.hascodecells",de.IsInteractiveActive="jupyter.isinteractiveactive",de.OwnsSelection="jupyter.ownsSelection",de.HaveNativeCells="jupyter.havenativecells",de.HaveNative="jupyter.havenative",de.IsNativeActive="jupyter.isnativeactive",de.IsInteractiveOrNativeActive="jupyter.isinteractiveornativeactive",de.IsPythonOrNativeActive="jupyter.ispythonornativeactive",de.IsPythonOrInteractiveActive="jupyter.ispythonorinteractiveeactive",de.IsPythonOrInteractiveOrNativeActive="jupyter.ispythonorinteractiveornativeeactive",de.CanRestartNotebookKernel="jupyter.notebookeditor.canrestartNotebookkernel",de.CanInterruptNotebookKernel="jupyter.notebookeditor.canInterruptNotebookKernel",de.CanRestartInteractiveWindowKernel="jupyter.interactive.canRestartNotebookKernel",de.CanInterruptInteractiveWindowKernel="jupyter.interactive.canInterruptNotebookKernel",de.RunByLineCells="jupyter.notebookeditor.runByLineCells",de.RunByLineDocuments="jupyter.notebookeditor.runByLineDocuments",de.DebugDocuments="jupyter.notebookeditor.debugDocuments",de.IsPythonNotebook="jupyter.ispythonnotebook",de.IsJupyterKernelSelected="jupyter.kernel.isjupyter",de.IsDataViewerActive="jupyter.dataViewerActive",de.HasNativeNotebookOrInteractiveWindowOpen="jupyter.hasNativeNotebookOrInteractiveWindowOpen",de.ZmqAvailable="jupyter.zmqavailable",de.ReplayLogLoaded="jupyter.replayLogLoaded",de.KernelSource="jupyter.kernelSource"))(Ir||={});var Yd;(c=>(c.PythonCellMarker=/^(#\s*%%|#\s*\<codecell\>|#\s*In\[\d*?\]|#\s*In\[ \])/,c.PythonMarkdownCellMarker=/^(#\s*%%\s*\[markdown\]|#\s*\<markdowncell\>)/,c.UrlPatternRegEx="(?<PREFIX>https?:\\/\\/)((\\(.+\\s+or\\s+(?<IP>.+)\\))|(?<LOCAL>[^\\s]+))(?<REST>:.+)",c.HttpPattern=/https?:\/\//,c.ShapeSplitterRegEx=/.*,\s*(\d+).*/,c.SvgHeightRegex=/(\<svg.*height=\")(.*?)\"/,c.SvgWidthRegex=/(\<svg.*width=\")(.*?)\"/,c.SvgSizeTagRegex=/\<svg.*tag=\"sizeTag=\{(.*),\s*(.*)\}\"/))(Yd||={});var Ej=Symbol("DataScienceStartupTime"),VR={major:4,minor:2},Ui="application/vnd.jupyter.widget-view+json";var bS=7,IS="unknown";var xS=class{constructor(e,t){this._data=t;this.expiryTime=e+Date.now()}get expired(){let e=this.expiryTime<=Date.now();return e&&(this._data=void 0),e}get data(){return this.expired&&(this._data=void 0),this._data}},SS=new Map;function Pj(){return SS}function kj(r,e){let t=e.map(n=>`${JSON.stringify(n)}`).join("-Arg-Separator-");return`KeyPrefix=${r}-Args=${t}`}var Xd=class{constructor(e,t=""){this.expiryDurationMs=e;this.cacheKey=t}get hasData(){let e=SS.get(this.cacheKey);return!!(e&&!e.expired)}get data(){return this.hasData?SS.get(this.cacheKey)?.data:void 0}set data(e){let t=new xS(this.expiryDurationMs,e);SS.set(this.cacheKey,t)}clear(){SS.delete(this.cacheKey)}};async function ji(r){return new Promise(e=>{setTimeout(()=>e(r),r)})}async function Dw(r,e,t){return new Promise(n=>{let i,o=setTimeout(()=>i(!1),e),s=setInterval(()=>{r().then(a=>{a&&i(!0)}).catch(a=>i(!1))},t);i=a=>{clearTimeout(o),clearInterval(s),n(a)}})}function pr(r,e,...t){let n=_w(e)?void 0:e;_w(e)&&t.push(e);let i,o=setTimeout(()=>i?.(n),r);return Promise.race([Promise.race(t).finally(()=>clearTimeout(o)),new Promise(s=>i=s)])}function Tw(r,e,...t){let n,i=setTimeout(()=>n?.(e),r);return Promise.race([Promise.race(t).finally(()=>clearTimeout(i)),new Promise((o,s)=>n=s)])}function Zd(r){return typeof r?.then=="function"&&typeof r?.catch=="function"}function _w(r){return typeof r?.then=="function"}var BR=class{constructor(e=null){this.scope=e;this._resolved=!1;this._rejected=!1;this._promise=new Promise((t,n)=>{this._resolve=t,this._reject=n})}get value(){return this._value}resolve(e){this._value=e,this._resolve.apply(this.scope?this.scope:this,arguments),this._resolved=!0}reject(e){this._reject.apply(this.scope?this.scope:this,arguments),this._rejected=!0}get promise(){return this._promise}get resolved(){return this._resolved}get rejected(){return this._rejected}get completed(){return this._rejected||this._resolved}};function ue(r=null){return new BR(r)}function ds(r){let e=ue();return r.then(e.resolve.bind(e)).catch(e.reject.bind(e)),e}var uh=class{constructor(){this.currentPromise=Promise.resolve(void 0)}async chain(e){let t=ue(),n=this.currentPromise;return this.currentPromise=this.currentPromise.then(async()=>{try{let i=await e();t.resolve(i)}catch(i){throw t.reject(i),i}}),await n,t.promise}chainFinally(e){let t=ue();return this.currentPromise=this.currentPromise.finally(()=>e().then(n=>t.resolve(n)).catch(n=>t.reject(n))),t.promise}};var qe=class{constructor(){this.started=Date.now()}get elapsedTime(){return Date.now()-this.started}reset(){this.started=Date.now()}};function f(){}function An(r){try{let e=r();Zd(e)&&e.catch(f)}catch{}}function qR(r,e,t){let n=new qe;try{t&&r(void 0);let i=e();return Zd(i)?i.then(o=>(r({elapsed:n.elapsedTime,returnValue:o}),o)).catch(o=>{r({elapsed:n.elapsedTime,err:o})}):r({elapsed:n.elapsedTime,returnValue:i}),i}catch(i){throw r({elapsed:n.elapsedTime,err:i}),i}}function Wu(r){if(!r)return!0;let e=r;return typeof e.path=="string"&&typeof e.scheme=="string"}function Vn(r){if(!r)return!1;let e=r;return typeof e.path=="string"&&typeof e.scheme=="string"}function Dj(r){let e=Vn(r)?r:r.uri;return e.scheme.includes(_l)||e.path.endsWith(".interactive")}function Vu(){return process.platform.toString()==="web"}function _j(r,e){return Vn(e)?e.toString():e}function Ao(r,e){return r===e?!0:r&&!e||!r&&e?!1:JSON.stringify(r,_j)===JSON.stringify(e,_j)}var Tj=Pj();function JR(r){return function(e,t,n){let i=n.value,s=`Cache_Method_Output_${"constructor"in e&&e.constructor.name?e.constructor.name:""}.${t}`;n.value=async function(...a){if(Tr())return i.apply(this,a);let c=kj(s,a),l=Tj.get(c);if(l&&!l.expired)return E(`Cached data exists ${c}`),Promise.resolve(l.data);let u=i.apply(this,a);return u.then(p=>Tj.set(c,new xS(r,p))).catch(f),u}}}function Mr(r){return function(e,t,n){let i=n.value,o=`Jupyter Extension (Error in ${r||t}, method:${t}):`;n.value=function(...s){try{let a=i.apply(this,s);if(a&&typeof a.then=="function"&&typeof a.catch=="function")return a.catch(c=>{Tr()||x(o,c)})}catch(a){if(Tr())return;x(o,a)}}}}function Rj(r,e){return function(t,n,i){let o=i.value;return i.value=function(...s){let a={kind:"Class",name:t&&t.constructor?t.constructor.name:"",args:s,methodName:n,target:t},c=this;return qR(l=>r(a,l),()=>o.apply(c,s),e)},i}}function ph(){return function(r,e,t){let n=t.value;return t.value=function(...i){if(!Tr())throw new Error(`Function: ${e} can only be called from test code`);return n.apply(this,i)},t}}function $R(){return function(r,e,t){let n=t.value,i=`chainedPromiseFor_${e}`;return t.value=async function(...o){let s=this[i];s?s=s.then(()=>n.apply(this,o)):s=n.apply(this,o),this[i]=s;let a=s.then(c=>c).catch(c=>{throw this[i]=void 0,c});return a.catch(f),a},t}}function HR(r,e){if(Array.isArray(r))return r.map(t=>HR(t,e)).join(", ");if(r===void 0)return"undefined";if(r===null)return"null";try{return r&&r.path?`<Uri:${r.path}>`:JSON.stringify(r)}catch{return`<${e} cannot be serialized for logging>`}}function GR(r){if(!r)return"";try{return r.map((t,n)=>{let i=HR(t,"argument");return`Arg ${n+1}: ${i}`}).join(", ")}catch{return""}}function Aj(r){return`Return Value: ${HR(r,"Return value")}`}function Rw(){let r=new Date,e=String(r.getHours()).padStart(2,"0"),t=String(r.getMinutes()).padStart(2,"0"),n=String(r.getSeconds()).padStart(2,"0"),i=String(r.getMilliseconds()).padStart(3,"0");return`${e}:${t}:${n}.${i}`}function Fe(r,e={removeEmptyEntries:!0,trim:!0}){r=r||"";let t=r.split(/\r?\n/g);return e&&e.trim&&(t=t.map(n=>n.trim())),e&&e.removeEmptyEntries&&(t=t.filter(n=>n.length>0)),t}function CS(r){return r&&(r.indexOf(" ")>=0&&!r.startsWith('"')&&!r.endsWith('"')?`"${r}"`:r.toString())}function wS(r){return r&&CS(r).replace(/\\/g,"/")}function em(r){return r&&r.replace(/(^['"])|(['"]$)/g,"")}function Ja(r,...e){return r.replace(/{(\d+)}/g,(t,n)=>e[n]===void 0?t:e[n])}function dh(r){return r?r.replace(/\$\([a-z0-9\-]+?\)/gi,"").trim():r||""}function mh(r){let e=r.split(`
`),t=e.find(n=>n.trim().length>0&&!n.trim().startsWith("#"));if(t){let n=t.match(/^\s*/)[0];return e.map(i=>i.startsWith(n)?i.replace(n,""):i).join(`
`)}return r}var rA=require("vscode");var Nw="en",Ow=!1,Kw=!1,ES=!1,pY=!1,dY=!1,QR=!1,mY=!1,fY=!1,hY=!1,Aw,Mw=Nw,gY,qu,ms=typeof self=="object"?self:typeof global=="object"?global:{},ro;typeof ms.vscode<"u"&&typeof ms.vscode.process<"u"?ro=ms.vscode.process:typeof process<"u"&&(ro=process);var Nj=typeof ro?.versions?.electron=="string",Mj=Nj&&ro?.type==="renderer",KIe=Mj&&ro?.sandboxed;if(typeof navigator=="object"&&!Mj)qu=navigator.userAgent,Ow=qu.indexOf("Windows")>=0,Kw=qu.indexOf("Macintosh")>=0,fY=(qu.indexOf("Macintosh")>=0||qu.indexOf("iPad")>=0||qu.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,ES=qu.indexOf("Linux")>=0,QR=!0,Aw=navigator.language,Mw=Aw;else if(typeof ro=="object"){Ow=ro.platform==="win32",Kw=ro.platform==="darwin",ES=ro.platform==="linux",pY=ES&&!!ro.env.SNAP&&!!ro.env.SNAP_REVISION,mY=Nj,hY=!!ro.env.CI||!!ro.env.BUILD_ARTIFACTSTAGINGDIRECTORY,Aw=Nw,Mw=Nw;let r=ro.env.VSCODE_NLS_CONFIG;if(r)try{let e=JSON.parse(r),t=e.availableLanguages["*"];Aw=e.locale,Mw=t||Nw,gY=e._translationsConfigFile}catch{}dY=!0}else console.error("Unable to resolve platform.");var zR=0;Kw?zR=1:Ow?zR=3:ES&&(zR=2);var PS=Ow,Oj=Kw,Kj=ES;var Fw=QR,FIe=QR&&typeof ms.importScripts=="function";var $a=qu,Bu=Mw,vY;(n=>{function r(){return Bu}n.value=r;function e(){return Bu.length===2?Bu==="en":Bu.length>=3?Bu[0]==="e"&&Bu[1]==="n"&&Bu[2]==="-":!1}n.isDefaultVariant=e;function t(){return Bu==="en"}n.isDefault=t})(vY||={});var LIe=(()=>{if(typeof ms.postMessage=="function"&&!ms.importScripts){let r=[];ms.addEventListener("message",t=>{if(t.data&&t.data.vscodeScheduleAsyncWork)for(let n=0,i=r.length;n<i;n++){let o=r[n];if(o.id===t.data.vscodeScheduleAsyncWork){r.splice(n,1),o.callback();return}}});let e=0;return t=>{let n=++e;r.push({id:n,callback:t}),ms.postMessage({vscodeScheduleAsyncWork:n},"*")}}return r=>setTimeout(r)})();var yY=!!($a&&$a.indexOf("Chrome")>=0),UIe=!!($a&&$a.indexOf("Firefox")>=0),jIe=!!(!yY&&$a&&$a.indexOf("Safari")>=0),WIe=!!($a&&$a.indexOf("Edg/")>=0),VIe=!!($a&&$a.indexOf("Android")>=0);var tm;if(typeof ms.vscode<"u"&&typeof ms.vscode.process<"u"){let r=ms.vscode.process;tm={get platform(){return r.platform},get arch(){return r.arch},get env(){return r.env},cwd(){return r.cwd()}}}else typeof process<"u"?tm={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:tm={get platform(){return PS?"win32":Oj?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};var Lw=tm.cwd,Fj=tm.env,no=tm.platform,$Ie=tm.arch;var IY=65,SY=97,xY=90,CY=122,Hu=46,Bn=47,io=92,Ju=58,wY=63,Uw=class extends Error{constructor(t,n,i){let o;typeof n=="string"&&n.indexOf("not ")===0?(o="must not be",n=n.replace(/^not /,"")):o="must be";let s=t.indexOf(".")!==-1?"property":"argument",a=`The "${t}" ${s} ${o} of type ${n}`;a+=`. Received type ${typeof i}`;super(a);this.code="ERR_INVALID_ARG_TYPE"}};function mn(r,e){if(typeof r!="string")throw new Uw(e,"string",r)}function Kt(r){return r===Bn||r===io}function YR(r){return r===Bn}function $u(r){return r>=IY&&r<=xY||r>=SY&&r<=CY}function jw(r,e,t,n){let i="",o=0,s=-1,a=0,c=0;for(let l=0;l<=r.length;++l){if(l<r.length)c=r.charCodeAt(l);else{if(n(c))break;c=Bn}if(n(c)){if(!(s===l-1||a===1))if(a===2){if(i.length<2||o!==2||i.charCodeAt(i.length-1)!==Hu||i.charCodeAt(i.length-2)!==Hu){if(i.length>2){let u=i.lastIndexOf(t);u===-1?(i="",o=0):(i=i.slice(0,u),o=i.length-1-i.lastIndexOf(t)),s=l,a=0;continue}else if(i.length!==0){i="",o=0,s=l,a=0;continue}}e&&(i+=i.length>0?`${t}..`:"..",o=2)}else i.length>0?i+=`${t}${r.slice(s+1,l)}`:i=r.slice(s+1,l),o=l-s-1;s=l,a=0}else c===Hu&&a!==-1?++a:a=-1}return i}function Lj(r,e){if(e===null||typeof e!="object")throw new Uw("pathObject","Object",e);let t=e.dir||e.root,n=e.base||`${e.name||""}${e.ext||""}`;return t?t===e.root?`${t}${n}`:`${t}${r}${n}`:n}var xn={resolve(...r){let e="",t="",n=!1;for(let i=r.length-1;i>=-1;i--){let o;if(i>=0){if(o=r[i],mn(o,"path"),o.length===0)continue}else e.length===0?o=Lw():(o=Fj[`=${e}`]||Lw(),(o===void 0||o.slice(0,2).toLowerCase()!==e.toLowerCase()&&o.charCodeAt(2)===io)&&(o=`${e}\\`));let s=o.length,a=0,c="",l=!1,u=o.charCodeAt(0);if(s===1)Kt(u)&&(a=1,l=!0);else if(Kt(u))if(l=!0,Kt(o.charCodeAt(1))){let p=2,m=p;for(;p<s&&!Kt(o.charCodeAt(p));)p++;if(p<s&&p!==m){let h=o.slice(m,p);for(m=p;p<s&&Kt(o.charCodeAt(p));)p++;if(p<s&&p!==m){for(m=p;p<s&&!Kt(o.charCodeAt(p));)p++;(p===s||p!==m)&&(c=`\\\\${h}\\${o.slice(m,p)}`,a=p)}}}else a=1;else $u(u)&&o.charCodeAt(1)===Ju&&(c=o.slice(0,2),a=2,s>2&&Kt(o.charCodeAt(2))&&(l=!0,a=3));if(c.length>0)if(e.length>0){if(c.toLowerCase()!==e.toLowerCase())continue}else e=c;if(n){if(e.length>0)break}else if(t=`${o.slice(a)}\\${t}`,n=l,l&&e.length>0)break}return t=jw(t,!n,"\\",Kt),n?`${e}\\${t}`:`${e}${t}`||"."},normalize(r){mn(r,"path");let e=r.length;if(e===0)return".";let t=0,n,i=!1,o=r.charCodeAt(0);if(e===1)return YR(o)?"\\":r;if(Kt(o))if(i=!0,Kt(r.charCodeAt(1))){let a=2,c=a;for(;a<e&&!Kt(r.charCodeAt(a));)a++;if(a<e&&a!==c){let l=r.slice(c,a);for(c=a;a<e&&Kt(r.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&!Kt(r.charCodeAt(a));)a++;if(a===e)return`\\\\${l}\\${r.slice(c)}\\`;a!==c&&(n=`\\\\${l}\\${r.slice(c,a)}`,t=a)}}}else t=1;else $u(o)&&r.charCodeAt(1)===Ju&&(n=r.slice(0,2),t=2,e>2&&Kt(r.charCodeAt(2))&&(i=!0,t=3));let s=t<e?jw(r.slice(t),!i,"\\",Kt):"";return s.length===0&&!i&&(s="."),s.length>0&&Kt(r.charCodeAt(e-1))&&(s+="\\"),n===void 0?i?`\\${s}`:s:i?`${n}\\${s}`:`${n}${s}`},isAbsolute(r){mn(r,"path");let e=r.length;if(e===0)return!1;let t=r.charCodeAt(0);return Kt(t)||e>2&&$u(t)&&r.charCodeAt(1)===Ju&&Kt(r.charCodeAt(2))},join(...r){if(r.length===0)return".";let e,t;for(let o=0;o<r.length;++o){let s=r[o];mn(s,"path"),s.length>0&&(e===void 0?e=t=s:e+=`\\${s}`)}if(e===void 0)return".";let n=!0,i=0;if(typeof t=="string"&&Kt(t.charCodeAt(0))){++i;let o=t.length;o>1&&Kt(t.charCodeAt(1))&&(++i,o>2&&(Kt(t.charCodeAt(2))?++i:n=!1))}if(n){for(;i<e.length&&Kt(e.charCodeAt(i));)i++;i>=2&&(e=`\\${e.slice(i)}`)}return xn.normalize(e)},relative(r,e){if(mn(r,"from"),mn(e,"to"),r===e)return"";let t=xn.resolve(r),n=xn.resolve(e);if(t===n||(r=t.toLowerCase(),e=n.toLowerCase(),r===e))return"";let i=0;for(;i<r.length&&r.charCodeAt(i)===io;)i++;let o=r.length;for(;o-1>i&&r.charCodeAt(o-1)===io;)o--;let s=o-i,a=0;for(;a<e.length&&e.charCodeAt(a)===io;)a++;let c=e.length;for(;c-1>a&&e.charCodeAt(c-1)===io;)c--;let l=c-a,u=s<l?s:l,p=-1,m=0;for(;m<u;m++){let g=r.charCodeAt(i+m);if(g!==e.charCodeAt(a+m))break;g===io&&(p=m)}if(m!==u){if(p===-1)return n}else{if(l>u){if(e.charCodeAt(a+m)===io)return n.slice(a+m+1);if(m===2)return n.slice(a+m)}s>u&&(r.charCodeAt(i+m)===io?p=m:m===2&&(p=3)),p===-1&&(p=0)}let h="";for(m=i+p+1;m<=o;++m)(m===o||r.charCodeAt(m)===io)&&(h+=h.length===0?"..":"\\..");return a+=p,h.length>0?`${h}${n.slice(a,c)}`:(n.charCodeAt(a)===io&&++a,n.slice(a,c))},toNamespacedPath(r){if(typeof r!="string")return r;if(r.length===0)return"";let e=xn.resolve(r);if(e.length<=2)return r;if(e.charCodeAt(0)===io){if(e.charCodeAt(1)===io){let t=e.charCodeAt(2);if(t!==wY&&t!==Hu)return`\\\\?\\UNC\\${e.slice(2)}`}}else if($u(e.charCodeAt(0))&&e.charCodeAt(1)===Ju&&e.charCodeAt(2)===io)return`\\\\?\\${e}`;return r},dirname(r){mn(r,"path");let e=r.length;if(e===0)return".";let t=-1,n=0,i=r.charCodeAt(0);if(e===1)return Kt(i)?r:".";if(Kt(i)){if(t=n=1,Kt(r.charCodeAt(1))){let a=2,c=a;for(;a<e&&!Kt(r.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&Kt(r.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&!Kt(r.charCodeAt(a));)a++;if(a===e)return r;a!==c&&(t=n=a+1)}}}}else $u(i)&&r.charCodeAt(1)===Ju&&(t=e>2&&Kt(r.charCodeAt(2))?3:2,n=t);let o=-1,s=!0;for(let a=e-1;a>=n;--a)if(Kt(r.charCodeAt(a))){if(!s){o=a;break}}else s=!1;if(o===-1){if(t===-1)return".";o=t}return r.slice(0,o)},basename(r,e){e!==void 0&&mn(e,"ext"),mn(r,"path");let t=0,n=-1,i=!0,o;if(r.length>=2&&$u(r.charCodeAt(0))&&r.charCodeAt(1)===Ju&&(t=2),e!==void 0&&e.length>0&&e.length<=r.length){if(e===r)return"";let s=e.length-1,a=-1;for(o=r.length-1;o>=t;--o){let c=r.charCodeAt(o);if(Kt(c)){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(c===e.charCodeAt(s)?--s===-1&&(n=o):(s=-1,n=a))}return t===n?n=a:n===-1&&(n=r.length),r.slice(t,n)}for(o=r.length-1;o>=t;--o)if(Kt(r.charCodeAt(o))){if(!i){t=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":r.slice(t,n)},extname(r){mn(r,"path");let e=0,t=-1,n=0,i=-1,o=!0,s=0;r.length>=2&&r.charCodeAt(1)===Ju&&$u(r.charCodeAt(0))&&(e=n=2);for(let a=r.length-1;a>=e;--a){let c=r.charCodeAt(a);if(Kt(c)){if(!o){n=a+1;break}continue}i===-1&&(o=!1,i=a+1),c===Hu?t===-1?t=a:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||i===-1||s===0||s===1&&t===i-1&&t===n+1?"":r.slice(t,i)},format:Lj.bind(null,"\\"),parse(r){mn(r,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return e;let t=r.length,n=0,i=r.charCodeAt(0);if(t===1)return Kt(i)?(e.root=e.dir=r,e):(e.base=e.name=r,e);if(Kt(i)){if(n=1,Kt(r.charCodeAt(1))){let p=2,m=p;for(;p<t&&!Kt(r.charCodeAt(p));)p++;if(p<t&&p!==m){for(m=p;p<t&&Kt(r.charCodeAt(p));)p++;if(p<t&&p!==m){for(m=p;p<t&&!Kt(r.charCodeAt(p));)p++;p===t?n=p:p!==m&&(n=p+1)}}}}else if($u(i)&&r.charCodeAt(1)===Ju){if(t<=2)return e.root=e.dir=r,e;if(n=2,Kt(r.charCodeAt(2))){if(t===3)return e.root=e.dir=r,e;n=3}}n>0&&(e.root=r.slice(0,n));let o=-1,s=n,a=-1,c=!0,l=r.length-1,u=0;for(;l>=n;--l){if(i=r.charCodeAt(l),Kt(i)){if(!c){s=l+1;break}continue}a===-1&&(c=!1,a=l+1),i===Hu?o===-1?o=l:u!==1&&(u=1):o!==-1&&(u=-1)}return a!==-1&&(o===-1||u===0||u===1&&o===a-1&&o===s+1?e.base=e.name=r.slice(s,a):(e.name=r.slice(s,o),e.base=r.slice(s,a),e.ext=r.slice(o,a))),s>0&&s!==n?e.dir=r.slice(0,s-1):e.dir=e.root,e},sep:"\\",delimiter:";",win32:null,posix:null},Sr={resolve(...r){let e="",t=!1;for(let n=r.length-1;n>=-1&&!t;n--){let i=n>=0?r[n]:Lw();mn(i,"path"),i.length!==0&&(e=`${i}/${e}`,t=i.charCodeAt(0)===Bn)}return e=jw(e,!t,"/",YR),t?`/${e}`:e.length>0?e:"."},normalize(r){if(mn(r,"path"),r.length===0)return".";let e=r.charCodeAt(0)===Bn,t=r.charCodeAt(r.length-1)===Bn;return r=jw(r,!e,"/",YR),r.length===0?e?"/":t?"./":".":(t&&(r+="/"),e?`/${r}`:r)},isAbsolute(r){return mn(r,"path"),r.length>0&&r.charCodeAt(0)===Bn},join(...r){if(r.length===0)return".";let e;for(let t=0;t<r.length;++t){let n=r[t];mn(n,"path"),n.length>0&&(e===void 0?e=n:e+=`/${n}`)}return e===void 0?".":Sr.normalize(e)},relative(r,e){if(mn(r,"from"),mn(e,"to"),r===e||(r=Sr.resolve(r),e=Sr.resolve(e),r===e))return"";let t=1,n=r.length,i=n-t,o=1,s=e.length-o,a=i<s?i:s,c=-1,l=0;for(;l<a;l++){let p=r.charCodeAt(t+l);if(p!==e.charCodeAt(o+l))break;p===Bn&&(c=l)}if(l===a)if(s>a){if(e.charCodeAt(o+l)===Bn)return e.slice(o+l+1);if(l===0)return e.slice(o+l)}else i>a&&(r.charCodeAt(t+l)===Bn?c=l:l===0&&(c=0));let u="";for(l=t+c+1;l<=n;++l)(l===n||r.charCodeAt(l)===Bn)&&(u+=u.length===0?"..":"/..");return`${u}${e.slice(o+c)}`},toNamespacedPath(r){return r},dirname(r){if(mn(r,"path"),r.length===0)return".";let e=r.charCodeAt(0)===Bn,t=-1,n=!0;for(let i=r.length-1;i>=1;--i)if(r.charCodeAt(i)===Bn){if(!n){t=i;break}}else n=!1;return t===-1?e?"/":".":e&&t===1?"//":r.slice(0,t)},basename(r,e){e!==void 0&&mn(e,"ext"),mn(r,"path");let t=0,n=-1,i=!0,o;if(e!==void 0&&e.length>0&&e.length<=r.length){if(e===r)return"";let s=e.length-1,a=-1;for(o=r.length-1;o>=0;--o){let c=r.charCodeAt(o);if(c===Bn){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(c===e.charCodeAt(s)?--s===-1&&(n=o):(s=-1,n=a))}return t===n?n=a:n===-1&&(n=r.length),r.slice(t,n)}for(o=r.length-1;o>=0;--o)if(r.charCodeAt(o)===Bn){if(!i){t=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":r.slice(t,n)},extname(r){mn(r,"path");let e=-1,t=0,n=-1,i=!0,o=0;for(let s=r.length-1;s>=0;--s){let a=r.charCodeAt(s);if(a===Bn){if(!i){t=s+1;break}continue}n===-1&&(i=!1,n=s+1),a===Hu?e===-1?e=s:o!==1&&(o=1):e!==-1&&(o=-1)}return e===-1||n===-1||o===0||o===1&&e===n-1&&e===t+1?"":r.slice(e,n)},format:Lj.bind(null,"/"),parse(r){mn(r,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return e;let t=r.charCodeAt(0)===Bn,n;t?(e.root="/",n=1):n=0;let i=-1,o=0,s=-1,a=!0,c=r.length-1,l=0;for(;c>=n;--c){let u=r.charCodeAt(c);if(u===Bn){if(!a){o=c+1;break}continue}s===-1&&(a=!1,s=c+1),u===Hu?i===-1?i=c:l!==1&&(l=1):i!==-1&&(l=-1)}if(s!==-1){let u=o===0&&t?1:o;i===-1||l===0||l===1&&i===s-1&&i===o+1?e.base=e.name=r.slice(u,s):(e.name=r.slice(u,i),e.base=r.slice(u,s),e.ext=r.slice(i,s))}return o>0?e.dir=r.slice(0,o-1):t&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};Sr.win32=xn.win32=xn;Sr.posix=xn.posix=Sr;var In=no==="win32"?xn.normalize:Sr.normalize,fh=no==="win32"?xn.isAbsolute:Sr.isAbsolute,Ve=no==="win32"?xn.join:Sr.join,Uj=no==="win32"?xn.resolve:Sr.resolve,Ww=no==="win32"?xn.relative:Sr.relative,pt=no==="win32"?xn.dirname:Sr.dirname,De=no==="win32"?xn.basename:Sr.basename,Wi=no==="win32"?xn.extname:Sr.extname,HIe=no==="win32"?xn.format:Sr.format,jj=no==="win32"?xn.parse:Sr.parse,GIe=no==="win32"?xn.toNamespacedPath:Sr.toNamespacedPath,qn=no==="win32"?xn.sep:Sr.sep,Jn=no==="win32"?xn.delimiter:Sr.delimiter;var _S=require("vscode");var EY=require("vscode");var Vw=class{constructor(e){this.computeFn=e;this.lastCache=void 0;this.lastArgKey=void 0}get(e){let t=JSON.stringify(e);return this.lastArgKey!==t&&(this.lastArgKey=t,this.lastCache=this.computeFn(e)),this.lastCache}};var kS=class r{constructor(e){this.executor=e;this._didRun=!1}hasValue(){return this._didRun}getValue(){if(!this._didRun)try{this._value=this.executor()}catch(e){this._error=e}finally{this._didRun=!0}if(this._error)throw this._error;return this._value}get rawValue(){return this._value}map(e){return new r(()=>e(this.getValue()))}};function Jj(r,e){return r<e?-1:r>e?1:0}function PY(r,e,t=0,n=r.length,i=0,o=e.length){for(;t<n&&i<o;t++,i++){let c=r.charCodeAt(t),l=e.charCodeAt(i);if(c<l)return-1;if(c>l)return 1}let s=n-t,a=o-i;return s<a?-1:s>a?1:0}function $j(r,e,t=0,n=r.length,i=0,o=e.length){for(;t<n&&i<o;t++,i++){let c=r.charCodeAt(t),l=e.charCodeAt(i);if(c===l)continue;if(c>=128||l>=128)return PY(r.toLowerCase(),e.toLowerCase(),t,n,i,o);Wj(c)&&(c-=32),Wj(l)&&(l-=32);let u=c-l;if(u!==0)return u}let s=n-t,a=o-i;return s<a?-1:s>a?1:0}function Wj(r){return r>=97&&r<=122}function Hj(r,e){return r.length===e.length&&$j(r,e)===0}function Gj(r,e){let t=e.length;return e.length>r.length?!1:$j(r,e,0,t)===0}var Vj=class r{constructor(e){this.confusableDictionary=e}static{this.ambiguousCharacterData=new kS(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,8218,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,8242,96,1370,96,1523,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71922,67,71913,67,65315,67,8557,67,8450,67,8493,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71919,87,71910,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,66293,90,71909,90,65338,90,8484,90,8488,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65297,49,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125],"_default":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"cs":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"es":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"fr":[65374,126,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"it":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ja":[8211,45,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65292,44,65307,59],"ko":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pt-BR":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ru":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"zh-hans":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41],"zh-hant":[8211,45,65374,126,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65307,59]}'))}static{this.cache=new Vw(e=>{function t(u){let p=new Map;for(let m=0;m<u.length;m+=2)p.set(u[m],u[m+1]);return p}function n(u,p){let m=new Map(u);for(let[h,g]of p)m.set(h,g);return m}function i(u,p){if(!u)return p;let m=new Map;for(let[h,g]of u)p.has(h)&&m.set(h,g);return m}let o=this.ambiguousCharacterData.getValue(),s=e.filter(u=>!u.startsWith("_")&&u in o);s.length===0&&(s=["_default"]);let a;for(let u of s){let p=t(o[u]);a=i(a,p)}let c=t(o._common),l=n(c,a);return new r(l)})}static getInstance(e){return r.cache.get(Array.from(e))}static{this._locales=new kS(()=>Object.keys(r.ambiguousCharacterData.getValue()).filter(e=>!e.startsWith("_")))}static getLocales(){return r._locales.getValue()}isAmbiguous(e){return this.confusableDictionary.has(e)}getPrimaryConfusable(e){return this.confusableDictionary.get(e)}getConfusableCodePoints(){return new Set(this.confusableDictionary.keys())}},Bj=class r{static getRawData(){return JSON.parse("[9,10,11,12,13,32,127,160,173,847,1564,4447,4448,6068,6069,6155,6156,6157,6158,7355,7356,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8234,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,8293,8294,8295,8296,8297,8298,8299,8300,8301,8302,8303,10240,12288,12644,65024,65025,65026,65027,65028,65029,65030,65031,65032,65033,65034,65035,65036,65037,65038,65039,65279,65440,65520,65521,65522,65523,65524,65525,65526,65527,65528,65532,78844,119155,119156,119157,119158,119159,119160,119161,119162,917504,917505,917506,917507,917508,917509,917510,917511,917512,917513,917514,917515,917516,917517,917518,917519,917520,917521,917522,917523,917524,917525,917526,917527,917528,917529,917530,917531,917532,917533,917534,917535,917536,917537,917538,917539,917540,917541,917542,917543,917544,917545,917546,917547,917548,917549,917550,917551,917552,917553,917554,917555,917556,917557,917558,917559,917560,917561,917562,917563,917564,917565,917566,917567,917568,917569,917570,917571,917572,917573,917574,917575,917576,917577,917578,917579,917580,917581,917582,917583,917584,917585,917586,917587,917588,917589,917590,917591,917592,917593,917594,917595,917596,917597,917598,917599,917600,917601,917602,917603,917604,917605,917606,917607,917608,917609,917610,917611,917612,917613,917614,917615,917616,917617,917618,917619,917620,917621,917622,917623,917624,917625,917626,917627,917628,917629,917630,917631,917760,917761,917762,917763,917764,917765,917766,917767,917768,917769,917770,917771,917772,917773,917774,917775,917776,917777,917778,917779,917780,917781,917782,917783,917784,917785,917786,917787,917788,917789,917790,917791,917792,917793,917794,917795,917796,917797,917798,917799,917800,917801,917802,917803,917804,917805,917806,917807,917808,917809,917810,917811,917812,917813,917814,917815,917816,917817,917818,917819,917820,917821,917822,917823,917824,917825,917826,917827,917828,917829,917830,917831,917832,917833,917834,917835,917836,917837,917838,917839,917840,917841,917842,917843,917844,917845,917846,917847,917848,917849,917850,917851,917852,917853,917854,917855,917856,917857,917858,917859,917860,917861,917862,917863,917864,917865,917866,917867,917868,917869,917870,917871,917872,917873,917874,917875,917876,917877,917878,917879,917880,917881,917882,917883,917884,917885,917886,917887,917888,917889,917890,917891,917892,917893,917894,917895,917896,917897,917898,917899,917900,917901,917902,917903,917904,917905,917906,917907,917908,917909,917910,917911,917912,917913,917914,917915,917916,917917,917918,917919,917920,917921,917922,917923,917924,917925,917926,917927,917928,917929,917930,917931,917932,917933,917934,917935,917936,917937,917938,917939,917940,917941,917942,917943,917944,917945,917946,917947,917948,917949,917950,917951,917952,917953,917954,917955,917956,917957,917958,917959,917960,917961,917962,917963,917964,917965,917966,917967,917968,917969,917970,917971,917972,917973,917974,917975,917976,917977,917978,917979,917980,917981,917982,917983,917984,917985,917986,917987,917988,917989,917990,917991,917992,917993,917994,917995,917996,917997,917998,917999]")}static{this._data=void 0}static getData(){return this._data||(this._data=new Set(r.getRawData())),this._data}static isInvisibleCharacter(e){return r.getData().has(e)}static get codePoints(){return r.getData()}};function Gu(r){return r===47||r===92}function XR(r){return r.replace(/[\\/]/g,Sr.sep)}function zj(r){return r.indexOf("/")===-1&&(r=XR(r)),/^[a-zA-Z]:(\/|$)/.test(r)&&(r="/"+r),r}function ZR(r,e=Sr.sep){if(!r)return"";let t=r.length,n=r.charCodeAt(0);if(Gu(n)){if(Gu(r.charCodeAt(1))&&!Gu(r.charCodeAt(2))){let o=3,s=o;for(;o<t&&!Gu(r.charCodeAt(o));o++);if(s!==o&&!Gu(r.charCodeAt(o+1))){for(o+=1;o<t;o++)if(Gu(r.charCodeAt(o)))return r.slice(0,o+1).replace(/[\\/]/g,e)}}return e}else if(kY(n)&&r.charCodeAt(1)===58)return Gu(r.charCodeAt(2))?r.slice(0,2)+e:r.slice(0,2);let i=r.indexOf("://");if(i!==-1){for(i+=3;i<t;i++)if(Gu(r.charCodeAt(i)))return r.slice(0,i+1)}return""}function eA(r,e,t,n=qn){if(r===e)return!0;if(!r||!e||e.length>r.length)return!1;if(t){if(!Gj(r,e))return!1;if(e.length===r.length)return!0;let o=e.length;return e.charAt(e.length-1)===n&&o--,r.charAt(o)===n}return e.charAt(e.length-1)!==n&&(e+=n),r.indexOf(e)===0}function kY(r){return r>=65&&r<=90||r>=97&&r<=122}var Ha;(ae=>(ae.inMemory="inmemory",ae.vscode="vscode",ae.internal="private",ae.walkThrough="walkThrough",ae.walkThroughSnippet="walkThroughSnippet",ae.http="http",ae.https="https",ae.file="file",ae.mailto="mailto",ae.untitled="untitled",ae.data="data",ae.command="command",ae.vscodeRemote="vscode-remote",ae.vscodeRemoteResource="vscode-remote-resource",ae.vscodeUserData="vscode-userdata",ae.vscodeCustomEditor="vscode-custom-editor",ae.vscodeNotebook="vscode-notebook",ae.vscodeNotebookCell="vscode-notebook-cell",ae.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",ae.vscodeNotebookCellOutput="vscode-notebook-cell-output",ae.vscodeInteractive="vscode-interactive",ae.vscodeInteractiveInput="vscode-interactive-input",ae.vscodeSettings="vscode-settings",ae.vscodeWorkspaceTrust="vscode-workspace-trust",ae.vscodeTerminal="vscode-terminal",ae.webviewPanel="webview-panel",ae.vscodeWebview="vscode-webview",ae.extension="extension",ae.vscodeFileResource="vscode-file",ae.tmp="tmp",ae.vsls="vsls"))(Ha||={});function na(r){return Fw?r?.path||"":r?.fsPath||""}var DS=class{constructor(e){this._ignorePathCasing=e}compare(e,t,n=!1){return e===t?0:Jj(this.getComparisonKey(e,n),this.getComparisonKey(t,n))}isEqual(e,t,n=!1){return e===t?!0:!e||!t?!1:this.getComparisonKey(e,n)===this.getComparisonKey(t,n)}getComparisonKey(e,t=!1){return e.with({path:this._ignorePathCasing(e)?e.path.toLowerCase():void 0,fragment:void 0}).toString()}ignorePathCasing(e){return this._ignorePathCasing(e)}isEqualOrParent(e,t,n=!1,i=PS?"\\":"/"){if(e.scheme===t.scheme){if(e.scheme===Ha.file)return eA(na(e),na(t),this._ignorePathCasing(e),i)&&e.query===t.query&&(n||e.fragment===t.fragment);if(Qj(e.authority,t.authority))return eA(e.path,t.path,this._ignorePathCasing(e),"/")&&e.query===t.query&&(n||e.fragment===t.fragment)}return!1}joinPath(e,...t){return _S.Uri.joinPath(e,...t)}basenameOrAuthority(e){return hn(e)||e.authority}basename(e,t){return Sr.basename(e.path,t)}extname(e){return Sr.extname(e.path)}dirname(e){if(e.path.length===0)return e;let t;return e.scheme===Ha.file?t=_S.Uri.file(pt(na(e))).path:(t=Sr.dirname(e.path),e.authority&&t.length&&t.charCodeAt(0)!==47&&(console.error(`dirname("${e.toString})) resulted in a relative path`),t="/")),e.with({path:t})}normalizePath(e){if(!e.path.length)return e;let t;return e.scheme===Ha.file?t=_S.Uri.file(In(na(e))).path:t=Sr.normalize(e.path),e.with({path:t})}relativePath(e,t){if(e.scheme!==t.scheme||!Qj(e.authority,t.authority))return;if(e.scheme===Ha.file){let o=Ww(na(e),na(t));return PS?XR(o):o}let n=e.path||"/",i=t.path||"/";if(this._ignorePathCasing(e)){let o=0;for(let s=Math.min(n.length,i.length);o<s&&!(n.charCodeAt(o)!==i.charCodeAt(o)&&n.charAt(o).toLowerCase()!==i.charAt(o).toLowerCase());o++);n=i.substr(0,o)+n.substr(o)}return Sr.relative(n,i)}resolvePath(e,t){if(e.scheme===Ha.file){let n=_S.Uri.file(Uj(na(e),t));return e.with({authority:n.authority,path:n.path})}return t=zj(t),e.with({path:Sr.resolve(e.path,t)})}isAbsolutePath(e){return!!e.path&&e.path[0]==="/"}isEqualAuthority(e,t){return e===t||e!==void 0&&t!==void 0&&Hj(e,t)}hasTrailingPathSeparator(e,t=qn){if(e.scheme===Ha.file){let n=na(e);return n.length>ZR(n).length&&n[n.length-1]===t}else{let n=e.path;return n.length>1&&n.charCodeAt(n.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(e.fsPath)}}removeTrailingPathSeparator(e,t=qn){return Yj(e,t)?e.with({path:e.path.substr(0,e.path.length-1)}):e}addTrailingPathSeparator(e,t=qn){let n=!1;if(e.scheme===Ha.file){let i=na(e);n=i!==void 0&&i.length===ZR(i).length&&i[i.length-1]===t}else{t="/";let i=e.path;n=i.length===1&&i.charCodeAt(i.length-1)===47}return!n&&!Yj(e,t)?e.with({path:e.path+"/"}):e}},nr=new DS(()=>!1),dSe=new DS(r=>r.scheme===Ha.file?!Kj:!0),mSe=new DS(r=>!0),bi=nr.isEqual.bind(nr),TS=nr.isEqualOrParent.bind(nr),fn=nr.getComparisonKey.bind(nr),fSe=nr.basenameOrAuthority.bind(nr),hn=nr.basename.bind(nr),zu=nr.extname.bind(nr),Ii=nr.dirname.bind(nr),sr=nr.joinPath.bind(nr),hSe=nr.normalizePath.bind(nr),tA=nr.relativePath.bind(nr),gSe=nr.resolvePath.bind(nr),vSe=nr.isAbsolutePath.bind(nr),Qj=nr.isEqualAuthority.bind(nr),Yj=nr.hasTrailingPathSeparator.bind(nr),ySe=nr.removeTrailingPathSeparator.bind(nr),bSe=nr.addTrailingPathSeparator.bind(nr),DY;(o=>{o.META_DATA_LABEL="label",o.META_DATA_DESCRIPTION="description",o.META_DATA_SIZE="size",o.META_DATA_MIME="mime";function i(s){let a=new Map;s.path.substring(s.path.indexOf(";")+1,s.path.lastIndexOf(";")).split(";").forEach(u=>{let[p,m]=u.split(":");p&&m&&a.set(p,m)});let l=s.path.substring(0,s.path.indexOf(";"));return l&&a.set(o.META_DATA_MIME,l),a}o.parseMetaData=i})(DY||={});function qr(r=process.platform){return/^win/.test(r)?"Windows":/^darwin/.test(r)?"OSX":/^linux/.test(r)?"Linux":"Unknown"}function hh(r,e){return r.replace(/^~(?=$|\/|\\)/,e)}function TY(){if(!Vu())return rA.Uri.file(require("os").homedir())}function Pe(r){let e=qr()==="Windows";if(r){let t=na(r);return t&&t.startsWith(qn)&&t.length>1&&t[1]!==qn&&e?t.slice(1):t||""}return""}function W(r,e=[],t){t=t||TY();let n;typeof r=="string"&&(n=rA.Uri.file(r)),typeof r!="string"&&(n=r);let i=Xj(n,void 0,t),o=e.map(a=>Xj(n,a.uri,t)),s=i;return[i,...o].forEach(a=>{a.length<s.length&&(s=a)}),s}function Xj(r,e,t){let n=qr()==="Windows";if(r&&e&&TS(r,e,!0)){let i=tA(e,r);if(i)return n?i.replace(/\//g,"\\"):i}if(r&&t&&TS(r,t,!0)){let i=tA(t,r);if(i)return i=n?i.replace(/\//g,"\\"):i,`~${qn}${i}`}return Pe(r)}var qw="",Zj=3,rm=[];function iA(r){return rm.push(r),{dispose:()=>{rm=rm.filter(e=>e!==r)}}}var AY=new Map([["error",40],["warn",30],["info",20],["debug",10],["none",100],["off",100],[void 0,40]]),vh=10;function oA(r){vh=typeof r=="number"?r:AY.get(r)??40}function e2(r){qw=r.toLowerCase()}function t2(...r){return vh<=5?r:r.map(t=>{if(!(t instanceof Error)||!("isJupyterError"in t))return t;let n=[`${t.name}: ${t.message}`.trim()];if("kernelConnectionMetadata"in t&&t.kernelConnectionMetadata&&typeof t.kernelConnectionMetadata=="object"&&"id"in t.kernelConnectionMetadata&&(n.push(`Kernel Id = ${t.kernelConnectionMetadata.id}`),"interpreter"in t.kernelConnectionMetadata&&t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter=="object"&&"id"in t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter.id=="string"&&n.push(`Interpreter Id = ${W(t.kernelConnectionMetadata.interpreter.id)}`)),t.stack){let o=Fe(t.stack),s=o.find(a=>a.indexOf("at ")===0);o.length===1||(o.length===1?n.push(o[0]):o.length>1&&s?.length?n.push(s):n.push(o[0]))}let i=["stack","message","name","kernelConnectionMetadata","category","exitCode","isJupyterError"];return Object.keys(t).filter(o=>i.indexOf(o)===-1).forEach(o=>n.push(`${o} = ${String(t[o]).trim()}`)),n.filter(o=>o.trim().length).map((o,s)=>s===0?o:`    > ${o}`).join(`
`)})}function x(r,...e){vh<=40&&(e=t2(...e),rm.forEach(t=>t.traceError(r,...e)))}function j(r,...e){vh<=30&&(e=t2(...e),rm.forEach(t=>t.traceWarn(r,...e)))}function z(r,...e){vh<=20&&rm.forEach(t=>t.traceInfo(r,...e))}function E(r,...e){vh<=5&&rm.forEach(t=>t.traceVerbose(r,...e))}function ne(r,...e){if(Zn)if(typeof r=="function"){let n=r(),i="",o=[];typeof n=="string"?i=n:(i=n.shift(),o=n),z(i,...o)}else z(r,...e)}function ti(r,e=Zj){return r2({message:r,opts:e,level:5})}function yh(r){return r2({message:r,opts:Zj,level:40})}var Dl=new WeakMap;function Tl(r){return(e,t,n)=>{Dl.has(e)||Dl.set(e,new Map);let i=Dl.get(e);i||Dl.set(e,i=new Map),i.has(t)||i.set(t,[]),i.get(t).push({parameterIndex:n,propertyOfParameterToLog:r})}}function Qu(){return(r,e,t)=>{Dl.has(r)||Dl.set(r,new Map);let n=Dl.get(r);n||Dl.set(r,n=new Map),n.has(e)||n.set(e,[]),n.get(e).push({parameterIndex:t,ignore:!0})}}function r2(r){return Rj((e,t)=>FY(r,t,e),(r.opts&4)>0)}function NY(r){let{kind:e,name:t,args:n}=r;return(!e||e==="")&&(e="Function"),(!t||t==="")&&(t="<anon>"),n||(n=[]),{kind:e,name:t,args:n,methodName:r.methodName||"",target:r.target||void 0}}function MY(r){if(!r)return!1;let e=r;return typeof e.path=="string"&&typeof e.scheme=="string"}function nA(r){let e=qw?r.toLowerCase().indexOf(qw):-1;return e===-1?r:`~${r.substring(e+qw.length)}`}function OY(r,e,t,n){if(MY(t))return nA(t.path);if(!t)return t;let o=Dl.get(r)?.get(e)?.find(a=>a.parameterIndex===n);if(!o)return typeof t=="string"?nA(t):t;if("ignore"in o&&o.ignore)return"";let s=t;return"propertyOfParameterToLog"in o&&o.propertyOfParameterToLog&&(s=t[o.propertyOfParameterToLog]),typeof s=="string"?nA(s):s}function KY(r,e,t){t=NY(t);let n=[r.message];return n.push(`${t.kind} name = ${t.name}`.trim()),e?(n.push(`completed in ${e.elapsed}ms`),n.push(`has a ${e.returnValue?"truthy":"falsy"} return value`)):n[n.length-1]=`${n[n.length-1]} (started execution)`,(r.opts&1)===1&&(r.level===5?n.push(GR(t.args.map((i,o)=>t?OY(t.target,t.methodName,i,o):i))):n.push(GR(t.args))),e&&(r.opts&2)===2&&n.push(Aj(e.returnValue)),n.join(", ")}function FY(r,e,t){let n=KY(r,e,t);e?e.err===void 0?r.level&&r.level===40||(r.level?Bw(r.level,n):Bw(20,n)):Bw(40,n,e.err):r.level&&r.level!==40&&Bw(r.level,n)}function Bw(r,e,...t){switch(r){case 40:x(e,...t);break;case 30:j(e,...t);break;case 20:z(e,...t);break;case 10:E(e,...t);break;case 5:E(e,...t);break;default:break}}var lr=require("vscode");var AN=require("vscode");var n2=Symbol("IsDevMode"),No=Symbol("IOutputChannel"),i2=Symbol("IS_WINDOWS"),F=Symbol("IDisposableRegistry"),$e=Symbol("IGlobalMemento"),St=Symbol("IGlobalMemento"),ri=Symbol("IWorkspaceMemento");var Ga=Symbol("IPersistentStateFactory"),LSe=Symbol("IRandom"),le=Symbol("IConfigurationService"),lt=Symbol("ExtensionContext"),oa=Symbol("IExtensions"),o2=Symbol("IJupyterExtensionBanner"),Jw=Symbol("IFeaturesManager"),bh=Symbol("ICryptoUtils"),ni=Symbol("IAsyncDisposableRegistry");var za=Symbol("IExperimentService"),Ih=Symbol("IDataScienceCommandListener"),Sh=Symbol("IVariableScriptGenerator"),xh=Symbol("IDataFrameScriptGenerator");var d9=require("vscode");var RW=require("events"),KS=_(O());try{(0,KS.decorate)((0,KS.injectable)(),RW.EventEmitter)}catch(r){j("Failed to decorate EventEmitter for DI (possibly already decorated by another Extension)",r)}var Te=class{constructor(e){this.container=e;Te._instance=this}static get instance(){return Te._instance}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}};Te=v([(0,KS.injectable)()],Te);var Xe=require("vscode");var Gt=Symbol("IPythonApi"),ze=Symbol("IPythonExtensionChecker");var C=require("vscode");var at=require("vscode"),LA=60,UA=LA*60,FS=UA*24,AW=FS*7,NW=FS*30,MW=FS*365;function Th(r,e,t,n){typeof r!="number"&&(r=r.getTime());let i=Math.round((new Date().getTime()-r)/1e3);if(i<-30)return at.l10n.t("in {0}",Th(new Date().getTime()+i*1e3,!1));if(!n&&i<30)return at.l10n.t("now");let o;return i<LA?(o=i,e?o===1?t?at.l10n.t("{0} second ago",o):at.l10n.t("{0} sec ago",o):t?at.l10n.t("{0} seconds ago",o):at.l10n.t("{0} secs ago",o):o===1?t?at.l10n.t("{0} second",o):at.l10n.t("{0} sec",o):t?at.l10n.t("{0} seconds",o):at.l10n.t("{0} secs",o)):i<UA?(o=Math.floor(i/LA),e?o===1?t?at.l10n.t("{0} minute ago",o):at.l10n.t("{0} min ago",o):t?at.l10n.t("{0} minutes ago",o):at.l10n.t("{0} mins ago",o):o===1?t?at.l10n.t("{0} minute",o):at.l10n.t("{0} min",o):t?at.l10n.t("{0} minutes",o):at.l10n.t("{0} mins",o)):i<FS?(o=Math.floor(i/UA),e?o===1?t?at.l10n.t("{0} hour ago",o):at.l10n.t("{0} hr ago",o):t?at.l10n.t("{0} hours ago",o):at.l10n.t("{0} hrs ago",o):o===1?t?at.l10n.t("{0} hour",o):at.l10n.t("{0} hr",o):t?at.l10n.t("{0} hours",o):at.l10n.t("{0} hrs",o)):i<AW?(o=Math.floor(i/FS),e?o===1?at.l10n.t("{0} day ago",o):at.l10n.t("{0} days ago",o):o===1?at.l10n.t("{0} day",o):at.l10n.t("{0} days",o)):i<NW?(o=Math.floor(i/AW),e?o===1?t?at.l10n.t("{0} week ago",o):at.l10n.t("{0} wk ago",o):t?at.l10n.t("{0} weeks ago",o):at.l10n.t("{0} wks ago",o):o===1?t?at.l10n.t("{0} week",o):at.l10n.t("{0} wk",o):t?at.l10n.t("{0} weeks",o):at.l10n.t("{0} wks",o)):i<MW?(o=Math.floor(i/NW),e?o===1?t?at.l10n.t("{0} month ago",o):at.l10n.t("{0} mo ago",o):t?at.l10n.t("{0} months ago",o):at.l10n.t("{0} mos ago",o):o===1?t?at.l10n.t("{0} month",o):at.l10n.t("{0} mo",o):t?at.l10n.t("{0} months",o):at.l10n.t("{0} mos",o)):(o=Math.floor(i/MW),e?o===1?t?at.l10n.t("{0} year ago",o):at.l10n.t("{0} yr ago",o):t?at.l10n.t("{0} years ago",o):at.l10n.t("{0} yrs ago",o):o===1?t?at.l10n.t("{0} year",o):at.l10n.t("{0} yr",o):t?at.l10n.t("{0} years",o):at.l10n.t("{0} yrs",o))}function Cre(r){let e=r.displayName||r.envName||"",t=W(r.uri);return e?` ${e} (${t})`:t}var ye;(k=>(k.bannerLabelYes=C.l10n.t("Yes"),k.bannerLabelNo=C.l10n.t("No"),k.canceled=C.l10n.t("Canceled"),k.cancel=C.l10n.t("Cancel"),k.ok=C.l10n.t("Ok"),k.refresh=C.l10n.t("Refresh"),k.refreshing=C.l10n.t("Refreshing..."),k.install=C.l10n.t("Install"),k.loadingExtension=C.l10n.t("Jupyter Extension loading..."),k.handleExtensionActivationError=C.l10n.t("Extension activation failed, run the 'Developer: Toggle Developer Tools' command for more information."),k.doNotShowAgain=C.l10n.t("Do not show again"),k.reload=C.l10n.t("Reload"),k.moreInfo=C.l10n.t("More Info"),k.learnMore=C.l10n.t("Learn more"),k.and=C.l10n.t("and"),k.reportThisIssue=C.l10n.t("Report this issue"),k.clickHereForMoreInfoWithHtml=N=>C.l10n.t("Click <a href='{0}'>here</a> for more info.",N)))(ye||={});var Zu;(t=>(t.notInGroup=n=>C.l10n.t("User does not belong to experiment group '{0}'",n),t.inGroup=n=>C.l10n.t("User belongs to experiment group '{0}'",n)))(Zu||={});var jA;(e=>e.jupyter=C.l10n.t("Jupyter"))(jA||={});var WA;(e=>e.currentWorkingDirectory="cwd:")(WA||={});var VA;(e=>e.bannerMessage=C.l10n.t("Would you like shift-enter to send code to the new Interactive Window experience?"))(VA||={});var BA;(e=>e.bannerMessage=C.l10n.t("Can you please take a minute to tell us about your notebooks experience in VS Code?"))(BA||={});var CE;(t=>(t.bannerLabelYes=C.l10n.t("Yes, take survey now"),t.bannerLabelNo=C.l10n.t("No, thanks")))(CE||={});var y;(T=>(T.warnWhenSelectingKernelWithUnSupportedPythonVersion=C.l10n.t("The version of Python associated with the selected kernel is no longer supported. Please consider selecting a different kernel."),T.installingPythonExtension=C.l10n.t("Installing Python extension and locating kernels."),T.pythonExtensionRequired=C.l10n.t("The Python Extension is required to perform that task. Click Yes to open Python Extension installation page."),T.rendererExtensionRequired=C.l10n.t("The Renderer Extension is required to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),T.rendererExtension1015Required=C.l10n.t("The installed version of the Renderer Extension is outdated and requires and update to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),T.pythonExtensionInstalled=C.l10n.t("Python Extension is now installed. Some features might not be available until a notebook or interactive window session is restarted."),T.unknownPackage=C.l10n.t("unknown"),T.interactiveWindowTitleFormat=U=>C.l10n.t("Interactive - {0}",U),T.interactiveWindowModeBannerTitle=C.l10n.t({message:"Do you want to open a new Interactive Window for this file? [More Information](command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D).",args:[],comment:'The string "command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D" should not be translated. It is a command that opens the settings page with the "jupyter.interactiveWindowMode" setting selected.'}),T.interactiveWindowModeBannerSwitchYes=C.l10n.t("Yes"),T.interactiveWindowModeBannerSwitchNo=C.l10n.t("No"),T.dataExplorerTitle=C.l10n.t("Data Viewer"),T.badWebPanelFormatString=U=>C.l10n.t({message:"<html><body><h1>{0} is not a valid file name</h1></body></html>",args:[U],comment:["Only translate the text within the HTML tags"]}),T.installingMissingDependencies=C.l10n.t("Installing missing dependencies"),T.validatingKernelDependencies=C.l10n.t("Validating kernel dependencies"),T.performingExport=C.l10n.t("Performing Export"),T.exportNotebookToPython=C.l10n.t("Exporting Notebook to Python"),T.sessionDisposed=C.l10n.t("Cannot execute code, session has been disposed. Please try restarting the Kernel."),T.passwordFailure=C.l10n.t("Failed to connect to password protected server. Check that password is correct."),T.incorrectPassword=C.l10n.t("Incorrect Password."),T.exportDialogFilter=C.l10n.t("Jupyter Notebooks"),T.exportDialogComplete=U=>C.l10n.t("Notebook written to {0}",U),T.exportDialogFailed=U=>C.l10n.t("Failed to export notebook. {0}",U),T.exportOpenQuestion1=C.l10n.t("Open in editor"),T.runCellLensCommandTitle=C.l10n.t("Run Cell"),T.importDialogTitle=C.l10n.t("Import Jupyter Notebook"),T.importDialogFilter="Jupyter Notebooks",T.notebookCheckForImportNo=C.l10n.t("Later"),T.libraryRequiredToLaunchJupyterNotInstalled=U=>C.l10n.t("Running cells requires {0} package.",U),T.librariesRequiredToLaunchJupyterNotInstalled=U=>C.l10n.t("Running cells requires {0} package.",U),T.libraryRequiredToLaunchJupyterNotInstalledInterpreter=(U,Ze)=>C.l10n.t("Running cells with '{0}' requires the {1} package.",U,Ze),T.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter=(U,Ze)=>C.l10n.t("Running cells with '{0}' requires the {1} package.",U,Ze),T.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate=(U,Ze)=>C.l10n.t("Running cells with '{0}' requires the {1} package to be installed or requires an update.",U,Ze),T.librariesRequiredToLaunchJupyterNotInstalledInterpreter=(U,Ze)=>C.l10n.t("Running cells with '{0}' requires the {1} package.",U,Ze),T.installPackageInstructions=(U,Ze)=>C.l10n.t(`Run the following command to install '{0}' into the Python environment. 
Command: '{1}'`,U,Ze),T.pythonCondaKernelsWithoutPython=C.l10n.t("The Python Runtime and IPyKernel will be automatically installed upon selecting this environment."),T.selectJupyterInterpreter=C.l10n.t("Select an Interpreter to start Jupyter"),T.jupyterInstall=C.l10n.t("Install"),T.currentlySelectedJupyterInterpreterForPlaceholder=U=>C.l10n.t("Selected Environment {0}",U),T.jupyterNotSupported=U=>C.l10n.t("Jupyter cannot be started. Error attempting to locate Jupyter: {0}",U),T.jupyterNotebookNotInstalledOrNotFound=U=>{if(U){let Ze=Cre(U);return C.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment '{0}'.",Ze)}else return C.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment.")},T.jupyterNotSupportedBecauseOfEnvironment=(U,Ze)=>C.l10n.t("Activating {0} to run Jupyter failed with {1}",U,Ze),T.jupyterNbConvertNotSupported=C.l10n.t("Jupyter nbconvert is not installed"),T.jupyterLaunchTimedOut=C.l10n.t("The Jupyter notebook server failed to launch in time"),T.jupyterLaunchNoURL=C.l10n.t("Failed to find the URL of the launched Jupyter notebook server"),T.jupyterSelfCertFail=U=>C.l10n.t(`The security certificate used by server {0} was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,U),T.jupyterExpiredCertFail=U=>C.l10n.t(`The security certificate used by server {0} has expired.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,U),T.jupyterSelfCertFailErrorMessageOnly=C.l10n.t(`The security certificate used by server was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.`),T.jupyterSelfCertExpiredErrorMessageOnly=C.l10n.t(`The security certificate used by server has expired.\r
This may indicate an attempt to steal your information.`),T.jupyterSelfCertEnable=C.l10n.t("Yes, connect anyways"),T.jupyterSelfCertClose=C.l10n.t("No, close the connection"),T.pythonInteractiveHelpLink=C.l10n.t("See <https://aka.ms/pyaiinstall> for help on installing Jupyter."),T.importingFormat=U=>C.l10n.t("Importing {0}",U),T.startingJupyter=C.l10n.t("Starting Jupyter Server"),T.connectingToKernel=U=>C.l10n.t("Connecting to kernel: {0}",U),T.connectingToJupyter=C.l10n.t("Connecting to Jupyter Server"),T.exportingFormat=U=>C.l10n.t("Exporting {0}",U),T.runAllCellsLensCommandTitle=C.l10n.t("Run All Cells"),T.runAllCellsAboveLensCommandTitle=C.l10n.t("Run Above"),T.runCellAndAllBelowLensCommandTitle=C.l10n.t("Run Below"),T.restartKernelMessage=C.l10n.t("Do you want to restart the Jupyter kernel? All variables will be lost."),T.restartKernelMessageYes=C.l10n.t("Restart"),T.restartKernelMessageDontAskAgain=C.l10n.t("Don't Ask Again"),T.automaticallyReconnectingToAKernelProgressMessage=U=>C.l10n.t("Reconnecting to the kernel {0}",U),T.restartingKernelStatus=U=>C.l10n.t("Restarting Kernel {0}",U),T.interruptingKernelFailed=C.l10n.t("Kernel interrupt failed. Jupyter Server is hung. Please reload VS Code."),T.sessionStartFailedWithKernel=U=>C.l10n.t({message:`Failed to start the Kernel '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.failedToStartJupyter=U=>C.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.failedToStartJupyterWithErrorInfo=(U,Ze)=>C.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
{1} 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U,Ze],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.failedToStartJupyterDueToOutdatedTraitlets=(U,Ze)=>C.l10n.t({message:`Failed to start Jupyter in the environment '{0}' possibly due to an outdated version of 'traitlets'. 
{1} 
Consider updating the 'traitlets' module to '5.1.1' or later. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U,Ze],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the text 'traitlets', that is a Python module name"]}),T.failedToStartKernel=C.l10n.t("Failed to start the Kernel."),T.failedToRestartKernel=C.l10n.t("Failed to restart the Kernel."),T.failedToInterruptKernel=C.l10n.t("Failed to interrupt the Kernel."),T.rawKernelStartFailedDueToTimeout=U=>C.l10n.t({message:`Unable to start Kernel '{0}' due to a connection timeout. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.rawKernelStartFailedDueToTimeoutWaitingForPort=U=>C.l10n.t({message:`Unable to start Kernel '{0}' due to a timeout waiting for the ports to get used. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.viewJupyterLogForFurtherInfo=C.l10n.t({message:"View Jupyter [log](command:jupyter.viewOutput) for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.kernelDied=U=>C.l10n.t({message:"The kernel died. Error: {0}... View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.kernelDiedWithoutError=U=>C.l10n.t({message:"The kernel '{0}' died. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),T.failedToStartAnUntrustedKernelSpec=(U,Ze)=>C.l10n.t({message:`The kernel '{0}' was not started as it is located in an insecure location '{1}'.  
Click [here](https://aka.ms/JupyterTrustedKernelPaths) for further details, optionally update the setting [jupyter.kernels.trusted](command:workbench.action.openSettings?["jupyter.kernels.trusted"]) to trust the kernel.`,args:[U,Ze],comment:['Do not translate the text "jupyter.kernels.trusted", that is a setting in VS Code','Do not translate the text command:workbench.action.openSettings?["jupyter.kernels.trusted"], that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/JupyterTrustedKernelPaths"]}),T.kernelDiedWithoutErrorAndAutoRestarting=U=>C.l10n.t({message:"The kernel '{0}' died and is being automatically restarted by Jupyter. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),T.kernelCrashedDueToCodeInCurrentOrPreviousCell=C.l10n.t({message:`The Kernel crashed while executing code in the current cell or a previous cell. 
Please review the code in the cell(s) to identify a possible cause of the failure. 
Click <a href='https://aka.ms/vscodeJupyterKernelCrash'>here</a> for more info. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),T.kernelDisconnected=U=>C.l10n.t("Unable to connect to the kernel '{0}', please verify the Jupyter Server connection. View Jupyter [log](command:jupyter.viewOutput) for further details.",U),T.cannotRunCellKernelIsDead=U=>C.l10n.t("Cannot run cells, as the kernel '{0}' is dead.",U),T.showJupyterLogs=C.l10n.t("Show Jupyter Logs."),T.restartKernel=C.l10n.t("Restart Kernel"),T.reloadRequired=C.l10n.t("Please reload the window for new settings to take effect."),T.restartedKernelHeader=U=>C.l10n.t("Restarted {0}",U),T.connectedKernelHeader=U=>C.l10n.t("Connected to {0}",U),T.restartingKernelCustomHeader=U=>C.l10n.t("_Restarting {0}..._",U),T.restartingKernelHeader=C.l10n.t("_Restarting kernel..._"),T.startingNewKernelHeader=C.l10n.t("_Connecting to kernel..._"),T.startingNewKernelCustomHeader=U=>C.l10n.t("_Connecting to {0}..._",U),T.noKernelConnected=C.l10n.t("No kernel connected"),T.jupyterSelectUriCommandLabel=C.l10n.t("Enter the URL of the running Jupyter Server..."),T.jupyterSelectUriInputTitle=C.l10n.t("Enter the URL of the running Jupyter Server"),T.jupyterSelectUriInputPlaceholder=C.l10n.t("Enter the url of the running Jupyter Server"),T.connectToToTheJupyterServer=U=>C.l10n.t("Connect to the Jupyter Server {0}",U),T.enterOrSelectRemoteJupyterPlaceholder=C.l10n.t("Enter a remote url, or select a remote server"),T.selectRemoteJupyterPlaceholder=C.l10n.t("Select a remote server"),T.jupyterServerLastConnectionForQuickPickDescription=U=>C.l10n.t("Last connected {0}",Th(U,!0,!1,!1)),T.jupyterServerNotUsedBeforeQuickPickSeparatorTitle=C.l10n.t("Jupyter Servers"),T.jupyterSelectURIInvalidURI=C.l10n.t("Invalid URL specified"),T.jupyterSelectURIMustBeHttpOrHttps=C.l10n.t("Invalid protocol in URL specified, only HTTP or HTTPS are supported."),T.jupyterSelectLiveRemoteKernelDescription=(U,Ze)=>U?Ze===0?C.l10n.t("Last activity {0}",Th(U,!0,!1,!1)):Ze===1?C.l10n.t("Last activity {0}, 1 connection",Th(U,!0,!1,!1)):C.l10n.t("Last activity {0}, {1} connections",Th(U,!0,!1,!1),Ze.toString()):Ze===0?"":Ze===1?C.l10n.t("1 connection"):C.l10n.t("{0} connections",Ze.toString()),T.installJupyterHub=C.l10n.t("Install the JupyterHub extension to connect to JupyterHub servers."),T.useJupyterHubExtension=C.l10n.t("Select 'Existing JupyterHub Server...' from the Kernel Picker"),T.useJupyterHubExtensionDetail=C.l10n.t("Use this option when connecting to JupyterHub servers"),T.installJupyterHubDetail=C.l10n.t("Once installed, open the Kernel Picker and select 'Existing JupyterHub Server...'"),T.jupyterSelectUserAndPasswordTitle=C.l10n.t("Enter your user name and password to connect to Jupyter Hub"),T.jupyterRenameServer=C.l10n.t("Change Server Display Name (Leave Blank To Use URL)"),T.jupyterServerUriDisplayNameInputPlaceholder=C.l10n.t("Enter a display name"),T.jupyterSelectUserPrompt=C.l10n.t("Enter your user name"),T.jupyterSelectPasswordPrompt=C.l10n.t("Enter your password"),T.jupyterSelectPasswordTitle=C.l10n.t("Enter your password for the Jupyter Server"),T.pythonNotInstalled=C.l10n.t(`Python is not installed. 
Please download and install Python in order to execute cells in this notebook. 
Once installed please reload VS Code.`),T.pleaseReloadVSCodeOncePythonHasBeenInstalled=C.l10n.t("Upon installing Python please reload VS Code."),T.jupyterNotebookFailure=U=>C.l10n.t(`Jupyter notebook failed to launch. \r
{0}`,U),T.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid=U=>C.l10n.t("The remote Jupyter Server contributed by the extension '{0}' is no longer available.",U),T.remoteJupyterConnectionFailedWithServerWithError=(U,Ze)=>C.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable. ({1}).",U,Ze),T.remoteJupyterConnectionFailedWithServer=U=>C.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable.",U),T.remoteJupyterConnectionFailedWithoutServerWithError=U=>C.l10n.t("Connection failure. Verify the server is running and reachable. ({0}).",U),T.remoteJupyterConnectionFailedWithoutServerWithErrorWeb=U=>C.l10n.t(`Connection failure. Verify the server is running and reachable from a browser. ({0}). 
When connecting from vscode.dev Jupyter servers must be started with specific options to connect. 
Click [here](https://aka.ms/vscjremoteweb) for more information.`,U),T.removeRemoteJupyterConnectionButtonText=C.l10n.t("Forget Connection"),T.jupyterNotebookRemoteConnectFailedWeb=U=>C.l10n.t(`Failed to connect to remote Jupyter Server.\r
Check that the Jupyter Server URL can be reached from a browser.\r
{0}. Click [here](https://aka.ms/vscjremoteweb) for more information.`,U),T.packageNotInstalledWindowsLongPathNotEnabledError=(U,Ze)=>C.l10n.t(`Support for Windows Long Path has not been enabled, hence the package {0} could not be installed into the Python Environment '{1}'.
Please ensure that support for Windows Long Path is enabled.
See [here](https://pip.pypa.io/warnings/enable-long-paths) for more information.`,U,Ze),T.changeRemoteJupyterConnectionButtonText=C.l10n.t("Manage Connections"),T.rawConnectionBrokenError=C.l10n.t("Direct kernel connection broken"),T.jupyterServerCrashed=U=>C.l10n.t(`Jupyter Server crashed. Unable to connect. \r
Error code from Jupyter: {0}`,U.toString()),T.jupyterKernelSpecModuleNotFound=U=>C.l10n.t(`'Kernelspec' module not installed in the selected interpreter ({0}).
 Please re-install or update 'jupyter'.`,U),T.interruptKernelStatus=U=>C.l10n.t("Interrupting Kernel {0}",U),T.exportPythonQuickPickLabel=C.l10n.t("Python Script"),T.exportHTMLQuickPickLabel=C.l10n.t("HTML"),T.exportPDFQuickPickLabel=C.l10n.t("PDF"),T.restartKernelAfterInterruptMessage=U=>C.l10n.t("Interrupting the kernel '{0}' timed out. Do you want to restart the kernel instead? All variables will be lost.",U),T.documentMismatch=U=>C.l10n.t("Cannot run cells, duplicate documents for {0} found.",U),T.jupyterGetVariablesBadResults=C.l10n.t("Failed to fetch variable info from the Jupyter Server."),C.l10n.t("Failure to create an 'Interactive' window. Try reinstalling the Python Extension."),T.jupyterGetVariablesExecutionError=U=>C.l10n.t(`Failure during variable extraction: \r
{0}`,U),T.selectKernel=C.l10n.t("Change Kernel"),T.selectDifferentKernel=C.l10n.t("Select a different Kernel"),T.kernelFilterPlaceholder=C.l10n.t("Choose the kernels that are available in the kernel picker."),T.recommendedItemCategoryInQuickPick=C.l10n.t("Recommended"),T.selectedKernelCategoryInQuickPick=C.l10n.t("Selected"),T.createPythonEnvironmentInQuickPick=C.l10n.t("Create Python Environment"),T.createPythonEnvironmentInQuickPickTooltip=C.l10n.t("Create an isolated Python Environment per workspace folder"),T.selectDifferentJupyterInterpreter=C.l10n.t("Change Interpreter"),T.pandasTooOldForViewingFormat=(U,Ze)=>C.l10n.t({message:"Python package 'pandas' is version {0}. Version {1} or greater is required for viewing data.",args:[U,Ze],comment:["Do not translate 'pandas' as that is a Python module name"]}),T.pandasRequiredForViewing=U=>C.l10n.t({message:"Python package 'pandas' version {0} (or above) is required for viewing data.",args:[U],comment:["Do not translate 'pandas' as that is a Python module name"]}),T.tooManyColumnsMessage=C.l10n.t("Variables with over a 1000 columns may take a long time to display. Are you sure you wish to continue?"),T.tooManyColumnsYes=C.l10n.t("Yes"),T.tooManyColumnsNo=C.l10n.t("No"),T.tooManyColumnsDontAskAgain=C.l10n.t("Don't Ask Again"),T.plotViewerTitle=C.l10n.t("Plots"),T.exportPlotTitle=C.l10n.t("Save plot image"),T.pdfFilter="PDF",T.pngFilter="PNG",T.svgFilter="SVG",T.exportImageFailed=U=>C.l10n.t("Error exporting image: {0}",U),T.jupyterDataRateExceeded=C.l10n.t({message:"Cannot view variable because data rate exceeded. Please restart your server with a higher data rate limit. For example, --NotebookApp.iopub_data_rate_limit=10000000000.0",comment:["Do not translate the text --NotebookApp.iopub_data_rate_limit=10000000000.0 as that is a command argument."]}),T.addCellBelowCommandTitle=C.l10n.t("Add cell"),T.debugCellCommandTitle=C.l10n.t("Debug Cell"),T.debugStepOverCommandTitle=C.l10n.t("Step over"),T.debugContinueCommandTitle=C.l10n.t("Continue"),T.debugStopCommandTitle=C.l10n.t("Stop"),T.runCurrentCellAndAddBelow=C.l10n.t("Run current cell and add empty cell below"),T.jupyterDebuggerNotInstalledError=U=>C.l10n.t("Pip module {0} is required for debugging cells. You will need to install it to debug cells.",U),T.jupyterDebuggerOutputParseError=U=>C.l10n.t("Unable to parse {0} output, please log an issue with https://github.com/microsoft/vscode-jupyter",U),T.cellStopOnErrorMessage=C.l10n.t("Cell was canceled due to an error in a previous cell."),T.scrollToCellTitleFormatMessage=U=>C.l10n.t("Go to [{0}]",U.toString()),T.instructionComments=U=>C.l10n.t(`# To add a new cell, type '{0}'
# To add a new markdown cell, type '{0} [markdown]'
`,U),T.exportButtonTitle=C.l10n.t("Export"),T.exportAsQuickPickPlaceholder=C.l10n.t("Export As..."),T.openExportedFileMessage=C.l10n.t("Would you like to open the exported file?"),T.openExportFileYes=C.l10n.t("Yes"),T.openExportFileNo=C.l10n.t("No"),T.exportFailedGeneralMessage=C.l10n.t({message:"Please check the 'Jupyter' [output](command:jupyter.viewOutput) panel for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.exportToPDFDependencyMessage=C.l10n.t(`If you have not installed xelatex (TeX), you will need to do so before you can export to PDF. For further instructions, please see https://nbconvert.readthedocs.io/en/latest/install.html#installing-tex. \r
To avoid installing xelatex (TeX), you might want to try exporting to HTML and using your browser's "Print to PDF" feature.`),T.failedExportMessage=C.l10n.t("Export failed."),T.startingJupyterLogMessage=(U,Ze)=>C.l10n.t("Starting Jupyter from {0} with arguments {1}",U,Ze),T.waitingForJupyterSessionToBeIdle=C.l10n.t("Waiting for Jupyter Session to be idle"),T.gettingListOfKernelsForRemoteConnection=C.l10n.t("Fetching Kernels"),T.gettingListOfKernelSpecs=C.l10n.t("Fetching Kernel specs"),T.startingJupyterNotebook=C.l10n.t("Starting Jupyter Notebook"),T.registeringKernel=C.l10n.t("Registering Kernel"),T.jupyterCommandLineReloadQuestion=C.l10n.t("Please reload the window when changing the Jupyter command line."),T.jupyterCommandLineReloadAnswer=C.l10n.t("Reload"),T.createdNewKernel=(U,Ze)=>C.l10n.t("{0}: Kernel started: {1}",U,Ze),T.kernelInvalid=U=>C.l10n.t("Kernel {0} is not usable. Check the Jupyter output tab for more information.",U),T.removeRemoteJupyterServerEntryInQuickPick=C.l10n.t("Remove"),T.loadClassFailedWithNoInternet=(U,Ze)=>C.l10n.t("Error loading {0}:{1}. Internet connection required for loading 3rd party widgets.",U,Ze),T.useCDNForWidgetsNoInformation=C.l10n.t("Widgets require us to download supporting files from a 3rd party website."),T.enableCDNForWidgetsSetting=(U,Ze)=>C.l10n.t("Widgets require us to download supporting files from a 3rd party website. (Error loading {0}:{1}).",U,Ze),T.enableCDNForWidgetsButton=C.l10n.t("Enable Downloads"),T.unhandledMessage=(U,Ze)=>C.l10n.t("Unhandled kernel message from a widget: {0} : {1}",U,Ze),T.cdnWidgetScriptNotAccessibleWarningMessage=(U,Ze)=>C.l10n.t("Unable to download widget '{0}' from 3rd party website {1}, due to network access. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",U,Ze),T.widgetScriptNotFoundOnCDNWidgetMightNotWork=(U,Ze,oh)=>C.l10n.t("Unable to find widget '{0}' version '{1}' from configured widget sources {2}. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",U,Ze,oh),T.insecureSessionMessage=C.l10n.t("Connecting over HTTP without a token may be an insecure connection. Do you want to connect to a possibly insecure server?"),T.insecureSessionDenied=C.l10n.t("Denied connection to insecure server."),T.selectKernelForEditor=C.l10n.t("[Select a kernel](command:_notebook.selectKernel) to run cells."),T.needIpykernel6=C.l10n.t("Ipykernel setup required for this feature"),T.setup=C.l10n.t("Setup"),T.showDataViewerFail=C.l10n.t("Failed to create the Data Viewer. Check the Jupyter tab of the Output window for more info."),T.defaultNotebookName=C.l10n.t("default"),T.recommendExtensionForNotebookLanguage=(U,Ze)=>C.l10n.t("The {0} extension is recommended for notebooks targeting the language '{1}'",U,Ze),T.kernelWasNotStarted=C.l10n.t("Kernel was not started. A kernel session is needed to start debugging."),T.noNotebookToDebug=C.l10n.t("No active notebook document to debug."),T.cantStartDebugging=C.l10n.t("Can't start debugging."),T.restartNotSupported=C.l10n.t("Restarting is not supported in the interactive window."),T.importingIpynb=C.l10n.t("Importing notebook file"),T.exportingToFormat=U=>C.l10n.t("Exporting to {0}",U),T.kernelCategoryForJupyterSession=C.l10n.t("Jupyter Session"),T.kernelDefaultRemoteDisplayName=C.l10n.t("Remote"),T.kernelCategoryForJupyterKernel=C.l10n.t("Jupyter Kernel"),T.kernelCategoryForRemoteJupyterKernel=C.l10n.t("Jupyter Kernel"),T.kernelCategoryForConda=C.l10n.t("Conda Env"),T.kernelCategoryForCondaWithoutPython=C.l10n.t("Conda Env Without Python"),T.kernelCategoryForPoetry=C.l10n.t("Poetry Env"),T.kernelCategoryForPipEnv=C.l10n.t("Pipenv Env"),T.kernelCategoryForPyEnv=C.l10n.t("PyEnv Env"),T.kernelCategoryForGlobal=C.l10n.t("Global Env"),T.kernelCategoryForVirtual=C.l10n.t("Virtual Env"),T.fileSeemsToBeInterferingWithKernelStartup=U=>C.l10n.t("The file '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the file and starting the kernel again.",U),T.moduleSeemsToBeInterferingWithKernelStartup=U=>C.l10n.t("The module '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the folder and starting the kernel again.",U),T.pipCondaInstallHoverWarning=(U,Ze)=>C.l10n.t("'!{0} install' could install packages into the wrong environment. [More info]({1})",U,Ze),T.percentPipCondaInstallInsteadOfBang=U=>C.l10n.t({message:"Use '%{0} install' instead of '!{0} install'",args:[U],comment:['Do not translate the string within quotes, such as "%{0} install" and "!{0} install" as that is a Jupyter Shell Magic command']}),T.replacePipCondaInstallCodeAction=U=>C.l10n.t("Replace with '%{0} install'",U),T.failedToStartKernelDueToMissingModule=U=>C.l10n.t("The kernel failed to start due to the missing module '{0}'. Consider installing this module.",U),T.failedToStartKernelDueToImportFailure=U=>C.l10n.t("The kernel failed to start as the module '{0}' could not be imported.",U),T.failedToStartKernelDueToImportFailureFromFile=(U,Ze)=>C.l10n.t("The kernel failed to start as '{0}' could not be imported from '{1}'.",U,Ze),T.failedToStartKernelDueToUnknownDllLoadFailure=C.l10n.t("The kernel failed to start as a dll could not be loaded."),T.failedToStartKernelDueToDllLoadFailure=U=>C.l10n.t("The kernel failed to start as the dll '{0}' could not be loaded.",U),T.failedToStartKernelDueToWin32APIFailure=C.l10n.t("The kernel failed to start due to an error with the Win32api module. Consider (re) installing this module."),T.failedToStartKernelDueToPyZmqFailure=C.l10n.t({message:"The kernel failed to start due to an error with the 'pyzmq' module. Consider re-installing this module.",comment:['Do not translate the string "pyzmq" as that is a Python module.']}),T.failedToStartKernelDueToOldIPython=C.l10n.t("The kernel failed to start due to an outdated version of IPython. Consider updating this module to the latest version."),T.failedToStartKernelDueToOldIPyKernel=C.l10n.t("The kernel failed to start due to an outdated version of IPyKernel. Consider updating this module to the latest version."),T.failedToStartKernelDueToMissingPythonEnv=U=>C.l10n.t("The kernel failed to start as the Python Environment '{0}' is no longer available. Consider selecting another kernel or refreshing the list of Python Environments.",U),T.matplotlibWidgetInsteadOfOther=C.l10n.t("'%matplotlib' widget works best inside of VS Code"),T.matplotlibWidgetCodeActionTitle=C.l10n.t("More info"),T.allowExtensionToUseJupyterKernelApi=(U,Ze)=>C.l10n.t("Do you want to give the extension '{0}' access to the Jupyter Kernels? Clicking '{1}' would allow this extension to execute code against the Jupyter Kernels.",U,Ze),T.thanksForUsingJupyterKernelApiPleaseRegisterWithUs=U=>C.l10n.t("Thank you for trying the Jupyter API. Please file an issue on our repo to allow the extension {0} to use this API in production. This would prevent us from breaking your extension when updating the API (as it is still a work in progress).",U),T.activatingPythonEnvironment=U=>C.l10n.t("Activating Python Environment '{0}'",U),T.runningKernelStartupHooksFor=U=>C.l10n.t("Running Kernel startup hooks in '{0}'",U),T.cellAtFormat=(U,Ze)=>C.l10n.t("{0} Cell {1}",U,Ze),T.jupyterServerConsoleOutputChannel=C.l10n.t("Jupyter Server Console"),T.kernelConsoleOutputChannel=U=>C.l10n.t("{0} Kernel Console Output",U),T.webNotSupported=C.l10n.t("Operation not supported in web version of Jupyter Extension."),T.failedToInstallPythonExtension=C.l10n.t("Failed to install the Python Extension."),T.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting=U=>C.l10n.t("Some of the following files found in the working directory may have prevented the Kernel from starting. Consider renaming them.",U),T.listOfFilesWithLinksThatMightNeedToBeRenamed=U=>C.l10n.t("File(s): {0} might need to be renamed.",U),T.failedToGetVersionOfPandas=C.l10n.t("Failed to get version of Pandas to use the Data Viewer."),T.failedToInstallPandas=C.l10n.t("Failed to install Pandas to use the Data Viewer."),T.localKernelSpecs=C.l10n.t("Jupyter Kernel..."),T.localPythonEnvironments=C.l10n.t("Python Environments..."),T.quickPickTitleForSelectionOfJupyterServer=C.l10n.t("Select a Jupyter Server"),T.UserJupyterServerUrlProviderDisplayName=C.l10n.t("Existing Jupyter Server..."),T.UserJupyterServerUrlProviderDetail=C.l10n.t("Connect to an existing Jupyter Server"),T.kernelPickerSelectKernelTitle=C.l10n.t("Select Kernel"),T.kernelPickerSelectLocalKernelSpecTitle=C.l10n.t("Select a Jupyter Kernel"),T.quickPickSelectPythonEnvironmentTitle=C.l10n.t("Select a Python Environment"),T.kernelPickerSelectKernelFromRemoteTitle=U=>C.l10n.t("Select a Kernel from {0}",U),T.kernelPickerSelectKernelFromRemoteTitleWithoutName=C.l10n.t("Select a Jupyter Kernel"),T.installPythonExtensionViaKernelPickerTitle=C.l10n.t("Install Python Extension"),T.installPythonExtensionViaKernelPickerToolTip=C.l10n.t("Python Extension is required to detect and use Python environments for the execution of code cells."),T.installPythonQuickPickTitle=C.l10n.t("Install Python"),T.installPythonQuickPickToolTip=C.l10n.t("Python Environments not detected. Upon installation reload VS Code or refresh the list of Kernels."),T.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel=C.l10n.t({message:"$(error) Unable to connect to the remote server",comment:"Do not translate the string $(error) as that is a VS Code icon."}),T.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail=C.l10n.t("Ensure the server is running and reachable.")))(y||={});var Bt;(Z=>(Z.collapseSingle=C.l10n.t("Collapse"),Z.expandSingle=C.l10n.t("Expand"),Z.noRowsInDataViewer=C.l10n.t("No rows match current filter"),Z.sliceIndexError=C.l10n.t({message:"Index {0} out of range for axis {1} with {2} elements",comment:["Do not translate the strings {0}, {1} and {2} as they are variable names and will be replaced later"]}),Z.sliceMismatchedAxesError=C.l10n.t({message:"Expected {0} axes, got {1} in slice expression",comment:["Do not translate the strings {0} and {2} as they are variable names and will be replaced later"]}),Z.fetchingDataViewer=C.l10n.t("Fetching data ..."),Z.dataViewerHideFilters=C.l10n.t("Hide filters"),Z.dataViewerShowFilters=C.l10n.t("Show filters"),Z.refreshDataViewer=C.l10n.t("Refresh data viewer"),Z.sliceSummaryTitle=C.l10n.t("SLICING"),Z.sliceData=C.l10n.t("Slice Data"),Z.sliceSubmitButton=C.l10n.t("Apply"),Z.sliceDropdownAxisLabel=C.l10n.t("Axis"),Z.sliceDropdownIndexLabel=C.l10n.t("Index"),Z.variableExplorerNameColumn=C.l10n.t("Name"),Z.variableExplorerTypeColumn=C.l10n.t("Type"),Z.variableExplorerCountColumn=C.l10n.t("Size"),Z.variableExplorerValueColumn=C.l10n.t("Value"),Z.collapseVariableExplorerLabel=C.l10n.t("Variables"),Z.variableLoadingValue=C.l10n.t("Loading..."),Z.showDataExplorerTooltip=C.l10n.t("Show variable snapshot in data viewer"),Z.noRowsInVariableExplorer=C.l10n.t("No variables defined"),Z.loadingRowsInVariableExplorer=C.l10n.t("Loading variables"),Z.previousPlot=C.l10n.t("Previous"),Z.nextPlot=C.l10n.t("Next"),Z.panPlot=C.l10n.t("Pan"),Z.zoomInPlot=C.l10n.t("Zoom in"),Z.zoomOutPlot=C.l10n.t("Zoom out"),Z.exportPlot=C.l10n.t("Export to different formats"),Z.deletePlot=C.l10n.t("Remove"),Z.selectedImageListLabel=C.l10n.t("Selected Image"),Z.selectedImageLabel=C.l10n.t("Image"),Z.errorOutputExceedsLinkToOpenFormatString=C.l10n.t({message:"Output exceeds the <a href={0}>size limit</a>. Open the full output data <a href={1}>in a text editor</a>",comment:['Do not translate the the Hyperlink text "<a href={0}>size limit</a>" and "<a href={1}>in a text editor</a>". However the text inside those tags can be translated']})))(Bt||={});var LS;(n=>(n.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE=C.l10n.t({message:"The setting 'python.formatting.formatOnSave' is deprecated, please use 'editor.formatOnSave'.",comment:['Do not translate the string "python.formatting.formatOnSave" as that is a setting in VS Code','Do not translate the string "editor.formatOnSave" as that is a setting in VS Code']}),n.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE=C.l10n.t({message:"The setting 'python.linting.lintOnTextChange' is deprecated, please enable 'python.linting.lintOnSave' and 'files.autoSave'.",comment:['Do not translate the string "python.linting.lintOnTextChange" as that is a setting in VS Code','Do not translate the string "python.linting.lintOnSave" as that is a setting in VS Code']}),n.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES=C.l10n.t({message:"The setting 'python.autoComplete.preloadModules' is deprecated, please consider using Pylance Language Server ('python.languageServer' setting).",comment:['Do not translate the string "python.autoComplete.preloadModules" as that is a setting in VS Code','Do not translate the string "python.languageServer" as that is a setting in VS Code']})))(LS||={});var Rh;(n=>(n.noCondaOrPipInstaller=C.l10n.t("There is no Conda or Pip installer available in the selected environment."),n.noPipInstaller=C.l10n.t("There is no Pip installer available in the selected environment."),n.searchForHelp=C.l10n.t("Search for help")))(Rh||={});var qA;(e=>e.installingModule=t=>C.l10n.t("Installing {0}",t))(qA||={});var Ss=_(O());var US="Python Kernel Debug Adapter",jS="Python Interactive Window Debug Adapter";var _E=require("node-fetch"),BS=_(OW());var FW=_(O());var Ah=class{async createHash(e,t="SHA-256"){return la(e,t)}};Ah=v([(0,FW.injectable)()],Ah);var wE={},KW=!1,EE;typeof window=="object"?EE=window.crypto:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?EE=self.crypto:EE=require("node:crypto").webcrypto;async function la(r,e){let t=r.includes("/")||r.includes("\\")||r.endsWith(".interactive");if(t&&wE[r])return wE[r];let n=await Pre(r,e);return t&&!KW&&(Object.keys(wE).length>1e4&&(KW=!0),wE[r]=n),n}async function Pre(r,e){let t=new TextEncoder().encode(r),n=await EE.subtle.digest({name:e},t);return Array.from(new Uint8Array(n)).map(o=>o.toString(16).padStart(2,"0")).join("")}function ep(r){if(typeof r=="string")try{let[e,t,n]=`${r.trim()}...`.split(".").map(i=>parseInt(i,10));return isNaN(e)?"":isNaN(t)?e.toString():isNaN(n)?`${e}.${t}`:`${e}.${t}.${n}`}catch(e){return x(`Failed to parse version ${r}`,e),""}return r?`${r.major}.${r.minor}.${r.micro}`:""}async function vt(r){return la(r,"SHA-256")}var Nh=require("vscode");var Ye=class extends Error{constructor(t,n){super(n);this.category=t;this.isJupyterError=!0}},sn=class r extends Ye{constructor(t,n,i){super(i||JA(n),t);this.originalException=n;n&&(this.stack=`${new Error("").stack}

${n.stack}`)}static from(t,n){return n instanceof Ye?n:new r(t,n)}static unwrap(t){return t&&(t instanceof r&&t.originalException&&t.originalException instanceof Ye&&(t=t.originalException),t)}};function JA(r){return r&&r instanceof Ye?r.category:"unknown"}var vs=class extends Ye{constructor(t,n,i){super("jupyterconnection",t+(n?`
${n}`:""));this.interpreter=i}};var gn=class extends Ye{constructor(){super("sessionDisposed",y.sessionDisposed)}};var PE=class{static outputHasModuleNotInstalledError(e,t){return!!(t&&(t.indexOf(`No module named ${e}`)>0||t.indexOf(`No module named '${e}'`)>0))}};function Mh(r=""){if(!r)return;let e=/\S+Error: /g,t=`${r.trim()}: `.split(`
`).filter(s=>s.trim().length).reverse();if(t.length===0)return;let n=t[0],o=((n.match(e)?n:void 0)||"").split(":");return o.length&&o[0].endsWith("Error")?o[0]:void 0}function kE(r=""){let e=UW(r);return e?e[1]:void 0}function UW(r=""){if(!r)return;let e=r.trim().split(`
`).map(t=>t.trim()).filter(t=>t.trim().length).reverse();if(e.length!==0&&e[0].includes("Error"))return[e.length>1?e[1]:"",e[0]]}function jW(r){if(!r)return;let t=(Array.isArray(r)?r[0]:r).split(`
`).map(c=>c.trim().toLowerCase()).filter(c=>c.length).reverse().find(c=>c.startsWith("file ")&&c.includes(", line ")&&c.includes(".py")&&c.includes(".py"));if(!t)return;let i=(t.substring(0,t.lastIndexOf(".py"))+".py").replace(/\\/g,"/").split("/"),o=i.indexOf("site-packages"),s=o>=0&&i.length>o+1?i[o+1]:"",a=i.reverse();if(!(a.length<2))return{fileName:a[0],folderName:a[1],packageName:s}}function sm(r,e,t,n="",i=[]){let o=e instanceof Ye?e.stdErr||e.stack||"":e.toString(),s=UW(o),a=o.toLowerCase();if(e instanceof gn)return{reason:"sessionDisposed",message:y.sessionDisposed,moreInfoLink:"https://aka.ms/kernelDisposedCannotRunCell",telemetrySafeTags:["deadSession"]};if(a.includes("ImportError: No module named 'win32api'".toLowerCase()))return{reason:"importWin32apiFailure",message:y.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())&&a.includes("win32api"))return{reason:"importWin32apiFailure",message:y.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["dll.load.failed","win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())){let u=s&&s[0].toLowerCase().startsWith("import")?s[0].substring(6).trim():void 0;return{reason:"dllLoadFailure",moduleName:u,message:u?y.failedToStartKernelDueToDllLoadFailure(u):y.failedToStartKernelDueToUnknownDllLoadFailure,moreInfoLink:"https://aka.ms/kernelFailuresDllLoad",telemetrySafeTags:["dll.load.failed"]}}if(a.includes("AssertionError: Couldn't find Class NSProcessInfo".toLowerCase()))return{reason:"oldIPythonFailure",message:y.failedToStartKernelDueToOldIPython,moreInfoLink:"https://aka.ms/kernelFailuresOldIPython",telemetrySafeTags:["oldipython"]};if(a.includes("NotImplementedError".toLowerCase())&&a.includes("asyncio".toLowerCase())&&a.includes("events.py".toLowerCase()))return{reason:"oldIPyKernelFailure",message:y.failedToStartKernelDueToOldIPyKernel,moreInfoLink:"https://aka.ms/kernelFailuresOldIPyKernel",telemetrySafeTags:["oldipykernel"]};{let u=[];if(a.includes("ImportError: cannot import name".toLowerCase())&&a.includes("from partially initialized module".toLowerCase())&&a.includes("zmq.backend.cython".toLowerCase())&&u.push("zmq.backend.cython"),a.includes("zmq".toLowerCase())&&a.includes("cython".toLowerCase())&&a.includes("__init__.py".toLowerCase())&&u.push("zmq.cython"),a.includes("zmq.error.ZMQError")&&u.push("zmq.error"),u.length)return{reason:"zmqModuleFailure",message:y.failedToStartKernelDueToPyZmqFailure,moreInfoLink:"https://aka.ms/kernelFailuresPyzmq",telemetrySafeTags:u}}if(s&&s[1].toLowerCase().startsWith("importerror")){let u=LW(s[1]);if(u&&n){let p=kre(u.moduleName,u.fileName,r,n);return p||{reason:"importFailure",moduleName:u.moduleName,fileName:u.fileName,message:u.fileName?y.failedToStartKernelDueToImportFailureFromFile(u.moduleName,u.fileName):y.failedToStartKernelDueToImportFailure(u.moduleName),moreInfoLink:u.fileName?"https://aka.ms/kernelFailuresModuleImportErrFromFile":"https://aka.ms/kernelFailuresModuleImportErr",telemetrySafeTags:["import.error"]}}}let c="No module named".toLowerCase(),l="is not a package".toLowerCase();if(a.includes(c)&&!l){let u=Fe(o).map(m=>m.trim()).filter(m=>m.length).find(m=>m.toLowerCase().includes(c)),p=u?u.substring(u.toLowerCase().indexOf(c)+c.length).trim():"";if(u)return{reason:"moduleNotFound",moduleName:p,message:y.failedToStartKernelDueToMissingModule(p),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(a.includes(c)&&l){let u=Fe(o).map(b=>b.trim()).filter(b=>b.length).find(b=>b.toLowerCase().includes(c)),p=u?u.substring(u.toLowerCase().indexOf(c)+c.length).trim():"",m="",h="";p.split("'").length>2&&(m=p.split("'").slice(-2)[0]||"",m=m?`${m}.py`:"",h=m||"",p=p.split("'")[1]||p);let g=i.filter(b=>hn(b).toLowerCase()==="__init__.py").map(b=>hn(Ii(b)));return p&&m&&p!==m&&i.some(b=>hn(b).toLowerCase()===m.toLowerCase())?{reason:"overridingBuiltinModules",fileName:m,moduleName:p,message:y.fileSeemsToBeInterferingWithKernelStartup(m),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:p&&g&&p!==h&&g.some(b=>b.toLowerCase()===h.toLowerCase())?{reason:"overridingBuiltinModules",folderName:h,moduleName:p,message:y.moduleSeemsToBeInterferingWithKernelStartup(h),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:{reason:"moduleNotFound",moduleName:p,message:y.failedToStartKernelDueToMissingModule(p),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(e instanceof Ye&&e.category==="invalidkernel"&&i.length){let u=hn(i[0]);return{reason:"overridingBuiltinModules",fileName:u,moduleName:hn(i[0],".py"),message:y.fileSeemsToBeInterferingWithKernelStartup(u),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}else if(s&&s[1].toLowerCase().startsWith("ModuleNotFoundError".toLowerCase())){let u=LW(s[1]);if(u)return{reason:"moduleNotFound",moduleName:u.moduleName,message:y.failedToStartKernelDueToMissingModule(u.moduleName),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}if(e instanceof vs){let u=Fe(o).map(w=>w.trim()).reverse().find(w=>w.toLowerCase().includes("error: ")),p="AttributeError: 'Namespace' object has no attribute '_flags'",m=["jupyter.startup.failure"],h,g="jupyterStartFailure",b=Fe(e.message,{removeEmptyEntries:!0,trim:!0}).reverse().find(w=>w.toLowerCase().includes("error: "));if(b=b||Fe(e.stdErr||"",{removeEmptyEntries:!0,trim:!0}).reverse().find(w=>w.toLowerCase().includes("error: ")),a.includes(p.toLowerCase())?(g="jupyterStartFailureOutdatedTraitlets",u=y.failedToStartJupyterDueToOutdatedTraitlets(t||"",b||""),m.push("outdated.traitlets"),h="https://aka.ms/kernelFailuresJupyterTrailtletsOutdated"):(u=b?y.failedToStartJupyterWithErrorInfo(t||"",b):y.failedToStartJupyter(t||""),h=void 0),u)return{reason:g,message:u,pythonError:b,moreInfoLink:h,telemetrySafeTags:m}}}function LW(r){r=r.replace(/"/g,"'");let e=r.match(/'[^\\']*(\\'[^\\']*)*'/g),t=r.match(/\((.*?)\)/g),n,i;return e&&e[0].length>2&&(n=e[0],n=n.substring(1,n.length-1)),t&&t[0].length>2&&(i=t[0],i=i.substring(1,i.length-1)),n?{moduleName:n,fileName:i}:void 0}function kre(r,e,t,n){if(n&&t.length!==0&&e&&!e.toLowerCase().startsWith(n)&&t.some(i=>e.toLowerCase().startsWith(i.uri.fsPath.toLowerCase())))return{reason:"overridingBuiltinModules",fileName:e,moduleName:r,message:y.fileSeemsToBeInterferingWithKernelStartup(W(Nh.Uri.file(e),t||[])),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}function Oh(r){if(!r)return;let e=/\[([^\[\]]*)\]\((.*?)\)/gm,t;for(;(t=e.exec(r))!==null;)t.length===3&&(r=r.replace(t[0],`<a href='${t[2]}'>${t[1]}</a>`));let n=Fe(r,{removeEmptyEntries:!1,trim:!1}).map(i=>`\x1B[1;31m${i}`).join(`
`);return new Nh.NotebookCellOutput([Nh.NotebookCellOutputItem.error({message:"",name:"",stack:n})])}var _re=[Dre,Tre];function WW(r){let e=[],t=Array.isArray(r)?r[0].toLowerCase():r.toLowerCase();_re.forEach(i=>i(t,e));let n=sm([],t,void 0);return n?.telemetrySafeTags.length&&e.push(...n.telemetrySafeTags),Array.from(new Set(e)).join(",")}function Dre(r,e=[]){r.includes("ChildProcess.exithandler".toLowerCase())&&e.push("childproc.exit")}function Tre(r,e=[]){r.includes("KernelRestarter: restart failed".toLowerCase())&&e.push("KernelRestarter.failed")}function VW(){return(new Error().stack||"").split(`
`).filter(r=>r.includes(It))}async function BW(r,e){r.failed=!0,r.failureCategory=r.failureCategory||JA(e);let t=!_E.FetchError&&e?.name==="TypeError"&&e?.message==="Failed to fetch",i=(t||_E.FetchError!==void 0)&&Nre(e,t?TypeError:_E.FetchError);r.failureCategory==="unknown"&&i&&(r.failureCategory="fetcherror"),r.stackTrace=Rre(e),typeof e=="string"&&(r.failureSubCategory="errorisstring");let o=e.stdErr?e.stdErr:e.stack||"";if(!o)return;r.failureSubCategory=r.failureSubCategory||WW(o);let s=jW(o);s&&([r.pythonErrorFile,r.pythonErrorFolder,r.pythonErrorPackage]=await Promise.all([Promise.resolve(r.pythonErrorFile||vt(s.fileName)),Promise.resolve(r.pythonErrorFolder||vt(s.folderName)),Promise.resolve(r.pythonErrorPackage||vt(s.packageName))]))}function $A(r){if(r.stack&&Array.isArray(r.stack)){let e={...r,stack:r.stack.join(`
`)};return BS.parse.call(BS,e)}return BS.parse.call(BS,r)}function Rre(r){let e="";for(let t of $A(r)){let n=t.getFileName();if(n){let i=t.getLineNumber(),o=t.getColumnNumber();e+=`
	at ${Are(t)} ${n}:${i}:${o}`}else e+=`
	at <anonymous>`}return e.trim().replace(/\\/g,"/")}function Are(r){let e=[];return typeof r.getTypeName()=="string"&&r.getTypeName().length>0&&e.push(r.getTypeName()),typeof r.getMethodName()=="string"&&r.getMethodName().length>0&&e.push(r.getMethodName()),typeof r.getFunctionName()=="string"&&r.getFunctionName().length>0&&(e.length!==2||e.join(".")!==r.getFunctionName())&&e.push(r.getFunctionName()),e.join(".")}function Nre(r,e){return e?r instanceof e||r instanceof sn&&r.originalException instanceof e:(console.error("Error type is not defined",r),!1)}var $W=require("vscode");function Mre(){try{return require("vscode")===void 0?!1:HW()!==void 0}catch{return!1}}function TE(){return $W.workspace.getConfiguration("telemetry").inspect("enableTelemetry").globalValue===!1}var DE={};function Kh(r,e){let t=r;vS()&&t.startsWith("ds_")||(e===void 0?delete DE[t]:DE[t]=e)}var HA;function HW(){if(HA)return HA;let r=require("@vscode/extension-telemetry").default;return HA=new r(xj)}function qW(r,e){let t={};return Object.getOwnPropertyNames(e).forEach(n=>{if(!(e[n]===void 0||e[n]===null))try{t[n]=typeof e[n]=="string"?e[n]:typeof e[n]=="object"?"object":e[n].toString()}catch(i){x(`Failed to serialize ${n} for ${r}`,i)}}),t}function A(r,e,t,n){Tr()||!Mre()||Ore(r,e,t,n)}function Ore(r,e,t,n){let i=HW(),o={},s=r;n?(o={},Object.assign(o,DE),Object.assign(o,t||{}),BW(o,n).then(()=>{o=qW(s,o),i.sendTelemetryEvent(s,o,e)}).catch(f)):(t&&(o=qW(s,t)),Object.assign(o,DE),i.sendTelemetryEvent(s,o,e))}var JW=new Set;function dr(r,e){return function(t,n,i){let o=i.value;return i.value=function(...s){let a=e||{},c=new qe,l=`${r.toString()}${JSON.stringify(a)}`,u=!JW.has(l);JW.add(l);let p=o.apply(this,s);return p&&typeof p.then=="function"&&typeof p.catch=="function"?p.then(m=>{let h={...a};return u&&(h.firstTime=u),A(r,c?{duration:c?.elapsedTime}:void 0,h),m}).catch(m=>{let h={...a};h.failed=!0,A(r,c?{duration:c?.elapsedTime}:{},h,m)}):A(r,c?{duration:c?.elapsedTime}:void 0,a),p},i}}function Qr(r,e){return function(t,n,i){let o=i.value;return i.value=function(...s){return A(r,void 0,e),o.apply(this,s)},i}}function Kre(){return{isInsiderExtension:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether this is the Insider version of the Jupyter extension or not. Common to all events."},isPythonExtensionInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether Python extension is installed or not. Common to all events."},rawKernelSupported:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether the raw kernel is supported or not. Common to all events."}}}function At(){return{duration:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth",isMeasurement:!0}}}function Mo(){return{resourceType:{classification:"PublicNonPersonalData",comment:"",purpose:"FeatureInsight"}}}function dc(){return{failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureSubCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFile:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFolder:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorPackage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},stackTrace:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}}function qi(){return{properties:{actionSource:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},disableUI:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},userExecutedCell:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},resourceHash:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},pythonEnvironmentVersion:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPath:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPackages:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSessionId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelLanguage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelConnectionType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},isUsingActiveInterpreter:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},capturedEnvVars:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},newKernelPicker:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},...Mo()}}}var WCe={...At(),...dc(),...Kre()};var Fre,Lre,Ure,jre,Wre,Vre,Bre,qre,Jre,$re,Hre,Gre,zre,Qre,Yre,Xre,Zre,ene,tne,rne,nne,ine,one,sne,ane,cne,lne,une,pne,dne,mne,fne,hne,gne,vne,yne,bne,Ine,Sne,xne,Cne,wne,Ene,Pne,kne,_ne,Dne,Tne,Rne,Ane,Nne,Mne,One,Kne,Fne,Lne,Une,jne,Wne,Vne,Bne,qne,Jne,$ne,Hne,Gne,zne,Qne,Yne,Xne,Zne,eie,tie,rie,nie,iie,oie,sie,aie,cie,lie,uie,pie,die,mie,fie,hie,gie,vie,yie,bie,Iie,Sie,xie,Cie,wie,Eie,Pie,kie,_ie,Die,Tie,Rie,Aie,Nie,Mie,Oie,Kie,Fie,Lie,Uie,jie,Wie,Vie,Bie,qie,Jie,$ie,Hie,Gie,zie,Qie,Yie,Xie,Zie,eoe,toe,roe,noe,ioe,ooe,soe,aoe,coe,loe,uoe,poe,doe,moe,foe,hoe,goe,voe,yoe,boe,Ioe,Soe,xoe,Coe,woe,Eoe,Poe,koe,_oe,Doe,Toe,Roe,Aoe,Noe,Moe,GW=class{constructor(){this[Fre]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{totalActivateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},codeLoadingTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},workspaceFolderCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[Lre]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:At()};this[Ure]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[jre]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Wre]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{hashedNamev2:{classification:"SystemMetaData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...Mo()}};this[Vre]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{firstTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:At()};this[Bre]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{mimeType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...Mo()}};this[qre]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:At()};this[Jre]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[$re]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer","VariableViewer"]};this[Hre]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[Gre]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:At()};this[zre]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:At()};this[Qre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:{codeLensUpdateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},maxCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[Yre]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Xre]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Zre]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[ene]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[tne]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[rne]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{...dc(),failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Reason for failure to fetch kernel specs"},sessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},specsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSpecsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:At()};this[nne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},serverIdHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},providerExtensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},baseUrlHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelId:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelLanguage:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},isArgv0SameAsInterpreter:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[ine]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{serverIdHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},baseUrlHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isLocalHost:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isJupyterHub:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},reason:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[one]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[sne]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[ane]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:qi().properties,measures:{...At()}};this[cne]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[lne]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[une]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[pne]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"},cancelled:{classification:"SystemMetaData",purpose:"FeatureInsight"},successful:{classification:"SystemMetaData",purpose:"FeatureInsight"},opened:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[dne]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{scope:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[mne]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[fne]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[hne]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[gne]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[vne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},info:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[yne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[bne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Ine]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Sne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[xne]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{nbformat:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"},nbformat_minor:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"}}};this[Cne]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"User Action"};this[wne]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Ene]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Pne]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[kne]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[_ne]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Dne]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Tne]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Rne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Ane]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Nne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Mne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[One]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Kne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Fne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Lne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Une]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[jne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Wne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Vne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Bne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[qne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Jne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[$ne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Hne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Gne]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[zne]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Qne]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[Yne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Xne]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[Zne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[eie]={owner:"IanMatthewHuff",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[tie]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[rie]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[nie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"},isModulePresent:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pythonEnvType:{classification:"SystemMetaData",purpose:"FeatureInsight"},resourceHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},...Mo()},measures:At()};this[iie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[oie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",measures:At()};this[sie]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rows:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0},columns:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[aie]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rowsTimer:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[cie]={owner:"IanMatthewHuff",feature:["DataFrameViewer","VariableViewer"],source:"N/A"};this[lie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action"};this[uie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failedWithoutBackingFile:{classification:"SystemMetaData",purpose:"FeatureInsight"},failedWithBackingFile:{classification:"SystemMetaData",purpose:"FeatureInsight"},localHost:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[pie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[die]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},errorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},fallbackErrorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},zmqBinaries:{classification:"CallstackOrException",purpose:"FeatureInsight"}}};this[mie]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:At()};this[fie]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:{variableCount:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[hie]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{kind:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},usesShell:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[gie]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{...dc(),...Mo()},measures:{...At()}};this[vie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonPathDefined:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonEnvFound:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},isCreatedByUs:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[yie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[bie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",properties:{hasKernel:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the kernel was known at the time of creation"},hasOwner:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the window was created for a text file"},mode:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Creation mode: multiple, perfile or single"},restored:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Was the window restored from a previous session"}},measures:{windowCount:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Number of active interactive windows the user has open",isMeasurement:!0}}};this[Iie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{cdnSearched:{classification:"SystemMetaData",purpose:"FeatureInsight"},hashedName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},modelName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Sie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{type:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:At()};this[xie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[Cie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[wie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},isOnline:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Eie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Pie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[kie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{selection:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[_ie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",measures:{totalOverheadInMs:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},numberOfMessagesWaitedOn:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},averageWaitTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},numberOfRegisteredHooks:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[Die]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[Tie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{msg_type:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[Rie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:{...At(),attempts:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{...qi().properties,timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[Aie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:At()};this[Nie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],measures:{...At(),pendingInspectRequestsBefore:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},pendingInspectRequestsAfter:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{...qi().properties,...dc()}};this[Mie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Code Execution"],measures:At(),properties:{...qi().properties,...dc(),extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Oie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],properties:{...qi().properties,...dc()}};this[Kie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],properties:{...qi().properties,...dc()}};this[Fie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:qi().properties};this[Lie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{result:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},...Mo(),...dc(),...qi().properties},measures:{...At()}};this[Uie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{...Mo(),...dc(),...qi().properties},measures:At()};this[jie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{...Mo(),...dc(),...qi().properties,envMissingReason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},isEmptyCondaEnv:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},pythonEnvType:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},fileExists:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[Wie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...Mo(),...qi().properties},measures:{reason:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}}};this[Vie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{exitReason:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...Mo(),...qi().properties},measures:{exitCode:{classification:"CallstackOrException",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[Bie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{isRequestToShutdownRestartSession:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...Mo(),...qi().properties}};this[qie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...Mo(),...qi().properties}};this[Jie]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[$ie]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{kernelSpecCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelInterpreterCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelLiveCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},localKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},remoteKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[Hie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{outputType:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[Gie]={owner:"IanMatthewHuff",feature:["InteractiveWindow"],tags:["IntelliSense"],source:"N/A",measures:At(),properties:{isResultNull:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[zie]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:At()};this[Qie]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[Yie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:At()};this[Xie]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"N/A",measures:At()};this[Zie]={owner:"amunger",feature:"N/A",source:"N/A",properties:{command:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[eoe]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{newState:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[toe]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:{numberOfDimensions:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[roe]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{source:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[noe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},dependenciesInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[ioe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[ooe]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[soe]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[aoe]={owner:"roblourens",feature:["Debugger"],properties:{status:{classification:"SystemMetaData",purpose:"FeatureInsight"}},source:"N/A"};this[coe]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[loe]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[uoe]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[poe]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[doe]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[moe]={owner:"roblourens",feature:["Debugger"],source:"N/A",properties:{reason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[foe]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{...At(),requestDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},timesExceededTimeout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},completionItems:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},monacoLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},completed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusAfterRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusBeforeRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[hoe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[goe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[voe]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"}},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[yoe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{accessAllowed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[boe]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},cancelledAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestAcknowledgedAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestSentAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},...At()},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},mimeTypes:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}};this[Ioe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{clientExtId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Soe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},allowed:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[xoe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},providerId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}},measures:At()};this[Coe]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[woe]={owner:"roblourens",feature:["InteractiveWindow","Debugger"],source:"N/A"};this[Eoe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...qi().properties,...Mo()}};this[Poe]={owner:"donjayamanne",source:"N/A",feature:["KernelPicker"]};this[koe]={owner:"donjayamanne",source:"User Action",feature:["KernelPicker"]};this[_oe]={owner:"amunger",feature:"N/A",source:"N/A",properties:{testName:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},testResult:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},perfWarmup:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},commitHash:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},timedCheckpoints:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[Doe]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{matchedReason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Toe]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{requireEntryPointCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}},properties:{failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},failure:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},patternUsedToRegisterRequireConfig:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},widgetFolderNameHash:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Roe]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:At()};this[Aoe]={owner:"donjayamanne",feature:["DataFrameViewer"],source:"N/A"};this[Noe]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Moe]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"}}static{Fre="EXTENSION.LOAD",Lre="DS_INTERNAL.EXPERIMENT_LOAD",Ure="ENVFILE_VARIABLE_SUBSTITUTION",jre="ENVFILE_WORKSPACE",Wre="HASHED_PACKAGE_NAME",Vre="DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",Bre="DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",qre="DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",Jre="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX",$re="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",Hre="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX",Gre="DATASCIENCE.ADD_CELL_BELOW",zre="DS_INTERNAL.CODE_LENS_ACQ_TIME",Qre="DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",Yre="DATASCIENCE.DEBUG_CONTINUE",Xre="DATASCIENCE.DEBUG_CURRENT_CELL",Zre="DATASCIENCE.DEBUG_STEP_OVER",ene="DATASCIENCE.DEBUG_STOP",tne="DATASCIENCE.DEBUG_FILE_INTERACTIVE",rne="DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",nne="DS_INTERNAL.JUPYTER_KERNEL_SPEC",ine="DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",one="DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER",sne="DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER",ane="DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",cne="DATASCIENCE.EXPORT_PYTHON_FILE",lne="DATASCIENCE.EXPORT_PYTHON_FILE_AND_OUTPUT",une="DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",pne="DATASCIENCE.EXPORT_NOTEBOOK_AS",dne="DATASCIENCE.IMPORT_NOTEBOOK",mne="DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",fne="DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",hne="DS_INTERNAL.GET_PASSWORD_FAILURE",gne="DS_INTERNAL.GET_PASSWORD_SUCCESS",vne="DS_INTERNAL.JUPYTER_HUB_PASSWORD",yne="DS_INTERNAL.SHOW_DATA_NO_PANDAS",bne="DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD",Ine="DS_INTERNAL.SHOW_DATA_PANDAS_OK",Sne="DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED",xne="DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",Cne="DATASCIENCE.OPEN_PLOT_VIEWER",wne="DATASCIENCE.RUN_ALL_CELLS",Ene="DATASCIENCE.RUN_SELECTION_OR_LINE",Pne="DATASCIENCE.RUN_CURRENT_CELL",kne="DATASCIENCE.RUN_ALL_CELLS_ABOVE",_ne="DATASCIENCE.RUN_CELL_AND_ALL_BELOW",Dne="DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE",Tne="DATASCIENCE.RUN_FILE_INTERACTIVE",Rne="DATASCIENCE.RUN_TO_LINE",Ane="DATASCIENCE.RUN_FROM_LINE",Nne="DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION",Mne="DATASCIENCE.RUN_INSERT_CELL_BELOW",One="DATASCIENCE.RUN_INSERT_CELL_ABOVE",Kne="DATASCIENCE.RUN_DELETE_CELLS",Fne="DATASCIENCE.RUN_SELECT_CELL",Lne="DATASCIENCE.RUN_SELECT_CELL_CONTENTS",Une="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE",jne="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW",Wne="DATASCIENCE.RUN_MOVE_CELLS_UP",Vne="DATASCIENCE.RUN_MOVE_CELLS_DOWN",Bne="DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN",qne="DATASCIENCE.RUN_CHANGE_CELL_TO_CODE",Jne="DATASCIENCE.GOTO_NEXT_CELL_IN_FILE",$ne="DATASCIENCE.GOTO_PREV_CELL_IN_FILE",Hne="DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW",Gne="DATASCIENCE.SELFCERTSMESSAGECLOSE",zne="DATASCIENCE.SELFCERTSMESSAGEENABLED",Qne="DATASCIENCE.USER_INSTALLED_JUPYTER",Yne="DATASCIENCE.USER_INSTALLED_PANDAS",Xne="DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER",Zne="DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS",eie="DS_INTERNAL.PYTHON_NOT_INSTALLED",tie="DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",rie="DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",nie="DS_INTERNAL.PYTHON_MODULE_INSTALL",iie="DS_INTERNAL.SHIFTENTER_BANNER_SHOWN",oie="DATASCIENCE.START_SHOW_DATA_EXPLORER",sie="DATASCIENCE.SHOW_DATA_EXPLORER",aie="DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",cie="DATASCIENCE.FAILED_SHOW_DATA_EXPLORER",lie="DATASCIENCE.REFRESH_DATA_VIEWER",uie="DS_INTERNAL.JUPYTER_STARTED_SESSION_WITH_BACKING_FILE",pie="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",die="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",mie="DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME",fie="DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",hie="DATASCIENCE.KERNEL_SPEC_LANGUAGE",gie="DS_INTERNAL.KERNEL_LAUNCHER_PERF",vie="GLOBAL_PYTHON_KERNELSPEC",yie="DS_INTERNAL.NEW_FILE_USED_IN_INTERACTIVE",bie="DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",Iie="DS_INTERNAL.IPYWIDGET_USED_BY_USER",Sie="DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",xie="DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED",Cie="DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",wie="DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",Eie="DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",Pie="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN",kie="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",_ie="DS_INTERNAL.IPYWIDGET_OVERHEAD",Die="DS_INTERNAL.IPYWIDGET_RENDER_FAILURE",Tie="DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",Rie="DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",Aie="DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH",Nie="DATASCIENCE.EXECUTE_CELL",Mie="DATASCIENCE.EXECUTE_CODE",Oie="DATASCIENCE.RESUME_EXECUTE_CELL",Kie="DATASCIENCE.NOTEBOOK_START",Fie="DS_INTERNAL.SWITCH_KERNEL",Lie="DATASCIENCE.NOTEBOOK_INTERRUPT",Uie="DATASCIENCE.NOTEBOOK_RESTART",jie="DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",Wie="DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",Vie="DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",Bie="DS_INTERNAL.RAWKERNEL_SESSION_SHUTDOWN",qie="DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",Jie="DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER",$ie="DS_INTERNAL.KERNEL_COUNT",Hie="DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",Gie="DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",zie="DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED",Qie="DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE",Yie="DATAVIEWER.WEBVIEW_LOADED",Xie="PLOTVIEWER.WEBVIEW_LOADED",Zie="DS_INTERNAL.COMMAND_EXECUTED",eoe="DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",toe="DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",roe="DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",noe="DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",ioe="DATASCIENCE.RECOMMENT_EXTENSION",ooe="DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP",soe="DATASCIENCE.DEBUGGING.CLOSED_MODAL",aoe="DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",coe="DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE",loe="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE",uoe="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_IW_JUPYTER",poe="DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL",doe="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL",moe="DATASCIENCE.DEBUGGING.ENDED_SESSION",foe="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",hoe="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",goe="DATASCIENCE.JUPYTER_KERNEL_API_USAGE",voe="DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",yoe="DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",boe="DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",Ioe="DATASCIENCE.JUPYTER_API_USAGE",Soe="DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",xoe="DATASCIENCE.JUPYTER_KERNEL_STARTUP_HOOK",Coe="DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE",woe="DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE",Eoe="DATASCIENCE.KERNEL_CRASH",Poe="DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER",koe="DATASCIENCE.JUPYTER_KERNEL_FILTER_USED",_oe="DS_INTERNAL.RUNTEST",Doe="DS_INTERNAL.PREFERRED_KERNEL_EXACT_MATCH",Toe="DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",Roe="DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",Aoe="DATASCIENCE.NO_ACTIVE_KERNEL_SESSION",Noe="DATAVIEWER.USING_INTERPRETER",Moe="DATAVIEWER.USING_KERNEL"}};var tp=require("vscode");function fc(r){let e=mc(r.uri);return vt(e.path)}function Oo(r=tp.Uri.file(""),e=tp.Uri.file(""),t=qr(),n=!1){let i=mc(r,t,t=="Windows"||n),o=mc(e,t,t=="Windows"||n);return i===o||bi(i,o,!0)}function mc(r=tp.Uri.file(""),e=qr(),t=!1){let n=Pe(r);return t&&(n=n.toLowerCase()),n.endsWith("/bin/python")?["Linux","OSX"].includes(e)?n.endsWith("/bin/python")&&n.split("/").length>4?tp.Uri.file(n.replace("/bin/python","/python")):tp.Uri.file(n):tp.Uri.file(n):tp.Uri.file(n)}var zW=require("vscode");var co=class{constructor(){this.promises=new Set;this._onStateChange=new zW.EventEmitter;this.onStateChange=this._onStateChange.event}get isComplete(){return this.promises.size===0}dispose(){this._onStateChange.dispose()}push(e){this.promises.add(e),this._onStateChange.fire(),e.finally(()=>{this.promises.delete(e),this.isComplete&&this._onStateChange.fire()}).catch(f)}};var RE=class extends sn{constructor(e){super("Python Extension failed to activate",e,"pythonExtension")}};var AE=class extends Ye{constructor(){super("pythonExtension","Python Extension API not exported")}};var fV=_(qh());var mN=_(dV());function np(r){if("executable"in r){let s=[];typeof r.version?.major=="number"&&(s.push(r.version.major.toString()),typeof r.version.minor=="number"&&(s.push(r.version.minor.toString()),typeof r.version.micro=="number"&&s.push(r.version.micro.toString())));let a=s.length?s.join("."):"",c=r.environment?hn(r.environment?.folderUri):"",l=a?`Python ${a}`:"Python";return ua(r)&&c?c:c?`${c} (${l})`:l}let e=ep($i(r)||"").trim(),t=r.envType==="Conda"&&r.isCondaEnvWithoutPython===!0,n=e?`Python ${e}`:"Python",i=VE(r);if(t&&i)return i;let o=[];return i&&o.push(i),r.envType&&r.envType!=="Unknown"&&o.push(r.envType),[n,o.length?`(${o.join(": ")})`:""].join(" ").trim()}function VE(r){let e=r.envName;return r.envPath&&r.envType==="Conda"&&!r.envName&&(e=hn(r.envPath)),e}var bse=["Unknown","Conda","PipEnv","Poetry","Pyenv","Venv","VirtualEnv","VirtualEnvWrapper"];function Jr(r){if(r.environment?.type==="Conda")return"Conda";let e=[["Conda","Conda"],["Pyenv","Pyenv"],["Pipenv","PipEnv"],["Poetry","Poetry"],["VirtualEnvWrapper","VirtualEnvWrapper"],["VirtualEnv","VirtualEnv"],["Venv","Venv"]];for(let[t,n]of e)if(r.tools.includes(t))return n;for(let t of bse)if(r.tools.some(n=>n.toLowerCase()===t.toLowerCase()))return t;return"Unknown"}function ua(r){return Jr(r)==="Conda"&&!r.executable.uri}var Ml;function mV(r){Ml=r}async function pa(r){if(!r?.id)return;if(Ml){let n=Ml.environments.known.find(i=>i.id===r.id);if(n?.executable?.sysPrefix)return n.executable.sysPrefix}let t=await(await mN.PythonExtension.api()).environments.resolveEnvironment(r.id).then(n=>n?.executable?.sysPrefix);return t||j(`Unable to find sysPrefix for interpreter ${W(r.id)}`),t}function QS(r){if(!r?.id)return;if(!Ml)throw new Error("Python API not initialized");return Ml.environments.known.find(t=>t.id===r.id)?.executable?.sysPrefix}async function Jh(r){if(!r?.id)return;if(Ml){let n=Ml.environments.known.find(i=>i.id===r.id);if(n?.version)return n.version}let t=await(await mN.PythonExtension.api()).environments.resolveEnvironment(r.id);return t?.version||j(`Unable to find Version for interpreter ${W(r.id)}`),t?.version}function $i(r){if(!r?.id)return;if(!Ml)throw new Error("Python API not initialized");return Ml.environments.known.find(t=>t.id===r.id)?.version}var pm=require("vscode");var BE=class{};function bs(r,e=""){let t=r?pm.workspace.getWorkspaceFolder(r):pm.workspace.workspaceFolders?pm.workspace.workspaceFolders[0]:void 0;return t?In(qr()==="Windows"?t.uri.path.toUpperCase():t.uri.path):e}function Is(){return(Array.isArray(pm.workspace.workspaceFolders)&&pm.workspace.workspaceFolders.length>0?pm.workspace.workspaceFolders[0]:void 0)?.uri}function YS(r,e){if(r){let t={...r,uri:Xe.Uri.file(r.path||""),id:e||r.id,envPath:r.envPath?Xe.Uri.file(r.envPath):void 0,displayPath:"displayPath"in r&&typeof r.displayPath=="string"?Xe.Uri.file(r.displayPath):void 0};return delete t.path,r.envPath||delete t.envPath,t}}function Ise(r,e){let t=r.tools,n=[["Conda","Conda"],["Pyenv","Pyenv"],["Pipenv","PipEnv"],["Poetry","Poetry"],["VirtualEnvWrapper","VirtualEnvWrapper"],["VirtualEnv","VirtualEnv"],["Venv","Venv"]],i=t.length?t[0]:"Unknown";if(r.environment?.type==="Conda")i="Conda";else{for(let[c,l]of n)if(t.includes(c)){i=l;break}i==="Unknown"&&r.environment?.type==="VirtualEnvironment"&&(i="VirtualEnv")}let o=!1,s,a=r.id;if(r.executable.uri)s=r.executable.uri;else if(i==="Conda"&&e)o=!0,s=qr()==="Windows"?Xe.Uri.joinPath(r.environment?.folderUri||Xe.Uri.file(r.path),"python.exe"):Xe.Uri.joinPath(r.environment?.folderUri||Xe.Uri.file(r.path),"bin","python");else{j(`Python environment ${W(r.id)} excluded as Uri is undefined`);return}return{id:a,envPath:r.environment?.folderUri,displayPath:r.environment?.folderUri||Xe.Uri.file(r.path),envName:r.environment?.name||"",uri:s,displayName:r.environment?.name||"",envType:i,isCondaEnvWithoutPython:o}}function qE(r,e){let t=Jr(r),n=!1,i,o=r.id;if(r.executable.uri)i=r.executable.uri;else if(t==="Conda"&&e)n=!0,i=qr()==="Windows"?Xe.Uri.joinPath(r.environment?.folderUri||Xe.Uri.file(r.path),"python.exe"):Xe.Uri.joinPath(r.environment?.folderUri||Xe.Uri.file(r.path),"bin","python");else{j(`Python environment ${W(r.id)} excluded as Uri is undefined`);return}return{id:o,envPath:r.environment?.folderUri,displayPath:r.environment?.folderUri||Xe.Uri.file(r.path),envName:r.environment?.name||"",uri:i,displayName:r.environment?.name||"",envType:t,isCondaEnvWithoutPython:n}}function Ol(r){if(r){let e=Object.assign({},r,{path:Pe(r.uri),envPath:r.envPath?Pe(r.envPath):void 0,displayPath:r.displayPath?Pe(r.displayPath):void 0});return delete e.uri,e}}var $h=class{constructor(e,t){this.disposables=e;this.extensionChecker=t;this.api=ue();this.didActivatePython=new Xe.EventEmitter;this._pythonExtensionHooked=ue();this.extensionChecker.isPythonExtensionInstalled||Xe.extensions.onDidChange(async()=>{this.extensionChecker.isPythonExtensionInstalled&&await this.registerHooks()},this,this.disposables),this.disposables.push(this.didActivatePython)}get onDidActivatePythonExtension(){return this.didActivatePython.event}get pythonExtensionHooked(){return this._pythonExtensionHooked.promise}get pythonExtensionVersion(){return this._pythonExtensionVersion}getApi(){return this.init().catch(f),this.api.promise}async getNewApi(){await this.init();let e=Xe.extensions.getExtension(ei);return e?.packageJSON?.version&&(this._pythonExtensionVersion=new fV.SemVer(e?.packageJSON?.version)),e?.exports&&mV(e.exports),e?.exports}setApi(e){this.api.resolved||!Xe.workspace.isTrusted||this.api.resolve(e)}async init(){if(this.initialized)return;Xe.extensions.getExtension(ei)?await this.registerHooks():await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),this.initialized=!0}async registerHooks(){if(this.hooksRegistered)return;let e=Xe.extensions.getExtension(ei);if(!e)return;let t=!1;if(!e.isActive)try{await e.activate(),t=!0}catch(n){x("Failed activating the python extension: ",n),this.api.reject(new RE(n));return}this.hooksRegistered||(this.hooksRegistered=!0,t&&this.didActivatePython.fire(),e.exports?.jupyter?e.exports.jupyter.registerHooks():(x("Python extension is not exporting the jupyter API"),this.api.reject(new AE)),this._pythonExtensionHooked.resolve())}};$h=v([(0,Ss.injectable)(),d(0,(0,Ss.inject)(F)),d(1,(0,Ss.inject)(ze))],$h);var ip=class{constructor(e){this.disposables=e;this.pythonExtensionInstallationStatusChanged=new Xe.EventEmitter;Xe.extensions.onDidChange(this.extensionsChangeHandler.bind(this),this,this.disposables),this.previousInstallState=this.isPythonExtensionInstalled}get onPythonExtensionInstallationStatusChanged(){return this.pythonExtensionInstallationStatusChanged.event}get isPythonExtensionInstalled(){return Xe.extensions.getExtension(ei)!==void 0}get isPythonExtensionActive(){return Xe.extensions.getExtension(ei)?.isActive===!0}async directlyInstallPythonExtension(){return Xe.commands.executeCommand("workbench.extensions.installExtension",ei,{context:{skipWalkthrough:!0}})}async showPythonExtensionInstallRequiredPrompt(){if(!Xe.workspace.isTrusted)return;ip.promptDisplayed=!0;let e=ye.bannerLabelYes;A("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"}),await Xe.window.showInformationMessage(y.pythonExtensionRequired,{modal:!0},e)===e?(A("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"download"}),await this.installPythonExtension()):A("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtension(){Xe.commands.executeCommand("extension.open",ei).then(f,f)}async extensionsChangeHandler(){let e=this.isPythonExtensionInstalled;e!==this.previousInstallState&&(this.pythonExtensionInstallationStatusChanged.fire(e?"installed":"uninstalled"),this.previousInstallState=e)}};ip=v([(0,Ss.injectable)(),d(0,(0,Ss.inject)(F))],ip);var Hh=class{constructor(e,t,n,i){this.apiProvider=e;this.extensionChecker=t;this.disposables=n;this.context=i;this.didChangeInterpreter=new Xe.EventEmitter;this.didChangeInterpreters=new Xe.EventEmitter;this._onDidEnvironmentVariablesChange=new Xe.EventEmitter;this._onDidRemoveInterpreter=new Xe.EventEmitter;this.onDidRemoveInterpreter=this._onDidRemoveInterpreter.event;this.onDidEnvironmentVariablesChange=this._onDidEnvironmentVariablesChange.event;this.interpreterListCachePromise=void 0;this._status="idle";this._onDidChangeStatus=new Xe.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshPromises=new co;this.pauseEnvDetection=!1;this.onResumeEnvDetection=new Xe.EventEmitter;this._interpreters=new Map;this.workspaceCachedActiveInterpreter=new Set;this.lastLoggedResourceAndInterpreterId="";this.pythonEnvHashes=new Map;this.loggedEnvsWithoutInterpreterPath=new Set;this.pendingInterpreterChangeEventTriggers=new Map;this.pendingInterpretersChangeEventTriggers=new Map;this.extensionChecker.isPythonExtensionInstalled&&(this.extensionChecker.isPythonExtensionActive||this.apiProvider.onDidActivatePythonExtension(()=>{this.builtListOfInterpretersAtLeastOnce=!1,this.hookupOnDidChangeInterpreterEvent(),this.buildListOfInterpretersForFirstTime()},this,this.disposables)),Xe.workspace.onDidChangeWorkspaceFolders(this.onDidChangeWorkspaceFolders,this,n),Xe.workspace.onDidGrantWorkspaceTrust(()=>this.refreshInterpreters(!0),this,this.disposables),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this.refreshPromises),this.disposables.push(this.onResumeEnvDetection),this.refreshPromises.onStateChange(()=>{this.status=this.refreshPromises.isComplete?"idle":"refreshing"}),Xe.workspace.onDidGrantWorkspaceTrust(()=>this.populateCachedListOfInterpreters(!0).catch(f),this,this.disposables)}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}get known(){return this.api?.environments.known||[]}async resolveEnvironment(e){return this.getApi().then(t=>{if(!t)return;let n=typeof e=="string"?t.environments.known.find(i=>i.id===e||i.path===e):e;return t.environments.resolveEnvironment(n||e)})}get onDidChangeInterpreter(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreter.event}get onDidChangeInterpreters(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreters.event}get resolvedEnvironments(){return this.hookupOnDidChangeInterpreterEvent(),Array.from(this._interpreters.values()).map(e=>e.resolved)}get environmentsFound(){return this.getApi().catch(f),this.hookupOnDidChangeInterpreterEvent(),(this.api?.environments?.known.length??0)>0}getInterpreters(){if(this.hookupOnDidChangeInterpreterEvent(),!this.interpreterListCachePromise){this.getInterpretersCancellation?.cancel(),this.getInterpretersCancellation?.dispose();let e=this.getInterpretersCancellation=new Xe.CancellationTokenSource;this.interpreterListCachePromise=this.getInterpretersImpl(e.token),this.interpreterListCachePromise.finally(()=>e.dispose()).catch(f),this.refreshPromises.push(this.interpreterListCachePromise)}return this.interpreterListCachePromise}pauseInterpreterDetection(e){e.isCancellationRequested||(this.pauseEnvDetection=!0,e.onCancellationRequested(()=>{this.pauseEnvDetection=!1,this.triggerPendingEvents()},this,this.disposables))}async refreshInterpreters(e=!1){let t=(async()=>{let n=await this.getApi();if(n)try{await n.environments.refreshEnvironments({forceRefresh:e}),this.interpreterListCachePromise=void 0,await this.getInterpreters(),E("Refreshed Environments")}catch{x("Failed to refresh the list of interpreters")}})();this.refreshPromises.push(t),this.refreshPromises.push(t.then(()=>ji(1e3))),await t}async getActiveInterpreter(e){if(!Xe.workspace.isTrusted)return;let t=new qe;this.hookupOnDidChangeInterpreterEvent(),!e&&Xe.workspace.workspaceFolders?.length===1&&(e=Xe.workspace.workspaceFolders[0].uri),Xe.workspace.workspaceFolders?.length&&(e=(e?Xe.workspace.getWorkspaceFolder(e)?.uri:void 0)||Xe.workspace.workspaceFolders[0].uri);let n=bs(e),i=this.getApi().then(async o=>{if(!o)return;let s=o.environments.getActiveEnvironmentPath(e),a=await o.environments.resolveEnvironment(s);return this.trackResolvedEnvironment(a)});return i.then(()=>{this.workspaceCachedActiveInterpreter.has(n)||(this.workspaceCachedActiveInterpreter.add(n),A("DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",{duration:t.elapsedTime},{firstTime:!0}))}).catch(o=>{j(`Failed to get active interpreter from Python for workspace ${n}`,o)}),(Zn||[Xe.ExtensionMode.Development,Xe.ExtensionMode.Test].includes(this.context.extensionMode))&&i.then(o=>{let s=`${W(e)}'-${W(o?.id)}`;if(this.lastLoggedResourceAndInterpreterId===s)return;this.lastLoggedResourceAndInterpreterId=s;let a=$i(o);z(`Active Interpreter ${e?`for '${W(e)}' `:""}is ${W(o?.id)} (${o?.envType}, '${o?.envName}', ${a?.major}.${a?.minor}.${a?.micro})`)}).catch(f),i}getInterpreterHash(e){return this.pythonEnvHashes.get(e)}async getInterpreterDetails(e,t){if(!Xe.workspace.isTrusted)throw new Error("Unable to determine active Interpreter as Workspace is not trusted");this.hookupOnDidChangeInterpreterEvent();try{return await this.getApi().then(async n=>{if(!n||t?.isCancellationRequested)return;let i=n.environments.known.find(c=>Vn(e)?Oo(c.executable.uri,e):typeof e=="string"?c.id===e:Oo(Xe.Uri.file(c.path),Xe.Uri.file(e.path))),o=Vn(e)?W(e):typeof e=="string"?e:W(Xe.Uri.file(e.path));if(i){let c=await n.environments.resolveEnvironment(i),l=this.trackResolvedEnvironment(c);return ne(`Interpreter details for ${o} from Python is ${JSON.stringify(c)} and our mapping is ${JSON.stringify(l)}`),l}let s=o;if(this.loggedEnvsWithoutInterpreterPath.has(s)||(this.loggedEnvsWithoutInterpreterPath.add(s),j(`No interpreter with path ${o} found in Python API, will convert Uri path to string as Id ${o}`)),t?.isCancellationRequested)return;let a=await n.environments.resolveEnvironment(Vn(e)?e.fsPath:typeof e=="string"?e:e.path);return this.trackResolvedEnvironment(a)})}catch(n){j(`Failed to get Python interpreter details from Python Extension API for ${typeof e=="string"?e:W(Vn(e)?e:Xe.Uri.file(e.path))}`,n);return}}trackResolvedEnvironment(e){if(e){let t=this.apiProvider.pythonExtensionVersion&&this.apiProvider.pythonExtensionVersion.compare("2023.3.10341119")>=0,n=Ise(e,!!t);if(!n)return;if(fc(n).then(i=>{this.pythonEnvHashes.set(n.id,i)}).catch(f),!this._interpreters.get(e.id)||!Ao(n,this._interpreters.get(e.id)?.resolved)){let i=this._interpreters.get(e.id);i?.resolved&&Object.assign(i.resolved,n),this._interpreters.set(e.id,{resolved:n}),this.triggerEventIfAllowed("interpretersChangeEvent",n)}return n}}triggerEventIfAllowed(e,t){if(e==="interpreterChangeEvent"?this.pendingInterpreterChangeEventTriggers.set(t?.id||"",t):this.pendingInterpretersChangeEventTriggers.set(t?.id||"",t),!this.pauseEnvDetection){this.triggerPendingEvents();return}}triggerPendingEvents(){this.pendingInterpreterChangeEventTriggers.forEach(t=>this.didChangeInterpreter.fire(t)),this.pendingInterpreterChangeEventTriggers.clear();let e=Array.from(this.pendingInterpretersChangeEventTriggers.values());if(e.length){let t=e.filter(n=>!!n);t.length!==e.length&&t.length===0?this.didChangeInterpreters.fire([]):this.didChangeInterpreters.fire(t)}this.pendingInterpretersChangeEventTriggers.clear()}async getApi(){if(this.extensionChecker.isPythonExtensionInstalled)return this.apiPromise||(this.apiPromise=this.apiProvider.getNewApi(),this.apiPromise.then(e=>e?this.api=e:void 0).catch(f)),this.apiPromise}onDidChangeWorkspaceFolders(){this.interpreterListCachePromise=void 0}populateCachedListOfInterpreters(e){e&&(this.interpreterListCachePromise=void 0);let t=this.getInterpreters().catch(f);return this.refreshPromises.push(t),this.refreshPromises.push(t.then(()=>ji(1e3))),t}async getInterpretersImpl(e,t=0){if(!Xe.workspace.isTrusted)return[];this.extensionChecker.isPythonExtensionInstalled&&(this.builtListOfInterpretersAtLeastOnce=!0);let n=[],i=!1;return await this.getApi().then(async o=>{if(!o||e.isCancellationRequested)return[];let s=o.environments.known.length;try{await Promise.all(o.environments.known.map(async a=>{try{let c=await o.environments.resolveEnvironment(a),l=this.trackResolvedEnvironment(c);l?n.push(l):a.executable.uri&&a.environment?.type!=="Conda"&&x(`Failed to get env details from Python API for ${W(a.id)} without an error`)}catch(c){x(`Failed to get env details from Python API for ${W(a.id)}`,c)}})),this.triggerEventIfAllowed("interpretersChangeEvent",void 0)}catch(a){x("Failed to refresh list of interpreters and get their details",a)}s<o.environments.known.length&&(i=!0)}),e.isCancellationRequested?[]:i&&t<10?(E(`List of interpreters changed after a while, will need to rebuild it again, counter = ${t}`),this.getInterpretersImpl(e,t++)):(E(`Full interpreter list is length: ${n.length}, ${n.map(o=>`${o.id}:${o.displayName}:${o.envType}:${W(o.uri)}`).join(", ")}`),n)}buildListOfInterpretersForFirstTime(){this.builtListOfInterpretersAtLeastOnce||(this.extensionChecker.isPythonExtensionActive&&(this.builtListOfInterpretersAtLeastOnce=!0,this.populateCachedListOfInterpreters().catch(f)),this.extensionChecker.onPythonExtensionInstallationStatusChanged(e=>{e==="installed"&&this.extensionChecker.isPythonExtensionActive&&this.populateCachedListOfInterpreters().catch(f)},this,this.disposables))}hookupOnDidChangeInterpreterEvent(){this.eventHandlerAdded||(this.buildListOfInterpretersForFirstTime(),this.getApi().then(e=>{!this.eventHandlerAdded&&e&&(this.eventHandlerAdded=!0,e.environments.onDidEnvironmentVariablesChange(t=>{E(`Detected changes to env file ${t.resource?.uri?.path} in PythonApi`),this._onDidEnvironmentVariablesChange.fire()},this,this.disposables),e.environments.onDidChangeActiveEnvironmentPath(()=>{E("Detected change in Active Python environment via Python API"),this.interpreterListCachePromise=void 0,this.workspaceCachedActiveInterpreter.clear(),this.triggerEventIfAllowed("interpreterChangeEvent",void 0)},this,this.disposables),e.environments.onDidChangeEnvironments(async t=>{E(`Python API env change detected, ${t.type} => '${t.env.id}'`),t.type==="remove"&&this._interpreters.delete(t.env.id);let n=!!(t.type==="update"&&this._interpreters.get(t.env.id)?.resolved.isCondaEnvWithoutPython&&t.env.executable.uri);this.populateCachedListOfInterpreters(!0).finally(()=>{let i=this._interpreters.get(t.env.id);t.type==="remove"&&!i?(this.triggerEventIfAllowed("interpreterChangeEvent",void 0),this.triggerEventIfAllowed("interpretersChangeEvent",void 0),this._onDidRemoveInterpreter.fire({id:t.env.id})):t.type==="update"&&i&&n&&!i.resolved.isCondaEnvWithoutPython&&(this.triggerEventIfAllowed("interpreterChangeEvent",i.resolved),this.triggerEventIfAllowed("interpretersChangeEvent",i.resolved))}).catch(f)},this,this.disposables))}).catch(f))}};Hh=v([(0,Ss.injectable)(),d(0,(0,Ss.inject)(Gt)),d(1,(0,Ss.inject)(ze)),d(2,(0,Ss.inject)(F)),d(3,(0,Ss.inject)(lt))],Hh);var Gh=require("vscode");function JE(r,e){let t=r.length>0?`?token=${r}`:"";return`${e}${t}`}function zh(r,e,t){return r?t.createSystemVariables(e).resolve(r):e?pt(Pe(e)):process.cwd()}async function $E(r,e){let t=y.jupyterSelfCertEnable,n=y.jupyterSelfCertClose,i=await Gh.window.showErrorMessage(y.jupyterSelfCertFail(e),{modal:!0},t,n);return i===t?(A("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await r.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,Gh.ConfigurationTarget.Workspace),!0):(i===n&&A("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}async function HE(r,e){let t=y.jupyterSelfCertEnable,n=y.jupyterSelfCertClose,i=await Gh.window.showErrorMessage(y.jupyterExpiredCertFail(e),{modal:!0},t,n);return i===t?(A("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await r.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,Gh.ConfigurationTarget.Workspace),!0):(i===n&&A("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}function XS(r,e,t,n,i,o,s){let a=e.baseUrl,c=e.token,l=new URL(e.baseUrl).hostname,u=e.authorizationHeader&&Object.keys(e?.authorizationHeader??{}).length>0?e.authorizationHeader:void 0,p=u?()=>u:void 0,m={baseUrl:a,appUrl:"",wsUrl:a.replace("http","ws"),fetch:e.fetch,WebSocket:e.WebSocket},h=t.getRequestInit();(!(c===""||c==="null")||p)&&(m={...m,token:c,appendToken:!0});let b=i.getSettings(void 0).allowUnauthorizedRemoteConnection;if(a.startsWith("https")&&b&&n){let N=n.createHttpRequestAgent();h={...h,agent:N}}let{ServerConnection:w}=require("@jupyterlab/services");return m={...m,init:h,WebSocket:e.WebSocket?t.wrapWebSocketCtor(e.WebSocket):t.getWebsocketCtor(void 0,b,p),fetch:e.fetch||t.getFetchMethod(),Request:t.getRequestCtor(void 0,b,p),Headers:t.getHeadersCtor()},{baseUrl:a,providerId:r.id,serverProviderHandle:r,token:c,hostName:l,displayName:e&&e.displayName?e.displayName:JE(c,a),dispose:()=>s?.dispose(),rootDirectory:o,getAuthHeader:p,settings:w.makeSettings(m)}}async function hV(r){let e=Wt(r);return la(e,"SHA-256")}var Sse=new Set([It,"ms-toolsai.vscode-ai","GitHub.codespaces"].map(r=>r.toLowerCase()));function Wt(r){return Sse.has(r.extensionId.toLowerCase())?`${Ge.REMOTE_URI}?${Ge.REMOTE_URI_ID_PARAM}=${r.id}&${Ge.REMOTE_URI_HANDLE_PARAM}=${encodeURI(r.handle)}`:`${Ge.REMOTE_URI}?${Ge.REMOTE_URI_ID_PARAM}=${r.id}&${Ge.REMOTE_URI_HANDLE_PARAM}=${encodeURI(r.handle)}&${Ge.REMOTE_URI_EXTENSION_ID_PARAM}=${encodeURI(r.extensionId)}`}async function GE(r){if(!Vu()&&r.interpreter?.uri){let e=r.interpreter.uri.fsPath,t=mc(r.interpreter.uri).fsPath,n=r.id.replace(e,t);return vt(n)}return vt(r.id)}var xs=class{static fromJSON(e){let t=Object.assign(e,{});switch(t.interpreter&&(t.interpreter=YS(t.interpreter,"")),e.kind){case"startUsingLocalKernelSpec":return op.create(t);case"connectToLiveRemoteKernel":return ZS.create(t);case"startUsingRemoteKernelSpec":return ex.create(t);case"startUsingPythonInterpreter":return Ko.create(t);default:throw new Error(`Invalid object to be deserialized into a connection, kind = ${t.kind}`)}}},ZS=class r{constructor(e){this.kind="connectToLiveRemoteKernel";this.kernelModel=e.kernelModel,this.interpreter=e.interpreter,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,QE(this)}static create(e){return new r(e)}updateModel(e){Object.assign(this.kernelModel,e)}getHashId(){return GE(this)}toJSON(){return{id:this.id,kind:this.kind,baseUrl:this.baseUrl,interpreter:Ol(this.interpreter),kernelModel:this.kernelModel,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return xs.fromJSON(e)}},op=class r{constructor(e){this.kind="startUsingLocalKernelSpec";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,QE(this)}static create(e){return new r(e)}getHashId(){return GE(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Ol(this.interpreter),kind:this.kind}}static fromJSON(e){return xs.fromJSON(e)}},ex=class r{constructor(e){this.kind="startUsingRemoteKernelSpec";this.interpreter=e.interpreter,this.kernelSpec=e.kernelSpec,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,QE(this)}static create(e){return new r(e)}getHashId(){return GE(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Ol(this.interpreter),baseUrl:this.baseUrl,kind:this.kind,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return xs.fromJSON(e)}},Ko=class r{constructor(e){this.kind="startUsingPythonInterpreter";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,QE(this)}static create(e){return new r(e)}getHashId(){return GE(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Ol(this.interpreter),kind:this.kind}}updateInterpreter(e){Object.assign(this.interpreter,e)}static fromJSON(e){return xs.fromJSON(e)}};function dt(r){return r.kind==="startUsingLocalKernelSpec"||r.kind==="startUsingPythonInterpreter"}function Ft(r){return!dt(r)}var Ke=Symbol("IKernelProvider"),dm=Symbol("IThirdPartyKernelProvider");var zE=Symbol("IJupyterServerConnector"),tx=Symbol("IKernelSessionFactory");var Cs=Symbol("IKernelDependencyService"),Rr=Symbol("IKernelFinder"),Qh=Symbol("ITracebackFormatter");var Fo=Symbol("IStartupCodeProviders"),gV=new Set;function QE(r){if(gV.has(r.id))return;gV.add(r.id);let e="kernelSpec"in r?r.kernelSpec:void 0,t=e?.language||(r.kind==="startUsingPythonInterpreter"?xe:void 0),n="",i="",o="interpreter"in r?r.interpreter:void 0,s="<#>",a;e&&Array.isArray(e.argv)&&e.argv.length>0&&(n=e.argv[0],a=n.toLowerCase()===o?.uri?.fsPath?.toLowerCase(),De(n)!==n&&(n=`<P>${De(n)}`),i=e.argv.map(h=>h.includes("/")||h.includes("\\")?`<P>${De(h)}`:h).join(s));let c="kernelSpec"in r&&r.kernelSpec.specFile?vt(r.kernelSpec.specFile):Promise.resolve(""),l=vt(r.id),u=Ft(r)?vt(Wt(r.serverProviderHandle)):Promise.resolve(""),p=Ft(r)?r.serverProviderHandle.extensionId:It,m=Ft(r)?vt(r.baseUrl.toLowerCase()):Promise.resolve("");Promise.all([c,l,u,m]).then(([h,g,b,w])=>A("DS_INTERNAL.JUPYTER_KERNEL_SPEC",void 0,{kernelId:g,serverIdHash:b,kernelSpecHash:h,baseUrlHash:w,providerExtensionId:p,kernelConnectionType:r.kind,kernelLanguage:t,envType:o?.envType,isArgv0SameAsInterpreter:a,argv0:n,argv:i})).catch(f)}var Pn=require("vscode");var $V=_(DV()),cp=require("vscode");var sp=class{constructor(e,t,n,i){this.specFile=t;this.interpreterPath=n;this.isRegisteredByVSC=i;this.name=e.name,this.argv=e.argv,this.language=e.language,this.executable=e.argv&&e.argv.length>0?e.argv[0]:"",this.display_name=e.display_name,this.metadata=e.metadata,this.env=e.env,this.interrupt_mode=e.interrupt_mode}};var Ei=require("vscode"),BV=_(vN());var NV=_(qh());var MV=require("vscode");var Mse={output_type:"stream",name:"stdout",text:""},Ose={output_type:"error",ename:"",evalue:"",traceback:[""]},Kse={output_type:"display_data",data:{},metadata:{}},Fse={output_type:"execute_result",execution_count:0,data:{},metadata:{}},Lse={stream:new Set(Object.keys(Mse)),error:new Set(Object.keys(Ose)),display_data:new Set(Object.keys(Kse)),execute_result:new Set(Object.keys(Fse))};function Hi(r){return r&&zu(r).toLowerCase().endsWith("ipynb")?"notebook":"interactive"}function Use(r){let e;switch(r.output_type){case"stream":case"error":case"execute_result":case"display_data":e=Lse[r.output_type];break;default:return r}let t={...r};for(let n of Object.keys(r))e.has(n)||delete t[n];return t}function OV(r){let e={...r,source:bc(r.source)};if(e.cell_type!=="code")delete e.outputs,delete e.execution_count;else if(e.cell_type){let t=e;t.outputs=t.outputs?t.outputs.map(Use):[]}return e}function yc(r){return r=r.toLowerCase(),r.length===2&&r.endsWith("#")?`${r.substring(0,1)}sharp`:wj.get(r)||r}function Tt(r){return typeof r=="string"?r===bt||r===gt:r.notebookType===bt||r.notebookType===gt}function lo(r){let e=r.metadata?.custom;return JSON.parse(JSON.stringify(e?.metadata||{}))}function KV(r){let e=r.metadata?.custom;return{nbformat:e?.nbformat,nbformat_minor:e?.nbformat_minor}}function Yh(r){return MV.workspace.notebookDocuments.find(e=>Tt(e)&&e.getCells().some(t=>t.document===r))}function ws(r){if(Array.isArray(r)){let e="";for(let t=0;t<r.length;t+=1){let n=r[t];t<r.length-1&&!n.endsWith(`
`)?e=e.concat(`${n}
`):e=e.concat(n)}return e}return r.toString()}function bc(r){if(Array.isArray(r))return r;let e=r.toString();if(e.length>0){let t=e.split(`
`);return t.map((n,i)=>i<t.length-1?`${n}
`:n).filter(n=>n.length>0)}return[]}function jse(r){let e=r;do r=e,e=r.replace(/[^\n]\x08/gm,"");while(e.length<r.length);return r}function Wse(r){for(r=r.replace(/\r+\n/gm,`
`);r.search(/\r[^$]/g)>-1;){var e=r.match(/^(.*)\r+/m)[1],t=r.match(/\r+(.*)$/m)[1];t=t+e.slice(t.length,e.length),r=r.replace(/\r+.*$/m,"\r").replace(/^.*\r/m,t)}return r}function FV(r){return Wse(jse(r))}var XE="'''",ZE='"""';function mm(r,e,t){let n,i,o=0;for(let s of r){let a=s.trim(),c=a.startsWith(XE)?XE:a.startsWith(ZE)?ZE:void 0,l=a.includes(XE)?XE:a.includes(ZE)?ZE:void 0;if(i)i===l&&(i=void 0),t(s,o);else if(n)n===c&&(n=void 0),n&&e(s,o);else if(l&&!c){let u=a.indexOf(l);i=a.lastIndexOf(l)!==u?void 0:l,t(s,o)}else if(c){let u=a.indexOf(c,3);n=u>=0?void 0:c,a.length>3&&e(a.slice(3,u>=0?u:void 0),o)}else a.startsWith("#")?e(a.slice(1),o):t(s,o);o+=1}}function Ic(r,e=`
`,t){return r.map((n,i)=>{let o=t?t(n):n;return i===r.length-1?`${o}`:`${o}${e}`})}function Vse(r){let e=[];return mm(r,t=>e.push(t),t=>{}),e}function eP(r){return Ic(Vse(r.slice(r.length>1?1:0)))}function LV(r){let e=r.length,t=-1;return r.forEach((n,i)=>{n.trim()&&(e=i,t<0&&(t=i))}),t>=0?r.slice(t,e+1):[]}function tP(r){let e=/^\s*(\d+)\.(\d+)\.(.+)\s*$/.exec(r);if(e&&e.length>2){let t=parseInt(e[1],10),n=parseInt(e[2],10),i=parseInt(e[3],10);return(0,NV.parse)(`${t}.${n}.${i}`,!0)??void 0}}var yN=class{constructor(e,t,n,i=!1){this._impl=e;this.controllerId=t;this._endCallback=n;this.clearOutputOnStartWithTime=i;this.started=!1}get cell(){return this._impl.cell}get token(){return this._impl.token}get executionOrder(){return this._impl.executionOrder}set executionOrder(e){this._impl.executionOrder=e}startIfNecessary(){this.started||this._impl.start()}start(e){this.started||(this.started=!0,this._impl.start(e),this._startTime=e,this.clearOutputOnStartWithTime?(E(`Start cell ${this.cell.index} execution @ ${e} (clear output)`),this._impl.clearOutput().then(f,f)):E(`Start cell ${this.cell.index} execution @ ${e}`))}end(e,t){if(this._endCallback)try{this._impl.end(e,t),z(`End cell ${this.cell.index} execution after ${((t||0)-(this._startTime||0))/1e3}s, completed @ ${t}, started @ ${this._startTime}`)}finally{this._endCallback(),this._endCallback=void 0}}clearOutput(e){return this.startIfNecessary(),this._impl.clearOutput(e)}replaceOutput(e,t){return this.startIfNecessary(),this._impl.replaceOutput(e,t)}appendOutput(e,t){return this.startIfNecessary(),this._impl.appendOutput(e,t)}replaceOutputItems(e,t){return this.startIfNecessary(),this._impl.replaceOutputItems(e,t)}appendOutputItems(e,t){return this.startIfNecessary(),this._impl.appendOutputItems(e,t)}},Gi=class r{static{this._map=new WeakMap}static getOrCreate(e,t,n=!1){let i,o=e.document;if(i=this.get(e),!i)i=r.create(o,e,t,n);else if(i.controllerId!==t.id){let s=i;s.end(void 0),i=r.create(o,e,t,n),s.started&&i.start(new Date().getTime())}return i}static get(e){let t=e.document;return r._map.get(t)}static create(e,t,n,i=!1){let o=new yN(n.createNotebookCellExecution(t),n.id,()=>{r._map.delete(e)},i);return r._map.set(e,o),o}};function Xh(r){return typeof Buffer<"u"&&typeof Buffer.from=="function"?Buffer.from(r,"base64"):Uint8Array.from(atob(r),e=>e.charCodeAt(0))}var Bse=new TextDecoder;function rP(r){if(typeof Buffer<"u"&&typeof Buffer.from=="function")return Buffer.from(r).toString("base64");{let e=Bse.decode(r);return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(t,n){return String.fromCharCode(Number.parseInt("0x"+n))}))}}function iP(r){let e;return r.kind===Ei.NotebookCellKind.Markup?e=$se(r):"document"in r&&r.document.languageId==="raw"||"languageId"in r&&r.languageId==="raw"?e=qse(r):e=Jse(r),e}function qse(r){let e=r.metadata?.custom,t={cell_type:"raw",source:bc("document"in r?r.document.getText():r.value),metadata:e?.metadata||{}};return e?.attachments&&(t.attachments=e.attachments),t}function Jse(r){let e=r.metadata?.custom,t="document"in r?r.document.getText():r.value;return{cell_type:"code",execution_count:r.executionSummary?.executionOrder??null,source:bc(t),outputs:(r.outputs||[]).map(sP),metadata:e?.metadata||{}}}function $se(r){let e=r.metadata?.custom,t={cell_type:"markdown",source:bc("document"in r?r.document.getText():r.value),metadata:e?.metadata||{}};return e?.attachments&&(t.attachments=e.attachments),t}var UV=["application/vnd.*","application/vdom.*","application/geo+json","application/x-nteract-model-debug+json","text/html","application/javascript","image/gif","text/latex","text/markdown","image/png","image/svg+xml","image/jpeg","application/json","text/plain"];function jV(r){if(r.mime.startsWith("application/vnd."))try{return new TextDecoder().decode(r.data).length===0}catch{}return!1}function Hse(r){return r.sort((e,t)=>{let n=(s,a)=>(s.endsWith(".*")&&(s=s.substr(0,s.indexOf(".*"))),a.startsWith(s)),i=UV.findIndex(s=>n(s,e.mime)),o=UV.findIndex(s=>n(s,t.mime));return jV(e)&&(i=-1),jV(t)&&(o=-1),i=i==-1?100:i,o=o==-1?100:o,i-o})}var Kl=class r{static{this.cellStates=new WeakMap}static getCellState(e){return r.cellStates.get(e)?.state}static getCellStatus(e){return(r.cellStates.get(e)?.stateTransition||[]).join(", ")||""}static setCellState(e,t){let n=r.cellStates.get(e)?.start||new qe,i=r.cellStates.get(e)?.stateTransition||[];i.push(`${t} ${i.length===0?"@ start":`After ${n.elapsedTime}ms`}`),r.cellStates.set(e,{stateTransition:i,state:t,start:n})}};function yt(r,e){let t=typeof e=="string"?()=>e:e;ne(()=>`Cell Index:${r.index}, of document ${hn(r.notebook.uri)} with state:${Kl.getCellStatus(r)}, exec: ${r.executionSummary?.executionOrder}. ${t()}. called from ${VW()}`)}var eg=new Map;eg.set("display_data",oP);eg.set("error",Yse);eg.set("execute_result",oP);eg.set("stream",Gse);eg.set("update_display_data",oP);function da(r){let e=eg.get(r.output_type),t;return e?t=e(r):(j(`Unable to translate cell from ${r.output_type} to NotebookCellData for VS Code.`),t=oP(r)),t}function bN(r){let e={outputType:r.output_type};switch(r.transient&&(e.transient=r.transient),r.output_type){case"display_data":case"execute_result":case"update_display_data":{e.executionCount=r.execution_count,e.metadata=r.metadata?JSON.parse(JSON.stringify(r.metadata)):{};break}default:break}return e}function oP(r){let e=bN(r);("image/svg+xml"in r.data||"image/png"in r.data)&&(e.__displayOpenPlotIcon=!0);let t=[];if(r.data)for(let n in r.data)t.push(Qse(n,r.data[n]));return new Ei.NotebookCellOutput(Hse(t),e)}function Gse(r){let e=ws(r.text),t=r.name==="stderr"?Ei.NotebookCellOutputItem.stderr:Ei.NotebookCellOutputItem.stdout;return new Ei.NotebookCellOutput([t(e)],bN(r))}function zse(r){if(r.items.length>0)return r.items[0].mime==="application/vnd.code.notebook.stderr"?"stderr":"stdout"}function WV(r){let e=r.items[0];if(!e.data)return{output_type:"error",ename:"",evalue:"",traceback:[]};let t=r.metadata?.originalError,n=JSON.parse(new TextDecoder().decode(e.data));return{output_type:"error",ename:n.name,evalue:n.message,traceback:t?.traceback||bc(n.stack||n.message||"")}}var Zh=new TextDecoder,qV=["text/plain","text/markdown","application/vnd.code.notebook.stderr","application/vnd.code.notebook.stdout"];function nP(r,e){if(!e)return"";try{if(r==="application/vnd.code.notebook.error"){let t=Zh.decode(e);return JSON.parse(t)}else if(r.startsWith("text/")||qV.includes(r)){let t=Zh.decode(e);return bc(t)}else{if(r.startsWith("image/")&&r!=="image/svg+xml")return rP(e);if(r.toLowerCase().startsWith("application/vnd.holoviews_load.v")&&r.toLowerCase().endsWith("+json")){let t=Zh.decode(e);try{return t.length>0?JSON.parse(t):t}catch{return t}}else if(r.toLowerCase().includes("json")){let t=Zh.decode(e);return t.length>0?JSON.parse(t):t}else return Zh.decode(e)}}catch(t){return x(`Failed to convert ${r} output from a buffer ${typeof e}, ${e}`,t),""}}function Qse(r,e){if(!e)return Ei.NotebookCellOutputItem.text("",r);try{if((r.startsWith("text/")||qV.includes(r))&&(Array.isArray(e)||typeof e=="string")){let t=Array.isArray(e)?ws(e):e;return Ei.NotebookCellOutputItem.text(t,r)}else return r.startsWith("image/")&&typeof e=="string"&&r!=="image/svg+xml"?new Ei.NotebookCellOutputItem(Xh(e),r):typeof e=="object"&&e!==null&&!Array.isArray(e)?Ei.NotebookCellOutputItem.text(JSON.stringify(e),r):(e=Array.isArray(e)?ws(e):e,Ei.NotebookCellOutputItem.text(e,r))}catch(t){return x(`Failed to convert ${r} output to a buffer ${typeof e}, ${e}`,t),Ei.NotebookCellOutputItem.text("")}}function VV(r){let e=[];r.items.filter(n=>n.mime==="application/vnd.code.notebook.stderr"||n.mime==="application/vnd.code.notebook.stdout").map(n=>Zh.decode(n.data)).forEach(n=>{let i=n.split(`
`);e.length&&i.length&&i[0].length>0&&(e[e.length-1]=`${e[e.length-1]}${i.shift()}`);for(let o of i)e.push(o)});for(let n=0;n<e.length-1;n++)e[n]=`${e[n]}
`;return e.length&&e[e.length-1].length===0&&e.pop(),{output_type:"stream",name:zse(r)||"stdout",text:e}}function sP(r){let e=r.metadata,t;switch(e?.outputType){case"error":{t=WV(r);break}case"stream":{t=VV(r);break}case"display_data":{t={output_type:"display_data",data:r.items.reduce((i,o)=>(i[o.mime]=nP(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}case"execute_result":{t={output_type:"execute_result",data:r.items.reduce((i,o)=>(i[o.mime]=nP(o.mime,o.data),i),{}),metadata:e?.metadata||{},execution_count:typeof e?.executionCount=="number"?e?.executionCount:null};break}case"update_display_data":{t={output_type:"update_display_data",data:r.items.reduce((i,o)=>(i[o.mime]=nP(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}default:{let i=r.items.length===1&&r.items.every(c=>c.mime==="application/vnd.code.notebook.error"),o=r.items.every(c=>c.mime==="application/vnd.code.notebook.stderr"||c.mime==="application/vnd.code.notebook.stdout");if(i)return WV(r);let s=e?.outputType||(o?"stream":"display_data");A("DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",void 0,{outputType:s});let a;s==="stream"?a=VV(r):s==="display_data"?a={data:{},metadata:{},output_type:"display_data"}:a={output_type:s},e?.metadata&&(a.metadata=e.metadata),r.items.length>0&&(a.data=r.items.reduce((c,l)=>(c[l.mime]=nP(l.mime,l.data),c),{})),t=a;break}}return t&&e&&e.transient&&(t.transient=e.transient),t}function Yse(r){return r=r||{output_type:"error",ename:"",evalue:"",traceback:[]},new Ei.NotebookCellOutput([Ei.NotebookCellOutputItem.error({name:r?.ename||"",message:r?.evalue||"",stack:(r?.traceback||[]).join(`
`)})],{...bN(r),originalError:r})}async function aP(r,e,t){let n=!1,i;if(!r)return{changed:n,kernelId:i};r?.language_info?.name||(r.language_info=r.language_info||{name:""});let o;switch(e?.kind){case"connectToLiveRemoteKernel":o=e.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":o=e.kernelSpec.language;break;case"startUsingPythonInterpreter":o=xe;break;default:break}if(r.language_info.name!==o&&o&&(r.language_info.name=o,n=!0),t&&"language_info"in t&&t.language_info)(0,BV.default)(r.language_info,t.language_info)||(r.language_info=JSON.parse(JSON.stringify(t.language_info)),n=!0);else{let a=_t(e),c=a?JV(e):void 0,l=await Jh(c),u=l?`${l.major}.${l.minor}.${l.micro}`:"";c&&l&&r&&r.language_info&&r.language_info.version!==u?(r.language_info.version=u,n=!0):!c&&r?.language_info&&a&&(r.language_info=void 0,n=!0)}let s=e&&tg(e)?e.kernelModel:e&&"kernelSpec"in e?e.kernelSpec:void 0;if(e?.kind==="startUsingPythonInterpreter"){let a=e.kernelSpec,c=a.display_name||e.interpreter.displayName||"",l="";switch(Mn(a)){case"registeredByOldVersionOfExt":case"registeredByNewVersionOfExt":l="python3";break;case"registeredByNewVersionOfExtForCustomKernelSpec":{l=(a.metadata?.vscode?.originalSpecFile?De(pt(a.metadata.vscode.originalSpecFile)):void 0)||a.name,c=a.metadata?.vscode?.originalDisplayName||c;break}default:l=a.name;break}r.kernelspec?.name!==l&&(n=!0,r.kernelspec={name:l,language:xe,display_name:c},"vscode"in r&&delete r.vscode,"interpreter"in r&&delete r.interpreter)}else if(s&&!r.kernelspec){let a=s.metadata?.vscode?.originalSpecFile?De(pt(s.metadata.vscode.originalSpecFile)):void 0;r.kernelspec={name:a||s.name||s.display_name||"",display_name:s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||""},s.language&&(r.kernelspec.language=s.language),i=s.id,n=!0}else if(s&&r.kernelspec){let c=(s.metadata?.vscode?.originalSpecFile?De(pt(s.metadata.vscode.originalSpecFile)):void 0)||s.name||s.display_name||"",l=s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||"",u=s.language||s.language||"";(r.kernelspec.name!==c||r.kernelspec.language!==u||r.kernelspec.display_name!==l||i!==s.id)&&(n=!0,r.kernelspec.name=c,r.kernelspec.display_name=l,r.kernelspec.language=u,i=s.id);try{delete r.kernelspec.metadata}catch{}}return{changed:n,kernelId:i}}async function ap(r,e,t,n){let i=Oh(t);if(!i){let s=Gi.get(r);n&&s?.started&&s.end(n?void 0:!1,r.executionSummary?.timing?.endTime);return}Gi.get(r)||(n=!0);let o=Gi.getOrCreate(r,e);o.started||(o.start(r.executionSummary?.timing?.endTime),o.executionOrder=r.executionSummary?.executionOrder),await o.appendOutput(i),o.end(n?void 0:!1,r.executionSummary?.timing?.endTime)}function cP(r){if(r.hasOwnProperty("text/html")){let e=r["text/html"];typeof e=="string"&&e.includes('<iframe id="tensorboard-frame-')&&(r["text/html"]=e.replace(/new URL\((.*), window.location\)/,'new URL("http://localhost")'))}return r}function rx(r){let e=this,t=!1,n;return function(){return t||(t=!0,n=r.apply(e,arguments)),n}}var fm="{connection_file}";function HV(r){return r.argv.findIndex(e=>e.includes(fm))}var rg="-jvsc-",Xse=/^python\d*.?\d*$/;async function Es(r,e){return Zse(await CN(r),r,e)}function Zse(r,e,t){let n=e?{path:Pe(e.uri)}:{},i={name:r,language:"python",display_name:e?.displayName||"Python 3",metadata:{interpreter:n},argv:["python","-m","ipykernel_launcher","-f",fm],env:{},resources:{}},o=t&&i.name?sr(t,i.name,"kernel.json"):void 0;return new sp(i,o?Pe(o):void 0,Pe(e?.uri),"registeredByNewVersionOfExt")}function GV(r){let e=JSON.parse(JSON.stringify(r));return e.env&&Object.keys(e.env).forEach(n=>{if(e.env){let i=e.env[n];i!=null&&(e.env[n]=i.toString())}}),e}function lP(r){let e=r?.kernelspec;return r?.language_info?.name&&r.language_info.name!==xe?!1:e?.name?.includes(xe)?!0:e?.language===xe||r?.language_info?.name===xe}function uP(r){let e=r.metadata?.vscode?.originalSpecFile||r.metadata?.originalSpecFile,t=e?De(pt(e)):r.name||"",n=r.metadata?.vscode?.originalDisplayName||r.display_name||"";return!!(t.toLowerCase().match(Xse)||n.toLowerCase()==="python 3 (ipykernel)"||n.toLowerCase()==="python 3")}function eae(r){if(r.includes(rg)){let e=/[a-f0-9]$/;if(r.substring(r.lastIndexOf(rg)+rg.length).search(e)!==-1){let t=r.substring(0,r.lastIndexOf(rg));return t.toLowerCase().endsWith(".ipynb")||t.toLowerCase().endsWith(".py")?t:`${t}.ipynb`}}return r}function pP(r){return r.kind!=="connectToLiveRemoteKernel"}function tg(r){return r.kind==="connectToLiveRemoteKernel"}function Pi(r,e,t){e=IN(r)?e:void 0;let n=r.name,i=Mn(r);if(i&&n.includes(nx)&&(n=n.substring(n.indexOf(nx)),i==="registeredByNewVersionOfExtForCustomKernelSpec")){let l=r.metadata?.vscode?.originalSpecFile||r.metadata?.originalSpecFile;l&&(n=`${n}#${De(pt(l))}`)}let o="";IN(r)?o=r.argv.slice(1).filter(l=>!["-f","{connection_file}"].includes(l)).join("#").toLowerCase():o=r.argv.join("#").toLowerCase();let s=t?`${t}.`:"",a=Pe(mc(r.interpreterPath?cp.Uri.file(r.interpreterPath):cp.Uri.file(r.executable))),c=Pe(mc(e?.uri))||"";return`${s}${r.id||""}.${n}.${a}.${c}.${o}`}function mt(r){let e=tae(r);if(!r)return e;switch(r.kind){case"connectToLiveRemoteKernel":{let n=eae(r.kernelModel?.notebook?.path||r.kernelModel?.model?.path||"");return n?`${e} (${n})`:e}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":if(r.interpreter?.envType&&r.interpreter.envType!=="Unknown"){let n=VE(r.interpreter);if(r.kernelSpec.language===xe){let i=`Python ${ep($i(r.interpreter))||""}`.trim();return r.interpreter.envName?`${e} (${i})`:e}else return n?`${e} (${n})`:e}else return e;case"startUsingPythonInterpreter":let t=(ep($i(r.interpreter))||"").trim();if(r.interpreter.envType&&r.interpreter.envType!=="Unknown"){if(r.kernelSpec.display_name&&Mn(r.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec")return r.kernelSpec.display_name;let n=r.interpreter.envType==="Conda"&&r.interpreter.isCondaEnvWithoutPython===!0,i=t.trim()?`Python ${t}`:"Python",o=VE(r.interpreter);return n&&o?o:o?`${o} (${i})`:i}else return`Python ${t}`.trim()}return e}function tae(r){if(!r)return"";let e=r.kind==="connectToLiveRemoteKernel"?r.kernelModel.display_name:r.kernelSpec?.display_name,t=r.kind==="connectToLiveRemoteKernel"?r.kernelModel.name:r.kernelSpec?.name,n=r.kind==="startUsingPythonInterpreter"?r.interpreter.displayName:void 0;return[e,t,n,""].find(i=>typeof i=="string"&&i.length>0)||""}function ng(r,e=""){return r?r.kind==="connectToLiveRemoteKernel"?r.kernelModel.name:r.kernelSpec?.name:e}function rae(r){if(!r)return;let e=tg(r)?r.kernelModel:void 0,t=pP(r)?r.kernelSpec:void 0;if(r.kind==="startUsingPythonInterpreter"||(r.kind==="startUsingRemoteKernelSpec"||r.kind==="startUsingLocalKernelSpec")&&r.kernelSpec.language===xe){let n=t?.metadata?.interpreter?.path||t?.interpreterPath||t?.executable;return n==="/python"||n==="python"?r.interpreter?.displayPath:n?cp.Uri.file(n):void 0}else{let n=e?.executable||t?.executable||t?.metadata?.interpreter?.path||t?.interpreterPath;return n?cp.Uri.file(n):void 0}}function SN(r,e=""){if(r?.kind==="connectToLiveRemoteKernel"){let t;if(typeof r.kernelModel.lastActivityTime=="string")try{t=new Date(r.kernelModel.lastActivityTime)}catch(n){E(`Error parsing date ${n}`)}else t=r.kernelModel.lastActivityTime;return y.jupyterSelectLiveRemoteKernelDescription(t,r.kernelModel.numberOfConnections)}return e}function xN(r,e){if(r?.kind==="connectToLiveRemoteKernel")return;let t=rae(r),n=cp.workspace.workspaceFolders?cp.workspace.workspaceFolders:[];return t?W(t,n,e.homeDir):""}function JV(r){if(!r)return;if(r.interpreter)return r.interpreter;let e=tg(r)?r.kernelModel:void 0;if(e?.metadata?.interpreter)return YS(e?.metadata?.interpreter,"");let t=pP(r)?r.kernelSpec:void 0;return YS(t?.metadata?.interpreter,"")}function ig(r){return r.kind==="startUsingLocalKernelSpec"||r.kind==="startUsingPythonInterpreter"&&r.kernelSpec&&Mn(r.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec"}function _t(r){if(!r)return!1;if(r.kind==="startUsingPythonInterpreter")return!0;let e=tg(r)?r.kernelModel:void 0,t=pP(r)?r.kernelSpec:void 0;return e?.language===xe||IN(t)}function IN(r){return(r?.language||"").toLowerCase()===xe}function Lo(r){if(!r)return;if(r.kind==="startUsingPythonInterpreter")return xe;let e=tg(r)?r.kernelModel:void 0,t=pP(r)?r.kernelSpec:void 0;return e?.language||zV(t)}function dP(r){if(!r)return;let e=r.kernelspec;return zV(e)||r.language_info?.name}function zV(r){return r?.language}var nx="jvsc74a57bd0";async function CN(r){let t=(ep($i(r))||"3").replace(/\./g,""),n=r?`python${t}`:"";return r?`${n}${nx}${await fc(r)}`:"python3"}function Mn(r){if(r.isRegisteredByVSC)return r.isRegisteredByVSC;if(!r.name)return;let e=r.metadata?.vscode?.originalSpecFile||r.metadata?.originalSpecFile,t=e?De(pt(e)):r.name,n=uP({...r,name:t})?Object.keys(r.env||{}).length>0:typeof e=="string"&&!e.includes(nx);if(r.name.includes(nx))return n?"registeredByNewVersionOfExtForCustomKernelSpec":"registeredByNewVersionOfExt";let i=/[a-f0-9]{32}$/;if(r.metadata?.interpreter&&r.name.toLowerCase().search(i)!==-1)return"registeredByOldVersionOfExt"}function QV(r,e){return!r&&!e?!0:!r&&e||r&&!e?!1:r?.id===e?.id}function mP(r){if(r.kind==="connectToLiveRemoteKernel"||r.kind==="startUsingRemoteKernelSpec"){let e=new $V.default(r.baseUrl);return e.hostname.toLocaleLowerCase()==="localhost"||e.hostname==="127.0.0.1"}return!1}async function vn(r,e,t){E(`Executing silently Code (${r.status}) = ${Fe(e.substring(0,100)).join("\\n")}`);let n=require("@jupyterlab/services"),i=r.requestExecute({code:e.replace(/\r\n/g,`
`),silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!1},!0),o=[];i.onIOPub=a=>{if(n.KernelMessage.isStreamMsg(a))if(ne(`Got io pub message (stream), ${Fe(a.content.text.substr(0,100)).join("\\n")}`),o.length>0&&o[o.length-1].output_type==="stream"&&o[o.length-1].name===a.content.name){let c=o[o.length-1];c.text+=a.content.text}else{let c={name:a.content.name,text:a.content.text,output_type:"stream"};o.push(c)}else if(n.KernelMessage.isExecuteResultMsg(a)){ne("Got io pub message (execresult)}");let c={data:a.content.data,execution_count:a.content.execution_count,metadata:a.content.metadata,output_type:"execute_result"};o.push(c)}else if(n.KernelMessage.isDisplayDataMsg(a)){ne("Got io pub message (displaydata)}");let c={data:a.content.data,metadata:a.content.metadata,output_type:"display_data"};o.push(c)}else if(n.KernelMessage.isErrorMsg(a)){if(ne(`Got io pub message (error), ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join().substring(0,100)}}`),t?.traceErrors){let l=`${t.traceErrorsMessage||"Failed to execute (silent) code against the kernel"}, 
Code = ${e}
Error details: `;x(`${l} ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join()}`)}let c={ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback,output_type:"error"};o.push(c)}else ne(`Got io pub message (${a.header.msg_type})`)},await i.done;let s=Fe(e.substring(0,100)).join("\\n");return t&&nae(o,t,s),E(`Executing silently Code (completed) = ${s} with ${o.length} output(s)`),o}function YV(r,e,t,n){e=e.replace(/\r\n/g,`
`);let i=require("@jupyterlab/services"),o=r.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!1,store_history:!1},!0),s=rx(t);return o.onIOPub=a=>{s(),i.KernelMessage.isStreamMsg(a)?n(da({output_type:"stream",name:a.content.name,text:a.content.text})):i.KernelMessage.isExecuteResultMsg(a)?n(da({output_type:"execute_result",data:a.content.data,metadata:a.content.metadata,transient:a.content.transient,execution_count:a.content.execution_count})):i.KernelMessage.isDisplayDataMsg(a)?n(da({output_type:"display_data",data:cP(a.content.data),metadata:a.content.metadata,transient:a.content.transient})):i.KernelMessage.isErrorMsg(a)?n(da({output_type:"error",ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback})):i.KernelMessage.isExecuteInputMsg(a)||i.KernelMessage.isStatusMsg(a)||j(`Got unexpected io pub message when executing code sillenty (${a.header.msg_type})`)},o}function nae(r,e,t){r.filter(n=>n.output_type==="error").forEach(n=>{let i=n,o=`${i.ename}: ${i.evalue} 
 ${i.traceback.map(a=>`    ${a}`).join(`
`)}`,s=`${e.traceErrorsMessage||""} ${t} ${o}`;e.traceErrors?x(s):j(s),e.telemetryName&&A(e.telemetryName)})}var e9=_(XV());var EN;(w=>{function r(k){return k&&typeof k=="object"&&typeof k[Symbol.iterator]=="function"}w.is=r;let e=Object.freeze([]);function t(){return e}w.empty=t;function*n(k){yield k}w.single=n;function i(k){return r(k)?k:n(k)}w.wrap=i;function o(k){return k||e}w.from=o;function s(k){return!k||k[Symbol.iterator]().next().done===!0}w.isEmpty=s;function a(k){return k[Symbol.iterator]().next().value}w.first=a;function c(k,N){for(let D of k)if(N(D))return!0;return!1}w.some=c;function l(k,N){for(let D of k)if(N(D))return D}w.find=l;function*u(k,N){for(let D of k)N(D)&&(yield D)}w.filter=u;function*p(k,N){let D=0;for(let V of k)yield N(V,D++)}w.map=p;function*m(...k){for(let N of k)for(let D of N)yield D}w.concat=m;function h(k,N,D){let V=D;for(let oe of k)V=N(V,oe);return V}w.reduce=h;function*g(k,N,D=k.length){for(N<0&&(N+=k.length),D<0?D+=k.length:D>k.length&&(D=k.length);N<D;N++)yield k[N]}w.slice=g;function b(k,N=Number.POSITIVE_INFINITY){let D=[];if(N===0)return[D,k];let V=k[Symbol.iterator]();for(let oe=0;oe<N;oe++){let G=V.next();if(G.done)return[D,w.empty()];D.push(G.value)}return[D,{[Symbol.iterator](){return V}}]}w.consume=b})(EN||={});var t9;function r9(r){t9=r}function hP(r){return t9?.push(r),r}function Q(r){if(EN.is(r)){for(let e of r)if(e)try{e.dispose()}catch(t){console.warn(`dispose() failed for ${e}`,t)}return Array.isArray(r)?[]:r}else if(r)return r.dispose(),r}var ma=class r{constructor(...e){this._toDispose=new Set;this._isDisposed=!1;e.forEach(t=>this.add(t)),hP(this)}static{this.DISABLE_DISPOSED_WARNING=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{Q(this._toDispose)}finally{this._toDispose.clear()}}add(e){if(!e)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?r.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(e),e}},Zt=class{constructor(...e){this._store=new ma;this._isDisposed=!1;e.forEach(t=>this._store.add(t)),hP(this)}get isDisposed(){return this._isDisposed}dispose(){this._store.dispose(),this._isDisposed=!0}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}},fP=class extends Zt{constructor(){super();this._onDidDispose=new e9.EventEmitter,this.onDidDispose=this._onDidDispose.event}dispose(){super.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose()}};var ZV=class{constructor(){this._store=new Map;this._isDisposed=!1}dispose(){this._isDisposed=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this._store.size)try{Q(this._store.values())}finally{this._store.clear()}}has(e){return this._store.has(e)}get(e){return this._store.get(e)}set(e,t,n=!1){this._isDisposed&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),n||this._store.get(e)?.dispose(),this._store.set(e,t)}deleteAndDispose(e){this._store.get(e)?.dispose(),this._store.delete(e)}[Symbol.iterator](){return this._store[Symbol.iterator]()}};function hm(r){return(e,t=null,n)=>{let i=!1,o;return o=r(s=>{if(!i)return o?o.dispose():i=!0,e.call(t,s)},null,n),i&&o.dispose(),o}}function PN(r,e=null,t){return new Promise(n=>hm(r)(n,e,t))}var gP="application/vnd.vscode.chat_message",n9=`
def __VSCODE_inject_module():

    def __VSCODE_call_function(function, callback, data=None):
        __VSCODE_send_chat_message__(function, data, callback=callback)

    def __VSCODE_send_chat_message__(function, data, callback):
        requests = {}
        try:
            requests = __VSCODE_send_chat_message__.__requests
        except Exception:
            __VSCODE_send_chat_message__.__requests = requests

        import uuid as __VSCODE_send_chat_message__uuid
        import IPython.display as __VSCODE_send_chat_message__ipython_display

        id = str(__VSCODE_send_chat_message__uuid.uuid4())
        requests[id] = callback
        data_is_none = data is None
        __VSCODE_send_chat_message__ipython_display.display({"${gP}": data}, metadata={"id":id, "function": function, "dataIsNone": data_is_none}, raw=True)

        del __VSCODE_send_chat_message__ipython_display
        del __VSCODE_send_chat_message__uuid

    def __VSCODE_on_chat_message(id, data):
        requests = {}
        try:
            requests = __VSCODE_send_chat_message__.__requests
        except Exception:
            __VSCODE_send_chat_message__.__requests = requests

        if id in requests:
            requests[id](data)
            del requests[id]
        else:
            raise NotImplementedError(f"Callback not found for message {id}")

    import sys as __VSCODE_send_chat_message__sys
    import IPython as __VSCODE_send_chat_message__IPython
    chat = type(__VSCODE_send_chat_message__IPython)("chat")
    chat.send_message = __VSCODE_send_chat_message__
    chat.call_function = __VSCODE_call_function
    chat.__on_message = __VSCODE_on_chat_message
    __VSCODE_send_chat_message__sys.modules["vscode"] = type(__VSCODE_send_chat_message__IPython)("vscode")
    __VSCODE_send_chat_message__sys.modules["vscode"].chat = chat
    del __VSCODE_send_chat_message__sys
    del __VSCODE_send_chat_message__IPython


__VSCODE_inject_module()
del __VSCODE_inject_module
`,sae=[[new RegExp("\\\\","g"),"\\\\"],[new RegExp('"',"g"),'\\"'],[new RegExp("'","g"),"'"],[new RegExp("\\\b","g"),"\\b"],[new RegExp("\\f","g"),"\\f"],[new RegExp("\\n","g"),"\\n"],[new RegExp("\\r","g"),"\\r"],[new RegExp("\\t","g"),"\\t"]];function i9(r,e){let t=aae(e),n=typeof t=="string"?`"${t}"`:"None";return`
import vscode as __vscode
try:
    __vscode.chat.__on_message('${r}', ${n})
finally:
    del __vscode
`}function aae(r){if(typeof r!="string")return r;for(let[e,t]of sae)r=r.replace(e,t);return r}var _N=class{constructor(e,t){let n=Pn.extensions.getExtension(e)?.packageJSON?.displayName||e;this.notebook=Pn.workspace.notebookDocuments.find(i=>i.uri.toString()===t.resourceUri?.toString()),this.controllerDisplayName=mt(t.kernelConnectionMetadata),this.title=Pn.l10n.t("Executing code in {0} from {1}",this.controllerDisplayName,n),this.eventHandler=Pn.window.onDidChangeVisibleNotebookEditors(this.showProgressImpl,this)}dispose(){this.eventHandler.dispose(),this.disposable?.dispose()}show(){if(this.deferred&&!this.deferred.completed){let e=this.deferred;return this.deferred=ue(),e.resolve(),this.disposable=new Pn.Disposable(()=>this.deferred?.resolve())}return this.deferred=ue(),this.showProgress().catch(f),this.disposable=new Pn.Disposable(()=>this.deferred?.resolve())}async showProgress(){await ji(500),!(!this.deferred||this.deferred.completed||this.displayInProgress)&&(this.shouldDisplayProgress=!0,await Promise.all([this.showProgressImpl(),this.waitUntilCompleted()]),this.shouldDisplayProgress=!1)}async showProgressImpl(){!this.notebook||!this.shouldDisplayProgress||Pn.window.visibleNotebookEditors.some(e=>e.notebook===this.notebook)&&(this.displayInProgress=!0,await Pn.window.withProgress({location:Pn.ProgressLocation.Notification,title:this.title},async()=>this.waitUntilCompleted()),this.displayInProgress=!1)}async waitUntilCompleted(){let e=this.deferred;for(;e&&!e.completed;)await e.promise,e=this.deferred}},DN=class r extends Zt{constructor(t,n,i,o){super();this.extensionId=t;this.kernel=n;this.execution=i;this.kernelAccess=o;this._onDidChangeStatus=this._register(new Pn.EventEmitter);this.progress=this._register(new _N(t,n)),this._register(hm(n.onDisposed)(()=>this.progress.dispose())),this.language=n.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?xe:n.kernelConnectionMetadata.kernelSpec.language||xe,this._register(this.kernel.onStatusChanged(()=>this._onDidChangeStatus.fire(this.kernel.status),this));let s=this;this._api=Object.freeze({language:this.language,get status(){return s.kernel.status},onDidChangeStatus:s.onDidChangeStatus,executeCode:(a,c)=>this.executeCode(a,c),executeChatCode:(a,c,l)=>this.executeChatCode(a,c,l)})}get status(){return this.kernel.status}get onDidChangeStatus(){return this._onDidChangeStatus.event}static createApiKernel(t,n,i,o){let s=new r(t,n,i,o);return Te.instance.get(F).push(s),s._api}async*executeCode(t,n){for await(let i of this.executeCodeInternal(t,void 0,n))yield i}async*executeChatCode(t,n,i){if(!["ms-vscode.dscopilot-agent",It].includes(this.extensionId.toLowerCase()))throw new Error(`Proposed API is not supported for extension ${this.extensionId}`);if(!_t(this.kernel.kernelConnectionMetadata))throw new Error("Chat code execution is only supported for Python kernels");for await(let s of this.executeCodeInternal(t,n,i))yield s}async*executeCodeInternal(t,n={},i){if(!this.kernelAccess.accessAllowed)throw new Error(Pn.l10n.t("Access to Jupyter Kernel has been revoked"));this.previousProgress?.dispose();let o=!1,s={executionCount:this.execution.executionCount,requestSentAfter:0,requestAcknowledgedAfter:0,cancelledAfter:0,duration:0},a={kernelId:"",extensionId:this.extensionId,cancelled:!1,requestSent:!1,requestAcknowledged:!1,cancelledBeforeRequestSent:!1,cancelledBeforeRequestAcknowledged:!1,mimeTypes:"",failed:!1},c=new qe,l=new Set;if(cae(this.extensionId,this.kernel,"executeCode",s.executionCount).catch(f),this.kernel.disposed)throw a.failed=!0,kN(this.kernel,s,a).catch(f),new Error("Kernel is disposed");if(!this.kernel.session?.kernel)throw a.failed=!0,kN(this.kernel,s,a).catch(f),this.kernel.status==="dead"||this.kernel.status==="terminating"?new Error("Kernel is dead or terminating"):new Error("Kernel connection not available to execute 3rd party code");let u=[];u.push({dispose:()=>{s.duration=c.elapsedTime,a.mimeTypes=Array.from(l).join(","),o=!0,kN(this.kernel,s,a).catch(f)}});let p=Te.instance.get(Ke).getKernelExecution(this.kernel),m={started:new Pn.EventEmitter,executionAcknowledged:new Pn.EventEmitter};m.started.event(()=>{if(a.requestSent=!0,s.requestSentAfter=c.elapsedTime,!i.isCancellationRequested){let h=this.previousProgress=this.progress.show();u.push(h)}},this,u),m.executionAcknowledged.event(()=>{a.requestAcknowledged=!0,s.requestAcknowledgedAfter=c.elapsedTime},this,u),i.onCancellationRequested(()=>{o||(a.cancelled=!0,s.cancelledAfter=c.elapsedTime,a.cancelledBeforeRequestSent=!a.requestSent,a.cancelledBeforeRequestAcknowledged=!a.requestAcknowledged,E(`Code execution cancelled by extension ${this.extensionId}`))},this,u);try{for await(let h of p.executeCode(t,this.extensionId,m,i))if(h.items.forEach(g=>l.add(g.mime)),n&&o9(h))for await(let g of this.handleChatOutput(h,p,m,l,n,i))yield g;else yield h}finally{Q(u)}}async*handleChatOutput(t,n,i,o,s={},a){let c=t.items.find(w=>w.mime===gP);if(!c)return;let l=(t.metadata||{}).metadata,u=l.function,p=l.id,m=l.dataIsNone?void 0:new TextDecoder().decode(c.data),h=s[u];if(!h)throw new Error(`Chat Function ${u} not found`);let g=await h(m),b=i9(p,g);for await(let w of n.executeCode(b,this.extensionId,i,a))if(w.items.forEach(k=>o.add(k.mime)),o9(w))for await(let k of this.handleChatOutput(w,n,i,o,s,a))yield k;else yield w}};function o9(r){return r.items.some(e=>e.mime===gP)}async function cae(r,e,t,n){let i=await vt(e.id);A("DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",{executionCount:n},{kernelId:i,pemUsed:t,extensionId:r})}async function kN(r,e,t){t.kernelId=await vt(r.id),A("DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",e,t)}function s9(r,e,t){let n=Te.instance.get(Ke);return DN.createApiKernel(r,e,n.getKernelExecution(e),t)}var On=require("vscode");var og=new Map,a9=new Set;async function c9(r){if(!On.workspace.isTrusted)return{accessAllowed:!1};if(r===It)return{accessAllowed:!0};let e=og.get(r);return e||(e=lae(r),og.set(r,e),e.then(({result:t})=>{(t==="learnMore"||t==="cancelled")&&og.get(r)===e&&(og.delete(r),a9.add(r))})),e.then(({result:t})=>({accessAllowed:t==="allowed"}))}async function lae(r){let e=await TN();if(e.get(r)===!0)return{result:"allowed"};if(e.get(r)===!1)return{result:"denied"};let t=On.extensions.getExtension(r)?.packageJSON?.displayName;if(!t)return x(`Kernel API access revoked, as extension ${r} does not exist!`),{result:"denied"};let n=On.l10n.t("Allow"),i=On.l10n.t("Deny"),o=await On.window.showInformationMessage(On.l10n.t("Do you want to grant Kernel access to the extension {0} ({1})?",t,r),{modal:!0,detail:On.l10n.t("This allows the extension to execute code against Jupyter Kernels.")},n,ye.learnMore,i);switch(o===ye.learnMore?On.env.openExternal(On.Uri.parse("https://aka.ms/vscodeJupyterKernelApiAccess")).then(f,f):(o===n||o===i)&&await uae(r,o===n),o){case n:return{result:"allowed"};case ye.learnMore:return{result:"learnMore"};case i:return{result:"denied"};default:return{result:"cancelled"}}}async function l9(){let r=new Set,[e]=await Promise.all([TN().then(t=>new Map(t)),...Array.from(og.entries()).map(async([t,n])=>{(await n).result!=="allowed"&&r.add(t)})]);return r.forEach(t=>e.set(t,!1)),a9.forEach(t=>e.set(t,e.get(t)===!0)),e}var vP="API.Access",lp;async function TN(r=!1){let e=Te.instance.get(lt);if(e.extensionMode===On.ExtensionMode.Test)return new Map;if(rx(()=>{Te.instance.get(F).push(e.secrets.onDidChange(i=>{i.key===vP&&(lp=void 0)}))})(),lp&&!r)return lp;let t="";try{return t=await e.secrets.get(vP),!t||t.length===0?new Map:(lp=new Map(Object.entries(JSON.parse(t))),lp)}catch(n){return x(`Failed to parse API access information ${t}`,n),new Map}}var yP=Promise.resolve();async function u9(r){return yP=yP.then(async()=>{await Promise.all(Array.from(og.entries()).map(async([t,n])=>{let i=await n;i.result=r.includes(t)===!0?"allowed":"denied"})),lp=new Map(r.map(t=>[t,!0]));let e=Te.instance.get(lt);if(e.extensionMode!==On.ExtensionMode.Test)try{await e.secrets.store(vP,JSON.stringify(Object.fromEntries(lp)))}catch(t){x(`Failed to update API access information ${JSON.stringify(Object.fromEntries(lp))}`,t)}})}async function uae(r,e){return yP=yP.then(async()=>{let t=Te.instance.get(lt);if(t.extensionMode===On.ExtensionMode.Test)return;let n=await TN(!0);if(e!==n.get(r)){n.set(r,e);try{await t.secrets.store(vP,JSON.stringify(Object.fromEntries(n)))}catch(i){x(`Failed to store API access information ${JSON.stringify(Object.fromEntries(n))}`,i)}}})}var p9=new WeakMap;function m9(r){return{async getKernel(e){let t,n=Te.instance.get(Ke),i=d9.workspace.notebookDocuments.find(l=>l.uri.toString()===e.toString()),o=n.get(i||e);if(!o||!o.startedAtLeastOnce){A("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:r,pemUsed:"getKernel",accessAllowed:t});return}let s=n.getKernelExecution(o);if(!Ft(o.kernelConnectionMetadata)&&s.executionCount===0){A("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:r,pemUsed:"getKernel",accessAllowed:t});return}let a=await c9(r);if(t=a.accessAllowed,A("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:r,pemUsed:"getKernel",accessAllowed:t}),!t)return;let c=p9.get(o)||s9(r,o,a);return p9.set(o,c),c}}}var up=Symbol("JupyterServerHelper"),bP=Symbol("INotebookImporter"),sg=Symbol("INotebookExporter"),pp=Symbol("IJupyterInterpreterDependencyManager"),ag=Symbol("INbConvertInterpreterDependencyChecker"),IP=Symbol("INbConvertExportToPythonService"),cg=Symbol("IJupyterServerProvider"),er=Symbol("IJupyterServerUriStorage"),SP=Symbol("IJupyterKernelService"),dp=Symbol("IJupyterRequestAgentCreator"),Fl=Symbol("IJupyterRequestCreator"),xP=Symbol("INotebookStarter"),gm=Symbol("ILiveRemoteKernelConnectionUsageTracker"),CP=Symbol("IJupyterRemoteCachedKernelValidator"),Qt=Symbol("IJupyterServerProviderRegistry");function wP(r,e,t,n,i){A("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:n,pemUsed:"createJupyterServerCollection"});let s=i.get(Qt).createJupyterServerCollection(n,r,dh(e),t);return{dispose:()=>{s?.dispose()},get id(){return r},set label(c){s.label=dh(c)},get label(){return s.label},set documentation(c){s.documentation=c},get documentation(){return s.documentation},set commandProvider(c){s.commandProvider=c},get commandProvider(){return s.commandProvider}}}var f9=!1;function h9(r,e){if(f9)return;f9=!0,e.get(Gt).setApi(r)}var vp=require("vscode");var lg=_(O());var wc=_(O());var mp=class extends Ye{constructor(t,n){super("remotejupyterserveruriprovider",n.message||n.toString());this.serverProviderHandle=t;this.originalError=n}};var Uo=class extends Ye{constructor(e){super("jupyterselfcert",e)}static isSelfCertsError(e){return e.message.indexOf("reason: self signed certificate")>=0}};var xc=class extends Ye{constructor(e){super("jupyterselfexpiredcert",e)}static isSelfCertsExpiredError(e){return e.message.indexOf("reason: certificate has expired")>=0}};var Yr=Symbol("IDataScienceErrorHandler"),kn=class extends Ye{constructor(t,n,i){super(t,n);this.kernelConnectionMetadata=i}},Cc=class extends sn{constructor(t,n,i){super(t,n);this.kernelConnectionMetadata=i}};var ki=class extends Ye{constructor(t,n,i){super("remotejupyterserverconnection",y.remoteJupyterConnectionFailedWithServerWithError(g9(t),i.message||i.toString()));this.url=t;this.serverProviderHandle=n;this.originalError=i;this.baseUrl=g9(t)}};function g9(r){let e=new URL(r);return`${e.protocol}//${e.host}/`}var ix=require("vscode");var v9=require("vscode");var fp=class r{constructor(e){this.serverSettings=e;this.kernelSpecManager=new this.jupyterlab.KernelSpecManager({serverSettings:this.serverSettings}),this.kernelManager=new this.jupyterlab.KernelManager({serverSettings:this.serverSettings}),this.sessionManager=new this.jupyterlab.SessionManager({serverSettings:this.serverSettings,kernelManager:this.kernelManager}),this.contentsManager=new this.jupyterlab.ContentsManager({serverSettings:this.serverSettings})}get isDisposed(){return this.disposed===!0}get jupyterlab(){return this._jupyterlab||(this._jupyterlab=require("@jupyterlab/services")),this._jupyterlab}static create(e){return new r(e)}async dispose(){if(!this.disposed){this.disposed=!0,E("Disposing Jupyter Lab Helper");try{this.contentsManager&&(E("SessionManager - dispose contents manager"),this.contentsManager.dispose()),this.sessionManager&&!this.sessionManager.isDisposed&&(E("ShutdownSessionAndConnection - dispose session manager"),await pr(1e4,this.sessionManager.ready),this.sessionManager.dispose()),this.kernelManager?.isDisposed||this.kernelManager?.dispose(),this.kernelSpecManager?.isDisposed||this.kernelSpecManager?.dispose()}catch(e){x("Exception on Jupyter Lab Helper shutdown: ",e)}finally{E("Finished disposing Jupyter Lab Helper")}}}async getRunningSessions(){if(!this.sessionManager)return[];await pr(1e4,this.sessionManager.ready).catch(f),await this.sessionManager.refreshRunning();let e=[],t=this.sessionManager.running(),n=t.next();for(;n;)e.push(n),n=t.next();return e}async getRunningKernels(){let e=await this.jupyterlab.KernelAPI.listRunning(this.serverSettings),t=new Set;return e.map(n=>{let i=n;return{id:n.id,name:n.name,lastActivityTime:i.last_activity?new Date(Date.parse(i.last_activity.toString())):new Date,numberOfConnections:i.connections?parseInt(i.connections.toString(),10):0}}).filter(n=>t.has(n.id)?!1:(t.add(n.id),!0))}async getKernelSpecs(){if(!this.serverSettings||!this.sessionManager||!this.contentsManager)throw new gn;try{let e=new qe,t=this.kernelSpecManager;if(!t)return x(`No SessionManager to enumerate kernelspecs (no specs manager). Returning a default kernel. Specs ${JSON.stringify(this.kernelSpecManager?.specs?.kernelspecs||{})}.`),A("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsManager"}),[await Es()];let n={wasSessionManagerReady:this.sessionManager.isReady,wasSpecsManagerReady:t.isReady,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:t.isReady,waitedForChangeEvent:!1},i=(c={})=>t.specs&&Object.keys(t.specs.kernelspecs).length?t.specs.kernelspecs:c,o=i();await pr(1e4,this.sessionManager.ready),n.sessionManagerReady=this.sessionManager.isReady,await pr(1e4,t.refreshSpecs()),n.specsManagerReady=t.isReady;let s=!1;if(t&&Object.keys(t.specs?.kernelspecs||{}).length===0){let c=[],l=ue(),u=l.resolve.bind(l);t.specsChanged.connect(u),c.push(new v9.Disposable(()=>t.specsChanged.disconnect(u)));let p=Promise.all([l.promise,t.ready,t.refreshSpecs(),this.sessionManager.ready]);await pr(1e4,p),n.waitedForChangeEvent=!0,l.completed||(s=!0,A("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:t.isReady,reason:t.isReady?this.sessionManager.isReady?"SpecsDidNotChangeInTime":"SessionManagerIsNotReady":"SpecManagerIsNotReady"})),Q(c)}let a=i(o);if(Object.keys(a||{}).length){let c=[];return Object.entries(a).forEach(([l,u])=>{u&&c.push(new sp(u))}),A("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",{duration:e.elapsedTime},n),c}else return x(`Jupyter Lab Helper cannot enumerate kernelspecs. Returning a default kernel. Specs ${JSON.stringify(a)}.`),s||A("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsEventAfterRefresh"}),[await Es()]}catch(e){return x("Jupyter Lab Helper:getKernelSpecs failure: ",e),[]}}};var cn=class{constructor(e,t,n,i,o){this.jupyterPickerRegistration=e;this.configService=t;this.errorHandler=n;this.requestAgentCreator=i;this.requestCreator=o}async createConnectionInfo(e){let t=await this.getJupyterServerUri(e);if(!t)throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`);let n={baseUrl:t.connectionInformation.baseUrl.toString(!0),displayName:t.label,token:t.connectionInformation.token||"",authorizationHeader:t.connectionInformation.headers||{},fetch:t.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:t.connectionInformation.WebSocket};return XS(e,n,this.requestCreator,this.requestAgentCreator,this.configService,ix.Uri.file(""))}async validateRemoteUri(e,t,n){let i;if(!t){let s=await this.getJupyterServerUri(e);if(s)t={baseUrl:s.connectionInformation.baseUrl.toString(!0),displayName:s.label,token:s.connectionInformation.token||"",authorizationHeader:s.connectionInformation.headers||{},fetch:s.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:s.connectionInformation.WebSocket};else throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`)}let o=XS(e,t,this.requestCreator,this.requestAgentCreator,this.configService,ix.Uri.file(""));try{i=fp.create(o.settings),await Promise.all([i.getRunningKernels(),i.getKernelSpecs()])}catch(s){if(Uo.isSelfCertsError(s)){if(!await $E(this.configService,s.message))throw s}else if(xc.isSelfCertsExpiredError(s)){if(!await HE(this.configService,s.message))throw s}else throw t&&!n&&await this.errorHandler.handleError(new ki(t.baseUrl,e,s)),s}finally{o.dispose(),i&&i.dispose().catch(f)}}async getJupyterServerUri(e){let t=new ix.CancellationTokenSource;try{let n=this.jupyterPickerRegistration.jupyterCollections.find(c=>c.extensionId===e.extensionId&&c.id===e.id)||await this.jupyterPickerRegistration.activateThirdPartyExtensionAndFindCollection(e.extensionId,e.id);if(!n)return;let i=await Promise.resolve(n.serverProvider.provideJupyterServers(t.token)),o=i?.find(c=>c.id===e.handle);if(!o&&i?.length===0)try{o=await n.serverProvider.resolveJupyterServer({id:e.handle,label:""},t.token)}catch{}if(!o)return;if(o.connectionInformation)return o;let s=await Promise.resolve(n.serverProvider.resolveJupyterServer(o,t.token));if(!s?.connectionInformation)return;let a=Object.assign({},o);return a.connectionInformation=s.connectionInformation,a}catch(n){throw n instanceof Ye?n:new mp(e,n)}finally{t.dispose()}}};cn=v([(0,wc.injectable)(),d(0,(0,wc.inject)(Qt)),d(1,(0,wc.inject)(le)),d(2,(0,wc.inject)(Yr)),d(3,(0,wc.inject)(dp)),d(3,(0,wc.optional)()),d(4,(0,wc.inject)(Fl))],cn);var fa=class{constructor(e,t,n){this.serverUriStorage=e;this.jupyterConnection=t;this.serverProviderRegistry=n}async addJupyterServer(e){if(e.extensionId.toLowerCase()!=Ba.toLowerCase())throw new Error("Deprecated API");try{await this.jupyterConnection.validateRemoteUri(e)}catch(t){x(`Error in validating the Remote Uri ${e.id}.${e.handle}`,t);return}this.serverProviderRegistry.jupyterCollections.some(t=>t.extensionId===e.extensionId)||await this.serverUriStorage.add(e)}};fa=v([(0,lg.injectable)(),d(0,(0,lg.inject)(er)),d(1,(0,lg.inject)(cn)),d(2,(0,lg.inject)(Qt))],fa);var y9=" (Interactive)",Ct=Symbol("IControllerRegistration");var EP=Symbol("IRemoteNotebookKernelSourceSelector"),PP=Symbol("ILocalNotebookKernelSourceSelector"),vm=Symbol("ILocalPythonNotebookKernelSourceSelector"),hp=Symbol("IConnectionDisplayData");var b9=_(O()),Ec=require("vscode");var gp=require("vscode");function mr(r,e=!1){return typeof r!="object"||!r?!1:!!(r instanceof gp.CancellationError||e&&(r.message.includes("Canceled")||r.message.includes(ye.canceled)))}async function fr(r,e,...t){let n;return _w(e)?(t.push(e),n=void 0):n=e,r?r.isCancellationRequested?n:new Promise((i,o)=>{if(r.isCancellationRequested)return i(n);let s=r.onCancellationRequested(()=>{s.dispose(),i(n)});Promise.race(t).then(i,o).finally(()=>s.dispose())}):await Promise.race(t)}async function ar(r,...e){if(!r)return Promise.race(e);if(r.isCancellationRequested)throw new gp.CancellationError;return new Promise((t,n)=>{if(r.isCancellationRequested)return n(new gp.CancellationError);let i=r.onCancellationRequested(()=>{i.dispose(),n(new gp.CancellationError)});Promise.race(e).then(t,n).finally(()=>i.dispose())})}function kP(...r){let e=new gp.CancellationTokenSource,t=[];for(let i of r)i&&(i.isCancellationRequested&&e.cancel(),i.onCancellationRequested(()=>e.cancel(),void 0,t));let n=e.dispose.bind(e);return e.dispose=()=>{n(),Q(t)},e}var yn;(e=>{function r(t){if(t?.isCancellationRequested)throw new gp.CancellationError}e.throwIfCanceled=r})(yn||={});function I9(r){let e=new Map,t=(a,c)=>{if(!e.has(a)){let l={id:a,label:c.displayName,connectionInformation:{baseUrl:Ec.Uri.parse(c.baseUrl),token:c.token,fetch:c.fetch,headers:c.authorizationHeader,WebSocket:c.WebSocket}};e.set(a,{serverUri:c,server:l})}return e.get(a).server},n=new Ec.EventEmitter,i={async provideJupyterServers(a){let c=r.getHandles?await ar(a,r.getHandles()):[];return!c||c.length===0?[]:ar(a,Promise.all(c.map(l=>r.getServerUri(l).then(u=>t(l,u)))))},resolveJupyterServer(a,c){return a},onDidChangeServers:n.event};if(!r.handleQuickPick||!r.getQuickPickEntryItems)return{serverProvider:i};let o=new Map;return{serverProvider:i,commandProvider:{async handleCommand(a,c){let l=o.get(a.label);if(!l||!r.handleQuickPick)return;let u=await ar(c,r.handleQuickPick(l,!0));if(u==="back")return;if(!u)throw new Ec.CancellationError;let p=await r.getServerUri(u);return t(u,p)},async provideCommands(a,c){return r.getQuickPickEntryItems?(await ar(c,Promise.resolve(r.getQuickPickEntryItems()))).map(u=>{let p={label:dh(u.label),canBeAutoSelected:u.default,description:dh(u.description)};return o.set(p.label,u),p}):[]}}}}var RN=class extends fP{constructor(t,n,i,o){super();this.extensionId=t;this.id=n;this.label=i;this.serverProvider=o;this._onDidChangeProvider=new Ec.EventEmitter;this.onDidChangeProvider=this._onDidChangeProvider.event}set commandProvider(t){this._commandProvider=t,this._onDidChangeProvider.fire()}get commandProvider(){return this._commandProvider}},ug=class extends Zt{constructor(){super();this._onDidChangeCollections=new Ec.EventEmitter;this._collections=new Map;Te.instance.get(F).push(this)}get onDidChangeCollections(){return this._onDidChangeCollections.event}get jupyterCollections(){return Array.from(this._collections.values())}async activateThirdPartyExtensionAndFindCollection(t,n){return await this.loadExtension(t,n).catch(f),this.jupyterCollections.find(i=>i.extensionId===t&&i.id===n)}async loadExtension(t,n){if(t===It)return;let i=Ec.extensions.getExtension(t);if(!i)throw new Error(`Extension '${t}' that provides Jupyter Server '${n}' not found`);i.isActive||await i.activate().then(f,f)}createJupyterServerCollection(t,n,i,o){let s=`${t}#${n}`;if(this._collections.has(s)&&t!==It)throw new Error(`Jupyter Server Provider with id ${s} already exists`);let a=new RN(t,n,i,o);return this._collections.set(s,a),this._onDidChangeCollections.fire({added:[a],removed:[]}),this._register(a.onDidDispose(()=>{this._collections.delete(s),this._onDidChangeCollections.fire({removed:[a],added:[]})},this)),a}};ug=v([(0,b9.injectable)()],ug);var _P=Symbol("IExportedKernelServiceFactory");function pae(r,e){return new Promise(t=>{e.onDidChange(n=>{for(let i of n.added)Ft(i.connection)&&i.connection.serverProviderHandle.id===r.id&&i.connection.serverProviderHandle.handle===r.handle&&t()})})}function S9(r,e){let t=e.get(oa),n=r.id.startsWith("_builtin")?It:t.determineExtensionFromCallStack().extensionId;if(x(`The API registerRemoteServerProvider has being deprecated and will be removed soon, please use createJupyterServerCollection (extension ${n}).`),n.toLowerCase()!=Ba.toLowerCase())throw new Error("Deprecated API");A("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:n,pemUsed:"registerRemoteServerProvider"});let{serverProvider:i,commandProvider:o}=I9(r),s=wP(r.id,r.displayName||r.detail||r.id,i,n,e);return o&&(s.commandProvider=o),{dispose:()=>{s.dispose()}}}function x9(r){return r.then(()=>void 0).catch(e=>(x("Failure during activation.",e),Promise.reject(e)))}function C9(r){let e=r.get(oa);return A("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:e.determineExtensionFromCallStack().extensionId,pemUsed:"registerRemoteServerProvider"}),r.get(_P).getService()}async function w9(r,e,t){let n=t.get(oa);x("The API addRemoteJupyterServer has being deprecated and will be removed soon, please use createJupyterServerCollection.");let i=n.determineExtensionFromCallStack().extensionId;if(i.toLowerCase()!=Ba.toLowerCase())throw new Error("Deprecated API");A("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:i,pemUsed:"addRemoteJupyterServer"});let o=t.get(fa),s=t.get(Ct),a=pae({id:r,handle:e},s);await o.addJupyterServer({id:r,handle:e,extensionId:i}),await a}async function E9(r,e,t){let n=t.get(oa);A("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:n.determineExtensionFromCallStack().extensionId,pemUsed:"openNotebook"});let i=t.get(Ct),o=typeof e=="string"?e:void 0,s=typeof e=="string"?void 0:e,a=o&&i.all.find(l=>l.id===e)?.id;if(!a&&s&&!Vu()&&(a=i.all.find(l=>l.kind==="startUsingPythonInterpreter"&&l.interpreter.id===s.id)?.id,!a)){let u=await t.get(vm).getKernelConnection(s);a=u&&i.all.find(p=>p.id===u?.id)?.id}if(!a)throw new Error(`Kernel ${e} not found.`);let c=vp.window.activeNotebookEditor?.notebook?.uri?.toString()===r.toString()?vp.window.activeNotebookEditor:await vp.window.showNotebookDocument(await vp.workspace.openNotebookDocument(r));return await vp.commands.executeCommand("notebook.selectKernel",{notebookEditor:c,id:a,extension:It}),c.notebook}function P9(r,e,t,n){let i=t.get(oa),o={ready:x9(r),registerPythonApi:s=>h9(s,t),registerRemoteServerProvider:s=>S9(s,t),getKernelService:()=>C9(t),addRemoteJupyterServer:(s,a)=>w9(s,a,t),openNotebook:async(s,a)=>E9(s,a,t),createJupyterServerCollection:(s,a,c)=>wP(s,a,c,i.determineExtensionFromCallStack().extensionId,t),get kernels(){return m9(i.determineExtensionFromCallStack().extensionId)}};return(Tr()||n.extensionMode===AN.ExtensionMode.Development||n.extensionMode===AN.ExtensionMode.Test)&&(o.serviceContainer=t,o.serviceManager=e),o}var k9=Symbol("IServiceManager"),ut=Symbol("IServiceContainer");var _9=require("vscode");async function D9(r,e,t){if(!Tr())try{await r,e.totalActivateTime=t.elapsedTime,await R9(e),A("EXTENSION.LOAD",e)}catch(n){x("sendStartupTelemetry() failed.",n)}}async function T9(r,e){try{let t={};try{await R9(e)}catch(n){x("getActivationTelemetryProps() failed.",n)}A("EXTENSION.LOAD",e,t,r)}catch(t){x("sendErrorTelemetry() failed.",t)}}async function R9(r){let e=_9.workspace.workspaceFolders?.length??0;r.workspaceFolderCount=e}var DP=Symbol("IExtensionActivationManager"),be=Symbol("IExtensionSyncActivationService");var Ll=_(O());var Pc=Symbol("IEnvironmentVariablesService"),kc=Symbol("ICustomEnvironmentVariablesProvider");var tt=Symbol("IInterpreterService");var AP=_(O()),_c=require("vscode");var dae={JupyterSessionWaitForIdleSession:y.waitingForJupyterSessionToBeIdle,KernelsGetKernelForRemoteConnection:y.gettingListOfKernelsForRemoteConnection,KernelsGetKernelSpecs:y.gettingListOfKernelSpecs,KernelsRegisterKernel:y.registeringKernel,NotebookConnect:y.connectingToJupyter,NotebookStart:y.startingJupyterNotebook,InstallingMissingDependencies:y.installingMissingDependencies,ExportNotebookToPython:y.exportNotebookToPython,PerformingExport:y.performingExport};function RP(r){return dae[r]}var ht=class{constructor(e){this.kernelResourceProgressReporter=new Map;e.push(this),ht.instance=this}activate(){}dispose(){Q(Array.from(ht.disposables))}static createProgressReporter(e,t,n){if(!ht.instance)return new _c.Disposable(f);let i=e?fn(e):"";return ht.instance.kernelResourceProgressReporter.has(i)?ht.reportProgress(e,t):ht.createProgressReporterInternal(i,t,n)}static wrapAndReportProgress(e,t,n){let i=e?fn(e):"";if(!ht.instance)return n();let o=ht.reportProgressInternal(i,t);return n().finally(()=>o?.dispose())}static reportProgress(e,t){let n=RP(t)||t,i=e?fn(e):"";return n?ht.reportProgressInternal(i,n||""):new _c.Disposable(()=>f)}static reportProgressInternal(e,t){if(!ht.instance)return new _c.Disposable(f);let n=ht.instance.kernelResourceProgressReporter.get(e);if(n||(n={title:t,pendingProgress:[],progressList:[],dispose:f},ht.instance.kernelResourceProgressReporter.set(e,n)),n.reporter)n.progressList.push(t),n.reporter.report({message:t});else{if(n.progressList.includes(t))return new _c.Disposable(f);n.pendingProgress.push(t)}return{dispose:()=>{try{if(!n)return;let i=n.progressList.findIndex(o=>o===t);if(i>=0&&n.progressList.splice(i),n.progressList.length>0){let o=n.progressList[n.progressList.length-1];n.reporter&&n.reporter.report({message:o===n.title&&n.reporter?"":o})}else ht.instance.kernelResourceProgressReporter.delete(e),n.dispose()}catch(i){x(`Failed to dispose Progress reporter for ${e}`,i)}}}}static createProgressReporterInternal(e,t,n){let i=ue(),o=new _c.Disposable(()=>i.resolve()),s=ht.instance.kernelResourceProgressReporter.get(e)||{title:t,pendingProgress:[],progressList:[],tokenSources:[],dispose:()=>{o.dispose()}},a=!1,c=()=>{a||(a=!0,_c.window.withProgress({location:_c.ProgressLocation.Notification,title:t},async(l,u)=>{let p=ht.instance.kernelResourceProgressReporter.get(e);if(p){for(p.reporter=l;p.pendingProgress.length>0;){let m=p.pendingProgress.shift();m===t?p.progressList.push(m):m!==t&&m&&(p.progressList.push(m),l.report({message:m}))}await fr(u,i.promise),ht.instance.kernelResourceProgressReporter.get(e)===p&&ht.instance.kernelResourceProgressReporter.delete(e),ht.disposables.delete(o)}}).then(f,f))};return ht.instance.kernelResourceProgressReporter.set(e,{...s,dispose:()=>o.dispose(),show:c}),ht.disposables.add(o),s.pendingProgress.push(t),n||c(),{dispose:()=>o.dispose(),show:c}}};ht.disposables=new Set,ht=v([(0,AP.injectable)(),d(0,(0,AP.inject)(F))],ht);var pg=_(O()),NP=require("vscode");var Er=Symbol("IPlatformService"),st=Symbol("IFileSystem");var mDe=Symbol("IBufferDecoder"),_i=Symbol("IProcessServiceFactory"),ox=class extends Ye{constructor(e){super("unknown",e)}};var NN=class{constructor(e,t){this.uri=e;this.value=t}};function mae(r){return Array.isArray(r)}var fae,uo=class r{constructor(e,t){this[fae]="ResourceMap";if(e instanceof r)this.map=new Map(e.map),this.toKey=t??r.defaultToKey;else if(mae(e)){this.map=new Map,this.toKey=t??r.defaultToKey;for(let[n,i]of e)this.set(n,i)}else this.map=new Map,this.toKey=e??r.defaultToKey}static{this.defaultToKey=e=>e.toString()}set(e,t){return this.map.set(this.toKey(e),new NN(e,t)),this}get(e){return this.map.get(this.toKey(e))?.value}has(e){return this.map.has(this.toKey(e))}get size(){return this.map.size}clear(){this.map.clear()}delete(e){return this.map.delete(this.toKey(e))}forEach(e,t){typeof t<"u"&&(e=e.bind(t));for(let[,n]of this.map)e(n.value,n.uri,this)}*values(){for(let e of this.map.values())yield e.value}*keys(){for(let e of this.map.values())yield e.uri}*entries(){for(let e of this.map.values())yield[e.uri,e.value]}*[(fae=Symbol.toStringTag,Symbol.iterator)](){for(let[,e]of this.map)yield[e.uri,e.value]}},hae,Dc=class{constructor(e,t){this[hae]="ResourceSet";!e||typeof e=="function"?this._map=new uo(e):(this._map=new uo(t),e.forEach(this.add,this))}get size(){return this._map.size}add(e){return this._map.set(e,e),this}clear(){this._map.clear()}delete(e){return this._map.delete(e)}forEach(e,t){this._map.forEach((n,i)=>e.call(t,i,i,this))}has(e){return this._map.has(e)}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.keys()}[(hae=Symbol.toStringTag,Symbol.iterator)](){return this.keys()}};var gae,A9=class{constructor(){this[gae]="LinkedMap";this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=0){let n=this._map.get(e);if(n)return t!==0&&this.touch(n,t),n.value}set(e,t,n=0){let i=this._map.get(e);if(i)i.value=t,n!==0&&this.touch(i,n);else{switch(i={key:e,value:t,next:void 0,previous:void 0},n){case 0:this.addItemLast(i);break;case 1:this.addItemFirst(i);break;case 2:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let n=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this,t=this._state,n=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let o={value:n.key,done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return i}values(){let e=this,t=this._state,n=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let o={value:n.value,done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return i}entries(){let e=this,t=this._state,n=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let o={value:[n.key,n.value],done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return i}[(gae=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==1&&t!==2)){if(t===1){if(e===this._head)return;let n=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===2){if(e===this._tail)return;let n=e.next,i=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,n)=>{e.push([n,t])}),e}fromJSON(e){this.clear();for(let[t,n]of e)this.set(t,n)}};var Tc=class{constructor(e,t,n){this.processFactory=e;this.platform=t;this.fs=n;this.userSitePaths=new uo}async getExecutablesPath(e){let t=e.executable.uri;if(!(Jr(e)!=="Unknown"||!t)){if(!this.userSitePaths.has(t)){let n=this.getUserSitePathImpl(t);n.catch(()=>{this.userSitePaths.get(t)===n&&this.userSitePaths.delete(t)}),this.userSitePaths.set(t,n)}return this.userSitePaths.get(t)}}async getUserSitePathImpl(e){let t=await this.processFactory.create(void 0),n="USER_BASE_VALUE",i=this.platform.isWindows?"USER_SITE":"USER_BASE",{stdout:o}=await t.exec(e.fsPath,["-c",`import site;print("${n}");print(site.${i});print("${n}");`]);if(o.includes(n)){let s=o.substring(o.indexOf(n)+n.length,o.lastIndexOf(n)).trim(),a=NP.Uri.file(s),c;if(this.platform.isWindows?c=NP.Uri.joinPath(Ii(a),"Scripts"):c=NP.Uri.joinPath(a,"bin"),!c||!this.fs.exists(c))throw new Error(`USER_SITE ${c.fsPath} dir does not exist for the interpreter ${W(e)}`);return E(`USER_SITE for ${W(e)} is ${c.fsPath}`),c}else throw new Error(`USER_SITE not found for the interpreter ${W(e)}. Stdout: ${o}`)}};v([Mr()],Tc.prototype,"getExecutablesPath",1),Tc=v([(0,pg.injectable)(),d(0,(0,pg.inject)(_i)),d(1,(0,pg.inject)(Er)),d(2,(0,pg.inject)(st))],Tc);var MN=require("vscode");var N9=6e4,yp=class{constructor(e,t,n,i,o,s){this.interpreterService=e;this.customEnvVarsService=t;this.apiProvider=n;this.extensionChecker=i;this.envVarsService=o;this.globalExecPaths=s;this.disposables=[];this.activatedEnvVariablesCache=new Map;this.cachedEnvVariables=new Map;this.customEnvVarsService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables),this.interpreterService.onDidChangeInterpreter(this.clearCache,this,this.disposables),this.interpreterService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables)}clearCache(){this.activatedEnvVariablesCache.clear(),this.cachedEnvVariables.clear()}dispose(){this.disposables.forEach(e=>e.dispose())}async getActivatedEnvironmentVariables(e,t,n){let i=this.interpreterService.known.find(s=>s.id===t.id)||await this.interpreterService.resolveEnvironment(t.id);if(!i)return;let o=y.activatingPythonEnvironment(np(i));return ht.wrapAndReportProgress(e,o,async()=>this.getActivatedEnvironmentVariablesImplWithCaching(e,await this.interpreterService.resolveEnvironment(i)||i,n))}async getActivatedEnvironmentVariablesImplWithCaching(e,t,n){let i=`${e?.toString()||""}${t.id}`,o=this.activatedEnvVariablesCache.get(i);if(o&&o.time.elapsedTime>=N9&&this.activatedEnvVariablesCache.delete(i),!this.activatedEnvVariablesCache.has(i)){let a=this.getActivatedEnvironmentVariablesImpl(e,t,n);a.catch(f),this.activatedEnvVariablesCache.set(i,{promise:a,time:new qe})}let s=this.activatedEnvVariablesCache.get(i).promise;return n?s:fr(n,s)}async getActivatedEnvironmentVariablesImpl(e,t,n){if(!this.extensionChecker.isPythonExtensionInstalled)return;let i=new qe;return this.getActivatedEnvironmentVariablesFromPython(e,t,n).then(o=>{if(!n?.isCancellationRequested)return o}).catch(o=>{x(`Failed to get env vars with python ${W(t.id)} in ${i.elapsedTime}ms`,o)})}async getActivatedEnvironmentVariablesFromPython(e,t,n){let i=`${e?.toString()||""}${t.id||""}`,o=this.cachedEnvVariables.get(i);if(o&&o.lastRequestedTime.elapsedTime>N9&&this.cachedEnvVariables.delete(i),!this.cachedEnvVariables.has(i)){let s=this.getActivatedEnvironmentVariablesFromPythonImpl(e,t,n);this.cachedEnvVariables.set(i,{promise:s,lastRequestedTime:new qe})}return fr(n,this.cachedEnvVariables.get(i).promise)}async getActivatedEnvironmentVariablesFromPythonImpl(e,t,n){e=e||(MN.workspace.workspaceFolders?.length?MN.workspace.workspaceFolders[0].uri:void 0);let i=new qe,o=this.customEnvVarsService.getEnvironmentVariables(e,"RunPythonCode").catch(()=>{}),s="emptyVariables",a,c=await this.apiProvider.getApi().then(u=>u.getActivatedEnvironmentVariables(e,Ol(qE(t,!0)),!1).catch(p=>{x(`Failed to get activated env variables from Python Extension for ${W(t.path)}`,p),s="failedToGetActivatedEnvVariablesFromPython"}));if(n?.isCancellationRequested)return;let l=Jr(t);if(A("DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",{duration:i.elapsedTime},{envType:l,source:"python",failed:Object.keys(c||{}).length===0,reason:s},a),c?E(`Got env vars with python ${W(t.path)}, with env var count ${Object.keys(c||{}).length} in ${i.elapsedTime}ms. 
    PATH value is ${c.PATH} and 
    Path value is ${c.Path}`):l==="Conda"?x(`Failed to get activated conda env vars for ${W(t.path)}
                 in ${i.elapsedTime}ms`):j(`Failed to get activated env vars for ${W(t.path)} in ${i.elapsedTime}ms`),!c){let u=await o;if(c={},Jr(t)==="Conda"){let b=await pa(t);b?c.CONDA_PREFIX=b:j(`Failed to get the SysPrefix for the Conda Environment ${W(t.path)}}`)}this.envVarsService.mergeVariables(process.env,c),this.envVarsService.mergeVariables(u,c),this.envVarsService.mergePaths(process.env,c),process.env.PYTHONPATH&&(c.PYTHONPATH=process.env.PYTHONPATH);let p=u?Object.keys(u).find(b=>b.toLowerCase()=="path"):void 0;p&&u[p]&&this.envVarsService.appendPath(c,u[p]),u.PYTHONPATH&&this.envVarsService.appendPythonPath(c,u.PYTHONPATH);let m=await this.globalExecPaths.getExecutablesPath(t).catch(f);if(n?.isCancellationRequested)return;let h=c.PATH||c.Path,g=h?h.split(Jn):[];m&&g[1]!==m.fsPath?(E(`Prepend PATH with user site path for ${W(t.path)}, user site ${m.fsPath}`),this.envVarsService.prependPath(c,m.fsPath)):ua(t)||x(`Unable to determine site packages path for python ${W(t.path)} (${Jr(t)})`),!c.PATH&&c.Path&&(c.PATH=c.Path)}return E(`Prepend PATH with python bin for ${W(t.path)}`),t.executable.uri&&this.envVarsService.prependPath(c,pt(t.executable.uri.fsPath)),E(`Activated Env Variables for ${W(t.path)}, 
    PATH value is ${c.PATH} and 
    Path value is ${c.Path}`),c}};v([ti("Getting activated env variables",5),d(1,Tl("id"))],yp.prototype,"getActivatedEnvironmentVariablesImpl",1),v([d(1,Tl("id")),d(2,Qu())],yp.prototype,"getActivatedEnvironmentVariablesFromPython",1),yp=v([(0,Ll.injectable)(),d(0,(0,Ll.inject)(tt)),d(1,(0,Ll.inject)(kc)),d(2,(0,Ll.inject)(Gt)),d(3,(0,Ll.inject)(ze)),d(4,(0,Ll.inject)(Pc)),d(5,(0,Ll.inject)(Tc))],yp);var Ps=Symbol("IEnvironmentActivationService");var mg=_(O()),fg=require("vscode");var dg=class{constructor(e,t,n){this.disposables=e;this.extensionChecker=t;this.pythonApi=n;this._changed=new fg.EventEmitter;this._registered=!1;fg.window.onDidChangeActiveNotebookEditor(()=>{this._changed.fire()},this,e)}activate(){this.extensionChecker.isPythonExtensionActive?this.registerStatusFilter():this.pythonApi.onDidActivatePythonExtension(this.registerStatusFilter,this,this.disposables)}get changed(){return this._changed.event}get hidden(){return!!(fg.window.activeNotebookEditor&&Tt(fg.window.activeNotebookEditor.notebook))}registerStatusFilter(){this._registered||(this._registered=!0,this.pythonApi.getApi().then(e=>{e.registerInterpreterStatusFilter&&(e.registerInterpreterStatusFilter(this),this._changed.fire())}).catch(f))}};dg=v([(0,mg.injectable)(),d(0,(0,mg.inject)(F)),d(1,(0,mg.inject)(ze)),d(2,(0,mg.inject)(Gt))],dg);function M9(r){r.addSingleton(Gt,$h),r.addSingleton(ze,ip),r.addSingleton(tt,Hh),r.addSingleton(be,dg),r.addSingleton(Ps,yp)}var O9=_(O());var sx=require("vscode");var hg=class{activate(){sx.commands.registerCommand("jupyter.reloadVSCode",this.onReloadVSCode,this)}async onReloadVSCode(e){await sx.window.showInformationMessage(e,ye.reload)===ye.reload&&sx.commands.executeCommand("workbench.action.reloadWindow").then(f,f)}};hg=v([(0,O9.injectable)()],hg);var K9=_(O()),zi=require("vscode");var Ul=class{get activeDebugConsole(){return zi.debug.activeDebugConsole}get activeDebugSession(){return ne(`Getting active debug session, ${zi.debug.activeDebugSession?.name}`),zi.debug.activeDebugSession}get breakpoints(){return zi.debug.breakpoints}get onDidChangeActiveDebugSession(){return zi.debug.onDidChangeActiveDebugSession}get onDidStartDebugSession(){return zi.debug.onDidStartDebugSession}get onDidReceiveDebugSessionCustomEvent(){return zi.debug.onDidReceiveDebugSessionCustomEvent}get onDidTerminateDebugSession(){return zi.debug.onDidTerminateDebugSession}get onDidChangeBreakpoints(){return zi.debug.onDidChangeBreakpoints}registerDebugConfigurationProvider(e,t){return zi.debug.registerDebugConfigurationProvider(e,t)}registerDebugAdapterTrackerFactory(e,t){return zi.debug.registerDebugAdapterTrackerFactory(e,t)}startDebugging(e,t,n){return zi.debug.startDebugging(e,t,n)}addBreakpoints(e){zi.debug.addBreakpoints(e)}removeBreakpoints(e){zi.debug.removeBreakpoints(e)}};Ul.instance=new Ul,Ul=v([(0,K9.injectable)()],Ul);var MP=_(O()),ON=require("vscode");var gg=class{constructor(e){this.extensionContext=e;this.testingState=new Map}async store(e,t,n){if(Zn&&this.extensionContext.extensionMode!==ON.ExtensionMode.Production){this.testingState.set(`${e}#${t}`,n||"");return}if(n)await this.extensionContext.secrets.store(`${e}.${t}`,n);else try{await this.extensionContext.secrets.delete(`${e}.${t}`)}catch(i){x(i)}}async retrieve(e,t){if(Zn&&this.extensionContext.extensionMode!==ON.ExtensionMode.Production)return this.testingState.get(`${e}#${t}`);try{return await this.extensionContext.secrets.get(`${e}.${t}`)}catch{try{await this.extensionContext.secrets.delete(`${e}.${t}`);return}catch(i){x(i)}}}};gg=v([(0,MP.injectable)(),d(0,(0,MP.inject)(lt))],gg);var F9=_(O()),KN=require("vscode");var vg=class{determineExtensionFromCallStack(e){e=e||new Error().stack;try{if(e){let t=KN.extensions.getExtension(It).extensionUri.toString().toLowerCase(),n=e.split(`
`).map(i=>{let o=/\((.*)\)/.exec(i);if(o)return o[1]}).filter(i=>i&&!i.toLowerCase().startsWith(t));$A(new Error("Ex")).forEach(i=>{let o=i.getFileName();o&&!o.toLowerCase().startsWith(t)&&n.push(o)});for(let i of n){let o=KN.extensions.all.find(s=>s.id!==It&&(i.toLowerCase().startsWith(s.extensionUri.fsPath.toLowerCase())||i.toLowerCase().startsWith(s.extensionUri.path.toLowerCase())));if(o)return{extensionId:o.id,displayName:o.packageJSON.displayName}}}return{extensionId:IS,displayName:y.unknownPackage}}catch(t){return x("Unable to determine the caller of the extension API for trace stack.",e),x("Failure error",t),{extensionId:IS,displayName:y.unknownPackage}}}};vg=v([(0,F9.injectable)()],vg);var OP=Symbol("IWorkspaceService"),Di=Symbol("IDebugManager"),Rc=Symbol("IApplicationEnvironment"),KTe=Symbol("IWebviewPanelMessageListener"),FTe=Symbol("IWebviewViewMessageListener"),LTe=Symbol("IWebview"),UTe=Symbol("IWebviewView"),jTe=Symbol("IWebviewPanel"),bp=Symbol("IWebviewPanelProvider"),KP=Symbol("IWebviewViewProvider"),ax=Symbol("IEncryptedStorage");var L9=_(O());var yg=class{constructor(){this._list=[]}async dispose(){let e=this._list.map(t=>t.dispose());await Promise.all(e),this._list=[]}push(e){e&&this._list.push(e)}get list(){return this._list}};yg=v([(0,L9.injectable)()],yg);var kp=_(O()),JB=require("vscode"),yx=_(qB());var dk=class{setSharedProperty(e,t){Kh(e,t)}postEvent(e,t){let n={};t.forEach((i,o)=>{n[o]=i}),A(e,void 0,n)}};var qM=_(require("vscode")),mk=_(O());var Dg=class{constructor(e){this.extensionContext=e}get extensionVersion(){return this.extensionContext.extension.packageJSON.version}};Dg=v([(0,mk.injectable)(),d(0,(0,mk.inject)(lt))],Dg);function fo(){return qM.env.appName.indexOf("Insider")>0||qM.env.appName.indexOf("Code - OSS Dev")>=0?"insiders":"stable"}var Que="VSCode.ABExp.FeatureData",JM="vscode",Tg=class{constructor(e,t,n){this.configurationService=e;this.appEnvironment=t;this.globalState=n;this._optInto=[];this._optOutFrom=[];this.settings=e.getSettings(void 0);let i=this.settings.experiments.optInto,o=this.settings.experiments.optOutFrom;if(this._optInto=i.filter(c=>!c.endsWith("control")),this._optOutFrom=o.filter(c=>!c.endsWith("control")),!this.enabled)return;let s;fo()==="insiders"?s=yx.TargetPopulation.Insiders:s=yx.TargetPopulation.Public;let a=new dk;this.experimentationService=(0,yx.getExperimentationService)(It,this.appEnvironment.extensionVersion,s,a,this.globalState)}get enabled(){return this.settings.experiments.enabled&&!this.settings.experiments.optOutFrom.includes("All")}async activate(){this.experimentationService&&this.enabled&&(E(`Experimentation service retrieved: ${this.experimentationService}`),await this.experimentationService.initializePromise,this.getFeatures().length===0&&await this.experimentationService.initialFetch,this.logExperiments())}inExperiment(e){return!this.experimentationService||!this.enabled||this._optOutFrom.includes(e.toString())?!1:this._optInto.includes(e.toString())||this._optInto.includes("All")?(this.experimentationService.getTreatmentVariable(JM,e),!0):e==="KernelCompletions"&&(fo()==="insiders"||Lu())||e==="DoNotWaitForZmqPortsToBeUsed"&&(fo()==="insiders"||Lu())||e==="DataViewerContribution"&&(fo()==="insiders"||Lu())?!0:this.experimentationService.getTreatmentVariable(JM,e)===!0}async getExperimentValue(e){if(!(!this.experimentationService||!this.enabled||this._optOutFrom.includes(e)))return this.experimentationService.getTreatmentVariable(JM,e)}getFeatures(){return this.globalState.get(Que,{features:[]}).features}logExperiments(){let e=JB.workspace.getConfiguration("telemetry"),t=!1;if(e&&e.get("enableTelemetry")===!1&&(z("Telemetry is disabled"),t=!0),e&&e.get("telemetryLevel")==="off"&&(z("Telemetry level is off"),t=!0),t&&z("Experiments are disabled, only manually opted experiments are active."),this._optOutFrom.includes("All"))return;if(this._optInto.includes("All")){z(Zu.inGroup("All"));return}let n=new Set(this._optInto),i=new Set;this._optOutFrom.filter(o=>o!=="All").forEach(o=>{z(Zu.notInGroup(o))}),this._optInto.filter(o=>o!=="All").forEach(o=>{i.add(o),z(Zu.inGroup(o))}),t&&!i.has("KernelCompletions")&&(fo()==="insiders"||Lu())&&z(Zu.inGroup("KernelCompletions")),t&&!i.has("DoNotWaitForZmqPortsToBeUsed")&&(fo()==="insiders"||Lu())&&z(Zu.inGroup("DoNotWaitForZmqPortsToBeUsed")),t||this.getFeatures().forEach(o=>{o.toLowerCase().startsWith("jupyter")&&!this._optOutFrom.includes(o)&&!this._optInto.includes(o)&&(n.add(o),z(Zu.inGroup(o)))})}};Tg=v([(0,kp.injectable)(),d(0,(0,kp.inject)(le)),d(1,(0,kp.inject)(Rc)),d(2,(0,kp.inject)($e)),d(2,(0,kp.named)(St))],Tg);var hk=_(O()),Wo=require("vscode");var fk=require("vscode");function Rg(r){fk.env.openExternal(typeof r=="string"?fk.Uri.parse(r):r).then(f,f)}var Yue=[{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE",message:LS.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/309",setting:{setting:"formatting.formatOnSave",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE",message:LS.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/313",setting:{setting:"linting.lintOnTextChange",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES",message:LS.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/1704",setting:{setting:"autoComplete.preloadModules"}}],Ag=class{constructor(e){this.persistentStateFactory=e;this._onDidChangeFeatures=new Wo.EventEmitter;this.onDidChangeFeatures=this._onDidChangeFeatures.event;this._features={};this.disposables=[];this._updateFeatures(),this.disposables.push(Wo.workspace.onDidChangeConfiguration(()=>{this._updateFeatures()}))}get features(){return this._features}set features(e){this._features=e,this._onDidChangeFeatures.fire()}_updateFeatures(){this.features={}}dispose(){this.disposables.forEach(e=>e.dispose())}initialize(){Yue.forEach(this.registerDeprecation.bind(this))}registerDeprecation(e){Array.isArray(e.commands)&&e.commands.forEach(t=>{this.disposables.push(Wo.commands.registerCommand(t,()=>this.notifyDeprecation(e),this))}),e.setting&&this.checkAndNotifyDeprecatedSetting(e)}async notifyDeprecation(e){let t=this.persistentStateFactory.createGlobalPersistentState(e.doNotDisplayPromptStateKey,!0);if(!t.value)return;let n="Learn more",i="Never show again",o=await Wo.window.showInformationMessage(e.message,n,i);if(o)switch(o){case n:{Rg(e.moreInfoUrl);break}case i:{await t.updateValue(!1);break}default:throw new Error("Selected option not supported.")}}checkAndNotifyDeprecatedSetting(e){let t=!1;Array.isArray(Wo.workspace.workspaceFolders)&&Wo.workspace.workspaceFolders.length>0?Wo.workspace.workspaceFolders.forEach(n=>{t||(t=this.isDeprecatedSettingAndValueUsed(Wo.workspace.getConfiguration("jupyter",n.uri),e.setting))}):t=this.isDeprecatedSettingAndValueUsed(Wo.workspace.getConfiguration("jupyter"),e.setting),t&&this.notifyDeprecation(e).catch(n=>E("Jupyter Extension: notifyDeprecation",n))}isDeprecatedSettingAndValueUsed(e,t){if(!e.has(t.setting))return!1;let n=e.get(t.setting);return!Array.isArray(t.values)||t.values.length===0?Array.isArray(n)?n.length>0:!0:!Array.isArray(t.values)||t.values.length===0?n===void 0?!1:Array.isArray(n)?n.length>0:!0:t.values.indexOf(e.get(t.setting))>=0}};Ag=v([(0,hk.injectable)(),d(0,(0,hk.inject)(Ga))],Ag);var _p=_(O());var gk=class{constructor(e,t,n,i){this.storage=e;this.key=t;this.defaultValue=n;this.expiryDurationMs=i}get value(){if(this.expiryDurationMs){let e=this.storage.get(this.key,{data:this.defaultValue});return!e||!e.expiry||e.expiry<Date.now()?this.defaultValue:e.data}else return this.storage.get(this.key,this.defaultValue)}async updateValue(e){this.expiryDurationMs?await this.storage.update(this.key,{data:e,expiry:Date.now()+this.expiryDurationMs}):await this.storage.update(this.key,e)}},Ng=class{constructor(e,t){this.globalState=e;this.workspaceState=t}createGlobalPersistentState(e,t,n){return new gk(this.globalState,e,t,n)}createWorkspacePersistentState(e,t,n){return new gk(this.workspaceState,e,t,n)}};Ng=v([(0,_p.injectable)(),d(0,(0,_p.inject)($e)),d(0,(0,_p.named)(St)),d(1,(0,_p.inject)($e)),d(1,(0,_p.named)(ri))],Ng);var $B="Path",HB="PATH",GB=/^win/.test(process.platform);var zB=_(O()),Mc=require("vscode");var Ne=class r extends Error{static{this.back=new r("back")}static{this.cancel=new r("cancel")}static{this.resume=new r("resume")}},bx=class{constructor(){this.steps=[]}run(e,t){return this.stepThrough(e,t)}async showQuickPick(e){return this.showLazyLoadQuickPick(e).selection}showLazyLoadQuickPick({title:e,step:t,totalSteps:n,items:i,activeItem:o,placeholder:s,buttons:a,shouldResume:c,matchOnDescription:l,matchOnDetail:u,acceptFilterBoxTextAsSelection:p,startBusy:m,stopBusy:h,validate:g,onDidTriggerItemButton:b,onDidTriggerButton:w,supportBackInFirstStep:k,onDidChangeItems:N,ignoreFocusOut:D}){let V=[],oe=ue(),G=Mc.window.createQuickPick();return G.title=e,G.step=t,G.totalSteps=n,G.placeholder=s,G.ignoreFocusOut=D??!0,G.items=i,h&&(G.busy=m??!1,h(()=>{G.enabled&&(G.busy=!1)},this,V)),N&&(G.keepScrollPosition=!0,N(pe=>{G.items=pe},this,V)),b&&G.onDidTriggerItemButton(pe=>b(pe),void 0,V),G.matchOnDescription=l||!1,G.matchOnDetail=u||!1,o?G.activeItems=[o]:G.activeItems=[],G.buttons=[...this.steps.length>1||k?[Mc.QuickInputButtons.Back]:[],...a||[]],V.push(G.onDidTriggerButton(pe=>{pe===Mc.QuickInputButtons.Back?oe.reject(Ne.back):w?w(pe):oe.resolve(pe)}),G.onDidChangeSelection(async pe=>{let de=pe.length?pe[0].label:"",te=!!de;if(de&&g&&pe.length){G.enabled=!1,G.busy=!0;let we=await g(pe[0]);we&&(te=!1,await Mc.window.showErrorMessage(we,{modal:!0})),G.enabled=!0,G.busy=!1}te&&oe.resolve(pe[0])}),G.onDidHide(()=>{(async()=>{oe.reject(c&&await c()?Ne.resume:Ne.cancel)})().catch(oe.reject)})),p&&V.push(G.onDidAccept(async()=>{if(!G.busy){let pe=g?await g(G):void 0;pe?(G.enabled=!1,G.busy=!0,await Mc.window.showErrorMessage(pe),G.enabled=!0,G.busy=!1):oe.resolve(G.value)}})),this.current&&this.current.dispose(),this.current=G,this.current.show(),oe.promise.finally(()=>Q(V)).catch(f),{quickPick:G,selection:oe.promise}}async showInputBox({title:e,step:t,totalSteps:n,value:i,prompt:o,validate:s,password:a,buttons:c,shouldResume:l,validationMessage:u}){let p=[];try{return await new Promise((m,h)=>{let g=Mc.window.createInputBox();g.title=e,g.step=t,g.totalSteps=n,g.password=!!a,g.value=i||"",g.prompt=o,g.validationMessage=u||"",g.ignoreFocusOut=!0,g.validationMessage=u||"",g.buttons=[...this.steps.length>1?[Mc.QuickInputButtons.Back]:[],...c||[]],p.push(g.onDidTriggerButton(b=>{b===Mc.QuickInputButtons.Back?h(Ne.back):m(b)}),g.onDidAccept(async()=>{let b=g.value;g.enabled=!1,g.busy=!0;let w=await s(b);w?(g.validationMessage=w,g.show()):(g.validationMessage="",m(b)),g.enabled=!0,g.busy=!1}),g.onDidChangeValue(async()=>{g.validationMessage=""}),g.onDidHide(()=>{(async()=>{g.busy||h(l&&await l()?Ne.resume:Ne.cancel)})().catch(h)})),this.current&&this.current.dispose(),this.current=g,this.current.show()})}finally{p.forEach(m=>m.dispose())}}async stepThrough(e,t){let n=e;for(;n;){this.steps.push(n),this.current&&(this.current.enabled=!1,this.current.busy=!0);try{n=await n(this,t)}catch(i){if(i===Ne.back)this.steps.pop(),n=this.steps.pop();else if(i===Ne.resume)n=this.steps.pop();else if(i===Ne.cancel)n=void 0;else throw i;if(!n)return i}}this.current&&this.current.dispose()}},Og=Symbol("IMultiStepInputFactory"),Mg=class{create(){return new bx}};Mg=v([(0,zB.injectable)()],Mg);var QB=_(O()),YB=require("vscode");var Kg=class{activate(){YB.languages.getLanguages().then(e=>{e.map(t=>t.toLowerCase()).forEach(t=>{yS.includes(t)||yS.push(t)})},f)}};Kg=v([(0,QB.injectable)()],Kg);var Vl=_(Fc());function Rp(r){return qr()==="Windows"?In(r).toUpperCase():In(r)}function Ap(r,e){return Rp(r)===Rp(e)}function Wg(r,e){return e.endsWith(qn)||(e+=qn),r.endsWith(qn)||(r+=qn),Rp(r).startsWith(Rp(e))}var Xq=require("os"),fO;function Zq(r){fO=r}async function eJ(r,e={}){return(await fO.get(_i).create(void 0)).shellExec(r,e)}function Vg(r){return Vl.pathExists(r)}function hO(r){return Vl.pathExistsSync(r)}function tJ(r){return Vl.readFile(r,"utf-8")}function rJ(r){return Vl.readFileSync(r,"utf-8")}var Tk=r=>hh(r,(0,Xq.homedir)());function nJ(r){return fO.get(le).getSettings()[r]}var aJ=_(O()),_m=_(require("os")),cJ=_(qh()),vO=require("vscode");var gO=require("vscode"),oJ=_(require("os"));var iJ=oJ.homedir();function km(r){return process.env[r]}function Bg(){if(qr()==="Windows")return gO.Uri.file(km("USERPROFILE")||iJ);let r=km("HOME")||km("HOMEPATH")||iJ;return gO.Uri.file(r.replace(/\\/g,"/"))}var qg=_(qh());function sJ(r){r=r.replace(/\.00*(?=[1-9]|0\.)/,".");let e=qg.coerce(r);return e===null||!qg.valid(e)?new qg.SemVer("0.0.0"):e}var Lc=class{constructor(){this._homeDir=Bg()||vO.Uri.file(_m.homedir());this._tempDir=vO.Uri.file(_m.tmpdir());this.osType=qr();this.osType,"Unknown"}get homeDir(){return this._homeDir}get tempDir(){return this._tempDir}get pathVariableName(){return this.isWindows?$B:HB}async getVersion(){if(this.version)return this.version;switch(this.osType){case"Windows":case"OSX":try{let e=(0,cJ.coerce)(_m.release());if(e)return this.version=e;throw new Error("Unable to parse version")}catch{return sJ(_m.release())}default:throw new Error("Not Supported")}}get isWindows(){return this.osType==="Windows"}get isMac(){return this.osType==="OSX"}get isLinux(){return this.osType==="Linux"}};Lc=v([(0,aJ.injectable)()],Lc);function lJ(r){r.addSingleton(Er,Lc),Zq(r.get(ut))}var Mk=_(O()),dJ=require("vscode");var Dm=require("child_process"),Nk=require("vscode");var yO="utf8";var Rk=require("vscode"),uJ=require("os"),Ak=Rk.Uri.file((0,uJ.homedir)());function pJ(r,e){let t=e?[{uri:Rk.Uri.file(e),name:"",index:0}]:[];return W(r?Rk.Uri.file(r):void 0,t,Ak)}function un(r,e=[]){return W(r,e,Ak)}function bO(r,e,t){let n=e.reduce((o,s,a)=>{let c=CS(s);return(s.startsWith('"')&&s.endsWith('"')||s.startsWith("'")&&s.endsWith("'")&&(s.includes("/")||s.includes("\\")))&&(c=`${s[0]}${un(s.substr(1))}`),a===0?c:`${o} ${c}`},""),i=[`Process Execution: ${un(r)} ${n}`];t&&t.cwd&&i.push(`    > ${WA.currentWorkingDirectory} ${un(t.cwd.toString())}`),z(i.join(`
`))}var IO=class{decode(e){return Buffer.concat(e).toString(yO)}},Np=class Np{constructor(e){this.env=e;this.processesToKill=new Set;this.decoder=new IO}static isAlive(e){try{return e?(process.kill(e,0),!0):!1}catch{return!1}}static kill(e){try{if(!e)return;process.platform==="win32"?(0,Dm.execSync)(`taskkill /pid ${e} /T /F`):process.kill(e)}catch{}}dispose(){this.processesToKill.forEach(e=>{try{e.dispose()}catch{}})}execObservable(e,t,n={}){let i=this.getDefaultOptions(n),o=(0,Dm.spawn)(e,t,i),s=!1;ne(`Exec observable ${e}, ${t.join(" ")}`);let a=[],c={dispose:function(){o&&!o.killed&&!s&&Np.kill(o.pid),o&&o.unref(),Q(a)}};this.processesToKill.add(c);let l=Kde();a.push(l);let u=(m,h,g)=>{m.on(h,g),a.push({dispose:()=>m.removeListener(h,g)})};n.token&&a.push(n.token.onCancellationRequested(()=>{!s&&!o.killed&&(Np.kill(o.pid),s=!0)}));let p=(m,h)=>{let g=this.decoder.decode([h]);m==="stderr"&&n.throwOnStdErr?l.reject(new ox(g)):l.fire({source:m,out:g})};return u(o.stdout,"data",m=>p("stdout",m)),u(o.stderr,"data",m=>p("stderr",m)),o.once("close",()=>{s=!0,l.resolve(),a.forEach(m=>m.dispose())}),o.once("exit",()=>{s=!0,l.resolve(),a.forEach(m=>m.dispose())}),o.once("error",m=>{s=!0,l.reject(m),a.forEach(h=>h.dispose())}),bO(e,t,n),{proc:o,out:l,dispose:c.dispose}}exec(e,t,n={}){let i=this.getDefaultOptions(n),o=(0,Dm.spawn)(e,t,i),s=ue(),a={dispose:()=>{!o.killed&&!s.completed&&Np.kill(o.pid)}};this.processesToKill.add(a);let c=[],l=(m,h,g)=>{m.on(h,g),c.push({dispose:()=>m.removeListener(h,g)})};n.token&&c.push(n.token.onCancellationRequested(a.dispose));let u=[];l(o.stdout,"data",m=>u.push(m));let p=[];return l(o.stderr,"data",m=>{n.mergeStdOutErr&&u.push(m),p.push(m)}),o.once("close",()=>{if(s.completed)return;let m=p.length===0?void 0:this.decoder.decode(p);if(m&&m.length>0&&n.throwOnStdErr)s.reject(new ox(m));else{let h=this.decoder.decode(u);s.resolve({stdout:h,stderr:m})}c.forEach(h=>h.dispose())}),o.once("error",m=>{s.reject(m),c.forEach(h=>h.dispose())}),bO(e,t,n),s.promise}shellExec(e,t={}){let n=this.getDefaultOptions(t);return new Promise((i,o)=>{let s,a=(0,Dm.exec)(e,n,(l,u,p)=>{s?.dispose(),l&&l!==null?o(l):n.throwOnStdErr&&p&&p.length?o(new Error(p)):i({stderr:p&&p.length>0?p:void 0,stdout:u})});t.token&&(s=t.token.onCancellationRequested(()=>{a.exitCode===null&&!a.killed&&(o(new Nk.CancellationError),Np.kill(a.pid))}));let c={dispose:()=>{a.killed||Np.kill(a.pid)}};this.processesToKill.add(c)})}getDefaultOptions(e){let t={...e},n=t;if(n){let i=n.encoding=typeof n.encoding=="string"&&n.encoding.length>0?n.encoding:yO;delete n.encoding,n.encoding=i}if(!t.env||Object.keys(t.env).length===0){let i=this.env?this.env:process.env;t.env={...i}}else t.env={...t.env};return t.env.PYTHONUNBUFFERED="1",t.env.PYTHONIOENCODING||(t.env.PYTHONIOENCODING="utf-8"),t}};v([ti("Execing shell command",5),d(1,Qu())],Np.prototype,"shellExec",1);var Uc=Np;function Kde(){let r=new Nk.EventEmitter,e=ue();return e.promise.catch(f),{get onDidChange(){return r.event},get done(){return e.promise},resolve:e.resolve.bind(e),reject:e.reject.bind(e),fire:r.fire.bind(r),dispose:()=>{r.dispose()}}}var Tm=class{constructor(e){this.envVarsService=e}async create(e,t){if(!dJ.workspace.isTrusted)throw new Error("Workspace not trusted");let n=await this.envVarsService.getEnvironmentVariables(e,"RunNonPythonCode",t);return hP(new Uc(n))}};v([ti("Create ProcessService",5)],Tm.prototype,"create",1),Tm=v([(0,Mk.injectable)(),d(0,(0,Mk.inject)(kc))],Tm);function mJ(r){r.addSingleton(_i,Tm)}var hJ=_(require("os")),Kk=_(O());var Jg=_(require("vscode")),fJ;(c=>{let r=Jg.FileSystemError.FileNotFound().name,e=Jg.FileSystemError.FileExists().name,t=Jg.FileSystemError.FileIsADirectory().name,n=Jg.FileSystemError.FileNotADirectory().name,i=Jg.FileSystemError.NoPermissions().name,o=[r,e,t,n,i];function s(l,u){if(o.includes(l.name))return l.name===u}function a(l){return s(l,r)}c.isFileNotFound=a})(fJ||={});function Fde(r,e){let t=r.code;if(t)return t===e}function Ok(r){let e=fJ.isFileNotFound(r);return e!==void 0?e:Fde(r,"ENOENT")}var gJ=require("vscode");var $g=class{constructor(e){this.fs=e}async parseFile(e,t){if(e)try{return Lde(await this.fs.readFile(gJ.Uri.file(e)),t)}catch(n){Ok(n)||x(`Failed to parse env file ${e}`,n)}}mergeVariables(e,t){t&&Object.keys(e).forEach(n=>{let i=n.toLowerCase();if(i=="pythonpath"||i=="path")return;let o=Object.keys(t).find(s=>s.toLowerCase()===i)||n;t[o]=e[n]})}mergePaths(e,t){let n=Object.keys(e).find(o=>o.toLowerCase()==="path"),i=Object.keys(t).find(o=>o.toLowerCase()==="path")||n;n&&i&&(t[i]=e[n])}appendPythonPath(e,...t){return this.appendPaths(e,"PYTHONPATH",!0,...t)}appendPath(e,...t){return this.appendPaths(e,"PATH",!0,...t)}prependPath(e,...t){return this.appendPaths(e,"PATH",!1,...t)}appendPaths(e,t,n,...i){let o=i.filter(m=>typeof m=="string"&&m.trim().length>0).map(m=>m.trim()).join(Jn);if(o.length===0)return e;let s=t.toLowerCase(),a=e?Object.keys(e).find(m=>m.toLowerCase()==s):void 0,c=e&&a?e[a]:void 0,l=a||t;c&&typeof c=="string"&&c.length>0?n&&!(e[l]||"").endsWith(Jn+o)?e[l]=c+Jn+o:!n&&!(e[l]||"").startsWith(o+Jn)&&(e[l]=o+Jn+c):e[l]=o;let p=["Path","PATH"].find(m=>m!==l);if(hJ.platform()==="win32"&&p&&p in e&&typeof e[p]=="string"){let m=e[p],h=p;m&&typeof m=="string"&&m.length>0?n&&!(e[h]||"").endsWith(Jn+o)?e[h]=m+Jn+o:!n&&!(e[h]||"").startsWith(o+Jn)&&(e[h]=o+Jn+m):e[h]=o}return e}};$g=v([(0,Kk.injectable)(),d(0,(0,Kk.inject)(st))],$g);function Lde(r,e){let t=e||{},n={};return r.toString().split(`
`).forEach((i,o)=>{let[s,a]=Ude(i);s!==""&&(n[s]=Wde(a,n,t))}),n}function Ude(r){let e=r.match(/^\s*([a-zA-Z]\w*)\s*=\s*(.*?)?\s*$/);if(!e)return["",""];let t=e[1],n=e[2];return n&&n!==""?n[0]==="'"&&n[n.length-1]==="'"?(n=n.substring(1,n.length-1),n=n.replace(/\\n/gm,`
`)):n[0]==='"'&&n[n.length-1]==='"'&&(n=n.substring(1,n.length-1),n=n.replace(/\\n/gm,`
`)):n="",[t,n]}var jde=/\${([a-zA-Z]\w*)?([^}\w].*)?}/g;function Wde(r,e,t,n=""){let i=!1,o=r;return o=o.replace(jde,(s,a,c,l,u)=>l>0&&u[l-1]==="\\"?s:c&&c!==""||!a||a===""?(i=!0,s):e[a]||t[a]||n),!i&&o!==r&&(r=o,A("ENVFILE_VARIABLE_SUBSTITUTION")),r.replace(/\\\$/g,"$")}var jc=_(O());var vo=require("vscode");var ya=require("vscode");var SO={number:"number",string:"string",undefined:"undefined",object:"object",function:"function"};function xO(r){return Array.isArray?Array.isArray(r):!!(r&&typeof r.length===SO.number&&r.constructor===Array)}function Fk(r){return typeof r===SO.string||r instanceof String}function CO(r){return typeof r===SO.object&&r!==null&&!Array.isArray(r)&&!(r instanceof RegExp)&&!(r instanceof Date)}var Lk=class{resolve(e){return Fk(e)?this.__resolveString(e):xO(e)?this.__resolveArray(e):CO(e)?this.__resolveLiteral(e):e}resolveAny(e){return Fk(e)?this.__resolveString(e):xO(e)?this.__resolveAnyArray(e):CO(e)?this.__resolveAnyLiteral(e):e}__resolveString(e){let t=/\$\{(.*?)\}/g;return e.replace(t,(n,i)=>{let o=this[i];return Fk(o)?o:n&&(n.indexOf("env.")>0||n.indexOf("env:")>0)?"":n})}__resolveLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(n=>{let i=e[n];t[n]=this.resolve(i)}),t}__resolveAnyLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(n=>{let i=e[n];t[n]=this.resolveAny(i)}),t}__resolveArray(e){return e.map(t=>this.__resolveString(t))}__resolveAnyArray(e){return e.map(t=>this.resolveAny(t))}};var Hg=class extends Lk{constructor(t,n){super();let i=t?ya.workspace.getWorkspaceFolder(t):void 0;this._workspaceFolder=i?i.uri.fsPath:n?.fsPath||__dirname,this._workspaceFolderName=De(this._workspaceFolder),this._filePath=t?t.fsPath:void 0,ya.window&&ya.window.activeTextEditor&&(this._lineNumber=ya.window.activeTextEditor.selection.anchor.line+1,this._selectedText=ya.window.activeTextEditor.document.getText(new ya.Range(ya.window.activeTextEditor.selection.start,ya.window.activeTextEditor.selection.end))),this._execPath=process.execPath,Object.keys(process.env).forEach(o=>{this[`env:${o}`]=this[`env.${o}`]=process.env[o]})}get cwd(){return this.workspaceFolder}get workspaceRoot(){return this._workspaceFolder}get workspaceFolder(){return this._workspaceFolder}get workspaceRootFolderName(){return this._workspaceFolderName}get workspaceFolderBasename(){return this._workspaceFolderName}get file(){return this._filePath}get relativeFile(){return this.file?Ww(this._workspaceFolder,this.file):void 0}get relativeFileDirname(){return this.relativeFile?pt(this.relativeFile):void 0}get fileBasename(){return this.file?De(this.file):void 0}get fileBasenameNoExtension(){return this.file?jj(this.file).name:void 0}get fileDirname(){return this.file?pt(this.file):void 0}get fileExtname(){return this.file?Wi(this.file):void 0}get lineNumber(){return this._lineNumber}get selectedText(){return this._selectedText}get execPath(){return this._execPath}};var jk=require("vscode"),Px,Uk=!1;function vJ(){IJ()&&bJ()}async function yJ(r,e){if(IJ()){let n=new Hg(e,void 0).resolveAny(SJ());await r.exists(jk.Uri.file(n))&&bJ()}}function bJ(){A("ENVFILE_WORKSPACE"),Uk=!0}function IJ(){return!Uk}function SJ(){return Px||(Px=jk.workspace.getConfiguration("python").inspect("envFile")?.defaultValue||""),Px}var Bde;(t=>{function r({telemetrySent:n,defaultSetting:i}){n!==void 0&&(Uk=n),SJ!==void 0&&(Px=i)}t.setState=r;function e(){Px=void 0,Uk=!1}t.resetState=e})(Bde||={});var qde=60*1e3,Rm=class{constructor(e,t,n,i,o=qde){this.envVarsService=e;this.extensionChecker=n;this.pythonApi=i;this.cacheDuration=o;this.trackedWorkspaceFolders=new Set;this.fileWatchers=new Set;this.disposables=[];this.changeEventEmitter=new vo.EventEmitter;t.push(this)}get onDidEnvironmentVariablesChange(){return this.changeEventEmitter.event}dispose(){this.changeEventEmitter.dispose(),Q(this.disposables)}async getEnvironmentVariables(e,t,n){if(e=e||(vo.workspace.workspaceFolders?.length?vo.workspace.workspaceFolders[0].uri:void 0),t==="RunPythonCode")return this._getEnvironmentVariables(e,t,n);let i=new Xd(this.cacheDuration,this.getCacheKeyForMergedVars(e));if(i.hasData&&i.data)return E(`Cached data exists getEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),i.data;let o=this._getEnvironmentVariables(e,t,n);return o.then(s=>{n?.isCancellationRequested||(i.data=s)}).catch(f),o}async getCustomEnvironmentVariables(e,t,n){e=e||(vo.workspace.workspaceFolders?.length?vo.workspace.workspaceFolders[0].uri:void 0);let i=this.getWorkspaceFolderUri(e);if(!i){ne(`No workspace folder found for ${e?e.fsPath:"<No Resource>"}`);return}if(t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled){let c=await this.pythonApi.getNewApi();if(c&&!n?.isCancellationRequested)return this.pythonEnvVarChangeEventHooked||(this.pythonEnvVarChangeEventHooked=!0,c.environments.onDidEnvironmentVariablesChange(l=>{E(`Python env vars changed ${l.resource?.uri?.path}`),this.onEnvironmentFileChanged(l.resource?.uri),this.changeEventEmitter.fire(l.resource?.uri)},this,this.disposables)),c.environments.getEnvironmentVariables(i)}let o=new Xd(this.cacheDuration,this.getCacheKeyForCustomVars(e));if(o.hasData)return E(`Cached custom vars data exists getCustomEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),o.data;if(n?.isCancellationRequested)return;this.trackedWorkspaceFolders.add(i.fsPath||"");let s=this.getEnvFile(i);this.createFileWatcher(s,i);let a=this.envVarsService.parseFile(s,process.env);return a.then(c=>{n?.isCancellationRequested||(o.data=c)}).catch(f),a}createFileWatcher(e,t){let n=this.getCacheKeyForMergedVars(t);if(this.fileWatchers.has(n))return;let i=new vo.RelativePattern(vo.Uri.file(pt(e)),De(e)),o=vo.workspace.createFileSystemWatcher(i,!1,!1,!1);o?(this.disposables.push(o),this.fileWatchers.add(n),o.onDidChange(()=>this.onEnvironmentFileChanged(t),this,this.disposables),o.onDidCreate(()=>this.onEnvironmentFileCreated(t),this,this.disposables),o.onDidDelete(()=>this.onEnvironmentFileChanged(t),this,this.disposables)):x("Failed to create file watcher for environment file")}getEnvFile(e){return Ve(e.fsPath,".env")}async _getEnvironmentVariables(e,t,n){let i=await this.getCustomEnvironmentVariables(e,t,n);if(n?.isCancellationRequested)return{};if(i&&t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled)return i;i||(i={});let o={};this.envVarsService.mergeVariables(process.env,o),this.envVarsService.mergeVariables(i,o),this.envVarsService.mergePaths(process.env,o),process.env.PYTHONPATH&&(o.PYTHONPATH=process.env.PYTHONPATH);let s=i?Object.keys(i).find(a=>a.toLowerCase()=="path"):void 0;return s&&i[s]&&this.envVarsService.appendPath(o,i[s]),i.PYTHONPATH&&this.envVarsService.appendPythonPath(o,i.PYTHONPATH),o}getWorkspaceFolderUri(e){let t=vo.workspace.workspaceFolders||[],n=t.length===1?t[0].uri:void 0;return e&&vo.workspace.getWorkspaceFolder(e)?.uri||n}onEnvironmentFileCreated(e){this.onEnvironmentFileChanged(e),vJ()}onEnvironmentFileChanged(e){new Xd(this.cacheDuration,this.getCacheKeyForMergedVars(e)).clear(),new Xd(this.cacheDuration,this.getCacheKeyForCustomVars(e)).clear(),this.changeEventEmitter.fire(e)}getCacheKeyForMergedVars(e){return`${bs(e)}:RunNonPythonCode`}getCacheKeyForCustomVars(e){return`${bs(e)}:RunNonPythonCode:CustomVars`}};v([ti("Get Custom Env Variables",5)],Rm.prototype,"getEnvironmentVariables",1),Rm=v([(0,jc.injectable)(),d(0,(0,jc.inject)(Pc)),d(1,(0,jc.inject)(F)),d(2,(0,jc.inject)(ze)),d(3,(0,jc.inject)(Gt)),d(4,(0,jc.inject)("number")),d(4,(0,jc.optional)())],Rm);function xJ(r){r.addSingleton(Pc,$g),r.addSingleton(kc,Rm)}var CJ=_(O()),Mp=require("vscode");var wO=require("vscode");var Gg=class{activate(){Mp.commands.registerCommand("jupyter.runInDedicatedExtensionHost",this.updateAffinity,this)}async updateAffinity(){let e=wO.workspace.getConfiguration("extensions").get("experimental.affinity"),t=0;e&&Object.values(e).forEach(o=>{t=Math.max(t,o)});let n=t+1,i={"ms-toolsai.jupyter":n,"ms-toolsai.jupyter-renderers":n};Mp.extensions.getExtension(ei)&&(i[ei]=n),Mp.extensions.getExtension(Qd)&&(i[Qd]=n),await wO.workspace.getConfiguration("extensions").update("experimental.affinity",{...e??{},...i},Mp.ConfigurationTarget.Global),Mp.commands.executeCommand("workbench.action.reloadWindow").then(f,f)}};Gg=v([(0,CJ.injectable)()],Gg);var kx=require("vscode");var Wc=_(O());var wJ=["currentServerHash","connectToLocalKernelsOnly","JUPYTER_LOCAL_KERNELSPECS","JUPYTER_LOCAL_KERNELSPECS_V1","JUPYTER_LOCAL_KERNELSPECS_V2","JUPYTER_LOCAL_KERNELSPECS_V3","JUPYTER_REMOTE_KERNELSPECS","JUPYTER_REMOTE_KERNELSPECS_V1","JUPYTER_REMOTE_KERNELSPECS_V2","JUPYTER_REMOTE_KERNELSPECS_V3","JUPYTER_LOCAL_KERNELSPECS_V4","JUPYTER_REMOTE_KERNELSPECS_V4-","LOCAL_KERNEL_SPECS_CACHE_KEY_V_2022_10","LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2022_10","user-jupyter-server-uri-list-v2","REGISTRATION_ID_EXTENSION_OWNER_MEMENTO_KEY","jupyter.jupyterServer.uriList"],zg=class{constructor(e,t,n,i){this.globalState=e;this.crypto=t;this.workspaceState=n;this.extensionContext=i}activate(){this.removeOldCachedItems().then(f,f)}async removeOldCachedItems(){await Promise.all([await this.getUriAccountKey()].concat(wJ).filter(t=>this.globalState.get(t,void 0)!==void 0).map(t=>this.globalState.update(t,void 0).then(f,f)));let e=this.workspaceState.keys().filter(t=>t.startsWith("LAST_EXECUTED_CELL_")&&!t.startsWith("LAST_EXECUTED_CELL_V2_"));await Promise.all(e.map(t=>this.workspaceState.update(t,void 0))),await Promise.all(wJ.map(t=>this.globalState.keys().filter(n=>n.startsWith(t)).map(n=>this.globalState.update(n,void 0).then(f,f))).flat()),await this.extensionContext.secrets.delete(`${Li.JupyterServerRemoteLaunchService}.remote-uri-list`).then(f,f)}async getUriAccountKey(){let e=Is();return e?this.crypto.createHash(Pe(e),"SHA-512"):kx.workspace.workspaceFile?this.crypto.createHash(Pe(kx.workspace.workspaceFile),"SHA-512"):kx.env.machineId}};zg=v([(0,Wc.injectable)(),d(0,(0,Wc.inject)($e)),d(0,(0,Wc.named)(St)),d(1,(0,Wc.inject)(bh)),d(2,(0,Wc.inject)($e)),d(2,(0,Wc.named)(ri)),d(3,(0,Wc.inject)(lt))],zg);function EJ(r){r.addSingletonInstance(i2,GB),r.addSingleton(oa,vg),r.addSingleton(Ga,Ng),r.addSingleton(Di,Ul),r.addSingleton(Rc,Dg),r.addSingleton(ax,gg),r.addSingleton(bh,Ah),r.addSingleton(za,Tg),r.addSingleton(Jw,Ag),r.addSingleton(ni,yg),r.addSingleton(Og,Mg),r.addSingleton(be,Kg),r.addSingleton(be,zg),r.addSingleton(be,hg),r.addSingleton(be,Gg),lJ(r),mJ(r),xJ(r)}var Vk=_(O());var $o=Ve(__dirname,"..");var EO=Ve($o,"pythonFiles"),Jde=EO;function PJ(){let e=[Ve(Jde,"normalizeSelection.py")];function t(n){return n}return[e,t]}var Ri=require("vscode");var Wk=class{async normalizeLines(e,t){return e}async getFileToExecute(){let e=Ri.window.activeTextEditor;if(!e){Ri.window.showErrorMessage("No open file to run in terminal").then(f,f);return}if(e.document.isUntitled){Ri.window.showErrorMessage("The active file needs to be saved before it can be run").then(f,f);return}if(e.document.languageId!==xe){Ri.window.showErrorMessage("The active file is not a Python source file").then(f,f);return}return e.document.isDirty&&await e.document.save(),e.document.uri}getSelectedTextToExecute(e){if(!e)return;let t=e.selection,n;return t.isEmpty?n=e.document.lineAt(t.start.line).text:t.isSingleLine?n=this.getSingleLineSelectionText(e):n=this.getMultiLineSelectionText(e),mh(n.trimEnd())}async saveFileIfDirty(e){let t=Ri.workspace.textDocuments.filter(n=>n.uri.path===e.path);t.length===1&&t[0].isDirty&&await t[0].save()}getSingleLineSelectionText(e){let t=e.selection,n=new Ri.Range(t.start,t.end),i=e.document.getText(n),o=e.document.lineAt(t.start.line).text;return i.trim()===o.trim()?o:i}getMultiLineSelectionText(e){let t=e.selection,n=new Ri.Range(t.start,t.end),i=e.document.getText(n),o=new Ri.Range(new Ri.Position(t.start.line,0),new Ri.Position(t.end.line,e.document.lineAt(t.end.line).text.length)),s=e.document.getText(o);if(i.trim()===s.trim())return s;let a=e.document.lineAt(t.start.line).text,c=new Ri.Range(t.start,new Ri.Position(t.start.line,a.length)),l=e.document.getText(c);return l.trimStart()===a.trimStart()?a+i.substring(l.length):i}};var Qg=class extends Wk{constructor(t){super();this.processServiceFactory=t.get(_i),this.interpreterService=t.get(tt)}async normalizeLines(t,n){let i=[];try{let o=t.trim();if(o.length===0)return"";if(t=t.replace(new RegExp("\\r","g"),""),o.indexOf(`
`)===-1)return o+`
`;let s=await this.interpreterService.getActiveInterpreter(n),a=await this.processServiceFactory.create(n),[c,l]=PJ(),u=a.execObservable(Pe(s?.uri)||"python",c,{throwOnStdErr:!0}),p="";u.out.onDidChange(N=>{N.source==="stdout"&&(p+=N.out)},this,i);let m=JSON.stringify({code:t});u.proc?.stdin?.write(m),u.proc?.stdin?.end(),await u.out.done;let g=JSON.parse(p),b=l(g.normalized),w=Fe(t,{trim:!0,removeEmptyEntries:!1}).findIndex(N=>N.length),k=Fe(b,{trim:!0,removeEmptyEntries:!1}).findIndex(N=>N.length);if(w>k){let N=w-k;return`${`
`.repeat(N)}${b}`}return b}catch(o){return x(o,"Python: Failed to normalize code for execution in Interactive Window"),t}finally{Q(i)}}};Qg=v([(0,Vk.injectable)(),d(0,(0,Vk.inject)(ut))],Qg);var Bk=Symbol("ICodeExecutionHelper");function kJ(r){r.addSingleton(Bk,Qg)}var Op=_(O()),DJ=_(qh()),_x=require("vscode");var _J="CONDA_INFORMATION_CACHE";function PO(r){return r&&fh(r.fsPath)&&r.fsPath.startsWith(qn)&&`${qn}${De(r.fsPath)}`===r.fsPath?De(r.fsPath):r?.fsPath}var Rs=class{constructor(e,t,n){this.pythonApi=e;this.globalState=t;this.fs=n}async getCondaVersion(){if(this._version)return this._version;if(this._previousVersionCall)return this._previousVersionCall;let e=async()=>{let t=this.getCondaVersionFromPython();t.then(i=>{this._version=i,this.updateCache().catch(f)}).catch(f);let n=ds(this.getCachedInformation());return await Promise.race([n.promise,t]),n.completed&&n.value?.version?this._version=n.value.version:t};return this._previousVersionCall=e(),this._previousVersionCall}async getCondaFile(){if(this._file)return PO(this._file);if(this._previousFileCall)return this._previousFileCall.then(PO);let e=async()=>{let t=this.pythonApi.getApi().then(i=>i.getCondaFile?i.getCondaFile():void 0);t.then(i=>{E(`Conda file returned by Python Extension is ${i}`),this._file=i?_x.Uri.file(i):void 0,this.updateCache().catch(f)}).catch(f);let n=ds(this.getCachedInformation());return await Promise.race([n.promise,t]),n.completed&&n.value?.file?this._file=n.value.file:t.then(i=>i?_x.Uri.file(i):void 0)};return this._previousFileCall=e(),this._previousFileCall.then(PO)}async isCondaAvailable(){return typeof this.isAvailable=="boolean"?this.isAvailable:this.getCondaVersion().then(e=>this.isAvailable=e!==void 0).catch(()=>this.isAvailable=!1)}async updateCache(){if(!this._file||!this._version)return;let e=this._file.fsPath.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(this._file);await this.globalState.update(_J,{version:this._version.raw,file:this._file.fsPath,fileHash:e})}async getCachedInformation(){let e=this.globalState.get(_J,void 0);if(!e)return;let t=e.file.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(_x.Uri.file(e.file));if(e.fileHash===t)return{version:new DJ.SemVer(e.version),file:_x.Uri.file(e.file)}}async getCondaVersionFromPython(){return this.pythonApi.getApi().then(e=>e.getCondaVersion?e.getCondaVersion():void 0)}};Rs=v([(0,Op.injectable)(),d(0,(0,Op.inject)(Gt)),d(1,(0,Op.inject)($e)),d(1,(0,Op.named)(St)),d(2,(0,Op.inject)(st))],Rs);var Dx=_(O());var RJ=_(qk());var TJ="_VSCODE_getDataFrame",Jk=RJ.default`
                            try:
                                del _VSCODE_getDataFrame
                            except:
                                pass
                            `,Vc=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetDataFrameInfo(e){let t=await this.getContentsOfDataFrameScript(),n=e.isDebugging?"True":"False",i=`${TJ}("info", ${n}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:Jk}:{code:`${t}

${i}

${Jk}`}}async generateCodeToGetDataFrameRows(e){let t=await this.getContentsOfDataFrameScript(),n=e.isDebugging?"True":"False",i=`${TJ}("rows", ${n}, ${e.variableName}, ${e.startIndex}, ${e.endIndex})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:Jk}:{code:`${t}

${i}

${Jk}`}}async getContentsOfDataFrameScript(){if(Vc.contentsOfDataFrameScript)return Vc.contentsOfDataFrameScript;let e=sr(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","dataframes","vscodeDataFrame.py"),t=await this.fs.readFile(e);return Vc.contentsOfDataFrameScript=t,t}};Vc=v([(0,Dx.injectable)(),d(0,(0,Dx.inject)(st)),d(1,(0,Dx.inject)(lt))],Vc);var Xg=_(O());function $k(r,e){e===void 0&&(e=!1);var t=r.length,n=0,i="",o=0,s=16,a=0,c=0,l=0,u=0,p=0;function m(D,V){for(var oe=0,G=0;oe<D||!V;){var pe=r.charCodeAt(n);if(pe>=48&&pe<=57)G=G*16+pe-48;else if(pe>=65&&pe<=70)G=G*16+pe-65+10;else if(pe>=97&&pe<=102)G=G*16+pe-97+10;else break;n++,oe++}return oe<D&&(G=-1),G}function h(D){n=D,i="",o=0,s=16,p=0}function g(){var D=n;if(r.charCodeAt(n)===48)n++;else for(n++;n<r.length&&Yg(r.charCodeAt(n));)n++;if(n<r.length&&r.charCodeAt(n)===46)if(n++,n<r.length&&Yg(r.charCodeAt(n)))for(n++;n<r.length&&Yg(r.charCodeAt(n));)n++;else return p=3,r.substring(D,n);var V=n;if(n<r.length&&(r.charCodeAt(n)===69||r.charCodeAt(n)===101))if(n++,(n<r.length&&r.charCodeAt(n)===43||r.charCodeAt(n)===45)&&n++,n<r.length&&Yg(r.charCodeAt(n))){for(n++;n<r.length&&Yg(r.charCodeAt(n));)n++;V=n}else p=3;return r.substring(D,V)}function b(){for(var D="",V=n;;){if(n>=t){D+=r.substring(V,n),p=2;break}var oe=r.charCodeAt(n);if(oe===34){D+=r.substring(V,n),n++;break}if(oe===92){if(D+=r.substring(V,n),n++,n>=t){p=2;break}var G=r.charCodeAt(n++);switch(G){case 34:D+='"';break;case 92:D+="\\";break;case 47:D+="/";break;case 98:D+="\b";break;case 102:D+="\f";break;case 110:D+=`
`;break;case 114:D+="\r";break;case 116:D+="	";break;case 117:var pe=m(4,!0);pe>=0?D+=String.fromCharCode(pe):p=4;break;default:p=5}V=n;continue}if(oe>=0&&oe<=31)if(Tx(oe)){D+=r.substring(V,n),p=2;break}else p=6;n++}return D}function w(){if(i="",p=0,o=n,c=a,u=l,n>=t)return o=t,s=17;var D=r.charCodeAt(n);if(_O(D)){do n++,i+=String.fromCharCode(D),D=r.charCodeAt(n);while(_O(D));return s=15}if(Tx(D))return n++,i+=String.fromCharCode(D),D===13&&r.charCodeAt(n)===10&&(n++,i+=`
`),a++,l=n,s=14;switch(D){case 123:return n++,s=1;case 125:return n++,s=2;case 91:return n++,s=3;case 93:return n++,s=4;case 58:return n++,s=6;case 44:return n++,s=5;case 34:return n++,i=b(),s=10;case 47:var V=n-1;if(r.charCodeAt(n+1)===47){for(n+=2;n<t&&!Tx(r.charCodeAt(n));)n++;return i=r.substring(V,n),s=12}if(r.charCodeAt(n+1)===42){n+=2;for(var oe=t-1,G=!1;n<oe;){var pe=r.charCodeAt(n);if(pe===42&&r.charCodeAt(n+1)===47){n+=2,G=!0;break}n++,Tx(pe)&&(pe===13&&r.charCodeAt(n)===10&&n++,a++,l=n)}return G||(n++,p=1),i=r.substring(V,n),s=13}return i+=String.fromCharCode(D),n++,s=16;case 45:if(i+=String.fromCharCode(D),n++,n===t||!Yg(r.charCodeAt(n)))return s=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=g(),s=11;default:for(;n<t&&k(D);)n++,D=r.charCodeAt(n);if(o!==n){switch(i=r.substring(o,n),i){case"true":return s=8;case"false":return s=9;case"null":return s=7}return s=16}return i+=String.fromCharCode(D),n++,s=16}}function k(D){if(_O(D)||Tx(D))return!1;switch(D){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function N(){var D;do D=w();while(D>=12&&D<=15);return D}return{setPosition:h,getPosition:function(){return n},scan:e?N:w,getToken:function(){return s},getTokenValue:function(){return i},getTokenOffset:function(){return o},getTokenLength:function(){return n-o},getTokenStartLine:function(){return c},getTokenStartCharacter:function(){return o-u},getTokenError:function(){return p}}}function _O(r){return r===32||r===9||r===11||r===12||r===160||r===5760||r>=8192&&r<=8203||r===8239||r===8287||r===12288||r===65279}function Tx(r){return r===10||r===13||r===8232||r===8233}function Yg(r){return r>=48&&r<=57}var Hk;(function(r){r.DEFAULT={allowTrailingComma:!1}})(Hk||(Hk={}));function AJ(r,e){var t=[],n=new Object,i=void 0,o={value:{},offset:0,length:0,type:"object",parent:void 0},s=!1;function a(c,l,u,p){o.value=c,o.offset=l,o.length=u,o.type=p,o.colonOffset=void 0,i=o}try{RO(r,{onObjectBegin:function(c,l){if(e<=c)throw n;i=void 0,s=e>c,t.push("")},onObjectProperty:function(c,l,u){if(e<l||(a(c,l,u,"property"),t[t.length-1]=c,e<=l+u))throw n},onObjectEnd:function(c,l){if(e<=c)throw n;i=void 0,t.pop()},onArrayBegin:function(c,l){if(e<=c)throw n;i=void 0,t.push(0)},onArrayEnd:function(c,l){if(e<=c)throw n;i=void 0,t.pop()},onLiteralValue:function(c,l,u){if(e<l||(a(c,l,u,NJ(c)),e<=l+u))throw n},onSeparator:function(c,l,u){if(e<=l)throw n;if(c===":"&&i&&i.type==="property")i.colonOffset=l,s=!1,i=void 0;else if(c===","){var p=t[t.length-1];typeof p=="number"?t[t.length-1]=p+1:(s=!0,t[t.length-1]=""),i=void 0}}})}catch(c){if(c!==n)throw c}return{path:t,previousNode:i,isAtPropertyKey:s,matches:function(c){for(var l=0,u=0;l<c.length&&u<t.length;u++)if(c[l]===t[u]||c[l]==="*")l++;else if(c[l]!=="**")return!1;return l===c.length}}}function DO(r,e,t){e===void 0&&(e=[]),t===void 0&&(t=Hk.DEFAULT);var n={type:"array",offset:-1,length:-1,children:[],parent:void 0};function i(c){n.type==="property"&&(n.length=c-n.offset,n=n.parent)}function o(c){return n.children.push(c),c}var s={onObjectBegin:function(c){n=o({type:"object",offset:c,length:-1,parent:n,children:[]})},onObjectProperty:function(c,l,u){n=o({type:"property",offset:l,length:-1,parent:n,children:[]}),n.children.push({type:"string",value:c,offset:l,length:u,parent:n})},onObjectEnd:function(c,l){i(c+l),n.length=c+l-n.offset,n=n.parent,i(c+l)},onArrayBegin:function(c,l){n=o({type:"array",offset:c,length:-1,parent:n,children:[]})},onArrayEnd:function(c,l){n.length=c+l-n.offset,n=n.parent,i(c+l)},onLiteralValue:function(c,l,u){o({type:NJ(c),offset:l,length:u,parent:n,value:c}),i(l+u)},onSeparator:function(c,l,u){n.type==="property"&&(c===":"?n.colonOffset=l:c===","&&i(l))},onError:function(c,l,u){e.push({error:c,offset:l,length:u})}};RO(r,s,t);var a=n.children[0];return a&&delete a.parent,a}function TO(r,e){if(r){for(var t=r,n=0,i=e;n<i.length;n++){var o=i[n];if(typeof o=="string"){if(t.type!=="object"||!Array.isArray(t.children))return;for(var s=!1,a=0,c=t.children;a<c.length;a++){var l=c[a];if(Array.isArray(l.children)&&l.children[0].value===o){t=l.children[1],s=!0;break}}if(!s)return}else{var u=o;if(t.type!=="array"||u<0||!Array.isArray(t.children)||u>=t.children.length)return;t=t.children[u]}}return t}}function Gk(r){switch(r.type){case"array":return r.children.map(Gk);case"object":for(var e=Object.create(null),t=0,n=r.children;t<n.length;t++){var i=n[t],o=i.children[1];o&&(e[i.children[0].value]=Gk(o))}return e;case"null":case"string":case"number":case"boolean":return r.value;default:return}}function RO(r,e,t){t===void 0&&(t=Hk.DEFAULT);var n=$k(r,!1);function i(te){return te?function(){return te(n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter())}:function(){return!0}}function o(te){return te?function(we){return te(we,n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter())}:function(){return!0}}var s=i(e.onObjectBegin),a=o(e.onObjectProperty),c=i(e.onObjectEnd),l=i(e.onArrayBegin),u=i(e.onArrayEnd),p=o(e.onLiteralValue),m=o(e.onSeparator),h=i(e.onComment),g=o(e.onError),b=t&&t.disallowComments,w=t&&t.allowTrailingComma;function k(){for(;;){var te=n.scan();switch(n.getTokenError()){case 4:N(14);break;case 5:N(15);break;case 3:N(13);break;case 1:b||N(11);break;case 2:N(12);break;case 6:N(16);break}switch(te){case 12:case 13:b?N(10):h();break;case 16:N(1);break;case 15:case 14:break;default:return te}}}function N(te,we,Ue){if(we===void 0&&(we=[]),Ue===void 0&&(Ue=[]),g(te),we.length+Ue.length>0)for(var ct=n.getToken();ct!==17;){if(we.indexOf(ct)!==-1){k();break}else if(Ue.indexOf(ct)!==-1)break;ct=k()}}function D(te){var we=n.getTokenValue();return te?p(we):a(we),k(),!0}function V(){switch(n.getToken()){case 11:var te=n.getTokenValue(),we=Number(te);isNaN(we)&&(N(2),we=0),p(we);break;case 7:p(null);break;case 8:p(!0);break;case 9:p(!1);break;default:return!1}return k(),!0}function oe(){return n.getToken()!==10?(N(3,[],[2,5]),!1):(D(!1),n.getToken()===6?(m(":"),k(),de()||N(4,[],[2,5])):N(5,[],[2,5]),!0)}function G(){s(),k();for(var te=!1;n.getToken()!==2&&n.getToken()!==17;){if(n.getToken()===5){if(te||N(4,[],[]),m(","),k(),n.getToken()===2&&w)break}else te&&N(6,[],[]);oe()||N(4,[],[2,5]),te=!0}return c(),n.getToken()!==2?N(7,[2],[]):k(),!0}function pe(){l(),k();for(var te=!1;n.getToken()!==4&&n.getToken()!==17;){if(n.getToken()===5){if(te||N(4,[],[]),m(","),k(),n.getToken()===4&&w)break}else te&&N(6,[],[]);de()||N(4,[],[4,5]),te=!0}return u(),n.getToken()!==4?N(8,[4],[]):k(),!0}function de(){switch(n.getToken()){case 3:return pe();case 1:return G();case 10:return D(!0);default:return V()}}return k(),n.getToken()===17?t.allowEmptyContent?!0:(N(4,[],[]),!1):de()?(n.getToken()!==17&&N(9,[],[]),!0):(N(4,[],[]),!1)}function NJ(r){switch(typeof r){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":{if(r){if(Array.isArray(r))return"array"}else return"null";return"object"}default:return"null"}}var AO=AJ;var MJ=DO,OJ=TO;var KJ=Gk;var MO=require("vscode");var zk=_(O()),Bl=require("vscode");var si=class{constructor(e){this.disposables=[];this._onDidChange=new Bl.EventEmitter;e.push(this),Br()||Bl.workspace.onDidChangeConfiguration(t=>{t.affectsConfiguration("jupyter.kernels.excludePythonEnvironments")&&this._onDidChange.fire()},this,this.disposables)}get onDidChange(){return this._onDidChange.event}dispose(){this._onDidChange.dispose(),Q(this.disposables)}isPythonEnvironmentExcluded(e){if(Br())return!1;let t=this.getExcludedPythonEnvironments(),n=NO(e,t),i="uri"in e?e.uri:e.executable.uri;return n&&(A("DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER"),E(`Python Env hidden via filter: ${W(i)}`)),n}getExcludedPythonEnvironments(){if(!Bl.workspace.workspaceFolders||Bl.workspace.workspaceFolders.length===0)return Bl.workspace.getConfiguration("jupyter",void 0).get("kernels.excludePythonEnvironments",[]);let e=[];return Bl.workspace.workspaceFolders.forEach(t=>{e.push(...Bl.workspace.getConfiguration("jupyter",t.uri).get("kernels.excludePythonEnvironments",[]))}),e}};si=v([(0,zk.injectable)(),d(0,(0,zk.inject)(F))],si);function NO(r,e){let t="uri"in r?r.envPath:r.environment?.folderUri,n="uri"in r?r.uri:r.executable.uri;return!n&&!t?!1:e.some(o=>{let s=W(o.trim()).toLowerCase().replace(/\\/g,"/");if(o=o.trim().toLowerCase().replace(/\\/g,"/"),o.length===0||s.length===0)return!1;let a=W(n).toLowerCase().replace(/\\/g,"/"),c=n?n.fsPath.toLowerCase().replace(/\\/g,"/"):"";if(o===a||s===a||o===c||s===c)return!0;let l=W(t||"").toLowerCase().replace(/\\/g,"/"),u=W(t||"").toLowerCase().replace(/\\/g,"/");return o===l||s===l||o===u||s===u})}var Kp=class{constructor(e,t,n){this.disposableRegistry=e;this.interpreters=t;this.pythonExtChecker=n;this.supportedWorkspaceTypes={untrustedWorkspace:!1,virtualWorkspace:!1}}async activate(){this.disposableRegistry.push(MO.languages.registerCompletionItemProvider({language:"json"},this,",","[")),this.disposableRegistry.push(MO.languages.registerCompletionItemProvider({language:"jsonc"},this,",","["))}async provideCompletionItems(e,t,n){if(!this.pythonExtChecker.isPythonExtensionInstalled||!this.pythonExtChecker.isPythonExtensionActive||this.interpreters.resolvedEnvironments.length===0||!Kp.canProvideCompletions(e,t))return[];let i=this.getCurrentItemsInList(e,t);return this.interpreters.resolvedEnvironments.filter(o=>!NO(o,i)).map(o=>{let s=np(o),a=W(o.uri);return{label:s,detail:a,insertText:`"${a.replace(/\\/g,"\\\\")}"`,filterText:`${s} ${a}`}})}static canProvideCompletions(e,t){if(De(e.uri.fsPath)!=="settings.json")return!1;let n=AO(e.getText(),e.offsetAt(t));return n.path[0]==="jupyter.kernels.excludePythonEnvironments"&&n.path.length===2}getCurrentItemsInList(e,t){try{let n=e.getText(),i=AO(n,e.offsetAt(t)),o=MJ(n),s=OJ(o,[i.path[0]]);if(!s)return[];let a=KJ(s);return Array.isArray(a)?a:[]}catch(n){return j("Failed to provide completions for python env filter",n),[]}}};Kp=v([(0,Xg.injectable)(),d(0,(0,Xg.inject)(F)),d(1,(0,Xg.inject)(tt)),d(2,(0,Xg.inject)(ze))],Kp);var FJ=_(O()),Ai=require("vscode");var Zg=class{activate(){this.migrateFilters().catch(f)}async migrateFilters(){let e=Array.isArray(Ai.workspace.workspaceFolders)?Ai.workspace.workspaceFolders:[];await this.migrateWorkspaceFilters(Ai.workspace.getConfiguration("jupyter",void 0),Ai.ConfigurationTarget.Global),e.length===0?await this.migrateWorkspaceFilters(Ai.workspace.getConfiguration("jupyter",void 0),Ai.ConfigurationTarget.Global):e.length===1?await this.migrateWorkspaceFilters(Ai.workspace.getConfiguration("jupyter",e[0].uri),Ai.ConfigurationTarget.WorkspaceFolder):(await this.migrateWorkspaceFilters(Ai.workspace.getConfiguration("jupyter",void 0),Ai.ConfigurationTarget.Workspace),await Promise.all(e.map(t=>this.migrateWorkspaceFilters(Ai.workspace.getConfiguration("jupyter",t.uri),Ai.ConfigurationTarget.WorkspaceFolder))))}async migrateWorkspaceFilters(e,t){let n=e.inspect("kernels.filter"),i=[];switch(t){case Ai.ConfigurationTarget.Global:i=n?.globalValue||[];break;case Ai.ConfigurationTarget.Workspace:i=n?.workspaceValue||[];break;default:i=n?.workspaceFolderValue||[]}let o=i.filter(s=>s.type==="pythonEnvironment").map(s=>s.path);i.length&&await e.update("kernels.filter",void 0,t),o.length&&await e.update("kernels.excludePythonEnvironments",Array.from(new Set(o)),t)}};Zg=v([(0,FJ.injectable)()],Zg);var Qk=_(O());var OO=require("vscode");var ev=class{constructor(e){this.disposables=e}activate(){this.disposables.push(OO.commands.registerCommand("jupyter.filterKernels",()=>OO.commands.executeCommand("workbench.action.openSettings","jupyter.kernels.excludePythonEnvironments").then(f,f),this))}};ev=v([(0,Qk.injectable)(),d(0,(0,Qk.inject)(F))],ev);var Xk=_(O());var Am=Symbol("IModuleInstaller"),xOe=Symbol("IPythonInstallation"),Yk=Symbol("IInstallationChannelManager"),Rx=Symbol("IProductService"),Ax=Symbol("IProductPathService");var Ni=Symbol("IInstaller");var rv=require("vscode");var tv=class{constructor(e){this.serviceContainer=e}async getInstallationChannel(e,t){let n=await this.getInstallationChannels(t);if(n.length>=1)return n[0];if(n.length===0){await this.showNoInstallersMessage(t);return}}async getInstallationChannels(e){let t=this.serviceContainer.getAll(Am),n=[];if(t.length===0)return[];t.sort((o,s)=>s.priority-o.priority);let i=t[0].priority;for(let o of t){if(o.priority!==i){if(n.length>0)break;i=o.priority}await o.isSupported(e)&&n.push(o)}return n}async showNoInstallersMessage(e){if(await rv.window.showErrorMessage(e.envType==="Conda"?Rh.noCondaOrPipInstaller:Rh.noPipInstaller,{modal:!0},Rh.searchForHelp)===Rh.searchForHelp){let n=this.serviceContainer.get(Er),i=n.isWindows?"Windows":n.isMac?"MacOS":"Linux";rv.env.openExternal(rv.Uri.parse(`https://www.bing.com/search?q=Install Pip ${i} ${e.envType==="Conda"?"Conda":""}`))}}};tv=v([(0,Xk.injectable)(),d(0,(0,Xk.inject)(ut))],tv);var t_=_(O());var Zk=require("vscode");function Yi(r){switch(r){case 18:return"jupyter";case 20:return"notebook";case 23:return"pandas";case 19:return"ipykernel";case 22:return"nbconvert";case 21:return"kernelspec";case 27:return"pip";case 28:return"ensurepip";default:throw new Error(`Product ${r} cannot be installed as a Python Module.`)}}var LJ=require("os");var nv=class extends Ye{constructor(t,n,i){super("windowsLongPathNotEnabled",i);this.product=t;this.interpreter=n;this.originalMessage=i}};var Kr=Symbol("IPythonExecutionFactory"),LOe=Symbol("IPythonExecutionService");var Bc=class{constructor(e){this.serviceContainer=e}async installModule(e,t,n,i){let o=typeof e=="string"?e:Yi(e),s=await this.getExecutionArgs(o,t,i),a=this.serviceContainer.get(Kr),c=this.serviceContainer.get(_i),l=this.serviceContainer.get(Ps),u=this.serviceContainer.get(Pc);if(n.token.isCancellationRequested)return;let p=async(h,g)=>{let b=ue(),w=[];g.onCancellationRequested(()=>{n.cancel(),b.resolve()},this,w);let k;if(s.useShellExec){let G=await c.create(void 0);if(n.token.isCancellationRequested)return;try{let pe=await G.shellExec(s.args.join(" "),{cwd:s.cwd});E(pe.stdout),b.resolve()}catch(pe){b.reject(pe)}}else if(s.exe){let G=await l.getActivatedEnvironmentVariables(void 0,t);if(n.token.isCancellationRequested)return;let pe={...process.env};u.mergeVariables(G||{},pe),u.mergePaths(G||{},pe);let de=await c.create(void 0);if(n.token.isCancellationRequested)return;k=de.execObservable(s.exe,s.args,{encoding:"utf-8",token:g,env:pe,cwd:s.cwd})}else{let G=await a.createActivatedEnvironment({interpreter:t});if(n.token.isCancellationRequested)return;k=G.execObservable(s.args,{encoding:"utf-8",token:g,cwd:s.cwd})}let N,D,V=[".","..","..."],oe=0;return k&&(k.out.onDidChange(G=>{let pe=V[oe%3],de=G.out.trim();oe+=1;let te=de.length>28?`${de.substring(0,28)}${pe}`:de;h.report({message:te}),E(G.out),G.source==="stderr"&&(D?D+=G.out:!D&&G.out.includes("ERROR: Could not install packages")&&(D=G.out.substring(G.out.indexOf("ERROR: Could not install packages"))),N=G.out)},this,w),k.out.done.then(()=>{k?.proc?.exitCode!==0?D&&D.includes("https://pip.pypa.io/warnings/enable-long-paths")?(D=Fe(D,{trim:!0,removeEmptyEntries:!0}).filter(G=>!G.startsWith("[notice]")).join(LJ.EOL),b.reject(new nv(e,t,D))):b.reject(N||k?.proc?.exitCode):b.resolve()},G=>{b.reject(G)}).finally(()=>Q(w))),b.promise},m={location:Zk.ProgressLocation.Notification,cancellable:!0,title:qA.installingModule(o)};await Zk.window.withProgress(m,async(h,g)=>p(h,g))}};var Zde=[Yi(18),Yi(20)];function e_(r,e){return Zde.includes(e)?r==="pip"?["jupyter-client<8","pyzmq<25"]:["jupyter_client<8","pyzmq<25"]:[]}var UJ=require("vscode");var iv=class extends Bc{constructor(t){super(t)}get name(){return"Conda"}get displayName(){return"Conda"}get type(){return"Conda"}get priority(){return 0}async isSupported(t){if(this._isCondaAvailable===!1)return!1;let n=this.serviceContainer.get(Rs);return this._isCondaAvailable=await n.isCondaAvailable(),this._isCondaAvailable?("executable"in t?Jr(t):t.envType)==="Conda":!1}async installModule(t,n,i,o){if(await super.installModule(t,n,i,o),("executable"in n?Jr(n):n.envType==="Conda")&&("executable"in n?ua(n):n.isCondaEnvWithoutPython)){if(!this.serviceContainer.get(ze).isPythonExtensionActive)return;let c=await this.serviceContainer.get(tt).getInterpreterDetails(n.id);c&&!c.isCondaEnvWithoutPython&&Object.assign(n,c)}}async getExecutionArgs(t,n,i=0){let s=await this.serviceContainer.get(Rs).getCondaFile(),a="executable"in n?n.environment?.name:n.envName,c=this.getEnvironmentPath(n),l=[i&1?"update":"install"];return[19,23,22,18,20].map(Yi).includes(t)&&l.push("-c","conda-forge"),a?(l.push("--name"),l.push(CS(a))):c&&(l.push("--prefix"),l.push(wS(c))),i&2&&l.push("--update-deps"),i&4&&l.push("--force-reinstall"),l.push(t),l.push(...e_("conda",t)),l.push("-y"),{exe:s,args:l}}getEnvironmentPath(t){let n;if("executable"in t){if(t.environment?.folderUri)return t.environment.folderUri.fsPath;n=t.executable.uri||UJ.Uri.file(t.path)}else n=t.uri;let i=pt(n.fsPath),o=De(i);return["BIN","SCRIPTS"].indexOf(o.toUpperCase())!==-1?Ve(i,".."):i}};iv=v([(0,t_.injectable)(),d(0,(0,t_.inject)(ut))],iv);var n_=_(O());function eme(){let r=km("PIPENV_MAX_DEPTH");if(r===void 0)return 3;let e=parseInt(r,10);return isNaN(e)?(x(`PIPENV_MAX_DEPTH is incorrectly set. Converting value '${r}' to number results in NaN`),1):e}async function jJ(r,e){let t=km("PIPENV_PIPFILE")||"Pipfile",n=e.lookIntoParentDirectories?eme():1;for(;n>0&&!Ap(r,pt(r));){let i=Ve(r,t);if(await Vg(i))return i;r=pt(r),n-=1}}async function tme(r){let e=Ve(r,".project");if(!await Vg(e))return;let t=await tJ(e);if(!await Vg(t)){x(`The .project file inside environment folder: ${r} doesn't contain a valid path to the project`);return}return t}async function rme(r){let e=pt(pt(r.fsPath)),t=await tme(e);if(!(t===void 0||!De(Rp(e)).startsWith(`${De(Rp(t))}-`)))return jJ(t,{lookIntoParentDirectories:!1})}async function WJ(r,e){let t=await rme(r);if(!t)return!1;let n=km("PIPENV_NO_INHERIT")===void 0,i=await jJ(e.fsPath,{lookIntoParentDirectories:n});return i?Ap(t,i):!1}var r_=require("vscode");function Nx(r){let e="executable"in r?r.executable.uri||r_.Uri.file(r.path):r.uri;return r_.workspace.getWorkspaceFolder(e)?.uri||Is()}var BJ=require("vscode");var VJ="pipenv",ov=class extends Bc{constructor(e){super(e)}get name(){return"pipenv"}get type(){return"Pipenv"}get displayName(){return VJ}get priority(){return 10}async isSupported(e){if(Wu(e)){let t=await this.serviceContainer.get(tt).getActiveInterpreter(e),n=e?BJ.workspace.getWorkspaceFolder(e):void 0;return!t||!n||t.envType!=="PipEnv"?!1:WJ(t.uri,n.uri)}else return("executable"in e?Jr(e):e.envType)==="PipEnv"}async getExecutionArgs(e,t,n=0){let o=[n&4||n&2||n&1?"update":"install",e,"--dev"],s=Nx(t);return{args:o,exe:VJ,cwd:s?Pe(s):void 0}}};ov=v([(0,n_.injectable)(),d(0,(0,n_.inject)(ut))],ov);var i_=_(O());var qJ=require("vscode");var sv=class extends Bc{constructor(e){super(e)}get name(){return"Pip"}get type(){return"Pip"}get displayName(){return"Pip"}get priority(){return 0}async isSupported(e){switch("executable"in e?Jr(e):e.envType){case"Conda":case"PipEnv":case"Poetry":return!1}return this.isPipAvailable(e)}async getExecutionArgs(e,t,n=0){if(e===Yi(27))return await this.serviceContainer.get(Ni).isInstalled(28,t)?{args:["-m","ensurepip"]}:{args:[Ve(EO,"get-pip.py")]};let i=[],o=qJ.workspace.getConfiguration("http").get("proxy","");return o.length>0&&(i.push("--proxy"),i.push(o)),i.push("install","-U"),n&4&&i.push("--force-reinstall"),("executable"in t?Jr(t):t.envType)==="Unknown"&&i.push("--user"),{args:["-m","pip",...i,e].concat(e_("pip",e))}}isPipAvailable(e){return this.serviceContainer.get(Kr).create({resource:void 0,interpreter:e}).then(n=>n.isModuleInstalled("pip")).catch(()=>!1)}};sv=v([(0,i_.injectable)(),d(0,(0,i_.inject)(ut))],sv);var Mx=_(O());var nme=5e4,ql=class ql{constructor(e,t){this.command=e;this.cwd=t;this.fixCwd()}static{this.poetryPromise=new Map}static async getPoetry(e){if(ime(e))return(ql.poetryPromise.get(e)===void 0||Tr())&&ql.poetryPromise.set(e,ql.locate(e)),ql.poetryPromise.get(e)}static async locate(e){E(`Getting poetry for cwd ${e}`);function*t(){let n=nJ("poetryPath");n&&n!=="poetry"&&(yield n),yield"poetry";let i=Bg();if(i){let o=Ve(i.fsPath,".poetry","bin","poetry");hO(o)&&(yield o)}}for(let n of t()){E(`Probing poetry binary for ${e}: ${n}`);let i=new ql(n,e);if(await i.getEnvList()!==void 0)return E(`Found poetry via filesystem probing for ${e}: ${n}`),i;E(`Failed to find poetry for ${e}: ${n}`)}E(`No poetry binary found for ${e}`)}async getEnvList(){return this.getEnvListCached(this.command,this.cwd)}async getEnvListCached(e,t){let n=await this.safeShellExecute(`${e} env list --full-path`);if(!n)return;let i="(Activated)";return(await Promise.all(Fe(n.stdout).map(async s=>{s.endsWith(i)&&(s=s.slice(0,-i.length));let a=s.trim();return await Vg(a)?a:void 0}))).filter(s=>s!==void 0).map(s=>s)}async getActiveEnvPath(){return this.getActiveEnvPathCached(this.cwd)}async getActiveEnvPathCached(e){let t=await this.safeShellExecute(`${this.command} env info -p`,!0);if(t)return t.stdout.trim()}async getVirtualenvsPathSetting(){let e=await this.safeShellExecute(`${this.command} config virtualenvs.path`);if(e)return e.stdout.trim()}fixCwd(){if(qr()==="Windows"&&/^[a-z]:/.test(this.cwd)){let e=this.cwd.split(":");e[0]=e[0].toUpperCase(),this.cwd=e.join(":")}}async safeShellExecute(e,t=!1){let n=new qe,i=await eJ(e,{cwd:this.cwd,throwOnStdErr:!0,timeout:nme}).catch(o=>{t?E(o):x(o)});return E(`Time taken to run ${e} in ms`,n.elapsedTime),i}};v([JR(3e4)],ql.prototype,"getEnvListCached",1),v([JR(2e4)],ql.prototype,"getActiveEnvPathCached",1);var o_=ql;async function JJ(r,e,t){let i=await(t?new o_(t,e):await o_.getPoetry(e))?.getActiveEnvPath();return i?Wg(r,i):!1}function ime(r){let e=Ve(r,"pyproject.toml");return!(!hO(e)||!rJ(e).includes("[tool.poetry]"))}var $J=require("vscode");var ome="poetry",av=class extends Bc{constructor(t,n){super(t);this.configurationService=n}get name(){return"poetry"}get type(){return"Poetry"}get displayName(){return ome}get priority(){return 10}async isSupported(t){if(("executable"in t?Jr(t):t.envType)!=="Poetry")return!1;let n=Nx(t);if(n){let i="executable"in t?t.executable.uri||$J.Uri.file(t.path):t.uri;return JJ(i.fsPath,n.fsPath,this.configurationService.getSettings(void 0).poetryPath)}return!1}async getExecutionArgs(t,n){let o=[this.configurationService.getSettings(void 0).poetryPath,"add","--dev",t],s=Nx(n)?.fsPath;return{useShellExec:!0,args:o,cwd:s}}};av=v([(0,Mx.injectable)(),d(0,(0,Mx.inject)(ut)),d(1,(0,Mx.inject)(le))],av);var qc=_(O()),XJ=require("vscode");var hr=new Map;hr.set(18,"jupyter");hr.set(20,"notebook");hr.set(19,"ipykernel");hr.set(22,"nbconvert");hr.set(21,"kernelspec");hr.set(23,"pandas");hr.set(27,"pip");hr.set(28,"ensurepip");var Fp=_(O());var HJ=new Set(["ipykernel","ipython-genutils","jupyter","jupyter-client","jupyter-core","ipywidgets","nbconvert","nbformat","notebook","pyzmq","pyzmq32","tornado","traitlets"].map(r=>r.toLowerCase())),GJ="NOT INSTALLED",As=class{constructor(e,t,n,i,o){this.pythonExtensionChecker=e;this.interpreterService=t;this.executionFactory=n;this.apiProvider=i;this.disposables=o;this.interpreterInformation=new Map;this.pendingInterpreterInformation=new Map;this.pendingInterpreterBeforeActivation=new Set;this.interpreterPackages=new Map;As._instance=this,this.apiProvider.onDidActivatePythonExtension(()=>this.pendingInterpreterBeforeActivation.forEach(s=>this.trackPackages(s)),this,this.disposables)}static get instance(){return As._instance}getPackageVersions(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(new Map);let t=fn(e.uri),n=this.interpreterInformation.get(t);return n||(n=ue(),this.interpreterInformation.set(t,n),this.trackInterpreterPackages(e).catch(f)),n.promise}async getPackageVersion(e,t){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(void 0);let n=await this.getPackageVersions(e),i=await vt(t.toLocaleLowerCase());if(!n.has(i))return;let o=n.get(i);if(o)return o===GJ?void 0:o}trackPackages(e,t){this.trackPackagesInternal(e,t).catch(f)}async listPackages(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return[];let t=bs(e);if(!this.interpreterPackages.has(t)){let n=this.listPackagesImpl(e);this.interpreterPackages.set(t,n),n.catch(i=>{this.interpreterPackages.get(t)===n&&this.interpreterPackages.delete(t),j(`Failed to get list of installed packages for ${t}`,i)})}return this.interpreterPackages.get(t).then(n=>Array.from(n))}async listPackagesImpl(e){let t=await this.interpreterService.getActiveInterpreter(e);if(!t)return new Set;let n=await this.executionFactory.createActivatedEnvironment({interpreter:t,resource:e}),i="389a87b7-288f-4235-92bf-73bf19bf6491",o=`import pkgutil;import json;print("${i}");print(json.dumps(list([x.name for x in pkgutil.iter_modules()])));print("${i}");`,s=await n.exec(["-c",o],{throwOnStdErr:!1});if(s.stdout){let a=JSON.parse(s.stdout.split(i)[1].trim());return new Set(a.concat(a.map(c=>c.toLowerCase())))}else return x(`Failed to get list of installed packages for ${un(t.uri)}`,s.stderr),new Set}async trackPackagesInternal(e,t){if(!this.pythonExtensionChecker.isPythonExtensionActive){this.pendingInterpreterBeforeActivation.add(e);return}let n;if(Wu(e)){let i=await this.interpreterService.getActiveInterpreter(e);if(!i)return;n=i}else n=e;this.trackInterpreterPackages(n,t).catch(f)}async trackInterpreterPackages(e,t){let n=fn(e.uri);if(this.pendingInterpreterInformation.has(n)&&!t)return;let i=this.getPackageInformation({interpreter:e});i.finally(()=>{let o=setTimeout(()=>{this.pendingInterpreterInformation.get(n)===i&&this.pendingInterpreterInformation.delete(n)},3e5),s={dispose:()=>clearTimeout(o)};this.disposables.push(s)}).catch(f),this.pendingInterpreterInformation.set(n,i)}async getPackageInformation({interpreter:e}){if(e.isCondaEnvWithoutPython)return;let n=await(await this.executionFactory.createActivatedEnvironment({interpreter:e})).execModule("pip",["list"],{throwOnStdErr:!1,mergeStdOutErr:!0}),i=new Map;await Promise.all(Array.from(HJ).map(async a=>{i.set(await vt(a),GJ)})),await Promise.all(n.stdout.split(`
`).map(a=>a.trim().toLowerCase()).filter(a=>a.length>0).map(async a=>{let c=a.split(" ").filter(m=>m.trim().length);if(c.length<2)return;let[l,u]=c;if(!HJ.has(l.toLowerCase().trim()))return;let p=ep(u);i.set(await vt(l),p||"")}));let o=fn(e.uri),s=this.interpreterInformation.get(o);s||(s=ue(),this.interpreterInformation.set(o,s)),s.resolve(i)}};As=v([(0,Fp.injectable)(),d(0,(0,Fp.inject)(ze)),d(1,(0,Fp.inject)(tt)),d(2,(0,Fp.inject)(Kr)),d(3,(0,Fp.inject)(Gt)),d(4,(0,Fp.inject)(F))],As);async function s_(r,e,t){if(Wu(t))return;let n=`${await fc(t)}#${hr.get(e)}`;await r.update(n,!0)}async function zJ(r,e,t){let n=`${await fc({uri:t})}#${hr.get(e)}`;await r.update(n,void 0)}async function QJ(r,e,t){let n=`${await fc(t)}#${hr.get(e)}`;return r.get(n,!1)}var a_=Symbol("IReservedPythonNamedProvider"),Lp=Symbol("IInterpreterPackages"),c_=Symbol("IWorkspaceInterpreterTracker");async function ZJ(r,e,t){let n=`${await fc(t)}#${hr.get(e)}`;if(r.get(n,!1))return!0;let i=Yi(e),o=As.instance?As.instance.getPackageVersion(t,i).then(s=>typeof s=="string"?"found":"notfound").catch(s=>{x("Failed to get interpreter package version",s)}):Promise.resolve(void 0);try{let s=await pr(500,o);if(typeof s=="string")return s==="found"}catch{x(`Failed to check if package exists ${hr.get(e)}`)}}var l_=class{constructor(e,t){this.serviceContainer=e;this.configService=e.get(le),this.productService=e.get(Rx),this.persistentStateFactory=e.get(Ga)}async install(e,t,n,i,o){let a=await this.serviceContainer.get(Yk).getInstallationChannel(e,t);if(!a)return 2;if(n.token.isCancellationRequested)return 3;let c=i===!0?6:void 0;return o===!0&&(c=c?c|8:8),await a.installModule(e,t,n,c),n.token.isCancellationRequested?3:(t.isCondaEnvWithoutPython&&(t.isCondaEnvWithoutPython=!1),this.isInstalled(e,t).then(l=>l?0:2))}async isInstalled(e,t){let n=this.getExecutableNameFromSettings(e,void 0);return this.isExecutableAModule(e,void 0)?(await this.serviceContainer.get(Kr).createActivatedEnvironment({resource:void 0,interpreter:t})).isModuleInstalled(n):(await this.serviceContainer.get(_i).create(void 0)).exec(n,["--version"],{mergeStdOutErr:!0}).then(()=>!0).catch(()=>!1)}getExecutableNameFromSettings(e,t){let n=this.productService.getProductType(e);return this.serviceContainer.get(Ax,n).getExecutableNameFromSettings(e,t)}isExecutableAModule(e,t){let n=this.productService.getProductType(e);return this.serviceContainer.get(Ax,n).isExecutableAModule(e,t)}};v([ti("Checking if product is installed"),d(1,Tl("path"))],l_.prototype,"isInstalled",1);var cv=class{constructor(e,t,n,i){this.serviceContainer=e;this.interpreterPackages=t;this.memento=n;this.output=i;this._onInstalled=new XJ.EventEmitter;this.productService=e.get(Rx)}get onInstalled(){return this._onInstalled.event}dispose(){}async install(e,t,n,i,o){t&&this.interpreterPackages.trackPackages(t);let s="installed";try{let a=await this.createInstaller(e).install(e,t,n,i,o);switch(s_(this.memento,e,t).catch(f),a===0&&this._onInstalled.fire({product:e,resource:t}),a){case 3:s="cancelled";break;case 0:s="installed";break;case 2:s="ignored";break;case 1:s="disabled";break;default:break}return a}catch(a){throw s="failed",a}finally{A("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:s,moduleName:hr.get(e)})}}async isInstalled(e,t){return this.createInstaller(e).isInstalled(e,t)}translateProductToModuleName(e){return Yi(e)}createInstaller(e){switch(this.productService.getProductType(e)){case"DataScience":return new l_(this.serviceContainer,this.output);default:break}throw new Error(`Unknown product ${e}`)}};cv=v([(0,qc.injectable)(),d(0,(0,qc.inject)(ut)),d(1,(0,qc.inject)(Lp)),d(2,(0,qc.inject)($e)),d(2,(0,qc.named)(St)),d(3,(0,qc.inject)(No)),d(3,(0,qc.named)(Uu))],cv);var u_=_(O());var UO=class{constructor(e){this.serviceContainer=e;this.configService=e.get(le),this.productInstaller=e.get(Ni)}isExecutableAModule(e,t){if(e===21)return!1;let n;try{n=this.productInstaller.translateProductToModuleName(e,2)}catch{}let i=this.getExecutableNameFromSettings(e,t);return typeof n=="string"&&n.length>0&&De(i)===i}},lv=class extends UO{constructor(e){super(e)}getExecutableNameFromSettings(e,t){return this.productInstaller.translateProductToModuleName(e,2)}};lv=v([(0,u_.injectable)(),d(0,(0,u_.inject)(ut))],lv);var e8=_(O());var uv=class{constructor(){this.ProductTypes=new Map;this.ProductTypes.set(18,"DataScience"),this.ProductTypes.set(20,"DataScience"),this.ProductTypes.set(19,"DataScience"),this.ProductTypes.set(22,"DataScience"),this.ProductTypes.set(21,"DataScience"),this.ProductTypes.set(23,"DataScience"),this.ProductTypes.set(27,"DataScience"),this.ProductTypes.set(28,"DataScience")}getProductType(e){return this.ProductTypes.get(e)}};uv=v([(0,e8.injectable)()],uv);var jO=require("vscode"),pv=_(O());var Ns=class{constructor(e,t,n){this.title=y.localPythonEnvironments;this._onDidChange=new jO.EventEmitter;this._onDidChangeStatus=new jO.EventEmitter;this.onDidChange=this._onDidChange.event;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshedOnceBefore=!1;this.disposables=[];this.promiseMonitor=new co;this._status="idle";n.push(this),this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this,this.disposables);let i=()=>{let o=e.getNewApi();this.promiseMonitor.push(o),o.then(s=>{if(this.api=s,!s){this.status="idle",this._onDidChangeStatus.fire();return}this._onDidChange.fire(),s.environments.onDidChangeEnvironments(()=>this._onDidChange.fire(),this,this.disposables)}).catch(s=>x("Failed to get python api",s))};t.isPythonExtensionInstalled?i():t.onPythonExtensionInstallationStatusChanged(()=>{t.isPythonExtensionInstalled&&i()},this,this.disposables)}get items(){return this.api?(this.refreshedOnceBefore||(this.refreshedOnceBefore=!0,this.refresh().catch(f)),this.api.environments.known):[]}get status(){return this._status}set status(e){this._status=e,this._onDidChangeStatus.fire()}activate(){}dispose(){Q(this.disposables)}async refresh(){if(!this.api)return;let e=this.api.environments.refreshEnvironments();this.promiseMonitor.push(e),await e.catch(f)}withFilter(e){return new Proxy(this,{get(t,n){switch(n){case"items":return t.items.filter(e);case"dispose":return f;default:return t[n]}}})}};Ns=v([(0,pv.injectable)(),d(0,(0,pv.inject)(Gt)),d(1,(0,pv.inject)(ze)),d(2,(0,pv.inject)(F))],Ns);var mv=_(O());function WO(r,e){if(Array.isArray(r)){let t=r.slice(1);return e&&t.push(...e),{args:t,command:r[0],python:[...r],pythonExecutable:r[r.length-1]}}return{command:r,args:e||[],python:[r],pythonExecutable:r}}function t8(r,e){let t={command:r.command,args:[...r.args],python:[...r.python],pythonExecutable:r.pythonExecutable};return e&&t.args.push(...e),t.pythonExecutable===void 0&&(t.pythonExecutable=t.python[t.python.length-1]),t}var o8=require("vscode");function VO(r,e){return["-m",r,...e]}function r8(){let r=["-c","import sys;print(sys.executable)"];function e(t){return t.trim()}return[r,e]}function n8(r){let e=["-c",`import ${r};print('6af208d0-cb9c-427f-b937-ff563e17efdf')`];function t(n){return n.includes("6af208d0-cb9c-427f-b937-ff563e17efdf")?!0:(E(`Module ${r} is not installed. Output ${n}`),!1)}return[e,t]}async function s8(r,e){let[t,n]=r8(),i=t8(r,t),o=await e(i.command,i.args);return o8.Uri.file(n(o.stdout))}var p_=class{constructor(e,t){this.deps=t;if(this.pythonEnvId=e.id,"executable"in e){if(!e.executable.uri)throw new Error(`interpreter.executable.uri is not defined for ${e.id}`);this.executable=e.executable.uri}else this.executable=e.uri}getExecutionInfo(e=[]){let t=this.deps.getPythonArgv(this.executable);return WO(t,e)}getExecutionObservableInfo(e=[]){let t=this.deps.getObservablePythonArgv(this.executable);return WO(t,e)}async getExecutablePath(){if(await this.deps.isValidExecutable(this.executable))return this.executable;let e=this.getExecutionInfo();return s8(e,this.deps.exec)}async isModuleInstalled(e){let[t,n]=n8(e),i=this.getExecutionInfo(t);try{let o=await this.deps.exec(i.command,i.args,{throwOnStdErr:!1});return n(o.stdout)}catch(o){return j(`Module ${e} not installed in environment ${this.pythonEnvId}`,o),!1}}};function a8(r,e,t,n,i){return{getPythonArgv:o=>e||[Pe(o)],getObservablePythonArgv:o=>t||[Pe(o)],isValidExecutable:r,exec:async(o,s,a)=>n(o,s,Object.assign({throwOnStdErr:!0},a||{})),shellExec:async(o,s)=>i(o,{timeout:s})}}function c8(r,e,t){let n=a8(async i=>t.exists(i),void 0,void 0,(i,o,s)=>e.exec(i,o,s),(i,o)=>e.shellExec(i,o));return new p_(r,n)}function l8(r,e,t,n,i){let o=["run"];e.name===""?o.push("-p",e.path):o.push("-n",e.name);let s=[r,...o,"python"],a=a8(async c=>i.exists(c),s,void 0,(c,l,u)=>n.exec(c,l,u),(c,l)=>n.shellExec(c,l));return new p_(t,a)}var d_=class extends Ye{constructor(t){super("notinstalled",`Module '${t}' not installed.`);this.moduleName=t}};var BO=class{constructor(e){this.deps=e}execObservable(e,t){let n={...t},i=this.deps.getExecutionObservableInfo(e);return this.deps.execObservable(i.command,i.args,n)}execModuleObservable(e,t,n){let i=VO(e,t),o={...n},s=this.deps.getExecutionObservableInfo(i),a={...n};return a.token=void 0,this.deps.execObservable(s.command,s.args,o)}async exec(e,t){let n={...t},i=this.deps.getExecutionInfo(e);return this.deps.exec(i.command,i.args,n)}async execModule(e,t,n){let i=VO(e,t),o={...n},s=this.deps.getExecutionInfo(i),a=await this.deps.exec(s.command,s.args,o);if(e&&PE.outputHasModuleNotInstalledError(e,a.stderr)&&!await this.deps.isModuleInstalled(e))throw new d_(e);return a}};function u8(r,e){let t={isModuleInstalled:async n=>e.isModuleInstalled(n),getExecutionInfo:n=>e.getExecutionInfo(n),getExecutionObservableInfo:n=>e.getExecutionObservableInfo(n),exec:async(n,i,o)=>r.exec(n,i,o),execObservable:(n,i,o)=>r.execObservable(n,i,o)};return new BO(t)}var m_=require("vscode");var dv=class{constructor(e,t,n){this.serviceContainer=e;this.activationHelper=t;this.processServiceFactory=n;this.disposables=this.serviceContainer.get(F),this.fileSystem=this.serviceContainer.get(st)}async create(e){let t=await this.processServiceFactory.create(e.resource);return p8(e.interpreter,t,this.fileSystem,void 0)}async createActivatedEnvironment(e){if(e.resource=e.resource?e.resource:m_.workspace.workspaceFolders?.length?m_.workspace.workspaceFolders[0].uri:void 0,!m_.workspace.isTrusted)throw new Error("Workspace not trusted");let t=await this.activationHelper.getActivatedEnvironmentVariables(e.resource,e.interpreter);if(!(t&&Object.keys(t).length>0))return this.create({resource:e.resource,interpreter:e.interpreter});let i=new Uc({...t});return this.disposables.push(i),p8(e.interpreter,i,this.fileSystem)}};dv=v([(0,mv.injectable)(),d(0,(0,mv.inject)(ut)),d(1,(0,mv.inject)(Ps)),d(2,(0,mv.inject)(_i))],dv);function p8(r,e,t,n){let i=c8(r,e,t);if(n){let[s,a]=n;i=l8(s,a,r,e,t)}let o=u8(e,i);return{isModuleInstalled:s=>i.isModuleInstalled(s),execObservable:(s,a)=>o.execObservable(s,a),execModuleObservable:(s,a,c)=>o.execModuleObservable(s,a,c),exec:(s,a)=>o.exec(s,a),execModule:(s,a,c)=>o.execModule(s,a,c)}}var Jl=_(O()),$l=require("vscode");var d8="https://aka.ms/JupyterKernelStartFailureOverrideReservedName",m8=["abc","aifc","antigravity","argparse","array","ast","asynchat","asyncio","asyncore","atexit","audioop","base64","bdb","binascii","binhex","bisect","builtins","bz2","cProfile","calendar","cgi","cgitb","chunk","cmath","cmd","code","codecs","codeop","collections","colorsys","compileall","concurrent","configparser","contextlib","contextvars","copy","copyreg","crypt","csv","ctypes","curses","dataclasses","datetime","dbm","decimal","difflib","dis","distutils","doctest","email","encodings","ensurepip","enum","errno","faulthandler","fcntl","filecmp","fileinput","fnmatch","formatter","fractions","ftplib","functools","gc","genericpath","getopt","getpass","gettext","glob","graphlib","grp","gzip","hashlib","heapq","hmac","html","http","idlelib","imaplib","imghdr","imp","importlib","inspect","io","ipaddress","itertools","json","keyword","lib2to3","linecache","locale","logging","lzma","mailbox","mailcap","marshal","math","mimetypes","mmap","modulefinder","multiprocessing","netrc","nis","nntplib","ntpath","nturl2path","numbers","opcode","operator","optparse","os","parser","pathlib","pdb","pickle","pickletools","pipes","pkgutil","platform","plistlib","poplib","posix","posixpath","pprint","profile","pstats","pty","pwd","py_compile","pyclbr","pydoc","pydoc_data","queue","quopri","random","re","readline","reprlib","resource","rlcompleter","runpy","sched","secrets","select","selectors","shelve","shlex","shutil","signal","site","smtpd","smtplib","sndhdr","socket","socketserver","sqlite3","sre_compile","sre_constants","sre_parse","ssl","stat","statistics","string","stringprep","struct","subprocess","sunau","symbol","symtable","sys","sysconfig","syslog","tabnanny","tarfile","telnetlib","tempfile","termios","textwrap","this","threading","time","timeit","tkinter","token","tokenize","trace","traceback","tracemalloc","tty","turtle","turtledemo","types","typing","unicodedata","unittest","urllib","uu","uuid","warnings","wave","weakref","webbrowser","wsgiref","xdrlib","xml","xmlrpc","zipapp","zipfile","zipimport","zlib","zoneinfo"];var M8=_(Kx());var gr=Symbol("IFileSystemNode");var kme="jupyter.pythonPackages",zO="diagnostics.reservedPythonNames.exclude",hv=class{constructor(e,t,n,i){this.cache=e;this.platform=t;this.fs=i;this.ignoredFiles=new Set;this.cachedModules=new Set;this.pendingUpdate=Promise.resolve();this.disposables=[];n.push(this),this.cachedModules=new Set(this.cache.get(kme,m8).map(o=>o.toLowerCase())),$l.workspace.onDidChangeConfiguration(o=>{o.affectsConfiguration(`jupyter.${zO}`)&&this.initializeIgnoreList()},this,this.disposables),this.initializeIgnoreList()}dispose(){Q(this.disposables)}async getUriOverridingReservedPythonNames(e){let[t,n]=await Promise.all([this.fs.searchLocal("*.py",e.fsPath,!0),this.fs.searchLocal("*/__init__.py",e.fsPath,!0)]),i=[],o=Promise.all(t.map(a=>$l.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"file"})})),s=Promise.all(n.map(a=>$l.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"__init__"})}));return await Promise.all([o,s]),i}async isReserved(e){if(!e.fsPath.toLowerCase().endsWith(".py"))return!1;await this.pendingUpdate;let t=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;if(Array.from(this.ignoredFiles).some(o=>{if(o===t||(0,M8.default)(t,o,{dot:!0}))return!0}))return!1;let n=hn(e,zu(e)).toLowerCase(),i=n==="__init__"?hn(Ii(e)).toLowerCase():n;return this.cachedModules.has(i)}async addToIgnoreList(e){await this.pendingUpdate;let t=$l.workspace.getConfiguration("jupyter"),n=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;this.initializeIgnoreList();let i=this.ignoredFiles.size;if(this.ignoredFiles.add(n),i!==this.ignoredFiles.size)return this.pendingUpdate=this.pendingUpdate.finally(()=>t.update(zO,Array.from(this.ignoredFiles),$l.ConfigurationTarget.Global)),this.pendingUpdate}initializeIgnoreList(){let t=$l.workspace.getConfiguration("jupyter").get(zO,[]);this.platform.isWindows&&(t=t.map(n=>n.toLowerCase())),this.ignoredFiles=new Set(t)}};hv=v([(0,Jl.injectable)(),d(0,(0,Jl.inject)($e)),d(0,(0,Jl.named)(St)),d(1,(0,Jl.inject)(Er)),d(2,(0,Jl.inject)(F)),d(3,(0,Jl.inject)(gr))],hv);var Lx=_(O());var g_=_(qk());var Fx="_VSCODE_getVariable",Hl=g_.default`
                            try:
                                del _VSCODE_getVariable
                            except:
                                pass
                            `,Jc=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetVariableInfo(e){let t=await this.getContentsOfScript(),n=e.isDebugging?"True":"False",i=`${Fx}("info", ${n}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:Hl}:{code:`${t}

${i}

${Hl}`}}async generateCodeToGetVariableProperties(e){let t=await this.getContentsOfScript(),n=e.isDebugging?"True":"False",i=`${Fx}("properties", ${n}, ${e.variableName}, ${e.stringifiedAttributeNameList})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:Hl}:{code:`${t}

${i}

${Hl}`}}async generateCodeToGetAllVariableDescriptions(e){let t=await this.getContentsOfScript(),n=e.isDebugging?"True":"False",i=e.parent?t:`${t}

_VSCODE_rwho_ls = %who_ls
`,o=g_.default`
        try:
            del _VSCODE_rwho_ls
        except:
            pass
        `,s=e.parent?`${Fx}("AllChildrenDescriptions", ${n}, "${e.parent.root}", ${JSON.stringify(e.parent.propertyChain)}, ${e.startIndex})`:`${Fx}("AllVariableDescriptions", ${n}, _VSCODE_rwho_ls)`;return e.isDebugging?{initializeCode:i,code:s,cleanupCode:e.parent?Hl:`${Hl}
${o}`}:{code:`${i}

${s}

${Hl}`}}async generateCodeToGetVariableTypes(e){let n=`${await this.getContentsOfScript()}

_VSCODE_rwho_ls = %who_ls
`,i=e.isDebugging?"True":"False",o=g_.default`
        try:
            del _VSCODE_rwho_ls
        except:
            pass
        `,s=`${Fx}("types", ${i}, _VSCODE_rwho_ls)`;return e.isDebugging?{initializeCode:n,code:s,cleanupCode:`${Hl}
${o}`}:{code:`${n}${s}

${Hl}
${o}`}}async getContentsOfScript(){if(Jc.contentsOfScript)return Jc.contentsOfScript;let e=sr(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","getVariableInfo","vscodeGetVariableInfo.py"),t=await this.fs.readFile(e);return Jc.contentsOfScript=t,t}};Jc=v([(0,Lx.injectable)(),d(0,(0,Lx.inject)(st)),d(1,(0,Lx.inject)(lt))],Jc);var gv=_(O());var ba=class{constructor(e){this.workspaceInterpreterTracker=e;ba.isActiveWorkspaceInterpreter=this.isActiveWorkspaceInterpreterImpl.bind(this)}activate(){this.workspaceInterpreterTracker?.activate()}isActiveWorkspaceInterpreterImpl(e,t){return this.workspaceInterpreterTracker?.isActiveWorkspaceInterpreter(e,t)??!1}};ba.isActiveWorkspaceInterpreter=()=>!1,ba=v([(0,gv.injectable)(),d(0,(0,gv.inject)(c_)),d(0,(0,gv.optional)())],ba);var Ux=require("vscode");var yv=_(O());var vv=class{constructor(e,t,n){this.pythonExtensionChecker=e;this.disposables=t;this.interpreterService=n;this.workspaceInterpreters=new Map}activate(){this.trackActiveInterpreters(),Ux.extensions.onDidChange(this.trackActiveInterpreters,this,this.disposables)}isActiveWorkspaceInterpreter(e,t){if(!t)return!1;let n=bs(e),i=this.workspaceInterpreters.get(n);return i?Oo(i,t.uri):!1}trackActiveInterpreters(){Br()||this.trackingInterpreters||!this.pythonExtensionChecker.isPythonExtensionActive||(this.trackingInterpreters=!0,this.interpreterService.onDidChangeInterpreter(async()=>{let e=Array.isArray(Ux.workspace.workspaceFolders)?Ux.workspace.workspaceFolders.map(t=>t.uri):[];await Promise.all(e.map(async t=>{try{let n=bs(t),i=await this.interpreterService.getActiveInterpreter(t);this.workspaceInterpreters.set(n,i?.uri)}catch{}}))},this,this.disposables))}};vv=v([(0,yv.injectable)(),d(0,(0,yv.inject)(ze)),d(1,(0,yv.inject)(F)),d(2,(0,yv.inject)(tt))],vv);function O8(r){r.addSingleton(Kr,dv),r.addSingleton(Rs,Rs),r.addSingleton(Tc,Tc),r.addSingleton(Lp,As),r.addSingleton(be,ba),r.addSingleton(c_,vv),r.addSingleton(be,Zg),r.addSingleton(be,ev),r.addSingleton(be,Kp),r.addSingleton(si,si),r.addSingleton(a_,hv),r.addSingleton(Sh,Jc),r.addSingleton(xh,Vc),r.addSingleton(Am,iv),r.addSingleton(Am,sv),r.addSingleton(Am,ov),r.addSingleton(Am,av),r.addSingleton(Yk,tv),r.addSingleton(Rx,uv),r.addSingleton(Ni,cv),r.addSingleton(Ax,lv,"DataScience"),r.addSingleton(Ns,Ns),r.addBinding(Ns,be)}var U8=_(O()),Iv=require("vscode");var F8=new Set;function L8(r){F8.add(r)}function K8(r){try{F8.forEach(e=>e.report(r))}catch(e){x("Failed to report progress",e)}}function bv(r){return function(e,t,n){let i=n.value;n.value=async function(...o){return K8({action:r,phase:"started"}),i.apply(this,o).finally(()=>{K8({action:r,phase:"completed"})})}}}var Go=class{constructor(){this.progressReporters=[];this.actionPhases=new Map;this.currentActions=[];L8(this)}get currentAction(){return this.currentActions.length===0?void 0:this.currentActions[this.currentActions.length-1]}createProgressIndicator(e,t=!1){let n=new Iv.CancellationTokenSource,i=ue(),o={location:Iv.ProgressLocation.Notification,cancellable:t,title:e};return Iv.window.withProgress(o,async(s,a)=>{a.onCancellationRequested(()=>{a.isCancellationRequested&&n.cancel(),i.resolve()}),n.token.onCancellationRequested(()=>{i.resolve()}),this.progressReporters.push(s),await i.promise}).then(f,f),{token:n.token,dispose:()=>i.resolve()}}report(e){if(this.progressReporters.length!==0&&(this.actionPhases.set(e.action,e.phase),e.phase==="started"&&this.currentActions.push(e.action),!!this.currentAction)){for(;this.actionPhases.get(this.currentAction)&&this.actionPhases.get(this.currentAction)!=="started";)this.actionPhases.delete(this.currentAction),this.currentActions.pop();this.updateProgressMessage()}}updateProgressMessage(){if(!this.currentAction||this.progressReporters.length===0)return;let e=RP(this.currentAction);e&&this.progressReporters.forEach(t=>t.report({message:e}))}};Go=v([(0,U8.injectable)()],Go);var j8=_(O());var zn=require("vscode");var Gl=require("vscode");var jx=class r{constructor(e){this.jupyterConfig=e}static{this.migratedSettings={interactiveWindowMode:"interactiveWindow.creationMode",interactiveWindowViewColumn:"interactiveWindow.viewColumn",splitRunFileIntoCells:"interactiveWindow.splitRunFileIntoCells",sendSelectionToInteractiveWindow:"interactiveWindow.textEditor.executeSelection",normalizeSelectionForInteractiveWindow:"interactiveWindow.textEditor.normalizeSelection",magicCommandsAsComments:"interactiveWindow.textEditor.magicCommandsAsComments",enableAutoMoveToNextCell:"interactiveWindow.textEditor.autoMoveToNextCell",newCellOnRunLast:"interactiveWindow.textEditor.autoAddNewCell",pythonCellFolding:"interactiveWindow.textEditor.cellFolding",enableCellCodeLens:"interactiveWindow.codeLens.enable",addGotoCodeLenses:"interactiveWindow.codeLens.enableGotoCell",codeLenses:"interactiveWindow.codeLens.commands",debugCodeLenses:"interactiveWindow.codeLes.debugCommands",codeRegularExpression:"interactiveWindow.cellMarker.codeRegex",markdownRegularExpression:"interactiveWindow.cellMarker.markdownRegex",decorateCells:"interactiveWindow.cellMarker.decorateCells",defaultCellMarker:"interactiveWindow.cellMarker.default",enableExtendedKernelCompletions:"enableExtendedPythonKernelCompletions"}}static{this.fullSettingIds={...this.migratedSettings}}async migrateSettings(){let e=[];for(let t of Object.keys(r.migratedSettings))e.push(...this.migrateSetting(t,r.migratedSettings[t]));e.push(this.migrateIntellisenseSettings());try{await Promise.all(e)}catch(t){Sv(t)}}async migrateIntellisenseSettings(){let e="pythonCompletionTriggerCharacters",t="completionTriggerCharacters",n=this.jupyterConfig.inspect(e),i=this.jupyterConfig.inspect(t);try{if(n?.globalValue===n?.defaultValue||!i||i?.globalValue&&i.globalValue[xe])return;if(typeof n?.globalValue=="string"){let o=i.globalValue||i.defaultValue||{};o[xe]=n.globalValue.split(""),await this.jupyterConfig.update(t,o,Gl.ConfigurationTarget.Global).then(f,Sv)}}finally{n?.globalValue&&await this.jupyterConfig.update(e,void 0,Gl.ConfigurationTarget.Global).then(f,Sv)}}migrateSetting(e,t){let n=this.jupyterConfig.inspect(e),i=this.jupyterConfig.inspect(t),o=[];if(n?.workspaceValue!==void 0){let s=Promise.resolve();i?.workspaceValue===void 0&&(s=this.jupyterConfig.update(t,n.workspaceValue,Gl.ConfigurationTarget.Workspace)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,Gl.ConfigurationTarget.Workspace),Sv))}if(n?.workspaceFolderValue!==void 0){let s=Promise.resolve();i?.workspaceFolderValue===void 0&&(s=this.jupyterConfig.update(t,n.workspaceFolderValue,Gl.ConfigurationTarget.WorkspaceFolder)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,Gl.ConfigurationTarget.WorkspaceFolder),Sv))}if(n?.globalValue!==void 0){let s=Promise.resolve();i?.globalValue===void 0&&(s=this.jupyterConfig.update(t,n.globalValue,Gl.ConfigurationTarget.Global)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,Gl.ConfigurationTarget.Global),Sv))}return o}};function Sv(r){j("Error migrating Jupyter configuration",r)}function _me(r){return(e,t,n)=>{let i=null,o=null;if(typeof n.value=="function"?(i="value",o=n.value):typeof n.get=="function"&&(i="get",o=n.get),!o)throw new Error("not supported");n[i]=r(o,t)}}function xv(r,e,t){return _me((n,i)=>{let o=`$debounce$${i}`,s=`$debounce$result$${i}`;return function(...a){this[s]||(this[s]=t?t():void 0),clearTimeout(this[o]),e&&(this[s]=e(this[s],...a),a=[this[s]]),this[o]=setTimeout(()=>{n.apply(this,a),this[s]=t?t():void 0},r)}})}var Ia=class Ia{constructor(e,t,n){this._systemVariablesCtor=t;this._type=n;this.logging={level:"error"};this.allowUnauthorizedRemoteConnection=!1;this.jupyterInterruptTimeout=1e4;this.jupyterLaunchTimeout=6e4;this.jupyterLaunchRetries=3;this.notebookFileRoot="";this.useDefaultConfigForJupyter=!1;this.sendSelectionToInteractiveWindow=!1;this.normalizeSelectionForInteractiveWindow=!0;this.splitRunFileIntoCells=!0;this.markdownRegularExpression="";this.codeRegularExpression="";this.errorBackgroundColor="";this.variableExplorerExclude="";this.decorateCells="currentCell";this.enableCellCodeLens=!1;this.askForLargeDataFrames=!1;this.enableAutoMoveToNextCell=!1;this.askForKernelRestart=!1;this.codeLenses="";this.debugCodeLenses="";this.debugpyDistPath="";this.stopOnFirstLineWhileDebugging=!1;this.magicCommandsAsComments=!1;this.pythonExportMethod="direct";this.stopOnError=!1;this.addGotoCodeLenses=!1;this.runStartupCommands=[];this.debugJustMyCode=!1;this.defaultCellMarker="";this.themeMatplotlibPlots=!1;this.disableJupyterAutoStart=!1;this.enablePythonKernelLogging=!1;this.jupyterCommandLineArguments=[];this.widgetScriptSources=[];this.interactiveWindowMode="multiple";this.pythonCellFolding=!0;this.interactiveWindowViewColumn="secondGroup";this.disableZMQSupport=!1;this.forceIPyKernelDebugger=!1;this.verboseLogging=!1;this.showVariableViewWhenDebugging=!0;this.newCellOnRunLast=!0;this.logKernelOutputSeparately=!1;this.development=!1;this.poetryPath="";this.excludeUserSitePackages=!1;this.enableExtendedPythonKernelCompletions=!1;this.formatStackTraces=!1;this._changeEmitter=new zn.EventEmitter;this._disposables=[];this._workspaceRoot=e,this.initialize(),zn.workspace.isTrusted===!1&&(this.disableJupyterAutoStart=!0)}get onDidChange(){return this._changeEmitter.event}static{this.jupyterSettings=new Map}static getInstance(e,t,n){let i=Ia.getSettingsUriAndTarget(e).uri,o=i?i.path:"",s=Ia.jupyterSettings.get(o);return s?s._type==="web"&&n==="node"&&(s._systemVariablesCtor=t,s._type=n):(s=new Ia(i,t,n),Ia.jupyterSettings.set(o,s)),s}static getSettingsUriAndTarget(e){let t=e?zn.workspace.getWorkspaceFolder(e):void 0,n=t?t.uri:void 0;!n&&Array.isArray(zn.workspace.workspaceFolders)&&zn.workspace.workspaceFolders.length>0&&(n=zn.workspace.workspaceFolders[0].uri);let i=n?zn.ConfigurationTarget.WorkspaceFolder:zn.ConfigurationTarget.Global;return{uri:n,target:i}}static dispose(){if(!Tr())throw new Error("Dispose can only be called from unit tests");Ia.jupyterSettings.forEach(e=>e&&e.dispose()),Ia.jupyterSettings.clear()}dispose(){this._disposables.forEach(e=>e&&e.dispose()),this._disposables=[]}createSystemVariables(e){return new this._systemVariablesCtor(e,this._workspaceRoot)}toJSON(){let e={};return this.getSerializableKeys().forEach(n=>e[n]=this[n]),e}update(e,t){let n=this.createSystemVariables(void 0),i=n.resolveAny(e.get("logging"));i&&(i.level=Dme(i.level),this.logging?Object.assign(this.logging,i):this.logging=i);let o=n.resolveAny(e.get("experiments"));this.experiments?Object.assign(this.experiments,o):this.experiments=o,this.experiments=this.experiments?this.experiments:{enabled:!0,optInto:[],optOutFrom:[]};let s=(c,l)=>{let u=jx.fullSettingIds[c],p=u&&l.get(u)!==void 0?l.get(u):l.get(c),m=n.resolveAny(p);m!==void 0&&(this[c]=m)};this.getSerializableKeys().filter(c=>c!=="experiments"&&c!=="logging"&&c!=="kernelPickerType").forEach(c=>s(c,e)),t&&s("poetryPath",t)}onWorkspaceFoldersChanged(){let e=(zn.workspace.workspaceFolders||[]).map(i=>i.uri.path),n=Array.from(Ia.jupyterSettings.keys()).filter(i=>e.indexOf(i)<0);if(n.length>0)for(let i of n)Ia.jupyterSettings.delete(i)}initialize(){let e=()=>{let i=zn.workspace.getConfiguration("jupyter",this._workspaceRoot),o=zn.workspace.getConfiguration("python",this._workspaceRoot);this.update(i,o),this.debounceChangeNotification()};this._disposables.push(zn.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this)),this._disposables.push(zn.workspace.onDidChangeConfiguration(i=>{i.affectsConfiguration("jupyter")&&e(),i.affectsConfiguration("python.poetryPath")&&e()}));let t=zn.workspace.getConfiguration("jupyter",this._workspaceRoot),n=zn.workspace.getConfiguration("python",this._workspaceRoot);t&&(this.update(t,n),this.migrateSettings(t).catch(f))}async migrateSettings(e){await new jx(e).migrateSettings()}debounceChangeNotification(){this._changeEmitter.fire()}fireChangeNotification(){this._changeEmitter.fire()}getSerializableKeys(){return Object.getOwnPropertyNames(this).filter(e=>!e.startsWith("_"))}};v([xv(1)],Ia.prototype,"debounceChangeNotification",1);var Cv=Ia;function Dme(r){switch(r){case"info":return 20;case"warn":return 30;case"off":return"off";case"debug":return 10;case"verbose":return 5;default:return 40}}var $c=require("vscode");var v_=class{async updateSectionSetting(e,t,n,i,o){let a={uri:i,target:o||$c.ConfigurationTarget.WorkspaceFolder};e==="jupyter"&&o!==$c.ConfigurationTarget.Global&&(a=Cv.getSettingsUriAndTarget(i));let c=$c.workspace.getConfiguration(e,a.uri),l=c.inspect(t);l!==void 0&&(o===$c.ConfigurationTarget.Global&&l.globalValue===n||o===$c.ConfigurationTarget.Workspace&&l.workspaceValue===n||o===$c.ConfigurationTarget.WorkspaceFolder&&l.workspaceFolderValue===n)||(await c.update(t,n,o),o&&await this.verifySetting(c,o,t,n))}async updateSetting(e,t,n,i){return this.updateSectionSetting("jupyter",e,t,n,i)}async verifySetting(e,t,n,i){if(Tr()&&!vS()){let o=0;do{let s=e.inspect(n);if(!s&&i===void 0||s&&i!==void 0&&(t===$c.ConfigurationTarget.Global?s.globalValue:t===$c.ConfigurationTarget.Workspace?s.workspaceValue:s.workspaceFolderValue)===i)break;await new Promise(a=>setTimeout(a,250)),o+=1}while(o<20)}}};var wv=class extends v_{getSettings(e){return Cv.getInstance(e,Hg,"node")}};wv=v([(0,j8.injectable)()],wv);var Fn=_(Fc()),O7=_(cK()),K7=_(O()),F7=_(_7()),L7=require("util");var N7=_(O()),qp=_(require("vscode"));var R7=_(T7()),A7=require("vscode"),Hc=class{constructor(e=R7.fetch){this.fetchImplementation=e;this.requestOptions={};let t=A7.workspace.getConfiguration("http").get("proxy","");t&&(this.requestOptions={headers:{proxy:t}})}async downloadFile(e){return this.fetchImplementation(e,this.requestOptions)}async exists(e){try{return(await this.downloadFile(e)).status===200}catch(t){return E(`HttpClient - Failure checking for file ${e}: ${t}`),!1}}};var M7="utf8",Dv=class{constructor(){this.vscfs=qp.workspace.fs}arePathsSame(e,t){return bi(e,t)}async getFiles(e){return(await this.vscfs.readDirectory(e)).filter(n=>n[1]===qp.FileType.File).map(n=>qp.Uri.file(n[0]))}async copy(e,t,n){await this.vscfs.copy(e,t,n)}async createDirectory(e){await this.vscfs.createDirectory(e)}async delete(e){await this.vscfs.delete(e)}async readFile(e){let t=await this.vscfs.readFile(e);return new TextDecoder().decode(t)}async stat(e){return this.vscfs.stat(e)}async writeFile(e,t){return this.vscfs.writeFile(e,typeof t=="string"?new TextEncoder().encode(t):t)}async exists(e,t){if(e.scheme.toLowerCase()==="http"||e.scheme.toLowerCase()==="https")return new Hc().exists(e.toString());let n;try{n=await this.stat(e)}catch(i){return Ok(i)||x(`stat() failed for "${e}"`,i),!1}return t===void 0?!0:t===qp.FileType.Unknown?n.type===qp.FileType.Unknown:(n.type&t)===t}async getFileHash(e){let t=await this.stat(e),n=`${t.ctime}-${t.mtime}`;return la(n,"SHA-512")}};Dv=v([(0,N7.injectable)()],Dv);var U7=require("vscode");var Yl=class extends Dv{constructor(){super();this.globFiles=(0,L7.promisify)(O7.default)}createLocalWriteStream(t){return Fn.createWriteStream(t)}async createTemporaryLocalFile(t){let n=typeof t=="string"?t:t.fileExtension,i=t&&typeof t=="object"?t.prefix:void 0,o={postfix:n,prefix:i};return new Promise((s,a)=>{F7.file(o,(c,l,u,p)=>{if(c)return a(c);s({filePath:l,dispose:p})})})}async searchLocal(t,n,i){let o;n&&(o={...o,cwd:n}),i&&(o={...o,dot:i});let s=await this.globFiles(t,o);return Array.isArray(s)?s:[]}async writeLocalFile(t,n){return await Fn.ensureDir(pt(t)),Fn.writeFile(t,n)}async readFile(t){if(Lm(t)){let n=await Fn.readFile(Pe(t));return Buffer.from(n).toString(M7)}else return super.readFile(t)}async delete(t){Lm(t)?await this.exists(t)&&((await this.stat(t)).type===U7.FileType.Directory?await new Promise(i=>Fn.rm(Pe(t),{force:!0,recursive:!0},i)):await Fn.unlink(Pe(t))):await super.delete(t)}async exists(t,n){return Lm(t)?Fn.pathExists(Pe(t)):super.exists(t,n)}async createDirectory(t){Lm(t)?await Fn.ensureDir(Pe(t)):await this.vscfs.createDirectory(t)}async writeFile(t,n){if(Lm(t)){let i=Pe(t);return await Fn.ensureDir(pt(i)),Fn.writeFile(i,typeof n=="string"?Buffer.from(n):n)}else await this.vscfs.writeFile(t,typeof n=="string"?new TextEncoder().encode(n):n)}async copy(t,n,i){if(Lm(t)&&Lm(n)){let o=typeof i===void 0||typeof i?.overwrite==null?!0:i?.overwrite;await Fn.copy(Pe(t),Pe(n),{overwrite:o})}else await super.copy(t,n,i)}};Yl=v([(0,K7.injectable)()],Yl);function Lm(r){return r.scheme==="file"}var Hx=_(Fc());var j7=_(O()),W7=require("vscode");var Tv=class extends BE{async computeWorkingDirectory(e){return Gx(e)}};Tv=v([(0,j7.injectable)()],Tv);async function Gx(r){let e=r&&r.scheme==="file"?await Hx.pathExists(r.fsPath):!1;return(r&&r.scheme==="file"?await Hx.pathExists(pt(r.fsPath)):!1)&&r&&r.fsPath.includes(".")?pt(r.fsPath):e&&r&&(await Hx.stat(r.fsPath)).isDirectory()?r.fsPath:r&&W7.workspace.getWorkspaceFolder(r)?.uri.fsPath||Is()?.fsPath||process.cwd()}var Um=_(O());var V7=require("vscode");var Rv=class{constructor(e,t){this.jupyterOutput=e;this.disposableRegistry=t}register(){this.disposableRegistry.push(V7.commands.registerCommand($.ViewJupyterOutput,this.viewJupyterOutput,this))}viewJupyterOutput(){this.jupyterOutput.show(!0)}};Rv=v([(0,Um.injectable)(),d(0,(0,Um.inject)(No)),d(0,(0,Um.named)(Uu)),d(1,(0,Um.inject)(F))],Rv);var zx=_(O()),q7=require("vscode");var B7=require("vscode");var Av=class{constructor(e,t,n,i=[]){this.fs=e;this.disposableRegistry=t;this.options=n;this.loadFailedEmitter=new B7.EventEmitter;let o={enableScripts:!0,localResourceRoots:[this.options.rootPath,this.options.cwd,...i]};n.webviewHost?(this.webviewHost=n.webviewHost,this.webviewHost.webview.options=o):this.webviewHost=this.createWebview(o),this.loadPromise=this.load()}get loadFailed(){return this.loadFailedEmitter.event}asWebviewUri(e){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");return this.webviewHost.webview.asWebviewUri(e)}postMessage(e){this.webviewHost?.webview&&this.webviewHost?.webview.postMessage(e)}async generateLocalReactHtml(){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");let e=this.webviewHost.webview.asWebviewUri(this.options.cwd).toString(),t=this.options.scripts.map(o=>this.webviewHost.webview.asWebviewUri(o)),n=this.webviewHost.webview.asWebviewUri(this.options.rootPath).toString(),i="false";return`<!doctype html>
        <html lang="en">
            <head>
                <meta charset="utf-8">
                <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
                <meta http-equiv="Content-Security-Policy" content="img-src 'self' data: https: http: blob: ${this.webviewHost.webview.cspSource}; default-src 'unsafe-inline' 'unsafe-eval' data: https: http: blob: ${this.webviewHost.webview.cspSource};">
                <meta name="theme-color" content="#000000">
                <meta name="theme" content="${Ge.GeneratedThemeName}"/>
                <title>VS Code Python React UI</title>
                <base href="${e}${e.endsWith("/")?"":"/"}"/>
                </head>
            <body>
                <noscript>You need to enable JavaScript to run this app.</noscript>
                <div id="root"></div>
                <script type="text/javascript">
                    // Public path that will be used by webpack.
                    window.__PVSC_Public_Path = "${n}/";
                    function resolvePath(relativePath) {
                        if (relativePath && relativePath[0] == '.' && relativePath[1] != '.') {
                            return "${e}" + relativePath.substring(1);
                        }

                        return "${e}" + relativePath;
                    }
                    function forceTestMiddleware() {
                        return ${i};
                    }
                </script>
                ${t.map(o=>`<script type="text/javascript" src="${o}"></script>`).join(`
`)}
            </body>
        </html>`}async load(){try{this.webviewHost?.webview&&((await Promise.all(this.options.scripts.map(t=>this.fs.exists(t)))).every(t=>t===!0)?(this.webviewHost.webview.html=await this.generateLocalReactHtml(),this.postLoad(this.webviewHost)):this.webviewHost.webview.html=y.badWebPanelFormatString(this.options.scripts.join(", ")))}catch(e){x(`Error Loading WebviewPanel: ${e}`),this.loadFailedEmitter.fire()}}};var CK=class extends Av{constructor(t,n,i,o=[]){super(t,n,i,o);this.panelOptions=i;this._onDidChangeVisibility=new q7.EventEmitter}get visible(){return this.webviewHost?this.webviewHost.visible:!1}get onDidChangeVisibility(){return this._onDidChangeVisibility.event}createWebview(t){throw new Error("Webview Views must be passed in an initial view")}postLoad(t){this.disposableRegistry.push(t.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose().catch(f)})),this.disposableRegistry.push(t.webview.onDidReceiveMessage(n=>{this.panelOptions.listener.onMessage(n.type,n.payload)})),this.disposableRegistry.push(t.onDidChangeVisibility(()=>{this._onDidChangeVisibility.fire()})),this._onDidChangeVisibility.fire()}},Nv=class{constructor(e,t){this.disposableRegistry=e;this.fs=t}async create(e){return new CK(this.fs,this.disposableRegistry,e)}};Nv=v([(0,zx.injectable)(),d(0,(0,zx.inject)(F)),d(1,(0,zx.inject)(st))],Nv);var Ov=_(O()),w_=require("vscode");var wK=class extends Av{get panel(){return this.webviewHost}get panelOptions(){return this.options}constructor(e,t,n,i=[]){super(e,t,n,i)}async show(e){await this.loadPromise,this.panel&&(e?this.panel.visible||this.panel.reveal(this.panel.viewColumn,e):this.panel.active||this.panel.reveal(this.panel.viewColumn,e))}close(){this.panel&&this.panel.dispose()}get viewColumn(){return this.panel?.viewColumn}isVisible(){return this.panel?this.panel.visible:!1}isActive(){return this.panel?this.panel.active:!1}setTitle(e){this.panelOptions.title=e,this.panel&&(this.panel.title=e)}createWebview(e){return w_.window.createWebviewPanel(this.panelOptions.title.toLowerCase().replace(" ",""),this.panelOptions.title,{viewColumn:this.panelOptions.viewColumn,preserveFocus:!0},{retainContextWhenHidden:!0,enableFindWidget:!0,...e})}postLoad(e){this.disposableRegistry.push(e.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose().catch(f)})),this.disposableRegistry.push(e.webview.onDidReceiveMessage(t=>{this.panelOptions.listener.onMessage(t.type,t.payload)})),this.disposableRegistry.push(e.onDidChangeViewState(t=>{this.panelOptions.listener.onChangeViewState(this)})),this.panelOptions.listener.onChangeViewState(this)}},Mv=class{constructor(e,t,n){this.disposableRegistry=e;this.fs=t;this.context=n}async create(e){let t=[w_.Uri.file(Ve(this.context.extensionPath,"temp"))];return Array.isArray(e.additionalPaths)&&t.push(...e.additionalPaths),new wK(this.fs,this.disposableRegistry,e,t)}};Mv=v([(0,Ov.injectable)(),d(0,(0,Ov.inject)(F)),d(1,(0,Ov.inject)(st)),d(2,(0,Ov.inject)(lt))],Mv);function J7(r){r.addSingleton(Yl,Yl),r.addBinding(Yl,gr),r.addBinding(Yl,st),r.addSingleton(OP,Tv),r.addSingleton(le,wv),M9(r),EJ(r),kJ(r),O8(r),r.addSingletonInstance(Ej,Date.now()),r.addSingleton(Go,Go),r.addSingleton(be,ht),r.addSingleton(Ih,Rv),r.add(KP,Nv),r.add(bp,Mv)}var jm=_(O()),Y7=require("vscode");var Hp=_(O()),Lv=require("vscode");var Qx=_(O()),Xl=require("vscode");var Kv=Symbol("IJupyterCommandFactory"),Jp=Symbol("IJupyterSubCommandExecutionService");function Ife(r){r.sort((e,t)=>e===18?-1:t===18?1:e===20?-1:t===20?1:0)}function EK(r,e){let t=e.displayName||e.envName||e.envPath?.fsPath||e.uri.fsPath,n=r.map(i=>hr.get(i)).filter(i=>!!i).map(i=>i);switch(n.length){case 0:return"";case 1:return t?y.libraryRequiredToLaunchJupyterNotInstalledInterpreter(t,n[0]):y.libraryRequiredToLaunchJupyterNotInstalled(n[0]);default:{let i=n.pop();return t?y.librariesRequiredToLaunchJupyterNotInstalledInterpreter(t,`${n.join(", ")} ${ye.and} ${i}`):y.librariesRequiredToLaunchJupyterNotInstalled(`${n.join(", ")} ${ye.and} ${i}`)}}}var Ms=class{constructor(e,t){this.installer=e;this.commandFactory=t;this.dependenciesInstalledInInterpreter=new Set}async installMissingDependencies(e,t){let n=new Xl.CancellationTokenSource;try{let i=e.envType==="Conda"?Promise.resolve(void 0):this.installer.isInstalled(27,e),[o,s]=await Promise.all([this.getDependenciesNotInstalled(e,void 0),i]);if(o.length===0)return 0;let a=EK(s===!1?[27].concat(o):o,e);switch(A("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:hr.get(18),pythonEnvType:e.envType}),await Xl.window.showErrorMessage(a,{modal:!0},y.jupyterInstall,y.selectDifferentJupyterInterpreter)){case y.jupyterInstall:{o.includes(21)&&!o.includes(18)&&o.push(18);let l=o.filter(p=>p!==21);Ife(l);let u=l.shift();for(;u;)if(await fr(n.token,2,this.installer.install(u,e,n,void 0,s===!1))===0){u=l.shift();continue}else return 2;return A("DATASCIENCE.USER_INSTALLED_JUPYTER"),this.checkKernelSpecAvailability(e)}case y.selectDifferentJupyterInterpreter:return A("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),1;case y.pythonInteractiveHelpLink:return Xl.env.openExternal(Xl.Uri.parse(gS.PythonInteractiveHelpLink)),A("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2;default:return A("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2}}finally{n.dispose()}}async areDependenciesInstalled(e,t){return this.getDependenciesNotInstalled(e,t).then(n=>n.length===0)}async getDependenciesNotInstalled(e,t){let n=fn(e.uri);if(this.dependenciesInstalledInInterpreter.has(n))return[];let i=[];if(await fr(t,Promise.all([this.installer.isInstalled(18,e).then(s=>s?void 0:i.push(18)),this.installer.isInstalled(20,e).then(s=>s?void 0:i.push(20))])),i.length>0)return i;if(t?.isCancellationRequested)return[];let o=await this.isKernelSpecAvailable(e,t).then(s=>s?[]:[21]);return o.length===0&&this.dependenciesInstalledInInterpreter.add(n),o}async isKernelSpecAvailable(e,t){return this.commandFactory.createInterpreterCommand("kernelspec","jupyter",["-m","jupyter","kernelspec"],e,!1).exec(["--version"],{throwOnStdErr:!0}).then(()=>!0).catch(i=>(x("Kernel spec not found: ",i),!1))}async checkKernelSpecAvailability(e,t){return await this.isKernelSpecAvailable(e)?0:t?.isCancellationRequested?2:await Xl.window.showErrorMessage(y.jupyterKernelSpecModuleNotFound(e.uri.fsPath),{modal:!0},y.selectDifferentJupyterInterpreter)===y.selectDifferentJupyterInterpreter?1:2}};v([bv("InstallingMissingDependencies")],Ms.prototype,"installMissingDependencies",1),Ms=v([(0,Qx.injectable)(),d(0,(0,Qx.inject)(Ni)),d(1,(0,Qx.inject)(Kv))],Ms);var D_=_(O());var T_=require("vscode");var H7=require("vscode");function E_(r,e){let t=np(r),i={label:`${r.id===e.recommended?.id?"$(star-full) ":ua(r)?"$(warning) ":""}${t}`};return i.description=W(r.executable.uri||r.path,H7.workspace.workspaceFolders||[],new Lc().homeDir),i.tooltip=ua(r)?y.pythonCondaKernelsWithoutPython:"",i}function P_(r){switch(Jr(r)){case"Conda":return ua(r)?{label:y.kernelCategoryForCondaWithoutPython,sortKey:"Z"}:{label:y.kernelCategoryForConda};case"PipEnv":return{label:y.kernelCategoryForPipEnv};case"Poetry":return{label:y.kernelCategoryForPoetry};case"Pyenv":return{label:y.kernelCategoryForPyEnv};case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return{label:y.kernelCategoryForVirtual};default:return{label:y.kernelCategoryForGlobal}}}var Os=_(O()),G7=require("vscode");var k_="INTERPRETER_PATH_SELECTED_FOR_JUPYTER_SERVER",PK="INTERPRETER_PATH_WAS_SELECTED_FOR_JUPYTER_SERVER",Sa=class{constructor(e){this.memento=e}get interpreterSetAtleastOnce(){return!!this.selectedPythonPath||this.memento.get(PK,!1)}get selectedPythonPath(){if(this._interpreterPath)return this._interpreterPath;let e=this.memento.get(k_,void 0);if(e)return G7.Uri.parse(e)}updateSelectedPythonPath(e){this._interpreterPath=e,this.memento.update(k_,e?.toString()).then(f,f),this.memento.update(PK,!0).then(f,f)}};Sa=v([(0,Os.injectable)(),d(0,(0,Os.inject)($e)),d(0,(0,Os.named)(St))],Sa);var Fv=class{constructor(e,t,n,i){this.api=e;this.memento=t;this.checker=n;this.disposables=i}activate(){this.activateBackground().catch(f),this.api.onDidActivatePythonExtension(this.activateBackground,this,this.disposables)}async activateBackground(){!this.memento.get(k_)&&this.checker.isPythonExtensionActive&&await this.migrateSettings()}async migrateSettings(){if(this.settingsMigrated)return;this.settingsMigrated=!0;let t=(await this.api.getApi()).getInterpreterPathSelectedForJupyterServer();await this.memento.update(k_,t),await this.memento.update(PK,!0)}};Fv=v([(0,Os.injectable)(),d(0,(0,Os.inject)(Gt)),d(1,(0,Os.inject)($e)),d(1,(0,Os.named)(St)),d(2,(0,Os.inject)(ze)),d(3,(0,Os.inject)(F))],Fv);var zo=require("vscode");var kK=class{constructor(e){this.label=e}},__=class extends kK{constructor(t,n){super(t);this.sortKey=n;this.kind=zo.QuickPickItemKind.Separator}},$p=class extends Zt{constructor(t,n,i,o,s,a){super();this.provider=t;this.createQuickPickItem=n;this.getCategory=i;this.options=o;this.createErrorQuickPickItem=s;this._title=a;this.categories=new Map;this.quickPickItems=[];this.previouslyEnteredValue="";this.commands=new Set;this._placeholder="";this.quickPickItemMap=new WeakSet;this.errorQuickPickItemMap=new WeakSet}set recommended(t){let n=this._recommended?.id!==t?.id;this._recommended=t,n&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get recommended(){return this._recommended}set placeholder(t){this.quickPick&&(this.quickPick.placeholder=t),this._placeholder=t}get placeholder(){return this._placeholder}set selected(t){let n=this._selected!==t;this._selected=t,n&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get selected(){return this._selected}createQuickPick(){let t=[],n={iconPath:new zo.ThemeIcon("refresh"),tooltip:ye.refresh},i=this.quickPick=zo.window.createQuickPick();return t.push(i),this.quickPickItems=[],i.placeholder=this.placeholder,i.matchOnDescription=!0,i.buttons=this.options.supportsBack?[zo.QuickInputButtons.Back,n]:[n],i.ignoreFocusOut=!0,i.busy=!0,i.value=this.previouslyEnteredValue,i.onDidChangeValue(o=>this.previouslyEnteredValue=o,this,t),i.onDidHide(()=>Q(t),this,t),i.title=this._title||y.kernelPickerSelectKernelFromRemoteTitleWithoutName,this.provider.then(o=>{this.resolvedProvider=o,this._title||(i.title=y.kernelPickerSelectKernelFromRemoteTitle(o.title)),i.busy=o.status==="discovering",o.onDidChange(()=>this.updateQuickPickItems(i,o),this,t),i.onDidTriggerButton(async a=>{a===n&&(i.busy=!0,await o.refresh().catch(f),this.updateQuickPickItems(i,o),i.busy=!1)},this,t);let s;o.onDidChangeStatus(()=>{switch(s&&clearTimeout(s),o.status){case"discovering":i.busy=!0;break;case"idle":s=setTimeout(()=>i.busy=!1,500),t.push(new zo.Disposable(()=>s&&clearTimeout(s)));break}},this,t),z7(o.items.map(a=>this.toQuickPickItem(a)),(a,c)=>Q7(this.getCategory(a.item,this),this.getCategory(c.item,this))).forEach(a=>{let c=this.connectionToCategory(a[0].item);this.quickPickItems.push(c),a.sort((l,u)=>l.label.localeCompare(u.label)),this.quickPickItems.push(...a),this.categories.set(c,new Set(a))}),this.updateQuickPickItems(i,o)}).catch(o=>x(`Failed to get quick pick items for ${i.title}`,o)),t.forEach(o=>this._register(o)),{quickPick:i,disposables:t}}isCommandQuickPickItem(t){return this.commands.has(t)}addCommand(t,n){let i=t;return i.execute=n,this.commands.add(i),this.quickPick&&this.rebuildQuickPickItems(this.quickPick),{dispose:()=>{this.commands.delete(i)}}}async selectItem(t){for(;!t.isCancellationRequested;){let{quickPick:n,disposables:i}=this.createQuickPick();n.show();try{this.previouslySelectedItem=void 0;let o=await new Promise((s,a)=>{n.onDidChangeSelection(c=>{if(c.length){let l=c[0];this.isSelectorQuickPickItem(l)?s(l.item):this.isCommandQuickPickItem(l)?s(l):this.isErrorQuickPickItem(l)}}),n.onDidTriggerButton(c=>c===zo.QuickInputButtons.Back?s(Ne.back):void 0,this,i),n.onDidHide(()=>s(void 0),this,i)});if(t.isCancellationRequested||!o)return;if(o instanceof Ne)return o===Ne.back?Ne.back:void 0;if(o&&"label"in o&&this.isCommandQuickPickItem(o)){this.previouslySelectedItem=o;let s=await o.execute();if(!s||s===Ne.back)continue;return s instanceof Ne,s}return o||void 0}finally{Q(i)}}}updateQuickPickItems(t,n){let i=new Map(t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>[a.item.id,a.item])),o=new Map(n.items.map(a=>[a.id,a]));this.quickPickItems=this.quickPickItems.map(a=>{if(this.isSelectorQuickPickItem(a)){let c=i.get(a.item.id);if(c&&c!==a.item)return this.toQuickPickItem(c);let l=o.get(a.item.id);if(l){let u=this.toQuickPickItem(l);if(JSON.stringify({...a,item:""})!==JSON.stringify({...u,item:""}))return this.toQuickPickItem(l)}}return a});let s=n.items.filter(a=>!i.has(a.id)).map(a=>this.toQuickPickItem(a));this.removeOutdatedQuickPickItems(t,n),z7(s,(a,c)=>Q7(this.getCategory(a.item,this),this.getCategory(c.item,this))).forEach(a=>{a.sort((u,p)=>u.label.localeCompare(p.label));let c=this.connectionToCategory(a[0].item),l=this.quickPickItems.find(u=>u.kind===zo.QuickPickItemKind.Separator&&u.label===c.label);if(l){let u=this.quickPickItems.indexOf(l),p=this.categories.get(l),m=new Map(Array.from(p).map(b=>[b.item.id,b])),h=p.size;a.forEach(b=>{let w=m.get(b.item.id);w&&p.delete(w),p.add(b)});let g=Array.from(p);g.sort((b,w)=>b.label.localeCompare(w.label)),this.quickPickItems.splice(u+1,h,...g)}else{let u=this.quickPickItems.filter(h=>h instanceof __).map((h,g)=>[h,g]);u.push([c,-1]),u.sort((h,g)=>h[0].sortKey.localeCompare(g[0].sortKey));let p=u.findIndex(h=>h[1]===-1),m=0;p>0&&(m=u.length===p+1?this.quickPickItems.length:u[p+1][1]),a.sort((h,g)=>h.label.localeCompare(g.label)),this.quickPickItems.splice(m,0,c,...a),this.categories.set(c,new Set(a))}}),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let n=this.recommended?this.toQuickPickItem(this.recommended):void 0,i=[];n&&i.push({label:y.recommendedItemCategoryInQuickPick,kind:zo.QuickPickItemKind.Separator},n);let o=n;o=this.selected?this.quickPickItems.filter(p=>this.isSelectorQuickPickItem(p)).map(p=>p).find(p=>p.item.id===this.selected?.id):o;let s=this.quickPickItems.filter(p=>!this.isSelectorQuickPickItem(p)||p.item.id!==n?.item?.id),a=t.activeItems.length?t.activeItems[0]:void 0;o&&a&&(this.isSelectorQuickPickItem(a)?a.item.id!==o.item.id&&(o=void 0):o=void 0);let c=this.resolvedProvider?.lastError?this.toErrorQuickPickItem(this.resolvedProvider.lastError):void 0,l=[].concat(Array.from(this.commands.values())).concat(i).concat(s).concat(c?[c]:[]),u=o?[o]:t.activeItems.length?[t.activeItems[0]]:[];if(u.length&&!l.includes(u[0])){let p=u[0],m=this.isSelectorQuickPickItem(p)&&l.find(h=>this.isSelectorQuickPickItem(h)&&h.item.id===p.item.id);m?u[0]=m:u.length=0}t.items=l,t.activeItems=u,!t.activeItems.length&&this.previouslySelectedItem&&l.includes(this.previouslySelectedItem)&&(t.activeItems=[this.previouslySelectedItem])}isErrorQuickPickItem(t){return this.errorQuickPickItemMap.has(t)}toErrorQuickPickItem(t){if(!this.createErrorQuickPickItem)return;let n=this.createErrorQuickPickItem(t,this);return this.errorQuickPickItemMap.add(n),n}isSelectorQuickPickItem(t){return this.quickPickItemMap.has(t)}toQuickPickItem(t){let n=this.createQuickPickItem(t,this);return n.item=t,this.quickPickItemMap.add(n),n}removeOutdatedQuickPickItems(t,n){let i=t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>a.item.id),o=new Map(n.items.map(a=>[a.id,a])),s=i.filter(a=>!o.has(a));if(s.length){let a=[];this.categories.forEach((c,l)=>{c.forEach(u=>{s.includes(u.item.id)&&(c.delete(u),a.push(u))}),c.size||(a.push(l),this.categories.delete(l))}),this.quickPickItems=this.quickPickItems.filter(c=>!a.includes(c)),this.rebuildQuickPickItems(t)}}connectionToCategory(t){let n=this.getCategory(t,this);return new __(n.label,n.sortKey||n.label)}};function z7(r,e){let t=[],n;for(let i of r.slice(0).sort(e))!n||e(n[0],i)!==0?(n=[i],t.push(n)):n.push(i);return t}function Q7(r,e){return(r.sortKey||r.label).localeCompare(e.sortKey||e.label,void 0,{sensitivity:"accent"})}var Zl=class{constructor(e){this.serviceContainer=e}async selectPythonInterpreter(){let e=await this.selectPythonEnvironment();return e?.executable?.uri&&await this.serviceContainer.get(tt).getInterpreterDetails(e.executable.uri)}async selectPythonEnvironment(){let e=new T_.CancellationTokenSource,t=new Lc,n=this.serviceContainer.get(Sa).selectedPythonPath,i=Te.instance.get(si),o=Te.instance.get(Ns).withFilter(u=>!ua(u)&&!i.isPythonEnvironmentExcluded(u)),s=()=>o.items.find(u=>Oo(u.executable.uri,n,t.osType)),a=n?y.currentlySelectedJupyterInterpreterForPlaceholder(W(n,T_.workspace.workspaceFolders||[],t.homeDir)):"",c=[],l=new $p(Promise.resolve(o),E_,P_,{supportsBack:!1},void 0,y.quickPickSelectPythonEnvironmentTitle);l.placeholder=a,l.selected=s(),c.push(l),c.push(e);try{if(!l.selected&&n){let p=o.onDidChange(()=>{l.selected=s(),l.selected&&p.dispose()});c.push(p)}let u=await l.selectItem(e.token);return!u||u instanceof Ne?void 0:u}catch(u){x("Failed to select a Python Environment to start Jupyter",u)}finally{Q(c)}}};Zl=v([(0,D_.injectable)(),d(0,(0,D_.inject)(ut))],Zl);var ci=class{constructor(e,t,n,i,o){this.interpreterSelectionState=e;this.jupyterInterpreterSelector=t;this.interpreterConfiguration=n;this.interpreterService=i;this._onDidChangeInterpreter=new Lv.EventEmitter;Lv.workspace.onDidGrantWorkspaceTrust(()=>{this.getInitialInterpreterPromiseFailed&&(this.getInitialInterpreterPromise=void 0,this.getInitialInterpreterPromiseFailed=!1)},this,o)}get onDidChangeInterpreter(){return this._onDidChangeInterpreter.event}async getSelectedInterpreter(e){return await this.setInitialInterpreter(e),this._selectedInterpreter}async setInitialInterpreter(e){return this.getInitialInterpreterPromise||(this.getInitialInterpreterPromise=this.getInitialInterpreterImpl(e).then(t=>(t&&this.changeSelectedInterpreterProperty(t),t)),this.getInitialInterpreterPromise.catch(()=>this.getInitialInterpreterPromiseFailed=!0)),this.getInitialInterpreterPromise}async selectInterpreter(){let e=await this.jupyterInterpreterSelector.selectPythonInterpreter();if(!e)return;switch(await this.interpreterConfiguration.installMissingDependencies(e,void 0)){case 0:return await this.setAsSelectedInterpreter(e),e;case 2:return;default:return this.selectInterpreter()}}async installMissingDependencies(e){let t=await this.getSelectedInterpreter(),n=t;if(!n&&(n=await this.interpreterService.getActiveInterpreter(void 0),!n))return e&&await Lv.window.showErrorMessage(e.message,{modal:!0},y.selectDifferentJupyterInterpreter)!==y.selectDifferentJupyterInterpreter?2:(await this.selectInterpreter(),1);let i=await this.interpreterConfiguration.installMissingDependencies(n,e);return i===1?(n=await this.selectInterpreter(),n?0:2):(i===0&&n!==t&&await this.setAsSelectedInterpreter(n),i)}async setAsSelectedInterpreter(e){await this.setInitialInterpreter(),this.changeSelectedInterpreterProperty(e)}changeSelectedInterpreterProperty(e){this._selectedInterpreter=e,this._onDidChangeInterpreter.fire(e),this.interpreterSelectionState.updateSelectedPythonPath(e.uri)}async validateInterpreterPath(e,t){try{let n=await fr(t,this.interpreterService.getInterpreterDetails(e));if(n&&await this.interpreterConfiguration.areDependenciesInstalled(n,t))return n}catch{}}async getInitialInterpreterImpl(e){let t;if(this.interpreterSelectionState.selectedPythonPath&&(t=await this.validateInterpreterPath(this.interpreterSelectionState.selectedPythonPath,e),t||this.interpreterSelectionState.updateSelectedPythonPath(void 0)),!t){let n=await this.interpreterService.getActiveInterpreter(void 0);n&&await this.interpreterConfiguration.areDependenciesInstalled(n,e)&&(t=n)}return t}};ci=v([(0,Hp.injectable)(),d(0,(0,Hp.inject)(Sa)),d(1,(0,Hp.inject)(Zl)),d(2,(0,Hp.inject)(Ms)),d(3,(0,Hp.inject)(tt)),d(4,(0,Hp.inject)(F))],ci);var R_=Symbol("IKernelLauncher"),li=Symbol("IRawNotebookSupportedService"),A_=Symbol("IRawKernelSessionFactory");var Uv=class{constructor(e,t,n,i){this.jupyterInterpreterService=e;this.disposables=t;this.rawSupported=n;this.extensionChecker=i;this.notebookOpened=!1}activate(){this.disposables.push(Y7.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookEditor,this)),this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(this.onDidChangeInterpreter,this))}onDidOpenNotebookEditor(e){Tt(e)&&(this.notebookOpened=!0,A("DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",KV(e)),!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(f))}onDidChangeInterpreter(){this.notebookOpened&&!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(f)}};Uv=v([(0,jm.injectable)(),d(0,(0,jm.inject)(ci)),d(1,(0,jm.inject)(F)),d(2,(0,jm.inject)(li)),d(3,(0,jm.inject)(ze))],Uv);var N_=_(O()),X7=require("vscode");var Xr=class{static dispose(){Q(Xr.disposables)}constructor(e){e.push({dispose:()=>{Xr.dispose()}})}activate(){X7.workspace.onDidChangeNotebookDocument(e=>{Tt(e.notebook)&&e.cellChanges.filter(t=>t.outputs?.length===0).map(t=>{let n=Xr.cellToDisplayIdMapping.get(t.cell);n&&(Xr.cellToDisplayIdMapping.delete(t.cell),Xr.displayIdCellOutputMappingPerDocument.get(e.notebook)?.delete(n))})})}static trackOutputByDisplayId(e,t,n,i){let o=Xr.displayIdCellOutputMappingPerDocument.get(e.notebook);o||(o=new Map,Xr.displayIdCellOutputMappingPerDocument.set(e.notebook,o)),o.set(t,{outputContainer:n,cell:e,outputItems:i}),Xr.cellToDisplayIdMapping.set(e,t)}static getMappedOutput(e,t){let n=Xr.displayIdCellOutputMappingPerDocument.get(e);if(!n)return;let i=n.get(t);return i?.cell.document.isClosed?void 0:i}};Xr.displayIdCellOutputMappingPerDocument=new WeakMap,Xr.cellToDisplayIdMapping=new WeakMap,Xr.disposables=[],Xr=v([(0,N_.injectable)(),d(0,(0,N_.inject)(F))],Xr);var Wm=_(O());var _K="Active_Kernel_Id_List",Sfe=100,Qo=class{constructor(e,t){this.globalMemento=e;this.crypto=t}async getPreferredRemoteKernelId(e){let t=this.globalMemento.get(_K,[]);if(t.length){let n=await this.crypto.createHash(e.toString()),i=t.find(o=>o.fileHash===n);return E(`Preferred Remote kernel for ${W(e)} is ${i?.kernelId}`),i?.kernelId}}async clearPreferredRemoteKernelId(e){await this.updatePreferredRemoteKernelIdInternal(e)}async storePreferredRemoteKernelId(e,t){await this.updatePreferredRemoteKernelIdInternal(e,t)}async updatePreferredRemoteKernelIdInternal(e,t){let n=!1,i=JSON.parse(JSON.stringify(this.globalMemento.get(_K,[]))),o=await this.crypto.createHash(e.toString()),s=i.findIndex(a=>a.fileHash===o);for(s>=0&&(n=!0,i.splice(s,1)),t&&(n=!0,i.push({fileHash:o,kernelId:t}),E(`Storing Preferred remote kernel for ${W(e)} is ${t}`));i.length>Sfe;)n=!0,i.shift();n&&await this.globalMemento.update(_K,i)}};Qo=v([(0,Wm.injectable)(),d(0,(0,Wm.inject)($e)),d(0,(0,Wm.named)(St)),d(1,(0,Wm.inject)(bh))],Qo);var Wv=_(O()),DK=require("vscode");var xfe=1e3,jv=class{constructor(e,t,n){this.serverStorage=e;this.kernelProvider=t;this.disposables=[];this.monitoredKernels=new WeakSet;this.timeouts=new Set;n.push(this)}dispose(){Q(this.disposables),Q(Array.from(this.timeouts.values()))}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables),this.kernelProvider.onDidRestartKernel(this.onDidStartKernel,this,this.disposables)}onDidStartKernel(e){let t=e.kernelConnectionMetadata;if(!Ft(t)||this.monitoredKernels.has(e))return;this.monitoredKernels.add(e);let n=[];this.disposables.push(new DK.Disposable(()=>Q(n)));let i=()=>{if(Q(n),e.disposed||e.disposing)return;let o=setTimeout(()=>{this.serverStorage.update(t.serverProviderHandle).catch(f)},xfe);n.push(new DK.Disposable(()=>clearTimeout(o)))};this.kernelProvider.getKernelExecution(e).onPreExecute(i,this,this.disposables),i()}};jv=v([(0,Wv.injectable)(),d(0,(0,Wv.inject)(er)),d(1,(0,Wv.inject)(Ke)),d(2,(0,Wv.inject)(F))],jv);var xa=_(O()),Yx=require("vscode");var Z7=require("vscode"),Yt=class{constructor(e){this._event=new Z7.EventEmitter;this._disableUI=e}get disableUI(){return this._disableUI}set disableUI(e){let t=this._disableUI!==e;this._disableUI=e,t&&this._event.fire()}get onDidChangeDisableUI(){return this._event.event}dispose(){this._event.dispose()}};var Cfe="last-python-notebook-created",e$="last-notebook-created",Vv=class{constructor(e,t,n,i,o,s){this.configService=e;this.serverConnector=t;this.disposables=n;this.rawKernelSupport=i;this.mementoStorage=o;this.kernelProvider=s;Yx.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebook.bind(this),this,n)}activate(){this.checkDateForServerStart(),this.disposables.push(this.kernelProvider.onDidStartKernel(this.kernelStarted,this))}get lastNotebookCreated(){let e=this.mementoStorage.get(e$);return e?new Date(e):void 0}checkDateForServerStart(){this.shouldAutoStartStartServer(this.lastNotebookCreated)&&this.createServerIfNecessary().catch(f)}shouldAutoStartStartServer(e){if(!e)return!1;let n=new Date().getTime()-e.getTime();return Math.floor(n/(24*3600*1e3))<=7}async createServerIfNecessary(){if(!Yx.workspace.isTrusted||this.rawKernelSupport.isSupported)return;let e=new Yx.CancellationTokenSource,t=new Yt(!0);try{z("Attempting to start a server because of preload conditions ..."),this.configService.getSettings(void 0).disableJupyterAutoStart||await this.serverConnector.connect({resource:void 0,ui:t,token:e.token})}catch(n){x("Error starting server in serverPreload: ",n)}finally{t.dispose(),e.dispose()}}onDidOpenNotebook(e){Tt(e)&&this.createServerIfNecessary().catch(f)}kernelStarted(e){let t=Lo(e.kernelConnectionMetadata);this.mementoStorage.update(e$,Date.now()).then(f,f),t===xe&&this.mementoStorage.update(Cfe,Date.now()).then(f,f)}};Vv=v([(0,xa.injectable)(),d(0,(0,xa.inject)(le)),d(1,(0,xa.inject)(zE)),d(2,(0,xa.inject)(F)),d(3,(0,xa.inject)(li)),d(4,(0,xa.inject)($e)),d(4,(0,xa.named)(ri)),d(5,(0,xa.inject)(Ke))],Vv);var Io=_(O());var Ks=_(O());var Xi=class extends Ye{constructor(e){super("jupyterinstall",e)}};var Ar=require("vscode");var Vm=class extends kn{constructor(e){super("timeout",y.rawKernelStartFailedDueToTimeout(mt(e)),e)}};var Gp=class extends Cc{constructor(t,n,i,o){super(t,i,o);this.stdErr=n}};var Bv=class extends kn{constructor(e){super("timeout",y.rawKernelStartFailedDueToTimeoutWaitingForPort(mt(e)),e)}};var zp=class extends kn{constructor(t=-1,n,i){super("kerneldied",y.kernelDied(n.trim()),i);this.exitCode=t;this.stdErr=n}};var Bm=class extends kn{constructor(t,n){super("noipykernel",y.kernelInvalid(mt(n)),n);this.reason=t}};var Qp=class extends Cc{constructor(e){super(y.kernelDiedWithoutError(mt(e)),void 0,e)}};var M_=class extends Ye{constructor(e){super("jupyterexpiredcert",e)}};var Yp=class extends Ye{constructor(t){super("invalidremotejupyterserverurihandle","Server handle not in list of known handles");this.serverProviderHandle=t}};var O_=new Map,RK=new Map,TK;function t$(r){TK=r}function AK(r,e){if(!r.pythonEnvironmentPath)return;let t=ue();wfe({interpreterHash:r.pythonEnvironmentPath}).then(n=>{r.pythonEnvironmentPackages=n||r.pythonEnvironmentPackages,e&&(e.pythonEnvironmentPackages=n||e.pythonEnvironmentPackages)}).catch(()=>{}).finally(()=>{t.resolve()})}async function wfe(r){if(!TK)return x("Python package provider is not initialized."),"{}";let e;if("interpreter"in r?e=r.interpreter:e=RK.get(r.interpreterHash),!e)return"{}";let t=await TK(e);return!t||t.size===0?"{}":JSON.stringify(Object.fromEntries(t))}async function r$(r){if(!r)return{};let e=O_.get(fn(r)),t=Hi(r);if(!e&&t)return{resourceType:t,resourceHash:r?await vt(r.toString()):void 0};if(!e)return{};let n=JSON.parse(JSON.stringify(e[0]));return AK(e[0],n),n}function Rt(r,e,t,n,i){r$(r).then(o=>{Object.assign(o,n||{}),A(e,t,o,i)}).catch(f)}var eu=class extends Ye{constructor(t,n,i){super("jupyternotebooknotinstalled",t+(n?`
${n}`:""));this.interpreter=i}};var n$=new Map;function K_(r,e){n$.set(Wt(r),e)}function qv(r,e,t){let n=e.jupyterCollections.find(i=>i.extensionId===r.extensionId&&i.id===r.id);return n$.get(Wt(r))||n?.label||t||`${r.id}:${r.handle}`}var $v=class{constructor(e,t,n,i,o,s,a){this.dependencyManager=e;this.configuration=t;this.kernelDependency=n;this.serverUriStorage=i;this.jupyterUriProviderRegistration=o;this.fs=s;this.interpreterService=a;this.handledErrors=new WeakSet;this.handledKernelErrors=new WeakSet}async handleError(e){if(j("DataScience Error",e),e=sn.unwrap(e),!this.handledErrors.has(e)){if(this.handledErrors.add(e),e instanceof Xi)await this.dependencyManager?.installMissingDependencies(e);else if(e instanceof Uo)await $E(this.configuration,e.message);else if(e instanceof M_)await HE(this.configuration,e.message);else if(!mr(e))if(e instanceof Vm||e instanceof Bv)Ar.window.showErrorMessage(e.message).then(f,f);else if(e instanceof Gp||e instanceof zp||e instanceof eu||e instanceof vs)Ar.window.showErrorMessage(Jv(e)).then(f,f);else if(e instanceof ki&&Br())Ar.window.showErrorMessage(y.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl)).then(f,f);else if(e instanceof ki){let t=await this.handleJupyterServerConnectionError(e,void 0);Ar.window.showErrorMessage(t).then(f,f)}else if(e instanceof mp){let t=await this.handleJupyterServerUriProviderError(e,void 0);Ar.window.showErrorMessage(t).then(f,f)}else{let t=i$(e.message||e.toString());Ar.window.showErrorMessage(t).then(f,f)}}}async getErrorMessageForDisplayInCell(e,t,n){if(e=sn.unwrap(e),mr(e)||x("Error in execution (get message for cell)",e),e instanceof Qp)return"";if(e instanceof Bm)return NK(e.kernelConnectionMetadata)||e.message;if(e instanceof Xi)return kfe(e)||e.message;if(e instanceof ki&&!Br())return e.message;if(e instanceof ki&&Br())return y.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl);if(mr(e))return"";if(e instanceof nv){let i=typeof e.product=="string"?e.product:hr.get(e.product)||`${e.product}`,o=np(e.interpreter)||e.interpreter.id||"",s=W("executable"in e.interpreter?e.interpreter.executable.uri:e.interpreter.uri),a=o?` ${o} (${s})`:s;return y.packageNotInstalledWindowsLongPathNotEnabledError(i,a)}else{if((e instanceof Gp||e instanceof zp)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&!await this.fs.exists(e.kernelConnectionMetadata.interpreter.uri))return y.failedToStartKernelDueToMissingPythonEnv(e.kernelConnectionMetadata.interpreter.displayName||e.kernelConnectionMetadata.interpreter.envName||W(e.kernelConnectionMetadata.interpreter.uri));if((e instanceof Gp||e instanceof zp)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(e.kernelConnectionMetadata,void 0,!0))return NK(e.kernelConnectionMetadata)||e.message;if(e instanceof kn||e instanceof Cc){let[i,o]=await Promise.all([this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(n),pa(e.kernelConnectionMetadata.interpreter)]),s=sm(Ar.workspace.workspaceFolders||[],e,mt(e.kernelConnectionMetadata),o,i.map(a=>a.uri));if(s){if(s.reason==="moduleNotFound"&&["ipykernel_launcher","ipykernel"].includes(s.moduleName))return NK(e.kernelConnectionMetadata)||e.message;let a=[s.message];return s.moreInfoLink&&a.push(ye.clickHereForMoreInfoWithHtml(s.moreInfoLink)),dt(e.kernelConnectionMetadata)&&s.reason==="moduleNotFound"&&!["ipykernel_launcher","ipykernel"].includes(s.moduleName)&&await this.addErrorMessageIfPythonArePossiblyOverridingPythonModules(a,n),a.join(`
`)}}else{if(e instanceof ki)return this.handleJupyterServerConnectionError(e,t);if(e instanceof mp)return this.handleJupyterServerUriProviderError(e,t);if(e instanceof Yp){let i=Ar.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId;return Jv(y.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(i),t)}}}return Jv(e,t)}async handleJupyterServerUriProviderError(e,t){let n=await qv(e.serverProviderHandle,this.jupyterUriProviderRegistration),i=e.originalError?.message||e.message;return Jv(y.remoteJupyterConnectionFailedWithServerWithError(n,i),t)}async handleJupyterServerConnectionError(e,t){let n=await qv(e.serverProviderHandle,this.jupyterUriProviderRegistration,e.baseUrl),i=e.originalError.message||"";return Jv(y.remoteJupyterConnectionFailedWithServerWithError(n,i),t)}async handleJupyterServerProviderConnectionError(e,t){let n=new Ar.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(n.token));return i&&(i.find(o=>o.id===e.handle)||await this.serverUriStorage.remove(e).catch(f)),!0}catch{return!1}finally{n.dispose()}}async handleKernelError(e,t,n,i,o){if(mr(e)||j(`Kernel Error, context = ${t}`,e),e=sn.unwrap(e),mr(e))return this.sendKernelTelemetry(e,t,i,"cancelled"),1;if(e instanceof Bm)if(j(`Jupyter Kernel Dependency Error, reason=${e.reason}`,e),this.sendKernelTelemetry(e,t,i,e.category),e.reason===4&&this.kernelDependency){let s=new Ar.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:n,ui:new Yt(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else return e.reason;else{if((t==="start"||t==="restart")&&e instanceof Xi)return this.sendKernelTelemetry(e,t,i,e.category),(this.dependencyManager?await this.dependencyManager.installMissingDependencies(e):2)===0?0:1;if(e instanceof ki||e instanceof mp||e instanceof Yp){this.sendKernelTelemetry(e,t,i,e.category);let s=e instanceof Yp?"":e instanceof ki?e.originalError.message||"":e.originalError?.message||e.message,a=e.serverProviderHandle.extensionId,c=e.serverProviderHandle.id,l=this.jupyterUriProviderRegistration.jupyterCollections.find(b=>b.extensionId===a&&b.id==c);if(!l||await this.handleJupyterServerProviderConnectionError(e.serverProviderHandle,l))return 3;let u=e instanceof ki?e.baseUrl:"",p=qv(e.serverProviderHandle,this.jupyterUriProviderRegistration,u),m=e instanceof Yp?Ar.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId:"",h=o==="jupyterExtension"?[y.selectDifferentKernel]:[];switch(await Ar.window.showErrorMessage(e instanceof Yp?y.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(m):y.remoteJupyterConnectionFailedWithServer(p),{detail:s,modal:!0},y.removeRemoteJupyterConnectionButtonText,y.changeRemoteJupyterConnectionButtonText,...h)){case y.removeRemoteJupyterConnectionButtonText:return await this.serverUriStorage.remove(e.serverProviderHandle).catch(f),1;case y.changeRemoteJupyterConnectionButtonText:return 1;case y.selectDifferentKernel:return 3}return 1}else if(e instanceof Uo){this.sendKernelTelemetry(e,t,i,e.category);let s=y.jupyterSelfCertEnable,a=y.jupyterSelfCertClose;return Ar.window.showErrorMessage(y.jupyterSelfCertFail(e.message),s,a).then(c=>{c===s?(A("DATASCIENCE.SELFCERTSMESSAGEENABLED"),this.configuration.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,Ar.ConfigurationTarget.Workspace).catch(f)):c===a&&A("DATASCIENCE.SELFCERTSMESSAGECLOSE")}).then(f,f),2}else{if((t==="start"||t==="restart")&&n.kind==="startUsingPythonInterpreter"&&this.interpreterService&&!await this.fs.exists(n.interpreter.uri))return this.interpreterService.getInterpreterDetails(n.interpreter.id).then(async s=>{let a=await this.fs.exists(n.interpreter.uri);s?Rt(i,"DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",void 0,{envMissingReason:"Unknown",isEmptyCondaEnv:s.isCondaEnvWithoutPython,pythonEnvType:s.envType,fileExists:a}):Rt(i,"DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",void 0,{envMissingReason:"EmptyEnvDetailsFromPython",isEmptyCondaEnv:n.interpreter.isCondaEnvWithoutPython,pythonEnvType:n.interpreter.envType,fileExists:a})}).catch(async()=>{let s=await this.fs.exists(n.interpreter.uri);Rt(i,"DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",void 0,{envMissingReason:"FailedToGetEnvDetailsFromPython",isEmptyCondaEnv:n.interpreter.isCondaEnvWithoutPython,pythonEnvType:n.interpreter.envType,fileExists:s})}).catch(f),this.sendKernelTelemetry(e,t,i,"pythonEnvironmentMissing"),Ar.window.showErrorMessage(y.failedToStartKernelDueToMissingPythonEnv(n.interpreter.displayName||n.interpreter.envName||W(n.interpreter.uri))).then(f,f),this.interpreterService.refreshInterpreters(!0).catch(f),2;if((t==="start"||t==="restart")&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(n,void 0,!0)){this.sendKernelTelemetry(e,t,i,"noipykernel");let s=new Ar.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:n,ui:new Yt(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else{let[s,a]=await Promise.all([this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(i),pa(n.interpreter)]),c=sm(Ar.workspace.workspaceFolders||[],e,mt(n),a,s.map(l=>l.uri));return this.sendKernelTelemetry(e,t,i,c?.reason),c?this.showMessageWithMoreInfo(c.message,c?.moreInfoLink).catch(f):this.showMessageWithMoreInfo(Jv(e,t)).catch(f),2}}}}sendKernelTelemetry(e,t,n,i){this.handledKernelErrors.has(e)||(this.handledKernelErrors.add(e),t==="start"&&Rt(n,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:!1,failureCategory:i},e))}async showMessageWithMoreInfo(e,t){e.includes($.ViewJupyterOutput)||(e=`${e} 
${y.viewJupyterLogForFurtherInfo}`);let n=t?[ye.learnMore]:[];await Ar.window.showErrorMessage(e,...n).then(i=>{i===ye.learnMore&&t&&Ar.env.openExternal(Ar.Uri.parse(t))})}};$v=v([d(0,(0,Ks.inject)(pp)),d(0,(0,Ks.optional)()),d(1,(0,Ks.inject)(le)),d(2,(0,Ks.inject)(Cs)),d(2,(0,Ks.optional)()),d(3,(0,Ks.inject)(er)),d(4,(0,Ks.inject)(Qt)),d(5,(0,Ks.inject)(st)),d(6,(0,Ks.inject)(tt)),d(6,(0,Ks.optional)())],$v);var Efe={restart:y.failedToRestartKernel,start:y.failedToStartKernel,interrupt:y.failedToInterruptKernel,execution:""};function Jv(r,e){r=typeof r=="string"?r:sn.unwrap(r);let t=e?Efe[e]:"",n="";return r instanceof eu?n=y.jupyterNotebookNotInstalledOrNotFound(r.interpreter):r instanceof Ye?n=kE(r.stdErr)||r.stdErr||r.message:n=typeof r=="string"?r:r.message,i$(t,n)}function Pfe(r){return(new RegExp(/\[([^\[]+)\]\((.*)\)/).exec(r)?.length??0)>0}function i$(r="",e=""){r&&e.startsWith(r.substring(0,r.length-1))&&(r="");let t=[r,e].map(n=>n.trim()).filter(n=>n.length>0).join(` 
`);return!Pfe(t)&&t.length&&t.indexOf("command:jupyter.viewOutput")===-1?`${t.endsWith(".")?t:t+"."} 
${y.viewJupyterLogForFurtherInfo}`:t}function NK(r){if(r.kind==="connectToLiveRemoteKernel"||r.kind==="startUsingRemoteKernelSpec"||!r.interpreter)return;let e=r.interpreter.displayName||Pe(r.interpreter.uri),t=hr.get(19),n=Yi(19),i=`${wS(Pe(r.interpreter.uri))} -m pip install ${n} -U --force-reinstall`;r.interpreter?.envType==="Conda"?r.interpreter?.envName?i=`conda install -n ${r.interpreter?.envName} ${n} --update-deps --force-reinstall`:r.interpreter?.envPath&&(i=`conda install -p ${Pe(r.interpreter?.envPath)} ${n} --update-deps --force-reinstall`):r.interpreter?.envType==="Unknown"&&(i=`${wS(Pe(r.interpreter.uri))} -m pip install ${n} -U --user --force-reinstall`);let o=y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter(e,hr.get(19)),s=y.installPackageInstructions(t,i);return o+`
`+s}function kfe(r){let e=`${hr.get(18)} ${ye.and} ${hr.get(20)}`,t=[18,20].map(Yi).join(" "),n=`python -m pip install ${t} -U
or
conda install ${t} -U`,i=y.installPackageInstructions(e,n);return r.message+`
`+i+`
`+ye.clickHereForMoreInfoWithHtml("https://aka.ms/installJupyterForVSCode")}var Hv=class extends $v{constructor(t,n,i,o,s,a,c,l){super(t,n,i,o,s,c,l);this.reservedPythonNames=a}async addErrorMessageIfPythonArePossiblyOverridingPythonModules(t,n){let i=await this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(n);if(i.length>0){let o=n?Ii(n):void 0,s=i.map(c=>{if(c.type==="file"){let l=n?W(c.uri,[],o):hn(c.uri);return`<a href='${c.uri.toString()}?line=1'>${l}</a>`}else{let l=n?W(c.uri,[],o):`${hn(Ii(c.uri))}/__init__.py`;return`<a href='${c.uri.toString()}?line=1'>${l}</a>`}}),a="";s.length===1?a=s[0]:a=`${s.slice(0,-1).join(", ")} ${ye.and} ${s.slice(-1)}`,t.push(y.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting(a)),t.push(y.listOfFilesWithLinksThatMightNeedToBeRenamed(a)),t.push(ye.clickHereForMoreInfoWithHtml(d8))}}async getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(t){return t?this.reservedPythonNames.getUriOverridingReservedPythonNames(Ii(t)):[]}};Hv=v([(0,Io.injectable)(),d(0,(0,Io.inject)(pp)),d(0,(0,Io.optional)()),d(1,(0,Io.inject)(le)),d(2,(0,Io.inject)(Cs)),d(2,(0,Io.optional)()),d(3,(0,Io.inject)(er)),d(4,(0,Io.inject)(Qt)),d(5,(0,Io.inject)(a_)),d(6,(0,Io.inject)(st)),d(7,(0,Io.inject)(tt))],Hv);var L_=_(O());var Xx=class{constructor(e,t,n,i){this.moduleName=e;this.args=t;this.pythonExecutionFactory=n;this._interpreter=i;this.interpreterPromise=Promise.resolve(this._interpreter),this.pythonLauncher=this.interpreterPromise.then(async o=>n.createActivatedEnvironment({interpreter:o}))}interpreter(){return this.interpreterPromise}async exec(e,t){let n={...t},i=await this.pythonLauncher,o=[...this.args,...e],s=o[1];return o.shift(),o.shift(),i.execModule(s,o,n)}},MK=class extends Xx{constructor(e,t,n,i){super(e,t,n,i)}},OK=class extends Xx{constructor(e,t,n,i){super(e,t,n,i)}async exec(e,t){let n,i={stdout:""};try{i=await super.exec(e,t)}catch(a){n=a}if(!i.stderr&&!n)return i;let o=()=>{if(n)throw x("Exception attempting to enumerate kernelspecs: ",n),n;return i},s=await this.interpreter();if(!s||this.moduleName.toLowerCase()!=="jupyter"||this.args.join(" ").toLowerCase()!=="-m jupyter kernelspec".toLowerCase())return o();try{if(e.join(" ").toLowerCase()==="list --json")return i=await this.getKernelSpecList(s,t),i;if(e.join(" ").toLowerCase()==="--version")return i=await this.getKernelSpecVersion(s,t),i}catch(a){x("Failed to get a list of the kernelspec using python script",a)}return o()}async getKernelSpecList(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([Ve($o,"pythonFiles","vscode_datascience_helpers","getJupyterKernels.py")],{...t,throwOnStdErr:!0})}async getKernelSpecVersion(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([Ve($o,"pythonFiles","vscode_datascience_helpers","getJupyterKernelspecVersion.py")],{...t,throwOnStdErr:!0})}},Gv=class{constructor(e){this.executionFactory=e}createInterpreterCommand(e,t,n,i){return e==="notebook"?new MK(t,n,this.executionFactory,i):e==="kernelspec"?new OK(t,n,this.executionFactory,i):new Xx(t,n,this.executionFactory,i)}};Gv=v([(0,L_.injectable)(),d(0,(0,L_.inject)(Kr))],Gv);var Zx=_(O());var o$=require("vscode");var zv=class{constructor(e,t){this.service=e;this.disposables=t}activate(){this.disposables.push(o$.commands.registerCommand("jupyter.selectJupyterInterpreter",()=>{this.service.selectInterpreter().catch(f)}))}};zv=v([(0,Zx.injectable)(),d(0,(0,Zx.inject)(ci)),d(1,(0,Zx.inject)(F))],zv);var Ls=_(O());var Fs=_(O());var Pr=require("vscode");var s$=_(Fc()),a$=require("vscode");async function U_(r){try{let e=await s$.realpath(r.fsPath);return qr()!="Windows"&&(e=e.replace(/\\/g,"/")),a$.Uri.file(e)}catch{return r}}var _fe=Ve("AppData","Roaming","jupyter","kernels"),c$=Ve(".local","share","jupyter","kernels"),l$=Ve("Library","Jupyter","kernels"),Dfe=Ve("AppData","Roaming","jupyter","runtime"),Tfe=Ve("Library","Jupyter","runtime"),u$=Ve("share","jupyter","kernels"),j_="CACHE_KEY_FOR_JUPYTER_KERNELSPEC_ROOT_PATH.",KK="CACHE_KEY_FOR_JUPYTER_KERNEL_PATHS_.",Fr=class{constructor(e,t,n,i,o,s,a){this.platformService=e;this.envVarsProvider=t;this.globalState=i;this.fs=o;this.context=s;this.pythonExecFactory=a;this.cachedDataDirs=new Map;this.envVarsProvider.onDidEnvironmentVariablesChange(()=>{this.cachedJupyterKernelPaths=void 0,this.cachedJupyterPaths=void 0},this,n)}async getKernelSpecTempRegistrationFolder(){let e=sr(this.context.extensionUri,"temp","jupyter","kernels");return await this.fs.createDirectory(e),e}async getKernelSpecRootPath(){let e=this.getCachedRootPath();return e||this.cachedKernelSpecRootPath?e||this.cachedKernelSpecRootPath:(this.cachedKernelSpecRootPath=(async()=>{let t=this.platformService.homeDir;if(t)return this.platformService.isWindows?U_(sr(t,_fe)):this.platformService.isMac?sr(t,l$):sr(t,c$)})(),this.cachedKernelSpecRootPath.then(t=>{E(`Getting Jupyter KernelSpec Root Path ${t?.toString()}`),this.updateCachedRootPath(t)}).catch(f),this.cachedKernelSpecRootPath)}async getRuntimeDir(){let e,t=this.platformService.homeDir;if(t&&(this.platformService.isWindows?e=await U_(sr(t,Dfe)):this.platformService.isMac?e=sr(t,Tfe):e=process.env.$XDG_RUNTIME_DIR?Pr.Uri.file(Ve(process.env.$XDG_RUNTIME_DIR,"jupyter","runtime")):sr(t,".local","share","jupyter","runtime")),!e){x("Failed to determine Jupyter runtime directory");return}try{return await this.fs.createDirectory(e),e}catch(n){x(`Failed to create runtime directory, reverting to temp directory ${e}`,n)}}async getDataDirs(e){let t=e.interpreter?e.interpreter.uri.toString():"";return this.cachedDataDirs.has(t)||this.cachedDataDirs.set(t,this.getDataDirsImpl(e.resource,e.interpreter)),this.cachedDataDirs.get(t)}async getDataDirsImpl(e,t){let n=new uo,i=await this.getJupyterPaths();for(let m of i)m&&!n.has(m)&&n.set(m,n.size);if(t)try{ne(`Getting Jupyter Data Dir for ${t.uri.fsPath}`);let m=await this.pythonExecFactory.createActivatedEnvironment({interpreter:t,resource:e}),h=Pr.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyterDataDir.py"),g=await m.exec([h.fsPath],{});if(g.stdout.trim().length){let b=Pr.Uri.file(g.stdout.trim());await this.fs.exists(b)?n.has(b)||n.set(b,n.size):j(`Got a non-existent Jupyter Data Dir ${b}`)}else j(`Got an empty Jupyter Data Dir from ${t.id}, stderr = ${g.stderr}`)}catch(m){x(`Failed to get DataDir based on ENABLE_USER_SITE for ${t.displayName}`,m)}let o;t&&(o=await pa(t));let s=o?Pr.Uri.joinPath(Pr.Uri.file(o),"share","jupyter"):void 0,a=this.getSystemJupyterPaths(),c=s?new Dc(a).has(s)?void 0:s:void 0,l=this.getJupyterDataDir(),u=(process.env.JUPYTER_PREFER_ENV_PATH||"no").toLowerCase();return["no","n","false","off","0","0.0"].includes(u)?[l,c].forEach(m=>{m&&!n.has(m)&&n.set(m,n.size)}):[c,l].forEach(m=>{m&&!n.has(m)&&n.set(m,n.size)}),a.forEach(m=>{m&&!n.has(m)&&n.set(m,n.size)}),Array.from(n.entries()).sort((m,h)=>m[1]-h[1]).map(m=>m[0])}getJupyterConfigDir(){return process.env.JUPYTER_CONFIG_DIR?Pr.Uri.file(In(process.env.JUPYTER_CONFIG_DIR)):this.platformService.homeDir?Pr.Uri.joinPath(this.platformService.homeDir,".jupyter"):void 0}getSystemJupyterPaths(){if(this.platformService.isWindows){let e=process.env.PROGRAMDATA?In(process.env.PROGRAMDATA):void 0;return e?[Pr.Uri.joinPath(Pr.Uri.file(e),"jupyter")]:[]}else return[Pr.Uri.file("/usr/local/share/jupyter"),Pr.Uri.file("/usr/share/jupyter")]}getJupyterDataDir(){if(process.env.JUPYTER_DATA_DIR)return Pr.Uri.file(In(process.env.JUPYTER_DATA_DIR));if(this.platformService.homeDir)switch(this.platformService.osType){case"OSX":return Pr.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");case"Windows":let e=process.env.APPDATA?Pr.Uri.file(In(process.env.APPDATA)):"";if(e)return Pr.Uri.joinPath(e,"jupyter");let t=this.getJupyterConfigDir();return t?Pr.Uri.joinPath(t,"data"):Pr.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");default:{let n=process.env.XDG_DATA_HOME?Pr.Uri.file(In(process.env.XDG_DATA_HOME)):Pr.Uri.joinPath(this.platformService.homeDir,".local","share");return Pr.Uri.joinPath(n,"jupyter")}}}async getKernelSpecRootPaths(e){if(this.cachedKernelSpecRootPaths?.promise&&this.cachedKernelSpecRootPaths.stopWatch.elapsedTime<=6e4)return this.cachedKernelSpecRootPaths.promise;let t=new qe,n=this.getKernelSpecRootPathsImpl(e);this.cachedKernelSpecRootPaths={promise:n,stopWatch:t};let i=e.onCancellationRequested(()=>{this.cachedKernelSpecRootPaths?.promise===n&&(this.cachedKernelSpecRootPaths=void 0)},this);return n.finally(()=>i.dispose()).catch(f),n}async getKernelSpecRootPathsImpl(e){let t=new Dc(await this.getJupyterPathKernelPaths(e));if(e.isCancellationRequested)return[];if(this.platformService.isWindows){let n=await this.getKernelSpecRootPath();if(e.isCancellationRequested)return[];n&&t.add(n),process.env.PROGRAMDATA&&t.add(Pr.Uri.file(Ve(process.env.PROGRAMDATA,"jupyter","kernels")))}else{let n=this.platformService.isMac?l$:c$;t.add(Pr.Uri.file(Ve("/","usr","share","jupyter","kernels"))),t.add(Pr.Uri.file(Ve("/","usr","local","share","jupyter","kernels"))),this.platformService.homeDir&&t.add(sr(this.platformService.homeDir,n))}return E(`Kernel Spec Root Paths, ${Array.from(t).map(n=>W(n)).join(", ")}`),Array.from(t)}async getJupyterPathKernelPaths(e){return this.cachedJupyterKernelPaths=this.cachedJupyterKernelPaths||this.getJupyterPathSubPaths(e,"kernels"),this.cachedJupyterKernelPaths.then(t=>{t.length>0&&this.updateCachedPaths(t).then(f,f)},f),this.getCachedPaths().length>0?this.getCachedPaths():this.cachedJupyterKernelPaths}async getJupyterPaths(e){return this.cachedJupyterPaths=this.cachedJupyterPaths||this.getJupyterPathSubPaths(e),this.cachedJupyterPaths}async getJupyterPathSubPaths(e,t){let n=new Dc,i=await this.envVarsProvider.getEnvironmentVariables(void 0,"RunPythonCode");if(e?.isCancellationRequested)return[];let o=i.JUPYTER_PATH?i.JUPYTER_PATH.split(Jn).map(s=>t?Ve(s,t):s):[];return o.length>0&&(await Promise.all(o.map(async a=>U_(Pr.Uri.file(a))))).forEach(a=>{a&&n.add(a)}),E(`Jupyter Paths ${W(t)}: ${Array.from(n).map(s=>W(s))}`),Array.from(n)}getCachedPaths(){return this.globalState.get(KK,[]).map(e=>Pr.Uri.parse(e))}async updateCachedPaths(e){let t=this.globalState.get(KK,[]),n=e.map(Pr.Uri.toString);t.join(",")!==n.join(",")&&await this.globalState.update(KK,n)}getCachedRootPath(){if(this.globalState.get(j_)){let e=this.globalState.get(j_);if(e)return Pr.Uri.parse(e)}}updateCachedRootPath(e){e?this.globalState.update(j_,e.toString()).then(f,f):this.globalState.update(j_,void 0).then(f,f)}};v([ti("getDataDirsImpl",7),d(1,Tl("id"))],Fr.prototype,"getDataDirsImpl",1),v([d(0,Qu())],Fr.prototype,"getJupyterPathKernelPaths",1),Fr=v([(0,Fs.injectable)(),d(0,(0,Fs.inject)(Er)),d(1,(0,Fs.inject)(kc)),d(2,(0,Fs.inject)(F)),d(3,(0,Fs.inject)($e)),d(3,(0,Fs.named)(St)),d(4,(0,Fs.inject)(gr)),d(5,(0,Fs.inject)(lt)),d(6,(0,Fs.inject)(Kr))],Fr);var qm=class{constructor(e,t,n,i,o,s,a){this.jupyterInterpreter=e;this.interpreterService=t;this.jupyterDependencyService=n;this.pythonExecutionFactory=i;this.jupyterOutputChannel=o;this.jupyterPaths=s;this.activationHelper=a}async refreshCommands(){}async isNotebookSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);return t?this.jupyterDependencyService.areDependenciesInstalled(t,e):!1}async getReasonForJupyterNotebookNotBeingSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t&&(t=await this.interpreterService.getActiveInterpreter(void 0),!t))return y.selectJupyterInterpreter;let n=await this.jupyterDependencyService.getDependenciesNotInstalled(t,e);return n.length===0?"":n.length===1&&n[0]===21?y.jupyterKernelSpecModuleNotFound(t.uri.fsPath):EK(n,t)}async getSelectedInterpreter(e){return this.jupyterInterpreter.getSelectedInterpreter(e)}async startNotebook(e,t){let n=await this.getSelectedInterpreterAndThrowIfNotAvailable(t.token);this.jupyterOutputChannel.appendLine(y.startingJupyterLogMessage(un(n.uri),e.join(" ")));let i=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:n}),o={...t};o.token=void 0;let s=await this.activationHelper.getActivatedEnvironmentVariables(void 0,n)||process.env,a=(process.env.JUPYTER_PATH||s.JUPYTER_PATH||"").split(Jn).filter(l=>l.trim().length);a.push(Ii(await this.jupyterPaths.getKernelSpecTempRegistrationFolder()).fsPath),o.env={...s,JUPYTER_PATH:a.join(Jn)},E(`Start Jupyter Notebook with JUPYTER_PATH=${a.join(Jn)}`),E(`Start Jupyter Notebook with PYTHONPATH=${s.PYTHONPATH||""}`);let c=Object.keys(s).filter(l=>l.toLowerCase()==="path");if(c.length){let l=c.map(u=>`${u}=${s[u]}`).join(",");E(`Start Jupyter Notebook with PATH variable. ${l}`)}else x("Start Jupyter Notebook without a PATH variable");return i.execModuleObservable("jupyter",["notebook"].concat(e),o)}async getRunningJupyterServers(e){let t=await this.getSelectedInterpreterAndThrowIfNotAvailable(e),n=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:t}),i={mergeStdOutErr:!0,token:e},o=Ve($o,"pythonFiles","vscode_datascience_helpers","getServerInfo.py"),s=await n.exec([o],i),a;try{a=JSON.parse(s.stdout.trim())}catch(c){j("Failed to parse JSON when getting server info out from getServerInfo.py",c);return}return a}async installMissingDependencies(e){return this.jupyterInterpreter.installMissingDependencies(e)}async getSelectedInterpreterAndThrowIfNotAvailable(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t){let n=await this.getReasonForJupyterNotebookNotBeingSupported();throw new Xi(n)}return t}};qm=v([(0,Ls.injectable)(),d(0,(0,Ls.inject)(ci)),d(1,(0,Ls.inject)(tt)),d(2,(0,Ls.inject)(Ms)),d(3,(0,Ls.inject)(Kr)),d(4,(0,Ls.inject)(No)),d(4,(0,Ls.named)(ch)),d(5,(0,Ls.inject)(Fr)),d(6,(0,Ls.inject)(Ps))],qm);var W_=_(O());var Jm=class{constructor(e){this.pythonExecutionFactory=e}async exportNotebookToPython(e,t,n,i){let o=await this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t}),s=n?[e.fsPath,"--to","python","--stdout","--template",n]:[e.fsPath,"--to","python","--stdout"];return o.execModule("jupyter",["nbconvert"].concat(s),{throwOnStdErr:!1,encoding:"utf8",token:i}).then(a=>{if(a.stdout==="")throw x("nbconvert zero size output"),new Error(a.stderr);return a.stdout})}};v([bv("ExportNotebookToPython")],Jm.prototype,"exportNotebookToPython",1),Jm=v([(0,W_.injectable)(),d(0,(0,W_.inject)(Kr))],Jm);var eC=_(O());var Qv=class{constructor(e,t){this.installer=e;this.commandFactory=t;this.nbconvertInstalledInInterpreter=new Dc}async isNbConvertInstalled(e,t){if(this.nbconvertInstalledInInterpreter.has(e.uri))return!0;let n=!!await this.installer.isInstalled(22,e)&&!!await this.installer.isInstalled(18,e);return n===!0&&this.nbconvertInstalledInInterpreter.add(e.uri),n}async getNbConvertVersion(e,t){let i=await this.commandFactory.createInterpreterCommand("nbconvert","jupyter",["-m","jupyter","nbconvert"],e,!1).exec(["--version"],{throwOnStdErr:!0});return tP(i.stdout)}};Qv=v([(0,eC.injectable)(),d(0,(0,eC.inject)(Ni)),d(1,(0,eC.inject)(Kv))],Qv);var Gm=_(O());var Yv=require("vscode");var Xp=_(O());var d$=require("vscode");async function Zi(r,e){if(!r)return;let t=fn(r),[n,i]=O_.get(t)||[{resourceType:Hi(r),resourceHash:r?await vt(r.toString()):void 0,kernelSessionId:await vt(Date.now().toString()),capturedEnvVars:void 0,userExecutedCell:void 0,disableUI:void 0,kernelLanguage:void 0,kernelId:void 0,kernelSpecHash:void 0,isUsingActiveInterpreter:void 0,pythonEnvironmentType:void 0,pythonEnvironmentPath:void 0,pythonEnvironmentVersion:void 0,kernelConnectionType:void 0},{previouslySelectedKernelConnectionId:""}];typeof e.capturedEnvVars=="boolean"&&(n.capturedEnvVars=e.capturedEnvVars),e.userExecutedCell&&(n.userExecutedCell=!0),typeof e.disableUI=="boolean"&&(n.disableUI=e.disableUI);let o=e.kernelConnection;if(o){let s=o.id;i.previouslySelectedKernelConnectionId!==s&&(n.userExecutedCell=e.userExecutedCell,n.disableUI=e.disableUI),i.previouslySelectedKernelConnectionId&&i.previouslySelectedKernelConnectionId!==s&&(n.kernelSessionId=await vt(Date.now().toString()));let a;switch(o.kind){case"connectToLiveRemoteKernel":a=o.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":a=o.kernelSpec.language;break;case"startUsingPythonInterpreter":a=xe;break;default:break}let c="kernelSpec"in o&&o.kernelSpec.specFile?vt(o.kernelSpec.specFile):Promise.resolve("");n.kernelLanguage=a,[n.kernelId,n.kernelSpecHash]=await Promise.all([vt(o.id),c]),i.previouslySelectedKernelConnectionId=o.id;let l=o.interpreter;if(l){n.isUsingActiveInterpreter=ba.isActiveWorkspaceInterpreter(r,l),n.pythonEnvironmentType=l.envType;let[u,p]=await Promise.all([vt(Pe(mc(l.uri))),Jh(l)]);n.pythonEnvironmentPath=u,RK.set(n.pythonEnvironmentPath,l),p?n.pythonEnvironmentVersion=`${p.major}.${p.minor}.${p.micro}`:n.pythonEnvironmentVersion=void 0,AK(n)}n.kernelConnectionType=n.kernelConnectionType||o?.kind}else i.previouslySelectedKernelConnectionId="";O_.set(t,[n,i])}async function Yo(r,e){await Zi(r,{kernelConnection:e,userExecutedCell:!0})}var Ca=class{constructor(e,t,n,i,o){this.interpreterService=e;this.envActivation=t;this.envVarsService=n;this.customEnvVars=i;this.configService=o}async getEnvironmentVariables(e,t,n,i){let o=n.env&&Object.keys(n.env).length>0?n.env:void 0,s=(n.language||"").toLowerCase()===xe;if(!t&&n.interpreterPath&&(t=await this.interpreterService.getInterpreterDetails(d$.Uri.file(n.interpreterPath),i).catch(p=>{x("Failed to fetch interpreter information for interpreter that owns a kernel",p)})),i?.isCancellationRequested)return;let[a,c]=await Promise.all([this.customEnvVars.getCustomEnvironmentVariables(e,s?"RunPythonCode":"RunNonPythonCode",i).catch(f),t?this.envActivation.getActivatedEnvironmentVariables(e,t,i).catch(p=>{x("Failed to get env variables for interpreter, hence no variables for Kernel",p)}):void 0]);if(i?.isCancellationRequested)return;await Zi(e,{capturedEnvVars:Object.keys(c||{}).length>0}),!c&&Object.keys(a||{}).length===0&&E("No custom variables nor do we have a conda environment");let l={...process.env};process.platform==="win32"&&(l={},Object.keys(process.env).forEach(p=>{l[p.toUpperCase()]=process.env[p]})),o=o||{},a=a||{};let u={};for(let[p,m]of Object.entries(o||{}))typeof m=="string"&&p$(p,m,process.env)!==m&&(u[p]=m,delete o[p]);s||t?(c=c||a,Object.assign(l,c,o),this.configService.getSettings(void 0).excludeUserSitePackages&&(z(`Adding env Variable PYTHONNOUSERSITE to ${W(t?.uri)}`),l.PYTHONNOUSERSITE="True"),s&&(l.PYDEVD_IPYTHON_COMPATIBLE_DEBUGGING="1")):(this.envVarsService.mergeVariables(o,l),this.envVarsService.mergeVariables(a,l)),E(`Kernel Env Variables for ${n.specFile||n.name}, PATH value is ${l.PATH}`);for(let[p,m]of Object.entries(u))l[p]=p$(p,m,l);return l}};Ca=v([(0,Xp.injectable)(),d(0,(0,Xp.inject)(tt)),d(1,(0,Xp.inject)(Ps)),d(2,(0,Xp.inject)(Pc)),d(3,(0,Xp.inject)(kc)),d(4,(0,Xp.inject)(le))],Ca);var Rfe=/\${([a-zA-Z]\w*)?([^}\w].*)?}/g;function p$(r,e,t){if(!e.includes("$"))return e;let n=!1,i=e;return i=i.replace(Rfe,(o,s,a,c,l)=>c>0&&l[c-1]==="\\"?o:a&&a!==""||!s||s===""?(n=!0,o):t[s]||""),!n&&i!==e&&(E(`${r} value in kernelSpec updated from ${e} to ${i}`),e=i),e.replace(/\\\$/g,"$")}var m$=require("vscode");async function f$(r,e,t){if(!t.interpreter||!_t(t)||!r.kernel||r.kernel.status==="dead"||r.kernel.status==="terminating"||t.kind!=="startUsingLocalKernelSpec"&&t.kind!=="startUsingPythonInterpreter")return;let n=new qe;try{let i=await vn(r.kernel,`import sys as _VSCODE_sys
print(_VSCODE_sys.executable); del _VSCODE_sys`);if(i.length===0)return;let o=i[0];if(o.name!=="stdout"&&o.output_type!=="stream")return;let s=ws(o.text).trim().toLowerCase(),a=Oo(t.interpreter.uri,m$.Uri.file(s));await Zi(e,{interpreterMatchesKernel:a})}catch(i){x(`Failed to compare interpreters after ${n.elapsedTime}ms`,i)}E(`End sendTelemetryForPythonKernelExecutable after ${n.elapsedTime}ms`)}function Afe(r){let e="kernelSpec"in r?r:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!dt(e))return!1;let t=e?e.kernelSpec:r;return V_(t.argv[0])}function $m(r){let e="kernelSpec"in r?r:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!dt(e))return!1;let t=e?e.kernelSpec:r;if(t.language&&t.language.toLowerCase()!==xe||!Afe(r))return!1;let n=t.argv.indexOf("-m");if(n===-1)return!1;let i=t.argv.length-1>=n?t.argv[n+1].toLowerCase():void 0;return i?i.includes("ipykernel_launcher")||i.includes("ipykernel"):!1}function V_(r){return r=De(r).trim().toLowerCase(),r==="python"||r==="python3"||r==="python.exe"||r==="python3.exe"}var Hm=class{constructor(e,t,n,i){this.kernelDependencyService=e;this.fs=t;this.jupyterPaths=n;this.kernelEnvVars=i}async ensureKernelIsUsable(e,t,n,i,o){if(E(`Check if a kernel ${t.id} is usable`),$m(t)&&t.interpreter){let a=await this.kernelDependencyService.installMissingDependencies({resource:e,kernelConnection:t,ui:n,token:i,ignoreCache:!0,cannotChangeKernels:o});switch(a){case 1:case 3:case 2:case 4:throw new Bm(a,t);default:break}}var s=void 0;dt(t)&&(s=t.kernelSpec.specFile,!s||!await this.fs.exists(Yv.Uri.file(s))?s=await this.registerKernel(t,i):t.interpreter&&s&&De(pt(s)).toLowerCase()!=t.kernelSpec.name.toLowerCase()&&(s=await this.registerKernel(t,i)),t.interpreter&&s?(E(`Updating Kernel Environment for ${t.id} for interpreter ${t.interpreter.id}`),await this.updateKernelEnvironment(e,t,s,i)):E(`Not Updating Kernel Environment for ${t.id}`))}async registerKernel(e,t){let n=await this.jupyterPaths.getKernelSpecTempRegistrationFolder();if(!e.kernelSpec||t.isCancellationRequested||!e.kernelSpec.name)return;let i=sr(n,e.kernelSpec.name,"kernel.json");if(await this.fs.exists(i))return z(`Kernel spec file for ${e.id} already exists ${W(i)}`),i.fsPath;let o={...e.kernelSpec};if(e.kernelSpec.specFile&&!Ap(Pe(i),e.kernelSpec.specFile)&&(o.metadata=o.metadata||{},o.metadata={...o.metadata,vscode:{...o.metadata.vscode||{},originalSpecFile:e.kernelSpec.metadata?.vscode?.originalSpecFile||e.kernelSpec.specFile,originalDisplayName:e.kernelSpec.metadata?.vscode?.originalDisplayName||e.kernelSpec.display_name}}),e.interpreter&&(o.metadata={...o.metadata,interpreter:Ol(e.interpreter)}),z(`RegisterKernel for ${e.id} into ${W(i)}`),E(`RegisterKernel for ${e.id} into ${W(i)} with contents ${JSON.stringify(o)}`),await this.fs.writeFile(i,JSON.stringify(o,void 0,4)),t.isCancellationRequested)return;let s=o.metadata?.vscode?.originalSpecFile||o.metadata?.originalSpecFile;if(s){let a=pt(s),c=pt(i.fsPath),l=await this.fs.searchLocal("*.*[^json]",a);await Promise.all(l.map(async u=>{let p=Ve(a,u),m=Ve(c,u);await this.fs.copy(Yv.Uri.file(p),Yv.Uri.file(m))}))}return i.fsPath}async updateKernelEnvironment(e,t,n,i){let o=t.interpreter,s=t.kernelSpec,a=await this.jupyterPaths.getKernelSpecTempRegistrationFolder(),c=s;if(n&&a){let l=De(n).toLowerCase()===s.name.toLowerCase()?n:sr(a,s.name,"kernel.json").fsPath;if(!await this.fs.exists(Yv.Uri.file(l))){j(`Spec file for ${t.id} does not exist ${l} hence not updating env vars.`);return}let u=Yv.Uri.file(l);try{let p=JSON.parse(await this.fs.readFile(u));if(i?.isCancellationRequested||(p.metadata?.interpreter?($m(s)&&(E(`Python KernelSpec argv[0] updated for ${t.id} from '${p.argv[0]}' to '${W(o.uri)}'`),p.argv[0]=o.uri.fsPath),p.metadata=p.metadata||{},p.metadata.interpreter=o):E(`KernelSpec argv[0] not updated for ${t.id} ('${p.argv[0]}')`),p.env=await this.kernelEnvVars.getEnvironmentVariables(e,o,c),p=GV(p),await this.fs.writeFile(u,JSON.stringify(p,void 0,2)),E(`Updated kernel spec for ${t.id} with environment variables for ${W(u)}`),i?.isCancellationRequested))return;c.metadata=p.metadata}catch(p){if(i?.isCancellationRequested)return;throw x(`Failed to update kernel spec for ${t.id} with environment variables for ${W(u)}`,p),p}}else j(`Either Kernel spec file or root spec file path does not exist for ${t.id}.`)}};v([yh("Failed to register an interpreter as a kernel")],Hm.prototype,"registerKernel",1),Hm=v([(0,Gm.injectable)(),d(0,(0,Gm.inject)(Cs)),d(1,(0,Gm.inject)(gr)),d(2,(0,Gm.inject)(Fr)),d(3,(0,Gm.inject)(Ca))],Hm);var tC=_(O());var h$=require("vscode");var Xv=class{constructor(e,t){this.liveKernelConnectionTracker=e;this.providerRegistration=t}async isValid(e){if(!this.liveKernelConnectionTracker.wasKernelUsed(e))return!1;let t=await this.providerRegistration.jupyterCollections.find(i=>i.extensionId===e.serverProviderHandle.extensionId&&i.id===e.serverProviderHandle.id);if(!t)return j(`Extension ${e.serverProviderHandle.extensionId} may have been uninstalled for provider ${e.serverProviderHandle.id}, handle ${e.serverProviderHandle.handle}`),!1;let n=new h$.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(n.token));return i?i.map(o=>o.id).includes(e.serverProviderHandle.handle)?!0:(j(`Hiding remote kernel ${e.id} for ${t.id} as the remote Jupyter Server ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}:${e.serverProviderHandle.handle} is no longer available`),!1):!1}catch(i){return j(`Failed to fetch remote servers from ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}`,i),!1}finally{n.dispose()}}};Xv=v([(0,tC.injectable)(),d(0,(0,tC.inject)(gm)),d(1,(0,tC.inject)(Qt))],Xv);var x$=_(So()),B_=require("vscode"),Us=_(O());var Zv=class extends kn{constructor(e){super("timeout",y.jupyterLaunchTimedOut,e)}};var ey=class{constructor(e,t,n,i,o,s){this.interpreterService=e;this.disposableRegistry=t;this.configuration=i;this.notebookStarter=o;this.jupyterInterpreterService=s;this.disposed=!1;this._disposed=!1;this.disposableRegistry.push(this.interpreterService.onDidChangeInterpreter(()=>this.onSettingsChanged())),this.disposableRegistry.push(this),B_.workspace.onDidChangeConfiguration(a=>{a.affectsConfiguration("python.dataScience",void 0)&&this.onSettingsChanged()},this,this.disposableRegistry),n.push(this)}async dispose(){z("Disposing HostJupyterExecution"),this._disposed||(this._disposed=!0,E("Disposing super HostJupyterExecution"),this.disposed=!0,E("Cleaning up server cache"),await this.cache?.then(e=>e.dispose()).catch(f)),E("Finished disposing HostJupyterExecution")}async startServer(e,t){if(this._disposed)throw new Error("Notebook server is disposed");if(!this.cache){let n=this.cache=this.startJupyterWithRetry(e,t);n.catch(i=>{x("Failed to start the Jupyter Server",i),this.cache===n&&(this.cache=void 0)})}return this.cache}async refreshCommands(){await this.jupyterInterpreterService?.refreshCommands()}async isJupyterServerSupported(e){return this.jupyterInterpreterService?this.jupyterInterpreterService.isNotebookSupported(e):!1}async getJupyterServerError(){return this.jupyterInterpreterService?this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported():y.webNotSupported}async getUsableJupyterPython(e){return!this.usablePythonInterpreter&&!this.disposed&&this.jupyterInterpreterService&&(this.usablePythonInterpreter=await ar(e,this.jupyterInterpreterService.getSelectedInterpreter(e))),this.usablePythonInterpreter}startJupyterWithRetry(e,t){return ar(t,(async()=>{let i,o=1,s=Math.max(1,this.configuration.getSettings(void 0).jupyterLaunchRetries),a;for(;o<=s&&!this.disposed;){try{return i=await this.startImpl(e,t),E("Connection complete server"),i}catch(c){if(a=c,c instanceof Zv&&o<s)z("Retry because of wait for idle problem."),i?.dispose(),o+=1;else throw i&&this.disposed,c}throw a}throw new Error("Max number of attempts reached")})())}async startImpl(e,t){z("Launching server");let n=this.configuration.getSettings(e),i=n.useDefaultConfigForJupyter,o=await Gx(e),s=Is(),a=zh(o,s?sr(s,`${(0,x$.default)()}.txt`):void 0,n);if(!this.notebookStarter)throw new Error("Notebook Starter cannot be undefined");return this.notebookStarter.start(e,i,this.configuration.getSettings(void 0).jupyterCommandLineArguments,B_.Uri.file(a),t)}onSettingsChanged(){this.usablePythonInterpreter=void 0}};ey=v([(0,Us.injectable)(),d(0,(0,Us.inject)(tt)),d(1,(0,Us.inject)(F)),d(2,(0,Us.inject)(ni)),d(3,(0,Us.inject)(le)),d(4,(0,Us.inject)(xP)),d(4,(0,Us.optional)()),d(5,(0,Us.inject)(Jp)),d(5,(0,Us.optional)())],ey);var nC=_(O());var q_=class extends sn{constructor(){super("Python Extension not installed",void 0,"pythonExtension")}};var ty=class{constructor(e,t){this.jupyterServerProvider=e;this.extensionChecker=t;this.startupUi=new Yt(!0)}async connect(e){e.ui.disableUI||(this.startupUi.disableUI=!1);let t=e.ui.onDidChangeDisableUI(()=>{e.ui.disableUI||(this.startupUi.disableUI=!1,t.dispose())});if(e.ui=this.startupUi,this.extensionChecker.isPythonExtensionInstalled)return this.jupyterServerProvider.getOrStartServer(e).finally(()=>t.dispose());throw t.dispose(),this.startupUi.disableUI||await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),new q_}};ty=v([(0,nC.injectable)(),d(0,(0,nC.inject)(cg)),d(1,(0,nC.inject)(ze))],ty);var zm=_(O());var J_=class extends Ye{constructor(){super("nodeonly",y.webNotSupported)}};var ry=class{constructor(e,t){this.jupyterServerHelper=e;this.interpreterService=t}async getOrStartServer(e){if(!this.serverPromise){let t=this.serverPromise=this.startServerImpl(e);t.catch(()=>{t===this.serverPromise&&(this.serverPromise=void 0)})}return this.serverPromise}async startServerImpl(e){let t=this.jupyterServerHelper;if(!t)throw new J_;try{if(E("Checking for server usability."),!await this.checkUsable())throw E("Server not usable (should ask for install now)"),new Xi(y.jupyterNotSupported(await t.getJupyterServerError()));E("Starting notebook server.");let i=await t.startServer(e.resource,e.token);return yn.throwIfCanceled(e.token),i}catch(n){throw e.token?.isCancellationRequested&&mr(n)||await t.refreshCommands(),n}}async checkUsable(){try{return this.jupyterServerHelper?!!await this.jupyterServerHelper.getUsableJupyterPython():!0}catch(e){let t=await this.interpreterService.getActiveInterpreter(void 0);if(t){let n=t.displayName?t.displayName:Pe(t.uri);throw new Error(y.jupyterNotSupportedBecauseOfEnvironment(n,e.toString()))}else throw new Xi(y.jupyterNotSupported(this.jupyterServerHelper?await this.jupyterServerHelper.getJupyterServerError():"Error"))}}};ry=v([(0,zm.injectable)(),d(0,(0,zm.inject)(up)),d(0,(0,zm.optional)()),d(1,(0,zm.inject)(tt))],ry);var C$=_(require("child_process")),tu=_(O()),w$=_(require("os"));var E$=_(So()),iC=require("vscode");var H_=require("vscode");var ny=class extends Ye{constructor(t,n,i){super("jupytercannotbelaunchedwitheroot",t+(n?`
${n}`:""));this.interpreter=i}};var Lfe=new RegExp(Yd.UrlPatternRegEx),$_=class{constructor(e,t,n,i,o,s){this.launchResult=e;this.notebookDir=t;this.rootDir=n;this.getServerInfo=i;this.serviceContainer=o;this.interpreter=s;this.startPromise=ue();this.output="";this.subscriptions=[];this.ready=this.startPromise.promise;let c=o.get(le).getSettings(void 0).jupyterLaunchTimeout;this.launchTimeout=setTimeout(()=>{this.startPromise.completed||this.rejectStartPromise(y.jupyterLaunchTimedOut)},c);let l=0;e.proc&&e.proc.on("exit",u=>l=u||0),this.subscriptions.push(e.out.onDidChange(u=>{E(u.out),this.output+=u.out,Yd.HttpPattern.exec(this.output)&&!this.startPromise.completed&&this.getServerInfo().then(p=>this.getJupyterURL(p,this.output)).catch(p=>j("Failed to get server info",p))})),e.out.done.then(()=>this.rejectStartPromise(y.jupyterServerCrashed(l))).catch(u=>this.rejectStartPromise(u))}dispose(){clearTimeout(this.launchTimeout),Q(this.subscriptions)}getJupyterURL(e,t){if(e&&e.length>0&&!this.startPromise.completed){let n=e.find(i=>Ap(Pe(this.notebookDir),Pe(H_.Uri.file(i.notebook_dir))));if(n){let i=n.url,o=n.token;this.resolveStartPromise(i,o)}}if(!this.startPromise.completed){let i=Lfe.exec(t)?.groups;if(!this.startPromise.completed&&i&&(i.LOCAL||i.IP)){let o=i.LOCAL?i.LOCAL:i.IP,s=`${i.PREFIX}${o}${i.REST}`,a;try{a=new URL(s)}catch(l){x(`Failed to parse ${s}`,l),this.rejectStartPromise(y.jupyterLaunchNoURL);return}let c=a.pathname.endsWith("/tree")?a.pathname.replace("/tree",""):a.pathname;this.resolveStartPromise(`${a.protocol}//${a.host}${c}`,`${a.searchParams.get("token")}`)}}}resolveStartPromise(e,t){if(clearTimeout(this.launchTimeout),!this.startPromise.rejected){let n=this.serviceContainer.get(le),i=this.serviceContainer.get(Fl),o=this.serviceContainer.get(dp),s=XS({handle:"",id:"_builtin.jupyterServerLauncher",extensionId:It},{baseUrl:e,token:t,displayName:JE(t,e)},i,o,n,this.rootDir,new H_.Disposable(()=>this.launchResult.dispose()));this.startPromise.resolve(s)}}rejectStartPromise(e){if(clearTimeout(this.launchTimeout),!this.startPromise.resolved){e=typeof e=="string"?e:e.message;let t,n=this.output;n.includes("Jupyter command `jupyter-notebook` not found")?t=new eu(e,n,this.interpreter):n.includes("Running as root is not recommended. Use --allow-root to bypass")?t=new ny(e,n,this.interpreter):t=new vs(e,n,this.interpreter),this.startPromise.reject(t)}}};var xo=new Set;var iy=class{constructor(e,t,n,i){this.jupyterInterpreterService=e;this.fs=t;this.serviceContainer=n;this.jupyterOutputChannel=i;this.disposables=[]}dispose(){for(;this.disposables.length>0;){let e=this.disposables.shift();try{e&&e.dispose()}catch{}}}async start(e,t,n,i,o){z("Starting Notebook");let s=0,a,c=[],l=ht.reportProgress(e,"NotebookStart");try{let u=this.generateTempDir();u.then(w=>this.disposables.push(w)).catch(f);let p=await this.generateArguments(t,n,u,i.fsPath);yn.throwIfCanceled(o),E("Starting Jupyter Notebook");let[m,h,g]=await Promise.all([this.jupyterInterpreterService.startNotebook(p||[],{throwOnStdErr:!1,encoding:"utf8",token:o}),u,this.jupyterInterpreterService.getSelectedInterpreter(o).catch(()=>{})]);m.proc&&(m.proc.on("exit",w=>s=w),m.out.onDidChange(w=>this.jupyterOutputChannel.append(w.out))),m&&o.onCancellationRequested(()=>{m.dispose()},this,c),E("Waiting for Jupyter Notebook"),a=new $_(m,iC.Uri.file(h.path),i,()=>this.jupyterInterpreterService.getRunningJupyterServers(o),this.serviceContainer,g),yn.throwIfCanceled(o);let b=await ar(o,a.ready);try{let w=parseInt(new URL(b.baseUrl).port||"0",10);w&&!isNaN(w)&&(m.proc&&m.proc.on("exit",()=>xo.delete(w)),xo.add(w))}catch(w){x(`Parsing failed ${b.baseUrl}`,w)}return Q(c),b}catch(u){throw Q(c),mr(u)||u instanceof vs||u instanceof ny||u instanceof eu?u:await this.jupyterInterpreterService.isNotebookSupported()?s!==0?new Error(y.jupyterServerCrashed(s)):sn.from(y.jupyterNotebookFailure(u),u):new Xi(await this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported())}finally{l.dispose(),a?.dispose()}}async generateDefaultArguments(e,t,n){let i=[];i.push(Promise.resolve("--no-browser")),i.push(Promise.resolve(this.getNotebookDirArgument(n))),e&&i.push(this.getConfigArgument(t)),i.push(Promise.resolve("--NotebookApp.iopub_data_rate_limit=10000000000.0"));let[o,s]=await Promise.all([Promise.all(i),this.getDockerArguments()]),a=process.env&&process.env.VSCODE_JUPYTER_DEBUG_JUPYTER?["--debug"]:[];return[...o,...s,...a]}async generateCustomArguments(e){return[...["--no-browser","--NotebookApp.iopub_data_rate_limit=10000000000.0","--KernelManager.autorestart=False"],...e]}async generateArguments(e,t,n,i){return!t||t.length===0?this.generateDefaultArguments(e,n,i):this.generateCustomArguments(t)}getNotebookDirArgument(e){return`--notebook-dir="${e.replace(/\\/g,"\\\\")}"`}async getConfigArgument(e){let t=await e,n=Ve(t.path,"jupyter_notebook_config.py");return await this.fs.writeFile(iC.Uri.file(n),""),z(`Generating custom default config at ${n}`),`--config=${n}`}async getDockerArguments(){let e=[];try{let t=await this.fs.readFile(iC.Uri.file("/proc/self/cgroup")).catch(()=>"");return!t.includes("docker")&&!t.includes("kubepods")?e:(e.push("--ip"),e.push("127.0.0.1"),new Promise(n=>{C$.exec("id",{encoding:"utf-8"},(i,o)=>{o&&o.toString().includes("(root)")&&e.push("--allow-root"),n(e)})}))}catch{return e}}async generateTempDir(){let e=iC.Uri.file(Ve(w$.tmpdir(),(0,E$.default)()));return await this.fs.createDirectory(e),{path:Pe(e),dispose:async()=>{let t=0;for(;t<10;)try{await this.fs.delete(e),t=10}catch{t+=1}}}}};iy=v([(0,tu.injectable)(),d(0,(0,tu.inject)(Jp)),d(1,(0,tu.inject)(st)),d(2,(0,tu.inject)(ut)),d(3,(0,tu.inject)(No)),d(3,(0,tu.named)(ch))],iy);var Gc=require("vscode"),Qm=_(O());var oy=class extends Zt{constructor(t,n){super();this._onDidLoad=this._register(new Gc.EventEmitter);this._onDidChangeUri=this._register(new Gc.EventEmitter);this._onDidRemoveUris=this._register(new Gc.EventEmitter);this._onDidAddUri=this._register(new Gc.EventEmitter);this._all=[];n.push(this),this.newStorage=this._register(new FK(t))}get onDidLoad(){return this._onDidLoad.event}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}get all(){return this.updateStore(),this._all}hookupStorageEvents(){this.storageEventsHooked||(this.storageEventsHooked=!0,this._register(this.newStorage.onDidAdd(t=>this._onDidAddUri.fire(t),this)),this._register(this.newStorage.onDidChange(t=>this._onDidChangeUri.fire(t),this)),this._register(this.newStorage.onDidRemove(t=>this._onDidRemoveUris.fire(t),this)))}updateStore(){this.hookupStorageEvents();let t=this._all;return this._all=this.newStorage.getAll(),(t.length!==this._all.length||JSON.stringify(this._all)!==JSON.stringify(t))&&this._onDidLoad.fire(),this._all}async clear(){this.hookupStorageEvents(),await this.newStorage.clear(),this._all=[],this._onDidLoad.fire()}async add(t,n){this.hookupStorageEvents(),ne(`setUri: ${t.id}.${t.handle}`);let i={time:n?.time??Date.now(),displayName:"",provider:t};await this.newStorage.add(i),this.updateStore()}async update(t){this.hookupStorageEvents(),await this.newStorage.update(t),this.updateStore()}async remove(t){this.hookupStorageEvents(),await this.newStorage.remove(t),this.updateStore()}};oy=v([(0,Qm.injectable)(),d(0,(0,Qm.inject)($e)),d(0,(0,Qm.named)(St)),d(1,(0,Qm.inject)(F))],oy);var FK=class{constructor(e){this.memento=e;this._onDidChangeUri=new Gc.EventEmitter;this._onDidRemoveUris=new Gc.EventEmitter;this._onDidAddUri=new Gc.EventEmitter;this.updatePromise=Promise.resolve();this.mementoKey=`MEMENTO_KEY_FOR_STORING_USED_JUPYTER_PROVIDERS_${Gc.env.machineId}`}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}dispose(){this._onDidAddUri.dispose(),this._onDidChangeUri.dispose(),this._onDidRemoveUris.dispose()}async add(e){return this.updatePromise=this.updatePromise.then(async()=>{let t=this.getAll(),n=t.find(a=>Wt(a.provider)===Wt(e.provider)),o=[{displayName:e.displayName||n?.displayName||Wt(e.provider),serverHandle:e.provider,time:e.time}].concat(t.sort((a,c)=>c.time-a.time).filter(a=>Wt(a.provider)!==Wt(e.provider)).map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}))),s=o.splice(Li.JupyterServerUriListMax);if(await this.memento.update(this.mementoKey,o),n||this._onDidAddUri.fire(e),s.length){let a=s.map(c=>({provider:c.serverHandle,time:c.time,displayName:c.displayName||""}));this._onDidRemoveUris.fire(a.map(c=>c.provider))}this._onDidChangeUri.fire()}).catch(f)}async update(e){let n=this.getAll().find(o=>o.provider.id===e.id&&o.provider.handle===e.handle),i={provider:e,time:Date.now(),displayName:n?.displayName||""};await this.add(i)}async remove(e){await(this.updatePromise=this.updatePromise.then(async()=>{let t=!1;try{let n=this.getAll();if(n.length===0)return;let i=n.filter(s=>s.provider.id!==e.id||s.provider.handle!==e.handle),o=n.filter(s=>s.provider.id===e.id&&s.provider.handle===e.handle);if(i.length===0)await this.clear();else if(o.length){let s=i.map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}));t=!0,await this.memento.update(this.mementoKey,s),this._onDidRemoveUris.fire(o.map(a=>a.provider))}}finally{t||this._onDidRemoveUris.fire([e])}}).catch(t=>x(`Failed to remove Server handle ${JSON.stringify(e)}`,t)))}getAll(){let e=this.memento.get(this.mementoKey,[]),t=[];return e.forEach(async n=>{let i=Wt(n.serverHandle),o={time:n.time,displayName:n.displayName||i,provider:n.serverHandle};t.push(o)}),t}async clear(){let e=this.getAll();await this.memento.update(this.mementoKey,[]),e.length&&this._onDidRemoveUris.fire(e.map(t=>t.provider))}};var Zp=_(O());var G_="removeKernelUrisAndSessionsUsedByResources",sy=class{constructor(e,t,n){this.disposables=e;this.uriStorage=t;this.memento=n;this.usedRemoteKernelServerIdsAndSessions={}}activate(){this.usedRemoteKernelServerIdsAndSessions=this.memento.get(G_,{}),this.uriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}wasKernelUsed(e){let t=Wt(e.serverProviderHandle);return t in this.usedRemoteKernelServerIdsAndSessions&&typeof e.kernelModel.id=="string"&&e.kernelModel.id in this.usedRemoteKernelServerIdsAndSessions[t]}trackKernelIdAsUsed(e,t,n){let i=Wt(t);this.usedRemoteKernelServerIdsAndSessions[i]=this.usedRemoteKernelServerIdsAndSessions[i]||{},this.usedRemoteKernelServerIdsAndSessions[i][n]=this.usedRemoteKernelServerIdsAndSessions[i][n]||[];let o=this.usedRemoteKernelServerIdsAndSessions[i][n];o.includes(e.toString())||(o.push(e.toString()),this.memento.update(G_,this.usedRemoteKernelServerIdsAndSessions).then(f,f))}trackKernelIdAsNotUsed(e,t,n){let i=Wt(t);if(!(i in this.usedRemoteKernelServerIdsAndSessions)||!(n in this.usedRemoteKernelServerIdsAndSessions[i]))return;let o=this.usedRemoteKernelServerIdsAndSessions[i][n];!Array.isArray(o)||!o.includes(e.toString())||(o.splice(o.indexOf(e.toString()),1),o.length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i][n],Object.keys(this.usedRemoteKernelServerIdsAndSessions[i]).length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i],this.memento.update(G_,this.usedRemoteKernelServerIdsAndSessions).then(f,f))}onDidRemoveServers(e){e.forEach(t=>{let n=Wt(t);delete this.usedRemoteKernelServerIdsAndSessions[n],this.memento.update(G_,this.usedRemoteKernelServerIdsAndSessions).then(f,f)})}};sy=v([(0,Zp.injectable)(),d(0,(0,Zp.inject)(F)),d(1,(0,Zp.inject)(er)),d(2,(0,Zp.inject)($e)),d(2,(0,Zp.named)(St))],sy);var ef=_(require("node-fetch")),F5=_(O5());var K5=require("vscode");function mF(r){return class extends r{constructor(...n){super(...n);this._onAnyMessage=new K5.EventEmitter;this.onAnyMessage=this._onAnyMessage.event;this.msgChain=Promise.resolve(),this.sendChain=Promise.resolve(),this.receiveHooks=[],this.sendHooks=[]}patchSuperEmit(n){super.emit=n}send(n,i){this.sendHooks?this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(n,i)))).then(()=>super.send(n,i)):super.send(n,i)}handleEvent(n,i,...o){return i==="message"&&this.receiveHooks.length?(this.msgChain=this.msgChain.then(()=>Promise.all(this.receiveHooks.map(s=>s(o[0])))).then(()=>n(i,...o)).catch(s=>x(`Exception while handling messages: ${s}`)),!0):n(i,...o)}emit(n,...i){return this.handleEvent((o,...s)=>super.emit(o,...s),n,...i)}addReceiveHook(n){this.receiveHooks.push(n)}removeReceiveHook(n){this.receiveHooks=this.receiveHooks.filter(i=>i!==n)}addSendHook(n){this.sendHooks.push(n)}removeSendHook(n){this.sendHooks=this.sendHooks.filter(i=>i!==n)}}}var L5=_(O());var eo=new Map;var ly=class{getRequestCtor(e,t,n){class i extends ef.Request{constructor(s,a){super(s,a);let c=this.headers,l=n();Object.keys(l).forEach(m=>c.append(m,l[m].toString())),c.set("Content-Type","application/json");let p=c.append.bind(c);c.append=(m,h)=>{m.toLowerCase()!=="authorization"&&p(m,h)}}}return n&&Object.keys(n()||{}).length?i:ef.Request}getWebsocketCtor(e,t,n){let i=()=>{let s={},a;if(t&&(s={...s,rejectUnauthorized:!1}),e&&(a={Cookie:e}),n){let c=n();a=a?{...a,...c}:c}return a&&(s={...s,headers:a}),s};class o extends mF(F5.default){constructor(c,l){super(c,l,i());let u,p=/.*\/kernels\/(.*)\/.*/.exec(c);p&&p.length>1&&(this.kernelId=p[1]),this.kernelId?(eo.set(this.kernelId,this),this.on("close",()=>{u&&this.timer!==u&&clearInterval(u),eo.get(this.kernelId)===this&&eo.delete(this.kernelId)})):x("KernelId not extracted from Kernel WebSocket URL"),u=this.timer=setInterval(()=>this.ping(f),3e4)}}return o}wrapWebSocketCtor(e){class t extends mF(e){constructor(o,s,a){super(o,s,a);let c,l=/.*\/kernels\/(.*)\/.*/.exec(o);l&&l.length>1&&(this.kernelId=l[1]),this.kernelId?(eo.set(this.kernelId,this),this.on("close",()=>{c&&this.timer!==c&&clearInterval(c),eo.get(this.kernelId)===this&&eo.delete(this.kernelId)})):x("KernelId not extracted from Kernel WebSocket URL"),c=this.timer=setInterval(()=>this.ping(f),3e4)}}return t}getFetchMethod(){return ef.default}getHeadersCtor(){return ef.Headers}getRequestInit(){return{cache:"no-store",credentials:"same-origin"}}};ly=v([(0,L5.injectable)()],ly);var U5=require("https"),j5=_(O());var uy=class{createHttpRequestAgent(){return new U5.Agent({rejectUnauthorized:!1})}};uy=v([(0,j5.injectable)()],uy);var Zo=_(O());var Xo=require("vscode");var Jhe=["/bin/sh","/bin/bash","/bin/zsh"];function oD(r,e){let t=(r.argv||[]).some(n=>(n=n.toLowerCase(),Jhe.some(i=>n.includes(i))));A("DATASCIENCE.KERNEL_SPEC_LANGUAGE",void 0,{language:r.language,kind:e,usesShell:t})}var py="remoteKernelSpecCache.json";var $he=2e3,sD=class extends Zt{constructor(t,n,i,o,s,a,c,l,u,p){super();this.id=t;this.displayName=n;this.env=i;this.cachedRemoteKernelValidator=o;this.kernelProvider=a;this.serverProviderHandle=c;this.jupyterConnection=l;this.fs=u;this.context=p;this._status="idle";this._onDidChangeStatus=new Xo.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new co;this.kernelIdsToHide=new Set;this.kind="remote";this.cache=[];this._onDidChangeKernels=new Xo.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this._onDidChange=new Xo.EventEmitter;this.onDidChange=this._onDidChange.event;this.numberOfFailures=0;this.cacheFile=Xo.Uri.joinPath(p.globalStorageUri,py),this.cacheKey=Wt(c),this._register(s.registerKernelFinder(this)),this._register(this._onDidChangeKernels.event(()=>this._onDidChange.fire(),this)),this._register(this._onDidChangeKernels),this._register(this._onDidChange),this._register(this._onDidChangeStatus),this._register(this.promiseMonitor)}get status(){return this._status}set status(t){this._status!==t&&(this._status=t,this._onDidChangeStatus.fire())}get lastError(){return this._lastError}get kernels(){return this.cache}get items(){return this.kernels}get title(){return this.displayName}dispose(){super.dispose(),this._cacheUpdateCancelTokenSource?.dispose(),this.kernelDisposeDelayTimer?.dispose()}async activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.loadCache().then(f,f),this._register(this.kernelProvider.onDidStartKernel(t=>{Ft(t.kernelConnectionMetadata)&&this.updateCache().then(f,f)},this)),this._register(this.kernelProvider.onDidDisposeKernel(t=>{if(t&&Ft(t.kernelConnectionMetadata)){this.kernelDisposeDelayTimer?.dispose();let n=setTimeout(()=>{this.updateCache().then(f,f)},$he);return this.kernelDisposeDelayTimer=new Xo.Disposable(()=>clearTimeout(n)),n}},this))}async refresh(){await this.loadCache(!0,!0)}getListOfKernelsWithCachedConnection(t,n=!1){let i=!!this.cachedConnection;return this.cachedConnection=this.cachedConnection||this.getRemoteConnectionInfo(t),this.cachedConnection.then(o=>(this.numberOfFailures=0,o&&!i&&(this.cachedConnection=Promise.resolve(o)),o?this.listKernelsFromConnection(o):Promise.resolve([]))).catch(o=>(this.numberOfFailures+=1,this.isDisposed?Promise.reject(o):this.numberOfFailures>9?(j(`Remote Kernel Finder: ${this.id} has failed to connect 10 times in a row.`,o),Promise.reject(o)):i?this.getListOfKernelsWithCachedConnection(t,n):(this.cachedConnection=void 0,Promise.reject(o))))}async loadCache(t=!1,n=!1){ne(`Remote Kernel Finder load cache Server: ${this.id}`);let i=(async()=>{let o=t?[]:await this.getFromCache(),s=[];if(!t&&Array.isArray(o)&&o.length>0)s=o,this.updateCache().then(f,f),this.loadCache(!0).then(f,f);else try{s=await this.getListOfKernelsWithCachedConnection(n),this._lastError=void 0}catch(a){a instanceof Xo.CancellationError||(x("UniversalRemoteKernelFinder: Failed to get kernels without cache",a),this._lastError=a,this._onDidChange.fire())}await this.writeToCache(s)})();this.promiseMonitor.push(i),await i}async updateCache(){let t=(async()=>{let n=[];this._cacheUpdateCancelTokenSource?.dispose();let i=new Xo.CancellationTokenSource;this._cacheUpdateCancelTokenSource=i;try{n=await this.getListOfKernelsWithCachedConnection(!1)}catch(o){j(`Could not fetch kernels from the ${this.kind} server, falling back to cache: ${o}`),n=await this.getFromCache(i.token),n=n.filter(s=>s.kind==="connectToLiveRemoteKernel")}i.token.isCancellationRequested||await this.writeToCache(n)})();this.promiseMonitor.push(t),await t}async getRemoteConnectionInfo(t=!0){let n=[];return t&&n.push(ht.createProgressReporter(void 0,y.connectingToJupyter)),this.jupyterConnection.createConnectionInfo(this.serverProviderHandle).finally(()=>Q(n))}async getFromCache(t){try{if(t?.isCancellationRequested)throw new Xo.CancellationError;let n=this.cache;(!n||n.length===0)&&(n=await this.getCacheContents());let i=[],o=Promise.all(n.map(async s=>{await this.isValidCachedKernel(s)&&i.push(s)}));return await fr(t,o),i}catch(n){x("UniversalRemoteKernelFinder: Failed to get from cache",n)}return[]}async getCacheContents(){try{let t=await this.fs.readFile(this.cacheFile),n=JSON.parse(t);if(n.extensionVersion!==this.env.extensionVersion)return[];let i=n.data[this.cacheKey]||[];return Array.isArray(i)?i.map(o=>xs.fromJSON(o)):[]}catch{return[]}}async listKernelsFromConnection(t){let n=[];try{let i=fp.create(t.settings);n.push(i);let[o,s,a,c]=await Promise.all([i.getRunningKernels(),i.getKernelSpecs(),i.getRunningSessions(),hV(t.serverProviderHandle)]),l=s.map(m=>(oD(m,"remote"),ex.create({kernelSpec:m,id:Pi(m,void 0,c),baseUrl:t.baseUrl,serverProviderHandle:t.serverProviderHandle})));return[...a.map(m=>{let h=m.kernel,g=h.last_activity?new Date(Date.parse(h.last_activity.toString())):new Date,b=h.connections?parseInt(h.connections.toString(),10):0,w=o.find(D=>D.id===m.kernel?.id)||{},k=s.find(D=>D.name===m.kernel?.name)||{};return ZS.create({kernelModel:{...m.kernel,...k,...w,name:m.kernel?.name||"",lastActivityTime:g,numberOfConnections:b,model:m},baseUrl:t.baseUrl,id:m.kernel?.id||"",serverProviderHandle:t.serverProviderHandle})}).filter(m=>!this.kernelIdsToHide.has(m.kernelModel.id||"")),...l]}catch(i){throw x(`Error fetching kernels from ${t.baseUrl} (${t.displayName}):`,i),i}finally{await Promise.all(n.map(i=>i.dispose().catch(f)))}}async writeToCache(t){try{E(`UniversalRemoteKernelFinder: Writing ${t.length} remote kernel connection metadata to cache`);let n=this.cache,i=new Map(n.map(m=>[m.id,m])),o=new Map(t.map(m=>[m.id,m])),s=t.filter(m=>!i.has(m.id)),a=t.filter(m=>i.has(m.id)&&!Ao(m,i.get(m.id))),c=n.filter(m=>!o.has(m.id)),l=this.cacheKey;this.cache=n.filter(m=>o.has(m.id)).concat(s),this.cache.forEach(m=>{let h=o.get(m.id);m!==h&&h.kind==="connectToLiveRemoteKernel"&&m.kind==="connectToLiveRemoteKernel"&&m.updateModel(h.kernelModel)});let u=t.map(m=>m.toJSON()),p={extensionVersion:this.env.extensionVersion,data:{}};try{let m=await this.fs.readFile(this.cacheFile),h=JSON.parse(m);h.extensionVersion===this.env.extensionVersion&&(p=h)}catch{}p.data[l]=u,await this.fs.createDirectory(this.context.globalStorageUri).then(()=>this.fs.writeFile(this.cacheFile,JSON.stringify(p))).catch(m=>{x("Failed to cache the remote kernels.",m)}),(s.length||a.length||c.length)&&this._onDidChangeKernels.fire({removed:c})}catch(n){x("UniversalRemoteKernelFinder: Failed to write to cache",n)}}async isValidCachedKernel(t){switch(t.kind){case"startUsingRemoteKernelSpec":return!1;case"connectToLiveRemoteKernel":return this.cachedRemoteKernelValidator.isValid(t)}}};var aD=require("vscode");var su=class{constructor(e,t,n,i,o,s,a,c,l,u){this.serverUriStorage=e;this.env=t;this.cachedRemoteKernelValidator=n;this.kernelFinder=i;this.kernelProvider=o;this.jupyterConnection=s;this.disposables=a;this.fs=c;this.context=l;this.jupyterServerProviderRegistry=u;this.serverFinderMapping=new Map;this.handledProviders=new WeakSet;this.mappedProviders=new WeakSet;this.mappedServers=new Set}activate(){this.serverUriStorage.onDidAdd(e=>this.validateAndCreateFinder(e),this,this.disposables),this.serverUriStorage.onDidChange(this.buildListOfFinders,this,this.disposables),this.serverUriStorage.onDidLoad(this.handleProviderChanges,this,this.disposables),this.serverUriStorage.onDidLoad(this.buildListOfFinders,this,this.disposables),this.jupyterServerProviderRegistry.onDidChangeCollections(this.handleProviderHandleChanges,this,this.disposables),this.serverUriStorage.onDidRemove(this.urisRemoved,this,this.disposables),this.jupyterServerProviderRegistry.onDidChangeCollections(this.handleProviderChanges,this,this.disposables),this.buildListOfFinders(),this.handleProviderChanges().catch(f)}buildListOfFinders(){this.serverUriStorage.all.map(e=>this.validateAndCreateFinder(e).catch(f))}handleProviderHandleChanges(){this.jupyterServerProviderRegistry.jupyterCollections.forEach(e=>{this.handledProviders.has(e)||(this.handledProviders.add(e),e.serverProvider.onDidChangeServers&&e.serverProvider.onDidChangeServers(this.buildListOfFinders,this,this.disposables))}),this.buildListOfFinders()}async handleProviderChanges(){if(!this.serverUriStorage.all.length)return;let e=new aD.CancellationTokenSource;this.disposables.push(e),await Promise.all(this.jupyterServerProviderRegistry.jupyterCollections.map(t=>{let n=t.serverProvider;if(!(!n||this.mappedProviders.has(n)))return this.mappedProviders.add(n),n?.onDidChangeServers&&n?.onDidChangeServers(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.serverUriStorage.onDidLoad(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.lookForServersInCollectionAndRemoveOldServers(t).catch(f)})),e.dispose()}async lookForServersInCollectionAndRemoveOldServers(e){if(!this.serverUriStorage.all.length)return;let t=new Set(this.serverUriStorage.all.map(o=>Wt(o.provider))),n=e.serverProvider;if(!n)return;let i=new aD.CancellationTokenSource;try{let o=await Promise.resolve(n.provideJupyterServers(i.token)),s=new Set;(o||[]).forEach(a=>{let c={extensionId:e.extensionId,handle:a.id,id:e.id},l=Wt(c);s.add(l),K_(c,a.label),!(this.mappedServers.has(l)||!t.has(l))&&(this.mappedServers.add(l),this.createRemoteKernelFinder(c,a.label))}),this.serverFinderMapping.forEach((a,c)=>{a.serverProviderHandle.extensionId===e.extensionId&&a.serverProviderHandle.id===e.id&&!s.has(Wt(a.serverProviderHandle))&&(a.dispose(),this.serverFinderMapping.delete(c))})}catch(o){x(`Failed to get servers for Collection ${e.id} in ${e.extensionId}`,o)}finally{i.dispose()}}async validateAndCreateFinder(e){let t=Wt(e.provider);if(this.serverFinderMapping.has(t))return;let n=new aD.CancellationTokenSource,i=async()=>{let s=this.jupyterServerProviderRegistry.jupyterCollections.find(l=>l.extensionId===e.provider.extensionId&&l.id===e.provider.id);if(!s||!s.serverProvider)return;let c=(await Promise.resolve(s.serverProvider.provideJupyterServers(n.token)))?.find(l=>l.id===e.provider.handle)?.label;c&&this.createRemoteKernelFinder(e.provider,c)},o=async()=>{let s=await this.jupyterServerProviderRegistry.jupyterCollections.find(a=>a.extensionId===e.provider.extensionId&&a.extensionId===Ba&&a.id===e.provider.id)?.label;s&&this.createRemoteKernelFinder(e.provider,s)};await Promise.all([i().catch(f),o().catch(f)]),n.dispose()}getOrCreateRemoteKernelFinder(e,t){let n=Wt(e);if(!this.serverFinderMapping.has(n)){let i=new sD(`remote-${n}`,t,this.env,this.cachedRemoteKernelValidator,this.kernelFinder,this.kernelProvider,e,this.jupyterConnection,this.fs,this.context);this.disposables.push(i),this.serverFinderMapping.set(n,i),i.activate().then(f,f)}return this.serverFinderMapping.get(n)}createRemoteKernelFinder(e,t){this.getOrCreateRemoteKernelFinder(e,t)}urisRemoved(e){e.forEach(t=>{let n=Wt(t),i=this.serverFinderMapping.get(n);i&&i.dispose(),this.serverFinderMapping.delete(n)})}dispose(){this.serverFinderMapping.forEach(e=>e.dispose())}};v([Mr("Handle Jupyter Provider Changes")],su.prototype,"handleProviderChanges",1),v([Mr("Check Servers in Jupyter Server Provider")],su.prototype,"lookForServersInCollectionAndRemoveOldServers",1),v([Mr("Failed to create a Remote Kernel Finder")],su.prototype,"validateAndCreateFinder",1),su=v([(0,Zo.injectable)(),d(0,(0,Zo.inject)(er)),d(1,(0,Zo.inject)(Rc)),d(2,(0,Zo.inject)(CP)),d(3,(0,Zo.inject)(Rr)),d(4,(0,Zo.inject)(Ke)),d(5,(0,Zo.inject)(cn)),d(6,(0,Zo.inject)(F)),d(7,(0,Zo.inject)(st)),d(8,(0,Zo.inject)(lt)),d(9,(0,Zo.inject)(Qt))],su);var rd=_(O());var gy=require("vscode");var gD=_(So());var Zc=_(O());var cD=class extends Ye{constructor(t){super("localjupyterserverconnection",y.jupyterNotebookFailure(t.message||t.toString()));this.originalError=t}};function my(r){if(Tr()){let e=r;if(e&&e._futures){let t=e._futures;t.forEach&&t.forEach(n=>{n._status!==void 0&&(n._status|=4)})}e&&e._reconnectLimit&&(e._reconnectLimit=0)}}var dy=class extends sn{constructor(e){super(e.message,e)}};var lC=require("vscode");var tf=class extends kn{constructor(e){super("invalidkernel",y.kernelInvalid(mt(e)),e)}};async function fy(r,e,t,n,i){if(!t.kernel)throw new tf(r);let o=ht.reportProgress(e,y.waitingForJupyterSessionToBeIdle),s=[];o&&s.push(o);try{E(`Waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`);let a=ue();i.onCancellationRequested(()=>a.reject(new lC.CancellationError),void 0,s);let c=(m,h)=>{E(`Got status ${h} in waitForIdleOnSession`),h=="idle"&&a.resolve(h)};t.kernel.statusChanged?.connect(c),s.push(new lC.Disposable(()=>An(()=>t.kernel?.statusChanged?.disconnect(c)))),t.kernel.status=="idle"&&a.resolve(t.kernel.status);let l=ue(),u=()=>l.resolve("");t.disposed.connect(u,l),s.push(new lC.Disposable(()=>An(()=>t.disposed.disconnect(u,l)))),l.promise.catch(f),a.promise.catch(f);let p=await pr(n,"",a.promise,l.promise);if(t.isDisposed)throw x("Session disposed while waiting for session to be idle."),new tf(r);if(E(`Finished waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),p=="idle")return;throw x(`Shutting down after failing to wait for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),new Zv(r)}catch(a){throw ne("Error waiting for idle",a),a}finally{Q(s)}}var hD=require("vscode");var Xc=_(dD()),mD=require("vscode");var hy=class{constructor(e,t){this.kind=e;this.session=t;this.propertyChanged=new Xc.Signal(this);this.kernelChanged=new Xc.Signal(this);this.statusChanged=new Xc.Signal(this);this.connectionStatusChanged=new Xc.Signal(this);this.iopubMessage=new Xc.Signal(this);this.unhandledMessage=new Xc.Signal(this);this.anyMessage=new Xc.Signal(this);this.disposables=[];this.disposed=new Xc.Signal(this);this._disposed=new mD.EventEmitter;this.didShutdown=new mD.EventEmitter;this._onDidKernelSocketChange=new mD.EventEmitter;t.propertyChanged.connect(this.onPropertyChanged,this),t.kernelChanged.connect(this.onKernelChanged,this),t.statusChanged.connect(this.onStatusChanged,this),t.connectionStatusChanged.connect(this.onConnectionStatusChanged,this),t.iopubMessage.connect(this.onIOPubMessage,this),t.unhandledMessage.connect(this.onUnhandledMessage,this),t.anyMessage.connect(this.onAnyMessage,this),this.disposables.push({dispose:()=>{this.didShutdown.dispose(),this._disposed.dispose(),this.session.propertyChanged.disconnect(this.onPropertyChanged,this),this.session.kernelChanged.disconnect(this.onKernelChanged,this),this.session.statusChanged.disconnect(this.onStatusChanged,this),this.session.connectionStatusChanged.disconnect(this.onConnectionStatusChanged,this),this.session.iopubMessage.disconnect(this.onIOPubMessage,this),this.session.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.session.anyMessage.disconnect(this.onAnyMessage,this)}})}get id(){return this.session.id}get path(){return this.session.path}get name(){return this.session.name}get type(){return this.session.type}get serverSettings(){return this.session.serverSettings}get model(){return this.session.model}get kernel(){return this.isDisposed||!this.session.kernel?null:this.session.kernel}get isDisposed(){return this._isDisposed===!0}get onDidDispose(){return this._disposed.event}get onDidShutdown(){return this.didShutdown.event}get kernelId(){return this.session?.kernel?.id||""}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}async disposeAsync(){this.dispose()}dispose(){this.disposeInvoked||(this.statusChanged.emit("dead"),this._disposed.fire(),this.disposed.emit(),this.previousAnyMessageHandler?.dispose(),Q(this.disposables),Xc.Signal.disconnectAll(this))}async restart(){await this.session.kernel?.restart(),this.initializeKernelSocket(),z(`Restarted ${this.session?.kernel?.id}`)}initializeKernelSocket(){if(!this.session.kernel)throw new Error("Kernel not initialized in Session");let e={kernel:this.session.kernel,options:{clientId:this.session.kernel.clientId,id:this.session.kernel.id,model:{...this.session.kernel.model},userName:this.session.kernel.username},socket:eo.get(this.session.kernel.id)};JSON.stringify(this.previousKernelSocketInformation?.kernel.model)===JSON.stringify(e.kernel.model)&&this.previousKernelSocketInformation?.kernel===e.kernel&&this.previousKernelSocketInformation?.kernel.id===e.kernel.id&&this.previousKernelSocketInformation?.socket===e.socket||(this.previousKernelSocketInformation=e,this.previousAnyMessageHandler?.dispose(),this.session.kernel?.connectionStatusChanged.disconnect(this.onKernelConnectionStatusHandler,this),this.session.kernel?.connectionStatusChanged.connect(this.onKernelConnectionStatusHandler,this),this._onDidKernelSocketChange.fire())}onPropertyChanged(e,t){this.propertyChanged.emit(t)}onKernelChanged(e,t){this.kernelChanged.emit(t)}onStatusChanged(e,t){this.statusChanged.emit(t);let n=this.status;ne(`Server Status = ${n}`)}onConnectionStatusChanged(e,t){this.connectionStatusChanged.emit(t)}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onUnhandledMessage(e,t){j(`Unhandled message found: ${t.header.msg_type}`),this.unhandledMessage.emit(t)}onAnyMessage(e,t){this.anyMessage.emit(t)}setPath(e){return this.session.setPath(e)}setName(e){return this.session.setName(e)}setType(e){return this.session.setType(e)}changeKernel(e){return this.session.changeKernel(e)}onKernelConnectionStatusHandler(e,t){ne(`Server Kernel Status = ${t}`)}};var fD=class extends hy{constructor(t,n,i,o,s){super(dt(i)?"localJupyter":"remoteJupyter",t);this.resource=n;this.kernelConnectionMetadata=i;this.kernelService=o;this.creator=s;this.initializeKernelSocket()}get status(){return this.isDisposed?"dead":this.session?.kernel?this.session.kernel.status:(ne(`Kernel status not started because real session is ${this.session?"defined":"undefined"} & real kernel is ${this.session?.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!1).catch(f)}async disposeAsync(){await this.shutdownImplementation(!1).catch(f),await super.disposeAsync()}async waitForIdle(t,n){try{await fy(this.kernelConnectionMetadata,this.resource,this.session,t,n)}catch(i){throw ne("Error waiting for idle",i),await this.shutdown().catch(f),i}}async restart(){let t=[],n=new hD.CancellationTokenSource;this.restartToken=n;let i=new Yt(!1);t.push(i),t.push(n);try{await this.validateLocalKernelDependencies(n.token,i),await super.restart()}finally{Q(t)}}async validateLocalKernelDependencies(t,n){if(!(!this.kernelConnectionMetadata?.interpreter||!dt(this.kernelConnectionMetadata)||!this.kernelService)){if(t.isCancellationRequested)throw new hD.CancellationError;await this.kernelService.ensureKernelIsUsable(this.resource,this.kernelConnectionMetadata,n,t,this.creator==="3rdPartyExtension")}}async shutdown(){return this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!0)}async shutdownImplementation(t){if(this._isDisposed)return;this._isDisposed=!0;let n=(new Error().stack||"").split(`
`).filter(o=>o.includes(It));E(`Shutdown session - current session, called from 
 ${n.map(o=>`    ${o}`).join(`
`)}`);let i=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata.id}`;E(`shutdownSession ${i} - start`);try{if(t||this.canShutdownSession())try{E(`Session can be shutdown ${this.kernelConnectionMetadata.id}`),my(this.session.kernel),this.session.isDisposed||await pr(1e3,this.session.shutdown().catch(f))}catch{try{this.session.isDisposed||this.session.dispose()}catch(o){j("Failures in disposing the session",o)}}finally{this.didShutdown.fire()}else E(`Session cannot be shutdown ${this.kernelConnectionMetadata.id}`);try{this.session.isDisposed||this.session.dispose()}catch(o){j("Failures in disposing the session",o)}super.dispose(),E("Shutdown session -- complete")}catch(o){j("Failures in disposing the session",o)}E(`shutdownSession ${i} - shutdown complete`)}canShutdownSession(){return dt(this.kernelConnectionMetadata)?!0:this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?!1:this.resource&&Hi(this.resource)==="interactive"?!0:!(this.resource&&Hi(this.resource)==="notebook"&&Ft(this.kernelConnectionMetadata))}};var au=class{constructor(e,t,n,i,o){this.jupyterNotebookProvider=e;this.jupyterConnection=t;this.asyncDisposables=n;this.kernelService=i;this.configService=o}async create(e){let t=[],n,i=()=>{e.ui.disableUI||n||(n=ht.createProgressReporter(e.resource,Ft(e.kernelConnection)?y.connectingToJupyter:y.startingJupyter),t.push(n))};e.ui.disableUI&&e.ui.onDidChangeDisableUI(i,this,t),i();let o,s=[],a=this.configService.getSettings(e.resource).jupyterLaunchTimeout;try{o=Ft(e.kernelConnection)?await ar(e.token,this.jupyterConnection.createConnectionInfo(e.kernelConnection.serverProviderHandle)):await this.jupyterNotebookProvider.getOrStartServer({resource:e.resource,token:e.token,ui:e.ui}),await ar(e.token,this.validateLocalKernelDependencies(e));let c=fp.create(o.settings);this.asyncDisposables.push(c),s.push(new gy.Disposable(()=>c.dispose().catch(f))),await ar(e.token,this.validateRemoteServer(e,c));let l=await this.connectToOrCreateSession({...e,contentsManager:c.contentsManager,sessionManager:c.sessionManager,kernelManager:c.kernelManager,kernelSpecManager:c.kernelSpecManager,idleTimeout:a,connection:o});e.token.isCancellationRequested&&(await l.shutdown().catch(f),An(()=>l.dispose())),yn.throwIfCanceled(e.token),z(`Started session for kernel ${e.kernelConnection.kind}:${e.kernelConnection.id}`);let u=new fD(l,e.resource,e.kernelConnection,this.kernelService,e.creator),p=l.disposed,m=()=>{c.dispose().catch(f),p.disconnect(m)};this.asyncDisposables.push({dispose:()=>u.shutdown().finally(()=>u.dispose())}),l.disposed.connect(m);let h=u.onDidDispose(m);return this.asyncDisposables.push(h),u}catch(c){throw Q(s),Ft(e.kernelConnection)?o?Uo.isSelfCertsError(c)?new Uo(o.baseUrl):xc.isSelfCertsExpiredError(c)?new xc(o.baseUrl):new ki(o.baseUrl,e.kernelConnection.serverProviderHandle,c):c:c instanceof Ye?c:new cD(c)}finally{Q(t)}}async validateRemoteServer(e,t){if(t.isDisposed)throw new gn;if(!dt(e.kernelConnection))try{await Promise.all([t.getRunningKernels(),t.getKernelSpecs()])}catch(n){throw x("Failed to fetch running kernels from remote server, connection may be outdated or remote server may be unreachable",n),new ki(e.kernelConnection.baseUrl,e.kernelConnection.serverProviderHandle,n)}}async validateLocalKernelDependencies(e){if(e.token.isCancellationRequested)throw new gy.CancellationError;e.kernelConnection?.interpreter&&dt(e.kernelConnection)&&this.kernelService&&await this.kernelService.ensureKernelIsUsable(e.resource,e.kernelConnection,e.ui,e.token,e.creator==="3rdPartyExtension")}async connectToOrCreateSession(e){if(e.token.isCancellationRequested)throw new gy.CancellationError;let t;try{if(e.kernelConnection&&e.kernelConnection.kind==="connectToLiveRemoteKernel"&&e.kernelConnection.kernelModel.id&&e.kernelConnection.kernelModel.model){if(!e.kernelConnection.kernelModel.model)throw new Error("Kernel model not defined when connecting to an existing session");t=e.sessionManager.connectTo({...e.kernelConnection.kernelModel,model:e.kernelConnection.kernelModel.model}),await ar(e.token,Dw(async()=>t.kernel?.connectionStatus==="connected"||e.token.isCancellationRequested,e.idleTimeout,100))}else E(`createNewKernelSession ${e.kernelConnection?.id}`),t=await this.createNewSession(e),await fy(e.kernelConnection,e.resource,t,e.idleTimeout,e.token).catch(f);if(e.token.isCancellationRequested)throw new gy.CancellationError;return t}catch(n){let i=e.ui.disableUI?E:x;throw n instanceof Ye?(i("Failed to change kernel, re-throwing",n),n):(i("Failed to change kernel",n),new tf(e.kernelConnection))}}async createNewSession(e){let t=(e.connection,e.resource,void 0),n=t?.path,i=ng(e.kernelConnection)??e.kernelSpecManager?.specs?.default??"",o;if(t?.name)o=t.name;else{let a=e.resource?zu(e.resource):"";o=`${e.resource?hn(e.resource,a):""}-${(0,gD.default)()}${a}`}let s={path:n||zhe(e.resource),kernel:{name:i},name:o,type:(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console"};try{let a=await ar(e.token,e.sessionManager.startNew(s,{kernelConnectionOptions:{handleComms:!0}}));if(!a.kernel)throw new dy(new Error("No kernel created"));return z(y.createdNewKernel(e.connection.baseUrl,a?.kernel?.id||"")),a}catch(a){throw a instanceof dy?a:new dy(a)}}};au=v([(0,Zc.injectable)(),d(0,(0,Zc.inject)(cg)),d(1,(0,Zc.inject)(cn)),d(2,(0,Zc.inject)(ni)),d(3,(0,Zc.inject)(SP)),d(3,(0,Zc.optional)()),d(4,(0,Zc.inject)(le))],au);function Ghe(){return`${rg}${(0,gD.default)()}`}function zhe(r){let e=`${Ghe()}${(0,gD.default)()}.ipynb`;return r?`${hn(r,".ipynb")}${e}`:`${y.defaultNotebookName}${e}`}var vy=class{constructor(e,t,n){this.rawKernelSupported=e;this.newRawKernelSessionFactory=t;this.newJupyterSessionFactory=n}async create(e){let t=e.kernelConnection;return this.rawKernelSupported.isSupported&&dt(t)&&this.newRawKernelSessionFactory?this.newRawKernelSessionFactory.create({...e,kernelConnection:t}):this.newJupyterSessionFactory.create(e)}};vy=v([(0,rd.injectable)(),d(0,(0,rd.inject)(li)),d(1,(0,rd.inject)(A_)),d(1,(0,rd.optional)()),d(2,(0,rd.inject)(au))],vy);var uC=Symbol("RemoteKernelFinderController");function $5(r,e){r.add(Kv,Gv),r.addSingleton(be,zv),r.addSingleton(be,Fv),r.addSingleton(up,ey),r.addSingleton(Ms,Ms),r.addSingleton(ag,Qv),r.addSingleton(IP,Jm),r.addSingleton(Zl,Zl),r.addSingleton(ci,ci),r.addSingleton(Sa,Sa),r.addSingleton(fa,fa),r.addSingleton(SP,Hm),r.addSingleton(cg,ry),r.addSingleton(pp,qm),r.addSingleton(Jp,qm),r.addSingleton(er,oy),r.addSingleton(xP,iy),r.addSingleton(zE,ty),r.addSingleton(tx,vy),r.addSingleton(au,au),r.addSingleton(Fl,ly),r.addSingleton(dp,uy),r.addSingleton(cn,cn),r.addSingleton(gm,sy),r.addBinding(gm,be),r.addSingleton(CP,Xv),r.addSingleton(Yr,Hv),r.addSingleton(uC,su),r.addBinding(uC,be),r.addSingleton(Qt,ug)}var rf=_(O()),es=require("vscode");var yy=class{constructor(e,t,n,i){this.disposableRegistry=e;this.kernelProvider=t;this.serverUriStorage=n;this.jupyterUriProviderRegistration=i;this.kernelsStartedSuccessfully=new WeakSet;this.kernelConnectionToKernelMapping=new WeakMap;this.kernelsRestarting=new WeakSet;this.kernelReconnectProgress=new WeakMap;this.lastExecutedCellPerKernel=new WeakMap}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(es.notebooks.onDidChangeNotebookCellExecutionState(e=>{if(!Tt(e.cell.notebook)||e.state!==es.NotebookCellExecutionState.Idle)return;let t=this.kernelProvider.get(e.cell.notebook);!t||this.lastExecutedCellPerKernel.get(t)!==e.cell||this.lastExecutedCellPerKernel.delete(t)}))}onDidStartKernel(e){if(!this.kernelsStartedSuccessfully.has(e)){if(this.kernelProvider.getKernelExecution(e).onPreExecute(t=>this.lastExecutedCellPerKernel.set(e,t),this,this.disposableRegistry),!e.session?.kernel)return;this.kernelsStartedSuccessfully.add(e),this.kernelConnectionToKernelMapping.set(e.session.kernel,e),e.session?.kernel?.connectionStatusChanged.connect(this.onKernelStatusChanged,this),e.onDisposed(()=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this,this.disposableRegistry),e.addHook("willRestart",async()=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),this.kernelsRestarting.add(e)},this,this.disposableRegistry),e.onRestarted(()=>this.kernelsRestarting.delete(e),this,this.disposableRegistry)}}onKernelStatusChanged(e,t){let n=this.kernelConnectionToKernelMapping.get(e);if(n&&!this.kernelsRestarting.has(n))switch(t){case"connected":{this.kernelReconnectProgress.get(n)?.dispose(),this.kernelReconnectProgress.delete(n);return}case"disconnected":{this.kernelReconnectProgress.has(n)&&(this.kernelReconnectProgress.get(n)?.dispose(),this.kernelReconnectProgress.delete(n),this.onKernelDisconnected(n)?.catch(f));return}case"connecting":this.kernelReconnectProgress.has(n)||this.onKernelConnecting(n)?.catch(f);return;default:return}}async onKernelConnecting(e){let t=ue(),n=new es.Disposable(()=>t.resolve());if(this.kernelReconnectProgress.set(e,n),Ft(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata))return;let i=y.automaticallyReconnectingToAKernelProgressMessage(mt(e.kernelConnectionMetadata));es.window.withProgress({location:es.ProgressLocation.Notification,title:i},async()=>t.promise).then(f,f),this.disposableRegistry.push(n)}async onKernelDisconnected(e){if(e.disposed||e.disposing||(Rt(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),Ft(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata)))return;let t=dt(e.kernelConnectionMetadata)?y.kernelDisconnected(mt(e.kernelConnectionMetadata)):y.remoteJupyterConnectionFailedWithServer(e.kernelConnectionMetadata.baseUrl);es.window.showErrorMessage(t).then(f,f);try{let n=this.lastExecutedCellPerKernel.get(e);if(!n||n.document.isClosed||n.notebook.isClosed||n.executionSummary?.success===!1)return;await ap(n,e.controller,t,!1)}finally{await e.dispose()}}async handleRemoteServerShutdown(e,t){let n=this.jupyterUriProviderRegistration.jupyterCollections.find(o=>o.extensionId===t.serverProviderHandle.extensionId&&o.id===t.serverProviderHandle.id);if(!n)return!1;let i=new es.CancellationTokenSource;try{return(await Promise.resolve(n.serverProvider.provideJupyterServers(i.token))||[]).map(a=>a.id).includes(t.serverProviderHandle.handle)?!1:(await this.serverUriStorage.remove(t.serverProviderHandle),this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),!0)}catch{return!1}finally{i.dispose()}}};yy=v([(0,rf.injectable)(),d(0,(0,rf.inject)(F)),d(1,(0,rf.inject)(Ke)),d(2,(0,rf.inject)(er)),d(3,(0,rf.inject)(Qt))],yy);var pC=_(O());var by=class{constructor(e,t){this.disposableRegistry=e;this.kernelProvider=t;this.kernelsStartedSuccessfully=new WeakSet;this.kernelRestartProgress=new WeakMap}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this))}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e)}onKernelStatusChanged({kernel:e}){if(!(!this.kernelsStartedSuccessfully.has(e)||!e.session||e.session.kind==="localRaw"))if(e.status==="autorestarting"){let t=ht.createProgressReporter(e.resourceUri,y.restartingKernelStatus(mt(e.kernelConnectionMetadata)));this.kernelRestartProgress.set(e,t)}else e.status!=="starting"&&e.status!=="busy"&&e.status!=="unknown"&&this.kernelRestartProgress.has(e)&&(this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e))}};by=v([(0,pC.injectable)(),d(0,(0,pC.inject)(F)),d(1,(0,pC.inject)(Ke))],by);var dC=_(O()),fF=require("vscode");var nf=class{constructor(e,t){this.disposableRegistry=e;this.kernelProvider=t;this.lastExecutedCellPerKernel=new WeakMap;this.kernelsStartedSuccessfully=new WeakSet}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry)}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e),this.kernelProvider.getKernelExecution(e).onPreExecute(t=>this.lastExecutedCellPerKernel.set(e,t),this,this.disposableRegistry)}async onKernelStatusChanged({kernel:e}){this.kernelsStartedSuccessfully.has(e)&&(e.disposed||e.disposing||!e.session||(e.session.kind==="localRaw"&&e.status==="dead"&&(fF.window.showErrorMessage(y.kernelDiedWithoutError(mt(e.kernelConnectionMetadata))).then(f,f),await this.endCellAndDisplayErrorsInCell(e)),e.session.kind!=="localRaw"&&e.status==="autorestarting"&&(fF.window.showErrorMessage(y.kernelDiedWithoutErrorAndAutoRestarting(mt(e.kernelConnectionMetadata))).then(f,f),await this.endCellAndDisplayErrorsInCell(e))))}async endCellAndDisplayErrorsInCell(e){let t=this.lastExecutedCellPerKernel.get(e);if(Rt(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),!!t)return ap(t,e.controller,y.kernelCrashedDueToCodeInCurrentOrPreviousCell,!1)}};v([Mr()],nf.prototype,"onKernelStatusChanged",1),nf=v([(0,dC.injectable)(),d(0,(0,dC.inject)(F)),d(1,(0,dC.inject)(Ke))],nf);var cu=_(O()),id=require("vscode");var nd=class{constructor(e,t,n,i){this.installer=e;this.memento=t;this.rawSupport=n;this.serviceContainer=i;this.installPromises=new Map}async installMissingDependencies({resource:e,kernelConnection:t,ui:n,token:i,ignoreCache:o,cannotChangeKernels:s,installWithoutPrompting:a}){if(!dt(t)||!_t(t)||!t.interpreter)return 0;z(`Check & install missing Kernel dependencies for ${W(t.interpreter?.uri)}, ui.disabled=${n.disableUI} for resource '${W(e)}'`);let c=async()=>{if(await ht.wrapAndReportProgress(e,y.validatingKernelDependencies,()=>this.areDependenciesInstalled(t,i,o)))return 0;if(i?.isCancellationRequested)return 1};if(!a){let h=await c();if(h===0||h===1)return h}let l=fn(t.interpreter.uri),u=this.installPromises.get(l),p;if(!u){let h=new id.CancellationTokenSource,g=i.onCancellationRequested(()=>{h.cancel(),g.dispose()});u=ht.wrapAndReportProgress(e,y.installingMissingDependencies,async()=>{if(a){let b=await c();if(b===0||b===1)return b}return this.runInstaller(e,t.interpreter,n,h,s,a)}),u.finally(()=>{g.dispose(),h.dispose()}).catch(f),this.installPromises.set(l,u)}let m=2;try{m=await u,(p?.token?.isCancellationRequested||i.isCancellationRequested)&&(m=1)}catch(h){ne("Failed to install kernel dependency",h),m=2}finally{this.installPromises.delete(l)}return m}async areDependenciesInstalled(e,t,n){if(e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"||e.interpreter===void 0)return!0;if(!n&&this.rawSupport.isSupported&&await QJ(this.memento,19,e.interpreter))return z(`IPyKernel found previously in this environment ${W(e.interpreter.uri)}`),!0;let i=this.installer.isInstalled(19,e.interpreter).then(o=>o===!0);return i.then(o=>{o&&s_(this.memento,19,e.interpreter).catch(f)},f),fr(t,!1,i)}async runInstaller(e,t,n,i,o,s){if(ne(`Run Installer for ${W(e)} ui.disableUI=${n.disableUI}, cancelTokenSource.token.isCancellationRequested=${i.token.isCancellationRequested}`),n.disableUI)return 4;let[a,c]=await Promise.all([ZJ(this.memento,19,t),t.envType==="Conda"?void 0:await this.installer.isInstalled(27,t)]);if(i.token.isCancellationRequested)return 1;let l=a?y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate:y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter,u=c===!1?[19,27]:[19],p=l(t.displayName||t.uri.fsPath,u.map(D=>hr.get(D)).join(` ${ye.and} `)),m=u.map(D=>hr.get(D)).join(", "),h=e?Hi(e):void 0,g=e?await vt(e.toString()):void 0;Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:m,resourceType:h,resourceHash:g,pythonEnvType:t.envType});let b=ye.install,w=y.selectKernel,k=ye.moreInfo,N=[b];e&&!o&&N.push(w),N.push(k);try{(!zd()||!s)&&Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"prompted",moduleName:m,resourceType:h,resourceHash:g,pythonEnvType:t.envType});let D;do D=zd()||s?b:await fr(i.token,id.window.showInformationMessage(p,{modal:!0},...N)),D===k&&(Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"moreInfo",moduleName:m,resourceType:h,resourceHash:g,pythonEnvType:t.envType}),id.env.openExternal(id.Uri.parse("https://aka.ms/AAhi594")));while(D===k);if(i.token.isCancellationRequested)return Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:m,resourceType:h,resourceHash:g,pythonEnvType:t.envType}),1;if(D===w)return Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"differentKernel",moduleName:m,resourceType:h,resourceHash:g,pythonEnvType:t.envType}),3;if(D===b){Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"install",moduleName:m,resourceType:h,resourceHash:g,pythonEnvType:t.envType});let V=await fr(i.token,3,this.installer.install(19,t,i,a===!0,c===!1));if(V===0)return Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"installed",moduleName:m,resourceType:h,resourceHash:g,pythonEnvType:t.envType}),0;if(V===2)return Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"failed",moduleName:m,resourceType:h,resourceHash:g,pythonEnvType:t.envType}),2}return Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:m,resourceType:h,resourceHash:g,pythonEnvType:t.envType}),1}catch(D){throw x(`Failed to install ${m}`,D),Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"error",moduleName:m,resourceType:h,resourceHash:g,pythonEnvType:t.envType}),D}}};v([ti("Install Missing Dependencies")],nd.prototype,"installMissingDependencies",1),v([ti("Are Dependencies Installed"),d(0,Tl("id"))],nd.prototype,"areDependenciesInstalled",1),nd=v([(0,cu.injectable)(),d(0,(0,cu.inject)(Ni)),d(1,(0,cu.inject)($e)),d(1,(0,cu.named)(St)),d(2,(0,cu.inject)(li)),d(3,(0,cu.inject)(ut))],nd);var yD=_(O()),vD=require("vscode");var Iy=class{constructor(e){this.disposables=e;this._onDidChangeRegistrations=new vD.EventEmitter;this.onDidChangeRegistrations=this._onDidChangeRegistrations.event;this._finders=[];this.connectionFinderMapping=new Map;this._onDidChangeKernels=new vD.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this._status="idle";this._onDidChangeStatus=new vD.EventEmitter;e.push(this._onDidChangeStatus),e.push(this._onDidChangeRegistrations)}get status(){return this._status}set status(e){this._status!=e&&(this._status=e,this._onDidChangeStatus.fire())}get onDidChangeStatus(){return this._onDidChangeStatus.event}registerKernelFinder(e){this._finders.push(e),e.status==="discovering"&&(this.status="discovering");let t=e.onDidChangeStatus(()=>this.status=this._finders.every(i=>i.status==="idle")?"idle":"discovering",this,this.disposables),n=e.onDidChangeKernels(()=>this._onDidChangeKernels.fire());return this.disposables.push(n),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[e],removed:[]}),{dispose:()=>{let i=this._finders.findIndex(o=>o===e);this._finders.splice(i,1),n.dispose(),t.dispose(),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[],removed:[e]})}}}get kernels(){let e=[];this.connectionFinderMapping.clear();let t=new Set;this._finders.filter(i=>i.kind==="localPythonEnvironment").forEach(i=>{i.kernels.forEach(o=>{(o.kind==="startUsingLocalKernelSpec"||o.kind==="startUsingPythonInterpreter")&&o.kernelSpec.specFile&&t.add(o.kernelSpec.specFile),e.push(o),this.connectionFinderMapping.set(o.id,i)})}),this._finders.filter(i=>i.kind==="localKernelSpec").forEach(i=>{i.kernels.forEach(o=>{(o.kind==="startUsingLocalKernelSpec"||o.kind==="startUsingPythonInterpreter")&&o.kernelSpec.specFile&&t.has(o.kernelSpec.specFile)||(e.push(o),this.connectionFinderMapping.set(o.id,i))})});let n=this._finders.filter(i=>i.kind==="remote");for(let i of n){let o=i.kernels;o.forEach(s=>{this.connectionFinderMapping.set(s.id,i)}),e.push(...o)}return e}getFinderForConnection(e){return this.connectionFinderMapping.get(e.id)}get registered(){return this._finders}};Iy=v([(0,yD.injectable)(),d(0,(0,yD.inject)(F))],Iy);var pn=_(O());var pi=require("vscode");var bD=class{constructor(e,t){this.asyncDisposables=e;this.disposables=t;this.executions=new WeakMap;this.kernelsByNotebook=new WeakMap;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new pi.EventEmitter;this._onDidStartKernel=new pi.EventEmitter;this._onDidCreateKernel=new pi.EventEmitter;this._onDidDisposeKernel=new pi.EventEmitter;this._onKernelStatusChanged=new pi.EventEmitter;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),pi.workspace.onDidCloseNotebookDocument(n=>this.disposeOldKernel(n),this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel)}get kernels(){let e=new Set;return pi.workspace.notebookDocuments.forEach(t=>{let n=this.get(t);n&&e.add(n)}),Array.from(e)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get(e){if(Vn(e)){let t=pi.workspace.notebookDocuments.find(n=>n.uri.toString()===e.toString());return t?this.get(t):void 0}else return typeof e=="string"?this.kernelsById.get(e)?.kernel:this.kernelsByNotebook.get(e)?.kernel}getKernelExecution(e){return this.executions.get(e)}getInternal(e){return this.kernelsByNotebook.get(e)}async dispose(){ne("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,n){this.kernelsByNotebook.set(e,{options:t,kernel:n}),this.kernelsById.set(n.id,{options:t,kernel:n}),this._onDidCreateKernel.fire(n)}deleteMappingIfKernelIsDisposed(e){e.onDisposed(()=>{this.get(e.notebook)===e&&(this.kernelsByNotebook.delete(e.notebook),this.kernelsById.delete(e.id),E(`Kernel got disposed, hence there is no longer a kernel associated with ${W(e.uri)}`)),this.pendingDisposables.delete(e)},this,this.disposables)}disposeOldKernel(e){let t=this.kernelsByNotebook.get(e);t&&(E(`Disposing kernel associated with ${W(e.uri)}, isClosed=${e.isClosed}`),this.kernelsById.delete(t.kernel.id),this.pendingDisposables.add(t.kernel),t.kernel.dispose().catch(n=>j("Failed to dispose old kernel",n)).finally(()=>this.pendingDisposables.delete(t.kernel)).catch(f)),this.kernelsByNotebook.delete(e)}handleServerRemoval(e){pi.workspace.notebookDocuments.forEach(t=>{let n=this.kernelsByNotebook.get(t);if(n){let i=n.options.metadata;(i.kind==="connectToLiveRemoteKernel"||i.kind==="startUsingRemoteKernelSpec")&&e.find(s=>s.id===i.serverProviderHandle.id&&s.handle===i.serverProviderHandle.handle)&&(this.kernelsByNotebook.delete(t),this.kernelsById.delete(n.kernel.id))}})}},ID=class{constructor(e,t){this.asyncDisposables=e;this.disposables=t;this.kernelsByUri=new Map;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new pi.EventEmitter;this._onDidStartKernel=new pi.EventEmitter;this._onDidCreateKernel=new pi.EventEmitter;this._onDidDisposeKernel=new pi.EventEmitter;this._onKernelStatusChanged=new pi.EventEmitter;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),pi.workspace.onDidCloseNotebookDocument(n=>{E(`Notebook document ${W(n.uri)} got closed`),this.disposeOldKernel(n.uri)},this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel)}get kernels(){return Array.from(this.kernelsByUri.values()).map(e=>e.kernel)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get(e){return this.kernelsByUri.get(e.toString())?.kernel||this.kernelsById.get(e.toString())?.kernel}getInternal(e){return this.kernelsByUri.get(e.toString())}async dispose(){ne("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,n){this.kernelsByUri.set(e.toString(),{options:t,kernel:n}),this.kernelsById.set(n.id,{options:t,kernel:n}),this._onDidCreateKernel.fire(n)}deleteMappingIfKernelIsDisposed(e,t){t.onDisposed(()=>{this.get(e)===t&&(this.kernelsByUri.delete(e.toString()),this.kernelsById.delete(t.id),E(`Kernel got disposed, hence there is no longer a kernel associated with ${W(e)}`)),this.pendingDisposables.delete(t)},this,this.disposables)}disposeOldKernel(e){let t=this.kernelsByUri.get(e.toString());t&&(ne(`Disposing kernel associated with ${W(e)}`),this.kernelsById.delete(t.kernel.id),this.pendingDisposables.add(t.kernel),t.kernel.dispose().catch(n=>j("Failed to dispose old kernel",n)).finally(()=>this.pendingDisposables.delete(t.kernel)).catch(f)),this.kernelsByUri.delete(e.toString())}};var gF=_(So()),$r=require("vscode");var z5=_(qk());var hF="KERNEL_INFO",Qhe=1e3*60*60*24*2;async function G5(r,e,t){let n=[],i={banner:"",help_links:[],implementation:"",implementation_version:"",language_info:{name:"",version:""},protocol_version:"",status:"ok"};if(!r.kernel)return;r.kernel?.info&&(n.push(r.kernel.info),r.kernel.info.then(a=>H5(t,e,a)).catch(f));let o=r.kernel.requestKernelInfo().then(a=>a?.content);if(n.push(o),o.then(a=>H5(t,e,a)).catch(f),e.kind==="connectToLiveRemoteKernel"){let a=Yhe(t,e);a?n.push(Promise.resolve(a)):n.push(ji(5e3).then(()=>i))}let s=await Promise.race(n);return s===i?j("Failed to Kernel info in a timely manner, defaulting to empty info!"):E("Got Kernel info"),s}async function H5(r,e,t){if(!t||!Ft(e))return;let n=r.get(hF,[]).filter(i=>Date.now()-i.age<Qhe).filter(i=>i.id!==e.id);n.push({id:e.id,age:Date.now(),info:t}),await r.update(hF,n)}function Yhe(r,e){if(Ft(e))return r.get(hF,[]).find(t=>t.id===e.id)?.info}var SD=class extends kn{constructor(e){super("kernelpromisetimeout",y.interruptingKernelFailed,e)}};var xD="e976ee50-99ed-4aba-9b6b-9dcd5634d07d:IPyWidgets:";function PD(r){let e=typeof r=="string"?r:"";return typeof r!="string"&&"content"in r&&"code"in r.content&&typeof r.content.code=="string"&&(e=r.content.code),!e.includes(xD)}function kD(r){return r.status==="dead"||r.status==="terminating"&&!r.disposed&&!r.disposing||!r.disposed&&!r.disposing&&(r.session?.status=="unknown"||r.session?.kernel?.status=="unknown")&&(r.session.kernel?.isDisposed||r.session.isDisposed)}function Q5(r){return r.status==="dead"||r.status==="terminating"&&!r.isDisposed||!r.isDisposed&&(r.status=="unknown"||r.kernel?.status=="unknown")&&(r.kernel?.isDisposed||r.isDisposed)}var CD=class{constructor(e,t,n,i,o,s,a,c,l){this.id=e;this.uri=t;this.resourceUri=n;this.kernelConnectionMetadata=i;this.sessionCreator=o;this.kernelSettings=s;this.startupCodeProviders=a;this._creator=c;this.workspaceMemento=l;this.disposables=[];this._onIPyWidgetVersionResolved=new $r.EventEmitter;this._onDidKernelSocketChange=new $r.EventEmitter;this._onStatusChanged=new $r.EventEmitter;this._onRestarted=new $r.EventEmitter;this._onStarted=new $r.EventEmitter;this._onDisposed=new $r.EventEmitter;this.hookedSessionForEvents=new WeakSet;this.hooks=new Map;this.startCancellation=new $r.CancellationTokenSource;this.startupUI=new Yt(!0);this.disposables.push(this._onStatusChanged),this.disposables.push(this._onRestarted),this.disposables.push(this._onStarted),this.disposables.push(this._onDisposed),this.disposables.push(this._onIPyWidgetVersionResolved),this.disposables.push(this._onDidKernelSocketChange),Zi(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator,disableUI:this.startupUI.disableUI}).catch(f),this.startupUI.onDidChangeDisableUI(()=>{this.startupUI.disableUI||Zi(this.resourceUri,{disableUI:!1}).catch(f)},this.disposables)}get ipywidgetsVersion(){return this._ipywidgetsVersion}get onIPyWidgetVersionResolved(){return this._onIPyWidgetVersionResolved.event}get onStatusChanged(){return this._onStatusChanged.event}get onRestarted(){return this._onRestarted.event}get onStarted(){return this._onStarted.event}get onDisposed(){return this._onDisposed.event}get creator(){return this._creator}get startedAtLeastOnce(){return this._startedAtLeastOnce}get info(){return this._info}get status(){return this._jupyterSessionPromise&&!this._session?"starting":this._session?.status??(this.isKernelDead?"dead":"unknown")}get disposed(){return this._disposed===!0||this._session?.isDisposed===!0}get disposing(){return this._disposing===!0}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}get session(){return this._session}get restarting(){return this._restartPromise||Promise.resolve()}addHook(e,t,n,i){let o=this.hooks.get(e)||new Set;this.hooks.set(e,o),t=n?t.bind(n):t,o.add(t);let s={dispose:()=>{o.delete(t)}};return i&&i.push(s),s}async start(e){return this.startCancellation.token.isCancellationRequested&&(this.startCancellation.dispose(),this.startCancellation=new $r.CancellationTokenSource),this.startJupyterSession(e)}async interrupt(){let e=Promise.all(Array.from(this.hooks.get("willInterrupt")||new Set).map(n=>n()));z(`Interrupt requested ${W(this.resourceUri||this.uri)}`);let t;try{let n=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;z("Interrupt kernel execution"),n?(t=this._interruptPromise?await this._interruptPromise:await(this._interruptPromise=this.interruptExecution(n,e)),this._interruptPromise=void 0):(z("No kernel session to interrupt"),this._interruptPromise=void 0,t="success")}finally{await Promise.all(Array.from(this.hooks.get("interruptCompleted")||new Set).map(n=>n())).catch(f)}if(z(`Interrupt requested & sent for ${W(this.uri)} in notebookEditor.`),t==="timeout"){let n=y.restartKernelAfterInterruptMessage(mt(this.kernelConnectionMetadata)),i=y.restartKernelMessageYes;await $r.window.showInformationMessage(n,{modal:!0},i)===i&&await this.restart()}}async dispose(){if(z(`Dispose Kernel '${W(this.uri)}' associated with '${W(this.resourceUri)}'`),this._disposing=!0,this.disposingPromise)return this.disposingPromise;this._ignoreJupyterSessionDisposedErrors=!0,this.startCancellation.cancel();let e=async()=>{let t=[];t.push(Promise.all(Array.from(this.hooks.get("willCancel")||new Set).map(n=>n())).then(f).catch(f)),this._session=this._session?this._session:this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0,this._jupyterSessionPromise=void 0,this._session&&(t.push(this._session.disposeAsync().catch(f)),this._session=void 0),this._disposed=!0,this._onDisposed.fire(),this._onStatusChanged.fire("dead");try{await Promise.all(t)}finally{this.startCancellation.dispose(),Q(this.disposables)}};this.disposingPromise=e(),await this.disposingPromise}async restart(){try{let e=Hi(this.resourceUri);z(`Restart requested ${W(this.uri)}`),await Promise.all(Array.from(this.hooks.get("willRestart")||new Set).map(n=>n(this._jupyterSessionPromise))),this.startCancellation.cancel(),this.startCancellation.dispose();let t=new qe;try{let n=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;n?(this._restartPromise||(this._restartPromise=n.restart(),this._restartPromise.finally(()=>this._restartPromise=void 0).catch(f)),await this._restartPromise,this.startCancellation=new $r.CancellationTokenSource):await this.start(new Yt(!1)),Rt(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},{resourceType:e})}catch(n){x(`Restart failed ${W(this.uri)}`,n),this._ignoreJupyterSessionDisposedErrors=!0;let i=this._session;throw this._session=void 0,this._jupyterSessionPromise=void 0,Rt(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},void 0,n),await i?.disposeAsync().catch(f),this._ignoreJupyterSessionDisposedErrors=!1,n}await this.initializeAfterStart(this._session),this._onRestarted.fire()}catch(e){throw x(`Failed to restart kernel ${W(this.uri)}`,e),e}finally{Promise.all(Array.from(this.hooks.get("restartCompleted")||new Set).map(e=>e())).catch(f)}}async startJupyterSession(e=new Yt(!1)){if(this._startedAtLeastOnce=!0,e.disableUI||(this.startupUI.disableUI=!1),e.onDidChangeDisableUI(()=>{!e.disableUI&&this.startupUI.disableUI&&(this.startupUI.disableUI=!1)}),this.startupUI.disableUI?this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||Yo(this.resourceUri,this.kernelConnectionMetadata).catch(f)},this,this.disposables):await Yo(this.resourceUri,this.kernelConnectionMetadata),this.disposing)throw new $r.CancellationError;if(yn.throwIfCanceled(this.startCancellation.token),!this._jupyterSessionPromise){let t=new qe;if(await Zi(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator}),this.disposing)throw new $r.CancellationError;yn.throwIfCanceled(this.startCancellation.token),this._jupyterSessionPromise=this.createJupyterSession().then(n=>(Rt(this.resourceUri,"DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",{duration:t.elapsedTime}),n)).catch(n=>{throw ne(`Failed to create Jupyter Session in Kernel.startNotebook for ${W(this.uri)}`),this.startCancellation.cancel(),this._jupyterSessionPromise=void 0,n})}return this._jupyterSessionPromise.finally(()=>this.sendKernelStartedTelemetry()).catch(f),this._jupyterSessionPromise}async interruptExecution(e,t){let n=ue(),i=new qe,o=[],s=l=>{(l==="restarting"||l==="autorestarting")&&(j("Kernel restarting during interrupt"),n.resolve(!0))},a=(l,u)=>s(u);return e.statusChanged.connect(a),o.push(new $r.Disposable(()=>An(()=>e.statusChanged.disconnect(a)))),e&&e.kernel&&(z(`Interrupting kernel: ${e.kernel.name}`),await Tw(this.kernelSettings.interruptTimeout,new SD(this.kernelConnectionMetadata),e.kernel.interrupt()).catch(l=>{j(`Error during interrupt: ${l}`),n.resolve(!0)})),(async()=>{let l=ue();this.status==="busy"&&(this.onDisposed(()=>l.resolve("dead"),this,o),this.onStatusChanged(()=>this.status==="dead"?l.resolve("dead"):void 0,this,o));try{return await pr(this.kernelSettings.interruptTimeout,"timeout",t.then(()=>"success"),n.promise.then(()=>"restart"),l.promise)}catch(u){if(n.completed)return"restart";throw Rt(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},void 0,u),u}finally{Q(o)}})().then(l=>(Rt(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},{result:l}),l))}async createJupyterSession(){if(this.disposing)throw new $r.CancellationError;yn.throwIfCanceled(this.startCancellation.token);let e=[];try{let t="",n=this.kernelConnectionMetadata.interpreter;if(n){let o=[];o.push(`Python Path: ${W(n.uri)}`),o.push(n.envType||""),o.push(n.envName||"");let s=$i(n);s&&o.push(`${s.major}.${s.minor}.${s.micro}`),t=` (${o.filter(a=>a).join(", ")})`}z(`Starting Kernel ${this.kernelConnectionMetadata.kind}, ${this.kernelConnectionMetadata.id} ${t} for '${W(this.uri)}' (disableUI=${this.startupUI.disableUI})`),this.createProgressIndicator(e),this.isKernelDead=!1,this._onStatusChanged.fire("starting");let i=await this.sessionCreator.create({resource:this.resourceUri,ui:this.startupUI,kernelConnection:this.kernelConnectionMetadata,token:this.startCancellation.token,creator:this.creator});if(this.disposing)throw new $r.CancellationError;if(yn.throwIfCanceled(this.startCancellation.token),await this.initializeAfterStart(i),this.disposing)throw new $r.CancellationError;return this.sendKernelStartedTelemetry(),this._session=i,this._onStarted.fire(),i}catch(t){if(this.startupUI.disableUI?E(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,t):!this.startCancellation.token&&!mr(t)&&x(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,t),yn.throwIfCanceled(this.startCancellation.token),t instanceof vs)throw t;let n=y.sessionStartFailedWithKernel(mt(this.kernelConnectionMetadata));throw sn.from(n+" "+("message"in t?t.message:t.toString()),t)}finally{Q(e)}}sendKernelStartedTelemetry(){this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent&&this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent===this.startupUI.disableUI||this.startTelemetrySent&&!this.startupUI.disableUI||(this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent=this.startupUI.disableUI===!0,this.startTelemetrySent=!0,Rt(this.resourceUri,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:this.startupUI.disableUI}))}createProgressIndicator(e){let t=ht.createProgressReporter(this.resourceUri,y.connectingToKernel(mt(this.kernelConnectionMetadata)),this.startupUI.disableUI);e.push(t),this.startupUI.disableUI&&this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||t.show&&t.show()},this,e)}async initializeAfterStart(e){if(await Promise.all(Array.from(this.hooks.get("didStart")||new Set).map(t=>t(e,this.startCancellation.token).catch(f))),E(`Started running kernel initialization for ${W(this.uri)}`),!e){E("Not running kernel initialization");return}if(!this.hookedSessionForEvents.has(e)){this.hookedSessionForEvents.add(e),e.onDidKernelSocketChange(n=>this._onDidKernelSocketChange.fire(n)),e.onDidDispose(()=>{if(ne(`Kernel got disposed as a result of session.onDisposed (1) ${W(this.resourceUri||this.uri)}`),!this._ignoreJupyterSessionDisposedErrors){z(`Kernel got disposed as a result of session.onDisposed ${W(this.resourceUri||this.uri)} & _ignoreJupyterSessionDisposedErrors = false.`);let n=this._session===e;this._jupyterSessionPromise=void 0,this._session=void 0,n&&(this.isKernelDead=!0,this._onStatusChanged.fire("dead"))}});let t=(n,i)=>this._onStatusChanged.fire(i);e.statusChanged.connect(t),this.disposables.push(new $r.Disposable(()=>An(()=>e.statusChanged.disconnect(t))))}if(e.kernel?.registerCommTarget(Ge.DefaultCommTarget,f),this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel")this.determineVersionOfIPyWidgets(e).catch(t=>x("Failed to determine IPyWidget version",t)),this.gatherInternalStartupCode().then(t=>this.executeSilently(e,t,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"})).catch(t=>x("Failed to execute internal startup code",t));else{await this.determineVersionOfIPyWidgets(e);let t=await this.gatherInternalStartupCode();await this.executeSilently(e,t,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"}),await this.executeSilently(e,this.getUserStartupCommands(),{traceErrors:!1})}try{E("Requesting Kernel info"),this._info=await G5(e,this.kernelConnectionMetadata,this.workspaceMemento)}catch(t){j("Failed to request KernelInfo",t)}this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&(E("End running kernel initialization, now waiting for idle"),await e.waitForIdle(this.kernelSettings.launchTimeout,this.startCancellation.token),E("End running kernel initialization, session is idle"))}async determineVersionOfIPyWidgets(e){if(!_t(this.kernelConnectionMetadata)){this._ipywidgetsVersion==bS,this._onIPyWidgetVersionResolved.fire(bS);return}let t=async()=>{let n=z5.default`
        try:
            import ipywidgets as _VSCODE_ipywidgets
            print("${xD}" + _VSCODE_ipywidgets.__version__)
            del _VSCODE_ipywidgets
        except:
            pass
        `,i=await this.executeSilently(e,[n]).catch(o=>x("Failed to determine version of IPyWidgets",o));if(Array.isArray(i)){let o=i.some(c=>(c.text||"")?.toString().includes(`${xD}8.`)),s=i.some(c=>(c.text||"")?.toString().includes(`${xD}7.`)),a=this._ipywidgetsVersion=s?7:o?8:void 0;E(`Determined IPyWidgets Version as ${a}`),this._ipywidgetsVersion==a,this._onIPyWidgetVersionResolved.fire(a)}else j("Failed to determine IPyKernel Version",JSON.stringify(i))};if(await t(),!this._ipywidgetsVersion&&this.session?.kernel){let n=(i,o)=>{if(o.direction==="send")return;let s=o.msg;s.content&&"data"in s.content&&s.content.data&&(s.content.data[Ui]||"target_name"in s.content&&s.content.target_name===Ge.DefaultCommTarget)&&(this._ipywidgetsVersion||(t().catch(f),this.session?.kernel&&this.session.kernel.anyMessage.disconnect(n,this)))};this.session.kernel.anyMessage.connect(n,this)}}async gatherInternalStartupCode(){let e=[],t=await Promise.all(this.startupCodeProviders.sort((n,i)=>i.priority-n.priority).map(n=>n.getCode(this)));for(let n of t)e.push(...n);if(_t(this.kernelConnectionMetadata)&&this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"){let n=Pe(this.resourceUri);n&&e.push(`__vsc_ipynb_file__ = "${n.replace(/\\/g,"\\\\")}"`),this.kernelSettings.enableExtendedPythonKernelCompletions||e.push(qa.DisableJedi),e.push(...Xhe(this.getMatplotLibInitializeCode(),"Failed to initialize matplotlib startup code. Matplotlib might be missing."))}return e}getMatplotLibInitializeCode(){let e=[];if(this.kernelSettings.themeMatplotlibPlots){ne(`Initialize config for plots for ${W(this.resourceUri||this.uri)}`);let t=qa.MatplotLibInit;E(`Initialize matplotlib for ${W(this.resourceUri||this.uri)}`),e.push(...Fe(t,{trim:!1}));let n=$r.window.activeColorTheme.kind===$r.ColorThemeKind.Dark;e.push(n?"matplotlib.style.use('dark_background')":`matplotlib.rcParams.update(${Ge.MatplotLibDefaultParams})`)}return e}getUserStartupCommands(){let e=this.kernelSettings.runStartupCommands;if(Array.isArray(e)&&(e=e.join(`
`)),e){let t=e.replace(/\\n/g,`
`);return Fe(t,{trim:!1})}return[]}async executeSilently(e,t,n){if(t.join("").trim().length!==0){if(!e.kernel){E(`Not executing startup as there is no session, code: ${t}`);return}return vn(e.kernel,t.join(`
`),n)}}},wD=class extends CD{get creator(){return"3rdPartyExtension"}constructor(e,t,n,i,o,s,a){super(`3rdPartyKernel_${(0,gF.default)()}`,e,t,n,i,o,s,"3rdPartyExtension",a)}},ED=class extends CD{constructor(t,n,i,o,s,a,c,l){super((0,gF.default)(),n.uri,t,i,o,s,c,"jupyterExtension",l);this.notebook=n;this.controller=a}get creator(){return"jupyterExtension"}};function Xhe(r,e){return!r||r.length===0||(r=r.map(t=>`    ${t}`),r.unshift("try:"),r.push("except:",`    print('${e}')`)),r}function _D(r){if(r.length>0){let e=r[0].data;if(e&&e.hasOwnProperty("text/plain"))return ws(e["text/plain"]);if(r[0].output_type==="stream"){let t=r[0];return ws(t.text)}}}function vF(r,e){return{get enableExtendedPythonKernelCompletions(){return r.getSettings(e).enableExtendedPythonKernelCompletions},get interruptTimeout(){return r.getSettings(e).jupyterInterruptTimeout},get launchTimeout(){return r.getSettings(e).jupyterLaunchTimeout},get runStartupCommands(){return r.getSettings(e).runStartupCommands},get themeMatplotlibPlots(){return r.getSettings(e).themeMatplotlibPlots}}}var js=require("vscode");var wa=require("vscode");var yF=_(vN()),kr=require("vscode");var Sy=new WeakMap;function lu(r){if(r.parent_header&&"msg_id"in r.parent_header)return r.parent_header.msg_id}var od=class od{constructor(e,t,n,i,o,s,a,c){this.cell=e;this.controller=t;this.context=n;this.formatters=i;this.kernel=o;this.request=s;this._onErrorHandlingIOPubMessage=new kr.EventEmitter;this.onErrorHandlingExecuteRequestIOPubMessage=this._onErrorHandlingIOPubMessage.event;this.outputsAreSpecificToAWidget=[];this.commIdsMappedToParentWidgetModel=new Map;this.disposables=[];this.prompts=new Set;this.ownedCommIds=new Set;this.commIdsMappedToWidgetOutputModels=new Set;this.ownedRequestMsgIds=new Set;this._completed=ue();this.gotIdleIOPubStatus=!1;this.gotShellReply=!1;this.streamsReAttachedToExecutingCell=!1;this._completed.promise.catch(f),this.executeRequestMessageId=c,this.ownedRequestMsgIds.add(c),kr.workspace.onDidChangeNotebookDocument(l=>{if(!Tt(l.notebook))return;let u=l.cellChanges.find(({cell:p})=>p===this.cell);u&&u.outputs?.length===0&&(this.clearLastUsedStreamOutput(),this.cellHasErrorsInOutput=!1)},this,this.disposables),this.execution=a,this.kernel.anyMessage.connect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.connect(this.onKernelIOPubMessage,this),s&&(s.onIOPub=()=>{this.cell.document.isClosed&&!this.completedExecution&&s.dispose()},s.onReply=l=>{if(this.cell.document.isClosed){s.dispose();return}this.handleReply(l)},s.onStdin=this.handleInputRequest.bind(this),s.done.finally(()=>{this.completedExecution=!0,this.endCellExecution()}).catch(f))}static{this.modelIdsOwnedByCells=new WeakMap}get hasErrorOutput(){return this.cellHasErrorsInOutput===!0}static{this.outputsOwnedByWidgetModel=new Map}get completed(){return this._completed.promise}dispose(){this.disposed||(this.disposed=!0,yt(this.cell,"Execution Message Handler disposed"),Q(this.disposables),this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this.kernel.anyMessage.disconnect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.disconnect(this.onKernelIOPubMessage,this),this._onErrorHandlingIOPubMessage.dispose())}endCellExecution(){this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this._completed.resolve()}onKernelAnyMessage(e,{direction:t,msg:n}){if(this.cell.document.isClosed)return this.endCellExecution();let i=require("@jupyterlab/services");if(!this.request&&t==="recv"){let o=lu(n);i.KernelMessage.isStatusMsg(n)&&n.content.execution_state==="idle"&&o===this.executeRequestMessageId&&(this.gotIdleIOPubStatus=!0),n.channel==="shell"&&o===this.executeRequestMessageId&&(this.gotShellReply=!0);let s=i.KernelMessage.isStatusMsg(n)&&n.content.execution_state!=="idle"&&o!==this.executeRequestMessageId;typeof n.parent_header=="object"&&n.parent_header&&"msg_type"in n.parent_header&&n.parent_header.msg_type;let a=o?o!==this.executeRequestMessageId&&!s:!1,c=typeof n.parent_header=="object"&&n.parent_header&&"msg_type"in n.parent_header&&n.parent_header.msg_type==="interrupt_request",l=this.gotIdleIOPubStatus&&this.gotShellReply,u=["kernel_info_reply","execute_input","execute_reply"],p="msg_type"in n&&typeof n.msg_type=="string"&&u.includes(n.msg_type);if(!this.completedExecution&&l)return this.completedExecution=!0,this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endCellExecution();if(!this.completedExecution&&(p||a)){this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=setTimeout(()=>(this.completedExecution=!0,this.endAbnormallyTimeout=void 0,this.endCellExecution()),c?1e3:100),this.disposables.push(new kr.Disposable(()=>{clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=void 0}));return}}t!=="send"||!this.completedExecution||i.KernelMessage.isCommMsgMsg(n)&&this.ownedCommIds.has(n.content.comm_id)&&this.ownedRequestMsgIds.add(n.header.msg_id)}onKernelIOPubMessage(e,t){if(this.cell.document.isClosed)return this.endCellExecution();if(!(!t.parent_header||!("msg_id"in t.parent_header)||!this.ownedRequestMsgIds.has(t.parent_header.msg_id)||t.channel!=="iopub"))try{this.handleIOPub(t)}catch(n){x("Failed to handle iopub message as a result of some comm message",t,n),!this.completedExecution&&!this.cell.document.isClosed&&this._onErrorHandlingIOPubMessage.fire(n)}}clearLastUsedStreamOutput(){this.lastUsedStreamOutput=void 0}createTemporaryTask(){if(this.cell.document.isClosed)return;let e=Sy.get(this.cell.notebook);return e||(this.previousResultsToRestore={...this.cell.executionSummary||{}},this.temporaryExecution=Gi.getOrCreate(this.cell,this.controller),this.temporaryExecution?.start(),this.previousResultsToRestore?.executionOrder&&this.execution&&(this.execution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution)}endTemporaryTask(){this.previousResultsToRestore?.executionOrder&&this.execution&&(this.execution.executionOrder=this.previousResultsToRestore.executionOrder),this.previousResultsToRestore&&this.temporaryExecution?(this.previousResultsToRestore.executionOrder&&(this.temporaryExecution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution.end(this.previousResultsToRestore.success,this.previousResultsToRestore.timing?.endTime)):this.temporaryExecution?.end(void 0),this.previousResultsToRestore=void 0,this.temporaryExecution=void 0}handleIOPub(e){this.startTime||(this.startTime=new Date().getTime(),this.execution?.start(this.startTime),z(`Kernel acknowledged execution of cell ${this.cell.index} @ ${this.startTime}`));let t=require("@jupyterlab/services");if(t.KernelMessage.isCommOpenMsg(e))this.handleCommOpen(e);else if(t.KernelMessage.isExecuteResultMsg(e))this.handleExecuteResult(e);else if(t.KernelMessage.isExecuteInputMsg(e))this.handleExecuteInput(e);else if(t.KernelMessage.isStatusMsg(e)){let n=e;this.handleStatusMessage(n)}else t.KernelMessage.isStreamMsg(e)?this.handleStreamMessage(e):t.KernelMessage.isDisplayDataMsg(e)?this.handleDisplayData(e):t.KernelMessage.isUpdateDisplayDataMsg(e)?this.handleUpdateDisplayDataMessage(e):t.KernelMessage.isClearOutputMsg(e)?this.handleClearOutput(e):t.KernelMessage.isErrorMsg(e)?this.handleError(e):t.KernelMessage.isCommOpenMsg(e)||(t.KernelMessage.isCommMsgMsg(e)?this.handleCommMsg(e):t.KernelMessage.isCommCloseMsg(e)||j(`Unknown message ${e.header.msg_type} : hasData=${"data"in e.content}`));"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleCommOpen(e){this.ownedCommIds.add(e.content.comm_id);let t=e.content.data?.state||void 0;e.content.target_name===Ge.DefaultCommTarget&&t&&t._model_module==="@jupyter-widgets/output"&&this.commIdsMappedToWidgetOutputModels.add(e.content.comm_id)}handleCommMsg(e){let t=e.content.data;if(!(!t||t.method!=="update"||typeof t.state!="object")){if("msg_id"in t.state&&typeof t.state.msg_id=="string"){let n="msg_id"in e.parent_header?e.parent_header:void 0;(this.ownedRequestMsgIds.has(e.content.comm_id)||n&&this.ownedRequestMsgIds.has(n.msg_id))&&(t.state.msg_id?this.outputsAreSpecificToAWidget.push({handlingCommId:e.content.comm_id,msgIdsToSwallow:t.state.msg_id}):this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId===e.content.comm_id&&this.outputsAreSpecificToAWidget.pop())}else if("children"in t.state&&Array.isArray(t.state.children)&&this.ownedCommIds.has(e.content.comm_id)){let n="IPY_MODEL_";t.state.children.forEach(i=>{if(typeof i!="string")return j("Came across a comm update message a child that isn't a string",i);if(!i.startsWith(n))return j(`Came across a comm update message a child that start start with ${n}`,i);let o=i.substring(n.length);this.ownedCommIds.add(o),this.commIdsMappedToParentWidgetModel.set(o,e.content.comm_id)})}}}clearOutputIfNecessary(e){return this.clearOutputOnNextUpdateToOutput?(yt(this.cell,"Clear cell output"),this.clearLastUsedStreamOutput(),e?.clearOutput().then(f,f),this.clearOutputOnNextUpdateToOutput=!1,{previousValueOfClearOutputOnNextUpdateToOutput:!0}):{previousValueOfClearOutputOnNextUpdateToOutput:!1}}addToCellData(e,t){if(e.data&&typeof e.data=="object"&&Ui in e.data){let c=e.data[Ui];if(c&&this.context.extensionMode===kr.ExtensionMode.Test&&(c._vsc_test_cellIndex=this.cell.index),c&&"model_id"in c){let l=od.modelIdsOwnedByCells.get(this.cell)||new Set;l.add(c.model_id),od.modelIdsOwnedByCells.set(this.cell,l)}}let n=da(e),i="transient"in e&&typeof e.transient=="object"&&e.transient&&"display_id"in e.transient&&typeof e.transient?.display_id=="string"?e.transient?.display_id:void 0;if(this.cell.document.isClosed)return;yt(this.cell,()=>`Update output with mimes ${n.items.map(c=>c.mime).toString()}`);let o=this.execution||this.createTemporaryTask();this.clearOutputIfNecessary(o),i&&Xr.trackOutputByDisplayId(this.cell,i,n,n.items),this.clearLastUsedStreamOutput(),yt(this.cell,"Append output in addToCellData");let s=!0,a=lu(t);(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&n.items.every(c=>this.canMimeTypeBeRenderedByWidgetManager(c))||this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&this.updateJupyterOutputWidgetWithOutput({commId:this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId,outputToAppend:n},o)?.outputAdded)&&(s=!1),s&&o?.appendOutput([n]).then(f,f),this.endTemporaryTask()}canMimeTypeBeRenderedByWidgetManager(e){let t=e.mime;if(t=="application/vnd.code.notebook.stderr"||t=="application/vnd.code.notebook.stdout"||t=="application/vnd.code.notebook.error")return!0;if(t===Ui){let n=JSON.parse(new TextDecoder().decode(e.data));return!(typeof n.model_id=="string"&&this.commIdsMappedToWidgetOutputModels.has(n.model_id))}return!t.startsWith("application/vnd")}updateJupyterOutputWidgetWithOutput(e,t){let n=this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId:void 0,i="commId"in e?e.commId:n;if(!i)return;let o="outputToAppend"in e?e.outputToAppend:void 0,s=this.commIdsMappedToParentWidgetModel.get(i)||i,a=this.cell.notebook.getCells().find(w=>od.modelIdsOwnedByCells.get(w)?.has(s));if(!a){j(`Unable to find a cell that owns the model ${s}`);return}let c=a.outputs.find(w=>w.items.find(k=>{if(k.mime!==Ui)return!1;try{return JSON.parse(new TextDecoder().decode(k.data)).model_id===s}catch(N){j("Failed to deserialize the widget data",N)}return!1}));if(!c)return;let l=od.outputsOwnedByWidgetModel.get(s)||new Set,p=("clearOutput"in e?e.clearOutput:!1)||(this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput===!0:!1);this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!1);let m=a.outputs.slice().filter(w=>p?!l.has(w.id):!0),h=m.slice(0,m.indexOf(c)+1),g=m.slice(m.indexOf(c)+1);od.outputsOwnedByWidgetModel.set(s,l),o&&l.add(o.id);let b=o?h.concat(o).concat(g):h.concat(g);return g.length===0&&o?t?.appendOutput(o,a).then(f,f):p&&!o&&g.length===0||t?.replaceOutput(b,a).then(f,f),{outputAdded:!0}}async handleInputRequest(e){if(e.content&&"prompt"in e.content){let t=new kr.CancellationTokenSource;this.prompts.add(t);let n=e.content.password!==null&&e.content.password;await kr.window.showInputBox({prompt:e.content.prompt?e.content.prompt.toString():"",ignoreFocusOut:!0,password:n},t.token).then(i=>{this.kernel.sendInputReply({value:i||"",status:"ok"})},f),this.prompts.delete(t)}}handleExecuteResult(e){this.addToCellData({output_type:"execute_result",data:e.content.data,metadata:e.content.metadata,transient:e.content.transient,execution_count:e.content.execution_count},e)}handleExecuteReply(e){let t=e.content;t.payload&&t.payload.forEach(n=>{n.source&&n.source==="set_next_input"&&"text"in n&&"replace"in n&&this.handleSetNextInput(n),n.data&&n.data.hasOwnProperty("text/plain")&&this.addToCellData({output_type:"stream",text:n.data["text/plain"].toString(),name:"stdout",metadata:{},execution_count:t.execution_count},e)})}handleSetNextInput(e){let t=new kr.WorkspaceEdit;if(e.replace)t.replace(this.cell.document.uri,new kr.Range(this.cell.document.lineAt(0).range.start,this.cell.document.lineAt(this.cell.document.lineCount-1).range.end),e.text);else{yt(this.cell,"Create new cell after current");let n=new kr.NotebookCellData(kr.NotebookCellKind.Code,e.text,this.cell.document.languageId);n.outputs=[],n.metadata={};let i=kr.NotebookEdit.insertCells(this.cell.index+1,[n]);t.set(this.cell.notebook.uri,[i])}kr.workspace.applyEdit(t).then(f,f)}handleExecuteInput(e){e.content.execution_count&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleStatusMessage(e){yt(this.cell,`Kernel switching to ${e.content.execution_state}`)}handleStreamMessage(e){if(lu(e)&&this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow==lu(e))return;yt(this.cell,`Update streamed output, new output '${e.content.text.substring(0,100)}'`);let t=this.execution||this.createTemporaryTask(),n=e.content.name==="stdout"?kr.NotebookCellOutputItem.stdout("").mime:kr.NotebookCellOutputItem.stderr("").mime;!this.request&&!this.streamsReAttachedToExecutingCell&&!this.lastUsedStreamOutput&&this.cell.outputs.length&&this.cell.outputs[this.cell.outputs.length-1].items.length>=1&&this.cell.outputs[this.cell.outputs.length-1].items.every(o=>o.mime===n)&&(this.lastUsedStreamOutput={output:this.cell.outputs[0],stream:e.content.name}),this.streamsReAttachedToExecutingCell=!0;let{previousValueOfClearOutputOnNextUpdateToOutput:i}=this.clearOutputIfNecessary(t);if(this.lastUsedStreamOutput?.stream===e.content.name){let o=da({output_type:"stream",name:e.content.name,text:e.content.text});yt(this.cell,`Append output items '${e.content.text.substring(0,100)}`),t?.appendOutputItems(o.items,this.lastUsedStreamOutput.output).then(f,f)}else if(i){let o=ws(e.content.text),s=da({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},yt(this.cell,`Replace output with '${o.substring(0,100)}'`),t?.replaceOutput([s]).then(f,f)}else{let o=FV(ws(e.content.text)),s=da({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},yt(this.cell,`Append new output '${o.substring(0,100)}'`),t?.appendOutput([s]).then(f,f)}this.endTemporaryTask()}handleDisplayData(e){let t={output_type:"display_data",data:cP(e.content.data),metadata:e.content.metadata,transient:e.content.transient};this.addToCellData(t,e)}handleClearOutput(e){if(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===lu(e)){if(e.content.wait)this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!0);else{let t=this.execution||this.createTemporaryTask();this.updateJupyterOutputWidgetWithOutput({clearOutput:!0},t),this.endTemporaryTask()}return}if(e.content.wait)this.clearOutputOnNextUpdateToOutput=!0;else{let t=this.execution||this.createTemporaryTask();this.clearLastUsedStreamOutput(),t?.clearOutput().then(f,f),this.endTemporaryTask()}}handleError(e){let t=e.content.traceback;ne(`Traceback for error ${t}`),this.formatters.forEach(i=>{t=i.format(this.cell,t)}),ne(`Traceback for error after formatting ${t}`);let n={output_type:"error",ename:e.content.ename,evalue:e.content.evalue,traceback:t};this.addToCellData(n,e),this.cellHasErrorsInOutput=!0}handleReply(e){require("@jupyterlab/services").KernelMessage.isExecuteReplyMsg(e)&&(this.handleExecuteReply(e),"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count))}handleUpdateDisplayDataMessage(e){let t=e.content.transient.display_id;if(!t){j("Update display data message received, but no display id",e.content);return}let n=Xr.getMappedOutput(this.cell.notebook,t);if(!n){j("Update display data message received, but no output found to update",e.content);return}if(n.cell.document.isClosed){j("Update display data message received, but output cell is closed",e.content);return}let i=sP(new kr.NotebookCellOutput(n.outputItems,n.outputContainer.metadata)),o=da({...i,data:e.content.data,metadata:e.content.metadata});if(n.outputItems.length===0&&o.items.length===0){E("Update display data message received, but no output to update",e.content);return}let s=!1;if(n.outputItems.length===o.items.length){let c=!0;if((0,yF.default)(n.outputContainer.metadata||{},o.metadata||{})||(s=!0,c=!1),c){for(let l=0;l<n.outputItems.length;l++)if(!(0,yF.default)(n.outputItems[l],o.items[l])){c=!1;break}}if(c){E("Update display data message received, but no output to update (data is the same)",e.content);return}}let a=this.execution||this.createTemporaryTask();if(yt(this.cell,`Replace output items in display data ${o.items.length}`),s){let c=n.cell.outputs.map(l=>{let u=sP(l);return u.output_type==="display_data"&&"transient"in u&&u.transient&&typeof u.transient=="object"&&"display_id"in u.transient&&typeof u.transient.display_id=="string"&&u.transient.display_id===t?o:l});a?.replaceOutput(c,n.cell).then(f,f),Xr.trackOutputByDisplayId(n.cell,t,o,o.items)}else a?.replaceOutputItems(o.items,n.outputContainer).then(f,f),Xr.trackOutputByDisplayId(n.cell,t,n.outputContainer,o.items);this.endTemporaryTask()}};v([Mr()],od.prototype,"handleReply",1);var mC=od;var sd=class extends Error{constructor(t){super(t.evalue||t.ename);this.ename=t.ename,this.evalue=t.evalue,this.traceback=t.traceback}};var DD=class{constructor(e,t){this.controller=e;this.requestListener=t}create(e,t,n,i){return bF.fromCell(e,t,n,this.controller,this.requestListener,i)}},bF=class r{constructor(e,t,n,i,o,s){this.cell=e;this.codeOverride=t;this.kernelConnection=n;this.controller=i;this.requestListener=o;this.resumeExecution=s;this.type="cell";this._result=ue();this.cancelHandled=!1;this.disposables=[];this._preExecuteEmitter=new wa.EventEmitter;if(wa.workspace.onDidCloseTextDocument(a=>{if(a===this.cell.document){z(`Disposing request as the cell (${this.cell.index}) was deleted ${W(this.cell.notebook.uri)}`);try{this.request?.dispose()}catch(c){x(`Error during cell execution dispose: ${c}`)}this.started&&!this._completed&&this.completedDueToCancellation()}},this,this.disposables),Kl.setCellState(e,wa.NotebookCellExecutionState.Idle),this.canExecuteCell())this.execution=Gi.getOrCreate(e,this.controller,!s?.msg_id),Kl.setCellState(e,wa.NotebookCellExecutionState.Pending);else{let a=Gi.get(e);a&&(a.start(),a.end(void 0))}}get result(){return this._result.promise}get preExecute(){return this._preExecuteEmitter.event}static fromCell(e,t,n,i,o,s){return new r(e,t,n,i,o,s)}async start(e){if(this.session=e,this.resumeExecution?.msg_id)return this.resume(e,this.resumeExecution);if(this.cancelHandled){yt(this.cell,"Not starting as it was cancelled");return}if(yt(this.cell,"Start execution"),ne(`Cell Exec contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}return e.kind==="remoteJupyter"&&e.status==="unknown"&&(!e.kernel||e.kernel.isDisposed||e.isDisposed)?(this.execution?.start(),this.execution?.clearOutput().then(f,f),this.completedWithErrors(new gn),this.result):this.started?(yt(this.cell,"Cell has already been started yet CellExecution.Start invoked again"),x(`Cell has already been started yet CellExecution.Start invoked again ${this.cell.index}`),this.result):(this.started=!0,Sy.set(this.cell.notebook,this.execution),Kl.setCellState(this.cell,wa.NotebookCellExecutionState.Executing),this.execute(this.codeOverride||this.cell.document.getText().replace(/\r\n/g,`
`),e).catch(t=>this.completedWithErrors(t)).catch(f),this.result)}async resume(e,t){if(this.cancelHandled){yt(this.cell,"Not resuming as it was cancelled");return}if(!e.kernel)throw new Error("Kernel not available to resume execution");if(yt(this.cell,"Start resuming execution"),ne(`Cell Exec (resuming) contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}return this.started?(x(`Cell has already been started yet CellExecution.resume invoked again ${this.cell.index}`),this.result):(this.started=!0,Sy.set(this.cell.notebook,this.execution),this.execution?.start(t.startTime),t.executionCount&&this.execution&&(this.execution.executionOrder=t.executionCount),Kl.setCellState(this.cell,wa.NotebookCellExecutionState.Executing),this.cellExecutionHandler=this.requestListener.registerListenerForResumingExecution(this.cell,{kernel:e.kernel,cellExecution:this.execution,msg_id:t.msg_id}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(n=>{x(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,n),this.completedWithErrors(n.error)},this,this.disposables),this.cellExecutionHandler.completed.finally(()=>this.completedSuccessfully()).catch(f),this.result)}async cancel(e=!1){if(!this.cancelHandled){if(this.cancelRequested=!0,this.started&&!e&&this.execution?.started){yt(this.cell,"Cell is already running, waiting for it to finish or kernel to start"),await this.result.catch(f);return}this.cancelHandled||this._completed||(yt(this.cell,"Execution cancelled"),this.cancelHandled=!0,this.completedDueToCancellation(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,yt(this.cell,"Execution disposed"),Q(this.disposables))}completedWithErrors(e,t,n=!0){if(!this.cancelHandled){if(!this.disposed&&!this.cancelRequested?j("Cell completed with errors",e):j(`Cell completed with errors (${this.disposed?"disposed":"cancelled"})`),yt(this.cell,"Completed with errors"),n){let i,o;e&&!(e instanceof Ye)&&e.message?.includes("Canceled future for execute_request message before replies were done")&&this.session&&Q5(this.session)&&(e=new gn),e&&(e instanceof Ye?i=sm(wa.workspace.workspaceFolders||[],e,mt(this.kernelConnection),QS(this.kernelConnection.interpreter))?.message:i=e.message||e.name||e.stack),o=Oh(i||""),o&&this.execution?.appendOutput(o).then(f,f)}this.endCellTask("failed",t),yt(this.cell,"Completed with errors, & resolving"),this._result.reject(e)}}get isEmptyCodeCell(){return this.cell.document.getText().trim().length===0}completedSuccessfully(e){yt(this.cell,"Completed successfully");let t="success";this.endCellTask("success",e),yt(this.cell,`Completed successfully & resolving with status = ${t}`),this._result.resolve()}endCellTask(e,t=new Date().getTime()){if(!this._completed){if(this._completed=!0,this.isEmptyCodeCell)this.execution&&(this.execution.executionOrder=void 0),this.execution?.end(void 0);else if(e==="success"||e==="failed")this.endTime=t,this.execution?.end(e==="success",this.endTime);else{try{this.request?.dispose()}catch{}this.execution?.end(void 0)}Sy.get(this.cell.notebook)===this.execution&&Sy.set(this.cell.notebook,void 0),Kl.setCellState(this.cell,wa.NotebookCellExecutionState.Idle),this.execution=void 0}}completedDueToCancellation(){yt(this.cell,"Completed due to cancellation"),this.endCellTask("cancelled"),yt(this.cell,"Cell cancelled & resolving"),this._result.resolve()}canExecuteCell(){return this.cell.document.languageId==="raw"?!1:!this.cell.document.isClosed}async execute(e,t){if(!t.kernel)throw new Error("No kernel available to execute code");if(yt(this.cell,"Send code for execution"),e.trim().length===0||this.cell.document.isClosed)return e.trim().length===0&&(this.execution?.start(this.resumeExecution?.startTime),this.execution?.clearOutput()?.then(f,f)),yt(this.cell,"Empty cell execution"),this.completedSuccessfully();let n={cellId:this.cell.document.uri.toString(),...this.cell.metadata?.custom?.metadata||{}},i=t.kernel;try{this._preExecuteEmitter.fire(this.cell),E(`Cell Index:${this.cell.index} sent to kernel`),this.request=i.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!0},!1,n),this.request.done.then(f,f)}catch(o){return x(`Cell execution failed without request, for cell Index ${this.cell.index}`,o),this.completedWithErrors(o)}this.cellExecutionHandler=this.requestListener.registerListenerForExecution(this.cell,{kernel:i,cellExecution:this.execution,request:this.request}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(o=>{x(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,o),this.completedWithErrors(o.error)},this,this.disposables);try{yt(this.cell,"Wait for jupyter execution");let o=await this.request.done,s=new Date().getTime();yt(this.cell,"Jupyter execution completed"),o.content.status==="error"?this.completedWithErrors(new sd(o.content),s,!1):this.completedSuccessfully(s),yt(this.cell,"Executed successfully in executeCell")}catch(o){if(this.cancelHandled)return;!this.disposed&&!this.cancelRequested&&x("Error in waiting for cell to complete",o),yt(this.cell,"Some other execution error"),o&&o instanceof Error&&mr(o,!0)?this.completedWithErrors({message:o.message}):this.completedWithErrors(o)}}};var Y5=require("vscode");var TD=class{constructor(e,t,n,i){this.controller=e;this.context=t;this.formatters=n;this.notebook=i;this.disposables=[];this.messageHandlers=new WeakMap;Y5.workspace.onDidChangeNotebookDocument(o=>{o.notebook===this.notebook&&o.contentChanges.forEach(s=>s.removedCells.forEach(a=>this.messageHandlers.get(a)?.dispose()))},this,this.disposables)}dispose(){Q(this.disposables),this.notebook&&this.notebook.getCells().forEach(e=>this.messageHandlers.get(e)?.dispose())}registerListenerForExecution(e,t){this.messageHandlers.get(e)?.dispose();let n=new mC(e,this.controller,this.context,this.formatters,t.kernel,t.request,t.cellExecution,t.request.msg.header.msg_id);return this.messageHandlers.set(e,n),n}registerListenerForResumingExecution(e,t){this.messageHandlers.get(e)?.dispose();let n=new mC(e,this.controller,this.context,this.formatters,t.kernel,void 0,t.cellExecution,t.msg_id);return this.messageHandlers.set(e,n),n}};var IF=require("vscode");var RD=require("vscode");function el(r,e){E(`Execution Id:${r}. ${e}.`)}var X5=new Map,AD=class r{constructor(e,t){this.code=e;this.extensionId=t;this.type="code";this._onDidEmitOutput=new RD.EventEmitter;this.onDidEmitOutput=this._onDidEmitOutput.event;this._onRequestSent=new RD.EventEmitter;this.onRequestSent=this._onRequestSent.event;this._onRequestAcknowledge=new RD.EventEmitter;this.onRequestAcknowledged=this._onRequestAcknowledge.event;this._done=ue();this.cancelHandled=!1;this.disposables=[];let n=X5.get(t)||0;n+=1,X5.set(t,n),this.executionId=`${t}-${n}`,this.disposables.push(this._onDidEmitOutput)}get done(){return this._done.promise}get result(){return this._done.promise}static fromCode(e,t){return new r(e,t)}async start(e){if(this.session=e,this.cancelHandled){el(this.executionId,"Not starting as it was cancelled");return}if(el(this.executionId,"Start Code execution"),ne(`Code Exec contents ${this.code.substring(0,50)}...`),!e.kernel||e.kernel.isDisposed||e.isDisposed){this._done.reject(new gn);return}if(this.started)return el(this.executionId,"Code has already been started yet CodeExecution.Start invoked again"),x(`Code has already been started yet CodeExecution.Start invoked again ${this.executionId}`),this.done;await this.execute(this.code.replace(/\r\n/g,`
`),e).catch(f)}async cancel(){if(!(this.cancelHandled||this._completed)){if(this.cancelRequested=!0,this.started){el(this.executionId,"Code is already running, interrupting and waiting for it to finish or kernel to start");let e=this.session?.kernel;e&&await e.interrupt().catch(f),this.request?.dispose(),await this.request?.done.catch(f)}this.cancelHandled||this._completed||(el(this.executionId,"Execution cancelled"),this.cancelHandled=!0,this._done.resolve(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,this._completed||el(this.executionId,"Execution disposed"),Q(this.disposables))}async execute(e,t){if(!t.kernel){let i=new Error("No kernel available to execute code");throw this._done.resolve(),i}el(this.executionId,"Send code for execution");let n=t.kernel;try{this.started=!0,this._onRequestSent.fire(),el(this.executionId,"Execution Request Sent to Kernel"),this.request=YV(n,e,()=>this._onRequestAcknowledge.fire(),i=>this._onDidEmitOutput.fire(i)),this.request.done.then(f,f)}catch(i){x(`Code execution failed without request, for exec ${this.executionId}`,i),this._completed=!0,this._done.reject(i);return}try{let i=await this.request.done;this._completed=!0,i.content.status==="error"?(el(this.executionId,"Executed with errors"),this._done.reject(new sd(i.content))):(el(this.executionId,"Executed successfully"),this._done.resolve())}catch(i){if(this._completed=!0,this.cancelHandled)return;!this.disposed&&!this.cancelRequested?x(`Error in waiting for code ${this.executionId} to complete`,i):x(`Some other execution error for exec ${this.executionId}`,i),this._done.reject(i)}}};var ND=class{constructor(e,t,n,i){this.session=e;this.executionFactory=t;this.metadata=n;this.resourceUri=i;this.queueOfItemsToExecute=[];this.cancelledOrCompletedWithErrors=!1;this.startedRunningCells=!1;this._onPreExecute=new IF.EventEmitter;this._onPostExecute=new IF.EventEmitter;this.disposables=[]}get queueOfCellsToExecute(){return this.queueOfItemsToExecute.filter(e=>e.type==="cell").map(e=>e)}get isEmpty(){return this.queueOfItemsToExecute.length===0}get failed(){return this.cancelledOrCompletedWithErrors}get queue(){return this.queueOfCellsToExecute.map(e=>e.cell)}dispose(){this.disposables.forEach(e=>e.dispose()),this.lastCellExecution?.dispose()}get onPreExecute(){return this._onPreExecute.event}get onPostExecute(){return this._onPostExecute.event}queueCell(e,t){this.enqueue({cell:e,codeOverride:t})}queueCode(e,t,n){return this.enqueue({code:e,extensionId:t,token:n})}enqueue(e){let t;if("cell"in e){let{cell:n,codeOverride:i}=e,o=this.queueOfCellsToExecute.find(a=>a.cell===n);if(o)return yt(n,"Use existing cell execution"),o;let s=this.executionFactory.create(n,i,this.metadata);t=s,this.disposables.push(s),s.preExecute(a=>this._onPreExecute.fire(a),this,this.disposables),this.queueOfItemsToExecute.push(s),yt(n,"User queued cell for execution")}else{let{code:n,extensionId:i,token:o}=e,s=AD.fromCode(n,i);t=s,this.disposables.push(s),this.queueOfItemsToExecute.push(s),this.disposables.push(hm(o.onCancellationRequested)(()=>s.cancel()))}return this.startExecutingCells(),t}resumeCell(e,t){if(this.queueOfCellsToExecute.find(o=>o.cell===e)){yt(e,"Use existing cell execution");return}let i=this.executionFactory.create(e,"",this.metadata,t);this.disposables.push(i),this.queueOfItemsToExecute.push(i),yt(e,"User queued cell for execution"),this.startExecutingCells()}async cancel(e){this.cancelledOrCompletedWithErrors=!0,E("Cancel pending cells"),await Promise.all(this.queueOfItemsToExecute.map(t=>t.cancel(e))),this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.splice(0,this.queueOfItemsToExecute.length)}async cancelQueuedCells(){this.cancelledOrCompletedWithErrors=!0,E("Cancel pending cells"),await Promise.all(this.queueOfCellsToExecute.map(e=>e.cancel())),this.lastCellExecution?.type==="cell"&&this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.push(...this.queueOfItemsToExecute.filter(e=>e.type==="code"))}async waitForCompletion(e){let t=e?this.queueOfCellsToExecute.filter(n=>e===n.cell):this.queueOfItemsToExecute;await Promise.all(t.map(n=>n.result))}startExecutingCells(){this.startedRunningCells||this.start().catch(f),this.startedRunningCells=!0}async start(){try{await this.executeQueuedCells()}catch(e){x("Failed to execute cells in CellExecutionQueue",e),this.cancelledOrCompletedWithErrors=!0,await this.cancelQueuedCells()}}async executeQueuedCells(){let e,t=await this.session;for(this.queueOfItemsToExecute.forEach(n=>n.type==="cell"&&yt(n.cell,"Ready to execute"));this.queueOfItemsToExecute.length;){this.lastCellExecution?.dispose();let n=this.queueOfItemsToExecute[0];this.lastCellExecution=n,n.type==="cell"&&yt(n.cell,"Before Execute individual cell");let i=!0;try{n.type==="cell"&&n.cell.notebook.isClosed?e=!0:n.type==="cell"&&this.cancelledOrCompletedWithErrors||(i=await n.start(t).then(()=>!0).catch(()=>!1))}finally{n.type==="cell"&&yt(n.cell,`After Execute individual cell ${i}`);let s=this.queueOfItemsToExecute.indexOf(n);s>=0&&this.queueOfItemsToExecute.splice(s,1),n.type==="cell"&&this._onPostExecute.fire(n.cell)}let o=!1;if(n.type==="cell"&&iP(n.cell).metadata?.tags?.includes("raises-exception")&&(o=!0),e||this.cancelledOrCompletedWithErrors||!i&&!o){this.cancelledOrCompletedWithErrors=!0;let s=[];if(this.cancelledOrCompletedWithErrors&&s.push("cancellation or failure in execution"),e&&s.push("Notebook being closed"),typeof i=="number"&&!i&&s.push("failure in cell execution"),s.length===0&&s.push("an unknown reason"),this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length===this.queueOfItemsToExecute.length){j(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancel();break}else if(this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length!==this.queueOfItemsToExecute.length)j(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancelQueuedCells();else if(e){j(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancel();break}}if(t.status==="dead"||t.status==="terminating"){this.cancelledOrCompletedWithErrors=!0,j("Cancel all remaining cells due to dead kernel"),await this.cancel();break}}}};function tl(r){if(typeof r!="string")throw new TypeError(`Expected a \`string\`, got \`${typeof r}\``);var e=eH();let t=e;return t.default&&(t=t.default),r.replace(t(),"")}var of=require("vscode");var Zhe=new Map([["julia",nge],["python",tge],["r",ige]]);function tH(r,e){let t=Zhe.get(e.toLowerCase());return t?t(r):r}var ege=["Docstring:","Options:","Parameters","Returns","See Also","Notes","Examples","Usage:","Subclasses:"];function tge(r){let e=Fe(r,{trim:!1,removeEmptyEntries:!1}),t=-1,n=!1,i=!1,o=[],s=new Set,a=!1,c="",l=!1,u=!1;if(e.map((m,h)=>{if(h===0){let b=["Signature:","Init signature:"].find(w=>m.toLowerCase().startsWith(w.toLowerCase()));if(b){n=!0,m=m.substring(b.length).trim(),o.push("```python"),m.trim().length&&(o.push(m),l=!0);return}}if(m.startsWith("File:")&&h===e.length-1||m.startsWith("Type:")&&h===0)return;if(!a&&m.toLowerCase().startsWith("String form:".toLowerCase())){i=!0;return}let g=ege.find(b=>m.trim().toLowerCase().startsWith(b.toLowerCase()));if(g&&!s.has(g)){c=g.toLowerCase(),s.add(g),a=!0,t=h,i=!1,n&&o.push("```","----------"),n=!1,u=!1,c!=="docstring:"&&o.push(`## ${g}`);let b=m.includes(":")?m.split(":")[1].replace("<no docstring>","").trim():"";b.length&&(o.push(b),l=!0);return}if(!i){if(t+1===h&&m.replace(/-/g,"").replace(/:/g,"").replace("<no docstring>","").trim().length===0){t=h,i=!1,n=!1,u=!1;return}if(c==="parameters"||c==="see also"){m.trim().length&&m.includes(":")&&m.substring(0,1)===m.trim().substring(0,1)?o.push(`* ${m}`):o.push(m),l=l||m.trim().length>0;return}if(c==="options:"){m.startsWith("-")&&m.trim().length&&m.includes(":")&&m.substring(0,1)===m.trim().substring(0,1)?o.push(`* ${m}`):o.push(m),l=l||m.trim().length>0;return}if(c==="returns"){m.trim().length&&m.substring(0,1)===m.trim().substring(0,1)?o.push(`* ${m}`):o.push(m),l=l||m.trim().length>0;return}if(c==="examples"&&!n&&(t+1===h||t+2===h))return i=!1,n=!0,l=l||m.trim().length>0,o.push("```python",m);if(!n&&m.startsWith("class ")&&m.trim().endsWith("):")){n=!0,u=!0,o.push("```python",m),l=l||m.trim().length>0;return}if(n&&u&&m.trim().length>0&&m.substring(0,1)!==" "&&m.substring(0,1)!=="	")return n=!1,u=!1,o.push(m,"```");l=l||m.trim().length>0,o.push(m)}}),!l)return"";let p=o.join(`  
`);return n?new of.MarkdownString(p+"  \n```"):new of.MarkdownString(p)}var rge=[{section:"Examples:",header:"Examples",nextLine:/≡/g},{section:"Usage note",header:"Usage note",nextLine:/≡/g},{section:"Note:",header:"\u2502 Note",nextLine:"\u2502"},{section:"Note:",header:"\u2502 Note",nextLine:String.fromCharCode(9474)}];function nge(r){let e=Fe(r,{trim:!1,removeEmptyEntries:!1}),t=!1,n=[],i=new Set,o="",s=!1,a=!1;e.every(l=>l.trim().length===0||l.startsWith("  "))&&e.forEach((l,u)=>e[u]=l.trim().length?l.substring(2):l),e.map((l,u)=>{if(l.trim()==="\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500")return a=!1,n.push(l);if(!a)return o="signature",t=!0,a=!0,l.trim().length?(s=!0,n.push("```julia",l)):n.push("```julia");o==="signature"&&l.trim()===""&&(o="",t=!1,s=!1,n.push("```"));let p=rge.find(m=>l.trim().toLowerCase().startsWith(m.header.toLowerCase()));if(p&&(typeof p.nextLine=="string"?e[u+1].trim()===p.nextLine.trim():e[u+1].trim().replace(p.nextLine,"").length===0)){e[u+1]="",o=p.section.toLowerCase(),i.add(p.header),t&&n.push("```"),t=!1,n.push(`## ${p.section}`),o==="note:"&&!e.slice(u+1).every(m=>m.trim().length===0||m.trim().startsWith("|")||m.trim().startsWith(String.fromCharCode(9474)))&&(o="");return}if(o==="examples:"&&!t)return t=!0,l.trim().length?(s=!0,n.push("```julia",l)):n.push("```julia");if(o==="note:"){n.push(l.trim()?l.trim().substring(1):"");return}t&&!s&&l.trim().length===0||n.push(l)});let c=n.join(`  
`);return t?new of.MarkdownString(c+"  \n```"):new of.MarkdownString(c)}function ige(r){let e=Fe(r,{trim:!1,removeEmptyEntries:!1}),t=[];e.forEach((a,c)=>e[c]=a.indexOf("     ")===0?a.substring(5):a);let n="",i=!1,o=!1;e.map(a=>{let c=a.replace(/_/g,"").trim();if(a.startsWith("_")&&a.includes(String.fromCharCode(8))&&a.split("_").length===a.split(String.fromCharCode(8)).length&&c){i&&t.push("```"),i=!1,n=c.trim().toLowerCase(),t.push(`## ${c}`);return}if((n==="examples"||n==="examples:"||n==="usage"||n==="usage:")&&!i)return i=!0,a.trim().length?(o=!0,t.push("```r",a)):t.push("```r");if(n==="note:"){t.push(a.trim()?a.trim().substring(1):"");return}i&&!o&&a.trim().length===0||t.push(a)});let s=t.join(`  
`);return i?new of.MarkdownString(s+"  \n```"):new of.MarkdownString(s)}var oge=5,sge=1,xy=Li.IntellisenseTimeout,rH=5,xF=new Set,nH=new WeakMap,CF=class extends Error{constructor(){super("Request timed out")}};async function sH(r,e,t,n,i,o,s,a){if(!r.range||!n.session?.kernel||xF.has(i)||n.status!=="idle")return r;let c=uge(e||r,s,a),l=lge(c,n.session.kernel,t);try{let u=await Tw(xy,new CF,fr(t,l));if(!t.isCancellationRequested&&u?.status==="ok"&&u?.found){let p=age(u);r.documentation=tH(p,o)}}catch{cge(n,o)}return r}function age(r){return!r||r.status!=="ok"||!r.found?";":!r.data||typeof r.data!="object"?"":"text/plain"in r.data?tl(r.data["text/plain"]):""}var iH=new Set;function cge(r,e){let t=r.kernelConnectionMetadata.id;if(xF.has(t))return;let n=nH.get(r)||0;if(n+=1,nH.set(r,n),n>=oge){j(`Failed to inspect code in kernel ${mt(r.kernelConnectionMetadata)} ${n} times.}`),iH.has(t)||(iH.add(t),A("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",void 0,{kernelId:t,kernelConnectionType:r.kernelConnectionMetadata.kind,kernelLanguage:e})),xF.add(t);return}}var oH=new WeakMap,SF=new WeakMap;async function lge(r,e,t){let n=JSON.stringify(r),i=oH.get(e)||new Map;oH.set(e,i);let o=i.get(n);if(o)return JSON.parse(JSON.stringify(o));let s=SF.get(e)||{maxTime:0,lastRequestTime:0,numberOfTimesMaxedOut:0};if(s.numberOfTimesMaxedOut>rH)return j(`Not sending inspect request as there have been at least ${rH} requests that took over ${xy}s.`),{data:{},found:!1,status:"ok",metadata:{}};if(s.maxTime>xy&&Date.now()-s.lastRequestTime<3e4)return j(`Not sending inspect request as previous requests took over ${xy}s.`),{data:{},found:!1,status:"ok",metadata:{}};if(wF(e)&&(z(`Too many pending requests ${pge(e)} for kernel ${e.id}, waiting for it to be ready.`),await fr(t,mge(e,t))),t.isCancellationRequested)return Promise.resolve({data:{},found:!1,status:"ok",metadata:{}});let a=dge(e),c=new qe,l=Fe(r.code).reverse()[0].slice(-50);return E(`Inspecting code ${l}`),e.requestInspect(r).finally(()=>a.dispose()).then(({content:p})=>{i.size>100&&i.clear(),i.set(n,JSON.parse(JSON.stringify(p)));let m=c.elapsedTime,h=SF.get(e)||{maxTime:0,lastRequestTime:0,numberOfTimesMaxedOut:0};h.maxTime=Math.max(h.maxTime,m),h.lastRequestTime=Date.now(),m>xy&&(h.numberOfTimesMaxedOut+=1),SF.set(e,h);let g=m>xy?j:E;return t.isCancellationRequested?g(`Inspected code ${l} in ${m}ms (but cancelled)`):g(`Inspected code ${l} in ${m}ms`),p})}function uge(r,e,t){let n=e.getText(),i=(typeof r.insertText=="string"?r.insertText:r.insertText?.value)||(typeof r.label=="string"?r.label:r.label.label)||"",o=n.substring(0,t.character)+i,s=t.character+i.length;return{code:o,cursor_pos:s,detail_level:0}}var Ea=new WeakMap;function wF(r){return Ea.has(r)||Ea.set(r,{count:0}),(Ea.get(r)?.count||0)>=sge}function pge(r){return Ea.has(r)||Ea.set(r,{count:0}),Ea.get(r)?.count||0}function dge(r){let e=Ea.get(r)||{count:0};return Ea.set(r,e),e.count+=1,{dispose:()=>{e.count-=1}}}async function mge(r,e){let t=[];await fr(e,new Promise(n=>{let i=()=>{wF(r)||(n(),Q(t))},o=setInterval(()=>{wF(r)||(n(),Q(t))},50);hm(e.onCancellationRequested)(()=>{n(),r.statusChanged.disconnect(i)},void 0,t),r.statusChanged.connect(i),t.push({dispose:()=>{clearInterval(o),r.statusChanged.disconnect(i)}})}))}var MD=class{constructor(e,t,n,i){this.kernel=e;this.notebook=i;this.disposables=[];this._visibleExecutionCount=0;this._onPreExecute=new js.EventEmitter;this.onPreExecute=this._onPreExecute.event;this._onPostExecute=new js.EventEmitter;this.onPostExecute=this._onPostExecute.event;this.documentExecutions=new WeakMap;let o=new TD(e.controller,t,n,i);this.disposables.push(o),this.executionFactory=new DD(e.controller,o),js.notebooks.onDidChangeNotebookCellExecutionState(s=>{s.cell.notebook===e.notebook&&s.state===js.NotebookCellExecutionState.Idle&&s.cell.executionSummary?.executionOrder&&(this._visibleExecutionCount=Math.max(this._visibleExecutionCount,s.cell.executionSummary.executionOrder))}),e.onRestarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.onStarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.addHook("willInterrupt",this.onWillInterrupt,this,this.disposables),e.addHook("willCancel",this.onWillCancel,this,this.disposables),e.addHook("willRestart",s=>this.onWillRestart(s),this,this.disposables),this.disposables.push(this._onPreExecute)}get executionCount(){return this._visibleExecutionCount}get pendingCells(){return this.documentExecutions.get(this.notebook)?.queue||[]}async resumeCellExecution(e,t){if(yt(e,`NotebookKernelExecution.resumeCellExecution (start), ${W(e.notebook.uri)}`),e.kind==js.NotebookCellKind.Markup)return;await Yo(this.kernel.resourceUri,this.kernel.kernelConnectionMetadata),Rt(this.kernel.resourceUri,"DATASCIENCE.RESUME_EXECUTE_CELL");let n=this.kernel.start(new Yt(!1)),i=this.getOrCreateCellExecutionQueue(e.notebook,n);i.resumeCell(e,t);let o=await i.waitForCompletion(e).then(()=>!0).catch(()=>!1);yt(e,`NotebookKernelExecution.resumeCellExecution (completed), ${W(e.notebook.uri)}`),E(`Cell ${e.index} executed ${o?"successfully":"with an error"}`)}async executeCell(e,t){yt(e,`NotebookKernelExecution.executeCell (1), ${W(e.notebook.uri)}`);let n=this.kernel.session?.kernel&&Ea.get(this.kernel.session.kernel)?.count||0,i=new qe;if(e.kind==js.NotebookCellKind.Markup)return;yt(e,`NotebookKernelExecution.executeCell, ${W(e.notebook.uri)}`),await Yo(this.kernel.resourceUri,this.kernel.kernelConnectionMetadata);let o=this.kernel.start(new Yt(!1));await this.kernel.restarting,yt(e,`NotebookKernelExecution.executeCell (2), ${W(e.notebook.uri)}`);let s=this.getOrCreateCellExecutionQueue(e.notebook,o);s.queueCell(e,t);let a=!0;try{await s.waitForCompletion(e)}catch(c){throw a=!1,c}finally{yt(e,`NotebookKernelExecution.executeCell completed (3), ${W(e.notebook.uri)}`),E(`Cell ${e.index} executed ${a?"successfully":"with an error"}`);let c=this.kernel.session?.kernel&&Ea.get(this.kernel.session.kernel)?.count||0;Rt(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CELL",{duration:i.elapsedTime,pendingInspectRequestsAfter:c,pendingInspectRequestsBefore:n})}}async*executeCode(e,t,n,i){let o=new qe;await Yo(this.kernel.resourceUri,this.kernel.kernelConnectionMetadata);let s=this.kernel.start(new Yt(!1));await this.kernel.restarting;let c=this.getOrCreateCellExecutionQueue(this.notebook,s).queueCode(e,t,i);E(`Queue code ${c.executionId} from ${t} after ${o.elapsedTime}ms:
${e}`);let l=!1,u=[];c.result.finally(()=>{l=!0,!i.isCancellationRequested&&z(`Execution of code ${c.executionId} completed in ${o.elapsedTime}ms`),Rt(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CODE",{duration:o.elapsedTime},{extensionId:t}),Q(u)}).catch(f);let p=ds(c.result),m=[],h=ue();for(u.push(c.onRequestSent(()=>n.started.fire())),u.push(c.onRequestAcknowledged(()=>n.executionAcknowledged.fire())),c.onDidEmitOutput(g=>{m.push(g),h.resolve(),h=ue()},this,u),i.onCancellationRequested(()=>{l||E(`Code execution cancelled by extension ${t}`)},this,u);;){for(await Promise.race([h.promise,p.promise]),l&&(h=ue());m.length;)yield m.shift();if(p.completed)break}}executeHidden(e){return this.kernel.start().then(n=>n.kernel?vn(n.kernel,e):Promise.reject(new gn))}async onWillInterrupt(){let e=this.documentExecutions.get(this.notebook);!e&&this.kernel.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||(z("Interrupt kernel execution"),e&&(await e.cancel(),await e.waitForCompletion().catch(f)))}async onWillCancel(){let e=this.documentExecutions.get(this.notebook);e&&await e.cancel(!0)}async onWillRestart(e){let t=this.documentExecutions.get(this.notebook),n=e?await e.catch(()=>{}):void 0,i=t?t.cancel(!0).then(()=>t.waitForCompletion().catch(f)):Promise.resolve();n||(z("No kernel session to interrupt"),await i)}getOrCreateCellExecutionQueue(e,t){let n=this.documentExecutions.get(e);if(n&&!n.isEmpty&&!n.failed)return n;let i=new ND(t,this.executionFactory,this.kernel.kernelConnectionMetadata,this.kernel.resourceUri);return this.disposables.push(i),js.workspace.onDidCloseNotebookDocument(async o=>{o===e&&(E(`Cancel executions after closing notebook ${W(o.uri)}`),(!i.failed||!i.isEmpty)&&await i.cancel(!0))},this,this.disposables),i.onPreExecute(o=>this._onPreExecute.fire(o),this,this.disposables),i.onPostExecute(o=>this._onPostExecute.fire(o),this,this.disposables),this.documentExecutions.set(e,i),i}};var Cy=class extends bD{constructor(t,n,i,o,s,a,c,l,u){super(t,n);this.sessionCreator=i;this.configService=o;this.context=s;this.formatters=c;this.startupCodeProviders=l;this.workspaceStorage=u;n.push(a.onDidRemove(this.handleServerRemoval.bind(this)))}getOrCreate(t,n){let i=this.getInternal(t);if(i&&i.options.metadata.id===n.metadata.id)return i.kernel;this.disposeOldKernel(t);let o=t.notebookType===gt?n.resourceUri:t.uri,s=vF(this.configService,o),a=t.uri.path.endsWith(".interactive")||n.resourceUri?.path.endsWith(".interactive")?gt:bt,c=new ED(o,t,n.metadata,this.sessionCreator,s,n.controller,this.startupCodeProviders.getProviders(a),this.workspaceStorage);return c.onRestarted(()=>this._onDidRestartKernel.fire(c),this,this.disposables),c.onDisposed(()=>{this._onDidDisposeKernel.fire(c)},this,this.disposables),c.onStarted(()=>this._onDidStartKernel.fire(c),this,this.disposables),c.onStatusChanged(l=>this._onKernelStatusChanged.fire({kernel:c,status:l}),this,this.disposables),this.executions.set(c,new MD(c,this.context,this.formatters,t)),this.asyncDisposables.push(c),this.storeKernel(t,n,c),this.deleteMappingIfKernelIsDisposed(c),c}};Cy=v([(0,pn.injectable)(),d(0,(0,pn.inject)(ni)),d(1,(0,pn.inject)(F)),d(2,(0,pn.inject)(tx)),d(3,(0,pn.inject)(le)),d(4,(0,pn.inject)(lt)),d(5,(0,pn.inject)(er)),d(6,(0,pn.multiInject)(Qh)),d(7,(0,pn.inject)(Fo)),d(8,(0,pn.inject)($e)),d(8,(0,pn.named)(ri))],Cy);var wy=class extends ID{constructor(t,n,i,o,s,a){super(t,n);this.sessionCreator=i;this.configService=o;this.startupCodeProviders=s;this.workspaceStorage=a}getOrCreate(t,n){let i=this.getInternal(t);if(i&&i.options.metadata.id===n.metadata.id)return i.kernel;this.disposeOldKernel(t);let o=t,s=vF(this.configService,o),a=o.path.endsWith(".interactive")?gt:bt,c=new wD(t,o,n.metadata,this.sessionCreator,s,this.startupCodeProviders.getProviders(a),this.workspaceStorage);return c.onRestarted(()=>this._onDidRestartKernel.fire(c),this,this.disposables),c.onDisposed(()=>{this._onDidDisposeKernel.fire(c)},this,this.disposables),c.onStarted(()=>this._onDidStartKernel.fire(c),this,this.disposables),c.onStatusChanged(l=>this._onKernelStatusChanged.fire({kernel:c,status:l}),this,this.disposables),this.asyncDisposables.push(c),this.storeKernel(t,n,c),this.deleteMappingIfKernelIsDisposed(t,c),c}};wy=v([(0,pn.injectable)(),d(0,(0,pn.inject)(ni)),d(1,(0,pn.inject)(F)),d(2,(0,pn.inject)(tx)),d(3,(0,pn.inject)(le)),d(4,(0,pn.inject)(Fo)),d(5,(0,pn.inject)($e)),d(5,(0,pn.named)(ri))],wy);var sf=_(O()),uu=require("vscode");var Ey=class{constructor(e,t,n,i){this.extensionChecker=t;this.interpreterService=n;this.kernelFinder=i;this.refreshedOnceBefore=!1;this.disposables=[];e.push(this)}dispose(){Q(this.disposables)}activate(){this.extensionChecker.isPythonExtensionInstalled?this.startRefreshWithPython():(this.startRefreshWithoutPython(),this.extensionChecker.onPythonExtensionInstallationStatusChanged(()=>{this.extensionChecker.isPythonExtensionInstalled&&this.startRefreshWithPython()},this,this.disposables))}startRefreshWithoutPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=()=>{let t=Date.now().toString();z(`Start refreshing Kernel Picker (${t})`);let n=uu.notebooks.createNotebookControllerDetectionTask(bt),i=uu.notebooks.createNotebookControllerDetectionTask(gt);this.disposables.push(n),this.disposables.push(i),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"&&(z(`End refreshing Kernel Picker (${t})`),n.dispose(),i.dispose())},this,this.disposables)};if(this.kernelFinder.status==="discovering")return e();this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="discovering"&&e()},this,this.disposables)}startRefreshWithPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=!1;uu.window.onDidChangeActiveNotebookEditor(o=>{!e&&o&&Tt(o.notebook)&&(e=!0,z("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(f))},this,this.disposables),uu.workspace.onDidOpenNotebookDocument(o=>{!e&&Tt(o)&&(e=!0,z("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(f))},this,this.disposables);let t,n="",i=()=>(t&&!t.isDisposed||(n=Date.now().toString(),z(`Start refreshing Kernel Picker (${n})`),t=new ma(uu.notebooks.createNotebookControllerDetectionTask(bt),uu.notebooks.createNotebookControllerDetectionTask(gt)),this.disposables.push(t)),t);this.kernelFinder.status==="idle"?(z(`End refreshing Kernel Picker (${n})`),t?.dispose()):i(),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"?(z(`End refreshing Kernel Picker (${n})`),t?.dispose()):i()},this,this.disposables)}};Ey=v([(0,sf.injectable)(),d(0,(0,sf.inject)(F)),d(1,(0,sf.inject)(ze)),d(2,(0,sf.inject)(tt)),d(3,(0,sf.inject)(Rr))],Ey);var aH=_(O());var Py=class{constructor(){this.providers=new Map}getProviders(e){return(this.providers.get(e)||[]).slice()}register(e,t){this.providers.set(t,this.providers.get(t)||[]),this.providers.get(t).push(e)}};Py=v([(0,aH.injectable)()],Py);var fC=_(O());var ky=class{constructor(e,t){this.kernelProvider=e;this.disposables=t}activate(){this.kernelProvider.onDidCreateKernel(e=>this.addOnStartHooks(e),this,this.disposables)}addOnStartHooks(e){e.addHook("didStart",async t=>{t&&await f$(t,e.resourceUri,e.kernelConnectionMetadata)},this,this.disposables)}};ky=v([(0,fC.injectable)(),d(0,(0,fC.inject)(Ke)),d(1,(0,fC.inject)(F))],ky);var hC=_(O());var cH=require("vscode");var _y=class{constructor(e,t){this.kernelProvider=e;this.disposables=[];this.restartProgress=new WeakMap;this.interruptProgress=new WeakMap;t.push(this)}dispose(){Q(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.kernelProvider.onDidDisposeKernel(e=>{this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables)}onDidCreateKernel(e){e.addHook("willRestart",async()=>{this.restartProgress.get(e)?.dispose();let t=ht.createProgressReporter(e.resourceUri,y.restartingKernelStatus(`: ${mt(e.kernelConnectionMetadata)}`));this.restartProgress.set(e,t)},this,this.disposables),e.addHook("restartCompleted",async()=>{this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables),e.addHook("willInterrupt",async()=>{let t=new ma,n=setTimeout(()=>{t.isDisposed||t.add(ht.createProgressReporter(e.resourceUri,y.interruptKernelStatus(mt(e.kernelConnectionMetadata))))},1e3);t.add(new cH.Disposable(()=>clearTimeout(n))),this.interruptProgress.set(e,t)},this,this.disposables),e.addHook("interruptCompleted",async()=>this.interruptProgress.get(e)?.dispose(),this,this.disposables)}};_y=v([(0,hC.injectable)(),d(0,(0,hC.inject)(Ke)),d(1,(0,hC.inject)(F))],_y);var OD=_(O()),lH=require("vscode"),KD=require("vscode");var Dy=class{constructor(e){this.disposables=e}activate(){try{this.disposables.push(lH.workspace.registerPortAttributesProvider({},this))}catch(e){x("Failure in registering port attributes",e)}}providePortAttributes(e,t){try{if(xo.has(e.port))return new KD.PortAttributes(KD.PortAutoForwardAction.Ignore)}catch(n){x("Failure in returning port attributes",n)}}};Dy=v([(0,OD.injectable)(),d(0,(0,OD.inject)(F))],Dy);var du=_(O()),vC=require("vscode");var ka=_(O()),gC=require("vscode");var Pa=require("vscode");var fge=/python\s\d*.?\d*$/,EF="__old_vscode_kernelspecs",PF=class{constructor(e,t,n){this.fs=e;this.globalState=t;this.jupyterPaths=n;this.findKernelSpecsInPathCache=new Map;this.pathToKernelSpec=new Map;this.disposables=[];this.oldKernelSpecsFolder&&E(`Old kernelSpecs (created by Jupyter Extension) stored in directory ${this.oldKernelSpecsFolder}`)}get oldKernelSpecsFolder(){return this._oldKernelSpecsFolder||this.globalState.get("OLD_KERNEL_SPECS_FOLDER__","")}set oldKernelSpecsFolder(e){this._oldKernelSpecsFolder=e,this.globalState.update("OLD_KERNEL_SPECS_FOLDER__",e).then(f,f)}clearCache(){this.pathToKernelSpec.clear(),this.findKernelSpecsInPathCache.clear()}dispose(){Q(this.disposables)}async loadKernelSpec(e,t,n){if(e.fsPath.includes(EF))return;let i=fn(e);if(!this.pathToKernelSpec.has(i)){let o=this.loadKernelSpecImpl(e,t,n).then(async s=>{let a=await this.jupyterPaths.getKernelSpecRootPath(),c=s&&a&&Mn(s)&&s.specFile&&TS(Pa.Uri.file(s.specFile),a);if(s&&!c)return s;s?.specFile&&c&&this.deleteOldKernelSpec(s.specFile).catch(f),this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i),this.cache=this.cache?.filter(l=>bi(l.kernelSpecFile,e))});this.pathToKernelSpec.set(i,o),o.finally(()=>{t.isCancellationRequested&&this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i)}).catch(f)}return this.pathToKernelSpec.get(i)}async deleteOldKernelSpec(e){let t=De(pt(e)),n=Ve(pt(pt(e)),EF);this.oldKernelSpecsFolder=n;let i=Ve(n,t,De(e));await this.fs.createDirectory(Pa.Uri.file(pt(i))),await this.fs.copy(Pa.Uri.file(e),Pa.Uri.file(i)).catch(f),await this.fs.delete(Pa.Uri.file(e)),E(`Old KernelSpec '${e}' deleted and backup stored in ${n}`)}async loadKernelSpecImpl(e,t,n){return hge(e,this.fs,t,n)}async findKernelSpecsInPaths(e,t){let n=fn(e),i=this.findKernelSpecsInPathCache.get(n);if(i)return i;let o=(async()=>await this.fs.exists(e)?t.isCancellationRequested?[]:(await this.fs.searchLocal("**/kernel.json",e.fsPath,!0)).map(c=>sr(e,c)):[])();this.findKernelSpecsInPathCache.set(n,o);let s=t.onCancellationRequested(()=>{this.findKernelSpecsInPathCache.get(n)===o&&this.findKernelSpecsInPathCache.delete(n)});return o.finally(()=>{t.isCancellationRequested&&this.findKernelSpecsInPathCache.get(n)===o&&this.findKernelSpecsInPathCache.delete(n),s.dispose()}).catch(f),o.catch(a=>{this.findKernelSpecsInPathCache.get(n)===o&&this.findKernelSpecsInPathCache.delete(n),E(`Failed to search for kernels in ${W(e)} with an error`,a)}),o}},Ty=class{constructor(e,t,n,i,o,s){this.fs=e;this.extensionChecker=t;this.memento=n;this.env=o;this.jupyterPaths=s;this.disposables=[];this._status="idle";this.promiseMonitor=new co;this._onDidChangeStatus=new Pa.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeKernels=new Pa.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;i.push(this),this.disposables.push(this.promiseMonitor),this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.kernelSpecFinder=new PF(e,n,s),this.disposables.push(this.kernelSpecFinder)}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}clearCache(){this.kernelSpecFinder.clearCache()}async listKernelsFirstTimeFromMemento(e){let t=(async()=>{let n=this.memento.get(e,JSON.stringify({kernels:[],extensionVersion:""})),i=JSON.parse(n),o=[];i&&Array.isArray(i.kernels)&&i.extensionVersion===this.env.extensionVersion&&(o=i.kernels.map(a=>xs.fromJSON(a)));let s=[];return await Promise.all(o.map(async a=>{await this.isValidCachedKernel(a)&&s.push(a)})),s})();return this.promiseMonitor.push(t),t}async writeToMementoCache(e,t){await this.memento.update(t,JSON.stringify({kernels:e.map(n=>n.toJSON()),extensionVersion:this.env.extensionVersion}))}async isValidCachedKernel(e){switch(e.kind){case"startUsingPythonInterpreter":return this.fs.exists(e.interpreter.uri);case"startUsingLocalKernelSpec":return(e.kernelSpec.specFile?this.fs.exists(Pa.Uri.file(e.kernelSpec.specFile)):Promise.resolve(!0)).then(n=>n&&e.interpreter?this.fs.exists(e.interpreter.uri):Promise.resolve(!0))}}};async function hge(r,e,t,n){if(r.fsPath.includes(EF))return;let i;try{E(`Loading kernelspec from ${W(r)} ${n?.uri?`for ${W(n.uri)}`:""}`),i=JSON.parse(await e.readFile(r))}catch(l){x(`Failed to parse kernelspec ${r}`,l);return}if(t.isCancellationRequested||(i.name=n?await CN(n):i.name,t.isCancellationRequested))return;if(!i.display_name.toLowerCase().match(fge)&&i.language===xe&&i.argv.length>2){let l=i.argv.slice(1).map(u=>u.toLowerCase()).filter(u=>!["-m","ipykernel","ipykernel_launcher","-f","{connection_file}"].includes(u));l.length&&(i.name=`${i.name}.${l.join("#")}`)}i.metadata=i.metadata||{},i.metadata.vscode=i.metadata.vscode||{},i.metadata.vscode.originalSpecFile||(i.metadata.vscode.originalSpecFile=r.fsPath),i.metadata.vscode.originalDisplayName||(i.metadata.vscode.originalDisplayName=i.display_name),i.metadata.originalSpecFile&&(i.metadata.vscode.originalSpecFile=i.metadata.originalSpecFile,delete i.metadata.originalSpecFile);let s=new sp(i,r.fsPath,n?.uri.fsPath||i?.metadata?.interpreter?.path,Mn(i));s.name=i?.name||De(pt(r.fsPath));let a=n?.uri.fsPath||i?.metadata?.interpreter?.path,c=!!n?.isCondaEnvWithoutPython;if(!(a&&!c&&!await e.exists(Pa.Uri.file(a))))return i.isRegisteredByVSC=Mn(i),s}function uH(){return`LOCAL_KERNEL_SPECS_CACHE_KEY_V_2023_2:${gC.env.appHost}:${gC.env.remoteName||""}`}var ts=class extends Ty{constructor(t,n,i,o,s,a){super(t,i,o,s,a,n);this._kernels=new Map}activate(){this.listKernelsFirstTimeFromMemento(uH()).then(t=>{this._kernels.size===0&&t.length&&(t.forEach(n=>this._kernels.set(n.id,n)),this._onDidChangeKernels.fire())}).catch(f),this.refresh().then(f,f)}get kernels(){return Array.from(this._kernels.values())}dispose(){this._onDidChangeKernels.dispose()}async refresh(){this.clearCache(),await this.refreshData()}async refreshData(){let t=new gC.CancellationTokenSource;try{await this.listKernelSpecs(t.token)}finally{t.dispose()}}writeKernelsToMemento(){this.writeToMementoCache(Array.from(this._kernels.values()),uH()).catch(f)}async listKernelSpecs(t){let i=(async()=>{let o=await this.findKernelSpecs(t);if(t.isCancellationRequested)return[];let s=Array.from(this._kernels.values()).sort((u,p)=>u.id.localeCompare(p.id)),a=o.sort((u,p)=>u.id.localeCompare(p.id)),c=new Set(o.map(u=>u.id)),l=s.filter(u=>!c.has(u.id));return o.forEach(u=>this._kernels.set(u.id,u)),l.length&&(E(`Local kernel spec connection deleted ${l.map(u=>`${u.kind}:'${u.id}'`)}`),l.forEach(u=>this._kernels.delete(u.id))),(s.length!==a.length||l.length||JSON.stringify(s)!==JSON.stringify(a))&&(this._onDidChangeKernels.fire(),this.writeKernelsToMemento()),o})();return this.promiseMonitor.push(i),i}async findKernelSpecs(t){let n=await this.jupyterPaths.getKernelSpecRootPaths(t);if(t.isCancellationRequested)return[];let i=await Promise.all(n.map(c=>this.kernelSpecFinder.findKernelSpecsInPaths(c,t)));if(t.isCancellationRequested)return[];let o=new Set,s=[],a=new Map;return await Promise.all(i.flat().map(async c=>{try{let l=await this.kernelSpecFinder.loadKernelSpec(c,t);if(!l||t.isCancellationRequested)return;if(oD(l,"local"),l.metadata?.originalSpecFile){if(o.has(l.metadata.originalSpecFile))return;o.add(l.metadata.originalSpecFile)}if(l.specFile){if(o.has(l.specFile))return;o.add(l.specFile)}let u=a.get(l.display_name),p=op.create({kernelSpec:l,interpreter:void 0,id:Pi(l)});u&&u.executable!==l.executable?(s.push(p),Ao(p,this._kernels.get(p.id))||(this._kernels.set(p.id,p),this._onDidChangeKernels.fire(),this.writeKernelsToMemento())):u?j(`Duplicate kernel found ${l.display_name} ${l.executable} in ${l.specFile}`):(s.push(p),a.set(l.display_name,l),Ao(p,this._kernels.get(p.id))||(this._kernels.set(p.id,p),this._onDidChangeKernels.fire(),this.writeKernelsToMemento()))}catch(l){x(`Failed to load kernelSpec for ${c}`,l);return}})),s}};v([xv(100)],ts.prototype,"writeKernelsToMemento",1),ts=v([(0,ka.injectable)(),d(0,(0,ka.inject)(gr)),d(1,(0,ka.inject)(Fr)),d(2,(0,ka.inject)(ze)),d(3,(0,ka.inject)($e)),d(3,(0,ka.named)(St)),d(4,(0,ka.inject)(F)),d(5,(0,ka.inject)(Rc))],ts);var Eo=_(O()),pH=require("vscode");var ad=Symbol("ITrustedKernelPaths");var Qn=require("vscode");function kF(){return`LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2023_3:${Qn.env.appHost}:${Qn.env.remoteName||""}`}async function gge(r,e,t,n,i){let o=await pa(r);if(!o){j(`Failed to get sysPrefix for interpreter ${un(r.id)}`);return}let s=Qn.Uri.file(Ve(o,u$)),a=await t.getKernelSpecRootPaths(e);if(e.isCancellationRequested||a.some(p=>bi(p,s)))return;let c=await n.findKernelSpecsInPaths(s,e);if(e.isCancellationRequested)return;let l=new Set,u=new Map;await Promise.all(c.map(async p=>{try{let m=await n.loadKernelSpec(p,e,r);if(e.isCancellationRequested||!m)return;if(m.metadata?.originalSpecFile){if(l.has(m.metadata.originalSpecFile))return;l.add(m.metadata.originalSpecFile)}if(m.specFile){if(l.has(m.specFile))return;l.add(m.specFile)}let h=u.get(m.display_name);h&&h.executable!==m.executable?i.fire(m):h||(u.set(m.display_name,m),i.fire(m))}catch(m){x(`Failed to load kernel spec ${p}`,m)}}))}var FD=class extends Zt{constructor(t,n,i,o,s){super();this.interpreter=t;this.interpreterService=n;this.jupyterPaths=i;this.extensionChecker=o;this.kernelSpecFinder=s;this.cancelToken=new Qn.CancellationTokenSource;this._kernels=new Map;this._onDidChangeKernels=this._register(new Qn.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this.lastKnownInterpreterVersion=$i(t),this.lastKnownInterpreterSysPrefix=QS(t),this._register({dispose:()=>this.cancelToken.cancel()}),this._register(this.cancelToken),this._register(this.interpreterService.onDidChangeInterpreter(this.clearCacheWhenInterpretersChange,this)),this._register(this.interpreterService.onDidChangeInterpreters(this.clearCacheWhenInterpretersChange,this))}async listKernelSpecs(t){return this.extensionChecker.isPythonExtensionInstalled?!t&&this.kernelSpecPromise?this.kernelSpecPromise:(this.cancelToken.cancel(),this.cancelToken.dispose(),this.cancelToken=this._register(new Qn.CancellationTokenSource),this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise.then(()=>E(`Kernels for interpreter ${this.interpreter.id} are ${Array.from(this._kernels.keys()).join(", ")}`)),this.kernelSpecPromise):[]}clearCacheWhenInterpretersChange(){let t=this.interpreterService.resolvedEnvironments.find(o=>o.id===this.interpreter.id);if(!t)return;let n=$i(t),i=QS(t);(this.interpreter.envPath!==t.envPath||this.lastKnownInterpreterVersion?.sysVersion!==n?.sysVersion||this.interpreter.envType!==t.envType||this.lastKnownInterpreterSysPrefix!==i)&&(this.lastKnownInterpreterVersion=n,this.lastKnownInterpreterSysPrefix=i,this.listKernelSpecs(!0).catch(f))}async listKernelSpecsImpl(){let t=this.cancelToken.token;E(`Search for KernelSpecs in Interpreter ${un(this.interpreter.uri)}`);let n=new Map,i=new Qn.EventEmitter,o=i.event(p=>{if(t.isCancellationRequested)return;if(p.language===xe&&(!p.env||Object.keys(p.env).length===0)&&uP(p)){E(`Hiding default kernel spec '${p.display_name}', '${p.name}', ${un(p.argv[0])} for interpreter ${un(p.interpreterPath)} and spec ${un(p.specFile)}`);return}let m=$m(p)?Ko.create({kernelSpec:p,interpreter:this.interpreter,id:Pi(p,this.interpreter)}):op.create({kernelSpec:p,interpreter:this.interpreter,id:Pi(p,this.interpreter)});m&&!this._kernels.has(m.id)&&(this._kernels.set(m.id,m),this._onDidChangeKernels.fire({added:[m],removed:[]})),m&&!n.has(m.id)&&n.set(m.id,m)}),[s]=await Promise.all([this.jupyterPaths.getKernelSpecTempRegistrationFolder(),gge(this.interpreter,t,this.jupyterPaths,this.kernelSpecFinder,i)]);if(i.dispose(),o.dispose(),t.isCancellationRequested)return;let c=await Es(this.interpreter,s);if(t.isCancellationRequested)return;let l=Ko.create({kernelSpec:c,interpreter:this.interpreter,id:Pi(c,this.interpreter)});this._kernels.has(l.id)||(this._kernels.set(l.id,l),this._onDidChangeKernels.fire({added:[l],removed:[]})),n.has(l.id)||n.set(l.id,l);let u=Array.from(this._kernels.keys()).filter(p=>!n.has(p)).map(p=>this._kernels.get(p));u.forEach(p=>this._kernels.delete(p.id)),this._onDidChangeKernels.fire({added:[],removed:u})}},LD=class r{constructor(e,t,n,i){this.interpreterService=e;this.kernelSpecsFromKnownLocations=t;this.extensionChecker=n;this.trustedKernels=i;this.kernelsPerInterpreter=new Map;this.disposables=[];this.cancelToken=new Qn.CancellationTokenSource;this.lastKnownGlobalPythonKernelSpecs=[];t.onDidChangeKernels(()=>{let o=this.lastKnownGlobalPythonKernelSpecs,s=this.listGlobalPythonKernelSpecs();if(o.length!==s.length||!Ao(o,s)){this.kernelSpecPromise=void 0;return}})}static{this.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo=new Set}dispose(){Q(this.disposables),this.cancelToken.dispose()}async listKernelSpecs(e){return this.extensionChecker.isPythonExtensionInstalled?!e&&this.kernelSpecPromise?this.kernelSpecPromise:(this.clear(),this.cancelToken=new Qn.CancellationTokenSource,this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise):[]}clear(){this.kernelsPerInterpreter.clear(),this.cancelToken.cancel(),this.cancelToken.dispose(),this.kernelSpecPromise=void 0}async findMatchingInterpreter(e,t,n){let i=this.extensionChecker.isPythonExtensionInstalled?this.interpreterService.resolvedEnvironments:[],o=e&&Array.isArray(e.argv)&&e.argv.length>0?e.argv[0]:void 0,s=e.language||"",a=e.specFile?await vt(e.specFile):"",c=!!Mn(e);if(e.language&&e.language!==xe){!c&&o&&e.specFile&&V_(o)&&A("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:De(o)!==o,argv0:De(o),language:s,isCreatedByUs:c});return}let l=i.find(u=>e.metadata?.interpreter?.path&&Oo(Qn.Uri.file(e.metadata.interpreter.path),u.uri)?(E(`Kernel ${e.name} matches ${un(u.id)} based on metadata.interpreter.`),!0):!1);if(l)return l;if(o&&De(o)===o&&e.specFile&&!c&&A("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!1,argv0:De(o),language:s,isCreatedByUs:c}),o&&De(o)!==o){let u=Qn.Uri.file(o),p=i.find(m=>Oo(u,m.uri)?(E(`Kernel ${e.name} matches ${un(m.id)} based on argv.`),!0):!1);if(p)return e.specFile&&!c&&A("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:De(o),pythonEnvFound:"found",language:s,isCreatedByUs:c}),p;if(!e.specFile||this.trustedKernels.isTrusted(Qn.Uri.file(e.specFile))){let m=await this.interpreterService.getInterpreterDetails(u,n);if(n?.isCancellationRequested)return;if(m)return e.specFile&&!c&&A("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:De(o),pythonEnvFound:"foundViaGetEnvDetails",language:s,isCreatedByUs:c}),m;e.specFile&&!c&&A("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:De(o),pythonEnvFound:"notFound",language:s,isCreatedByUs:c})}else e.specFile&&!c&&A("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:De(o),pythonEnvFound:"notTrusted",language:s,isCreatedByUs:c})}if(e.interpreterPath){let u=Qn.Uri.file(e.interpreterPath),p=i.find(m=>e.interpreterPath&&Oo(u,m.uri)?(E(`Kernel ${e.name} matches ${un(m.id)} based on interpreterPath.`),!0):!1);if(p)return p;if(!e.specFile||this.trustedKernels.isTrusted(Qn.Uri.file(e.specFile))){let m=await this.interpreterService.getInterpreterDetails(u,n);if(m)return m}}if(!n?.isCancellationRequested)return i.find(u=>e.display_name===u.displayName?(E(`Kernel ${e.name} matches ${un(u.id)} based on display name`),A("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:o?De(o):"",pythonEnvFound:"matchDisplayName",language:s,isCreatedByUs:c}),!0):!1)}listGlobalPythonKernelSpecs(){return this.lastKnownGlobalPythonKernelSpecs=this.kernelSpecsFromKnownLocations.kernels.filter(e=>e.kernelSpec.language===xe)}warnAboutPythonKernelSpecWithInvalidPythonExec(e){let t=e.specFile||JSON.stringify(e);r.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.has(t)||(r.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.add(t),j(`Kernel Spec for '${e.display_name}' (${un(e.specFile)}) hidden, as we cannot find a matching interpreter argv = '${e.argv[0]}'. To resolve this, please change '${e.argv[0]}' to point to the fully qualified Python executable.`))}async listKernelSpecsImpl(){E("Finding Global Python KernelSpecs");let e=this.cancelToken.token,t=this.listGlobalPythonKernelSpecs().filter(s=>!Mn(s.kernelSpec)),n=s=>{if(s.kernelSpec.language!==xe)return!1;let a=s.kernelSpec.argv.map(u=>u.toLowerCase()),c=a.indexOf("-m");if(c===-1)return!1;let l=a.length-1>=c?a[c+1]:void 0;return l?l!=="ipykernel_launcher":!1},i=new Map,o=new Set;return await Promise.all(t.filter(s=>{let a=Mn(s.kernelSpec);return!!(!a&&(n(s)||Object.keys(s.kernelSpec.env||{}).length>0)||!a&&s.kernelSpec.language===xe&&!uP(s.kernelSpec))}).map(async s=>{let a=await this.findMatchingInterpreter(s.kernelSpec,"startUsingLocalKernelSpec",e);if(e.isCancellationRequested)return;if(!a){let l=s.kernelSpec.argv.length?s.kernelSpec.argv[0].toLowerCase():"";if(V_(l)){this.warnAboutPythonKernelSpecWithInvalidPythonExec(s.kernelSpec);return}}let c=op.create({kernelSpec:s.kernelSpec,interpreter:a,id:Pi(s.kernelSpec,a)});i.set(c.id,c),c.kernelSpec.specFile&&o.add(c.kernelSpec.specFile)})),e.isCancellationRequested?[]:e.isCancellationRequested?[]:Array.from(i.values())}};var pu=class extends Ty{constructor(t,n,i,o,s,a,c,l,u){super(n,o,a,c,l,i);this.interpreterService=t;this.kernelSpecsFromKnownLocations=s;this._kernels=new Map;this._kernelsExcludingCachedItems=new Map;this._kernelsFromCache=[];this.cachedInformationForPythonInterpreter=new Map;this.updateCachePromise=Promise.resolve();this.discoveredKernelSpecFiles=new Set;this.lastKnownGlobalPythonKernelSpecs=[];this.interpreterKernelSpecs=new Map;this.globalPythonKernelSpecFinder=new LD(this.interpreterService,this.kernelSpecsFromKnownLocations,this.extensionChecker,u),this.disposables.push(this._onDidChangeKernels),t.onDidChangeInterpreters(()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(f)},this,this.disposables),t.onDidRemoveInterpreter(p=>{E(`Interpreter removed ${p.id}`);let m=[];this._kernels.forEach(h=>{h.interpreter?.id===p.id&&(E(`Interpreter ${p.id} deleted, hence deleting corresponding kernel ${h.kind}:'${h.id}`),m.push(h),this._kernels.delete(h.id))}),m.length&&(E(`Local Python connection deleted ${m.map(h=>`${h.kind}:'${h.id}: (interpreter id=${un(h.interpreter?.id)})'`)}`),this.updateCache().catch(f))},this,this.disposables)}activate(){this.listKernelsFirstTimeFromMemento(kF()).then(t=>{t.length&&(t.filter(n=>!this._kernels.has(n.id)).forEach(n=>{this._kernelsFromCache.push(n),this._kernels.set(n.id,n)}),this._onDidChangeKernels.fire())}).finally(async()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(f),this.kernelSpecsFromKnownLocations.onDidChangeKernels(()=>{let t=this.lastKnownGlobalPythonKernelSpecs,n=this.listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs();(t.length!==n.length||!Ao(t,n))&&(this.refreshCancellation?.cancel(),this.refreshData().catch(f))},this,this.disposables)}).catch(f)}get kernels(){return Array.from(this._kernels.values())}dispose(){Q(this.disposables)}async refresh(){this.globalPythonKernelSpecFinder.clear(),this.clearCache(),this.cachedInformationForPythonInterpreter.clear(),this.discoveredKernelSpecFiles.clear(),this.interpreterService.refreshInterpreters(!0).catch(f),await this.refreshData(!0)}refreshData(t=!1){if(!t&&this.refreshCancellation&&!this.refreshCancellation.token.isCancellationRequested&&this.previousRefresh)return this.previousRefresh;this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose();let n=this.refreshCancellation=new pH.CancellationTokenSource,i=(async()=>{if(await this.listKernelsImplementation(n.token,t).catch(o=>x("Failure in listKernelsImplementation",o)),!n.token.isCancellationRequested){if(this.interpreterService.status==="idle"){let o=this._kernelsFromCache.filter(l=>!this._kernelsExcludingCachedItems.has(l.id)),s=[];o.length&&(j(`Kernels ${o.map(l=>`${l.kind}:'${l.id}'`).join(", ")} found in cache but not discovered in current session ${Array.from(this._kernelsExcludingCachedItems.values()).map(l=>`${l.kind}:'${l.id}'`).join(", ")}`),o.forEach(l=>{this._kernels.delete(l.id),s.push(l)}));let a=new Set(this.interpreterService.resolvedEnvironments.map(l=>l.id)),c=Array.from(this._kernels.values()).filter(l=>!!(l.interpreter&&!a.has(l.interpreter.id)));c.length&&(j(`The following kernels use interpreters that are no longer valid or not recognized by Python extension, Kernels ${c.map(l=>`${l.kind}:'id=${l.id}'(interpreterId='${un(l.interpreter?.id)}')`).join(",")} and valid interpreter ids include ${Array.from(a).join(", ")}`),c.forEach(l=>{this._kernels.delete(l.id),s.push(l)})),s.length&&(E(`Local Python connection deleted ${s.map(l=>`${l.kind}:'${l.id}: (interpreter id=${un(l.interpreter?.id)})'`)}`),await this.updateCache())}t&&(this._kernelsFromCache=[])}})().catch(o=>x("Failed to discover kernels in interpreters",o)).finally(()=>{n===this.refreshCancellation&&(this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose(),this.refreshCancellation=void 0)});return this.previousRefresh=i,this.promiseMonitor.push(i),i}async updateCache(){this._onDidChangeKernels.fire();let t=Array.from(this._kernels.values());return this.updateCachePromise=this.updateCachePromise.finally(()=>this.writeToMementoCache(t,kF()).catch(f)),this.updateCachePromise}async listKernelsImplementation(t,n){let i=this.extensionChecker.isPythonExtensionInstalled?this.interpreterService.resolvedEnvironments:[],o=Promise.all(i.map(async a=>{let c=this.interpreterKernelSpecs.get(a.id);c||(c=new FD(a,this.interpreterService,this.jupyterPaths,this.extensionChecker,this.kernelSpecFinder),this.disposables.push(c),this.interpreterKernelSpecs.set(a.id,c),c.onDidChangeKernels(l=>{l.removed.forEach(u=>this._kernels.delete(u.id)),this.appendNewKernels(l.added),!l.added.length&&l.removed.length&&this.updateCache()},this,this.disposables)),await fr(t,[],c.listKernelSpecs(n))})),s=fr(t,[],this.globalPythonKernelSpecFinder.listKernelSpecs(n)).then(a=>this.appendNewKernels(a));await Promise.all([o,s])}async appendNewKernels(t){if(t.length)return t.forEach(n=>{dt(n)&&n.kernelSpec.specFile?(this._kernelsExcludingCachedItems.set(n.id,n),this._kernels.has(n.id)?this._kernels.set(n.id,n):this._kernels.set(n.id,n)):j(`Found a kernel ${n.kind}:'${n.id}', but excluded as specFile is undefined`)}),this.updateCache()}listGlobalPythonKernelSpecs(t){return this.kernelSpecsFromKnownLocations.kernels.filter(i=>i.kernelSpec.language===xe).filter(i=>t?!0:!Mn(i.kernelSpec))}listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs(){return this.lastKnownGlobalPythonKernelSpecs=this.listGlobalPythonKernelSpecs(!0)}};pu=v([(0,Eo.injectable)(),d(0,(0,Eo.inject)(tt)),d(1,(0,Eo.inject)(gr)),d(2,(0,Eo.inject)(Fr)),d(3,(0,Eo.inject)(ze)),d(4,(0,Eo.inject)(ts)),d(5,(0,Eo.inject)($e)),d(5,(0,Eo.named)(ri)),d(6,(0,Eo.inject)(F)),d(7,(0,Eo.inject)(Rc)),d(8,(0,Eo.inject)(ad))],pu);var af=class{constructor(e,t,n,i,o,s){this.nonPythonKernelFinder=e;this.pythonKernelFinder=t;this.disposables=i;this.extensionChecker=o;this.interpreters=s;this._status="idle";this._onDidChangeStatus=new vC.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new co;this.kind="localKernelSpec";this.id="localKernelSpec";this.displayName=y.localKernelSpecs;this._onDidChangeKernels=new vC.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this.wasPythonInstalledWhenFetchingControllers=!1;this.cache=[];n.registerKernelFinder(this),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this._onDidChangeKernels),this.disposables.push(this.promiseMonitor)}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete&&this.interpreters.status==="idle"&&this.nonPythonKernelFinder.status==="idle"&&this.pythonKernelFinder.status==="idle"?"idle":"discovering"}),this.updateCache();let e,t=()=>{[this.nonPythonKernelFinder.status,this.pythonKernelFinder.status,this.interpreters.status==="refreshing"?"discovering":"idle"].includes("discovering")?e||(e=ue(),this.promiseMonitor.push(e.promise)):(e?.resolve(),e=void 0)};t(),this.nonPythonKernelFinder.onDidChangeStatus(t,this,this.disposables),this.pythonKernelFinder.onDidChangeStatus(t,this,this.disposables),this.interpreters.onDidChangeStatus(t,this,this.disposables),this.updateCache(),this.interpreters.onDidChangeInterpreters(this.updateCache,this,this.disposables),vC.extensions.onDidChange(()=>{!this.wasPythonInstalledWhenFetchingControllers&&this.extensionChecker.isPythonExtensionInstalled&&this.updateCache()},this,this.disposables),this.nonPythonKernelFinder.onDidChangeKernels(this.updateCache,this,this.disposables),this.pythonKernelFinder.onDidChangeKernels(this.updateCache,this,this.disposables),this.wasPythonInstalledWhenFetchingControllers=this.extensionChecker.isPythonExtensionInstalled}async refresh(){let e=(async()=>{await this.nonPythonKernelFinder.refresh(),await this.pythonKernelFinder.refresh(),this.updateCache()})();this.promiseMonitor.push(e),await e}updateCache(){try{let e=[],t=this.nonPythonKernelFinder.kernels.filter(i=>this.extensionChecker.isPythonExtensionInstalled?i.kernelSpec.language!==xe:!0),n=this.pythonKernelFinder.kernels.filter(i=>ig(i));e=e.concat(t).concat(n),this.writeToCache(e)}catch(e){x("Exception Saving loaded kernels",e)}}get kernels(){let e=new Set,t=[];return this.pythonKernelFinder.kernels.forEach(n=>{let i=Mn(n.kernelSpec);n.kernelSpec.specFile&&i==="registeredByNewVersionOfExtForCustomKernelSpec"&&(e.add(n.kernelSpec.specFile),t.push(n))}),this.cache.forEach(n=>{n.kernelSpec.specFile&&e.has(n.kernelSpec.specFile)||t.push(n)}),t}writeToCache(e){let t=new Set;e=e.filter(l=>t.has(l.id)?!1:(t.add(l.id),!0));let n=this.cache,i=new Map(n.map(l=>[l.id,l])),o=new Map(e.map(l=>[l.id,l])),s=e.filter(l=>!i.has(l.id)),a=e.filter(l=>i.has(l.id)&&!Ao(l,i.get(l.id))),c=n.filter(l=>!o.has(l.id));this.cache=e,(s.length||a.length||c.length)&&this._onDidChangeKernels.fire({removed:c})}};v([yh("List kernels failed")],af.prototype,"updateCache",1),af=v([(0,du.injectable)(),d(0,(0,du.inject)(ts)),d(1,(0,du.inject)(pu)),d(2,(0,du.inject)(Rr)),d(3,(0,du.inject)(F)),d(4,(0,du.inject)(ze)),d(5,(0,du.inject)(tt))],af);var cf=_(O());var yC=require("vscode"),mH=require("os");function dH(r){return!!(fH(r)&&(r?.envType==="Unknown"||r?.envType==="Pyenv"||r?.envType==="Conda"))}function fH(r){let e=$i(r)?.major??3,t=$i(r)?.minor??6;return e>=3&&t>=6}var mu=class{constructor(e,t,n,i){this.pythonExecutionFactory=e;this.disposableRegistry=t;this.interpreters=n;this.context=i;this.messages=new Map;this.requestCounter=0}async createInterrupter(e,t){try{return await this.createInterrupterImpl(e,t)}catch(n){return x("Failed to create interrupter, trying again",n),this.createInterrupterImpl(e,t)}}async createInterrupterImpl(e,t){let n=await this.sendCommand({command:"INITIALIZE_INTERRUPT"},e,t);if(!n)throw x("Unable to initialize interrupt handle"),new Error("Unable to initialize interrupt handle");return{handle:n,interrupt:async()=>{await this.sendCommand({command:"INTERRUPT",handle:n},e,t)},dispose:async()=>{await this.sendCommand({command:"DISPOSE_INTERRUPT_HANDLE",handle:n},e,t).catch(i=>x(`Failed to dispose interrupt handle for ${e.id}`,i))}}}async getInterpreter(e){if(e&&dH(e))return e;let t=this.interpreters.resolvedEnvironments;return t.length===0?e:t.find(dH)||t.find(fH)||e}async initializeInterrupter(e,t){if(this.startupPromise)return this.startupPromise;let n=(async()=>{let i=await this.getInterpreter(e),o=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:i,resource:t}),s=yC.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers"),a=yC.Uri.joinPath(s,"kernel_interrupt_daemon.py"),c=o.execObservable([a.fsPath,"--ppid",process.pid.toString()],{cwd:s.fsPath});return await new Promise((l,u)=>{let p=!1,m=c.out.onDidChange(h=>{if(ne(`Output from interrupt daemon started = ${p}, output (${h.source}) = ${h.out} ('END)`),h.source==="stdout"&&h.out.trim().includes("DAEMON_STARTED:")&&!p)p=!0,l();else if(h.source==="stderr"&&h.out.includes("INTERRUPT:")&&h.out.includes("ERROR: handling command :INITIALIZE_INTERRUPT:")&&p)Fe(h.out,{trim:!0,removeEmptyEntries:!0}).filter(g=>g.includes("INTERRUPT:")).forEach(g=>{try{let b=g.split(":"),w=parseInt(b[b.indexOf("INITIALIZE_INTERRUPT")+1],10),k=this.messages.get(w);k&&(x(`Failed to initialize interrupt daemon for ${w}, ${h.out}`),k.deferred.reject(new Error(`Failed to start interrupt daemon ${h.out}`)),this.messages.delete(w))}catch(b){x(`Failed to parse interrupt daemon response, ${h.out}`,b)}});else if(h.source==="stdout"&&h.out.includes("INTERRUPT:")&&p)Fe(h.out,{trim:!0,removeEmptyEntries:!0}).filter(g=>g.includes("INTERRUPT:")).forEach(g=>{try{let[b,w,k]=g.split(":"),N=this.messages.get(parseInt(w,10));N?(E(`Got a response of ${k} for ${b}:${w}`),N.deferred.resolve(k),this.messages.delete(parseInt(w,10))):x(`Got a response of ${k} for ${b}:${w} but no command entry found in ${h.out}`)}catch(b){x(`Failed to parse interrupt daemon response, ${h.out}`,b)}});else if(h.out.includes("ERROR: handling command")){if(j(`Error output in interrupt daemon response ${h.out} ('END')`),!p)return u(new Error(`Interrupt daemon failed to start, ${h.out}`));try{let g=h.out.split(":")[2],b=this.messages.get(parseInt(g,10));if(b){b.deferred.reject(new Error(h.out)),this.messages.delete(parseInt(g,10));return}}catch(g){x(`Failed to parse interrupt daemon response, ${h.out}`,g)}}});this.disposableRegistry.push(m)}),this.disposableRegistry.push(new yC.Disposable(()=>An(()=>c.proc?.kill()))),c.proc?.on("close",()=>{ne("Interrupt daemon closed"),this.startupPromise=void 0}),c.proc?.on("exit",()=>{ne("Interrupt daemon exited"),this.startupPromise=void 0}),c})();return n.catch(i=>x(`Failed to start interrupt daemon for (${e.id})`,i)),this.startupPromise=n,n}async sendCommand(e,t,n){let i=ue(),o=this.requestCounter++;this.messages.set(o,{command:e,deferred:i});let s=e.command==="INITIALIZE_INTERRUPT"?`${e.command}:${o}`:`${e.command}:${o}:${e.handle}`,{proc:a}=await this.initializeInterrupter(t,n);if(!a||!a.stdin)throw x("No process or stdin"),new Error("No process or stdin");a.stdin.write(`${s}${mH.EOL}`),ne(`Sending Interrupt Request id=${o}, Command ${e.command} for ${t.id}`);let c=await i.promise;if(ne(`Got Interrupt Response id=${o}, Command ${e.command} for ${t.id}`),e.command==="INITIALIZE_INTERRUPT")return parseInt(c,10)}};mu=v([(0,cf.injectable)(),d(0,(0,cf.inject)(Kr)),d(1,(0,cf.inject)(F)),d(2,(0,cf.inject)(tt)),d(3,(0,cf.inject)(lt))],mu);var UD=_(O());var bC=require("vscode");var rl=class{constructor(e){this.platform=e;this.programData=process.env.PROGRAMDATA?bC.Uri.file(In(process.env.PROGRAMDATA)):void 0}get trustedKernelSpecs(){return bC.workspace.getConfiguration("jupyter",void 0).get("kernels.trusted",[])}isTrusted(e){let t=this.isTrustedImpl(e);return!t&&!rl.IsKernelSpecHidden.completed&&rl.IsKernelSpecHidden.resolve(!0),t}isTrustedImpl(e){return e.scheme!=="file"||this.trustedKernelSpecs.map(t=>this.platform.isWindows?t.toLowerCase():t).map(t=>bC.Uri.file(t).path).includes(this.platform.isWindows?e.path.toLowerCase():e.path)?!0:this.platform.isWindows&&this.programData?!e.path.toLowerCase().startsWith(this.programData.path.toLowerCase()):!0}};rl.IsKernelSpecHidden=ue(),rl=v([(0,UD.injectable)(),d(0,(0,UD.inject)(Er))],rl);var ZD=_(Fc()),ns=_(O()),LF=_(require("os"));var w4=require("util"),E4=_(So()),eT=require("vscode");var a4=require("process"),c4=_(Fc()),Ny=_(require("os"));var My=require("vscode");var l4=_(_H());var i4="To connect another client to this kernel, use:",o4=`NOTE: When using the \`ipython kernel\` entry point, Ctrl-C will not work.

To exit, you will have to explicitly quit this process, by either sending
"quit" from a client, or using Ctrl-\\ in UNIX-like environments.

To read more about this, see https://github.com/ipython/ipython/issues/2049


`,Ay=class{constructor(e,t,n,i,o,s,a,c,l,u,p,m,h){this.processExecutionFactory=e;this._connection=t;this.fileSystem=i;this.resource=o;this.extensionChecker=s;this.kernelEnvVarsService=a;this.pythonExecFactory=c;this.outputChannel=l;this.jupyterSettings=u;this.jupyterPaths=p;this.pythonKernelInterruptDaemon=m;this.platform=h;this.exitEvent=new My.EventEmitter;this._kernelConnectionMetadata=n}get pid(){return this._pid}get exited(){return this.exitEvent.event}get kernelConnectionMetadata(){return this._kernelConnectionMetadata}get connection(){return this._connection}get isPythonKernel(){return _t(this.kernelConnectionMetadata)&&$m(this.kernelConnectionMetadata)}get canInterrupt(){return this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"}async interrupt(){if(this.canInterrupt)if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&!this.interrupter)z("Interrupting kernel via SIGINT"),this._process.pid&&(0,a4.kill)(this._process.pid,"SIGINT");else{if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&this.interrupter&&_t(this._kernelConnectionMetadata))return z("Interrupting kernel via custom event (Win32)"),this.interrupter.interrupt();x("No process to interrupt in KernleProcess.ts")}else throw new Error("Kernel interrupt not supported in KernelProcess.ts")}async launch(e,t,n){if(this.launchedOnce)throw new Error("Kernel has already been launched.");this.launchedOnce=!0,await this.updateConnectionArgs(),yn.throwIfCanceled(n);let i=await this.launchAsObservable(e,n),o=i.proc;if(n.isCancellationRequested)throw new My.CancellationError;z(`Kernel process ${o?.pid}.`);let s="",a="",c="",l=!1,u,p=ue();p.promise.catch(f),o&&(o.on("exit",h=>{if(h=h||u,this.disposed){E(`KernelProcess Exited, Exit Code - ${h}`);return}E(`KernelProcess Exited, Exit Code - ${h}`,c),l||(this.exitEvent.fire({exitCode:h||void 0,reason:Mh(c)||c}),l=!0),n.isCancellationRequested||(ne("KernelProcessExitedError raised",a),p.reject(new zp(h||-1,a,this.kernelConnectionMetadata)))}),o.stdout?.on("data",h=>{E(`Kernel output: ${(h||"").toString()}`),this.sendToOutput((h||"").toString())}),o.stderr?.on("data",h=>{let g=s4((h||"").toString());c+=g,g.trim().length&&E(`KernelProcess error: ${g}`),this.sendToOutput(g)}));let m=!1;i.out.onDidChange(h=>{if(h.source==="stderr")h.out=s4(h.out),a+=h.out,h.out.trim().length&&j(`StdErr from Kernel Process ${h.out.trim()}`);else{if(s+=h.out,!m){s=s.replace(o4,""),s=s.replace(o4.split(/\r?\n/).join(Ny.EOL),""),s=s.trimStart();let g=Fe(s,{trim:!0,removeEmptyEntries:!0});g.length===2&&g[0]===i4&&g[1].startsWith("--existing")&&g[1].endsWith(".json")&&(s=`${g.join(" ")}${Ny.EOL}`)}s.includes(i4)&&(m=!0)}this.sendToOutput(h.out)}),i.out.done.catch(h=>{if(this.disposed){j("Kernel died",h,a);return}x("Kernel died",h,a),p.reject(h)});try{p.rejected&&await p.promise;let h=Te.instance.get(za).inExperiment("DoNotWaitForZmqPortsToBeUsed"),g=(await Promise.resolve().then(()=>_(n4()))).default,b=new qe;h&&t>1e4&&(t=1e4);let w=Promise.all([g.waitUntilUsed(this.connection.shell_port,200,t),g.waitUntilUsed(this.connection.iopub_port,200,t)]).catch(k=>{if(!(n.isCancellationRequested||p.rejected)&&(console.error("ex"),console.error(k),j(`Waited ${b.elapsedTime}ms for kernel to start`,k),!h))return Promise.reject(new Bv(this.kernelConnectionMetadata))});await ar(n,w,p.promise)}catch(h){let g=(c||a||"").trim();if(!n?.isCancellationRequested&&!mr(h)&&(x("Disposing kernel process due to an error",h),h&&h instanceof Error&&g.length&&h.message.includes(g)||x(g)),await this.dispose(),!n?.isCancellationRequested&&h instanceof Ye)throw h;{n?.isCancellationRequested&&E("User cancelled the kernel launch");let b=kE(g)||g.substring(0,100);throw ne("KernelDiedError raised",b,c+`
`+a+`
`),console.error("KernelDiedError raised",h),new Gp(y.kernelDied(b),c+`
`+a+`
`,h,this.kernelConnectionMetadata)}}}async dispose(){if(this._disposingPromise)return this._disposingPromise;if(this.disposed)return;this.disposed=!0;let e=this._process?.pid;z(`Dispose Kernel process ${e}.`),this._disposingPromise=(async()=>{await pr(1e3,this.killChildProcesses(this._process?.pid).catch(f));try{this.interrupter?.dispose().catch(f),this._process?.kill(),this.exitEvent.fire({})}catch(t){x(`Error disposing kernel process ${e}`,t)}An(async()=>{this.connectionFile&&await this.fileSystem.delete(this.connectionFile).catch(t=>j(`Failed to delete connection file ${this.connectionFile} for pid ${e}`,t))}),E(`Disposed Kernel process ${e}.`)})()}async killChildProcesses(e){if(!(!e||!Uc.isAlive(e)))try{if(this.platform.isWindows){let t=process.env.WINDIR||"C:\\Windows",n=Ve(t,"System32","taskkill.exe");await new Uc().exec(n,["/F","/T","/PID",e.toString()])}else await new Promise(t=>{(0,l4.default)(e,(n,i)=>{n?j(`Failed to kill children for ${e}`,n):i.forEach(o=>Uc.kill(o)),t()})})}catch(t){j(`Failed to kill children for ${e}`,t)}}sendToOutput(e){this.outputChannel&&this.outputChannel.append(e)}get launchKernelSpec(){if(this._launchKernelSpec)return this._launchKernelSpec;let e=this._kernelConnectionMetadata.kernelSpec;if(!e)throw new Error("KernelSpec cannot be empty in KernelProcess.ts");return Array.isArray(e.argv)?this._launchKernelSpec={...e,argv:[...e.argv]}:(x("KernelSpec.argv in KernelProcess is undefined"),this._launchKernelSpec=void 0),this._launchKernelSpec}async updateConnectionArgs(){let e=HV(this.launchKernelSpec);if(e===-1)throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);if(this.isPythonKernel&&e===0&&this.launchKernelSpec.argv[e-1]!=="-f")throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);if(this.connectionFile=await this.createConnectionFile(),this.isPythonKernel)this.launchKernelSpec.argv.splice(e-1,2),this.launchKernelSpec.argv.push(...this.addPythonConnectionArgs(this.connectionFile)),await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));else{await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));let t=this.connectionFile.fsPath.includes(" ")?`"${this.connectionFile.fsPath}"`:this.connectionFile.fsPath;this.launchKernelSpec.argv[e].includes("--connection-file")?this.launchKernelSpec.argv[e]=this.launchKernelSpec.argv[e].replace(fm,t):this.launchKernelSpec.argv[e].includes(`=${fm}`)&&!this.launchKernelSpec.argv[e].trim().startsWith("=")?this.launchKernelSpec.argv[e]=this.launchKernelSpec.argv[e].replace(fm,t):this.launchKernelSpec.argv[e]=this.launchKernelSpec.argv[e].replace(fm,this.connectionFile.fsPath)}}async createConnectionFile(){let e=await this.jupyterPaths.getRuntimeDir(),t=await this.fileSystem.createTemporaryLocalFile({fileExtension:".json",prefix:"kernel-v2-"}),n=e?Ve(e.fsPath,De(t.filePath)):t.filePath;return await t.dispose(),My.Uri.file(n)}addPythonConnectionArgs(e){let t=[],n=e.fsPath.includes(" ")?`"${e.fsPath}"`:e.fsPath;return t.push(`--f=${n}`),t}async launchAsObservable(e,t){let n;if(E(`Launching kernel ${this.kernelConnectionMetadata.id} for ${W(this.resource)} in ${W(e)} with ports ${this.connection.control_port}, ${this.connection.hb_port}, ${this.connection.iopub_port}, ${this.connection.shell_port}, ${this.connection.stdin_port}`),this.isPythonKernel&&this.extensionChecker.isPythonExtensionInstalled&&this._kernelConnectionMetadata.interpreter){let i=this.pythonExecFactory.createActivatedEnvironment({resource:this.resource,interpreter:this._kernelConnectionMetadata.interpreter}),[o,s,a]=await Promise.all([i,c4.pathExists(e),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this._kernelConnectionMetadata.kernelSpec,t)]);if(yn.throwIfCanceled(t),Ny.platform()==="win32"){a=a||process.env;try{let l=await this.getWin32InterruptHandle();a.JPY_INTERRUPT_EVENT=`${l}`,ne(`Got interrupt handle kernel id ${l} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`)}catch(l){x(`Failed to get interrupt handle kernel id ${this._kernelConnectionMetadata.id} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`,l)}}yn.throwIfCanceled(t);let c=this.launchKernelSpec.argv.slice(1);this.jupyterSettings.enablePythonKernelLogging&&c.push("--debug"),n=o.execObservable(c,{cwd:s?e:process.cwd(),env:a}),yn.throwIfCanceled(t)}else{let i=this.launchKernelSpec.argv[0];z(`Launching Raw Kernel ${this.launchKernelSpec.display_name} # ${i}`);let[o,s]=await Promise.all([this.processExecutionFactory.create(this.resource,t),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this.launchKernelSpec,t)]);yn.throwIfCanceled(t);let a=this.launchKernelSpec.argv.slice(1);n=o.execObservable(i,a,{env:s,cwd:e})}if(!n.proc)throw new Error("KernelProcess failed to launch");return this._process=n.proc,this._pid=n.proc.pid,n}async getWin32InterruptHandle(){return this.interrupter||(this.interrupter=await this.pythonKernelInterruptDaemon.createInterrupter(this._kernelConnectionMetadata.interpreter,this.resource)),this.interrupter.handle}};v([dr("DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH")],Ay.prototype,"launch",1),v([d(1,Qu())],Ay.prototype,"launchAsObservable",1);function s4(r){let e=Fe(r,{trim:!0,removeEmptyEntries:!0});return e.some(t=>t.includes("FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0."))&&e.some(t=>t.trim()==="warn(")&&e.some(t=>t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0."))?e.filter(t=>!t.endsWith(`FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0. You can use 'hmac-sha256' instead of '"hmac-sha256"' if you require traitlets >=5.`)&&t.trim()!=="warn("&&!t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0. Use")).join(Ny.EOL):r}var C4="kernelLauncherPortStart_{0}.tmp",Po=class{constructor(e,t,n,i,o,s,a,c,l,u){this.processExecutionFactory=e;this.fs=t;this.extensionChecker=n;this.kernelEnvVarsService=i;this.disposables=o;this.pythonExecFactory=s;this.configService=a;this.jupyterPaths=c;this.pythonKernelInterruptDaemon=l;this.platformService=u}static async cleanupStartPort(){try{let e=await Po.startPortPromise;E(`Cleaning up port start file : ${e}`);let t=Ve(LF.tmpdir(),Ja(C4,e.toString()));await ZD.remove(t)}catch(e){j("Kernel port mutex failed to cleanup: ",e)}}static async computeStartPort(){if(Tr()){let e=9e3,t=0;for(;t===0&&e<65e3;)try{let n=Ve(LF.tmpdir(),Ja(C4,e.toString()));await ZD.open(n,"wx"),t=e}catch{e+=1e3}return E(`Computed port start for KernelLauncher is : ${t}`),t}else return 9e3}async launch(e,t,n,i,o){let s=new qe,a=(async()=>(this.logIPyKernelPath(n,e,o).catch(f),await this.launchProcess(e,n,i,t,o)))();return a.then(()=>A("DS_INTERNAL.KERNEL_LAUNCHER_PERF",{duration:s.elapsedTime},{resourceType:Hi(n)})).catch(f),a}async logIPyKernelPath(e,t,n){let i=t.interpreter;if(!dt(t)||!_t(t)||!i)return;let s=await(await this.pythonExecFactory.createActivatedEnvironment({interpreter:i,resource:e})).exec(["-c",'import ipykernel; print(ipykernel.__version__); print("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d"); print(ipykernel.__file__)'],{token:n});if(n.isCancellationRequested)return;let a=W(i.uri);if(s.stdout){let c=s.stdout.trim().split("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d").map(l=>l.trim()).filter(l=>l.length>0);c.length===2?E(`ipykernel version & path ${c[0]}, ${pJ(c[1])} for ${a}`):E(`ipykernel version & path ${s.stdout.trim()} for ${a}`)}if(s.stderr){let c=Fe(s.stderr.trim(),{removeEmptyEntries:!0,trim:!0}).map((l,u)=>u===0?l:`    ${l}`).join(`
`);j(`Stderr output when getting ipykernel version & path ${c} for ${a}`)}}async launchProcess(e,t,n,i,o){let s=await ar(o,this.getKernelConnection(e)),a=t?De(t.fsPath):"",c=this.configService.getSettings(t),l=c.logKernelOutputSeparately||c.development?eT.window.createOutputChannel(y.kernelConsoleOutputChannel(a),"log"):void 0;l?.clear();let u=new Ay(this.processExecutionFactory,s,e,this.fs,t,this.extensionChecker,this.kernelEnvVarsService,this.pythonExecFactory,l,c,this.jupyterPaths,this.pythonKernelInterruptDaemon,this.platformService);u.exited(()=>l?.dispose(),this,this.disposables);try{await ar(o,u.launch(n,i,o))}catch(m){throw await u.dispose(),yn.throwIfCanceled(o),m}let p=u.exited(({exitCode:m,reason:h})=>{Rt(t,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",m?{exitCode:m}:void 0,{exitReason:Mh(h)}),xo.delete(s.control_port),xo.delete(s.hb_port),xo.delete(s.iopub_port),xo.delete(s.shell_port),xo.delete(s.stdin_port),p.dispose()},this,this.disposables);if(o?.isCancellationRequested)throw await u.dispose(),new eT.CancellationError;return u}async chainGetConnectionPorts(){return this.portChain&&await this.portChain,this.portChain=this.getConnectionPorts(),this.portChain}static async findNextFreePort(e){let n=await(0,w4.promisify)((await Promise.resolve().then(()=>_(x4()))).getPorts)(5,{host:"127.0.0.1",port:e});if(n.some(i=>xo.has(i))){let i=Math.max(...xo,...n);return Po.findNextFreePort(i)}return n.forEach(i=>xo.add(i)),n}async getConnectionPorts(){let e=await Po.startPortPromise;return Po.findNextFreePort(e)}async getKernelConnection(e){let t=await this.chainGetConnectionPorts();return{key:(0,E4.default)(),signature_scheme:"hmac-sha256",transport:"tcp",ip:"127.0.0.1",hb_port:t[0],control_port:t[1],shell_port:t[2],stdin_port:t[3],iopub_port:t[4],kernel_name:e.kernelSpec?.name||"python"}}};Po.startPortPromise=Po.computeStartPort(),v([Mr("Failed to capture IPyKernel version and path")],Po.prototype,"logIPyKernelPath",1),Po=v([(0,ns.injectable)(),d(0,(0,ns.inject)(_i)),d(1,(0,ns.inject)(gr)),d(2,(0,ns.inject)(ze)),d(3,(0,ns.inject)(Ca)),d(4,(0,ns.inject)(F)),d(5,(0,ns.inject)(Kr)),d(6,(0,ns.inject)(le)),d(7,(0,ns.inject)(Fr)),d(8,(0,ns.inject)(mu)),d(9,(0,ns.inject)(Er))],Po);var F4=_(require("vscode")),xC=_(O());var tT=class extends hy{constructor(t,n,i){super("localRaw",t);this.resource=n;this.kernelConnectionMetadata=i;this.initializeKernelSocket()}get atleastOneCellExecutedSuccessfully(){return this.session.atleastOneCellExecutedSuccessfully}get status(){return this.terminatingStatus&&!this.isDisposed?this.terminatingStatus:this.isDisposed?"dead":this.session.kernel?this.session.kernel.status:(ne(`Real kernel is ${this.session.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.disposeAsync().catch(f)}async disposeAsync(){await this.shutdown().catch(f).finally(()=>this.session.dispose()).finally(()=>super.dispose())}async waitForIdle(t,n){try{await fy(this.kernelConnectionMetadata,this.resource,this.session,t,n)}catch(i){throw ne("Error waiting for idle",i),await this.shutdown().catch(f),i}}async shutdown(){if(this._isDisposed)return;this._isDisposed=!0,this.terminatingStatus="terminating",this.statusChanged.emit("terminating");let t=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata?.id}`;E(`Shutdown session ${t} - start called from ${new Error("").stack}`),my(this.session.kernel),await pr(1e3,this.session.shutdown().catch(f)),this.didShutdown.fire(),super.dispose(),E(`Shutdown session ${t} - shutdown complete`)}};var Ta=_(dD()),K4=_(So());var aT=_(So());var sT=_(D4()),O4=_(So());var fu=_(Fc());var nT=_(require("os"));var T4=_(Fc()),jF=_(require("os"));var jve=["AlmaLinux","Alt","Amazon","Arch","ArchLinux","Asahi","Asahi Linux","Asianux","Alpine","Berry","BlackArch","BlackArch Linux","Cent","CentOS","Clear","Clear Linux","Clear","ClearOS","Debian","Elementary","Endeavour","EndeavourOS","Easy","EasyOS","Fedora","Fermi","Fuduntu","FreeBSD","Gecko","Gentoo","Kali","KDE","Knoppix","Kubuntu","Linux","LinuxMint","Mageia","Manjaro","Mint","Miracle","MX","MX Linux","Navy","Navy Linux","Nitrux","NixOS","openSUSE","Oracle","Pop!_OS","RasPiOS","Raspbian","Red Hat Enterprise Linux","Red Hat Linux","Red Hat","Rocks","Rocky","Rocky Linux","Rosa","Scientific","Scientific Linux","Slackware","SmartOS","SUSE","SUSE Linux","SUSE Liberty Linux","Ubuntu","VZLinux","Xubuntu","Zorin"],Wve=new RegExp(/^[0-9 .]*$/);async function R4(){let r={id:"",version_id:""};if(jF.platform()==="darwin"||jF.platform()==="win32")return r;try{let e=await T4.readFile("/etc/os-release","utf-8");Fe(e).forEach(t=>{let n=t.toUpperCase().trim().startsWith("ID="),i=t.toUpperCase().trim().startsWith("VERSION_ID=");if(n||i){let o=t.substring(t.indexOf("=")+1).replace(/"/g,"").toUpperCase();if(n)r.id=jve.filter(s=>o.includes(s.toUpperCase())).join(", ");else{let s=parseFloat(o)||"";r.version_id=Wve.test(o)?o:s.toString()}}})}catch(e){x("Failed to read distro info",e)}return r}var Vve="zeromq";function iT(){try{let r=require(Vve);return r.context.blocky=!1,WF(!1).catch(f),r}catch(r){try{let e=require(Ve($o,"dist","node_modules","zeromqold"));return z("ZMQ loaded via fallback mechanism."),WF(!1,!0,r.message||r.toString()).catch(f),e}catch(e){throw WF(!0,!0,r.message||r.toString(),e.message||e.toString()).catch(f),j("Exception while attempting zmq :",r.message||r),j("Exception while attempting zmq (fallback) :",e.message||e),e}}}async function Bve(){try{let r=Ve($o,"dist","node_modules","zeromq","prebuilds");if(!await fu.pathExists(Ve($o,"dist","node_modules")))return;let e=await fu.readdir(r).then(n=>n.map(async i=>{let o=Ve(r,i);return(await fu.stat(o)).isDirectory()?fu.readdir(o).then(a=>a.map(c=>Ve(o,c))):[]}));return(await Promise.all(e.flat())).flat().map(n=>n.substring(n.lastIndexOf("prebuilds")+9+1).replace(/\\/g,"<sep>").replace(/\//g,"<sep>"))}catch(r){return j("Failed to determine local zmq binaries.",r),["Failed to determine local zmq binaries."]}}var A4=!1;async function WF(r,e=!1,t="",n=""){if(A4)return;A4=!0;let[i,o]=await Promise.all([R4().catch(()=>({id:"",version_id:""})),Bve()]),s=qve();A("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:r,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch}),A("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:r,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch,errorMessage:t,zmqBinaries:o,fallbackErrorMessage:n})}function N4(r){return r==="linux"&&fu.existsSync("/etc/alpine-release")}function qve(){try{let r=process.config&&process.config.variables||{},t=(process.env.npm_config_arch||"").trim()||nT.arch(),n=process.env.npm_config_platform||nT.platform(),i=N4(n),o=process.env.LIBC||(N4(n)?"musl":"glibc"),s=process.env.ARM_VERSION||(t==="arm64"?"8":r.arm_version)||"";return{alpine:i,libc:String(o),armv:String(s),zmqarch:t}}catch(r){return j("Failed to determine platform information used to load zeromq binary.",r),{}}}function Jve(r,e){let t=r.transport==="tcp"?":":"-",n=r[`${e}_port`];if(!n)throw new Error(`Port not found for channel "${e}"`);return`${r.transport}://${r.ip}${t}${n}`}var oT=class{constructor(e,t){this.connection=e;this.serialize=t;this.onopen=f;this.onerror=f;this.onclose=f;this.onmessage=f;this.receiveHooks=[];this.sendHooks=[];this.msgChain=Promise.resolve();this.sendChain=Promise.resolve();this.closed=!1;this.channels=this.generateChannels(e)}dispose(){this.closed||this.close()}close(){this.closed=!0;let e=t=>{try{t.close()}catch(n){x("Error during socket shutdown",n)}};e(this.channels.control),e(this.channels.iopub),e(this.channels.shell),e(this.channels.stdin)}emit(e,...t){switch(e){case"message":this.onmessage({data:t[0],type:"message",target:this});break;case"close":this.onclose({wasClean:!0,code:0,reason:"",target:this});break;case"error":this.onerror({error:"",message:"to do",type:"error",target:this});break;case"open":this.onopen({target:this});break;default:break}return!0}send(e,t){this.sendMessage(e,!1)}addReceiveHook(e){this.receiveHooks.push(e)}removeReceiveHook(e){this.receiveHooks=this.receiveHooks.filter(t=>t!==e)}addSendHook(e){this.sendHooks.push(e)}removeSendHook(e){this.sendHooks=this.sendHooks.filter(t=>t!==e)}generateChannel(e,t,n){let i=n();return i.connect(Jve(e,t)),this.processSocketMessages(t,i).catch(x.bind(`Failed to read messages from channel ${t}`)),i}async processSocketMessages(e,t){for await(let n of t){if(this.closed)break;this.onIncomingMessage(e,n)}}generateChannels(e){let t=iT(),n=(0,O4.default)(),i={iopub:this.generateChannel(e,"iopub",()=>new t.Subscriber({maxMessageSize:-1,receiveHighWaterMark:0})),shell:this.generateChannel(e,"shell",()=>new t.Dealer({routingId:n,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),control:this.generateChannel(e,"control",()=>new t.Dealer({routingId:n,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),stdin:this.generateChannel(e,"stdin",()=>new t.Dealer({routingId:n,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1}))};return i.iopub.subscribe(),i}onIncomingMessage(e,t){let n=this.closed?{}:sT.decode(t,this.connection.key,this.connection.signature_scheme);n.channel=e,this.receiveHooks.length?this.msgChain=this.msgChain.then(()=>{let i=this.serialize(n);return Promise.all(this.receiveHooks.map(o=>o(i)))}).then(()=>this.fireOnMessage(n,e)):this.msgChain=this.msgChain.then(()=>this.fireOnMessage(n,e))}fireOnMessage(e,t){if(!this.closed)try{Hve(e,t),this.onmessage({data:e,type:"message",target:this})}catch(n){x(`Failed to handle message in Jupyter Kernel package ${JSON.stringify(e)}`,n)}}sendMessage(e,t){let n=sT.encode(e,this.connection.key,this.connection.signature_scheme);if(!t&&this.sendHooks.length){let i=this.serialize(e);this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(i,f)))).then(async()=>{try{await this.postToSocket(e.channel,n)}catch(o){x(`Failed to write data to the kernel channel ${e.channel}`,n,o)}})}else this.sendChain=this.sendChain.then(()=>{this.postToSocket(e.channel,n)});this.sendChain.catch(f)}postToSocket(e,t){let n=this.channels[e];n?n.send(t).catch(i=>{x("Error communicating with the kernel",i)}):x(`Attempting to send message on invalid channel: ${e}`)}},$ve=["username","version","session","msg_id","msg_type"],M4={stream:{name:"string",text:"string"},display_data:{data:"object",metadata:"object"},execute_input:{code:"string",execution_count:"number"},execute_result:{execution_count:"number",data:"object",metadata:"object"},error:{ename:"string",evalue:"string",traceback:"object"},status:{execution_state:["string",["starting","idle","busy","restarting","dead"]]},clear_output:{wait:"boolean"},comm_open:{comm_id:"string",target_name:"string",data:"object"},comm_msg:{comm_id:"string",data:"object"},comm_close:{comm_id:"string"},shutdown_reply:{restart:"boolean"}};function Hve(r,e){let t=r.header;$ve.forEach(n=>{typeof t[n]!="string"&&(t[n]="")}),typeof r.channel!="string"&&(r.channel=e),r.content||(r.content={}),r.metadata||(r.metadata={}),r.channel==="iopub"&&Gve(r)}function Gve(r){if(r.channel!=="iopub")return;let e=r.header.msg_type;if(e in M4){let t=M4[e];if(t===void 0)return;let n=Object.keys(t),i=r.content;for(let o=0;o<n.length;o++){let s=t[n[o]];Array.isArray(s)||(s=[s]);let a=n[o];if(!(a in i)||typeof i[a]!==s[0])switch(s[0]){case"string":i[a]="";break;case"boolean":i[a]=!1;break;case"object":i[a]={};break;case"number":i[a]=0;break}}}}var ld=_(dD()),ud=require("vscode");var VF,cT=class{constructor(e,t,n,i,o){this.resource=e;this.kernelLauncher=t;this.workingDirectory=n;this.launchTimeout=i;this.kernelConnectionMetadata=o;this.statusChanged=new ld.Signal(this);this.connectionStatusChanged=new ld.Signal(this);this.iopubMessage=new ld.Signal(this);this.unhandledMessage=new ld.Signal(this);this.anyMessage=new ld.Signal(this);this.disposed=new ld.Signal(this);this.id=(0,aT.default)();this.clientId=(0,aT.default)();this.username=(0,aT.default)();this.infoDeferred=ue();this.name=ng(o)||"python3",this.model={name:this.name,id:this.id}}get connectionStatus(){return this.realKernel?this.realKernel.connectionStatus:"connecting"}get serverSettings(){return this.realKernel.serverSettings}get status(){return this.isDisposed||this.hasShutdown?"dead":this.isRestarting?"restarting":this.isShuttingDown?"terminating":this.realKernel?this.realKernel.status:"starting"}get info(){return this.realKernel?this.realKernel.info:this.infoDeferred.promise}get handleComms(){return this.realKernel.handleComms}get isDisposed(){return this._isDisposed||this.realKernel?.isDisposed===!0}async restart(){this.stopHandlingKernelMessages(),this._isDisposed=!1,this.isShuttingDown=!1,this.hasShutdown=!1,this.isRestarting=!0,this.restartToken=new ud.CancellationTokenSource;try{this.statusChanged.emit("restarting"),await this.start(this.restartToken.token)}finally{this.restartToken.dispose()}}async start(e){let t=[],n=kP(e);t.push(n);try{let i=this.kernelProcess;this.kernelProcess=void 0,i?.dispose()?.catch(f),An(()=>this.socket?.dispose()),An(()=>this.realKernel?.dispose());let o=this.kernelProcess=await ht.wrapAndReportProgress(this.resource,y.connectingToKernel(mt(this.kernelConnectionMetadata)),()=>this.kernelLauncher.launch(this.kernelConnectionMetadata,this.launchTimeout,this.resource,this.workingDirectory.fsPath,e));if(e.isCancellationRequested)throw new ud.CancellationError;this.hookupKernelProcessExitHandler(o);let s=Qve(this.kernelProcess,this.clientId,this.username,this.model);this.kernelProcess=s.kernelProcess,this.realKernel=s.realKernel,this.socket=s.socket,s.realKernel.info.then(c=>this.infoDeferred.resolve(c),c=>this.infoDeferred.reject(c));let a=setTimeout(()=>n.cancel(),this.launchTimeout);if(t.push({dispose:()=>clearTimeout(a)}),await ht.wrapAndReportProgress(this.resource,y.waitingForJupyterSessionToBeIdle,()=>zve(n.token,this.launchTimeout,this.resource,this.kernelConnectionMetadata,s.realKernel)),e.isCancellationRequested)throw new ud.CancellationError;this.startHandleKernelMessages(),this.isRestarting=!1,this.statusChanged.emit(this.status)}catch(i){throw await Promise.all([this.kernelProcess?.dispose().catch(f),this.realKernel?.shutdown().catch(o=>j(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,o))]),mr(i)&&n.token.isCancellationRequested&&!e.isCancellationRequested?new Vm(this.kernelConnectionMetadata):(mr(i)||e.isCancellationRequested?E("Starting of raw session cancelled by user"):x(`Failed to connect raw kernel session: ${i}`),i)}finally{Q(t)}}hookupKernelProcessExitHandler(e){let t=this.exitHandler;this.exitHandler=void 0,t?.dispose(),this.exitHandler=e.exited(n=>{e!==this.kernelProcess||this.isDisposing||!this.kernelProcess||this.status==="dead"||this.status==="terminating"||(x(`Disposing session as kernel process died ExitCode: ${n.exitCode}, Reason: ${n.reason}`),Rt(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",n.exitCode?{exitCode:n.exitCode}:void 0,{exitReason:Mh(n.reason)}),this.shutdown().catch(f))},this)}dispose(){this.isDisposed||this.isDisposing||(this.isDisposing=!0,this.shutdown().finally(()=>{this._isDisposed=!0,this.disposed.emit(),ld.Signal.disconnectAll(this)}).catch(f))}async shutdown(){this.isShuttingDown||this.hasShutdown||(this.isShuttingDown=!0,this.restartToken?.cancel(),this.restartToken?.dispose(),my(this.realKernel),await this.kernelProcess?.dispose().catch(f),this.socket.dispose(),this.stopHandlingKernelMessages(),this.isShuttingDown=!1,this.hasShutdown=!0,this.isDisposing&&(this._isDisposed=!0),this.statusChanged.emit(this.status),this.connectionStatusChanged.emit("disconnected"))}createComm(e,t){return this.realKernel.createComm(e,t)}hasComm(e){return this.realKernel.hasComm(e)}clone(e){return this}get spec(){if(ig(this.kernelConnectionMetadata)){let e=JSON.parse(JSON.stringify(this.kernelConnectionMetadata.kernelSpec)),t="resources"in e?e.resources:{};return{...e,resources:t}}return x("Fetching kernel spec from raw kernel using JLab API"),this.realKernel.spec}sendShellMessage(e,t,n){return this.realKernel.sendShellMessage(e,t,n)}sendControlMessage(e,t,n){return this.realKernel.sendControlMessage(e,t,n)}reconnect(){throw new Error("Reconnect is not supported for Local Kernels as connections cannot be lost.")}async interrupt(){if(this.kernelProcess?.canInterrupt)return this.kernelProcess?.interrupt();if(this.kernelConnectionMetadata.kernelSpec.interrupt_mode==="message"){z("Interrupting kernel with a shell message");let t=require("@jupyterlab/services").KernelMessage.createMessage({msgType:"interrupt_request",channel:"shell",username:this.realKernel.username,session:this.realKernel.clientId,content:{}});await this.realKernel.sendShellMessage(t,!0,!0).done.catch(n=>x("Failed to interrupt via a message",n))}else x("Kernel interrupt not supported")}requestKernelInfo(){return this.realKernel.requestKernelInfo()}requestComplete(e){return this.realKernel.requestComplete(e)}requestInspect(e){return this.realKernel.requestInspect(e)}requestHistory(e){return this.realKernel.requestHistory(e)}requestExecute(e,t,n){return this.realKernel.requestExecute(e,t,n)}requestDebug(e,t){return this.realKernel.requestDebug(e,t)}requestIsComplete(e){return this.realKernel.requestIsComplete(e)}requestCommInfo(e){return this.realKernel.requestCommInfo(e)}sendInputReply(e){return this.realKernel.sendInputReply(e)}registerCommTarget(e,t){return this.realKernel.registerCommTarget(e,t)}removeCommTarget(e,t){return this.realKernel.removeCommTarget(e,t)}registerMessageHook(e,t){this.realKernel.registerMessageHook(e,t)}removeMessageHook(e,t){this.realKernel.removeMessageHook(e,t)}startHandleKernelMessages(){this.realKernel.anyMessage.connect(this.onAnyMessage,this),this.realKernel.iopubMessage.connect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.connect(this.onUnhandledMessage,this),this.realKernel.statusChanged.connect(this.onStatusChanged,this),this.realKernel.disposed.connect(this.onDisposed,this)}stopHandlingKernelMessages(){this.realKernel.anyMessage.disconnect(this.onAnyMessage,this),this.realKernel.iopubMessage.disconnect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.realKernel.statusChanged.disconnect(this.onStatusChanged,this),this.realKernel.disposed.disconnect(this.onDisposed,this)}onAnyMessage(e,t){this.anyMessage.emit(t)}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onStatusChanged(e,t){this.statusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};async function zve(r,e,t,n,i){try{E("Waiting for Raw Session to be ready in postStartRawSession"),await ar(r,Yve(i,n,e)),E("Successfully waited for Raw Session to be ready in postStartRawSession")}catch(u){throw x("Failed waiting for Raw Session to be ready",u),mr(u)||r.isCancellationRequested?new ud.CancellationError:u}E(`Kernel status is '${i?.status}' before requesting kernel info and after ready`);let o=ue(),s=ue(),a=()=>o.resolve(!0);i.iopubMessage.connect(a);let c=()=>{let p=require("@jupyterlab/services").KernelMessage.createMessage({msgType:"kernel_info_request",channel:"control",username:i.username,session:i.clientId,content:{}});i.sendControlMessage(p,!0,!0).done.then(()=>s.resolve(!0)).catch(f)},l=()=>{i.requestKernelInfo().then(()=>s.resolve(!0)).catch(f)};try{let u=new qe,p=0;for(;u.elapsedTime<e*1e3;){p+=1;try{E("Sending request for kernelInfo"),c(),l(),await ar(r,Promise.all([o.promise,s.promise]),ji(Math.min(e,500)).then(f))}catch(m){throw x("Failed to request kernel info",m),m}if(o.completed&&s.completed){E("Got response for requestKernelInfo");break}else{E("Did not get a response for requestKernelInfo");continue}}o.completed&&s.completed?E(`Successfully completed postStartRawSession after ${p} attempt(s) in ${u.elapsedTime}ms`):j(`Didn't get response for requestKernelInfo after ${p} attempt(s) in ${u.elapsedTime}ms.`),Rt(t,"DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",{duration:u.elapsedTime,attempts:p},{timedout:!o.completed||!s.completed})}finally{i.iopubMessage.disconnect(a)}}function Qve(r,e,t,n){let i=require("@jupyterlab/services"),o=require("@jupyterlab/services/lib/kernel/serialize"),s;class a extends oT{constructor(){super(r.connection,o.serialize),s=this}}let c=i.ServerConnection.makeSettings({WebSocket:a,wsUrl:"RAW"});VF||(VF=require("@jupyterlab/services/lib/kernel/nonSerializingKernel"));let l=new VF.KernelConnection({serverSettings:c,clientId:e,handleComms:!0,username:t,model:n});return ud.workspace.getConfiguration("jupyter").get("enablePythonKernelLogging",!1)&&l.anyMessage.connect((u,p)=>{E(`[AnyMessage Event] [${p.direction}] [${r.pid}] ${JSON.stringify(p.msg)}`)}),eo.set(l.id,s),s.emit("open"),{realKernel:l,socket:s,kernelProcess:r}}async function Yve(r,e,t){E(`Waiting for Raw session to be ready, status: ${r.connectionStatus}`);let n=ue(),i=(s,a)=>{a=="connected"?(E("Raw session connected"),n.resolve(a)):E(`Raw session not connected, status: ${a}`)};r.connectionStatusChanged.connect(i),r.connectionStatus==="connected"&&(E("Raw session connected"),n.resolve(r.connectionStatus)),E("Waiting for Raw session to be ready");let o=await pr(t,n.promise);if(r.connectionStatusChanged.disconnect(i),E(`Waited for Raw session to be ready & got status: ${o}`),o!=="connected")throw new Vm(e)}var lT=class{constructor(e,t,n,i,o,s){this.resource=e;this.kernelConnectionMetadata=i;this.type=s;this.isDisposed=!1;this.statusChanged=new Ta.Signal(this);this.kernelChanged=new Ta.Signal(this);this.terminated=new Ta.Signal(this);this.iopubMessage=new Ta.Signal(this);this.unhandledMessage=new Ta.Signal(this);this.anyMessage=new Ta.Signal(this);this.disposed=new Ta.Signal(this);this.connectionStatusChanged=new Ta.Signal(this);this.propertyChanged=new Ta.Signal(this);this._didShutDownOnce=!1;this.id=(0,K4.default)(),this.name=ng(this.kernelConnectionMetadata)||"python3",this.path=this.resource?.fsPath||this.kernelConnectionMetadata.interpreter?.uri.fsPath||"kernel_path",this._kernel=new cT(e,t,n,o,i),this._kernel.statusChanged.connect(this.onKernelStatus,this),this._kernel.iopubMessage.connect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.connect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.connect(this.onUnhandledMessage,this),this._kernel.anyMessage.connect(this.onAnyMessage,this),this._kernel.disposed.connect(this.onDisposed,this)}get atleastOneCellExecutedSuccessfully(){return this.cellExecutedSuccessfully===!0}get jupyterLabServices(){return this._jupyterLabServices||(this._jupyterLabServices=require("@jupyterlab/services")),this._jupyterLabServices}get connectionStatus(){return this._kernel?.connectionStatus||"disconnected"}get serverSettings(){return require("@jupyterlab/services").ServerConnection.makeSettings({wsUrl:"RAW"})}get model(){return{id:this.id,name:this.name,path:this.path,type:"notebook",kernel:{id:this._kernel?.id,name:this.name}}}get status(){return this.isDisposed?"dead":this.isTerminating?"terminating":this.kernel?.status??"unknown"}get kernel(){return this._kernel}async startKernel(e){await Zi(this.resource,{kernelConnection:this.kernelConnectionMetadata}),await this._kernel.start(e.token)}dispose(){this._isDisposing=!0;let e=new Error().stack;Rt(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",void 0,{stacktrace:e});try{this._kernel.statusChanged.disconnect(this.onKernelStatus,this),this._kernel.iopubMessage.disconnect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.disconnect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this._kernel.anyMessage.disconnect(this.onAnyMessage,this),this._kernel.disposed.disconnect(this.onDisposed,this)}catch{}this.shutdown().catch(f).finally(()=>{this._kernel.dispose(),this.isDisposed=!0,this.disposed.emit(),Ta.Signal.disconnectAll(this)})}async shutdown(){this._didShutDownOnce||(this._didShutDownOnce=!0,this.isTerminating=!0,this.statusChanged.emit("terminating"),await this._kernel.shutdown().catch(e=>j(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,e)),this.isTerminating=!1,this._isDisposing&&(this.isDisposed=!0),this.terminated.emit(),this.statusChanged.emit(this.status))}onKernelStatus(e,t){ne(`RawSession status changed to ${t}`),this.statusChanged.emit(t)}setPath(e){throw new Error("Not yet implemented")}setName(e){throw new Error("Not yet implemented")}setType(e){throw new Error("Not yet implemented")}changeKernel(e){throw new Error("Not yet implemented")}onIOPubMessage(e,t){!this.cellExecutedSuccessfully&&t.header.msg_type==="execute_result"&&t.content&&(this.jupyterLabServices.KernelMessage.isExecuteResultMsg(t)||this.jupyterLabServices.KernelMessage.isExecuteInputMsg(t))&&t.content.execution_count&&(this.cellExecutedSuccessfully=!0),this.iopubMessage.emit(t)}onAnyMessage(e,t){this.anyMessage.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onKernelConnectionStatus(e,t){this.connectionStatusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};var Fy=class{constructor(e,t){this.configService=e;this.kernelLauncher=t}async create(e){E(`Creating raw notebook for resource '${W(e.resource)}'`);let t,[n]=await Promise.all([ar(e.token,Gx(e.resource).then(o=>F4.Uri.file(o))),ar(e.token,Zi(e.resource,{kernelConnection:e.kernelConnection}))]),i=this.configService.getSettings(e.resource).jupyterLaunchTimeout;t=new lT(e.resource,this.kernelLauncher,n,e.kernelConnection,i,(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console");try{await ar(e.token,t.startKernel(e))}catch(o){throw mr(o)||e.token.isCancellationRequested?E("Starting of raw session cancelled by user"):x(`Failed to connect raw kernel session: ${o}`),t?.shutdown().catch(s=>x(`Failed to dispose of raw session on launch error: ${s} `)).finally(()=>t?.dispose()).catch(f),o}return new tT(t,e.resource,e.kernelConnection)}};Fy=v([(0,xC.injectable)(),d(0,(0,xC.inject)(le)),d(1,(0,xC.inject)(R_))],Fy);var uT=_(O());var Ly=class{constructor(e){this.configuration=e}get isSupported(){return this.isSupportedForLocalLaunch()}isSupportedForLocalLaunch(){return!this.isZQMDisabled()&&this.zmqSupported()}isZQMDisabled(){return this.configuration.getSettings().disableZMQSupport}zmqSupported(){if(typeof this._isSupported=="boolean")return this._isSupported;if((process.env.VSC_JUPYTER_NON_RAW_NATIVE_TEST||"").toLowerCase()==="true")return!1;try{iT(),this._isSupported=!0}catch{this._isSupported=!1}return this._isSupported}};Ly=v([(0,uT.injectable)(),d(0,(0,uT.inject)(le))],Ly);var hu=_(O()),L4=require("vscode");var Rn=Symbol("IJupyterVariables"),pT=Symbol("IKernelVariableRequester");var uf=class{constructor(e,t,n){this.kernelVariables=t;this.debuggerVariables=n;this.refreshEventEmitter=new L4.EventEmitter;e.push(n.refreshRequired(this.fireRefresh.bind(this))),e.push(t.refreshRequired(this.fireRefresh.bind(this)))}get refreshRequired(){return this.refreshEventEmitter.event}getAllVariableDiscriptions(e,t,n,i){return this.variableHandler.getAllVariableDiscriptions(e,t,n,i)}async getVariables(e,t){return this.variableHandler.getVariables(e,t)}async getFullVariable(e,t){return this.variableHandler.getFullVariable(e,t)}async getMatchingVariable(e,t,n){return this.variableHandler.getMatchingVariable(e,t,n)}async getDataFrameInfo(e,t,n,i){return this.variableHandler.getDataFrameInfo(e,t,n,i)}async getDataFrameRows(e,t,n,i,o){return this.variableHandler.getDataFrameRows(e,t,n,i,o)}get variableHandler(){return this.debuggerVariables.active?this.debuggerVariables:this.kernelVariables}fireRefresh(){this.refreshEventEmitter.fire()}};v([dr("DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME")],uf.prototype,"getVariables",1),uf=v([(0,hu.injectable)(),d(0,(0,hu.inject)(F)),d(1,(0,hu.inject)(Rn)),d(1,(0,hu.named)(Ge.KERNEL_VARIABLES)),d(2,(0,hu.inject)(Rn)),d(2,(0,hu.named)(Ge.DEBUGGER_VARIABLES))],uf);var gu=_(O()),dT=require("vscode");var Xve=/Type:\s*(\w+)/,Zve=/Value:\s*(.*)/,eye=/String form:\s*([\s\S]+?)\n/,tye=/Docstring:\s*(.*)/,rye=/Length:\s+(.*)/,nye=/^\s+\[(\d+) rows x (\d+) columns\]/m,iye=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]),Uy=class{constructor(e,t,n,i){this.configService=e;this.disposables=n;this.kernelProvider=i;this.variableRequesters=new Map;this.cachedVariables=new Map;this.refreshEventEmitter=new dT.EventEmitter;this.variableRequesters.set(xe,t)}get refreshRequired(){return this.refreshEventEmitter.event}async getAllVariableDiscriptions(e,t,n,i){let o=Lo(e.kernelConnectionMetadata)||xe,s=this.variableRequesters.get(o);return s?s.getAllVariableDiscriptions(e,t,n,i):[]}async getVariables(e,t){return this.getVariablesBasedOnKernel(t,e)}async getMatchingVariable(e,t,n){let i=this.cachedVariables.get(t.uri.toString());if(i){let o=i.variables.find(s=>s.name===e);return o&&!o.value&&(o=await this.getVariableValueFromKernel(o,t,n)),o}else{let o=await this.getVariableNamesAndTypesFromKernel(t,n);if(o){let s=o.find(a=>a.name===e);if(s)return this.getVariableValueFromKernel({name:e,value:void 0,supportsDataExplorer:!1,type:s.type,size:0,count:0,shape:"",truncated:!0},t,n)}}}async getDataFrameInfo(e,t,n,i){if(!t)return e;let o=Lo(t?.kernelConnectionMetadata)||xe,s=this.variableRequesters.get(o);if(s){i&&(e=await this.getFullVariable(e,t));let a=e.name;return n&&(a=`${e.name}${n}`),s.getDataFrameInfo(e,t,a)}return e}async getDataFrameRows(e,t,n,i,o){let s=Lo(i?.kernelConnectionMetadata)||xe,a=this.variableRequesters.get(s);if(a){let c=e.name;return o&&(c=`${e.name}${o}`),a.getDataFrameRows(t,n,i,c)}return{data:[]}}async getFullVariable(e,t,n){let i=Lo(t?.kernelConnectionMetadata)||xe,o=this.variableRequesters.get(i);return o?o.getFullVariable(e,t,n):e}async getVariablesBasedOnKernel(e,t){let n=this.cachedVariables.get(e.uri.toString()),i=this.kernelProvider.getKernelExecution(e).pendingCells.length>0,o=this.kernelProvider.getKernelExecution(e);(!n||!i&&(n.currentExecutionCount!==t.executionCount||n.currentExecutionCount!==o.executionCount))&&(n={currentExecutionCount:o.executionCount,variables:(await this.getVariableNamesAndTypesFromKernel(e)).map(c=>({name:c.name,value:void 0,supportsDataExplorer:!1,type:c.type,size:0,shape:"",count:0,truncated:!0,fileName:e.notebook.uri}))});let s=this.configService.getSettings(e.resourceUri).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],a={executionCount:o.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(n){let c=t.sortColumn,l=(m,h)=>{let g=m[c]?m[c]:"",b=h[c]?h[c]:"";return t.sortAscending?g.localeCompare(b,void 0,{sensitivity:"base"}):b.localeCompare(g,void 0,{sensitivity:"base"})};n.variables.sort(l);let u=t.startIndex?t.startIndex:0,p=t.pageSize?t.pageSize:100;a.pageStartIndex=u;for(let m=u;m<u+p&&m<n.variables.length;){if(s&&s.indexOf(n.variables[m].type)>=0){n.variables.splice(m,1);continue}let h=typeof n.variables[m].value=="string"?n.variables[m]:await this.getVariableValueFromKernel(n.variables[m],e);n.variables[m]=h,a.pageResponse.push(h),m+=1}this.cachedVariables.set(e.uri.toString(),n),a.totalCount=n.variables.length}return a}async getVariableProperties(e,t,n){let i=await this.getMatchingVariable(e,t,n),o=Lo(t.kernelConnectionMetadata)||xe,s=this.variableRequesters.get(o);return s?s.getVariableProperties(e,n,i):{}}async getVariableNamesAndTypesFromKernel(e,t){let n=Lo(e.kernelConnectionMetadata)||xe,i=this.variableRequesters.get(n);return i?i.getVariableNamesAndTypesFromKernel(e,t):[]}inspect(e,t,n=0,i){let o=ue();try{e.requestInspect({code:t,cursor_pos:n,detail_level:0}).then(s=>{s&&s.content.status==="ok"?o.resolve(s.content.data):o.resolve(void 0)}).catch(s=>{o.reject(s)})}catch(s){o.reject(s)}return i&&this.disposables.push(i.onCancellationRequested(()=>o.reject(new dT.CancellationError))),o.promise}async getVariableValueFromKernel(e,t,n){let i={...e};if(!t.disposed&&t.session?.kernel){let o=await this.inspect(t.session.kernel,e.name,0,n);if(o&&o.hasOwnProperty("text/plain")){let s=tl(o["text/plain"].toString()),a=Xve.exec(s),c=rye.exec(s),l=nye.exec(s);a&&(i.type=a[1]),i.value=[Zve,eye,tye].reduce((u,p)=>u||p.exec(s)?.[1]||"",""),c&&(i.count=parseInt(c[1],10)),l&&(i.shape=`(${l[1]}, ${l[2]})`)}o&&o.type&&(i.type=o.type.toString()),o&&o.value&&(i.value=o.value.toString()),iye.has(i.type)&&(i.supportsDataExplorer=!0)}return i.type&&i.count&&!i.shape&&_t(t.kernelConnectionMetadata)&&i.supportsDataExplorer&&i.type!=="list"&&(i=await this.getFullVariable(i,t)),i}};Uy=v([(0,gu.injectable)(),d(0,(0,gu.inject)(le)),d(1,(0,gu.inject)(pT)),d(1,(0,gu.named)(Ge.PYTHON_VARIABLES_REQUESTER)),d(2,(0,gu.inject)(F)),d(3,(0,gu.inject)(Ke))],Uy);var il=_(O());var jy=class{constructor(e,t,n,i,o,s,a){this.activationService=e;this.jupyterInterpreterService=t;this.disposables=n;this.extensionChecker=i;this.apiProvider=o;this.rawNotebookSupported=s;this.condaService=a}activate(){this.rawNotebookSupported.isSupported||(this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(()=>this.preWarmInterpreterVariables().catch(f))),this.preWarmInterpreterVariables().catch(f),this.apiProvider.onDidActivatePythonExtension(this.preWarmInterpreterVariables,this,this.disposables)),this.extensionChecker.isPythonExtensionInstalled&&(this.condaService.getCondaFile().catch(f),this.condaService.getCondaVersion().catch(f))}async preWarmInterpreterVariables(){if(!this.extensionChecker.isPythonExtensionActive)return;let e=await this.jupyterInterpreterService.getSelectedInterpreter();e&&this.activationService.getActivatedEnvironmentVariables(void 0,e).catch(f)}};jy=v([(0,il.injectable)(),d(0,(0,il.inject)(Ps)),d(1,(0,il.inject)(ci)),d(2,(0,il.inject)(F)),d(3,(0,il.inject)(ze)),d(4,(0,il.inject)(Gt)),d(5,(0,il.inject)(li)),d(6,(0,il.inject)(Rs))],jy);var wC=_(O());var Wy=class extends Ye{constructor(){super("unknown",y.jupyterDataRateExceeded)}};function BF(r){let e=r.index,t=r.columns;return{data:r.data.map((o,s)=>{let a={index:e[s]};return t.forEach((c,l)=>{a[c]=o[l]}),a})}}async function CC(r,{code:e,initializeCode:t,cleanupCode:n},i){if(r.disposed||r.disposing||!r.session?.kernel||!r.session.kernel||r.session.isDisposed)return[];try{return t&&await vn(r.session.kernel,t,i),await vn(r.session.kernel,e,i)}catch(o){if(o instanceof gn)return[];throw o}finally{n&&await vn(r.session.kernel,n,i)}}var Vy=class{constructor(e,t){this.varScriptGenerator=e;this.dfScriptGenerator=t}async getDataFrameInfo(e,t,n){let{code:i,cleanupCode:o,initializeCode:s}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!1,variableName:n}),a=await CC(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameInfo",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"}),c=t.notebook?.uri||t.resourceUri||t.uri;return{...e,...this.deserializeJupyterResult(a),fileName:c}}async getDataFrameRows(e,t,n,i){let{code:o,cleanupCode:s,initializeCode:a}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!1,variableName:i,startIndex:e,endIndex:t}),c=await CC(n,{code:o,cleanupCode:s,initializeCode:a},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameRows",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return c.length===0?{data:[]}:BF(this.deserializeJupyterResult(c))}async getVariableProperties(e,t,n){let i={};return n&&n.value&&(i[`${e}`]=n.value),i}async getAllVariableDiscriptions(e,t,n,i){if(!e.session)return[];let{code:o,cleanupCode:s,initializeCode:a}=await this.varScriptGenerator.generateCodeToGetAllVariableDescriptions({isDebugging:!1,parent:t,startIndex:n}),c=await CC(e,{code:o,cleanupCode:s,initializeCode:a},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request when retrieving variables",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});if(e.disposed||e.disposing||i?.isCancellationRequested)return[];try{return this.deserializeJupyterResult(c)}catch(l){return x(l),[]}}async getVariableNamesAndTypesFromKernel(e,t){if(e.session){let{code:n,cleanupCode:i,initializeCode:o}=await this.varScriptGenerator.generateCodeToGetVariableTypes({isDebugging:!1}),s=await CC(e,{code:n,cleanupCode:i,initializeCode:o},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getVariableNamesAndTypesFromKernel",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});if(e.disposed||e.disposing)return[];let a=this.deserializeJupyterResult(s),c=[];for(let[l,u]of Object.entries(a)){let p={name:l,value:void 0,supportsDataExplorer:!1,type:u||"",size:0,shape:"",count:0,truncated:!0};c.push(p)}return c}return[]}async getFullVariable(e,t,n){let{code:i,cleanupCode:o,initializeCode:s}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!1,variableName:e.name}),a=await CC(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getFullVariable",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return{...e,...this.deserializeJupyterResult(a)}}extractJupyterResultText(e){if(e.length>0){let t=e[0];if(t&&t.output_type==="stream"&&t.name==="stderr"&&t.hasOwnProperty("text")){let n=t.text;if(n.includes("iopub_data_rate_limit"))throw new Wy;{let i=y.jupyterGetVariablesExecutionError(n);throw x(i),new Error(i)}}if(t&&t.output_type==="execute_result"){let n=t.data;if(n&&n.hasOwnProperty("text/plain"))return n["text/plain"]}if(t&&t.output_type==="stream"&&t.hasOwnProperty("text"))return t.text;if(t&&t.output_type==="error"&&t.hasOwnProperty("traceback")){let i=t.traceback.map(tl).join(`\r
`),o=y.jupyterGetVariablesExecutionError(i);throw x(o),new Error(o)}}throw new Error(y.jupyterGetVariablesBadResults)}deserializeJupyterResult(e){let t=this.extractJupyterResultText(e);return JSON.parse(t)}};Vy=v([(0,wC.injectable)(),d(0,(0,wC.inject)(Sh)),d(1,(0,wC.inject)(xh))],Vy);var pf=_(O());var j4=require("vscode");var U4=1e3*60*60*24*2,Ra=class extends Zt{constructor(t,n,i,o){super();this.serverStorage=n;this.context=i;this.fs=o;this.executedCells=new WeakMap;this.chainedPromises=Promise.resolve();i.globalStorageUri,t.push(this),this.storageFile=j4.Uri.joinPath(this.context.globalStorageUri,"lastExecutedRemoteCell.json")}activate(){this._register(this.serverStorage.onDidRemove(this.onDidRemoveServers,this))}async getLastTrackedCellExecution(t,n){if(t.isUntitled||!Ft(n.kernelConnectionMetadata)||!n.session?.id)return;if(this.staleState&&this.staleState[t.uri.toString()])return this.staleState[t.uri.toString()];let i=await this.getStorageFile(),o={};try{let s=await this.fs.readFile(i);o=JSON.parse(s.toString()),this.staleState=o}catch{return}return o[t.uri.toString()]}trackCellExecution(t,n){if(!Ft(n.kernelConnectionMetadata)||t.document.isUntitled)return;this.executedCells.delete(t);let i=[],o=(a,c)=>{if(c.direction==="send"){let l=c.msg;if(l.header.msg_type==="execute_request"&&l.metadata&&typeof l.metadata=="object"&&l.metadata&&"cellId"in l.metadata&&typeof l.metadata.cellId=="string"&&l.metadata.cellId===t.document.uri.toString()){let u=l.header.msg_id;this.executedCells.set(t,{msg_id:u,kernelId:n.session?.kernel?.id||"",cellIndex:t.index})}}else if(c.direction==="recv"){let l=c.msg,u=this.executedCells.get(t);if(u?.msg_id&&lu(l)===u.msg_id){if(!u.startTime){u.startTime=new Date().getTime();try{u.startTime=new Date(l.header.date).getTime()}catch{}this.executedCells.set(t,u)}"execution_count"in l.content&&typeof l.content.execution_count=="number"&&!u.executionCount&&u.executionCount!==l.content.execution_count&&(u.executionCount=l.content.execution_count,this.executedCells.set(t,u),this.trackLastExecution(t,n,u),Q(i))}}},s=()=>{let a=n.session;a&&(a.anyMessage.connect(o),i.push({dispose:()=>An(()=>a.anyMessage?.disconnect(o))}))};n.onStarted(()=>s(),i),n.session&&s()}deleteTrackedCellExecution(t,n){t.notebook.isUntitled||!Ft(n.kernelConnectionMetadata)||!n.session?.id||(this.chainedPromises=this.chainedPromises.finally(async()=>{let i={};try{let s=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));i=JSON.parse(s.toString())}catch{return}let o=t.notebook.uri.toString();i[o].cellIndex===t.index&&(delete i[o],this.staleState=i,await this.fs.writeFile(this.storageFile,JSON.stringify(i)))}))}getStorageFile(){return this.ensureStorageExistsPromise=this.ensureStorageExistsPromise||(async()=>(await this.fs.createDirectory(this.context.globalStorageUri),this.storageFile))(),this.ensureStorageExistsPromise}trackLastExecution(t,n,i){if(!i.executionCount||!i.msg_id||!i.startTime||!Ft(n.kernelConnectionMetadata)||!n.session?.id)return;let o={cellIndex:t.index,executionCount:i.executionCount,kernelId:n.session?.kernel?.id||"",msg_id:i.msg_id,serverId:Wt(n.kernelConnectionMetadata.serverProviderHandle),sessionId:n.session?.id,startTime:i.startTime};this.chainedPromises=this.chainedPromises.finally(async()=>{let s={};try{let c=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));s=JSON.parse(c.toString())}catch{}let a=t.notebook.uri.toString();s[a]=o,this.removeOldItems(s),this.staleState=s,await this.fs.writeFile(this.storageFile,JSON.stringify(s))})}onDidRemoveServers(t){t.length!==0&&(this.chainedPromises=this.chainedPromises.finally(async()=>{await this.getStorageFile();let n={};try{let s=await this.fs.readFile(this.storageFile);n=JSON.parse(s.toString())}catch{}let i=!1,o=new Set(t.map(s=>Wt(s)));Object.keys(n).forEach(s=>{let a=n[s];(o.has(a.serverId)||Date.now()-a.startTime>U4)&&(delete n[s],i=!0)}),i&&(this.removeOldItems(n),this.staleState=n,await this.fs.writeFile(this.storageFile,JSON.stringify(n)))}))}removeOldItems(t){Object.keys(t).forEach(n=>{let i=t[n];i&&Date.now()-i.startTime>U4&&delete t[n]})}};Ra=v([(0,pf.injectable)(),d(0,(0,pf.inject)(F)),d(1,(0,pf.inject)(er)),d(2,(0,pf.inject)(lt)),d(3,(0,pf.inject)(st))],Ra);var qy=_(O());var EC=require("vscode");var By=class{constructor(e,t,n){this.serverUriStorage=e;this.registrations=t;this.disposables=n}activate(){this.disposables.push(EC.commands.registerCommand($.ClearSavedJupyterUris,async()=>{await this.serverUriStorage.clear().catch(f),await Promise.all(this.registrations.jupyterCollections.filter(e=>e.id.startsWith("_builtin")||e.extensionId===It).map(async e=>{if(!e.serverProvider||!e.serverProvider.removeJupyterServer)return;let t=new EC.CancellationTokenSource,n=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await Promise.all((n||[]).map(i=>e.serverProvider.removeJupyterServer(i).catch(f)))})).catch(f),await EC.commands.executeCommand("dataScience.ClearUserProviderJupyterServerCache").then(f,f)},this))}};By=v([(0,qy.injectable)(),d(0,(0,qy.inject)(er)),d(1,(0,qy.inject)(Qt)),d(2,(0,qy.inject)(F))],By);var mT=_(O());var Jy=class{constructor(e){this.registry=e;this.priority=0}activate(){this.registry.register(this,bt),this.registry.register(this,gt)}async getCode(e){return _t(e.kernelConnectionMetadata)?[n9]:[]}};Jy=v([(0,mT.injectable)(),d(0,(0,mT.inject)(Fo))],Jy);function W4(r,e){r.addSingleton(be,Uv),r.addSingleton(be,Vv),r.addSingleton(be,Dy),r.addSingleton(li,Ly),r.addSingleton(Qo,Qo),r.addSingleton(A_,Fy),r.addSingleton(R_,Po),r.addSingleton(Ca,Ca),r.addSingleton(Rr,Iy),r.addSingleton(be,af),r.addSingleton(be,jv),r.addSingleton(Fr,Fr),r.addSingleton(ad,rl),r.addSingleton(ts,ts),r.addBinding(ts,be),r.addSingleton(pu,pu),r.addSingleton(be,_y),r.addSingleton(be,jy),r.addSingleton(Rn,uf,Ge.ALL_VARIABLES),r.addSingleton(Rn,Uy,Ge.KERNEL_VARIABLES),r.addSingleton(pT,Vy,Ge.PYTHON_VARIABLES_REQUESTER),r.addSingleton(Cs,nd),r.addSingleton(be,nf),r.addSingleton(be,Ey),r.addSingleton(be,yy),r.addSingleton(be,by),r.addSingleton(be,ky),r.addSingleton(Ke,Cy),r.addSingleton(dm,wy),r.addSingleton(be,By),r.addSingleton(Ra,Ra),r.addBinding(Ra,be),$5(r,e),Kh("isInsiderExtension",Lu());let t=r.get(ze);Kh("isPythonExtensionInstalled",t.isPythonExtensionInstalled?"true":"false");let n=r.get(li);Kh("rawKernelSupported",n.isSupported?"true":"false"),r.addSingleton(be,Xr),r.addSingleton(Fo,Py),r.addSingleton(mu,mu),r.addSingleton(be,Jy)}var pd=_(O()),is=require("vscode");var $y=class{constructor(e,t,n,i,o){this.disposables=e;this.extensionChecker=t;this.progressReporter=n;this.pythonApi=i;this.errorHandler=o;this.executingCells=new WeakSet}activate(){this.disposables.push(is.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this)),this.disposables.push(is.commands.registerCommand($.InstallPythonExtensionViaKernelPicker,this.installPythonExtensionViaKernelPicker,this)),this.disposables.push(is.commands.registerCommand($.InstallPythonViaKernelPicker,this.installPythonViaKernelPicker,this))}onDidChangeNotebookCellExecutionState(e){e.cell.notebook.notebookType===bt&&(e.state===is.NotebookCellExecutionState.Pending||e.state===is.NotebookCellExecutionState.Executing?this.executingCells.add(e.cell):e.state===is.NotebookCellExecutionState.Idle&&this.executingCells.delete(e.cell))}async installPythonViaKernelPicker(){A("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.installedOnceBefore?[ye.install,ye.reload]:[ye.install],t=await is.window.showErrorMessage(y.pythonNotInstalled,{modal:!0},...e);t===ye.install?(this.installedOnceBefore=!0,A("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"download"}),await is.commands.executeCommand("python.installPython")):t===ye.reload?(A("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"reload"}),await is.commands.executeCommand("jupyter.reloadVSCode",y.reloadRequired)):A("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtensionViaKernelPicker(){if(!this.extensionChecker.isPythonExtensionInstalled){A("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.progressReporter.createProgressIndicator(y.installingPythonExtension);try{await this.extensionChecker.directlyInstallPythonExtension();let t="hooked",n=await pr(6e4,"timeout",this.pythonApi.pythonExtensionHooked.then(()=>t));if(this.extensionChecker.isPythonExtensionInstalled&&n===t)return E("Python Extension installed via Kernel Picker command"),A("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"success"}),!0;x("Failed to install Python Extension via Kernel Picker command"),A("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"failed"}),this.errorHandler.handleError(new Error(y.failedToInstallPythonExtension)).then(f,f)}finally{e.dispose()}}}};$y=v([(0,pd.injectable)(),d(0,(0,pd.inject)(F)),d(1,(0,pd.inject)(ze)),d(2,(0,pd.inject)(Go)),d(3,(0,pd.inject)(Gt)),d(4,(0,pd.inject)(Yr))],$y);var Hy=_(O()),mf=require("vscode");var df=class{constructor(e,t,n){this.disposables=e;this.controllerRegistration=t;this.preferredRemoteKernelIdProvider=n}activate(){mf.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebook,this,this.disposables),mf.workspace.notebookDocuments.forEach(e=>this.onDidOpenNotebook(e))}async onDidOpenNotebook(e){if(!Tt(e))return;let t=await this.preferredRemoteKernelIdProvider.getPreferredRemoteKernelId(e.uri);if(!t)return;let n=()=>{let o=this.controllerRegistration.getSelected(e),s=this.controllerRegistration.registered.find(a=>a.id===t);return s&&o?.id!==s.id?(this.switchKernel(e,s.connection).catch(f),!0):!1};if(n())return;let i=this.controllerRegistration.onDidChange(o=>{o.added.length&&n()&&i.dispose()},this,this.disposables);this.controllerRegistration.onControllerSelected(o=>{o.notebook===e&&i.dispose()},this,this.disposables)}async switchKernel(e,t){E(`Using notebook.selectKernel to force remote kernel for ${W(e.uri)} to ${t.id}`),await mf.commands.executeCommand("notebook.selectKernel",{id:t.id,extension:It}),await Dw(async()=>{if(mf.window.activeNotebookEditor?.notebook===e){let i=this.controllerRegistration.getSelected(e);if(i?.connection.id===t.id)return i.restoreConnection(e).catch(f),!0}return!1},2e3,100)?E(`Successfully switched remote kernel for ${W(e.uri)} to ${t.id}`):j(`Failed to switch remote kernel for ${W(e.uri)} to ${t.id}`)}};v([Mr()],df.prototype,"onDidOpenNotebook",1),df=v([(0,Hy.injectable)(),d(0,(0,Hy.inject)(F)),d(1,(0,Hy.inject)(Ct)),d(2,(0,Hy.inject)(Qo))],df);var zy=_(O()),md=require("vscode");var _o=require("vscode");var kC=_(O()),H4=require("vscode");var JF=_(So()),q4=require("vscode");function V4(r){if(!r||!Array.isArray(r)||r.length===0)return;let e=[];for(let t=0;t<r.length;t+=1){let n=r[t];if("buffer"in n&&"byteOffset"in n){let i=Array.apply(null,new Uint8Array(n.buffer));e.push({...n,byteLength:n.byteLength,byteOffset:n.byteOffset,buffer:i})}else e.push([...new Uint8Array(n)])}return e}function B4(r){if(!Array.isArray(r)||r.length===0)return r;let e=[];for(let t=0;t<r.length;t+=1){let n=r[t];if("buffer"in n&&"byteOffset"in n){let i=new Uint8Array(n.buffer).buffer,o=new DataView(i,n.byteOffset,n.byteLength);e.push(o)}else{let i=new Uint8Array(n).buffer;e.push(i)}}return e}var PC=new WeakMap;function J4(r,e){let t=PC.get(r);t&&(t.targets.add(e),t.registerCommTarget(e))}function $4(r,e){PC.get(r)?.targets?.delete?.(e)}var fT=class{constructor(e,t){this.kernelProvider=e;this.document=t;this.commTargetsRegistered=new Set;this.pendingTargetNames=new Set;this._postMessageEmitter=new q4.EventEmitter;this.messageHooks=new Map;this.pendingHookRemovals=new Map;this.messageHookRequests=new Map;this.disposables=[];this.disposed=!1;this.pendingMessages=[];this.subscribedToKernelSocket=!1;this.waitingMessageIds=new Map;this.totalWaitTime=0;this.totalWaitedMessages=0;this.hookCount=0;this.outputWidgetIds=new Set;this.isUsingIPyWidgets=!1;this.pendingTargetNames.add("jupyter.widget"),e.onDidStartKernel(i=>{i.notebook===t&&this.initialize()},this,this.disposables),this.mirrorSend=this.mirrorSend.bind(this),this.onKernelSocketMessage=this.onKernelSocketMessage.bind(this);let n=require("@jupyterlab/services/lib/kernel/serialize");this.deserialize=n.deserialize}get postMessage(){return this._postMessageEmitter.event}dispose(){for(this.sendOverheadTelemetry(),this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}receiveMessage(e){switch(e.message){case"IPyWidgets_logMessage":{let t=e.payload;t.category==="error"?x(`Widget Error: ${t.message}`):E(`Widget Message: ${t.message}`);break}case"IPyWidgets_Ready":this.sendKernelOptions(),this.initialize();break;case"IPyWidgets_msg":this.sendRawPayloadToKernelSocket(e.payload);break;case"IPyWidgets_binary_msg":this.sendRawPayloadToKernelSocket(B4(e.payload)[0]);break;case"IPyWidgets_msg_received":this.onKernelSocketResponse(e.payload);break;case"IPyWidgets_registerCommTarget":this.registerCommTarget(e.payload);break;case"IPyWidgets_RegisterMessageHook":this.registerMessageHook(e.payload);break;case"IPyWidgets_RemoveMessageHook":this.possiblyRemoveMessageHook(e.payload);break;case"IPyWidgets_MessageHookResult":this.handleMessageHookResponse(e.payload);break;case"IPyWidgets_iopub_msg_handled":this.iopubMessageHandled(e.payload);break;default:break}}sendRawPayloadToKernelSocket(e){this.pendingMessages.push(e),this.sendPendingMessages()}registerCommTarget(e){this.pendingTargetNames.add(e),this.initialize()}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services"));let e=this.getKernel();e&&(this.subscribeToKernelSocket(e),this.registerCommTargets(e)),E("IPyWidgetMessageDispatcher.initialize")}raisePostMessage(e,t){this._postMessageEmitter.fire({message:e,payload:t})}subscribeToKernelSocket(e){if(this.subscribedToKernelSocket||!e.session)return;this.subscribedToKernelSocket=!0,this.subscribeToKernelSocketImpl(e);let t=e.session.kernel?.id;e.session.onDidKernelSocketChange(()=>{this.subscribeToKernelSocketImpl(e,t),t=e.session?.kernel?.id||""})}subscribeToKernelSocketImpl(e,t){let n=t?eo.get(t):void 0;if(n?.removeReceiveHook(this.onKernelSocketMessage),n?.removeSendHook(this.mirrorSend),this.kernelWasConnectedAtLeastOnce){for(;this.pendingMessages.length;)this.pendingMessages.shift();this.waitingMessageIds.forEach(s=>s.resultPromise.resolve()),this.waitingMessageIds.clear(),this.messageHookRequests.forEach(s=>s.resolve(!1)),this.messageHookRequests.clear(),this.messageHooks.clear(),this.sendRestartKernel()}if(!e.session?.kernel?.id||!eo.get(e.session?.kernel?.id))return;PC.has(e.session.kernel)||PC.set(e.session.kernel,{targets:new Set,registerCommTarget:s=>{this.raisePostMessage("IPyWidgets_registerCommTarget",s)}}),this.kernelWasConnectedAtLeastOnce=!0;let i=e.session.kernel?.id,o=i?eo.get(i):void 0;o?.addReceiveHook(this.onKernelSocketMessage),o?.addSendHook(this.mirrorSend),this.sendKernelOptions(),this.registerCommTargets(e),this.sendPendingMessages()}sendKernelOptions(){this.kernel?.session?.kernel&&this.raisePostMessage("IPyWidgets_kernelOptions",{id:this.kernel?.session?.kernel?.id||"",clientId:this.kernel?.session?.kernel?.clientId||"",userName:this.kernel?.session?.kernel?.username||"",model:this.kernel?.session?.kernel?.model||{id:"",name:""}})}async mirrorSend(e,t){if(typeof e=="string"&&e.includes("shell")&&e.includes("execute_request")){let n=Date.now(),i=this.deserialize(e);if(i.channel==="shell"&&i.header.msg_type==="execute_request"){if(!PD(i))return;let o=this.mirrorExecuteRequest(i);this.isUsingIPyWidgets&&await o,this.totalWaitTime=Date.now()-n,this.totalWaitedMessages+=1}}}sendRestartKernel(){this.raisePostMessage("IPyWidgets_onRestartKernel",void 0)}mirrorExecuteRequest(e){let t=ue();return this.waitingMessageIds.set(e.header.msg_id,{startTime:Date.now(),resultPromise:t}),this.raisePostMessage("IPyWidgets_mirror_execute",{id:e.header.msg_id,msg:e}),t.promise}messageNeedsFullHandle(e){return e.channel==="iopub"&&e.header?.msg_type==="comm_msg"&&e.content?.data?.method==="update"&&this.outputWidgetIds.has(e.content?.comm_id)}iopubMessageHandled(e){let t=e.id;this.fullHandleMessage&&this.fullHandleMessage.id===t&&(this.fullHandleMessage.promise.resolve(),this.fullHandleMessage=void 0)}async onKernelSocketMessage(e){let t=(0,JF.default)(),n=ue();if(this.waitingMessageIds.set(t,{startTime:Date.now(),resultPromise:n}),typeof e=="string"?PD(e)&&this.raisePostMessage("IPyWidgets_msg",{id:t,data:e}):this.raisePostMessage("IPyWidgets_binary_msg",{id:t,data:V4([e])}),typeof e!="string"||e.includes(Ui)||e.includes(Ge.DefaultCommTarget)||e.includes("comm_open")||e.includes("comm_close")||e.includes("comm_msg")){let o=this.deserialize(e);if(!PD(o))return;o&&o.content&&o.content.data&&(o.content.data[Ui]||o.content.target_name===Ge.DefaultCommTarget)&&(this.isUsingIPyWidgets=!0);let s=o.header?.msg_type==="comm_open"&&o.content?.data?.state?._model_module==="@jupyter-widgets/output"&&o.content?.data?.state?._model_name==="OutputModel",a=o.header?.msg_type==="comm_close"&&this.outputWidgetIds.has(o.content?.comm_id);s?this.outputWidgetIds.add(o.content.comm_id):a?this.outputWidgetIds.delete(o.content.comm_id):this.messageNeedsFullHandle(o)&&(this.fullHandleMessage={id:o.header.msg_id,promise:ue()},await n.promise,await this.fullHandleMessage.promise.promise,this.fullHandleMessage=void 0)}}onKernelSocketResponse(e){let t=this.waitingMessageIds.get(e.id);t&&(this.waitingMessageIds.delete(e.id),this.totalWaitTime+=Date.now()-t.startTime,this.totalWaitedMessages+=1,t.resultPromise.resolve())}sendPendingMessages(){if(this.kernel?.session?.kernel)for(;this.pendingMessages.length;)try{let e=this.pendingMessages[0],t=typeof e=="string"?JSON.parse(e):this.deserialize(e);t.buffers?.length&&(t.buffers=t.buffers.map(n=>n instanceof DataView?n.buffer:n)),t.channel==="control"?this.kernel.session.kernel.sendControlMessage(t):this.kernel.session.kernel.sendShellMessage(t),this.pendingMessages.shift()}catch(e){x("Failed to send message to Kernel",e);return}}registerCommTargets(e){for(;this.pendingTargetNames.size>0;){let n=Array.from([...this.pendingTargetNames.values()]).shift();if(n){if(this.commTargetsRegistered.has(n))return;E(`Registering commtarget ${n}`),this.commTargetsRegistered.add(n),this.pendingTargetNames.delete(n),e.session?.kernel&&n!==Ge.DefaultCommTarget&&!PC.get(e.session.kernel)?.targets?.has(n)&&e.session.kernel.registerCommTarget(n,f)}}}getKernel(){return this.document&&!this.kernel?.session&&(this.kernel=this.kernelProvider.get(this.document),this.kernel?.onDisposed(()=>this.kernel=void 0)),this.kernel&&!this.kernelRestartHandlerAttached&&(this.kernelRestartHandlerAttached=!0,this.disposables.push(this.kernel.onRestarted(this.handleKernelRestarts,this))),this.kernel}async handleKernelRestarts(){this.disposed||this.commTargetsRegistered.size===0||!this.kernel?.session||(Array.from(this.commTargetsRegistered.keys()).forEach(e=>{this.commTargetsRegistered.delete(e),this.pendingTargetNames.add(e)}),this.subscribeToKernelSocket(this.kernel),this.registerCommTargets(this.kernel))}registerMessageHook(e){try{if(this.kernel?.session?.kernel&&!this.messageHooks.has(e)){this.hookCount+=1;let t=this.messageHookCallback.bind(this);this.messageHooks.set(e,t),this.kernel.session.kernel.registerMessageHook(e,t)}}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e,type:"IPyWidgets_RegisterMessageHook"})}}possiblyRemoveMessageHook(e){try{e.lastHookedMsgId?this.pendingHookRemovals.set(e.lastHookedMsgId,e.hookMsgId):this.removeMessageHook(e.hookMsgId)}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e.hookMsgId,type:"IPyWidgets_RemoveMessageHook"})}}removeMessageHook(e){if(this.kernel?.session?.kernel&&this.messageHooks.has(e)){let t=this.messageHooks.get(e);this.messageHooks.delete(e),this.kernel.session.kernel.removeMessageHook(e,t)}}async messageHookCallback(e){let t=ue(),n=(0,JF.default)(),i=e.parent_header.msg_id;if(this.messageHooks.has(i)?(this.messageHookRequests.set(n,t),this.raisePostMessage("IPyWidgets_MessageHookCall",{requestId:n,parentId:i,msg:e})):t.resolve(!0),this.pendingHookRemovals.has(e.header.msg_id)){let o=this.pendingHookRemovals.get(e.header.msg_id);this.pendingHookRemovals.delete(e.header.msg_id),this.removeMessageHook(o)}return t.promise}handleMessageHookResponse(e){let t=this.messageHookRequests.get(e.requestId);t&&(this.messageHookRequests.delete(e.requestId),t.resolve(e.msgType.includes("comm")?!0:e.result))}sendOverheadTelemetry(){A("DS_INTERNAL.IPYWIDGET_OVERHEAD",{totalOverheadInMs:this.totalWaitTime,numberOfMessagesWaitedOn:this.totalWaitedMessages,averageWaitTime:this.totalWaitTime/this.totalWaitedMessages,numberOfRegisteredHooks:this.hookCount})}};var $F=class{constructor(e,t){this.baseMulticaster=e;this.oldMessages=t;this._postMessageEmitter=new H4.EventEmitter;this.disposables=[];e.postMessage(this.raisePostMessage,this,this.disposables)}get postMessage(){return this._postMessageEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}initialize(){return this.baseMulticaster.initialize()}receiveMessage(e){this.baseMulticaster.receiveMessage(e)}raisePostMessage(e){this.oldMessages.forEach(t=>{this._postMessageEmitter.fire(t)}),this.oldMessages=[],this._postMessageEmitter.fire(e)}},vu=class{constructor(e,t){this.kernelProvider=t;this.messageDispatchers=new WeakMap;this.messagesPerNotebook=new WeakMap;this.disposed=!1;this.disposables=[];e.push(this),t.onDidDisposeKernel(this.trackDisposingOfKernels,this,e)}dispose(){for(this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}create(e){let t=this.messageDispatchers.get(e);t||(t=new fT(this.kernelProvider,e),this.messageDispatchers.set(e,t),this.disposables.push(t.postMessage(o=>this.onMessage(o,e),this)));let n=[];e&&this.messagesPerNotebook.get(e)&&(n=this.messagesPerNotebook.get(e)||[]);let i=new $F(t,n);return this.disposables.push(i),i}trackDisposingOfKernels(e){if(this.disposed)return;let t=e.notebook,n=this.messageDispatchers.get(t);this.messageDispatchers.delete(t),n?.dispose()}onMessage(e,t){t&&(this.messagesPerNotebook.set(t,this.messagesPerNotebook.get(t)||[]),(e.message==="IPyWidgets_kernelOptions"||e.message==="IPyWidgets_registerCommTarget")&&this.messagesPerNotebook.get(t).push(e))}};vu=v([(0,kC.injectable)(),d(0,(0,kC.inject)(F)),d(1,(0,kC.inject)(Ke))],vu);var z4=require("vscode");var G4=require("vscode");var Gy=class Gy extends Zt{constructor(t,n,i,o,s,a){super();this.kernel=t;this.localResourceUriConverter=n;this.configurationSettings=i;this.sourceProviderFactory=o;this.isWebViewOnline=s;this.cdnScriptProvider=a;this.id="all";this.scriptProviders=this.sourceProviderFactory.getProviders(this.kernel,this.localResourceUriConverter),this.scriptProviders.forEach(c=>this._register(c)),this.monitorKernel()}get configuredScriptSources(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}static{this.trackedWidgetModuleNames=new Set}async getBaseUrl(){let t=this.scriptProviders.find(n=>n.getBaseUrl);if(t)return t.getBaseUrl()}async getWidgetScriptSources(){let t=[];return await Promise.all(this.scriptProviders.map(async n=>{n.getWidgetScriptSources&&t.push(...await n.getWidgetScriptSources())})),t}async getWidgetScriptSource(t,n){let i=await this.isWebViewOnline,o=this.scriptProviders.slice(),s={moduleName:t};for(;o.length;){let a=o.shift();if(!a)continue;let c=await a.getWidgetScriptSource(t,n,i);if(c.scriptUri){s=c;break}else j(`Widget Script Source not found for ${t}@${n} from ${a.id}`)}return this.sendTelemetryForWidgetModule(t,n,"",s.source).catch(f),s.scriptUri?E(`Script source for Widget ${t}@${n} was found from source ${s.source} and ${s.scriptUri}`):x(`Script source for Widget ${t}@${n} not found in ${this.scriptProviders.map(a=>a.id).join(", ")}`),s}async sendTelemetryForWidgetModule(t,n,i,o){let s=`${t}.${t}@${n}`;if(Gy.trackedWidgetModuleNames.has(s))return;Gy.trackedWidgetModuleNames.add(s);let a=t.toLowerCase().startsWith("@jupyter-widgets"),c=o==="cdn"||a||await this.cdnScriptProvider.isOnCDN(t),l=c?t.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0,u=c?i.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0;A("DS_INTERNAL.IPYWIDGET_USED_BY_USER",void 0,{hashedName:await vt(t),moduleName:l,modelName:u,source:o,moduleVersion:c?n:void 0,cdnSearched:this.configuredScriptSources.length>0})}monitorKernel(){this.hookKernelEvents(),this._register(this.kernel.onStarted(this.hookKernelEvents,this)),this._register(this.kernel.onRestarted(this.hookKernelEvents,this)),this._register(this.kernel.onDidKernelSocketChange(()=>this.hookKernelEvents(),this))}hookKernelEvents(){let t=this.kernel.session?.kernel;t&&(t.anyMessage.connect(this.onAnyMessage,this),this._register(new G4.Disposable(()=>t.anyMessage.disconnect(this.onAnyMessage,this))))}onAnyMessage(t,n){if(n.direction==="recv"&&n.msg.header.msg_type==="comm_open"){let o=n.msg.content.data;o.state?._model_module&&o.state._model_name&&this.sendTelemetryForWidgetModule(o.state?._model_module,o.state?._model_module_version||"",o.state?._model_name).catch(f)}}};v([Mr()],Gy.prototype,"sendTelemetryForWidgetModule",1),v([Mr()],Gy.prototype,"onAnyMessage",1);var gT=Gy;var vT=class{constructor(e,t){this.isWebExtension=e;this.converter=t}async asWebviewUri(e){return this.isWebExtension?e:this.converter(e)}};var yT=class{constructor(e,t,n,i,o,s){this.document=e;this.kernelProvider=t;this.configurationSettings=i;this.sourceProviderFactory=o;this.cdnScriptProvider=s;this.postEmitter=new z4.EventEmitter;this.disposables=[];this.isWebViewOnline=ue();this.widgetSources=new Map;this.pendingModuleRequests=new Map;this.uriTranslationRequests=new uo;this.uriConverter=new vT(Br(),a=>(this.uriTranslationRequests.has(a)||this.uriTranslationRequests.set(a,ue()),this.postEmitter.fire({message:"ConvertUriForUseInWebViewRequest",payload:a}),this.uriTranslationRequests.get(a).promise)),this.isWebViewOnline.promise.catch(f),n.push(this),this.kernelProvider.onDidStartKernel(a=>{a.notebook===this.document&&this.initialize()},this,this.disposables)}get postMessage(){return this.postEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}onMessage(e,t){if(e==="ConvertUriForUseInWebViewResponse"){let n=t;n&&this.uriTranslationRequests.has(n.request)&&this.uriTranslationRequests.get(n.request).resolve(n.response)}else if(e==="IPyWidgets_Ready")this.sendBaseUrl(),this.sendWidgetScriptSources().catch(f);else if(e==="IPyWidgets_IsOnline"){let n=t.isOnline;this.isWebViewOnline.resolve(n)}else e==="IPyWidgets_WidgetScriptSourceRequest"&&t&&this.onRequestWidgetScript(t).catch(f)}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services")),this.kernel||(this.kernel=this.kernelProvider.get(this.document)),this.kernel?.session&&(this.scriptProvider&&!this.scriptProvider.isDisposed||(this.scriptProvider=new gT(this.kernel,this.uriConverter,this.configurationSettings,this.sourceProviderFactory,this.isWebViewOnline.promise,this.cdnScriptProvider),this.kernel.onDisposed(()=>this.dispose()),this.handlePendingRequests(),this.sendBaseUrl(),E("IPyWidgetScriptSource.initialize")))}sendBaseUrl(){this.scriptProvider&&this.scriptProvider.getBaseUrl().then(e=>{e&&this.postEmitter.fire({message:"IPyWidgets_BaseUrl_Response",payload:e.toString()})}).catch(e=>x("Failed to get baseUrl",e))}async sendWidgetScriptSources(){if(this.scriptProvider&&!this.allWidgetScriptsSent)try{(await this.scriptProvider.getWidgetScriptSources()).forEach(t=>{this.widgetSources.get(t.moduleName)?.source!=="cdn"&&this.widgetSources.set(t.moduleName,t),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:t})})}catch(e){j("Failed to fetch script sources",e)}finally{this.allWidgetScriptsSent=!0}}async onRequestWidgetScript(e){let{moduleName:t,moduleVersion:n,requestId:i}=e;if(z(`\x1B[32mFetch Script for ${JSON.stringify(e)}`),await this.sendWidgetSource(t,n,i).catch(o=>x("Failed to send widget sources upon ready",o)),this.scriptProvider&&!this.allWidgetScriptsSent)try{await this.sendWidgetScriptSources()}finally{this.sendWidgetSource(t,n,i).catch(x.bind(void 0,"Failed to send widget sources upon ready"))}}async sendWidgetSource(e,t="*",n){if(!e||e.startsWith("@jupyter"))return;if(!this.kernel||!this.scriptProvider){this.pendingModuleRequests.set(e,{moduleVersion:t,requestId:n});return}let i={moduleName:e,requestId:n};try{z(`\x1B[32mFetch Script for ${e}`),i=await this.scriptProvider.getWidgetScriptSource(e,t),this.widgetSources.get(i.moduleName)?.source!=="cdn"&&this.widgetSources.set(i.moduleName,i)}catch(o){x("Failed to get widget source due to an error",o),A("DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED")}finally{z(`\x1B[32mScript for ${e}, is ${i.scriptUri} from ${i.source}`),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:i})}}handlePendingRequests(){let e=Array.from(this.pendingModuleRequests.keys());for(;e.length;){let t=e.shift();if(t){let{moduleVersion:n,requestId:i}=this.pendingModuleRequests.get(t);this.pendingModuleRequests.delete(t),this.sendWidgetSource(t,n,i).catch(x.bind(`Failed to send WidgetScript for ${t}`))}}}};var IT=Symbol("IWidgetScriptSourceProviderFactory"),ST=Symbol("INbExtensionsPathProvider"),xT=Symbol("IIPyWidgetScriptManagerFactory"),uat=Symbol("IIPyWidgetScriptManager");var ff=_(O()),ko=require("vscode");var X4="https://unpkg.com/",GF="https://cdn.jsdelivr.net/npm/",CT="IPYWidgetCDNConfigured",Q4="IPYWidgetNotFoundOnCDN",Y4="IPYWidgetNoNetWorkAccess";function oye(r,e,t){let n=e,i="index",o=e.indexOf("/");return o!==-1&&e[0]==="@"&&(o=e.indexOf("/",o+1)),o!==-1&&(i=e.substr(o+1),n=e.substr(0,o)),r===GF&&(t.startsWith("^")&&(t=t.slice(1)),i.endsWith(".js")||(i=i.concat(".js"))),`${r}${n}@${t}/dist/${i}`}function sye(r){switch(r){case"unpkg.com":return X4;case"jsdelivr.com":return GF;default:break}}var Aa=class{constructor(e,t){this.globalMemento=e;this.configurationSettings=t;this.id="cdn";this.cache=new Map;this.isOnCDNCache=new Map;this.notifiedUserAboutWidgetScriptNotFound=new Set}get cdnProviders(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}dispose(){this.cache.clear()}async isOnCDN(e){let t=`MODULE_VERSION_ON_CDN_${e}`;if(this.isOnCDNCache.has(t))return this.isOnCDNCache.get(t);if(this.globalMemento.get(t,!1))return!0;let n=(async()=>{let i=new Hc,o=ds(i.exists(`${X4}${e}`)),s=ds(i.exists(`${GF}${e}`));return await Promise.race([o.promise,s.promise]),o.value||s.value?!0:(await Promise.all([o.promise,s.promise]),!!(o.value||s.value))})();return n.then(i=>{if(i)return this.globalMemento.update(t,!0)}).then(f,f),this.isOnCDNCache.set(t,n),n}async getWidgetScriptSource(e,t,n){if(n===!1)return ne(`Webview is offline, cannot use CDN for ${e}`),this.warnIfNoAccessToInternetFromWebView(e).catch(f),{moduleName:e};if(this.cdnProviders.length===0&&this.globalMemento.get(CT,!1))return ne("No CDN providers and user configured CDN"),{moduleName:e};let i=this.getModuleKey(e,t);return this.cache.get(i)||this.cache.set(i,this.getWidgetScriptSourceImplementation(e,t)),this.cache.get(i)}async generateDownloadUri(e,t,n){let i=sye(n);if(i)return oye(i,e,t)}getModuleKey(e,t){return`${e}${t}`}async getWidgetScriptSourceImplementation(e,t){if(z(`\x1B[32mSearching for Widget Script ${e}#${t} using cdns ${this.cdnProviders.join(" ")}`),await this.configureWidgets(),this.cdnProviders.length===0)return{moduleName:e};let i=(await Promise.all(this.cdnProviders.map(o=>this.getValidUri(e,t,o)))).find(o=>o);return i?(z(`\x1B[32mWidget Script ${e}#${t} found at URI: ${i}`),{moduleName:e,scriptUri:i,source:"cdn"}):(x(`Widget Script ${e}#${t} was not found on on any cdn`),this.handleWidgetSourceNotFound(e,t).catch(f),{moduleName:e})}async getValidUri(e,t,n){try{let i=await this.generateDownloadUri(e,t,n),o=new Hc;if(i&&await o.exists(i))return i}catch{E(`Failed downloading ${e}:${t} from ${n}`);return}}async warnIfNoAccessToInternetFromWebView(e){if(this.globalMemento.get(Y4,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await ko.window.showWarningMessage(y.cdnWidgetScriptNotAccessibleWarningMessage(e,JSON.stringify(this.cdnProviders)),ye.ok,ye.doNotShowAgain,ye.moreInfo)){case ye.doNotShowAgain:return this.globalMemento.update(Y4,!0);case ye.moreInfo:return ko.env.openExternal(ko.Uri.parse("https://aka.ms/PVSCIPyWidgets"));default:}}async configureWidgets(){if(this.cdnProviders.length!==0||this.globalMemento.get(CT,!1))return;if(this.configurationPromise)return this.configurationPromise.promise;this.configurationPromise=ue(),A("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN");let e=await ko.window.showInformationMessage(y.useCDNForWidgetsNoInformation,{modal:!0},ye.ok,ye.doNotShowAgain,ye.moreInfo),t="dismissed";switch(e){case ye.ok:{t="ok",await Promise.all([this.updateScriptSources(["jsdelivr.com","unpkg.com"]),this.globalMemento.update(CT,!0)]);break}case ye.doNotShowAgain:{t="doNotShowAgain",await Promise.all([this.updateScriptSources([]),this.globalMemento.update(CT,!0)]);break}case ye.moreInfo:{ko.env.openExternal(ko.Uri.parse("https://aka.ms/PVSCIPyWidgets"));break}default:t=e===ye.cancel?"cancel":"dismissed";break}A("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",void 0,{selection:t}),this.configurationPromise.resolve()}async updateScriptSources(e){let t="widgetScriptSources";await this.configurationSettings.updateSetting(t,e,void 0,ko.ConfigurationTarget.Global)}async handleWidgetSourceNotFound(e,t){if(this.globalMemento.get(Q4,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await ko.window.showWarningMessage(y.widgetScriptNotFoundOnCDNWidgetMightNotWork(e,t,JSON.stringify(this.cdnProviders)),ye.ok,ye.doNotShowAgain,ye.reportThisIssue)){case ye.doNotShowAgain:return this.globalMemento.update(Q4,!0);case ye.reportThisIssue:return ko.env.openExternal(ko.Uri.parse("https://aka.ms/CreatePVSCDataScienceIssue"));default:}}};Aa=v([(0,ff.injectable)(),d(0,(0,ff.inject)($e)),d(0,(0,ff.named)(St)),d(1,(0,ff.inject)(le))],Aa);var _C=class{constructor(e,t){this.document=e;this.serviceContainer=t;this.cachedMessages=[];this.postEmitter=new _o.EventEmitter;this.attachedWebviews=new WeakSet;this.modulesForWhichWeHaveDisplayedWidgetErrorMessage=new Set;this.queuedMessages=[];this.disposables=this.serviceContainer.get(F),this.jupyterOutput=this.serviceContainer.get(No,Uu),this.configService=this.serviceContainer.get(le),this.initialize()}get postMessage(){return this.listeningToPostMessageEvent=!0,this.postEmitter.event}dispose(){this.cachedMessages=[],this.ipyWidgetMessageDispatcher?.dispose(),this.ipyWidgetScriptSource?.dispose()}attach(e){if(this.attachedWebviews.has(e))return;this.attachedWebviews.add(e),this.postMessage(i=>{if(ne(`\x1B[32mWidget Coordinator sent ${i.message}`),i.message==="ConvertUriForUseInWebViewRequest")this.onMessage(e,"ConvertUriForUseInWebViewResponse",{request:i.payload,response:e.asWebviewUri(i.payload)});else{if(!this.readyMessageReceived){this.queuedMessages.push({type:i.message,payload:i.payload});return}this.sendPendingWebViewMessages(e),e.postMessage({type:i.message,payload:i.payload}).then(f,f)}},this,this.disposables);let t=ue(),n=async()=>{let i=new qe;if(!t.completed){E("Attempting to determine version of IPyWidgets");let s=[],a=this.serviceContainer.get(Ke),c=ue();a.get(this.document)?c.resolve(a.get(this.document)):a.onDidCreateKernel(u=>{u.notebook===this.document&&c.resolve(u)},this,s);let l=await c.promise;l&&(_t(l.kernelConnectionMetadata)?l.ipywidgetsVersion?t.completed||t.resolve(l.ipywidgetsVersion):(E("Waiting for IPyWidgets version"),l.onIPyWidgetVersionResolved(()=>{l.ipywidgetsVersion&&(t.completed||t.resolve(l.ipywidgetsVersion),Q(s))},this,s)):t.completed||t.resolve(bS)),s.length&&this.disposables.push(...s),E("Waiting for IPyWidgets version promise")}let o=await t.promise;E(`Version of IPyWidgets ${o} determined after ${i.elapsedTime/1e3}s`),e.postMessage({type:"IPyWidgets_Reply_Widget_Version",payload:o}).then(f,f)};e.onDidReceiveMessage(async i=>{ne(`\x1B[32mWidget Coordinator received ${i.type}`),this.onMessage(e,i.type,i.payload),i.type==="IPyWidgets_Request_Widget_Version"&&await n(),i.type==="IPyWidgets_Window_Alert"&&_o.window.showInformationMessage(i.message),i.type==="IPyWidgets_Window_Open"&&_o.env.openExternal(_o.Uri.parse(i.url)),i.type==="IPyWidgets_Ready"&&(E("Web view is ready to receive widget messages"),this.readyMessageReceived=!0,this.sendPendingWebViewMessages(e))},this,this.disposables),e.postMessage({type:"IPyWidgets_IsReadyRequest",payload:void 0}).then(f,f),n().catch(f)}onMessage(e,t,n){t==="ipywidget_load_success"?this.sendLoadSucceededTelemetry(n).catch(f):t==="ipywidget_load_failure"?this.handleWidgetLoadFailure(e,n).catch(f):t==="ipywidget_widget_version_not_supported"?this.sendUnsupportedWidgetVersionFailureTelemetry(n).catch(f):t==="ipywidget_render_failure"?this.sendRenderFailureTelemetry(n):t==="ipywidget_unhandled_kernel_message"&&this.handleUnhandledMessage(n),this.getIPyWidgetMessageDispatcher().receiveMessage({message:t,payload:n}),this.getIPyWidgetScriptSource().onMessage(t,n)}sendPendingWebViewMessages(e){if(this.readyMessageReceived)for(;this.queuedMessages.length;)e.postMessage(this.queuedMessages.shift()).then(f,f)}initialize(){E("initialize CommonMessageCoordinator"),this.getIPyWidgetScriptSource().initialize(),this.getIPyWidgetMessageDispatcher().initialize()}async sendLoadSucceededTelemetry(e){try{A("DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",0,{moduleHash:await vt(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}async handleWidgetLoadFailure(e,t){try{let n=t.error.toString(),i=this.configService.getSettings(void 0).widgetScriptSources,o=i.length>0,s=`${t.moduleName}:${t.moduleVersion}`;if(!t.isOnline)n=y.loadClassFailedWithNoInternet(t.moduleName,t.moduleVersion),_o.window.showErrorMessage(n).then(f,f);else if(!o&&!this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.has(s)){this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.add(s);let a=ye.moreInfo,c=y.enableCDNForWidgetsButton;n=y.enableCDNForWidgetsSetting(t.moduleName,t.moduleVersion),_o.window.showErrorMessage(n,{modal:!0},c,a).then(l=>{switch(l){case a:_o.env.openExternal(_o.Uri.parse("https://aka.ms/PVSCIPyWidgets"));break;case c:this.enableCDNForWidgets(e).catch(f);break;default:break}},f)}x(`Widget load failure ${n}`,i,t),A("DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",0,{isOnline:t.isOnline,moduleHash:await vt(t.moduleName),moduleVersion:t.moduleVersion,timedout:t.timedout})}catch{}}async enableCDNForWidgets(e){await _o.commands.executeCommand($.EnableLoadingWidgetsFrom3rdPartySource),await e.postMessage({type:"IPyWidgets_AttemptToDownloadFailedWidgetsAgain"})}async sendUnsupportedWidgetVersionFailureTelemetry(e){try{A("DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",0,{moduleHash:await vt(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}sendRenderFailureTelemetry(e){try{x("Error rendering a widget: ",e),A("DS_INTERNAL.IPYWIDGET_RENDER_FAILURE")}catch{}}handleUnhandledMessage(e){if(e.header.msg_type!=="status")try{if(e.header.msg_type==="error"){let t=e;t.content.traceback=t.content.traceback.map(tl)}z(`Unhandled widget kernel message: ${e.header.msg_type} ${e.content}`),this.jupyterOutput.appendLine(y.unhandledMessage(e.header.msg_type,JSON.stringify(e.content))),A("DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",void 0,{msg_type:e.header.msg_type})}catch{}}getIPyWidgetMessageDispatcher(){return this.ipyWidgetMessageDispatcher||(this.ipyWidgetMessageDispatcher=this.serviceContainer.get(vu).create(this.document),this.disposables.push(this.ipyWidgetMessageDispatcher.postMessage(this.cacheOrSend,this))),this.ipyWidgetMessageDispatcher}getIPyWidgetScriptSource(){return this.ipyWidgetScriptSource||(this.ipyWidgetScriptSource=new yT(this.document,this.serviceContainer.get(Ke),this.serviceContainer.get(F),this.serviceContainer.get(le),this.serviceContainer.get(IT),this.serviceContainer.get(Aa)),this.disposables.push(this.ipyWidgetScriptSource.postMessage(this.cacheOrSend,this))),this.ipyWidgetScriptSource}cacheOrSend(e){if(!this.listeningToPostMessageEvent){ne("\x1B[32mQueuing messages (no listeners)"),this.cachedMessages.push(e);return}this.cachedMessages.forEach(t=>this.postEmitter.fire(t)),this.cachedMessages=[],this.postEmitter.fire(e)}};v([Mr()],_C.prototype,"enableCDNForWidgets",1);var zF=class{constructor(e,t){this.editor=e;this.pendingMessages=[];this.disposables=[];this._onDidReceiveMessage=new md.EventEmitter;this.changeController(t)}get controller(){if(!this._controller)throw new Error("No controller defined");return this._controller.controller}changeController(e){this._controller?.id!==e.id&&(this.controllerMessageHandler?.dispose(),this._controller=e,this.controllerMessageHandler=e.onDidReceiveMessage(t=>{t.editor===this.editor&&this.controller?.id===e.id&&(this.eventHandlerListening?(this.sendPendingMessages(),this._onDidReceiveMessage.fire(t.message)):this.pendingMessages.push(t.message))},this,this.disposables))}dispose(){Q(this.disposables)}get onDidReceiveMessage(){return this.eventHandlerListening=!0,setTimeout(()=>this.sendPendingMessages(),0),this._onDidReceiveMessage.event}postMessage(e){return this.controller.postMessage(e,this.editor)}asWebviewUri(e){return this.controller.asWebviewUri(e)}sendPendingMessages(){if(this.pendingMessages.length){let e=this.pendingMessages.shift();for(;e;)this._onDidReceiveMessage.fire(e),e=this.pendingMessages.shift()}}},dd=class{constructor(e,t,n){this.serviceContainer=e;this.disposableRegistry=t;this.controllerManager=n;this.messageCoordinators=new WeakMap;this.notebookDisposables=new WeakMap;this.notebookCommunications=new WeakMap;this.notebookEditors=new WeakMap}activate(){md.window.onDidChangeVisibleNotebookEditors(this.onDidChangeVisibleNotebookEditors,this,this.disposableRegistry),md.workspace.onDidCloseNotebookDocument(this.onDidCloseNotebookDocument,this,this.disposableRegistry),this.controllerManager.onControllerSelected(this.onDidSelectController,this,this.disposableRegistry)}onDidSelectController(e){let t=this.messageCoordinators.get(e.notebook);t&&(this.messageCoordinators.delete(e.notebook),md.window.visibleNotebookEditors.filter(n=>n.notebook===e.notebook).forEach(n=>{let i=this.notebookCommunications.get(n);this.notebookCommunications.delete(n),i&&i.controller!==e.controller.controller&&(this.notebookCommunications.delete(n),i&&i.dispose())}),t?.dispose()),md.window.visibleNotebookEditors.filter(n=>n.notebook===e.notebook).forEach(n=>this.initializeNotebookCommunication(n,e.controller))}initializeNotebookCommunication(e,t){if(e.notebook.isClosed||!Tt(e.notebook))return;let n=e.notebook;if(!t){E(`No controller, hence notebook communications cannot be initialized for editor ${W(e.notebook.uri)}`);return}if(this.notebookCommunications.has(e)){E(`notebook communications already initialized for editor ${W(e.notebook.uri)}`);return}E(`Initialize notebook communications for editor ${W(e.notebook.uri)}`);let i=new zF(e,t);this.addNotebookDisposables(n,[i]),this.notebookCommunications.set(e,i),E(`Resolving notebook UI Comms (resolve) for ${W(n.uri)}`);let o=this.messageCoordinators.get(n);o||(o=new _C(n,this.serviceContainer),this.messageCoordinators.set(n,o)),o.attach(i)}addNotebookDisposables(e,t){let n=this.notebookDisposables.get(e)||[];n.push(...t),this.notebookDisposables.set(e,n)}async onDidChangeVisibleNotebookEditors(e){e.forEach(t=>{let n=this.controllerManager.getSelected(t.notebook);this.initializeNotebookCommunication(t,n)})}onDidCloseNotebookDocument(e){let t=this.notebookEditors.get(e)||[];Q(this.notebookDisposables.get(e)||[]),t.forEach(n=>this.notebookCommunications.get(n)?.dispose()),this.messageCoordinators.get(e)?.dispose(),this.messageCoordinators.delete(e)}};dd=v([(0,zy.injectable)(),d(0,(0,zy.inject)(ut)),d(1,(0,zy.inject)(F)),d(2,(0,zy.inject)(Ct))],dd);var fd=_(O());var Qy=class{constructor(e,t,n,i,o){this.disposables=e;this.kernelProvider=t;this.controllers=n;this.liveKernelTracker=i;this.preferredRemoteKernelIdProvider=o}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables),this.controllers.onControllerSelectionChanged(this.onNotebookControllerSelectionChanged,this,this.disposables)}onNotebookControllerSelectionChanged({selected:e,notebook:t,controller:n}){t.isClosed||(n.connection.kind==="connectToLiveRemoteKernel"&&n.connection.kernelModel.id&&(e?this.liveKernelTracker.trackKernelIdAsUsed(t.uri,n.connection.serverProviderHandle,n.connection.kernelModel.id):this.liveKernelTracker.trackKernelIdAsNotUsed(t.uri,n.connection.serverProviderHandle,n.connection.kernelModel.id)),dt(n.connection)&&this.preferredRemoteKernelIdProvider.clearPreferredRemoteKernelId(t.uri).catch(f))}onDidStartKernel(e){if(!e.resourceUri)return;let t=e.resourceUri;if(e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")return;let n=e.kernelConnectionMetadata.serverProviderHandle,i=()=>{let o=e.session?.kernel?.id;!e.disposed&&!e.disposing&&o&&(E(`Updating preferred kernel for remote notebook ${o}`),this.preferredRemoteKernelIdProvider.storePreferredRemoteKernelId(t,o).catch(f),this.liveKernelTracker.trackKernelIdAsUsed(t,n,o))};i(),e.onDidKernelSocketChange(i,this,this.disposables)}};Qy=v([(0,fd.injectable)(),d(0,(0,fd.inject)(F)),d(1,(0,fd.inject)(Ke)),d(2,(0,fd.inject)(Ct)),d(3,(0,fd.inject)(gm)),d(4,(0,fd.inject)(Qo))],Qy);var gf=_(O());var Z4=require("vscode");var hf=class{constructor(e,t,n,i){this.disposables=e;this.uriStorage=t;this.controllers=n;this.serverProviderRegistry=i;this.handledServerProviderChanges=new WeakSet}activate(){this.serverProviderRegistry.jupyterCollections.forEach(e=>this.checkExpiredServersInJupyterCollection(e)),this.serverProviderRegistry.onDidChangeCollections(({added:e,removed:t})=>{e.forEach(n=>this.checkExpiredServersInJupyterCollection(n)),t.forEach(n=>this.removeControllersBelongingToDisposedProvider(n.extensionId,n.id))},this,this.disposables)}async checkExpiredServersInJupyterCollection(e){!this.handledServerProviderChanges.has(e.serverProvider)&&e.serverProvider.onDidChangeServers&&(this.handledServerProviderChanges.add(e.serverProvider),e.serverProvider.onDidChangeServers(()=>this.checkExpiredServersInJupyterCollection(e).catch(f),this,this.disposables));let t=new Z4.CancellationTokenSource;this.disposables.push(t);try{let n=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await this.removeControllersAndUriStorageBelongingToInvalidServers(e.extensionId,e.id,(n||[]).map(i=>i.id))}finally{t.dispose()}}async removeControllersAndUriStorageBelongingToInvalidServers(e,t,n){let i=this.uriStorage.all;await Promise.all(i.filter(o=>o.provider.extensionId===e&&o.provider.id===t).map(async o=>{n.includes(o.provider.handle)||await this.uriStorage.remove(o.provider)})),this.controllers.registered.forEach(o=>{let s=o.connection;dt(s)||s.serverProviderHandle.extensionId!==e||s.serverProviderHandle.id!==t||n.includes(s.serverProviderHandle.handle)||(j(`Deleting controller ${o.id} as it is associated with a server Id that has been removed`),o.dispose())})}removeControllersBelongingToDisposedProvider(e,t){this.controllers.registered.forEach(n=>{let i=n.connection;dt(i)||i.serverProviderHandle.extensionId!==e||i.serverProviderHandle.id!==t||(j(`Deleting controller ${n.id} as it is associated with a Provider Id that has been removed`),n.dispose())})}};v([Mr("Failed to check what servers were shutdown in Controller Watcher")],hf.prototype,"checkExpiredServersInJupyterCollection",1),hf=v([(0,gf.injectable)(),d(0,(0,gf.inject)(F)),d(1,(0,gf.inject)(er)),d(2,(0,gf.inject)(Ct)),d(3,(0,gf.inject)(Qt))],hf);var vf=_(O());var eG=require("vscode");var wT=class{constructor(e,t,n,i,o,s){this.label=e;this._description=t;this.detail=n;this.category=i;this.serverDisplayName=o;this.getDescription=s;this._onDidChange=new eG.EventEmitter;this.onDidChange=this._onDidChange.event}get description(){return this.getDescription?.()||this._description}set description(e){this._description=e}dispose(){this._onDidChange.dispose()}triggerChange(){this._onDidChange.fire(this)}};function tG(r){switch(r.kind){case"connectToLiveRemoteKernel":return y.kernelCategoryForJupyterSession;case"startUsingRemoteKernelSpec":return y.kernelCategoryForRemoteJupyterKernel;default:return ET(r)}}function ET(r){switch(r.kind){case"startUsingLocalKernelSpec":return y.kernelCategoryForJupyterKernel;case"startUsingPythonInterpreter":{if(Mn(r.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec")return y.kernelCategoryForJupyterKernel;switch(r.interpreter.envType){case"Conda":return r.interpreter.isCondaEnvWithoutPython?y.kernelCategoryForCondaWithoutPython:y.kernelCategoryForConda;case"PipEnv":return y.kernelCategoryForPipEnv;case"Poetry":return y.kernelCategoryForPoetry;case"Pyenv":return y.kernelCategoryForPyEnv;case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return y.kernelCategoryForVirtual;default:return y.kernelCategoryForGlobal}}default:return""}}var Yy=class{constructor(e,t,n,i){this.platform=e;this.jupyterUriProviderRegistration=t;this.disposables=n;this.interpreters=i;this.details=new Map}getDisplayData(e){if(!this.details.get(e.id)){let i=mt(e),o=xN(e,this.platform);e.kind==="connectToLiveRemoteKernel"&&(o=SN(e));let s=ET(e),a=e.kind==="connectToLiveRemoteKernel"?()=>SN(e):void 0,c=new wT(i,o,"",s,void 0,a);if(this.disposables.push(c),this.details.set(e.id,c),e.kind==="startUsingPythonInterpreter"&&e.interpreter.isCondaEnvWithoutPython){let l=u=>{let p=u.find(h=>h.id===e.interpreter?.id),m=this.interpreters.resolvedEnvironments.find(h=>h.id===p?.id);if(e.kind==="startUsingPythonInterpreter"&&m){e.updateInterpreter(m);let h=mt(e),g=xN(e,this.platform),b=ET(e),w=!1;h!==c.label&&(c.label=h,w=!0),g!==c.description&&(c.description=g,w=!0),b!==c.category&&(c.category=b,w=!0),w&&c.triggerChange()}};this.interpreters.onDidChangeInterpreter(u=>u?l([u]):void 0,this,this.disposables)}}let t=this.details.get(e.id);if(this.details.set(e.id,t),e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"){let i=qv(e.serverProviderHandle,this.jupyterUriProviderRegistration,y.kernelDefaultRemoteDisplayName);t.serverDisplayName!==i&&(t.serverDisplayName=i,t.triggerChange())}let n=tG(e);return t.category!==n&&(t.category=n,t.triggerChange()),t}};Yy=v([(0,vf.injectable)(),d(0,(0,vf.inject)(Er)),d(1,(0,vf.inject)(Qt)),d(2,(0,vf.inject)(F)),d(3,(0,vf.inject)(tt))],Yy);var yu=_(O()),bu=require("vscode");var hd=_(O()),iG=require("vscode");var rG=require("vscode");function PT(r){try{return dP(lo(r))||r.getCells().find(t=>t.kind===rG.NotebookCellKind.Code)?.document.languageId}catch(e){j("Failed to determine language of first cell",e)}}var nG="DATASCIENCE.LAST_SAVED_CELL_LANGUAGE",os=class{constructor(e,t,n){this.disposables=e;this.globalMemento=t;this.pythonExtensionChecker=n}getPreferredLanguage(e){let t=e?.language_info?.name||e?.kernelspec?.language||this.lastSavedNotebookCellLanguage,n=this.pythonExtensionChecker.isPythonExtensionInstalled?xe:"plaintext";return yc(t||n)}activate(){iG.workspace.onDidSaveNotebookDocument(this.onDidSaveNotebookDocument,this,this.disposables)}getSupportedLanguages(e){if(_t(e))return Cj;{let t=yc(Lo(e)||"");return t&&yS.includes(t.toLowerCase())?[t,"raw"]:[]}}get lastSavedNotebookCellLanguage(){return this.globalMemento.get(nG)}async onDidSaveNotebookDocument(e){if(!Tt(e))return;let t=PT(e);t&&t!==this.lastSavedNotebookCellLanguage&&await this.globalMemento.update(nG,t)}};v([Mr("Saving last saved cell language")],os.prototype,"onDidSaveNotebookDocument",1),os=v([(0,hd.injectable)(),d(0,(0,hd.inject)(F)),d(1,(0,hd.inject)($e)),d(1,(0,hd.named)(St)),d(2,(0,hd.inject)(ze))],os);function oG(r){let e={kernelSpecCount:0,localKernelSpecCount:0,remoteKernelSpecCount:0,kernelInterpreterCount:0,kernelLiveCount:0};r.forEach(t=>{switch(t.kind){case"connectToLiveRemoteKernel":e.kernelLiveCount+=1;break;case"startUsingRemoteKernelSpec":e.localKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingLocalKernelSpec":e.remoteKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingPythonInterpreter":{e.kernelInterpreterCount+=1;break}default:break}}),A("DS_INTERNAL.KERNEL_COUNT",{...e})}var Nt=require("vscode");var ol=require("vscode");var mi=Symbol("INotebookEditorProvider");var sG=require("vscode");async function aG(r,e){let t=e?.findNotebookEditor(r);return t?sG.commands.executeCommand("notebook.selectKernel",{notebookEditor:t}):(x("Unable to select kernel as the Notebook document could not be identified"),!1)}var cG=require("vscode");var kT=class extends Cc{constructor(e){super(y.failedToStartAnUntrustedKernelSpec(mt(e),e.kernelSpec.specFile?W(cG.Uri.file(e.kernelSpec.specFile)):""),void 0,e)}};var Vs=class r{static async switchController(e,t){let i=t.get(mi).findNotebookEditor(e),o=t.get(Ct),s,a=ue(),c=o.onControllerSelected(u=>a.resolve(u.controller));return await aG(e,t.get(mi))&&i&&(s=await a.promise),c.dispose(),s?{controller:s.controller,metadata:s.connection}:void 0}static async notifyAndRestartDeadKernel(e){let t=await ol.window.showErrorMessage(y.cannotRunCellKernelIsDead(mt(e.kernelConnectionMetadata)),{modal:!0},y.showJupyterLogs,y.restartKernel),n=!1;switch(t){case y.restartKernel:{await e.restart(),n=!0;break}case y.showJupyterLogs:ol.commands.executeCommand($.ViewJupyterOutput).then(f,f)}return n}static async handleKernelError(e,t,n,i,o,s,a,c){let l=e.get($e,St),u=e.get(Yr);a.interpreter&&n==="start"&&zJ(l,19,a.interpreter.uri).catch(f);let p=await u.handleKernelError(t,n,a,i,c),m=dt(a);switch(e.tryGet(li)?.isSupported&&m&&n==="start"&&Rt(i,"DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",{reason:p}),o.dispose().catch(f),p){case 1:case 2:throw t;case 3:{let b=await r.switchController(i,e);if(!b)throw t;s=b.controller,a=b.metadata;break}}return{controller:s,metadata:a}}static convertContextToFunction(e,t){switch(e){case"start":case"execution":return n=>n.start(t);case"interrupt":return n=>n.interrupt();case"restart":return n=>n.restart()}}static{this.connectionsByNotebook=new WeakMap}static{this.connectionsByUri=new Map}static async verifyKernelState(e,t,n,i,o,s,a){let{kernel:c,deadKernelAction:l}=await i;if(kD(c)){if(this.deleteKernelInfo(t,i),l==="deadKernelWasNoRestarted")throw new Qp(c.kernelConnectionMetadata);return l==="deadKernelWasRestarted"?c:r.wrapKernelMethod(c.kernelConnectionMetadata,"start",o,e,t,n,a,s)}return c}static async wrapKernelMethod(e,t,n,i,o,s,a,c=()=>void 0){let l=this.getKernelInfo(o);if(!s.disableUI&&l?.options.disableUI&&(l.options.disableUI=!1),!s.disableUI&&l?.kernel.resolved&&(l?.kernel.value?.kernel?.disposed||l?.kernel.value?.kernel?.disposing)&&(this.deleteKernelInfo(o),l=void 0),l&&t!=="restart"&&t!=="interrupt")return r.verifyKernelState(i,o,s,l.kernel.promise,n,c,a);E(`${t} the kernel, options.disableUI=${s.disableUI} for ${W("notebook"in o?o.notebook.uri:o.resource)}`);let u=r.wrapKernelMethodImpl(e,t,i,o,s,n,c),p=ds(u);return p.promise.catch(f),u.then(m=>{m.kernel.onDisposed(()=>{this.deleteKernelInfo(o,p.promise)},void 0,a)}).catch(()=>{this.deleteKernelInfo(o,p.promise)}),this.setKernelInfo(o,p,s),r.verifyKernelState(i,o,s,p.promise,n,c,a)}static getKernelInfo(e){return"notebook"in e?r.connectionsByNotebook.get(e.notebook):r.connectionsByUri.get(e.resource.toString())}static setKernelInfo(e,t,n){"notebook"in e?r.connectionsByNotebook.set(e.notebook,{kernel:t,options:n}):r.connectionsByUri.set(e.resource.toString(),{kernel:t,options:n})}static deleteKernelInfo(e,t){if(!t){"notebook"in e?r.connectionsByNotebook.delete(e.notebook):r.connectionsByUri.delete(e.resource.toString());return}"notebook"in e&&r.connectionsByNotebook.get(e.notebook)?.kernel.promise===t?r.connectionsByNotebook.delete(e.notebook):e.resource&&r.connectionsByUri.get(e.resource.toString())?.kernel.promise===t&&r.connectionsByUri.delete(e.resource.toString())}static verifyWeCanStartKernel(e,t){if(!dt(e)||!e.kernelSpec.specFile)return;if(!t.get(ad).isTrusted(ol.Uri.file(e.kernelSpec.specFile)))throw new kT(e)}static async wrapKernelMethodImpl(e,t,n,i,o,s,a){let c=n.get(Ke),l=n.get(dm),u,p=r.convertContextToFunction(t,o),m=t,h="controller"in i?i.controller:void 0;for(t==="start"&&r.verifyWeCanStartKernel(e,n);u===void 0;){if("notebook"in i&&i.notebook.isClosed)throw new ol.CancellationError;u="notebook"in i?c.getOrCreate(i.notebook,{metadata:e,controller:h||i.controller,resourceUri:i.resource}):l.getOrCreate(i.resource,{metadata:e,resourceUri:i.resource});try{if(t!=="restart"&&kD(u)&&!o.disableUI){let g=await r.notifyAndRestartDeadKernel(u);return{kernel:u,deadKernelAction:g?"deadKernelWasRestarted":"deadKernelWasNoRestarted"}}else{if(a(m,u),await p(u),"notebook"in i&&i.notebook.isClosed)throw new ol.CancellationError;kD(u)&&!o.disableUI&&m!=="interrupt"&&await r.notifyAndRestartDeadKernel(u)}}catch(g){if(mr(g)||j(`Error occurred while trying to ${m} the kernel, options.disableUI=${o.disableUI}`,g),o.disableUI)throw g;if("notebook"in i&&i.notebook.isClosed)throw new ol.CancellationError;let b=await r.handleKernelError(n,g,m,i.resource,u,h,e,s);if(h=b.controller,e=b.metadata,p=w=>w.start(o),m="start",s==="3rdPartyExtension")throw g;u=void 0}}return{kernel:u}}static async connectToNotebookKernel(e,t,n,i,o,s="jupyterExtension",a=()=>void 0){return r.wrapKernelMethod(e,"start",s,t,n,i,o,a)}static async connectToKernel(e,t,n,i,o,s="jupyterExtension",a=()=>void 0){return r.wrapKernelMethod(e,"start",s,t,n,i,o,a)}};var yf=class{constructor(e){this.controller=e}get id(){return this.controller.id}createNotebookCellExecution(e){return this.controller.createNotebookCellExecution(e)}};var DT=require("vscode");var _T=class extends Zt{constructor(t,n,i){super();this.kernel=t;this.controller=n;this.notebook=i}initialize(){let t=this.kernel,n=this.controller,i=this.notebook;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||t.status!=="busy"&&t.status!=="unknown"||!n.createNotebookExecution)return;this._register(DT.workspace.onDidCloseNotebookDocument(s=>{s===i&&this.dispose()},this)),this._register(n.onDidChangeSelectedNotebooks(s=>{s.notebook===i&&s.selected===!1&&this.dispose()},this)),this._register(t.onStatusChanged(s=>{s!=="busy"&&s!=="unknown"&&this.dispose()},this));let o=n.createNotebookExecution(i);o.start(),this._register(new DT.Disposable(()=>o.end()))}};var lG=require("vscode");var TT=class{constructor(){this.cache=new Map;this.executionCount=0}getCacheKey(e,t,n){let i="",o=t;return o&&(i=`${o.name}.${o.propertyChain.join(".")}[[${n}`),`${e}:${i}`}getResults(e,t){return this.executionCount!==e&&(this.cache.clear(),this.executionCount=e),this.cache.get(t)}setResults(e,t,n){if(this.executionCount<e)this.cache.clear(),this.executionCount=e;else if(this.executionCount>e)return;this.cache.set(t,n)}};var RT=class{constructor(e,t){this.variables=e;this.kernelProvider=t;this.variableResultCache=new TT;this._onDidChangeVariables=new lG.EventEmitter;this.onDidChangeVariables=this._onDidChangeVariables.event}async*provideVariables(e,t,n,i,o){if(o.isCancellationRequested)return;let s=this.kernelProvider.get(e);if(!s)return;let a=this.kernelProvider.getKernelExecution(s).executionCount,c=this.variableResultCache.getCacheKey(e.uri.toString(),t,i),l=this.variableResultCache.getResults(a,c);if(t){let u=t;if(!l&&u.getChildren)l=(await u.getChildren(i,o)).map(m=>this.createVariableResult(m,s)),this.variableResultCache.setResults(a,c,l);else if(!l)return;for(let p of l)yield p;if(n===2&&u.count&&l.length>0&&u.count>i+l.length)for await(let p of this.provideVariables(e,t,n,i+l.length,o))yield p}else{l||(l=(await this.variables.getAllVariableDiscriptions(s,void 0,i,o)).map(p=>this.createVariableResult(p,s)),this.variableResultCache.setResults(a,c,l));for(let u of l)yield u}}createVariableResult(e,t){let n=!!e.properties,i=e.count??0,o={getChildren:(s,a)=>this.getChildren(o,s,t,a),expression:aye(e.root,e.propertyChain),...e};return{variable:o,hasNamedChildren:n,indexedChildrenCount:i}}async getChildren(e,t,n,i){let o=e;return await this.variables.getAllVariableDiscriptions(n,o,t,i)}};function aye(r,e){let t=r;for(let n of e)typeof n=="string"?t+=`.${n}`:t+=`[${n}]`;return t}var AT=class r{constructor(e,t,n,i,o,s,a,c,l,u,p,m){this.kernelConnection=e;this._viewType=n;this.kernelProvider=i;this.context=o;this.languageService=a;this.configuration=c;this.extensionChecker=l;this.serviceContainer=u;this.displayDataProvider=p;this._onNotebookControllerSelectionChanged=new Nt.EventEmitter;this._onConnecting=new Nt.EventEmitter;this.pendingCellAdditions=new Map;this._onDidDispose=new Nt.EventEmitter;this.disposables=[];this.notebookKernels=new WeakMap;this.isDisposed=!1;this.runningCellExecutions=new Map;this.associatedDocuments=new WeakMap;this.restoredConnections=new WeakSet;s.push(this),this._onNotebookControllerSelected=new Nt.EventEmitter,this.displayData=this.displayDataProvider.getDisplayData(this.connection),this.controller=Nt.notebooks.createNotebookController(t,n,this.displayData.label,this.handleExecution.bind(this),this.getRendererScripts()),this.displayData.onDidChange(this.updateDisplayData,this,this.disposables),this.updateDisplayData(),this.controller.interruptHandler=this.handleInterrupt.bind(this),this.controller.supportsExecutionOrder=!0,this.controller.supportedLanguages=this.languageService.getSupportedLanguages(e),this.controller.supportedLanguages.includes("python")&&(this.controller.variableProvider=new RT(m,this.kernelProvider)),this.controller.onDidChangeSelectedNotebooks(this.onDidChangeSelectedNotebooks,this,this.disposables),Nt.workspace.onDidCloseNotebookDocument(h=>{this.associatedDocuments.delete(h)},this,this.disposables)}get id(){return this.controller.id}get label(){return this.controller.label}get connection(){return this.kernelConnection}get viewType(){return this._viewType}get onNotebookControllerSelected(){return this._onNotebookControllerSelected.event}get onNotebookControllerSelectionChanged(){return this._onNotebookControllerSelectionChanged.event}get onConnecting(){return this._onConnecting.event}get onDidReceiveMessage(){return this.controller.onDidReceiveMessage}get onDidDispose(){return this._onDidDispose.event}isAssociatedWithDocument(e){return this.associatedDocuments.has(e)}static create(e,t,n,i,o,s,a,c,l,u,p,m){return new r(e,t,n,i,o,s,a,c,l,u,p,m)}async restoreConnection(e){if(this.restoredConnections.has(e))return;this.restoredConnections.add(e);let t=await this.connectToKernel(e,new Yt(!0));if(this.kernelConnection.kind==="connectToLiveRemoteKernel"){let u=new _T(t,this.controller,e);this.disposables.push(u),u.initialize()}let n=this.kernelProvider.getKernelExecution(t),o=await this.serviceContainer.get(Ra).getLastTrackedCellExecution(e,t);if(!t.session?.kernel||n.pendingCells.length||!o||e.cellCount<o.cellIndex||e.cellAt(o.cellIndex).kind!==Nt.NotebookCellKind.Code)return;let s=!1,a=[],c,l=(u,p)=>{if(!(p.direction==="send"||s)&&lu(p.msg)===o.msg_id){if("msg_type"in p.msg&&p.msg.msg_type==="status"&&"execution_state"in p.msg.content&&p.msg.content.execution_state==="idle")return;s=!0,n.resumeCellExecution(e.cellAt(o.cellIndex),{msg_id:o.msg_id,startTime:o.startTime,executionCount:o.executionCount}).catch(f),Q(a)}};t.session.kernel.anyMessage.connect(l),c=new Nt.Disposable(()=>{An(()=>t.session?.kernel?.anyMessage.disconnect(l))}),a.push(c),this.disposables.push(c)}updateConnection(e){e.kind!=="connectToLiveRemoteKernel"&&(this.controller.label=mt(e))}asWebviewUri(e){return this.controller.asWebviewUri(e)}postMessage(e,t){let n=e&&"message"in e?e.message:"";return ne(`\x1B[32mPosting message to Notebook UI ${n}`),this.controller.postMessage(e,t)}setPendingCellAddition(e,t){if(this.viewType!==gt)throw new Error("setPendingCellAddition only applies to the Interactive Window");this.pendingCellAdditions.set(e,t)}dispose(){if(this.isDisposed)return;let e=Nt.workspace.notebookDocuments.filter(t=>this.associatedDocuments.has(t)).map(t=>t.uri.toString());E(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""}`),ne(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""} called from ${new Error("").stack}`),this.isDisposed=!0,this._onNotebookControllerSelected.dispose(),this._onNotebookControllerSelectionChanged.dispose(),this._onConnecting.dispose(),this.controller.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose(),Q(this.disposables)}updateDisplayData(){this.controller.label=this.displayData.label;let e=this.connection.kind==="connectToLiveRemoteKernel"?"":this.displayData.description;this.controller.description=e,this.displayData.serverDisplayName&&(this.controller.description=e?`${e} (${this.displayData.serverDisplayName})`:this.displayData.serverDisplayName)}async handleExecution(e,t){e.length<1||(this.pendingCellAdditions.has(t)&&await this.pendingCellAdditions.get(t),e=e.filter(n=>n.index<0?(j(`Attempting to run a cell with index ${n.index}, kind ${n.kind}, text = ${n.document.getText()}`),!1):!0),Nt.workspace.isTrusted&&(z(`Handle Execution of Cells ${e.map(n=>n.index)} for ${W(t.uri)}`),await Yo(t.uri,this.connection),await Promise.all(e.map(n=>this.executeCell(t,n)))))}async warnWhenUsingOutdatedPython(){}async onDidChangeSelectedNotebooks(e){if(ne(`NotebookController selection event called for notebook ${e.notebook.uri.toString()} & controller ${this.connection.kind}:${this.id}. Selected ${e.selected} `),this.associatedDocuments.has(e.notebook)&&e.selected)return;if(!e.selected){let n=this.kernelProvider.get(e.notebook);n?.kernelConnectionMetadata.id===this.kernelConnection.id&&(z(`Disposing kernel ${this.kernelConnection.id} for notebook ${W(e.notebook.uri)} due to selection of another kernel or closing of the notebook`),n.dispose().catch(f)),this.associatedDocuments.delete(e.notebook),this._onNotebookControllerSelectionChanged.fire(e);return}if(!Tt(e.notebook)&&e.notebook.notebookType!==gt||!Nt.workspace.isTrusted)return;await this.warnWhenUsingOutdatedPython();let t=ue();ne(`Controller ${this.connection.kind}:${this.id} associated with nb ${W(e.notebook.uri)}`),this.associatedDocuments.set(e.notebook,t.promise),await this.onDidSelectController(e.notebook),await this.updateCellLanguages(e.notebook),this._onNotebookControllerSelected.fire({notebook:e.notebook,controller:this}),this._onNotebookControllerSelectionChanged.fire(e),E("Controller selection change completed"),t.resolve()}async updateCellLanguages(e){let t=this.controller.supportedLanguages;if(!t||t?.length===0)return;let i=_t(this.kernelConnection)?xe:t[0];await Promise.all(e.getCells().filter(o=>o.kind===Nt.NotebookCellKind.Code).map(async o=>{t.includes(o.document.languageId)||await Nt.languages.setTextDocumentLanguage(o.document,i).then(f,f)}))}getRendererScripts(){return this.context.extensionMode===Nt.ExtensionMode.Development||this.context.extensionMode===Nt.ExtensionMode.Test?[new Nt.NotebookRendererScript(Nt.Uri.joinPath(this.context.extensionUri,"dist","webviews","webview-side","widgetTester","widgetTester.js"))]:[]}handleInterrupt(e){E(`VS Code interrupted kernel for ${W(e.uri)}`),e.getCells().forEach(t=>yt(t,"Cell cancellation requested")),Nt.commands.executeCommand($.InterruptKernel,{notebookEditor:{notebookUri:e.uri}}).then(f,t=>x("Failed to interrupt",t))}createCellExecutionIfNecessary(e,t){let n=this.runningCellExecutions.get(e.notebook);if(!n||n.cell===e){n?.end(void 0,void 0),n=Gi.getOrCreate(e,t,!0),this.runningCellExecutions.set(e.notebook,n);let i=n.end.bind(n);n.end=(o,s)=>{this.runningCellExecutions.delete(e.notebook),i(o,s)}}return n}async executeCell(e,t,n){let i=new ma,o=i.add(new Nt.CancellationTokenSource);i.add(Nt.workspace.onDidCloseNotebookDocument(m=>m===e?o.cancel():void 0));let s=this.createCellExecutionIfNecessary(t,new yf(this.controller)),a="start",c,l=new yf(this.controller),u=!1,p=this.serviceContainer.get(Ra);try{if(c=await this.connectToKernel(e,new Yt(!1)),c.disposing)throw new Nt.CancellationError;u=!0,c&&c.controller.id!==l.id&&(l=c.controller,s=this.createCellExecutionIfNecessary(t,c.controller)),a="execution",c.controller.id===this.id&&this.updateKernelInfoInNotebookWhenAvailable(c,e),p.trackCellExecution(t,c);let h=this.kernelProvider.getKernelExecution(c).executeCell(t,n);return h.then(()=>{if(c&&!fS.isExiting)return p.deleteTrackedCellExecution(t,c)}).catch(f),await h}catch(m){if(m instanceof sd)return;mr(m)||x("Error in execution",m),u||(s.start(),s.clearOutput(t).then(f,f));let h=this.serviceContainer.get(Yr);m=sn.unwrap(m);let g=mr(m)||m instanceof Qp;await ap(t,l,await h.getErrorMessageForDisplayInCell(m,a,e.uri),g)}finally{i.dispose()}}async connectToKernel(e,t){return this._onConnecting.fire(),Vs.connectToNotebookKernel(this.kernelConnection,this.serviceContainer,{resource:e.uri,notebook:e,controller:this.controller},t,this.disposables)}updateKernelInfoInNotebookWhenAvailable(e,t){if(this.notebookKernels.get(t)===e)return;this.notebookKernels.set(t,e);let n=[];Nt.workspace.onDidCloseNotebookDocument(s=>{s===t&&Q(n)},this,n);let i=e.onDisposed(()=>Q(n)),o=e.onStatusChanged(async()=>{e.disposed||!e.info||this.associatedDocuments.has(t)&&(await uG(t,e.kernelConnectionMetadata,e.info),e.info.status==="ok"&&Q(n))});n.push({dispose:()=>o.dispose()}),n.push({dispose:()=>i?.dispose()})}async onDidSelectController(e){let t=this.connection,n=this.kernelProvider.get(e);if(n&&QV(n.kernelConnectionMetadata,t)){z("Switch kernel did not change kernel.");return}if(Rt(e.uri,"DS_INTERNAL.SWITCH_KERNEL"),n&&Nt.window.visibleNotebookEditors.filter(s=>s.notebook===e).forEach(s=>this.postMessage({message:"IPyWidgets_onKernelChanged",payload:void 0},s)),await uG(e,t),e.notebookType===gt)return;let i=this.kernelProvider.getOrCreate(e,{metadata:t,controller:this.controller,resourceUri:e.uri});if(E(`KernelProvider switched kernel to id = ${i.kernelConnectionMetadata.id}`),_t(this.kernelConnection)&&!this.extensionChecker.isPythonExtensionInstalled)return;let o=this.serviceContainer.get(ad);!this.configuration.getSettings(void 0).disableJupyterAutoStart&&dt(this.kernelConnection)&&this.kernelConnection.kernelSpec.specFile&&o.isTrusted(Nt.Uri.file(this.kernelConnection.kernelSpec.specFile))&&this.connectToKernel(e,new Yt(!0)).catch(f)}};async function uG(r,e,t){let n=lo(r)||{},{changed:i}=await aP(n,e,t);if(i){let o=new Nt.WorkspaceEdit,s=JSON.parse(JSON.stringify(r.metadata||{custom:{}}));s.custom=s.custom||{},s.custom.metadata=n,o.set(r.uri,[Nt.NotebookEdit.updateNotebookMetadata({...r.metadata||{},custom:s.custom})]),await Nt.workspace.applyEdit(o)}}var Xy=class{constructor(e,t,n,i,o,s){this.disposables=e;this.pythonEnvFilter=t;this.extensionChecker=n;this.serviceContainer=i;this.serverUriStorage=o;this.kernelFinder=s;this.registeredControllers=new Map;this.changeEmitter=new bu.EventEmitter;this.registeredMetadatas=new Map;this.selectedEmitter=new bu.EventEmitter;this.selectionChangedEmitter=new bu.EventEmitter;this.selectedControllers=new Map;this._activeInterpreterControllerIds=new Set}get onDidChange(){return this.changeEmitter.event}get registered(){return[...this.registeredControllers.values()]}get all(){return this.metadatas}get metadatas(){return[...this.registeredMetadatas.values()]}get onControllerSelected(){return this.selectedEmitter.event}get onControllerSelectionChanged(){return this.selectionChangedEmitter.event}activate(){this.kernelFinder.onDidChangeKernels(()=>this.loadControllers(),this,this.disposables),this.kernelFinder.registered.forEach(e=>this.monitorDeletionOfConnections(e)),this.kernelFinder.onDidChangeRegistrations(e=>e.added.forEach(t=>this.monitorDeletionOfConnections(t)),this,this.disposables),this.pythonEnvFilter.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeUri,this,this.disposables),this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables),this.onDidChange(({added:e})=>{e.forEach(t=>{t.onNotebookControllerSelectionChanged(n=>{!n.selected&&this.isFiltered(t.connection)&&this.canControllerBeDisposed(t)&&(j(`Removing controller ${t.id} for ${t.connection.kind} from kernel list`),t.dispose())},this,this.disposables)})},this,this.disposables),bu.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookDocument,this,this.disposables),bu.workspace.notebookDocuments.forEach(e=>this.onDidOpenNotebookDocument(e).catch(f)),this.loadControllers()}loadControllers(){this.controllersPromise=this.loadControllersImpl(),oG(this.registered.map(e=>e.connection)),ne(`Providing notebook controllers with length ${this.registered.length}.`)}get loaded(){return this.controllersPromise}async onDidOpenNotebookDocument(e){e.notebookType!==bt&&e.notebookType!==gt||bu.workspace.isTrusted}async loadControllersImpl(){let e=this.kernelFinder.kernels;this.createNotebookControllers(e),Array.from(this.registered).filter(n=>{let i=e.some(o=>o.id===n.connection.id)||Zn&&this._activeInterpreterControllerIds.has(n.id);return!i&&n.connection.kind==="connectToLiveRemoteKernel"?!0:this.canControllerBeDisposed(n)?(i||E(`Controller ${n.connection.kind}:'${n.id}' for view = '${n.viewType}' is no longer a valid`),!i):!1}).forEach(n=>{j(`Disposing old controller ${n.connection.kind}:'${n.id}' for view = '${n.viewType}'`),n.dispose()})}createNotebookControllers(e){if(e.length!==0)try{this.batchAdd(e,[bt,gt])}catch(t){if(!mr(t,!0))throw t}}async monitorDeletionOfConnections(e){let t=e.onDidChangeKernels(({removed:n})=>{let i=new Set((n||[]).map(o=>o.id));this.registered.filter(o=>i.has(o.connection.id)).forEach(o=>{j(`Deleting controller ${o.id} as it is associated with a connection that has been deleted ${o.connection.kind}:${o.id}`),o.dispose()})},this,this.disposables);this.kernelFinder.onDidChangeRegistrations(n=>{n.removed.includes(e)&&t.dispose()})}onDidChangeUri(){this.onDidChangeFilter()}async onDidRemoveServers(e){e.forEach(t=>{this.registered.forEach(n=>{Ft(n.connection)&&n.connection.serverProviderHandle.id===t.id&&n.connection.serverProviderHandle.handle===t.handle&&(j(`Deleting controller ${n.id} as it is associated with a connection that has been removed`),n.dispose())})}),this.onDidChangeFilter()}onDidChangeFilter(){this.all.filter(t=>!this.isFiltered(t)).forEach(t=>this.addOrUpdate(t,[bt,gt])),this.registered.forEach(t=>{this.isFiltered(t.connection)&&this.canControllerBeDisposed(t)&&(j(`Deleting controller ${t.id} as it is associated with a connection that has been hidden`),t.dispose())})}batchAdd(e,t){let n=[];e.forEach(i=>{let{added:o}=this.addImpl(i,t,!1);n.push(...o)}),n.length&&this.changeEmitter.fire({added:n,removed:[]})}trackActiveInterpreterControllers(e){e.forEach(t=>this._activeInterpreterControllerIds.add(t.id))}canControllerBeDisposed(e){return!this._activeInterpreterControllerIds.has(e.id)&&!this.isControllerAttachedToADocument(e)}getSelected(e){return this.selectedControllers.get(e.uri.toString())}addOrUpdate(e,t){let{added:n,existing:i}=this.addImpl(e,t,!0);return n.concat(i)}addImpl(e,t,n){let i=[],o=[];ne(`Create Controller for ${e.kind} and id '${e.id}' for view ${t.join(", ")}`);try{t.map(s=>{let a=this.getControllerId(e,s);return this.registeredMetadatas.set(e.id,e),[a,s]}).filter(([s])=>{let a=this.registeredControllers.get(s);return a?(a.updateConnection(e),o.push(a),ne(`Found existing controller '${a.id}', not creating a new one just updating it`),!1):this.isFiltered(e)?(ne(`Existing controller '${s}' will be excluded as it is filtered`),!1):(ne(`Existing controller not found for '${s}', hence creating a new one`),!0)}).forEach(([s,a])=>{let c=AT.create(e,s,a,this.serviceContainer.get(Ke),this.serviceContainer.get(lt),this.disposables,this.serviceContainer.get(os),this.serviceContainer.get(le),this.extensionChecker,this.serviceContainer,this.serviceContainer.get(hp),this.serviceContainer.get(Rn,Ge.KERNEL_VARIABLES)),l=[];c.onDidDispose(()=>{ne(`Deleting controller '${c.id}' associated with view ${a} from registration as it was disposed`),this.registeredControllers.delete(c.id),l.forEach(u=>u.dispose())},this,this.disposables),this.disposables.push(c),this.registeredControllers.set(c.id,c),i.push(c),c.onNotebookControllerSelected(u=>{ne(`Controller ${u.controller?.id} selected for ${u.notebook.uri.toString()}`),this.selectedControllers.set(u.notebook.uri.toString(),u.controller),this.selectedEmitter.fire(u)},this,l),c.onNotebookControllerSelectionChanged(u=>this.selectionChangedEmitter.fire({...u,controller:c}),this,l)}),n&&i.length&&this.changeEmitter.fire({added:i,removed:[]})}catch(s){if(mr(s,!0))return{added:i,existing:o};x(`Failed to create notebook controller for ${e.id}`,s)}return{added:i,existing:o}}get(e,t){let n=this.getControllerId(e,t);return this.registeredControllers.get(n)}isFiltered(e){return!1}getControllerId(e,t){return t===bt?e.id:`${e.id}${y9}`}isControllerAttachedToADocument(e){return bu.workspace.notebookDocuments.some(t=>e.isAssociatedWithDocument(t))}};Xy=v([(0,yu.injectable)(),d(0,(0,yu.inject)(F)),d(1,(0,yu.inject)(si)),d(2,(0,yu.inject)(ze)),d(3,(0,yu.inject)(ut)),d(4,(0,yu.inject)(er)),d(5,(0,yu.inject)(Rr))],Xy);var gd=_(O());var NT=class{constructor(e,t,n){this.kernel=e;this.localResourceUriConverter=t;this.scriptManagerFactory=n;this.id="local"}async getWidgetScriptSource(e){return(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase())||{moduleName:e}}dispose(){}async getWidgetScriptSources(){let t=await this.scriptManagerFactory.getOrCreate(this.kernel).getWidgetModuleMappings();return t&&Object.keys(t).length?await Promise.all(Object.keys(t).map(async i=>{let o=(await this.localResourceUriConverter.asWebviewUri(t[i])).toString();return{moduleName:i,scriptUri:o,source:"local"}})):[]}async getBaseUrl(){let e=this.scriptManagerFactory.getOrCreate(this.kernel);if(!e.getBaseUrl)return;let t=await e.getBaseUrl();if(t)return this.localResourceUriConverter.asWebviewUri(t)}};var pG=require("vscode"),MT=class{constructor(e,t){this.id="remote";if(e.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage of this class, can only be used with remtoe kernels");this.kernelConnection=e.kernelConnectionMetadata,this.scriptManager=t.getOrCreate(e)}static{this.validUrls=new Map}dispose(){}async getBaseUrl(){return pG.Uri.parse(this.kernelConnection.baseUrl)}async getWidgetScriptSource(e){let n=(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase());if(!n&&e.includes("/")){let i=await this.getBaseUrl();return{moduleName:e,scriptUri:`${i.toString()}${e}`,source:"remote"}}return n||{moduleName:e}}async getWidgetScriptSources(){let e=await this.scriptManager.getWidgetModuleMappings();return e&&Object.keys(e).length?await Promise.all(Object.keys(e).map(async n=>({moduleName:n,scriptUri:e[n].toString(),source:"remote"}))):[]}};var Zy=class{constructor(e,t,n){this.configurationSettings=e;this.widgetScriptManagerFactory=t;this.globalMemento=n}getProviders(e,t){let n=[];switch(n.push(new Aa(this.globalMemento,this.configurationSettings)),e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":n.push(new MT(e,this.widgetScriptManagerFactory));break;default:n.push(new NT(e,t,this.widgetScriptManagerFactory))}return n}};Zy=v([(0,gd.injectable)(),d(0,(0,gd.inject)(le)),d(1,(0,gd.inject)(xT)),d(2,(0,gd.inject)($e)),d(2,(0,gd.named)(St))],Zy);var dG=_(O()),OT=require("vscode");var eb=class{async getNbExtensionsParentPath(e){switch(e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":return OT.Uri.parse(e.kernelConnectionMetadata.baseUrl);case"startUsingPythonInterpreter":{let t=await pa(e.kernelConnectionMetadata.interpreter);return t?OT.Uri.joinPath(OT.Uri.file(t),"share","jupyter"):void 0}default:return}}};eb=v([(0,dG.injectable)()],eb);var Iu=_(O());var bf=require("vscode");var XF=require("vscode");var EG=_(CG());var wG=["require.config({","requirejs?.config({","window.requirejs?.config({","requirejs.config({",'["require"].config({',"['require'].config({",'["requirejs"].config({',"['requirejs'].config({",'["require"]["config"]({',"['require']['config']({",'["requirejs"]["config"]({',"['requirejs']['config']({"];async function pye(r,e,t){let n=[...wG],i=await vt(e),o=0,s;for(;o<=0&&n.length&&(s=n.pop(),!!s);)o=t.indexOf(s);if(o<0){let m=[...wG].map(h=>h.substring(0,h.length-2));for(;o<=0&&m.length&&(s=m.pop(),!!s);)o=t.indexOf(s)}if(o<0){A("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigStart"});return}let a=t.indexOf(")",o);if(a<=0||!s){A("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigEnd"});return}let c=t.indexOf("{",o),l=t.substring(c,a);l=(0,EG.default)(l,{language:"javascript"}),l=Fe(l,{trim:!0,removeEmptyEntries:!0}).join("");let u=l.split("{")[l.split("{").length-1].split("}")[0].split(",").map(m=>m.trim()).filter(m=>m.length&&m.includes(":")),p={};if(u.forEach(m=>{let h=m.split(":"),g=em(h[0].replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim(),b=em(m.substring(m.indexOf(":")+1).replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim();p[g]=b.startsWith("http")?XF.Uri.parse(b):XF.Uri.joinPath(r,b)}),!p||!Object.keys(p).length){A("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"noRequireConfigEntries"});return}return A("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",{requireEntryPointCount:Object.keys(p).length},{widgetFolderNameHash:i,patternUsedToRegisterRequireConfig:s}),p}var tb=class{constructor(e){this.kernel=e;this.disposables=[];e.onRestarted(this.onKernelRestarted,this,this.disposables)}dispose(){Q(this.disposables)}async getWidgetModuleMappings(){return this.widgetModuleMappings||(this.widgetModuleMappings=this.getWidgetModuleMappingsImpl()),this.widgetModuleMappings}onKernelRestarted(){this.widgetModuleMappings=void 0}async getConfigFromWidget(e,t,n){let i=await this.getWidgetScriptSource(t);try{let o=await pye(e,n,i);if(!o){let s=`Failed to extract require.config from widget for ${n} from ${W(t)}`;Zn&&(s+=`with contents ${i}`),j(s)}return o}catch(o){x(`Failed to extract require.config entry for ${n} from ${W(t)}`,o)}}async getWidgetModuleMappingsImpl(){let e=new qe,[t,n]=await Promise.all([this.getWidgetEntryPoints(),this.getNbExtensionsParentPath()]);if(!n)return;let o=(await Promise.all(t.map(s=>this.getConfigFromWidget(n,s.uri,s.widgetFolderName)))).reduce((s,a)=>Object.assign(s||{},a),{});return o&&Object.keys(o).length&&(delete o["jupyter-js-widgets"],delete o["@jupyter-widgets/base"],delete o["@jupyter-widgets/controls"],delete o["@jupyter-widgets/output"]),A("DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",{duration:e.elapsedTime},{type:dt(this.kernel.kernelConnectionMetadata)?"local":"remote"}),o&&Object.keys(o).length?o:void 0}};var UT=class extends tb{constructor(t,n,i,o){super(t);this.context=n;this.fs=i;this.connection=o;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&t.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage, can only be used for remote kernels");this.kernelConnection=t.kernelConnectionMetadata,this.getWidgetEntryPoints().catch(f)}getBaseUrl(){return this.getNbExtensionsParentPath()}async getNbExtensionsParentPath(){return bf.Uri.parse(this.kernelConnection.baseUrl)}onKernelRestarted(){this.widgetEntryPointsPromise=void 0,super.onKernelRestarted()}async getWidgetEntryPoints(){return this.widgetEntryPointsPromise||(this.widgetEntryPointsPromise=this.getWidgetEntryPointsImpl()),this.widgetEntryPointsPromise}getCodeToExecute(){return this.code||(this.code=this.fs.readFile(bf.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyWidgetEntryPoints.py"))),this.code}async getWidgetEntryPointsImpl(){if(!_t(this.kernelConnection))return[];let t=await this.getCodeToExecute();if(!this.kernel.session?.kernel)return ne("No Kernel session to get list of widget entry points"),[];let n=[];n.push(vn(this.kernel.session.kernel,t,{traceErrors:!0,traceErrorsMessage:"Failed to get widget entry points from remote kernel"})),!Zn&&this.context.extensionMode===bf.ExtensionMode.Production&&n.push(ji(1e4).then(()=>[])),n.forEach(s=>s.catch(f));let i=await Promise.race(n);if(i.length===0)return ne("Unable to get widget entry points, no outputs after running the code"),[];let o=i[0];if(o.output_type!=="stream"||o.name!=="stdout")return ne("Unable to get widget entry points, no stream/stdout outputs after running the code"),[];try{return E(`Widget Outputs include, ${o.text}`),o.text.trim().substring(1).slice(0,-1).split(",").map(a=>em(a.trim()).replace(/\\\\/g,"/").replace(/\\/g,"/")).map(a=>({uri:bf.Uri.joinPath(bf.Uri.parse(this.kernelConnection.baseUrl),"nbextensions",a),widgetFolderName:pt(a)}))}catch(s){return x(`Failed to parse output to get list of IPyWidgets, output is ${o.text}`,s),[]}}async getWidgetScriptSource(t){let n=this.getWidgetScriptSourceUsingHttpClient(t),i=this.getWidgetScriptSourceUsingFetch(t);return n.catch(()=>i)}async getWidgetScriptSourceUsingHttpClient(t){let n=t.toString(!0),o=await new Hc().downloadFile(n);if(o.status===200)return o.text();throw x(`Error downloading from ${n}: ${o.statusText}`),new Error(`Error downloading from ${n}: ${o.statusText}`)}async getWidgetScriptSourceUsingFetch(t){let n=await this.connection.createConnectionInfo(this.kernelConnection.serverProviderHandle),i=t.toString(!0),s=await new Hc(n.settings.fetch).downloadFile(i);if(s.status===200)return s.text();throw x(`Error downloading from ${i} using custom fetch: ${s.statusText}`),new Error(`Error downloading from ${i} using custom fetch: ${s.statusText}`)}};var rb=require("vscode");var jT=class r extends tb{constructor(t,n,i,o,s){super(t);this.fs=n;this.nbExtensionsPathProvider=i;this.context=o;this.jupyterPaths=s;this.overwriteExistingFiles=!0;this.overwriteExistingFiles=!r.nbExtensionsCopiedKernelConnectionList.has(t.kernelConnectionMetadata.id)}static{this.nbExtensionsCopiedKernelConnectionList=new Set}getBaseUrl(){return this.getNbExtensionsParentPath()}onKernelRestarted(){this.nbExtensionsParentPath=void 0,this.overwriteExistingFiles=!0,super.onKernelRestarted()}async getNbExtensionsParentPath(){return this.nbExtensionsParentPath||(this.nbExtensionsParentPath=this.getNbExtensionsParentPathImpl()),this.nbExtensionsParentPath}async getNbExtensionsParentPathImpl(){let t=this.overwriteExistingFiles;try{let n=new qe;if(this.sourceNbExtensionsPath=await this.nbExtensionsPathProvider.getNbExtensionsParentPath(this.kernel),!this.sourceNbExtensionsPath){j(`No nbextensions folder found for kernel ${this.kernel.kernelConnectionMetadata.id}`);return}let i=await vt(this.kernel.kernelConnectionMetadata.id),o=rb.Uri.joinPath(this.context.extensionUri,"temp","scripts",i,"jupyter"),s=rb.Uri.joinPath(o,"nbextensions"),[a]=await Promise.all([this.jupyterPaths.getDataDirs({resource:this.kernel.resourceUri,interpreter:this.kernel.kernelConnectionMetadata.interpreter}),this.fs.createDirectory(s)]),c=a.map(l=>rb.Uri.joinPath(l,"nbextensions"));c.reverse();for(let l of c)await this.fs.exists(l)&&await this.fs.copy(l,s,{overwrite:t});return this.overwriteExistingFiles=!1,r.nbExtensionsCopiedKernelConnectionList.add(this.kernel.kernelConnectionMetadata.id),A("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",{duration:n.elapsedTime}),o}catch(n){throw A("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",void 0,void 0,n),n}}async getWidgetEntryPoints(){let t=await this.getNbExtensionsParentPath();if(!t)return[];let n=rb.Uri.joinPath(t,"nbextensions");return(await this.fs.searchLocal("*/extension.js",n.fsPath,!0)).map(o=>({uri:rb.Uri.joinPath(n,o),widgetFolderName:pt(o)}))}getWidgetScriptSource(t){return this.fs.readFile(t)}};var nb=class{constructor(e,t,n,i,o,s){this.nbExtensionsPathProvider=e;this.fs=t;this.context=n;this.jupyterPaths=i;this.disposables=o;this.connection=s;this.managers=new WeakMap}getOrCreate(e){if(!this.managers.has(e))if(e.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"||e.kernelConnectionMetadata.kind==="startUsingRemoteKernelSpec"){let t=new UT(e,this.context,this.fs,this.connection);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}else{let t=new jT(e,this.fs,this.nbExtensionsPathProvider,this.context,this.jupyterPaths);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}return this.managers.get(e)}};nb=v([(0,Iu.injectable)(),d(0,(0,Iu.inject)(ST)),d(1,(0,Iu.inject)(gr)),d(2,(0,Iu.inject)(lt)),d(3,(0,Iu.inject)(Fr)),d(4,(0,Iu.inject)(F)),d(5,(0,Iu.inject)(cn))],nb);var WT=_(O()),Na=require("vscode");var Bs=class{constructor(e){this.disposables=[];e.push(this)}dispose(){Q(this.disposables)}activate(){Na.workspace.onDidChangeNotebookDocument(this.onDidChangeNotebookDocument,this,this.disposables)}onDidChangeNotebookDocument(e){Tt(e.notebook)&&e.cellChanges.some(t=>t.outputs&&t.outputs.some(n=>n.items&&n.items.some(i=>i.mime===Ui)))&&this.checkRendererExtensionVersion()}checkRendererExtensionVersion(){if(!Na.workspace.isTrusted)return;let e=Na.extensions.getExtension(lh);if(!e){this.displayNotInstalledMessage();return}let t=e.packageJSON.version;if(!t){this.displayUpdateMessage();return}let n=t.split("."),i=parseInt(n[0],10),o=parseInt(n[1],10),s=parseInt(n[2],10);(i<1||i===1&&o===0&&s<15)&&this.displayUpdateMessage()}displayNotInstalledMessage(){Bs.messageDisplayed||(Bs.messageDisplayed=!0,Na.window.showInformationMessage(y.rendererExtensionRequired,{modal:!0},ye.bannerLabelYes).then(e=>{e===ye.bannerLabelYes&&Na.commands.executeCommand("extension.open",lh).then(f,f)}).then(f,f))}displayUpdateMessage(){Bs.messageDisplayed||(Bs.messageDisplayed=!0,Na.window.showInformationMessage(y.rendererExtension1015Required,{modal:!0},ye.bannerLabelYes).then(e=>{e===ye.bannerLabelYes&&Na.commands.executeCommand("extension.open",lh).then(f,f)}).then(f,f))}};Bs.messageDisplayed=!1,Bs=v([(0,WT.injectable)(),d(0,(0,WT.inject)(F))],Bs);function PG(r,e){r.addSingleton(vu,vu),r.addSingleton(IT,Zy),r.addSingleton(xT,nb),r.addSingleton(ST,eb),r.addSingleton(Aa,Aa),r.addSingleton(be,Bs)}var yd=_(O()),Lr=require("vscode");var ib=class{constructor(e,t,n,i,o){this.controllerRegistration=e;this.kernelFinder=t;this.notebookEditorProvider=n;this.kernelDependency=i;this.localDisposables=[];this.providerMappings=new Map;this.kernelSpecsSourceRegistered=!1;o.push(this)}dispose(){Q(this.localDisposables)}activate(){if(!Br()){this.localDisposables.push(Lr.notebooks.registerKernelSourceActionProvider(bt,{provideNotebookKernelSourceActions:()=>[{label:y.localPythonEnvironments,documentation:Lr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]})),this.localDisposables.push(Lr.notebooks.registerKernelSourceActionProvider(gt,{provideNotebookKernelSourceActions:()=>[{label:y.localPythonEnvironments,documentation:Lr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]}));let t=[],n=new Lr.EventEmitter;this.localDisposables.push(Lr.notebooks.registerKernelSourceActionProvider(bt,{onDidChangeNotebookKernelSourceActions:n.event,provideNotebookKernelSourceActions:()=>t})),this.localDisposables.push(Lr.notebooks.registerKernelSourceActionProvider(gt,{onDidChangeNotebookKernelSourceActions:n.event,provideNotebookKernelSourceActions:()=>t}));let i=()=>{this.kernelSpecsSourceRegistered||this.kernelFinder.kernels.some(o=>ig(o))&&(this.kernelSpecsSourceRegistered=!0,t=[{label:y.localKernelSpecs,documentation:Lr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerJupyterKernels"),command:"jupyter.kernel.selectLocalKernelSpec"}],n.fire())};i(),this.kernelFinder.onDidChangeKernels(()=>i(),this,this.localDisposables),this.localDisposables.push(Lr.commands.registerCommand("jupyter.kernel.selectLocalKernelSpec",this.onSelectLocalKernel.bind(this,"localKernelSpec"),this)),this.localDisposables.push(Lr.commands.registerCommand("jupyter.kernel.selectLocalPythonEnvironment",this.onSelectLocalKernel.bind(this,"localPythonEnvironment"),this))}this.localDisposables.push(Lr.commands.registerCommand("jupyter.kernel.selectJupyterServerKernel",this.onSelectRemoteKernel,this)),Te.instance.get(Qt).onDidChangeCollections(this.registerUriCommands,this,this.localDisposables),this.registerUriCommands()}registerUriCommands(){let e=Te.instance.get(Qt),t=new Set;e.jupyterCollections.map(n=>{let i=`${n.extensionId}:${n.id}`;if(n.id===Ew||(t.add(i),this.providerMappings.has(i)))return;let o=Lr.notebooks.registerKernelSourceActionProvider(bt,{provideNotebookKernelSourceActions:()=>[{get label(){return n.label},get documentation(){return n.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[n.extensionId,n.id],title:n.label}}]}),s=Lr.notebooks.registerKernelSourceActionProvider(gt,{provideNotebookKernelSourceActions:()=>[{get label(){return n.label},get documentation(){return n.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[n.extensionId,n.id],title:n.label}}]});this.localDisposables.push(o),this.localDisposables.push(s),this.providerMappings.set(i,{disposables:[o,s],provider:n})}),this.providerMappings.forEach(({disposables:n},i)=>{t.has(i)||(Q(n),this.providerMappings.delete(i))})}async onSelectLocalKernel(e,t){if(t=t||Lr.window.activeNotebookEditor?.notebook,!!t)if(e==="localPythonEnvironment"){let i=await Te.instance.get(vm).selectLocalKernel(t);return this.getSelectedController(t,i)}else{let i=await Te.instance.get(PP).selectLocalKernel(t);return this.getSelectedController(t,i)}}async onSelectRemoteKernel(e,t,n){if(n=n||Lr.window.activeNotebookEditor?.notebook,!n&&Lr.window.activeTextEditor&&(n=this.notebookEditorProvider.findNotebookEditor(Lr.window.activeTextEditor.document.uri)?.notebook),!n)return;let i=`${e}:${t}`,o=this.providerMappings.get(i)?.provider;if(!o)return;let a=await Te.instance.get(EP).selectRemoteKernel(n,o);return this.getSelectedController(n,a)}async getSelectedController(e,t){if(!t)return;let n=this.controllerRegistration.addOrUpdate(t,[e.notebookType]);if(!Array.isArray(n)||n.length===0){j(`No controller created for selected kernel connection ${t.kind}:${t.id}`);return}Yo(e.uri,t).finally(()=>Rt(e.uri,"DS_INTERNAL.SWITCH_KERNEL",void 0,{newKernelPicker:!0})).catch(f),n.find(o=>o.viewType===e.notebookType)?.controller.updateNotebookAffinity(e,Lr.NotebookControllerAffinity.Preferred);let i=n[0];return await this.onControllerSelected(e,i),i.controller.id}async onControllerSelected(e,t){if(dt(t.connection)&&_t(t.connection)&&t.connection.interpreter?.isCondaEnvWithoutPython&&!Br()){let n=[];try{let i=new Lr.CancellationTokenSource;n.push(i);let o=new Yt(!1);n.push(o),await this.kernelDependency.installMissingDependencies({resource:e.uri,kernelConnection:t.connection,token:i.token,ui:o,cannotChangeKernels:!0,ignoreCache:!0,installWithoutPrompting:!0})}catch(i){x(`Failed to install missing dependencies for Conda kernel ${t.connection.id}`,i)}finally{Q(n)}}}};ib=v([(0,yd.injectable)(),d(0,(0,yd.inject)(Ct)),d(1,(0,yd.inject)(Rr)),d(2,(0,yd.inject)(mi)),d(3,(0,yd.inject)(Cs)),d(4,(0,yd.inject)(F))],ib);var If=_(O()),JT=require("vscode");var sl=require("vscode");var VT=require("vscode");var bd=class{constructor(e){this.jupyterConnection=e;this.disposables=[]}dispose(){Q(this.disposables)}async findPreferredRemoteKernelConnection(e,t,n){return this.findPreferredRemoteKernelConnectionImpl(e,t,n,!1)}async findPreferredRemoteKernelConnectionImpl(e,t,n,i){let o=await Te.instance.get(Qo).getPreferredRemoteKernelId(e.uri),s=async()=>{let c=t.kernels.find(u=>u.kind==="connectToLiveRemoteKernel"&&u.id===o);if(c)return c;if(t.status==="idle")return;let l=await new Promise(u=>t.onDidChangeKernels(()=>{let p=t.kernels.find(m=>m.kind==="connectToLiveRemoteKernel"&&m.id===o);p&&u(p),(t.status==="idle"||n.isCancellationRequested)&&u(void 0)},this,this.disposables));if(l)return l};if(o){let c=await s();if(c||i)return c}let a=t.kernels.find(c=>Ft(c))?.serverProviderHandle;if(a){let c=await this.jupyterConnection.createConnectionInfo(a),l=(e.uri,void 0),u=l&&t.kernels.find(p=>Ft(p)&&p.kind==="connectToLiveRemoteKernel"&&p.kernelModel.model&&p.kernelModel.model.path===l.path&&p.kernelModel.model.name===l.name);if(u)return u}return this.findPreferredKernelSpecConnection(e,t,n,i)}async findPreferredLocalKernelSpecConnection(e,t,n){return this.findPreferredKernelSpecConnection(e,t,n,!1)}async findPreferredKernelSpecConnection(e,t,n,i){let s=lo(e)?.kernelspec?.name,a=()=>{let u=s?t.kernels.filter(m=>(m.kind==="startUsingLocalKernelSpec"||m.kind==="startUsingRemoteKernelSpec")&&m.kernelSpec.name===s):[];if(u.length||i)return u;let p=PT(e);if(p)return t.kernels.filter(m=>(m.kind==="startUsingLocalKernelSpec"||m.kind==="startUsingRemoteKernelSpec")&&m.kernelSpec.language&&(m.kernelSpec.language===p||yc(m.kernelSpec.language)===yc(p)))},c=a();if(Array.isArray(c)&&c.length)return i&&c.length>1?void 0:c[0];if(t.status==="idle")return;let l=[];return new Promise(u=>t.onDidChangeKernels(()=>{if(n.isCancellationRequested)return u(void 0);let p=a();if(Array.isArray(p)&&p.length)return i&&p.length>1?u(void 0):u(p[0]);t.status==="idle"&&u(void 0)},this,this.disposables)).finally(()=>Q(l))}async findPreferredPythonKernelConnection(e,t,n){return this.findPreferredPythonKernelConnectionImpl(e,t,n)}async findPreferredPythonKernelConnectionImpl(e,t,n){t=t||Te.instance.get(Rr).registered.find(l=>l.kind==="localPythonEnvironment");let i=Te.instance.get(tt),o=ZF(e,t);if(o)return o;let s=await i.getActiveInterpreter(e.uri);if(!s)return;let a=()=>{if(!n.isCancellationRequested)return t.kernels.filter(l=>l.kind==="startUsingPythonInterpreter").map(l=>l).find(l=>l.interpreter.id===s.id)},c=a();if(c)return c;if(t.status==="discovering")return await new Promise(l=>{t.onDidChangeStatus(()=>t.status==="idle"&&l(),this,this.disposables),t.onDidChangeKernels(()=>(ZF(e,t)||a())&&l(),this,this.disposables)}),ZF(e,t)||a()}};function ZF(r,e){let t=VT.workspace.getWorkspaceFolder(r.uri)?.uri||(VT.workspace.workspaceFolders?.length===1?VT.workspace.workspaceFolders[0].uri:void 0),n=kG(Ii(r.uri),e);if(n)return n;if(t)return kG(t,e)}function kG(r,e){let n=e.kernels.filter(a=>a.kind==="startUsingPythonInterpreter").map(a=>a).filter(a=>Wg(a.interpreter.envPath?.fsPath||a.interpreter.uri.fsPath,r.fsPath)),i=n.find(a=>a.interpreter.envType==="Venv"&&a.interpreter.envName?.toLowerCase()===".venv");if(i)return i;let o=n.find(a=>a.interpreter.envType==="Venv"&&a.interpreter.envName?.toLowerCase()===".venv");if(o)return o;let s=n.find(a=>a.interpreter.envType==="Venv"&&a.interpreter.envName?.toLowerCase()===".venv");return s||(n.length?n[0]:void 0)}var BT=class{constructor(e,t,n,i,o){this.notebook=e;this.pythonEnvFilter=i;this.connection=o;this._onDidRefresh=new sl.EventEmitter;this.onDidRefresh=this._onDidRefresh.event;this._onDidChange=new sl.EventEmitter;this.onDidChange=this._onDidChange.event;this.kernels=[];this._onDidChangeStatus=new sl.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeRecommended=new sl.EventEmitter;this.onDidChangeRecommended=this._onDidChangeRecommended.event;this._onDidFailToListKernels=new sl.EventEmitter;this.onDidFailToListKernels=this._onDidFailToListKernels.event;this.status="idle";this.disposables=[];this.refresh=async()=>{this.refreshInvoked=!0},this.title=y.kernelPickerSelectKernelTitle,this.kind=t,this.disposables.push(this._onDidRefresh),Zd(n)?n.then(s=>this.setupFinder(s)).catch(s=>x(`Failed to setup finder for ${this.title}`,s)):this.setupFinder(n)}dispose(){Q(this.disposables)}setupFinder(e){switch(this.refresh=async()=>e.refresh(),this.status!==e.status&&!this.refreshInvoked&&(this.status=e.status,this._onDidChangeStatus.fire()),this.refreshInvoked?e.refresh().catch(i=>x(`Failed to refresh finder for ${this.title}`,i)):e.kind==="remote"&&e.status==="idle"&&this.filteredKernels(e.kernels).length===0&&e.refresh().catch(i=>x(`Failed to refresh finder for ${this.title}`,i)),e.kind){case"localKernelSpec":this.title=y.kernelPickerSelectLocalKernelSpecTitle;break;case"localPythonEnvironment":this.title=y.quickPickSelectPythonEnvironmentTitle;break;default:this.title=y.kernelPickerSelectKernelFromRemoteTitle(e.displayName);break}e.onDidChangeKernels(()=>{this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire()},this,this.disposables),e.onDidChangeStatus(()=>{this.status=e.status,this._onDidChangeStatus.fire(),this.status==="idle"&&e.lastError&&this.filteredKernels(e.kernels).length===0&&(this.kernels.length=0,this._onDidFailToListKernels.fire(e.lastError))}),this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire(),this._onDidChangeStatus.fire();let t=new sl.CancellationTokenSource;this.disposables.push(new sl.Disposable(()=>t.cancel())),this.disposables.push(t);let n=new bd(this.connection);this.disposables.push(n),e.kind==="remote"?this.computePreferredRemoteKernel(e,n,t.token):this.computePreferredLocalKernel(e,n,t.token)}filteredKernels(e){let t=this.pythonEnvFilter;return t?e.filter(n=>n.kind!=="startUsingPythonInterpreter"||!t.isPythonEnvironmentExcluded(n.interpreter)):e}computePreferredRemoteKernel(e,t,n){t.findPreferredRemoteKernelConnection(this.notebook,e,n).then(i=>{this.recommended=i,this._onDidChangeRecommended.fire()}).catch(i=>x(`Preferred connection failure ${W(this.notebook.uri)}`,i))}computePreferredLocalKernel(e,t,n){let i=()=>{this.recommended&&!this.kernels.find(s=>s.id===this.recommended?.id)&&(this.recommended=void 0),(e.kind==="localKernelSpec"?t.findPreferredLocalKernelSpecConnection.bind(t):t.findPreferredPythonKernelConnection.bind(t))(this.notebook,e,n).then(s=>{this.recommended?.id!==s?.id&&(this.recommended=s,this._onDidChangeRecommended.fire())}).catch(s=>x(`Preferred connection failure ${W(this.notebook?.uri)}`,s))};i(),e.onDidChangeKernels(i,this,this.disposables)}};var Id=require("vscode");function al(r){return"connection"in r}function dye(r){return"command"in r}function mye(r,e,t){let n=t?[t]:r.activeItems.length?[r.activeItems[0]]:[];if(n.length&&!e.includes(n[0])){let i=n[0],o=al(i)&&e.find(s=>al(s)&&s.connection.id===i.connection.id);o?n[0]=o:n.length=0}r.items=e,r.activeItems=n}var eL=class extends Error{},qT=class extends Zt{constructor(t,n){super();this.provider=t;this.token=n;this.recommendedItems=[];this.existingItems=new Set;this.quickPickItems=[];this.displayDataProvider=Te.instance.get(hp)}async selectKernel(t){return this.selectKernelImpl(t,{quickPick:void 0})}async selectKernelImpl(t,n){if(this.token.isCancellationRequested)return;let i=this.provider.kernels.map(o=>this.connectionToQuickPick(o));return this.quickPickItems.push({kind:Id.QuickPickItemKind.Separator,label:y.kernelCategoryForJupyterKernel}),i.sort((o,s)=>o.label.localeCompare(s.label)),this.quickPickItems.push(...i),this.existingItems=new Set(i),this.selectKernelImplInternal(t,n)}async selectKernelImplInternal(t,n){let i={iconPath:new Id.ThemeIcon("refresh"),tooltip:ye.refresh},o={iconPath:new Id.ThemeIcon("loading~spin"),tooltip:ye.refreshing},{quickPick:s,selection:a}=t({title:this.provider.title,items:this.quickPickItems,buttons:[i],onDidTriggerButton:async u=>{if(u===i){let p=s.buttons;s.buttons=p.filter(m=>m!==i).concat(o),await this.provider.refresh().catch(f),s.buttons=p}}});n.quickPick=s,this.provider.status==="discovering"&&(s.busy=!0);let c;this._register(this.provider.onDidChangeStatus(()=>{switch(c&&clearTimeout(c),this.provider.status){case"discovering":s.busy=!0;break;case"idle":c=setTimeout(()=>s.busy=!1,500),this._register(new Id.Disposable(()=>c&&clearTimeout(c)));break}},this)),this.updateRecommended(s),this.updateQuickPickItems(s),this._register(this.provider.onDidChangeRecommended(()=>this.updateRecommended(s),this)),this._register(this.provider.onDidChange(()=>this.updateQuickPickItems(s),this));let l=await a;if(!this.token.isCancellationRequested){if(dye(l))try{let u=await l.command();return u?{selection:"controller",connection:u}:void 0}catch(u){if(u instanceof eL)return{selection:"userPerformedSomeOtherAction"};if(u===Ne.back)return this.selectKernelImplInternal(t,n);throw u}if(l&&"connection"in l)return{selection:"controller",connection:l.connection};if(l&&"error"in l)throw Ne.back}}updateQuickPickItems(t){t.title=this.provider.title;let n=new Set(t.items.filter(u=>al(u)).map(u=>u).map(u=>u.connection.id)),i=this.provider.kernels.filter(u=>!n.has(u.id)).map(u=>this.connectionToQuickPick(u));this.updateQuickPickWithLatestConnection(t),this.removeMissingKernels(t),this.updateRecommended(t),i.sort((u,p)=>u.label.localeCompare(p.label));let o=0,s=this.existingItems,a=new Map(Array.from(s).map(u=>[u.connection.id,u])),c=s.size;i.forEach(u=>{let p=a.get(u.connection.id);p&&s.delete(p),s.add(u)});let l=Array.from(s);l.sort((u,p)=>u.label.localeCompare(p.label)),this.quickPickItems.splice(o+1,c,...l),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let n=this.recommendedItems.find(a=>al(a)),i=new Set(this.recommendedItems.filter(al).map(a=>a.connection.id)),o=this.quickPickItems.filter(a=>!al(a)||!i.has(a.connection.id)),s=t.activeItems.length?t.activeItems[0]:void 0;n&&al(n)&&s&&(al(s)?s.connection.id!==n.connection.id&&(n=void 0):n=void 0),mye(t,this.recommendedItems.concat(o),n)}removeMissingKernels(t){let n=t.items.filter(s=>al(s)).map(s=>s).map(s=>s.connection.id),i=new Map(this.provider.kernels.map(s=>[s.id,s])),o=n.filter(s=>!i.has(s));if(o.length){let s=[];this.existingItems.forEach(a=>{o.includes(a.connection.id)&&(this.existingItems.delete(a),s.push(a))}),this.quickPickItems=this.quickPickItems.filter(a=>!s.includes(a)),this.rebuildQuickPickItems(t)}}updateRecommended(t){if(!this.provider.recommended){this.recommendedItems.length=0;return}this.recommendedItems.length||this.recommendedItems.push({label:y.recommendedItemCategoryInQuickPick,kind:Id.QuickPickItemKind.Separator});let n=this.connectionToQuickPick(this.provider.recommended,!0);this.recommendedItems.length===2?this.recommendedItems[1]=n:this.recommendedItems.push(n),this.rebuildQuickPickItems(t)}updateQuickPickWithLatestConnection(t){let n=new Map(this.provider.kernels.map(i=>[i.id,i]));this.recommendedItems.concat(this.quickPickItems).forEach(i=>{if(!al(i)||!n.has(i.connection.id))return;let o=n.get(i.connection.id);o&&(i.label=this.connectionToQuickPick(o,i.isRecommended).label,i.tooltip=this.connectionToQuickPick(o,i.isRecommended).tooltip,i.detail=this.connectionToQuickPick(o,i.isRecommended).detail,i.description=this.connectionToQuickPick(o,i.isRecommended).description,i.isRecommended=this.connectionToQuickPick(o,i.isRecommended).isRecommended,i.connection=o)}),this.rebuildQuickPickItems(t)}connectionToQuickPick(t,n=!1){let i=n?"$(star-full) ":"",o=(c,l,u)=>{c.label=`${i}${l.label}`,c.detail=l.detail,c.description=l.description,this.quickPickItems.forEach(p=>{"connection"in p&&p.connection.id===u.id&&(p.label=l.label,p.detail=l.detail,p.description=l.description)})},s=this.displayDataProvider.getDisplayData(t),a={label:"",detail:"",description:"",isRecommended:n,connection:t};return o(a,s,t),this._register(s.onDidChange(c=>o(a,c,t),this)),a}};var ob=class{constructor(e,t,n,i){this.kernelFinder=e;this.multiStepFactory=t;this.pythonEnvFilter=n;this.jupyterConnection=i;this.localDisposables=[]}async selectLocalKernel(e){if(e.notebookType!==bt&&e.notebookType!==gt)return;this.localDisposables.forEach(o=>o.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new JT.CancellationTokenSource;let t=this.multiStepFactory.create(),n={disposables:[],notebook:e},i=this.kernelFinder.registered.find(o=>o.id==="localKernelSpec");try{if(await t.run(this.selectKernelFromKernelFinder.bind(this,i,this.cancellationTokenSource.token,t,n),n)===Ne.cancel||n.selection?.type==="userPerformedSomeOtherAction")throw new JT.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){Q(n.disposables);return}if(n.selection?.type==="connection")return n.selection.connection}finally{Q(n.disposables)}}selectKernelFromKernelFinder(e,t,n,i){let o=new BT(i.notebook,e.kind,e,this.pythonEnvFilter,this.jupyterConnection);return i.disposables.push(o),this.selectKernel(o,t,n,i)}async selectKernel(e,t,n,i){if(t.isCancellationRequested)return;let o=new qT(e,t);i.disposables.push(o);let s=c=>{let{quickPick:l,selection:u}=n.showLazyLoadQuickPick({...c,placeholder:"",matchOnDescription:!0,matchOnDetail:!0,supportBackInFirstStep:!0,activeItem:void 0,ignoreFocusOut:!1});return{quickPick:l,selection:u}},a=await o.selectKernel(s);a?.selection==="controller"?i.selection={type:"connection",connection:a.connection}:a?.selection==="userPerformedSomeOtherAction"&&(i.selection={type:"userPerformedSomeOtherAction"})}};ob=v([(0,If.injectable)(),d(0,(0,If.inject)(Rr)),d(1,(0,If.inject)(Og)),d(2,(0,If.inject)(si)),d(3,(0,If.inject)(cn))],ob);var Su=_(O()),xf=require("vscode");var Sf=require("vscode");var sb=require("vscode");var $T=class{constructor(e,t){this.notebook=e;this.disposables=[];Te.instance.get(Ct).onControllerSelected(i=>{i.notebook===this.notebook&&(i.controller.connection.kind!=="startUsingPythonInterpreter"||!i.controller.connection.interpreter||i.controller.connection.interpreter.id!==this.createdEnvId)&&this.cancelTokeSource.cancel()},this,this.disposables),this.cancelTokeSource=kP(t)}dispose(){this.cancelTokeSource.dispose(),Q(this.disposables)}async createPythonEnvFromKernelPicker(){let e,t=await this.createPythonEnvironment();if(this.cancelTokeSource.token.isCancellationRequested||t.action)return A("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:t.action||"Cancel"};if(!t.interpreter)return A("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};e=t.interpreter,E(`Python Environment created ${e.id}`);let n=await this.waitForPythonKernel(t.interpreter);if(this.cancelTokeSource.token.isCancellationRequested)return A("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};if(!n)return A("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"kernelConnectionNotCreated"}),E(`Python Environment ${e.id} not found as a kernel`),{action:"Cancel"};E(`Python Environment ${e.id} found as a kernel ${n.kind}:${n.id}`);let o=await Te.instance.get(Cs).installMissingDependencies({resource:this.notebook.uri,kernelConnection:n,ui:new Yt(!1),token:this.cancelTokeSource.token,ignoreCache:!0,cannotChangeKernels:!0,installWithoutPrompting:!0}),s=!0;return o!==0&&(s=!1,j(`Dependencies not installed for new Python Env ${W(e.uri)} for notebook ${W(this.notebook.uri)}`)),A("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{dependenciesInstalled:s,envType:t.interpreter.envType}),{kernelConnection:n}}async waitForPythonKernel(e){let n=Te.instance.get(Rr).registered.find(i=>i.kind==="localPythonEnvironment");if(n)return this.waitForPythonKernelFromFinder(e,n)}async waitForPythonKernelFromFinder(e,t){let n=t.kernels.find(i=>i.interpreter.id===e.id);return n||new Promise(i=>{let o=[];o.push(t.onDidChangeKernels(()=>{if(this.cancelTokeSource.token.isCancellationRequested)return;let s=t.kernels.find(a=>a.interpreter.id===e.id);if(s)return Q(o),i(s)},this,this.disposables)),o.push(this.cancelTokeSource.token.onCancellationRequested(()=>{Q(o)}))}).then(i=>{if(!this.cancelTokeSource.token.isCancellationRequested)return i||j(`New Python Environment ${W(e.uri)} not found as a kernel`),i})}async createPythonEnvironment(){let e=Te.instance.get(tt),t=new sb.CancellationTokenSource;e.pauseInterpreterDetection(t.token);try{let n=await sb.commands.executeCommand("python.createEnvironment",{showBackButton:!0,selectEnvironment:!0});if(n?.action==="Cancel")return{action:"Cancel"};if(n?.action==="Back")return{action:"Back"};let i=n?.path;if(this.cancelTokeSource.token.isCancellationRequested)return{action:"Cancel"};if(!i)return j("Python Environment not created, either user cancelled the creation or there was an error in the Python Extension"),{action:"Cancel"};this.createdEnvId=i,E(`Python Environment created ${i}`);let o=await e.getInterpreterDetails({path:i});return this.cancelTokeSource.token.isCancellationRequested?{action:"Cancel"}:(o||j(`No interpreter details for New Python Environment ${W(sb.Uri.file(i))}`),this.createdEnvId=o?.id,{interpreter:o})}finally{t.cancel(),t.dispose()}}};var HT=require("vscode");function DG(r,e){let t=fye(r,e.environments.known);return t||(()=>{let i=e.environments.getActiveEnvironmentPath(r.uri);return i&&e.environments.known.find(o=>o.id===i.id)})()}function fye(r,e){let t=HT.workspace.getWorkspaceFolder(r.uri)?.uri||(HT.workspace.workspaceFolders?.length===1?HT.workspace.workspaceFolders[0].uri:void 0),n=_G(Ii(r.uri),e);if(n)return n;if(t)return _G(t,e)}function _G(r,e){let t=e.filter(n=>Wg(n.environment?.folderUri?.fsPath||n.executable.uri?.fsPath||n.path,r.fsPath));return t.find(n=>Jr(n)==="Venv"&&n.environment?.name?.toLowerCase()===".venv")||t.find(n=>Jr(n)==="Conda"&&n.environment?.name?.toLowerCase()===".conda")||t.find(n=>["VirtualEnv","VirtualEnvWrapper"].includes(Jr(n))&&n.environment?.name?.toLowerCase()===".venv")||t.find(n=>n.environment?.name?.toLowerCase()===".venv"||n.environment?.name?.toLowerCase()===".conda")||t.length?t[0]:void 0}var GT=class extends Zt{constructor(t,n){super();this.notebook=t;this.token=n;let i=Te.instance.get(si),o=Te.instance.get(ze),s=Te.instance.get(Gt);this.provider=Te.instance.get(Ns).withFilter(h=>!i.isPythonEnvironmentExcluded(h)),this.pythonEnvPicker=this._register(new $p(Promise.resolve(this.provider),E_,P_,{supportsBack:!0},void 0,y.quickPickSelectPythonEnvironmentTitle));let a=!1,c=()=>{a||(a=!0,this.pythonEnvPicker.addCommand({label:`$(add) ${y.createPythonEnvironmentInQuickPick}`},this.createNewEnvironment.bind(this)))};this.provider.items.length&&c();let l={dispose:f},u=this._register(this.provider.onDidChange(()=>{this.provider.items.length&&(c(),l.dispose(),u.dispose())}));this.provider.refresh().finally(()=>{this.provider.items.length||(l=this.pythonEnvPicker.addCommand({label:y.installPythonQuickPickTitle,tooltip:y.installPythonQuickPickToolTip,description:y.pleaseReloadVSCodeOncePythonHasBeenInstalled},()=>{throw setTimeout(()=>Sf.commands.executeCommand($.InstallPythonViaKernelPicker).then(f,f)),new Sf.CancellationError}))}).catch(f);let p=()=>{!this.pythonApi||n.isCancellationRequested||(this.pythonEnvPicker.recommended=DG(this.notebook,this.pythonApi))},m=h=>{h&&(this.pythonApi=h,p(),this._register(h.environments.onDidChangeActiveEnvironmentPath(p)),this._register(h.environments.onDidChangeEnvironments(p)))};o.isPythonExtensionInstalled?s.getNewApi().then(m).catch(f):this._register(o.onPythonExtensionInstallationStatusChanged(()=>s.getNewApi().then(m),this)),p()}async selectKernel(){let t=ue();Sf.extensions.getExtension(ei)||Sf.commands.executeCommand($.InstallPythonExtensionViaKernelPicker).then(c=>{c===!0?this.provider.refresh().catch(f):t.resolve()},c=>{x("Failed to install the Python extension",c),t.resolve()});let n=await Promise.race([this.pythonEnvPicker.selectItem(this.token),t.promise]);if(!n||n instanceof Ne)return n||Ne.cancel;let i=Te.instance.get(tt),o=Te.instance.get(Fr),s=await i.getInterpreterDetails(n.path);if(!s)return Ne.cancel;let a=await Es(s,await o.getKernelSpecTempRegistrationFolder());return Ko.create({kernelSpec:a,interpreter:s,id:Pi(a,s)})}async createNewEnvironment(){let t=Te.instance.get(Gt);if(!Te.instance.get(ze).isPythonExtensionInstalled)return;let o=await this._register(new $T(this.notebook,this.token)).createPythonEnvFromKernelPicker();return o?"action"in o?o.action==="Back"?Ne.back:Ne.cancel:(await t.getNewApi())?.environments.known.find(a=>a.id===o.kernelConnection.interpreter.id):Ne.cancel}};var ab=class extends Zt{constructor(t,n,i,o,s,a){super();this.pythonApi=n;this.filter=i;this.jupyterPaths=o;this.checker=s;this.kind="localPythonEnvironment";this.id="localPythonEnvironment";this.displayName=y.localPythonEnvironments;this._onDidChangeKernels=this._register(new xf.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this._kernels=new Map;this._onDidChangeStatus=this._register(new xf.EventEmitter);this._status="idle";this.promiseMonitor=new co;this.onDidChangeStatus=this._onDidChangeStatus.event;this.previousCancellationTokens=[];this.apiHooked=!1;t.push(this),a.registerKernelFinder(this)}get status(){return this._status}set status(t){this._status=t,this._onDidChangeStatus.fire()}get kernels(){return Array.from(this._kernels.values())}activate(){this._register(this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this)),this.checker.isPythonExtensionInstalled?(this.getKernelSpecsDir().catch(f),this.hookupPythonApi().catch(f)):this._register(this.checker.onPythonExtensionInstallationStatusChanged(()=>{this.checker.isPythonExtensionInstalled&&(this.getKernelSpecsDir().catch(f),this.hookupPythonApi().catch(f))},this))}async selectLocalKernel(t){let n=new xf.CancellationTokenSource,i=[n];try{let o=new GT(t,n.token);i.push(o);let s=await o.selectKernel();if(s instanceof Error){if(s instanceof Ne&&s===Ne.back)return;throw new xf.CancellationError}return this.addUpdateKernel(s),s}finally{Q(i)}}async getKernelConnection(t){let n=Te.instance.get(tt),i=Te.instance.get(Fr),o=await n.getInterpreterDetails(t.path);if(!o){j(`Python Env ${W(t.id)} not found}`);return}if(!o||this.filter.isPythonEnvironmentExcluded(o)){j(`Python Env hidden via filter: ${W(o.id)}`);return}let s=await Es(o,await i.getKernelSpecTempRegistrationFolder()),a=Ko.create({kernelSpec:s,interpreter:o,id:Pi(s,o)}),c=this._kernels.get(a.id);return c||(this.addUpdateKernel(a),a)}addUpdateKernel(t){let n=this._kernels.get(t.id);n?(n.updateInterpreter(t.interpreter),this._kernels.set(t.id,Object.assign(n,t)),this._onDidChangeKernels.fire({})):(this._kernels.set(t.id,t),this._onDidChangeKernels.fire({}))}async refresh(){this.previousCancellationTokens.forEach(t=>t.cancel()),Q(this.previousCancellationTokens),this.previousCancellationTokens=[],this._kernels.clear(),this.pythonApi.getNewApi().then(t=>{t&&(this.promiseMonitor.push(t.environments.refreshEnvironments({forceRefresh:!0}).catch(f)),t.environments.known.forEach(n=>this.buildDummyEnvironment(n).catch(f)))}).catch(f)}getKernelSpecsDir(){return this.tempDirForKernelSpecs||this.jupyterPaths.getKernelSpecTempRegistrationFolder()}async hookupPythonApi(){if(this.apiHooked)return;this.apiHooked=!0;let t=await this.pythonApi.getNewApi();t&&(t.environments.known.map(n=>this.buildDummyEnvironment(n).catch(f)),this._register(t.environments.onDidChangeEnvironments(n=>{if(n.type==="remove"){let i=this._kernels.get(n.env.id);i&&(this._kernels.delete(n.env.id),this._onDidChangeKernels.fire({removed:[i]}))}else this.buildDummyEnvironment(n.env).catch(f)},this)))}async buildDummyEnvironment(t){let n=this.pythonApi.pythonExtensionVersion&&this.pythonApi.pythonExtensionVersion.compare("2023.3.10341119")>=0,i=qE(t,n===!0);if(!i||this.filter.isPythonEnvironmentExcluded(i))return;let o=await Es(i,await this.getKernelSpecsDir()),s=Ko.create({kernelSpec:o,interpreter:i,id:Pi(o,i)});this._kernels.get(t.id)||(this._kernels.set(t.id,s),this._onDidChangeKernels.fire({}))}};ab=v([(0,Su.injectable)(),d(0,(0,Su.inject)(F)),d(1,(0,Su.inject)(Gt)),d(2,(0,Su.inject)(si)),d(3,(0,Su.inject)(Fr)),d(4,(0,Su.inject)(ze)),d(5,(0,Su.inject)(Rr))],ab);var cl=_(O()),Ln=require("vscode");function zT(r){return r===It||r===ah}var cb=class{constructor(e,t,n,i,o,s,a){this.kernelFinder=e;this.serverUriStorage=t;this.serverSelector=n;this.jupyterConnection=i;this.displayDataProvider=o;this.kernelFinderController=s;this.jupyterServerRegistry=a;this.localDisposables=[]}async selectRemoteKernel(e,t){if(e.notebookType!==bt&&e.notebookType!==gt)return;this.localDisposables.forEach(o=>o.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new Ln.CancellationTokenSource;let n=new bx,i={disposables:[],notebook:e};try{if(await n.run(this.getRemoteServersFromProvider.bind(this,t,this.cancellationTokenSource.token),i)===Ne.cancel||i.selection?.type==="userPerformedSomeOtherAction")throw new Ln.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){Q(i.disposables);return}if(i.selection?.type==="connection")return i.selection.connection}finally{Q(i.disposables)}}async getRemoteServersFromProvider(e,t,n,i){let o=this.kernelFinder.registered.filter(D=>D.kind==="remote"),s=[],a=[],c=[],l=this.jupyterServerRegistry.jupyterCollections.find(D=>D.extensionId===e.extensionId&&D.id===e.id)?.serverProvider,u=l?.provideJupyterServers?Promise.resolve(l.provideJupyterServers.bind(l)(t)).then(D=>D||[]):Promise.resolve([]),p=new Set,m=await u,h=new Set(m.map(D=>D.id));if(o.filter(D=>D.serverProviderHandle.id===e.id).filter(D=>h.has(D.serverProviderHandle.id)).map(D=>{let V=this.serverUriStorage.all.find(oe=>Wt(oe.provider)===Wt(D.serverProviderHandle));p.add(Wt(D.serverProviderHandle)),c.push({server:D,time:V?.time})}),c.sort((D,V)=>!D.time&&!V.time?D.server.displayName.localeCompare(V.server.displayName):!D.time&&V.time?1:D.time&&!V.time||(D.time||0)>(V.time||0)?-1:1),c.filter(({time:D})=>(D||0)>0).forEach(({server:D,time:V})=>{s.push({type:"finder",kernelFinderInfo:D,idAndHandle:D.serverProviderHandle,label:D.displayName,description:V?y.jupyterServerLastConnectionForQuickPickDescription(new Date(V)):void 0,buttons:l?.removeJupyterServer&&zT(e.extensionId)?[{iconPath:new Ln.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),c.filter(({time:D})=>!D).forEach(({server:D})=>{s.push({type:"finder",kernelFinderInfo:D,idAndHandle:D.serverProviderHandle,label:D.displayName,buttons:l?.removeJupyterServer&&zT(e.extensionId)?[{iconPath:new Ln.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),m.sort((D,V)=>D.label.localeCompare(V.label)).forEach(D=>{let V=Wt({extensionId:e.extensionId,id:e.id,handle:D.id});p.has(V)||s.push({type:"jupyterServer",label:D.label,idAndHandle:{extensionId:e.extensionId,id:e.id,handle:D.id},server:D,buttons:l?.removeJupyterServer&&zT(e.extensionId)?[{iconPath:new Ln.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),e.commandProvider){let D=(await Promise.resolve(e.commandProvider.provideCommands(void 0,t))||[]).map(V=>({...V,provider:e,type:"uriProviderQuickPick",command:V}));s.length>0&&D.length&&a.push({label:"",kind:Ln.QuickPickItemKind.Separator}),a.push(...D)}let g=s.concat(a),b=new Ln.EventEmitter,w=g.length===1&&"command"in g[0]&&g[0].command.canBeAutoSelected?g[0]:void 0;if(l){let D=g.filter(V=>"type"in V);D.length===1&&D.every(V=>V.type!=="uriProviderQuickPick")?w=D[0]:D.every(V=>V.type==="uriProviderQuickPick")&&D.filter(V=>V.picked).length===1&&(w=g.filter(V=>V.picked)[0])}let k,N;if(w)N=w;else{let{quickPick:D,selection:V}=n.showLazyLoadQuickPick({items:g,placeholder:e.extensionId===It||e.extensionId===ah?y.enterOrSelectRemoteJupyterPlaceholder:y.selectRemoteJupyterPlaceholder,title:y.quickPickTitleForSelectionOfJupyterServer,supportBackInFirstStep:!0,onDidTriggerItemButton:async oe=>{if("type"in oe.item&&(oe.item.type==="finder"||oe.item.type==="jupyterServer")){let G=oe.item.idAndHandle.handle,pe=m.find(de=>de.id===G);l?.removeJupyterServer&&pe&&zT(e.extensionId)&&(D.busy=!0,this.serverUriStorage.remove({extensionId:e.extensionId,id:e.id,handle:G}).catch(f),await l.removeJupyterServer(pe),D.busy=!1,g.splice(g.indexOf(oe.item),1),b.fire(g.concat([])))}},onDidChangeItems:b.event});D.onDidChangeValue(async oe=>{if(!e.commandProvider?.provideCommands)return;let G=[];s.length>0&&G.push({label:"",kind:Ln.QuickPickItemKind.Separator});let de=(await Promise.resolve(e.commandProvider.provideCommands(oe,t))||[]).map(te=>({...te,provider:e,type:"uriProviderQuickPick",command:te}));D.items=s.concat(G).concat(de)},this),k=D,N=await V}if(!t.isCancellationRequested&&N&&"type"in N)switch(N.type){case"finder":{let D=await this.selectRemoteKernelFromPicker(i.notebook,Promise.resolve(N.kernelFinderInfo),t).catch(V=>x("Failed to select a kernel",V));if(D&&D===Ne.back){if(N===w)throw Ne.back;return this.getRemoteServersFromProvider(e,t,n,i)}if(!D||D instanceof Ne)throw new Ln.CancellationError;i.selection={type:"connection",connection:D};return}case"jupyterServer":{let D=(async()=>{let oe={id:e.id,handle:N.server.id,extensionId:e.extensionId};return e.extensionId.toLowerCase()===Ba.toLowerCase()&&await ar(t,this.serverSelector.addJupyterServer(oe)),this.kernelFinderController.getOrCreateRemoteKernelFinder(oe,N.server.label)})(),V=await this.selectRemoteKernelFromPicker(i.notebook,D,t).catch(oe=>x("Failed to select a kernel",oe));if(V&&V===Ne.back){if(N===w)throw Ne.back;return this.getRemoteServersFromProvider(e,t,n,i)}if(!V||V instanceof Ne)throw new Ln.CancellationError;i.selection={type:"connection",connection:V};return}case"uriProviderQuickPick":{let D=Ln.notebooks.createNotebookControllerDetectionTask(bt);try{k&&(k.busy=!0);let V=await this.selectRemoteServerFromRemoteKernelFinder(N,i,t);return k&&(k.busy=!1),V}catch(V){if(V===Ne.back&&!w)return this.getRemoteServersFromProvider(e,t,n,i);throw V}finally{D.dispose()}}default:break}}async selectRemoteServerFromRemoteKernelFinder(e,t,n){if(!e.provider.commandProvider?.handleCommand||n.isCancellationRequested)return;let i=await Promise.resolve(e.provider.commandProvider.handleCommand(e.command,n));if(!i)throw Ne.back;if(n.isCancellationRequested)throw new Ln.CancellationError;let o=(async()=>{let a={id:e.provider.id,handle:i.id,extensionId:e.provider.extensionId};return a.extensionId.toLowerCase()===Ba.toLowerCase()&&await ar(n,this.serverSelector.addJupyterServer(a)),this.kernelFinderController.getOrCreateRemoteKernelFinder(a,i.label)})(),s=await this.selectRemoteKernelFromPicker(t.notebook,o,n).catch(a=>x("Failed to select a kernel",a));if(s&&s===Ne.back)throw Ne.back;if(!s||s instanceof Ne)throw new Ln.CancellationError;t.selection={type:"connection",connection:s}}async selectRemoteKernelFromPicker(e,t,n){let i,o=u=>{let p=this.displayDataProvider.getDisplayData(u);return{label:`${u===i?"$(star-full) ":""}${p.label}`,description:p.description,detail:p.detail}},s=u=>({label:this.displayDataProvider.getDisplayData(u).category||"Other"}),a=u=>({label:y.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel,detail:y.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail}),c=new $p(t,o,s,{supportsBack:!0},a),l=new bd(this.jupyterConnection);return t.then(u=>l.findPreferredRemoteKernelConnection(e,u,n)).then(u=>{i=u,u?.kind==="startUsingRemoteKernelSpec"&&(c.recommended=u),c.selected=u}).catch(u=>x("Failed to determine preferred remote kernel",u)),c.selectItem(n)}};cb=v([(0,cl.injectable)(),d(0,(0,cl.inject)(Rr)),d(1,(0,cl.inject)(er)),d(2,(0,cl.inject)(fa)),d(3,(0,cl.inject)(cn)),d(4,(0,cl.inject)(hp)),d(5,(0,cl.inject)(uC)),d(6,(0,cl.inject)(Qt))],cb);function TG(r,e){r.addSingleton(Ct,Xy),r.addBinding(Ct,be),r.addSingleton(hp,Yy),r.addSingleton(EP,cb),r.addSingleton(PP,ob),r.addSingleton(vm,ab),r.addBinding(vm,be),r.addSingleton(be,ib),PG(r,e)}var TC=_(O()),Cf=require("vscode");var Ma=Symbol("IJupyterDebugService"),Sd=Symbol("INotebookDebuggingManager");var QT=Symbol("IDebugLocationTrackerFactory"),YT=Symbol("IDebugLocationTracker");var lb=class{constructor(e,t){this.debuggingManager=e;this.disposables=t}activate(){this.disposables.push(Cf.commands.registerCommand($.RunByLine,this.runByLine,this)),this.disposables.push(Cf.commands.registerCommand($.RunByLineNext,this.runByLineNext,this)),this.disposables.push(Cf.commands.registerCommand($.RunByLineStop,this.runByLineStop,this)),this.disposables.push(Cf.commands.registerCommand($.RunAndDebugCell,this.runAndDebugCell,this))}async runByLine(e){A("DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(0,e)}async runByLineNext(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineNext(e)}async runByLineStop(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineStop(e)}async runAndDebugCell(e){A("DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(1,e)}getCellFromActiveEditor(){let e=Cf.window.activeNotebookEditor;if(e){let t=e.selections[0];if(t)return e.notebook.cellAt(t.start)}}dispose(){this.disposables.forEach(e=>e.dispose())}};lb=v([(0,TC.injectable)(),d(0,(0,TC.inject)(Sd)),d(1,(0,TC.inject)(F))],lb);var xu=_(O());var ub=class{constructor(e,t,n){this.debugService=e;this.disposables=t;this.debugVariables=n}activate(){this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(xe,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory("debugpy",this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(US,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(jS,this))}createDebugAdapterTracker(e){return this.debugVariables}};ub=v([(0,xu.injectable)(),d(0,(0,xu.inject)(Ma)),d(0,(0,xu.named)(Ge.MULTIPLEXING_DEBUGSERVICE)),d(1,(0,xu.inject)(F)),d(2,(0,xu.inject)(Rn)),d(2,(0,xu.named)(Ge.DEBUGGER_VARIABLES))],ub);var Oa=_(O());var RC=require("vscode");var tL=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]);function ZT(r){return{name:r.evaluateName??r.name,type:r.type,count:0,shape:"",size:0,supportsDataExplorer:tL.has(r.type||""),value:r.value,truncated:!0,frameId:r.variablesReference}}var rL=require("vscode"),pb=class{constructor(e){this._sessionId=e;this.topMostFrameId=0;this.sequenceNumbersOfRequestsPendingResponses=new Set;this.waitingForStackTrace=!1;this.debugLocationUpdatedEvent=new rL.EventEmitter;this.sessionEndedEmitter=new rL.EventEmitter;this.DebugLocation=void 0}get sessionId(){return this._sessionId}get sessionEnded(){return this.sessionEndedEmitter.event}get debugLocationUpdated(){return this.debugLocationUpdatedEvent.event}get debugLocation(){return this._debugLocation}onDidSendMessage(e){if(this.isResponseForRequestToFetchAllFrames(e)){let t=e.body?.stackFrames[0];this.topMostFrameId=t?.id,this.sequenceNumbersOfRequestsPendingResponses.delete(e.request_seq),this.waitingForStackTrace&&(this.DebugLocation={lineNumber:t?.line,fileName:this.normalizeFilePath(t?.source?.path),column:t.column},this.waitingForStackTrace=!1)}this.isStopEvent(e)&&(this.waitingForStackTrace=!0),this.isContinueEvent(e)&&(this.DebugLocation=void 0,this.waitingForStackTrace=!1)}onWillStopSession(){this.sessionEndedEmitter.fire(this)}onWillReceiveMessage(e){this.isRequestToFetchAllFrames(e)&&this.sequenceNumbersOfRequestsPendingResponses.add(e.seq)}set DebugLocation(e){let t=this._debugLocation;this._debugLocation=e,this._debugLocation!==t&&this.debugLocationUpdatedEvent.fire()}normalizeFilePath(e){return process.platform!=="win32"?e.replace(/\\/g,"/"):e}isStopEvent(e){return e.type==="event"&&e.event==="stopped"}isContinueEvent(e){if(e.type==="event"){if(e.event==="continue")return!0}else if(e.type==="response"&&e.command==="continue")return!0;return!1}isResponseForRequestToFetchAllFrames(e){return e.type==="response"&&e.command==="stackTrace"&&e.body?.stackFrames[0]&&this.sequenceNumbersOfRequestsPendingResponses.has(e.request_seq)}isRequestToFetchAllFrames(e){return e.type==="request"&&e.command==="stackTrace"&&(e.arguments.startFrame===0||e.arguments.startFrame===void 0)}};var hye=new Set(["In","Out","exit","quit"]),e0=100,db=class extends pb{constructor(t,n,i,o,s,a){super(void 0);this.debugService=t;this.debuggingManager=n;this.configService=i;this.varScriptGenerator=o;this.dfScriptGenerator=s;this.kernelProvider=a;this.refreshEventEmitter=new RC.EventEmitter;this.lastKnownVariables=[];this.importedGetVariableInfoScriptsIntoKernel=new Set;this.watchedNotebooks=new Map;this.debuggingStarted=!1;this.currentVariablesReference=0;this.currentSeqNumsForVariables=new Set;this.debuggingManager.onDoneDebugging(()=>this.refreshEventEmitter.fire(),this)}get refreshRequired(){return this.refreshEventEmitter.event}get active(){return(this.debugService.activeDebugSession!==void 0||this.activeNotebookIsDebugging())&&this.debuggingStarted}getAllVariableDiscriptions(){throw new Error("Method not implemented.")}async getVariables(t,n){n&&this.watchKernel(n);let i=n&&this.kernelProvider.getKernelExecution(n),o={executionCount:i?i.executionCount:t.executionCount,pageStartIndex:0,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(this.active){let s=t.sortColumn,a=(u,p)=>{let m=u[s]?u[s]:"",h=p[s]?p[s]:"";return t.sortAscending?m.localeCompare(h,void 0,{sensitivity:"base"}):h.localeCompare(m,void 0,{sensitivity:"base"})};this.lastKnownVariables.sort(a);let c=t.startIndex?t.startIndex:0,l=t.pageSize?t.pageSize:e0;o.pageStartIndex=c;for(let u=c;u<c+l&&u<this.lastKnownVariables.length;u+=1){let p=this.lastKnownVariables[u].truncated?await this.getFullVariable(this.lastKnownVariables[u]):this.lastKnownVariables[u];this.lastKnownVariables[u]=p,o.pageResponse.push(p)}o.totalCount=this.lastKnownVariables.length}return o}async getMatchingVariable(t,n){if(this.active){let i=this.lastKnownVariables.find(o=>o.name===t);return i&&n?.resourceUri&&zu(n?.resourceUri).toLowerCase()===".ipynb"&&A("DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER"),i}}async getDataFrameInfo(t,n,i,o){if(!this.active)return t;o&&(t=await this.getFullVariable(t)),n&&this.watchKernel(n);let s=t.name;i&&(s=`${t.name}${i}`);let{cleanupCode:a,initializeCode:c,code:l}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!0,variableName:s}),u=await this.evaluate({code:l,cleanupCode:a,initializeCode:c,frameId:t.frameId}),p=n?.notebook,m=p?De(p.uri.path):"";return!m&&this.debugLocation?.fileName&&(m=De(this.debugLocation.fileName)),u?{...t,...JSON.parse(u.result),maximumRowChunkSize:e0,fileName:m}:t}async getDataFrameRows(t,n,i,o,s){if(i-n>e0)throw new Error(`Debugger cannot provide more than ${e0} rows at once`);if(!this.debugService.activeDebugSession||t.columns===void 0)return{data:[]};o&&this.watchKernel(o);let a=t.name;s&&(a=`${t.name}${s}`);let{cleanupCode:c,initializeCode:l,code:u}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!0,variableName:a,startIndex:n,endIndex:i}),p=await this.evaluate({code:u,cleanupCode:c,initializeCode:l,frameId:t.frameId});return BF(JSON.parse(p.result))}onWillReceiveMessage(t){super.onWillReceiveMessage(t),t.type==="request"&&t.command==="variables"&&t.arguments&&this.currentVariablesReference===t.arguments.variablesReference&&this.currentSeqNumsForVariables.add(t.seq)}onDidSendMessage(t){if(super.onDidSendMessage(t),t.type==="response"&&t.command==="initialize")this.debuggingStarted=!0;else if(t.type==="event"&&t.event==="stopped"&&this.activeNotebookIsDebugging())this.handleNotebookVariables(t).catch(f);else if(t.type==="response"&&t.command==="scopes"&&t.body&&t.body.scopes){let i=t.body.scopes[0].variablesReference;i!==this.currentVariablesReference&&(this.currentVariablesReference=i,this.currentSeqNumsForVariables.clear())}else if(t.type==="response"&&t.command==="variables"&&t.body)this.currentSeqNumsForVariables.has(t.request_seq)&&this.updateVariables(void 0,t),this.monkeyPatchDataViewableVariables(t);else if(t.type==="event"&&t.event==="terminated"){this.lastKnownVariables=[],this.topMostFrameId=0,this.debuggingStarted=!1,this.refreshEventEmitter.fire();let n=this.debugService.activeDebugSession?.id;n&&this.importedGetVariableInfoScriptsIntoKernel.delete(n)}}watchKernel(t){let n=t.notebook?.uri.toString();if(n&&!this.watchedNotebooks.has(n)){let i=[];i.push(t.onRestarted(this.resetImport.bind(this,n))),i.push(t.onDisposed(()=>{this.resetImport(n),i.forEach(o=>o.dispose()),this.watchedNotebooks.delete(n)})),this.watchedNotebooks.set(n,i)}}resetImport(t){this.importedGetVariableInfoScriptsIntoKernel.delete(t)}async evaluate({code:t,cleanupCode:n,frameId:i,initializeCode:o}){if(this.debugService.activeDebugSession){i=this.topMostFrameId||i;let s={frameId:i,context:"repl",format:{rawString:!0}};E(`Evaluating in debugger : ${this.debugService.activeDebugSession.id}: ${t}`);try{o&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:o});let a=await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:t});if(a&&a.result!=="None")return a;x(`Cannot evaluate ${t}`);return}finally{n&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:n})}}throw Error("Debugger is not active, cannot evaluate.")}async getFullVariable(t){let{initializeCode:n,code:i,cleanupCode:o}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!0,variableName:t.name}),s=await this.evaluate({code:i,initializeCode:n,cleanupCode:o,frameId:t.frameId});return s&&s.result?{...t,truncated:!1,...JSON.parse(s.result)}:t}monkeyPatchDataViewableVariables(t){t.body.variables.forEach(n=>{n.type&&tL.has(n.type)&&(n.__vscodeVariableMenuContext="viewableInDataViewer")})}updateVariables(t,n){let i=this.configService.getSettings(t).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],o=n.body.variables.filter(s=>!(!s.name||!s.type||!s.value||i&&i.includes(s.type)||s.name.startsWith("_")||hye.has(s.name)||s.type==="NoneType"));this.lastKnownVariables=o.map(s=>ZT(s)),this.refreshEventEmitter.fire()}activeNotebookIsDebugging(){let t=RC.window.activeNotebookEditor;return!!t&&this.debuggingManager.isDebugging(t.notebook)}async handleNotebookVariables(t){let n=RC.window.activeNotebookEditor?.notebook,i=t.body.threadId;if(n){let o=this.debuggingManager.getDebugSession(n);if(o){let s=await o.customRequest("stackTrace",{threadId:i,startFrame:0,levels:1});if(s&&s.stackFrames[0]){let a=s.stackFrames[0],c=this.debuggingManager.getDebugMode(n),l;if(c===0){let u=this.debuggingManager.getDebugCell(n);a.source&&u&&a.source.path===u.document.uri.toString()&&(l=await o.customRequest("scopes",{frameId:a.id}))}else{let u=De(n.uri.toString());a.source&&a.source.path&&a.source.path.includes(u)&&(l=await o.customRequest("scopes",{frameId:a.id}))}l&&(l.scopes.forEach(u=>{o.customRequest("variables",{variablesReference:u.variablesReference}).then(f,f)}),this.refreshEventEmitter.fire())}}}}};db=v([(0,Oa.injectable)(),d(0,(0,Oa.inject)(Ma)),d(0,(0,Oa.named)(Ge.MULTIPLEXING_DEBUGSERVICE)),d(1,(0,Oa.inject)(Sd)),d(2,(0,Oa.inject)(le)),d(3,(0,Oa.inject)(Sh)),d(4,(0,Oa.inject)(xh)),d(5,(0,Oa.inject)(Ke))],db);var Cu=_(O()),xd=require("vscode");var RG=require("vscode"),ir=class{constructor(e){this.name=e}get value(){return this.lastValue}async set(e){this.lastValue!==e&&(this.lastValue=e,await RG.commands.executeCommand("setContext",this.name,this.lastValue))}};var FG=require("vscode");var AC=(o=>(o[o.Unknown=0]="Unknown",o[o.Ok=1]="Ok",o[o.Outdated=2]="Outdated",o[o.NotInstalled=3]="NotInstalled",o[o.ControllerNotSelected=4]="ControllerNotSelected",o))(AC||{});async function AG(r){let e="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",t=`import builtins
import ipykernel
builtins.print("${e}" + ipykernel.__version__ + "${e}")`,n=await r.executeHidden(t),i=/^(\d+)\.\d+\.\d+$/;for(let o of n){if(o.output_type!=="stream")continue;let s=o.text?.toString().trim()??"";if(!s.includes(e))continue;let a=s.split(e)[1].trim().match(i);if(a){let c=a[1];return Number(c)>=6?1:2}}return 0}function NC(r){let e=r;if(typeof e.__notebookUri>"u"||typeof e.__mode>"u"||(e.__mode===1||e.__mode===2||e.__mode===0)&&typeof e.__cellIndex>"u")throw new Error("Invalid launch configuration")}function NG(r){if(NC(r),r.__mode!==2)throw new Error("Invalid launch configuration")}function t0(r,e){switch(r.type){case"event":let t=r;switch(t.event){case"output":e(t.body);break;case"loadedSource":e(t.body);break;case"breakpoint":e(t.body.breakpoint);break;default:break}break;case"request":let n=r;switch(n.command){case"setBreakpoints":let o=n.arguments,s=o.breakpoints;if(s&&s.length){let a=s[0].line;s.forEach(l=>{e(l,{...o.source})});let c={source:o.source,line:a};e(c),o.source=c.source}break;case"breakpointLocations":e(n.arguments);break;case"source":e(n.arguments);break;case"gotoTargets":e(n.arguments);break;default:break}break;case"response":let i=r;if(i.success&&i.body)switch(i.command){case"stackTrace":i.body.stackFrames.forEach(o=>{e(o)});break;case"loadedSources":i.body.sources.forEach(o=>{let s={source:o};e(s),o.path=s.source.path});break;case"scopes":i.body.scopes.forEach(o=>{e(o)});break;case"setFunctionBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;case"setBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;default:break}break}}function MG(r){return/~\d+\\/.test(r)}function OG(r,e){return new RegExp(r.replace(/\\/g,"\\\\").replace(/~\d+\\\\/g,"[^\\\\]+\\\\"),"i").test(e)}async function wf(r,e){let t=`import debugpy
debugpy.debug_this_thread()`;await r.executeHidden(t),await e.dumpAllCells()}function KG(r){return!!r.header&&r.header.msg_type==="debug_event"}function MC(r){return r.includes("Frame skipped from debugging during step-in")}function nL(r){return r.event==="debugpyAttach"}var r0=class{constructor(e,t,n){this.debugAdapter=e;this.debugCell=t;this.execution=n;A("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){E(`[Debug-Cell] ${e}: ${t}`)}async willSendEvent(e){return nL(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&MC(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){e.command==="configurationDone"&&(await wf(this.execution,this.debugAdapter),FG.commands.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(f,f))}};var OC=class{constructor(e,t,n,i){this.mode=e;this.debugAdapter=t;this.debugCell=n;this.serviceContainer=i;this.debuggingManager=this.serviceContainer.get(Sd)}trace(e,t){E(`[Debug-Restart] ${e}: ${t}`)}error(e,t){x(`[Debug-Restart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Handling restart request"),setTimeout(()=>{this.debugAdapter.disconnect().then(()=>(this.trace("restart","doRestart"),this.debuggingManager.tryToStartDebugging(this.mode,this.debugCell,!0))).catch(t=>{this.error("restart",`Error restarting: ${t}`)})},0),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var KC=require("vscode");var n0=class{constructor(e,t,n,i){this.debugAdapter=e;this.debugCell=t;this.execution=n;this.settings=i;A("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE")}continue(){if(typeof this.lastPausedThreadId!="number"){E("No paused thread, can't do RBL"),this.stop();return}this.debugAdapter.stepIn(this.lastPausedThreadId).then(f,f)}stop(){ne("RunbylineController::stop()"),this.execution.executeHidden("pass").then(f,f),this.debugAdapter.disconnect().then(f,f)}getMode(){return this.debugAdapter.getConfiguration().__mode}async willSendEvent(e){return e.event==="stopped"&&(this.lastPausedThreadId=e.body.threadId,await this.handleStoppedEvent(this.lastPausedThreadId))?(this.trace("intercepted","handled stop event"),!0):e.event==="output"&&MC(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){ne(`willSendRequest: ${e.command}`),e.command==="configurationDone"&&await this.initializeExecute()}async handleStoppedEvent(e){return await this.shouldStepIn(e)?(this.debugAdapter.stepIn(e).then(f,f),!0):!1}async shouldStepIn(e){let t=await this.debugAdapter.stackTrace({threadId:e,startFrame:0,levels:1});if(t&&t.stackFrames[0]){let n=t.stackFrames[0],i=new KC.Position(n.line,n.column);return this.lastPausePosition?.isEqual(i)?(this.trace("intercept","working around duplicate stop event"),!0):(this.lastPausePosition=i,!!n.source&&n.source.path!==this.debugCell.document.uri.toString())}return!1}trace(e,t){E(`[Debug-RBL] ${e}: ${t}`)}async initializeExecute(){await wf(this.execution,this.debugAdapter);let e=Fe(this.debugCell.document.getText(),{trim:!1,removeEmptyEntries:!1}),t=[];if(mm(e,()=>void 0,(n,i)=>{n.trim().length!==0&&t.push(i)}),t.sort(),t.length!==0){let n={line:t[0]+1};await this.debugAdapter.setBreakpoints({source:{name:De(this.debugCell.notebook.uri.path),path:this.debugCell.document.uri.toString()},breakpoints:[n],sourceModified:!1}),this.settings.getSettings(this.debugCell.notebook.uri).showVariableViewWhenDebugging&&KC.commands.executeCommand($.OpenVariableView).then(f,f)}KC.commands.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(f,f)}};var mb=class{constructor(e,t,n){this.document=e;this.config=t;this.session=n}};var Un=require("vscode");var fb=class{constructor(e,t,n){this.kernelProvider=e;this.controllerRegistration=t;this.serviceContainer=n;this.notebookToDebugger=new Map;this.notebookToDebugAdapter=new Map;this.notebookInProgress=new Set;this.disposables=[];this._doneDebugging=new Un.EventEmitter}activate(){this.disposables.push(Un.debug.onDidTerminateDebugSession(this.endSession.bind(this)),Un.workspace.onDidCloseNotebookDocument(async e=>{let t=this.notebookToDebugger.get(e);t&&(await Un.debug.stopDebugging(t.session),this.onDidStopDebugging(e))}))}getDebugCell(e){return this.notebookToDebugAdapter.get(e)?.debugCell}get onDoneDebugging(){return this._doneDebugging.event}dispose(){this.disposables.forEach(e=>e.dispose())}isDebugging(e){return this.notebookToDebugger.has(e)}getDebugSession(e){let t=this.notebookToDebugger.get(e);if(t)return t.session}getDebugAdapter(e){return this.notebookToDebugAdapter.get(e)}onDidStopDebugging(e){}async startDebuggingConfig(e,t){ne(`Attempting to start debugging with config ${JSON.stringify(e)}`);try{await Un.debug.startDebugging(void 0,e,t)}catch(n){x(`Can't start debugging (${n})`),Un.window.showErrorMessage(y.cantStartDebugging).then(f,f)}}trackDebugAdapter(e,t){this.notebookToDebugAdapter.set(e,t),this.disposables.push(t.onDidEndSession(this.endSession.bind(this)))}async endSession(e){z(`Ending debug session ${e.id}`),this._doneDebugging.fire();for(let[t,n]of this.notebookToDebugger.entries())if(n&&e.id===n.session.id){this.notebookToDebugger.delete(t),this.notebookToDebugAdapter.delete(t),this.onDidStopDebugging(t);break}}getDebuggerByUri(e){for(let[t,n]of this.notebookToDebugger.entries())if(e===t)return n}async ensureKernelIsRunning(e){let t=this.controllerRegistration.getSelected(e),n=this.kernelProvider.get(e);return t&&(!n||n&&n.status==="unknown")&&(n=await Vs.connectToNotebookKernel(t.connection,this.serviceContainer,{notebook:e,controller:t.controller,resource:e.uri},new Yt(!1),this.disposables,"jupyterExtension")),n}findEditorForCell(e){let t=e.notebook.uri.toString();return Un.window.visibleNotebookEditors.find(n=>n.notebook.uri.toString()===t)}async checkIpykernelAndPrompt(e,t=!0){let n=this.findEditorForCell(e);if(!n)return Un.window.showErrorMessage(y.noNotebookToDebug).then(f,f),0;let i=await this.checkForIpykernel6(n.notebook);switch(i){case 3:break;case 2:case 0:{this.promptInstallIpykernel6().then(f,f);break}case 4:if(t)return await Un.commands.executeCommand("notebook.selectKernel",{notebookEditor:n}),await this.checkIpykernelAndPrompt(e,!1)}return i}async checkForIpykernel6(e){try{let t=this.kernelProvider.get(e);if(!t){let s=this.controllerRegistration.getSelected(e);if(!s)return 4;t=this.kernelProvider.getOrCreate(e,{metadata:s.connection,controller:s?.controller,resourceUri:e.uri})}let n=t.kernelConnectionMetadata;if(Ft(n)){if(n.kind==="startUsingRemoteKernelSpec"&&n.kernelSpec.metadata?.debugger)return 1;if(n.kind==="connectToLiveRemoteKernel"&&n.kernelModel.metadata?.debugger)return 1}let i=this.kernelProvider.getKernelExecution(t),o=await AG(i);return A("DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",void 0,{status:o===1?"installed":"notInstalled"}),o}catch(t){x("Debugging: Could not check for ipykernel 6",t)}return 0}async promptInstallIpykernel6(){await Un.window.showInformationMessage(y.needIpykernel6,{modal:!0},y.setup)===y.setup?(A("DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP"),Un.env.openExternal(Un.Uri.parse("https://github.com/microsoft/vscode-jupyter/wiki/Setting-Up-Run-by-Line-and-Debugging-for-Notebooks"))):A("DATASCIENCE.DEBUGGING.CLOSED_MODAL")}};var to=require("vscode");var i0=class{constructor(e){this.debugAdapter=e}trace(e,t){E(`[Debug-Reset] ${e}: ${t}`)}async willSendRequest(e){e.command==="attach"&&(this.trace("attach","Continuing paused kernel threads if needed"),(await this.debugAdapter.debugInfo()).stoppedThreads.forEach(n=>this.debugAdapter.continueDirect(n)))}};var hb=class{constructor(e,t,n,i,o,s){this.session=e;this.notebookDocument=t;this.jupyterSession=n;this.kernel=i;this.platformService=o;this.debugService=s;this.fileToCell=new Map;this.sendMessage=new to.EventEmitter;this.endSession=new to.EventEmitter;this.disposables=[];this.delegates=[];this.onDidSendMessage=this.sendMessage.event;this.onDidEndSession=this.endSession.event;this.disconnected=!1;ne("Creating kernel debug adapter for debugging notebooks");let a=this.session.configuration;NC(a),this.configuration=a,this.debugCell=t.cellAt(a.__cellIndex),this.addDebuggingDelegates([new i0(this)]),this.jupyterSession.kernel?.iopubMessage.connect(this.onIOPubMessage,this),this.disposables.push(new to.Disposable(()=>this.jupyterSession.kernel?.iopubMessage.disconnect(this.onIOPubMessage,this))),this.kernel&&(this.kernel.addHook("willRestart",()=>this.disconnect(),this,this.disposables),this.kernel.addHook("interruptCompleted",()=>this.disconnect(),this,this.disposables),this.disposables.push(this.kernel.onDisposed(()=>{this.disconnected||(to.debug.stopDebugging(this.session).then(f,f),this.disconnect().catch(f),A("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"onKernelDisposed"}))}))),this.disposables.push(to.notebooks.onDidChangeNotebookCellExecutionState(c=>{this.configuration.__cellIndex===c.cell.index&&c.state===to.NotebookCellExecutionState.Idle&&!this.disconnected&&(A("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"normally"}),this.disconnect().catch(f))},this,this.disposables)),this.disposables.push(to.workspace.onDidChangeNotebookDocument(c=>{c.contentChanges.forEach(l=>{l.removedCells.forEach(u=>{u===this.debugCell&&this.disconnect().catch(f)})})},this,this.disposables)),this.disposables.push(this.debugService.onDidTerminateDebugSession(c=>{(c===this.session||c===this.session)&&this.disconnect().catch(f)}))}addDebuggingDelegates(e){this.delegates.push(...e)}trace(e,t){E(`[Debug] ${e}: ${t}`)}async onIOPubMessage(e,t){if(ne(`Debug IO Pub message: ${JSON.stringify(t)}`),KG(t)){this.trace("event",JSON.stringify(t));for(let n of this.delegates??[])if(await n?.willSendEvent?.(t.content))return;this.sendMessage.fire(t.content)}}handleMessage(e){this.handleClientMessageAsync(e).catch(f)}async handleClientMessageAsync(e){try{if(ne(`KernelDebugAdapter::handleMessage ${JSON.stringify(e,void 0," ")}`),e.type==="request"&&e.command==="setBreakpoints"){let t=e.arguments;if(t.source&&t.source.path&&t.source.path.indexOf("vscode-notebook-cell:")===0){let n=this.notebookDocument.getCells().find(i=>i.document.uri.toString()===t.source.path);n&&await this.dumpCell(n.index)}}if(e.type==="request")for(let t of this.delegates??[]){let n=await t?.willSendRequest?.(e);if(n){this.trace("response",JSON.stringify(n)),this.sendMessage.fire(n);return}}await this.sendMessageToJupyterSession(e)}catch(t){x(`KernelDebugAdapter::handleMessage failure: ${t}`)}}getConfiguration(){return this.configuration}stepIn(e){return this.session.customRequest("stepIn",{threadId:e})}async debugInfo(){return await this.session.customRequest("debugInfo")}continueDirect(e){if(!this.jupyterSession.kernel)throw new gn;this.jupyterSession.kernel.requestDebug({seq:0,type:"request",command:"continue",arguments:{threadId:e}})}async disconnect(){if(!this.disconnected){if(this.disconnected=!0,this.debugService.activeDebugSession===this.session||this.debugService.activeDebugSession?.id===this.session.id)try{await Promise.all([this.deleteDumpedFiles().catch(e=>j("Error deleting temporary debug files.",e)),this.session.customRequest("disconnect",{restart:!1})])}catch(e){x("Failed to disconnect debug session",e)}this.endSession.fire(this.session)}}dispose(){this.disposables.forEach(e=>e.dispose())}stackTrace(e){return this.session.customRequest("stackTrace",e)}setBreakpoints(e){return this.session.customRequest("setBreakpoints",e)}async dumpAllCells(){await Promise.all(this.notebookDocument.getCells().map(async e=>{e.kind===to.NotebookCellKind.Code&&await this.dumpCell(e.index)}))}lookupCellByLongName(e){if(this.platformService.isWindows){e=In(e);for(let[t,n]of this.fileToCell.entries())if(MG(t)&&OG(t,e))return n}}async sendMessageToJupyterSession(e){if(this.jupyterSession.isDisposed||this.jupyterSession.status==="dead"||!this.jupyterSession.kernel){z(`Skipping sending message ${e.type} because session is disposed`);return}if(this.trace("to kernel",JSON.stringify(e)),e.type==="request"){let t=await this.sendRequestToJupyterSession(e);t&&this.sendMessage.fire(t)}else if(e.type==="response"){t0(e,this.translateRealLocationToDebuggerLocation.bind(this));let t=e;return this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command},!0).done}else x(`Unknown message type to send ${e.type}`)}async sendRequestToJupyterSession(e){if(t0(e,this.translateRealLocationToDebuggerLocation.bind(this)),!this.jupyterSession.kernel)throw new gn;this.trace("to kernel, mapped",JSON.stringify(e));let t=e,o=(await this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command,arguments:t.arguments},!0).done).content;t0(o,this.translateDebuggerLocationToRealLocation.bind(this));for(let s of this.delegates??[])await s?.willSendResponse?.(o);return this.trace("response",JSON.stringify(o)),o}translateDebuggerLocationToRealLocation(e,t){if(t=e?.source??t,t&&t.path){let n=this.fileToCell.get(t.path)??this.lookupCellByLongName(t.path);n&&(t.name=De(n.path),t.path=n.toString())}}async deleteDumpedFiles(){let e=this.getDumpFilesForDeletion();if(this.jupyterSession.kernel&&e.length){let n=`import os as _VSCODE_os
_VSCODE_fileList = [${e.map(i=>'"'+i.replace(/\\/g,"\\\\")+'"').join(",")}]
for file in _VSCODE_fileList:
    try:
        _VSCODE_os.remove(file)
    except:
        pass
del _VSCODE_fileList
del _VSCODE_os`;await vn(this.jupyterSession.kernel,n,{traceErrors:!0,traceErrorsMessage:"Error deleting temporary debugging files"})}}};var o0=class extends hb{constructor(){super(...arguments);this.cellToFile=new Map}async dumpCell(t){let n=this.notebookDocument.cellAt(t);try{let i=await this.session.customRequest("dumpCell",{code:n.document.getText().replace(/\r\n/g,`
`)}),o=In(i.sourcePath);this.fileToCell.set(o,n.document.uri),this.cellToFile.set(n.document.uri.toString(),o)}catch(i){x(i)}}translateRealLocationToDebuggerLocation(t){let n=t.source;if(n&&n.path){let i=this.cellToFile.get(n.path);i&&(n.path=i)}}getDumpFilesForDeletion(){return Array.from(this.cellToFile.values())}};var gb=class extends fb{constructor(t,n,i,o,s,a){super(t,n,a);this.configurationService=i;this.platform=o;this.debugService=s;this.notebookToRunByLineController=new Map;this.runByLineCells=new ir(Ir.RunByLineCells),this.runByLineDocuments=new ir(Ir.RunByLineDocuments),this.debugDocuments=new ir(Ir.DebugDocuments)}activate(){super.activate(),this.disposables.push(xd.debug.registerDebugAdapterDescriptorFactory(US,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return this.notebookToRunByLineController.get(t)?.getMode()}onDidStopDebugging(t){super.onDidStopDebugging(t),this.notebookToRunByLineController.delete(t),this.updateRunByLineContextKeys(),this.updateDebugContextKey()}updateRunByLineContextKeys(){let t=[],n=[];this.notebookToRunByLineController.forEach(i=>{t.push(i.debugCell.document.uri),n.push(i.debugCell.notebook.uri)}),this.runByLineCells.set(t).catch(f),this.runByLineDocuments.set(n).catch(f)}updateDebugContextKey(){let t=new Dc;this.notebookToDebugAdapter.forEach((n,i)=>t.add(i.uri)),this.notebookInProgress.forEach(n=>t.add(n.uri)),this.debugDocuments.set(Array.from(t.values())).catch(f)}async tryToStartDebugging(t,n,i=!1){if(z(`Starting debugging with mode ${t}`),!i){let o=await this.checkIpykernelAndPrompt(n);if(o!==1){z(`Ipykernel check failed: ${AC[o]}`);return}}(t===0||t===1)&&await this.startDebuggingCell(t,n)}runByLineNext(t){let n=this.notebookToRunByLineController.get(t.notebook);n&&n.debugCell.document.uri.toString()===t.document.uri.toString()&&n.continue()}runByLineStop(t){let n=this.notebookToRunByLineController.get(t.notebook);n&&(A("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"withKeybinding"}),n.stop())}async startDebuggingCell(t,n){let i=n.notebook,o=this.configurationService.getSettings(i.uri),s={type:US,name:De(i.uri.toString()),request:"attach",justMyCode:t===1?o.debugJustMyCode:!0,__mode:t,__cellIndex:n.index,__notebookUri:i.uri.toString()},a=t===0?{suppressDebugStatusbar:!0,suppressDebugToolbar:!0,suppressDebugView:!0,suppressSaveBeforeStart:!0}:{suppressSaveBeforeStart:!0};return this.startDebuggingConfig(s,a)}async createDebugAdapterDescriptor(t){let n=t.configuration;NC(n);let i=n.__notebookUri,o=xd.workspace.notebookDocuments.find(s=>s.uri.toString()===i);if(!o){z(`Cannot start debugging. Notebook ${i} not found.`);return}if(this.notebookInProgress.has(o)){z("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(o)){z("Cannot start debugging. Already debugging this notebook document.");return}this.notebookToDebugger.set(o,new mb(o,n,t));try{return this.notebookInProgress.add(o),this.updateDebugContextKey(),await this.doCreateDebugAdapterDescriptor(n,t,o)}finally{this.notebookInProgress.delete(o),this.updateDebugContextKey()}}async doCreateDebugAdapterDescriptor(t,n,i){let o=await this.ensureKernelIsRunning(i);if(o?.session){let s=new o0(n,i,o.session,o,this.platform,this.debugService);if(t.__mode===0&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),c=new n0(s,a,this.kernelProvider.getKernelExecution(o),this.configurationService);s.addDebuggingDelegates([c,new OC(0,s,a,this.serviceContainer)]),this.notebookToRunByLineController.set(i,c),this.updateRunByLineContextKeys()}else if(t.__mode===1&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),c=new r0(s,a,this.kernelProvider.getKernelExecution(o));s.addDebuggingDelegates([c,new OC(1,s,a,this.serviceContainer)])}return this.trackDebugAdapter(i,s),this.updateDebugContextKey(),new xd.DebugAdapterInlineImplementation(s)}else xd.window.showInformationMessage(y.kernelWasNotStarted).then(f,f)}};gb=v([(0,Cu.injectable)(),d(0,(0,Cu.inject)(Ke)),d(1,(0,Cu.inject)(Ct)),d(2,(0,Cu.inject)(le)),d(3,(0,Cu.inject)(Er)),d(4,(0,Cu.inject)(Di)),d(5,(0,Cu.inject)(ut))],gb);var FC=_(O()),LG=require("vscode");var vb=class{constructor(e,t){this.disposableRegistry=t;this.activeTrackers=new WeakMap;this.activeTrackersById=new Map;this.updatedEmitter=new LG.EventEmitter;t.push(e.registerDebugAdapterTrackerFactory("python",this))}createDebugAdapterTracker(e){let t=new pb(e.id);return this.activeTrackers.set(e,t),this.activeTrackersById.set(e.id,t),t.sessionEnded(()=>{this.activeTrackers.delete(e),this.activeTrackersById.delete(e.id)},this,this.disposableRegistry),t.debugLocationUpdated(this.onLocationUpdated,this,this.disposableRegistry),this.onLocationUpdated(),t}get updated(){return this.updatedEmitter.event}getLocation(e){let t=this.activeTrackers.get(e)||this.activeTrackersById.get(e.id);if(t)return t.debugLocation}onLocationUpdated(){this.updatedEmitter.fire()}};vb=v([(0,FC.injectable)(),d(0,(0,FC.inject)(Di)),d(1,(0,FC.inject)(F))],vb);var a0=_(O()),WG=_(require("net"));var VG=_(So()),Ef=require("vscode");var jG=require("events"),UG=`\r
\r
`,s0=class{constructor(){this.rawData=Buffer.concat([]);this.contentLength=-1;this.disposed=!1;this.dataCallbackHandler=e=>{this.handleData(e)};this.events=new jG.EventEmitter}dispose(){this.stream&&(this.stream.removeListener("data",this.dataCallbackHandler),this.stream=void 0)}connect(e){this.stream=e,e.addListener("data",this.dataCallbackHandler)}on(e,t){return this.events.on(e,t),this}once(e,t){return this.events.once(e,t),this}dispatch(e){let t=JSON.parse(e);switch(t.type){case"event":{let n=t;typeof n.event=="string"&&this.events.emit(`${t.type}_${n.event}`,n);break}case"request":{let n=t;typeof n.command=="string"&&this.events.emit(`${t.type}_${n.command}`,n);break}case"response":{let n=t;typeof n.command=="string"&&this.events.emit(`${t.type}_${n.command}`,n);break}default:this.events.emit(`${t.type}`,t)}this.events.emit("data",t)}handleData(e){if(!this.disposed)for(this.rawData=Buffer.concat([this.rawData,e]);;){if(this.contentLength>=0){if(this.rawData.length>=this.contentLength){let t=this.rawData.toString("utf8",0,this.contentLength);this.rawData=this.rawData.slice(this.contentLength),this.contentLength=-1,t.length>0&&this.dispatch(t);continue}}else{let t=this.rawData.indexOf(UG);if(t!==-1){let i=this.rawData.toString("utf8",0,t).split(`\r
`);for(let o of i){let s=o.split(/: +/);s[0]==="Content-Length"&&(this.contentLength=+s[1])}this.rawData=this.rawData.slice(t+UG.length);continue}}break}}};var iL=class{constructor(e,t,n){this._id=e;this._configuration=t;this.customRequestHandler=n;this._name="JupyterDebugSession";}get id(){return this._id}get type(){return"python"}get name(){return this._name}get workspaceFolder(){}get configuration(){return this._configuration}customRequest(e,t){return this.customRequestHandler(e,t)}getDebugProtocolBreakpoint(e){return Promise.resolve(void 0)}},yb=class{constructor(e){this.sequence=1;this.breakpointEmitter=new Ef.EventEmitter;this.debugAdapterTrackerFactories=[];this.debugAdapterTrackers=[];this.sessionChangedEvent=new Ef.EventEmitter;this.sessionStartedEvent=new Ef.EventEmitter;this.sessionTerminatedEvent=new Ef.EventEmitter;this.sessionCustomEvent=new Ef.EventEmitter;this.breakpointsChangedEvent=new Ef.EventEmitter;this._breakpoints=[];e.push(this),this.protocolParser=new s0}dispose(){this.socket&&(this.socket.end(),this.socket=void 0)}get activeDebugSession(){return this.session}get activeDebugConsole(){return{append(e){},appendLine(e){}}}get breakpoints(){return this._breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.breakpointsChangedEvent.event}registerDebugConfigurationProvider(e,t){return{dispose:()=>{}}}registerDebugAdapterTrackerFactory(e,t){return this.debugAdapterTrackerFactories.push(t),{dispose:()=>{this.debugAdapterTrackerFactories=this.debugAdapterTrackerFactories.filter(n=>n!==t)}}}startRunByLine(e){return this.startDebugging(void 0,e)}startDebugging(e,t,n){let i=t;return i.port?(this.session=new iL((0,VG.default)(),i,this.sendCustomRequest.bind(this)),this.sessionChangedEvent.fire(this.session),this.debugAdapterTrackers=this.debugAdapterTrackerFactories.map(o=>o.createDebugAdapterTracker(this.session)),this.socket=WG.createConnection(i.port),this.protocolParser.connect(this.socket),this.protocolParser.on("event_stopped",this.onBreakpoint.bind(this)),this.protocolParser.on("event_output",this.onOutput.bind(this)),this.protocolParser.on("event_terminated",this.sendToTrackers.bind(this)),this.socket.on("error",this.onError.bind(this)),this.socket.on("close",this.onClose.bind(this)),this.sendStartSequence(i,this.session.id).then(()=>!0)):Promise.resolve(!0)}addBreakpoints(e){this._breakpoints=this._breakpoints.concat(e)}removeBreakpoints(e){}get onBreakpointHit(){return this.breakpointEmitter.event}async continue(){await this.sendMessage("continue",{threadId:0}),this.sendToTrackers({type:"event",event:"continue"})}async step(){await this.sendMessage("stepIn",{threadId:this._stoppedThreadId?this._stoppedThreadId:1}),this.sendToTrackers({type:"event",event:"stepIn"})}async getStack(){let e=ue();return this.protocolParser.once("response_stackTrace",t=>{this.sendToTrackers(t);let n=t,i=n.body.stackFrames?n.body.stackFrames:[];e.resolve(i),this._topFrameId=i[0]?.id}),await this.emitMessage("stackTrace",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,startFrame:0,levels:1}),e.promise}async requestVariables(){await this.getStack();let e=ue(),t=0;return this.protocolParser.once("response_scopes",n=>{this.sendToTrackers(n);let i=n;i&&(t=i.body.scopes[0].variablesReference),this.emitMessage("variables",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,variablesReference:t}).catch(f)}),this.protocolParser.once("response_variables",n=>{this.sendToTrackers(n),e.resolve()}),await this.emitMessage("scopes",{frameId:this._topFrameId?this._topFrameId:1}),e.promise}stop(){this.onClose()}sendToTrackers(e){switch(e.type){case"request":this.debugAdapterTrackers.forEach(t=>{t.onWillReceiveMessage&&t.onWillReceiveMessage(e)});break;default:this.debugAdapterTrackers.forEach(t=>t.onDidSendMessage(e));break}}sendCustomRequest(e,t){return this.sendMessage(e,t)}async sendStartSequence(e,t){z("Sending debugger initialize..."),await this.sendInitialize(),this._breakpoints.length>0&&(z("Sending breakpoints"),await this.sendBreakpoints()),z("Sending debugger attach...");let n=this.sendAttach(e,t);return z("Sending configuration done"),await this.sendConfigurationDone(),z("Session started."),n.then(()=>{this.sessionStartedEvent.fire(this.session)})}sendBreakpoints(){let e=this._breakpoints.map(n=>n),t=e[0].location.uri.fsPath;return this.sendMessage("setBreakpoints",{source:{name:De(t),path:t},lines:e.map(n=>n.location.range.start.line),breakpoints:e.map(n=>({line:n.location.range.start.line})),sourceModified:!0})}sendAttach(e,t){return this.sendMessage("attach",{debugOptions:["RedirectOutput","FixFilePathCase","WindowsClient","ShowReturnValue"],workspaceFolder:$o,__sessionId:t,...e})}sendConfigurationDone(){return this.sendMessage("configurationDone")}sendInitialize(){return this.sendMessage("initialize",{clientID:"vscode",clientName:"Visual Studio Code",adapterID:"python",pathFormat:"path",linesStartAt1:!0,columnsStartAt1:!0,supportsVariableType:!0,supportsVariablePaging:!0,supportsRunInTerminalRequest:!0,locale:"en-us"})}sendDisconnect(){return this.sendMessage("disconnect",{})}sendMessage(e,t){let n=ue(),i=this.sessionTerminatedEvent.event(()=>{n.resolve({body:{}})}),o=this.sequence;return this.protocolParser.on(`response_${e}`,s=>{s.request_seq===o&&(this.sendToTrackers(s),z(`Received response from debugger: ${JSON.stringify(t)}`),i.dispose(),n.resolve(s.body))}),this.socket?.on("error",s=>n.reject(s)),this.emitMessage(e,t).catch(s=>{x(`Exception attempting to emit ${e} to debugger: `,s)}),n.promise}emitMessage(e,t){return new Promise((n,i)=>{try{if(this.socket){let o={command:e,arguments:t,type:"request",seq:this.sequence};this.sequence+=1;let s=JSON.stringify(o);z(`Sending request to debugger: ${s}`);let a=`Content-Length: ${s.length}\r
\r
${s}`;this.socket.write(a,c=>{this.sendToTrackers(o),n()})}}catch(o){i(o)}})}onBreakpoint(e){this._stoppedThreadId=e.body.threadId,this.sendToTrackers(e),this.breakpointEmitter.fire()}onOutput(e){this.sendToTrackers(e),z(JSON.stringify(e))}onError(e){this.sendToTrackers(e),z(JSON.stringify(e))}onClose(){this.socket&&(this.sessionTerminatedEvent.fire(this.activeDebugSession),this.session=void 0,this.sessionChangedEvent.fire(void 0),this.debugAdapterTrackers.forEach(e=>e.onExit?e.onExit(0,void 0):void 0),this.debugAdapterTrackers=[],this.sendDisconnect().catch(f),this.socket.destroy(),this.socket=void 0)}};yb=v([(0,a0.injectable)(),d(0,(0,a0.inject)(F))],yb);var ll=_(O()),Pf=require("vscode");var bb=class{constructor(e,t,n){this.vscodeDebugService=t;this.jupyterDebugService=n;this.sessionChangedEvent=new Pf.EventEmitter;this.sessionStartedEvent=new Pf.EventEmitter;this.sessionTerminatedEvent=new Pf.EventEmitter;this.sessionCustomEvent=new Pf.EventEmitter;e.push(t.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(t.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(t.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(t.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))),n&&(e.push(n.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(n.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(n.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(n.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))))}get activeDebugSession(){return this.activeService.activeDebugSession}get activeDebugConsole(){return this.activeService.activeDebugConsole}get breakpoints(){return this.activeService.breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.activeService.onDidChangeBreakpoints}get onBreakpointHit(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.onBreakpointHit}startRunByLine(e){if(this.lastStartedService=this.jupyterDebugService,!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.startRunByLine(e)}registerDebugConfigurationProvider(e,t){let n=this.vscodeDebugService.registerDebugConfigurationProvider(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugConfigurationProvider(e,t);return this.combineDisposables(n,i)}return n}registerDebugAdapterTrackerFactory(e,t){let n=this.vscodeDebugService.registerDebugAdapterTrackerFactory(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugAdapterTrackerFactory(e,t);return this.combineDisposables(n,i)}return n}startDebugging(e,t,n){return this.lastStartedService=this.vscodeDebugService,this.vscodeDebugService.startDebugging(e,t,n)}addBreakpoints(e){return this.activeService.addBreakpoints(e)}removeBreakpoints(e){return this.activeService.removeBreakpoints(e)}getStack(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.getStack();throw new Error("Requesting jupyter specific stack when not debugging.")}step(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.step();throw new Error("Requesting jupyter specific step when not debugging.")}continue(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.continue();throw new Error("Requesting jupyter specific step when not debugging.")}requestVariables(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.requestVariables();throw new Error("Requesting jupyter specific variables when not debugging.")}stop(){this.jupyterDebugService&&this.lastStartedService===this.jupyterDebugService?this.jupyterDebugService.stop():Pf.commands.executeCommand("workbench.action.debug.stop").then(f,f)}get activeService(){return this.lastStartedService?this.lastStartedService:this.vscodeDebugService}combineDisposables(e,t){return{dispose:()=>{e.dispose(),t.dispose()}}}endedDebugSession(e){this.sessionTerminatedEvent.fire(e),this.lastStartedService=void 0}startedDebugSession(e){this.sessionStartedEvent.fire(e)}changedDebugSession(e){this.sessionChangedEvent.fire(e)}gotCustomEvent(e){this.sessionCustomEvent.fire(e)}};bb=v([(0,ll.injectable)(),d(0,(0,ll.inject)(F)),d(1,(0,ll.inject)(Di)),d(2,(0,ll.optional)()),d(2,(0,ll.inject)(Ma)),d(2,(0,ll.named)(Ge.RUN_BY_LINE_DEBUGSERVICE))],bb);var Eu=_(O());var p0=require("vscode");var Ib=Symbol("IFileConverter"),Cd=Symbol("IExportBase"),gIt=Symbol("IExport"),wd=Symbol("IExportUtil");var u0=_(O()),BG=_(require("os"));var qG=_(So());var Sb=require("vscode");var LC=require("vscode");var gye={PDF:["pdf"]},vye={HTML:["html","htm"]},yye={Python:["py"]},Ka=class{async showDialog(e,t,n){let i={},o;switch(e){case"python":i=yye,o=".py";break;case"pdf":o=".pdf",i=gye;break;case"html":o=".html",i=vye;break;case"ipynb":o=".ipynb";let c=y.exportDialogFilter;i[c]=["ipynb"];break;default:return}let s=n||!t?n||"":`${De(t.path,Wi(t.path))}${o}`,a={defaultUri:await this.getDefaultUri(t,s),saveLabel:y.exportButtonTitle,filters:i};return LC.window.showSaveDialog(a)}async getDefaultUri(e,t){if(e&&e.scheme==="untitled"&&Br())return;if(!e||e.scheme==="file"||e.scheme==="untitled"||e.scheme==="vscode-interactive"){let i=Te.instance.get(OP);return LC.Uri.file(Ve(await i.computeWorkingDirectory(e),t))}let n=Ve(pt(e.path),t);return LC.Uri.parse(`${e.scheme}://${n}`).with({authority:e.authority})}};var c0=class{async getContent(e){let t=Sb.extensions.getExtension("vscode.ipynb");if(!t)throw new Error("Unable to export notebook as the built-in vscode.ipynb extension is currently unavailable.");t.isActive||await t.activate();let i=e.getCells().map(s=>{let a=new Sb.NotebookCellData(s.kind,s.document.getText(),s.document.languageId);return a.metadata=s.metadata,a.mime=s.mime,a.outputs=[...s.outputs],a}),o=new Sb.NotebookData(i);return o.metadata=e.metadata,t.exports.exportNotebook(o)}async getTargetFile(e,t,n){return await new Ka().showDialog(e,t,n)}};var l0=require("vscode");var xb=class extends c0{constructor(t){super();this.fs=t}async getTargetFile(t,n,i){let o;return t!=="python"?o=await new Ka().showDialog(t,n,i):o=l0.Uri.file((await this.fs.createTemporaryLocalFile(".py")).filePath),o}};xb=v([(0,u0.injectable)(),d(0,(0,u0.inject)(gr))],xb);var UC=class{async generateTempDir(){let e=l0.Uri.file(Ve(BG.tmpdir(),(0,qG.default)())),t=Te.instance.get(gr);return await t.createDirectory(e),{path:Pe(e),dispose:async()=>{let n=0;for(;n<10;)try{await t.delete(e),n=10}catch{await ji(3e3),n+=1}}}}async makeFileInDirectory(e,t,n){let i=Ve(n,t);return await Te.instance.get(gr).writeFile(l0.Uri.file(i),e),i}};async function JG(r){let e=JSON.parse(r);for(let t of e.cells){let n="outputs"in t?t.outputs:void 0;n&&Array.isArray(n)&&bye(n)}return JSON.stringify(e,void 0,4)}function bye(r){let e="image/svg+xml",t="image/png";for(let n of r)if("data"in n){let i=n.data;if(!(e in i))continue;t in i&&delete i[e]}}var Cb=_(O());var wu=class{constructor(e,t,n){this.dependencyManager=e;this.nbConvertDependencyChecker=t;this.jupyterInterpreterService=n}async getExportInterpreter(e){if(e&&await this.checkNotebookInterpreter(e))return e;let t=await this.jupyterInterpreterService.getSelectedInterpreter();if(t||await this.jupyterInterpreterService.selectInterpreter(),t){if(await this.checkNotebookInterpreter(t))return t;if(await this.dependencyManager.installMissingDependencies(),await this.checkNotebookInterpreter(t))return t}throw new Error(y.jupyterNbConvertNotSupported)}async checkNotebookInterpreter(e){return this.nbConvertDependencyChecker.isNbConvertInstalled(e)}};wu=v([(0,Cb.injectable)(),d(0,(0,Cb.inject)(pp)),d(1,(0,Cb.inject)(ag)),d(2,(0,Cb.inject)(ci))],wu);var kf=class{constructor(e,t,n,i,o,s){this.pythonExecutionFactory=e;this.jupyterService=t;this.fs=n;this.exportUtil=i;this.importer=o;this.exportInterpreterFinder=s}async export(e,t,n,i){}async executeCommand(e,t,n,i,o){if(o.isCancellationRequested)return;if(i=await this.exportInterpreterFinder.getExportInterpreter(i),n==="python"){let h=await this.importer.importFromFile(e.uri,i);await this.fs.writeFile(t,h);return}let s=await this.exportUtil.getContent(e);n==="pdf"&&(s=await JG(s));let a=await new UC().generateTempDir(),c=await this.makeSourceFile(t,s,a),l=await this.getExecutionService(c,i);if(!l||o.isCancellationRequested)return;let u=await this.fs.createTemporaryLocalFile(Wi(t.fsPath)),p=[c.fsPath,"--to",n,"--output",De(u.filePath),"--output-dir",pt(u.filePath),"--debug"],m=await l.execModule("jupyter",["nbconvert"].concat(p),{throwOnStdErr:!1,encoding:"utf8",token:o});if(o.isCancellationRequested){u.dispose();return}try{if((await this.fs.stat(p0.Uri.file(u.filePath))).size>1)await this.fs.copy(p0.Uri.file(u.filePath),t);else throw new Error("File size is zero during conversion. Outputting error.")}catch{throw new Error(m.stderr)}finally{u.dispose()}}async makeSourceFile(e,t,n){let i=De(e.fsPath,Wi(e.fsPath)),o=await new UC().makeFileInDirectory(t,`${i}.ipynb`,n.path);return p0.Uri.file(o)}async getExecutionService(e,t){return this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t})}};v([bv("PerformingExport")],kf.prototype,"executeCommand",1),kf=v([(0,Eu.injectable)(),d(0,(0,Eu.inject)(Kr)),d(1,(0,Eu.inject)(Jp)),d(2,(0,Eu.inject)(gr)),d(3,(0,Eu.inject)(wd)),d(4,(0,Eu.inject)(bP)),d(5,(0,Eu.inject)(wu))],kf);var _f=_(O());var Pu=require("vscode");var wb=class{constructor(){this.fs=Te.instance.get(st)}async openFile(e,t,n=!1){if(e==="python")await this.openPythonFile(t,n),A("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:!0});else{let i=await this.askOpenFile(t,n);A("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:i})}}async openPythonFile(e,t){let n;if(t)n=await Pu.window.showTextDocument(e);else{let i=await this.fs.readFile(e);await this.fs.delete(e);let o=await Pu.workspace.openTextDocument({language:xe,content:i});n=await Pu.window.showTextDocument(o)}await n.edit(i=>{i.insert(new Pu.Position(n.document.lineCount,0),`
`)})}async askOpenFile(e,t){let n=y.openExportFileYes,i=y.openExportFileNo,o=[n,i];return await Pu.window.showInformationMessage(y.openExportedFileMessage,...o).then(a=>a)===n?(t?Pu.window.showTextDocument(e).then(f,f):Rg(e.toString()),!0):!1}};var g0=_(O()),v0=require("vscode");var d0=class{async export(e,t,n,i){await Te.instance.get(Cd).executeCommand(e,t,"python",n,i)}};var m0=class{async export(e,t,n,i){await Te.instance.get(Cd).executeCommand(e,t,"pdf",n,i)}};var f0=class{async export(e,t,n,i){await Te.instance.get(Cd).executeCommand(e,t,"html",n,i)}};var oL=require("vscode");var h0=class{constructor(){this.fs=Te.instance.get(st),this.configuration=Te.instance.get(le),this.platform=Te.instance.get(Er)}async writeFile(e,t){await this.fs.writeFile(e,t)}getEOL(){return this.platform.isWindows?`\r
`:`
`}async export(e,t,n){if(n.isCancellationRequested)return;let i=this.exportDocument(e);await this.writeFile(t,i)}exportDocument(e){return e.getCells().filter(t=>!t.metadata.custom?.metadata?.isInteractiveWindowMessageCell).reduce((t,n)=>t+this.exportCell(n),"")}exportCell(e){if(e.document.lineCount){let t=this.cellMarker(e),n=this.getEOL();switch(e.kind){case oL.NotebookCellKind.Code:return`${t}${n}${this.exportCodeCell(e)}${n}${n}`;case oL.NotebookCellKind.Markup:return`${t} [markdown]${n}${this.exportMarkdownCell(e)}${n}${n}`}}return""}exportCodeCell(e){let t=Fe(e.document.getText(),{trim:!1,removeEmptyEntries:!1}),n=this.configuration.getSettings(e.notebook.uri).pythonExportMethod==="commentMagics";return Ic(t,this.getEOL(),n?Iye:void 0).join("")}exportMarkdownCell(e){let t=Fe(e.document.getText(),{trim:!1,removeEmptyEntries:!1});return Ic(t,this.getEOL(),Sye).join("")}cellMarker(e){let t=this.configuration.getSettings(e.notebook.uri);return e.metadata.interactiveWindowCellMarker??t.defaultCellMarker}};function Iye(r){return/^\s*!/.test(r)||/^\s*%/.test(r)?`# ${r}`:r}function Sye(r){return`# ${r}`}var Eb=class{constructor(e,t,n){this.exportUtil=e;this.progressReporter=t;this.configuration=n}async importIpynb(e){let t=this.progressReporter.createProgressIndicator(y.importingIpynb,!0);try{let n=await v0.workspace.openNotebookDocument(e);await this.exportImpl("python",n,void 0,t.token)}finally{t.dispose()}}async export(e,t,n,i){let o=this.progressReporter.createProgressIndicator(y.exportingToFormat(e.toString()),!0);try{await this.exportImpl(e,t,n,o.token,i)}finally{o.dispose()}if(o.token.isCancellationRequested){A("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,cancelled:!0});return}}async exportImpl(e,t,n,i,o){try{let s=await this.exportUtil.getTargetFile(e,t.uri,n);if(!s)return;await this.performExport(e,t,s,i,o)}catch(s){x("Export failed",s),A("DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",void 0,{format:e}),e==="pdf"&&x(y.exportToPDFDependencyMessage),this.showExportFailed(y.exportFailedGeneralMessage)}}async performExport(e,t,n,i,o){e==="python"&&this.configuration.getSettings(t.uri).pythonExportMethod!=="nbconvert"?await this.performPlainExport(e,t,n,i):await this.performNbConvertExport(t,e,n,o,i),n&&this.openExportedFile(e,n).catch(f)}async openExportedFile(e,t){await new wb().openFile(e,t,!0).catch(f)}async performPlainExport(e,t,n,i){if(n)switch(e){case"python":await new h0().export(t,n,i);break}return n}async performNbConvertExport(e,t,n,i,o){try{return await this.exportToFormat(e,n,t,i,o)}finally{}}async exportToFormat(e,t,n,i,o){switch(n){case"python":return new d0().export(e,t,i,o);case"pdf":return new m0().export(e,t,i,o);case"html":return new f0().export(e,t,i,o);default:break}}showExportFailed(e){v0.window.showErrorMessage(`${y.failedExportMessage} ${e}`)}};Eb=v([d(0,(0,g0.inject)(wd)),d(1,(0,g0.inject)(Go)),d(2,(0,g0.inject)(le))],Eb);var Pb=class extends Eb{constructor(t,n,i,o){super(t,i,o);this.exportUtil=t;this.fs=n}async openExportedFile(t,n){await new wb().openFile(t,n).catch(f)}};Pb=v([(0,_f.injectable)(),d(0,(0,_f.inject)(wd)),d(1,(0,_f.inject)(gr)),d(2,(0,_f.inject)(Go)),d(3,(0,_f.inject)(le))],Pb);var _b=_(O());var Df=require("vscode");var kb=class{constructor(e,t,n){this.configService=e;this.fs=t;this.registry=n;this.priority=0}activate(){this.registry.register(this,bt)}async getCode(e){let t=await this.getWorkingDirectory(e);return t?Fe(Ja(qa.UpdateCWDAndPath,Pe(t)),{trim:!1}):[]}async getWorkingDirectory(e){if(!dt(e.kernelConnectionMetadata)&&!mP(e.kernelConnectionMetadata)||!_t(e.kernelConnectionMetadata))return;let t=await this.calculateWorkingDirectory(e.resourceUri);if(t&&await this.fs.exists(t))return t;if(e.resourceUri&&e.resourceUri.scheme!=="untitled"&&await this.fs.exists(e.resourceUri)&&(t=Df.Uri.file(zh(Pe(t),e.resourceUri,this.configService.getSettings(e.resourceUri))),t&&await this.fs.exists(t)))return t}async calculateWorkingDirectory(e){let t,n=this.configService.getSettings(e),i=Tk(n.notebookFileRoot);if(i&&Df.workspace.workspaceFolders?.length){let o=Df.Uri.file(i),s=Df.workspace.workspaceFolders[0].uri;if(fh(i))await this.fs.exists(o)?t=o:t=s;else if(i.includes("${"))t=o;else{let a=Df.Uri.joinPath(s,i);await this.fs.exists(a)?t=a:t=s}}return t}};kb=v([(0,_b.injectable)(),d(0,(0,_b.inject)(le)),d(1,(0,_b.inject)(st)),d(2,(0,_b.inject)(Fo))],kb);var WC=_(O()),Tf=require("vscode");var jC=require("vscode");var sL=new WeakMap;async function qs(r,e){let t=r;if(r.isClosed)return!0;let n=sL.has(t)?sL.get(t):Promise.resolve(),i=ue(),o=n.finally(async()=>{let s=new jC.WorkspaceEdit,a=e(s);Zd(a)&&await a,await jC.workspace.applyEdit(s).then(c=>i.resolve(c),c=>i.reject(c))}).catch(f);return sL.set(t,o),i.promise}var Db=class{constructor(e,t){this.disposables=e;this.controllerRegistration=t}activate(){this.controllerRegistration.onControllerSelected(this.onDidChangeNotebookController,this,this.disposables)}async onDidChangeNotebookController(e){let t=e.notebook,n=e.controller.connection;if(!Tt(t))return;let i=Tf.window.visibleNotebookEditors.find(u=>u.notebook===t);if(!i)return;let o=t.getCells().filter(u=>u.kind===Tf.NotebookCellKind.Code&&u.document.getText().trim().length===0),s=t.getCells().filter(u=>u.kind===Tf.NotebookCellKind.Code).length;if(o.length===0||o.length!==s)return;let a,c=n.kind;switch(n.kind){case"connectToLiveRemoteKernel":{a=n.kernelModel.language;break}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":{a=n.kernelSpec.language;break}case"startUsingPythonInterpreter":{a=xe;break}default:{x(`Unsupported kernel kind encountered ${c}`);return}}if(!a)return;let l=yc(a);qs(i.notebook,async()=>{await o.map(async u=>{if(l.toLowerCase()!==u.document.languageId)return Tf.languages.setTextDocumentLanguage(u.document,l).then(f,f)})}).then(f,f)}};Db=v([(0,WC.injectable)(),d(0,(0,WC.inject)(F)),d(1,(0,WC.inject)(Ct))],Db);var Fa=_(O()),Jt=require("vscode");var Tb=class{constructor(e,t,n,i,o,s,a,c){this.disposableRegistry=e;this.languageService=t;this.configurationService=n;this.kernelProvider=i;this.controllerRegistration=o;this.errorHandler=s;this.notebookEditorProvider=a;this.serviceContainer=c;this.kernelInterruptedDontAskToRestart=!1;this.pendingRestartInterrupt=new WeakMap}register(){this.disposableRegistry.push(Jt.commands.registerCommand($.NotebookEditorRemoveAllCells,()=>this.removeAllCells())),this.disposableRegistry.push(Jt.commands.registerCommand($.NotebookEditorRunAllCells,()=>this.runAllCells())),this.disposableRegistry.push(Jt.commands.registerCommand($.NotebookEditorAddCellBelow,()=>this.addCellBelow())),this.disposableRegistry.push(Jt.commands.registerCommand($.NotebookEditorCollapseAllCells,()=>this.collapseAll())),this.disposableRegistry.push(Jt.commands.registerCommand($.NotebookEditorExpandAllCells,()=>this.expandAll())),this.disposableRegistry.push(Jt.commands.registerCommand($.RestartKernelAndRunUpToSelectedCell,()=>this.restartKernelAndRunUpToSelectedCell())),this.disposableRegistry.push(Jt.commands.registerCommand($.RestartKernel,e=>e&&"notebookEditor"in e?this.restartKernel(e?.notebookEditor?.notebookUri).catch(f):this.restartKernel(e).catch(f))),this.disposableRegistry.push(Jt.commands.registerCommand($.InterruptKernel,e=>this.interruptKernel(e?.notebookEditor?.notebookUri))),this.disposableRegistry.push(Jt.commands.registerCommand($.RestartKernelAndRunAllCells,e=>{e&&"notebookEditor"in e?this.restartKernelAndRunAllCells(e?.notebookEditor?.notebookUri).catch(f):this.restartKernelAndRunAllCells(e).catch(f)}))}runAllCells(){Jt.window.activeNotebookEditor&&Jt.commands.executeCommand("notebook.execute").then(f,f)}addCellBelow(){Jt.window.activeNotebookEditor&&Jt.commands.executeCommand("notebook.cell.insertCodeCellBelow").then(f,f)}removeAllCells(){let e=Jt.window.activeNotebookEditor?.notebook;if(!e)return;let t=this.languageService.getPreferredLanguage(lo(e));qs(e,n=>{let i=Jt.NotebookEdit.replaceCells(new Jt.NotebookRange(0,e.cellCount),[new Jt.NotebookCellData(Jt.NotebookCellKind.Code,"",t)]);n.set(e.uri,[i])}).then(f,f)}collapseAll(){let e=Jt.window.activeNotebookEditor?.notebook;e&&qs(e,t=>{e.getCells().forEach((n,i)=>{let o={...n.metadata||{},inputCollapsed:!0,outputCollapsed:!0};t.set(e.uri,[Jt.NotebookEdit.updateCellMetadata(i,o)])})}).then(f,f)}expandAll(){let e=Jt.window.activeNotebookEditor?.notebook;e&&qs(e,t=>{e.getCells().forEach((n,i)=>{let o={...n.metadata||{},inputCollapsed:!1,outputCollapsed:!0};t.set(e.uri,[Jt.NotebookEdit.updateCellMetadata(i,o)])})}).then(f,f)}async interruptKernel(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,n=Jt.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(n===void 0)return;E(`Command interrupted kernel for ${W(n.uri)}`);let i=this.kernelProvider.get(n);if(!i){z("Interrupt requested & no kernel.");return}await this.wrapKernelMethod("interrupt",i)}async restartKernelAndRunAllCells(e){await this.restartKernel(e),this.runAllCells()}async restartKernelAndRunUpToSelectedCell(){let e=this.notebookEditorProvider.activeNotebookEditor;e&&(await this.restartKernel(e.notebook.uri),Jt.commands.executeCommand("notebook.cell.execute",{ranges:[{start:0,end:e.selection.end}],document:e.notebook.uri}).then(f,f))}async restartKernel(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,n=Jt.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(n===void 0)return;let i=this.kernelProvider.get(n);if(i)if(E(`Restart kernel command handler for ${W(n.uri)}`),await this.shouldAskForRestart(n.uri)){let o=y.restartKernelMessage,s=y.restartKernelMessageYes,a=y.restartKernelMessageDontAskAgain,c=await Jt.window.showInformationMessage(o,{modal:!0},s,a);c===a?(await this.disableAskForRestart(n.uri),this.wrapKernelMethod("restart",i).catch(f)):c===s&&this.wrapKernelMethod("restart",i).catch(f)}else this.wrapKernelMethod("restart",i).catch(f)}async wrapKernelMethod(e,t){let n=t.notebook,i=this.pendingRestartInterrupt.get(t);if(i)return i;let o=(async()=>{let s=this.kernelProvider.getKernelExecution(t).pendingCells[0],a=this.controllerRegistration.getSelected(n);try{if(!a)throw new Error("No kernel associated with the notebook");await Vs.wrapKernelMethod(a.connection,e,t.creator,this.serviceContainer,{resource:t.resourceUri,notebook:n,controller:a.controller},new Yt(!1),this.disposableRegistry)}catch(c){s?await ap(s,t.controller,await this.errorHandler.getErrorMessageForDisplayInCell(c,e,t.resourceUri),!1):Jt.window.showErrorMessage(c.toString()).then(f,f)}})();return o.finally(()=>{this.pendingRestartInterrupt.get(t)===o&&this.pendingRestartInterrupt.delete(t)}).catch(f),this.pendingRestartInterrupt.set(t,o),o}async shouldAskForRestart(e){if(this.kernelInterruptedDontAskToRestart)return!1;let t=this.configurationService.getSettings(e);return t&&t.askForKernelRestart===!0}async disableAskForRestart(e){this.configurationService.getSettings(e)&&this.configurationService.updateSetting("askForKernelRestart",!1,void 0,Jt.ConfigurationTarget.Global).catch(f)}};Tb=v([(0,Fa.injectable)(),d(0,(0,Fa.inject)(F)),d(1,(0,Fa.inject)(os)),d(2,(0,Fa.inject)(le)),d(3,(0,Fa.inject)(Ke)),d(4,(0,Fa.inject)(Ct)),d(5,(0,Fa.inject)(Yr)),d(6,(0,Fa.inject)(mi)),d(7,(0,Fa.inject)(ut))],Tb);var $G=_(O()),Ed=require("vscode");var Rb=class{constructor(){this.providers=new Set}registerEmbedNotebookProvider(e){this.providers.add(e)}findNotebookEditor(e){let t=e?fn(e,!0):"false",n=Hi(e)==="notebook"?Ed.workspace.notebookDocuments.find(o=>fn(o.uri,!0)===t):void 0,i=n&&Ed.window.activeNotebookEditor?.notebook===n?Ed.window.activeNotebookEditor:void 0;if(i)return i;for(let o of this.providers){let s=o.findNotebookEditor(e);if(s)return s}}get activeNotebookEditor(){return this.findNotebookEditor(Ed.window.activeNotebookEditor?.notebook.uri)||this.findNotebookEditor(Ed.window.activeTextEditor?.document.uri)}findAssociatedNotebookDocument(e){let t=qr()==="Windows",n=Ed.workspace.notebookDocuments.find(i=>t?i.uri.path.toLowerCase()===e.path.toLowerCase():i.uri.path===e.path);if(n)return n;for(let i of this.providers){let o=i.findAssociatedNotebookDocument(e);if(o)return o}}};Rb=v([(0,$G.injectable)()],Rb);var y0=_(O()),Pd=require("vscode");var Ab=class{constructor(e){this.sentMimeTypes=new Set;this.disposables=[];e.push(this)}get isTelemetryDisabled(){return TE()}activate(){Pd.workspace.onDidOpenNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Pd.workspace.onDidCloseNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Pd.workspace.onDidSaveNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Pd.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}dispose(){Q(this.disposables)}async onDidChangeNotebookCellExecutionState(e){!Tt(e.cell.notebook)||this.isTelemetryDisabled||this.checkCell(e.cell,"onExecution")}onDidOpenCloseDocument(e){!Tt(e)||this.isTelemetryDisabled||e.getCells().forEach(t=>this.checkCell(t,"onOpenCloseOrSave"))}checkCell(e,t){if(e.kind===Pd.NotebookCellKind.Markup||e.document.languageId==="raw")return;let n=e.notebook.notebookType===bt?"notebook":"interactive";e.outputs.map(i=>i.items.map(o=>o.mime)).flat().map(i=>this.sendTelemetry(i,t,n))}sendTelemetry(e,t,n){let i=`${e}-${t}`;this.sentMimeTypes.has(i)||(this.sentMimeTypes.add(i),e=e.replace(/\//g,"_").replace(/\\/g,"_"),A("DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",void 0,{mimeType:e,when:t,resourceType:n}))}};Ab=v([(0,y0.injectable)(),d(0,(0,y0.inject)(F))],Ab);var b0=_(O());var xye=/(;32m[ ->]*?)(\d+)(.*)/g,Nb=class{constructor(e){this.configurationService=e}format(e,t){return e.notebook.notebookType!==bt?t:t.map(n=>this.modifyTracebackFrameIPython(e,n))}modifyTracebackFrameIPython(e,t){return(this.configurationService.getSettings(e.document.uri)?.formatStackTraces??!1)&&/^[Cell|Input|File].*?\n.*/.test(t)?this.modifyTracebackFrameIPython8(e,t):t}modifyTracebackFrameIPython8(e,t){t=t.replace(/\u001b\[4\dm/g,""),t=t.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),t=t.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(s,a,c,l)=>(l=l.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${a}${c}${l}
`)),ne(`Trace frame to match: ${t}`);let n=(s,a)=>{let c=s.replace(xye,(u,p,m,h)=>{let g=parseInt(m,10);return`${p}<a href='${e.document.uri.toString()}?line=${g-1}'>${g}</a>${h}`}),l=y.cellAtFormat(Pe(e.document.uri),e.index+1);return c.replace(/.*?\n/,`\x1B[1;32m${l}\x1B[0m line \x1B[0;36m${a}
`)},i=/^Input.*?\[.*32mIn\s+\[(\d+).*?0;36m(.*?)\n.*/.exec(t);if(i&&i.length>1)return n(t,i[2]);let o=/Cell.*?\[.*32mIn\s*\[(\d+)\]\,\s+line\s+([(\d+)])(.*?)\n.*/gm.exec(t);return o&&o.length>1?n(t,o[2]):t}};Nb=v([(0,b0.injectable)(),d(0,(0,b0.inject)(le))],Nb);var Js=_(O()),HG=require("vscode");var Mb=class{constructor(e,t,n,i,o,s,a){this.packages=e;this.installer=t;this.pythonExtensionChecker=n;this.disposables=i;this.interpreterService=o;this.apiProvider=s;this.notebookControllerManager=a}activate(){this.notebookControllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables),Br()||this.interpreterService.onDidChangeInterpreter(this.trackPackagesOfActiveInterpreter,this,this.disposables),this.installer?.onInstalled(this.onDidInstallPackage,this,this.disposables),HG.extensions.onDidChange(this.trackUponActivation,this,this.disposables),this.trackUponActivation().catch(f),this.apiProvider.onDidActivatePythonExtension(this.trackUponActivation,this,this.disposables)}async onNotebookControllerSelected(e){e.controller.connection.interpreter&&(await Zi(e.notebook.uri,{kernelConnection:e.controller.connection}),await this.packages.trackPackages(e.controller.connection.interpreter))}async trackUponActivation(){this.activeInterpreterTrackedUponActivation||this.pythonExtensionChecker.isPythonExtensionActive&&(this.activeInterpreterTrackedUponActivation=!0,await this.trackPackagesOfActiveInterpreter())}async trackPackagesOfActiveInterpreter(){if(!this.pythonExtensionChecker.isPythonExtensionActive)return;let e=await this.interpreterService.getActiveInterpreter(void 0);e&&await this.packages.trackPackages(e)}async onDidInstallPackage(e){if(this.pythonExtensionChecker.isPythonExtensionActive)if(Wu(e.resource)){let t=await this.interpreterService.getActiveInterpreter(e.resource);await this.packages.trackPackages(t,!0)}else await this.packages.trackPackages(e.resource,!0)}};Mb=v([(0,Js.injectable)(),d(0,(0,Js.inject)(Lp)),d(1,(0,Js.inject)(Ni)),d(1,(0,Js.optional)()),d(2,(0,Js.inject)(ze)),d(3,(0,Js.inject)(F)),d(4,(0,Js.inject)(tt)),d(5,(0,Js.inject)(Gt)),d(6,(0,Js.inject)(Ct))],Mb);function GG(r,e){TG(r,e),r.addSingleton(be,df),r.addSingleton(Ih,Tb),r.addSingleton(mi,Rb),r.addSingleton(be,hf),r.addSingleton(Qh,Nb),r.addSingleton(Ma,yb,Ge.RUN_BY_LINE_DEBUGSERVICE),r.addSingleton(dd,dd),r.addBinding(dd,be),r.addSingleton(be,Qy),r.addSingleton(be,Mb),r.addSingleton(be,$y),r.addSingleton(os,os),r.addBinding(os,be),r.addSingleton(be,Db),r.addSingleton(Sd,gb,void 0,[be]),r.addSingleton(be,ub),r.addSingleton(Rn,db,Ge.DEBUGGER_VARIABLES),r.addSingleton(Ma,bb,Ge.MULTIPLEXING_DEBUGSERVICE),r.addSingleton(YT,vb,void 0,[QT]),r.addSingleton(be,lb),r.addSingleton(be,Ab),r.addSingleton(be,kb),r.addSingleton(Ib,Pb),r.addSingleton(wu,wu),r.addSingleton(Cd,kf),r.addSingleton(wd,xb)}var Sn=_(O()),Je=require("vscode");var kd=Symbol("IDataScienceCodeLensProvider"),I0=Symbol("ICodeWatcher"),S0=Symbol("ICodeLensFactory"),_wt=Symbol("IGeneratedCodeStore"),$s=Symbol("IGeneratedCodeStorageFactory"),Ob=Symbol("ICodeGeneratorFactory");var x0=Symbol("IInteractiveWindowDebugger"),Oi=Symbol("IInteractiveWindowProvider"),C0=Symbol("IInteractiveControllerHelper"),w0=Symbol("IInteractiveWindowDebuggingManager");var E0=require("vscode");async function P0(r){let e=await E0.workspace.openNotebookDocument(r);await E0.window.showNotebookDocument(e)}var BC=require("vscode");var fi=class{constructor(e){this.codeMatchRegEx=this.createRegExp(e?e.codeRegularExpression:void 0,Yd.PythonCellMarker),this.markdownMatchRegEx=this.createRegExp(e?e.markdownRegularExpression:void 0,Yd.PythonMarkdownCellMarker),this.codeExecRegEx=new RegExp(`${this.codeMatchRegEx.source}(.*)`),this.markdownExecRegEx=new RegExp(`${this.markdownMatchRegEx.source}(.*)`),this.defaultCellMarker=e?.defaultCellMarker?e.defaultCellMarker:"# %%"}isCell(e){return this.isCode(e)||this.isMarkdown(e)}isMarkdown(e){return this.markdownMatchRegEx.test(e.trim())}isCode(e){return this.codeMatchRegEx.test(e.trim())||e.trim()===this.defaultCellMarker}getCellType(e){return this.isMarkdown(e)?"markdown":"code"}isEmptyCell(e){return this.stripFirstMarker(e).trim().length===0}stripFirstMarker(e){let t=Fe(e,{trim:!1,removeEmptyEntries:!1});return t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0]))?t.slice(1).join(`
`):e}stripFirstMarkerNoConcat(e){return e.length>0&&(this.isCode(e[0])||this.isMarkdown(e[0]))?e.slice(1):e}getFirstMarker(e){let t=Fe(e,{trim:!1,removeEmptyEntries:!1});if(t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0])))return t[0]}createRegExp(e,t){try{if(e)return new RegExp(e)}catch{}return t}};var ss=require("vscode");function zG(r,e){let t=mt(r);return t?e==1?y.restartingKernelCustomHeader(t):y.startingNewKernelCustomHeader(t):e==1?y.restartingKernelHeader:y.startingNewKernelHeader}function QG(r,e){let t=mt(r);return e==1?y.restartedKernelHeader(t||""):y.connectedKernelHeader(t||"")}function VC(r){return r.kind===ss.NotebookCellKind.Markup&&r.metadata.custom?.metadata&&r.metadata.custom.metadata.isInteractiveWindowMessageCell}var k0=class{constructor(e,t){this.notebookDocument=e;this.isDeleted=!1;if(e.cellCount){let n=e.cellAt(e.cellCount);VC(n)&&(this.sysInfoCellPromise=Promise.resolve(n),this.sysInfoCellPromise=this.updateMessage(t))}this.sysInfoCellPromise===void 0&&(this.sysInfoCellPromise=this.createCell(t))}async createCell(e){let t;return await qs(this.notebookDocument,n=>{let i=new ss.NotebookCellData(ss.NotebookCellKind.Markup,e,hS);i.metadata={custom:{metadata:{isInteractiveWindowMessageCell:!0}}},t=this.notebookDocument.cellCount;let o=ss.NotebookEdit.insertCells(t,[i]);n.set(this.notebookDocument.uri,[o])}),t=t??this.notebookDocument.cellCount-1,this.notebookDocument.cellAt(t)}async updateMessage(e){let t=await this.sysInfoCellPromise;return await qs(this.notebookDocument,n=>{if(t.index>=0&&!this.isDeleted&&VC(t)){n.replace(t.document.uri,new ss.Range(0,0,t.document.lineCount,0),e),n.set(this.notebookDocument.uri,[ss.NotebookEdit.updateCellMetadata(t.index,{custom:{metadata:{isInteractiveWindowMessageCell:!0}}})]);return}}),t}async deleteCell(){this.isDeleted=!0;let e=await this.sysInfoCellPromise;await qs(this.notebookDocument,t=>{if(e.index>=0&&VC(e)){let n=ss.NotebookEdit.deleteCells(new ss.NotebookRange(e.index,e.index+1));t.set(this.notebookDocument.uri,[n]);return}})}};function wye(r,e){let t=typeof e=="boolean"?e:!1,n=typeof e=="boolean"?[]:e||[];r=r||"";let i=Array.isArray(r)?Ic(r,`
`,t?Kb:void 0):r;return{cell_type:"code",execution_count:null,metadata:{},outputs:n,source:i}}function Eye(r,e=!1){return r=Array.isArray(r)?r:[r],{cell_type:"markdown",metadata:{},source:e?r:eP(r)}}function Kb(r){return/^#\s*!/.test(r)?/^#\s*!\s*%%?/.test(r)?r.replace(/^#\s*!\s*/,""):r.replace(/^#\s*/,""):r}function YG(r,e,t){return{data:wye(r,t),uri:e}}function XG(r,e,t=!1){return{uri:e,data:Eye(r,t)}}function Pye(r,e,t,n){let i=Fe(e,{trim:!1}),o=i[0],s=new fi(r),{magicCommandsAsComments:a=!1}=r||{};if(s.isMarkdown(o)){let c=-1;return mm(i,(l,u)=>void 0,(l,u)=>{l&&l.length>0&&c===-1&&(c=n?u:-1)}),c>=0?[XG(i.slice(0,c),t),YG(i.slice(c),t,a)]:[XG(i,t)]}else return[YG(i,t,a)]}function ZG(r,e){let t=new fi(e);for(let n=0;n<r.lineCount;n+=1){let i=r.lineAt(n);if(t.isCell(i.text))return!0}return!1}function qC(r,e){let t=new fi(e),n=[];for(let i=0;i<r.lineCount;i+=1){let o=r.lineAt(i);if(t.isCell(o.text)){if(n.length>0){let s=n[n.length-1];s.range=new BC.Range(s.range.start,r.lineAt(i-1).range.end)}n.push({range:o.range,cell_type:t.getCellType(o.text)})}}if(n.length>=1){let i=r.lineAt(r.lineCount-1),o=n[n.length-1];o.range=new BC.Range(o.range.start,i.range.end)}return n}function aL(r,e){let t=qC(r,e);return Array.prototype.concat(...t.map(n=>{let i=r.getText(n.range);return Pye(e,i,r.uri,!1)}))}function ez(r,e){return r.getCells().filter(t=>!VC(t)).map(t=>{let n=Fe(t.document.getText(),{trim:!1,removeEmptyEntries:!1});t.metadata.interactiveWindowCellMarker!==void 0&&n.unshift(t.metadata.interactiveWindowCellMarker+`
`);let i=iP(t);return i.source=t.kind===BC.NotebookCellKind.Code?Ic(n,`
`,e?Kb:void 0):Ic(n),{data:i,file:""}})}var JC=require("vscode");var cL=class{constructor(e,t,n){this.disposed=!1;this.dispose=()=>{this.disposed||(this.disposed=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.disposeCallback(),this.deferred.completed||this.deferred.resolve())};this.promise=()=>this.deferred.promise;this.reject=()=>{this.deferred.reject(),this.dispose()};this.deferred=ue(),this.disposeCallback=t,n&&(this.timeout=setTimeout(this.dispose,n))}},_0=class{constructor(){this.statusCount=0;this.incrementCount=()=>{this.statusCount+=1};this.decrementCount=()=>{let e=this.statusCount-1;this.statusCount=Math.max(e,0)}}set(e,t,n){this.incrementCount();let i=new cL(e,()=>this.decrementCount(),t),o={location:n?JC.ProgressLocation.Notification:JC.ProgressLocation.Window,title:e,cancellable:n!==void 0};return JC.window.withProgress(o,(s,a)=>(a&&n&&a.onCancellationRequested(()=>{n(),i.reject()}),i.promise())).then(f,f),i}async waitWithStatus(e,t,n,i){let o=this.set(t,n,i),s;try{s=await e()}finally{o.dispose()}return s}};var Do=class{constructor(e,t,n,i,o,s,a,c,l,u,p,m,h){this.disposables=e;this.jupyterExporter=t;this.jupyterServerHelper=n;this.fileSystem=i;this.configuration=o;this.dataScienceCodeLensProvider=s;this.debugService=a;this.configService=c;this.interactiveWindowProvider=l;this.kernelProvider=u;this.dataScienceErrorHandler=p;this.ipynbProvider=m;this.fileConverter=h;this.statusProvider=new _0,Je.workspace.isTrusted||Je.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted(),this.registerCommand($.InsertCellBelowPosition,this.insertCellBelowPosition),this.registerCommand($.InsertCellBelow,this.insertCellBelow),this.registerCommand($.InsertCellAbove,this.insertCellAbove),this.registerCommand($.DeleteCells,this.deleteCells),this.registerCommand($.SelectCell,this.selectCell),this.registerCommand($.SelectCellContents,this.selectCellContents),this.registerCommand($.ExtendSelectionByCellAbove,this.extendSelectionByCellAbove),this.registerCommand($.ExtendSelectionByCellBelow,this.extendSelectionByCellBelow),this.registerCommand($.MoveCellsUp,this.moveCellsUp),this.registerCommand($.MoveCellsDown,this.moveCellsDown),this.registerCommand($.ChangeCellToMarkdown,this.changeCellToMarkdown),this.registerCommand($.ChangeCellToCode,this.changeCellToCode),this.registerCommand($.GotoNextCellInFile,this.gotoNextCellInFile),this.registerCommand($.GotoPrevCellInFile,this.gotoPrevCellInFile),this.registerCommand($.AddCellBelow,this.addCellBelow),this.registerCommand($.CreateNewNotebook,this.createNewNotebook),this.registerCommand($.LatestExtension,this.openPythonExtensionPage),this.registerCommand($.EnableDebugLogging,this.enableDebugLogging),this.registerCommand($.ResetLoggingLevel,this.resetLoggingLevel),this.registerCommand($.EnableLoadingWidgetsFrom3rdPartySource,this.enableLoadingWidgetScriptsFromThirdParty),this.registerCommand($.CreateNewInteractive,e=>this.createNewInteractiveWindow(e)),this.registerCommand($.ImportNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>e?this.importNotebookOnFile(e):this.importNotebook())),this.registerCommand($.ImportNotebookFile,(e,t="commandpalette")=>this.listenForErrors(()=>e?this.importNotebookOnFile(e):this.importNotebook())),Je.commands.registerCommand($.ExportFileAsNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>{if(e)return this.exportFile(e);{let n=Je.window.activeTextEditor;if(n&&n.document.languageId===xe)return this.exportFile(n.document.uri)}return Promise.resolve()})),this.registerCommand($.ExportFileAndOutputAsNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>{if(e)return this.exportFileAndOutput(e);{let n=Je.window.activeTextEditor;if(n&&n.document.languageId===xe)return this.exportFileAndOutput(n.document.uri)}return Promise.resolve()})),this.registerCommand($.ExpandAllCells,async e=>this.expandAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand($.CollapseAllCells,async e=>this.collapseAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand($.ExportOutputAsNotebook,()=>this.exportCells()),this.registerCommand($.InteractiveExportAsNotebook,e=>this.export(e?.notebookEditor?.notebookUri)),this.registerCommand($.InteractiveExportAs,e=>this.exportAs(e?.notebookEditor?.notebookUri)),this.registerCommand($.ScrollToCell,(e,t)=>this.scrollToCell(e,t)),this.registerCommand($.InteractiveClearAll,this.clearAllCellsInInteractiveWindow),this.registerCommand($.InteractiveGoToCode,this.goToCodeInInteractiveWindow),Je.commands.registerCommand($.InteractiveCopyCell,this.copyCellInInteractiveWindow)}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){Je.workspace.isTrusted&&(this.registerCommand($.RunAllCells,this.runAllCells),this.registerCommand($.RunCell,this.runCell),this.registerCommand($.RunCurrentCell,this.runCurrentCell),this.registerCommand($.RunCurrentCellAdvance,this.runCurrentCellAndAdvance),this.registerCommand($.ExecSelectionInInteractiveWindow,e=>{this.runSelectionOrLine(e).catch(f)}),this.registerCommand($.RunAllCellsAbove,this.runAllCellsAbove),this.registerCommand($.RunCellAndAllBelow,this.runCellAndAllBelow),this.registerCommand($.RunAllCellsAbovePalette,this.runAllCellsAboveFromCursor),this.registerCommand($.RunCellAndAllBelowPalette,this.runCellAndAllBelowFromCursor),this.registerCommand($.RunCurrentCellAndAddBelow,this.runCurrentCellAndAddBelow),this.registerCommand($.DebugCell,this.debugCell),this.registerCommand($.DebugStepOver,this.debugStepOver),this.registerCommand($.DebugContinue,this.debugContinue),this.registerCommand($.DebugStop,this.debugStop),this.registerCommand($.DebugCurrentCellPalette,this.debugCurrentCellFromCursor),this.registerCommand($.OpenVariableView,this.openVariableView),this.registerCommand($.OpenOutlineView,this.openOutlineView),this.registerCommand($.RunToLine,this.runToLine),this.registerCommand($.RunFromLine,this.runFromLine),this.registerCommand($.RunFileInInteractiveWindows,this.runFileInteractive),this.registerCommand($.DebugFileInInteractiveWindows,this.debugFileInteractive))}registerCommand(e,t){let n=Je.commands.registerCommand(e,t,this);this.disposables.push(n)}getCodeWatcher(e){if(e&&this.dataScienceCodeLensProvider){let t=Je.workspace.textDocuments.filter(n=>bi(n.uri,e));if(t&&t.length===1)return this.dataScienceCodeLensProvider.getCodeWatcher(t[0]);if(t&&t.length>1)throw new Error(y.documentMismatch(Pe(e)))}}async enableDebugLogging(){this.configService.getSettings().logging.level!=="debug"&&(await this.configService.updateSetting("logging.level","debug",void 0,Je.ConfigurationTarget.Global),Je.commands.executeCommand("jupyter.reloadVSCode",y.reloadRequired).then(f,f))}async resetLoggingLevel(){this.configService.getSettings().logging.level!=="error"&&(await this.configService.updateSetting("logging.level","error",void 0,Je.ConfigurationTarget.Global),Je.commands.executeCommand("jupyter.reloadVSCode",y.reloadRequired).then(f,f))}async enableLoadingWidgetScriptsFromThirdParty(){this.configService.getSettings(void 0).widgetScriptSources.length>0||await this.configService.updateSetting("widgetScriptSources",["jsdelivr.com","unpkg.com"],void 0,Je.ConfigurationTarget.Global).catch(f)}async runAllCells(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runAllCells()}async runFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runFileInteractive()}async debugFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.debugFileInteractive()}async runCell(e,t,n,i,o){let s=this.getCodeWatcher(e);if(s)return s.runCell(new Je.Range(t,n,i,o))}async runAllCellsAbove(e,t,n){if(e){let i=this.getCodeWatcher(e);if(i)return i.runAllCellsAbove(t,n)}}async runCellAndAllBelow(e,t,n){if(e){let i=this.getCodeWatcher(e);if(i)return i.runCellAndAllBelow(t,n)}}async runToLine(){let e=this.getCurrentCodeWatcher(),t=Je.window.activeTextEditor;if(e&&t&&t.selection)return e.runToLine(t.selection.start.line)}async runFromLine(){let e=this.getCurrentCodeWatcher(),t=Je.window.activeTextEditor;if(e&&t&&t.selection)return e.runFromLine(t.selection.start.line)}async runCurrentCell(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCell()}async runCurrentCellAndAdvance(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCellAndAdvance()}async runSelectionOrLine(e){let t=this.getCurrentCodeWatcher();if(t)return t.runSelectionOrLine(Je.window.activeTextEditor,Vn(e)?void 0:e)}async debugCell(e,t,n,i,o){if(e){let s=this.getCodeWatcher(e);if(s)return s.debugCell(new Je.Range(t,n,i,o))}}async debugStepOver(){this.debugService?.activeDebugSession&&Je.commands.executeCommand("workbench.action.debug.stepOver").then(f,f)}async debugStop(e){if(this.debugService?.activeDebugSession&&this.interactiveWindowProvider){let t=this.interactiveWindowProvider.get(e);if(t&&t.notebookDocument){let n=this.kernelProvider.get(t.notebookDocument);n&&(E(`Interrupt kernel due to debug stop of IW ${e.toString()}`),await n.interrupt())}Je.commands.executeCommand("workbench.action.debug.stop").then(f,f)}}async debugContinue(){this.debugService?.activeDebugSession&&Je.commands.executeCommand("workbench.action.debug.continue").then(f,f)}async addCellBelow(){await this.getCurrentCodeWatcher()?.addEmptyCellToBottom()}async runCurrentCellAndAddBelow(){this.getCurrentCodeWatcher()?.runCurrentCellAndAddBelow()}async insertCellBelowPosition(){this.getCurrentCodeWatcher()?.insertCellBelowPosition()}async insertCellBelow(){this.getCurrentCodeWatcher()?.insertCellBelow()}async insertCellAbove(){this.getCurrentCodeWatcher()?.insertCellAbove()}async deleteCells(){this.getCurrentCodeWatcher()?.deleteCells()}async selectCell(){this.getCurrentCodeWatcher()?.selectCell()}async selectCellContents(){this.getCurrentCodeWatcher()?.selectCellContents()}async extendSelectionByCellAbove(){this.getCurrentCodeWatcher()?.extendSelectionByCellAbove()}async extendSelectionByCellBelow(){this.getCurrentCodeWatcher()?.extendSelectionByCellBelow()}async moveCellsUp(){this.getCurrentCodeWatcher()?.moveCellsUp()}async moveCellsDown(){this.getCurrentCodeWatcher()?.moveCellsDown()}async changeCellToMarkdown(){this.getCurrentCodeWatcher()?.changeCellToMarkdown()}async changeCellToCode(){this.getCurrentCodeWatcher()?.changeCellToCode()}async gotoNextCellInFile(){this.getCurrentCodeWatcher()?.gotoNextCell()}async gotoPrevCellInFile(){this.getCurrentCodeWatcher()?.gotoPreviousCell()}async runAllCellsAboveFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runAllCellsAbove(e.range.start.line,e.range.start.character)}else return}async runCellAndAllBelowFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runCellAndAllBelow(e.range.start.line,e.range.start.character)}else return}async debugCurrentCellFromCursor(){if(this.getCurrentCodeLens()){let t=this.getCurrentCodeWatcher();if(t)return t.debugCurrentCell()}else return}async createNewNotebook(){Je.window.showInformationMessage('This command has been deprecated and will eventually be removed, please use ["Create: New Jupyter Notebook"](command:workbench.action.openGlobalKeybindings?%5B%22@command:ipynb.newUntitledIpynb%22%5D) instead.').then(f,f),await Je.commands.executeCommand("ipynb.newUntitledIpynb")}getCurrentCodeLens(){let e=Je.window.activeTextEditor,t=this.getCurrentCodeWatcher();if(e&&t)return t.getCodeLenses().find(n=>n.range.end.line>=e.selection.anchor.line&&n.range.start.line<=e.selection.anchor.line)}getCurrentCodeWatcher(){let e=Je.window.activeTextEditor;if(!(!e||!e.document||!this.dataScienceCodeLensProvider))return this.dataScienceCodeLensProvider.getCodeWatcher(e.document)}openPythonExtensionPage(){Je.env.openExternal(Je.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter")).then(f,f)}async openVariableView(){return Je.commands.executeCommand("jupyterViewVariables.focus")}async openOutlineView(){return Je.commands.executeCommand("outline.focus")}async listenForErrors(e){let t;try{return t=await e(),t}catch(n){x("listenForErrors",n),this.dataScienceErrorHandler.handleError(n).then(f,f)}return t}async exportFile(e){let t=Pe(e);if(t&&t.length>0&&this.jupyterExporter){let n=Je.window.activeTextEditor;if(n&&this.fileSystem.arePathsSame(n.document.uri,e)){let i=aL(n.document,this.configuration.getSettings(n.document.uri));if(i){let o=await new Ka().showDialog("ipynb",e);if(await this.waitForStatus(async()=>{if(o){let s=await this.jupyterExporter?.translateToNotebook(i);await this.fileSystem.writeFile(o,JSON.stringify(s,void 0,1))}},y.exportingFormat,W(e)),o&&t){let s=y.exportOpenQuestion1;await Je.window.showInformationMessage(y.exportDialogComplete(W(e)),s)===s&&await P0(o)}}}}}async exportFileAndOutput(e){let t=Pe(e);if(t&&t.length>0&&this.jupyterExporter&&this.jupyterServerHelper&&await this.jupyterServerHelper.isJupyterServerSupported()){let n=Je.window.activeTextEditor;if(n&&n.document&&this.fileSystem.arePathsSame(n.document.uri,e)){let i=aL(n.document,this.configuration.getSettings(n.document.uri));if(i){let o=await new Ka().showDialog("ipynb",e);return o?(await this.waitForStatus(async()=>{if(o){let s=await this.jupyterExporter?.translateToNotebook(i);await this.fileSystem.writeFile(o,JSON.stringify(s,void 0,1))}},y.exportingFormat,W(e)),await Je.workspace.openNotebookDocument(o).then(s=>Je.window.showNotebookDocument(s)),await Je.commands.executeCommand("notebook.execute"),o):void 0}}}else this.jupyterServerHelper&&await this.dataScienceErrorHandler.handleError(new Xi(y.jupyterNotSupported(await this.jupyterServerHelper.getJupyterServerError())))}async expandAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);z(`Expanding all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.expandAllCells()}async collapseAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);z(`Collapsing all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.collapseAllCells()}exportCells(){let e=this.interactiveWindowProvider?.activeWindow;e&&e.export()}exportAs(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.exportAs()}export(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.export()}async createNewInteractiveWindow(e){await this.interactiveWindowProvider?.getOrCreate(void 0,e)}waitForStatus(e,t,n,i){let o=t(n||"");return this.statusProvider.waitWithStatus(e,o,void 0,i)}async importNotebook(){let e=y.importDialogFilter,t={};t[e]=["ipynb"];let n=await Je.window.showOpenDialog({openLabel:y.importDialogTitle,filters:t});n&&n.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(n[0])},y.importingFormat,W(n[0]))}async importNotebookOnFile(e){let t=Pe(e);t&&t.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(e)},y.importingFormat,W(e))}async scrollToCell(e,t){if(t&&e){let n=this.interactiveWindowProvider.getInteractiveWindowsWithSubmitter(e);for(let i=0;i<n.length;i+=1)if(await n[i].hasCell(t)){n[i].scrollToCell(t);break}}}async clearAllCellsInInteractiveWindow(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e?.notebookEditor?.notebookUri)?.notebookUri;if(!t)return;let n=Je.workspace.notebookDocuments.find(s=>s.uri.toString()===t.toString());if(!n)return;let i=new Je.WorkspaceEdit,o=Je.NotebookEdit.deleteCells(new Je.NotebookRange(0,n.cellCount));i.set(n.uri,[o]),await Je.workspace.applyEdit(i)}async goToCodeInInteractiveWindow(e){if(e&&e.metadata?.interactive){let t=Je.Uri.parse(e.metadata.interactive.uristring),n=e.metadata.interactive.lineIndex,i=await Je.window.showTextDocument(t,{viewColumn:Je.ViewColumn.One});i&&(i.revealRange(new Je.Range(n,0,n,0)),i.selection=new Je.Selection(new Je.Position(n,0),new Je.Position(n,0)))}}async copyCellInInteractiveWindow(e){if(e){let t=this.configuration.getSettings(e.notebook.uri),n=[e.metadata.interactiveWindowCellMarker??t.defaultCellMarker,e.document.getText()].join(`
`);await Je.env.clipboard.writeText(n)}}};v([Qr("DATASCIENCE.DEBUG_STEP_OVER")],Do.prototype,"debugStepOver",1),v([Qr("DATASCIENCE.DEBUG_STOP")],Do.prototype,"debugStop",1),v([Qr("DATASCIENCE.DEBUG_CONTINUE")],Do.prototype,"debugContinue",1),v([dr("DATASCIENCE.ADD_CELL_BELOW")],Do.prototype,"addCellBelow",1),v([Qr("DATASCIENCE.EXPORT_PYTHON_FILE")],Do.prototype,"exportFile",1),v([Qr("DATASCIENCE.EXPORT_PYTHON_FILE_AND_OUTPUT")],Do.prototype,"exportFileAndOutput",1),v([Qr("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"command"})],Do.prototype,"importNotebook",1),v([Qr("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"file"})],Do.prototype,"importNotebookOnFile",1),Do=v([(0,Sn.injectable)(),d(0,(0,Sn.inject)(F)),d(1,(0,Sn.inject)(sg)),d(1,(0,Sn.optional)()),d(2,(0,Sn.inject)(up)),d(2,(0,Sn.optional)()),d(3,(0,Sn.inject)(st)),d(4,(0,Sn.inject)(le)),d(5,(0,Sn.inject)(kd)),d(5,(0,Sn.optional)()),d(6,(0,Sn.inject)(Di)),d(6,(0,Sn.optional)()),d(7,(0,Sn.inject)(le)),d(8,(0,Sn.inject)(Oi)),d(9,(0,Sn.inject)(Ke)),d(10,(0,Sn.inject)(Yr)),d(11,(0,Sn.inject)(mi)),d(12,(0,Sn.inject)(Ib))],Do);var Lb=_(O());var Hs=require("vscode");var D0=class{constructor(e,t,n,i){this.configService=e;this.storage=t;this.notebook=n;this.executionCount=0;this.cellIndexesCounted={};this.disposables=[];i.push(this),Hs.workspace.onDidChangeTextDocument(this.onChangedDocument,this,this.disposables),Hs.notebooks.onDidChangeNotebookCellExecutionState(this.onDidCellStateChange,this,this.disposables)}dispose(){this.disposed||(this.disposed=!0,this.storage.clear(),this.disposables.forEach(e=>e.dispose()))}reset(){this.storage.clear(),this.executionCount=0}async generateCode(e,t,n,i){let{executableLines:o}=this.extractExecutableLines(e);if(this.executionCount+=1,this.cellIndexesCounted[t]=!0,o.length>0&&o.find(s=>s.trim().length>0))return this.generateCodeImpl(e,this.executionCount,n,i)}extractExecutableLines(e){let t=e.interactive.originalSource,n=this.configService.getSettings(this.notebook.uri),i=new fi(n),o=bc(t);if(n.magicCommandsAsComments&&o.forEach((s,a)=>o[a]=Kb(s)),e.interactiveWindowCellMarker&&o.length&&o[0].trim()===e.interactiveWindowCellMarker.trim()){let s=o.slice(1).filter(a=>a.trim().length>0);if(s.length>0&&s[0].trim().startsWith("%%")){let a=o.slice(o.indexOf(s[0]));return{lines:a,executableLines:a}}}return o.length>0&&(i.isCode(o[0])||i.isMarkdown(o[0]))?{lines:o,executableLines:o.slice(1)}:{lines:o,executableLines:o}}onDidCellStateChange(e){e.cell.notebook!==this.notebook||!e.cell.executionSummary?.executionOrder||this.cellIndexesCounted[e.cell.index]||(this.executionCount+=1,this.cellIndexesCounted[e.cell.index]=!0)}async generateCodeImpl(e,t,n,i){let{lineIndex:o,uristring:s}=e.interactive,a=Hs.workspace.textDocuments.find(te=>te.uri.toString()===s);if(!a)return;let{stripped:c,trueStartLine:l}=this.extractStrippedLines(e),u=a.lineAt(l),p=a.lineAt(Math.min(l+c.length-1,a.lineCount-1)),m=0;for(;m<c.length&&c[m].trim().length===0;)m+=1;let h=m+l,g=a.offsetAt(new Hs.Position(o,0)),b=a.offsetAt(p.rangeIncludingLineBreak.end),w=(e.interactiveWindowCellMarker||"").length>0,{runtimeLine:k,debuggerStartLine:N}=this.addHiddenLines(n,c,l,h,w,i),D=c.join(""),V=a.getText(new Hs.Range(new Hs.Position(o,0),p.rangeIncludingLineBreak.end)),oe=(await la(D,"SHA-1")).substring(0,12),G=this.getRuntimeFile(oe,t),pe=n?-1:0,de={line:u?u.lineNumber+1:1,endLine:p?p.lineNumber+1:1,firstNonBlankLineIndex:h,debuggerStartLine:N,executionCount:t,startOffset:g,endOffset:b,deleted:!1,code:D,trimmedRightCode:c.map(te=>te.replace(/[ \t\r]+\n$/g,`
`)).join(""),realCode:V,runtimeLine:k,runtimeFile:G,id:e.id,timestamp:Date.now(),lineOffsetRelativeToIndexOfFirstLineInCell:pe,hasCellMarker:w};return z(`Generated code for ${t} = ${G} with ${c.length} lines`),this.storage.store(Hs.Uri.parse(e.interactive.uristring),de),de}getRuntimeFile(e,t){return`<ipython-input-${t}-${e}>`}onChangedDocument(e){let t=this.storage.getFileGeneratedCode(e.document.uri);if(t){let n=e.document.getText();e.contentChanges.forEach(i=>{this.handleContentChange(n,i,t)})}}extractStrippedLines(e){let t=bc(e.interactive.originalSource),{lines:n}=this.extractExecutableLines(e),i=e.interactive.lineIndex+1;if(!e.interactiveWindowCellMarker){i=e.interactive.lineIndex;for(let c=0;c<n.length;c+=1)if(n[c]!==t[c]){i+=c+1;break}}let o=0;for(;o<n.length&&n[o].trim().length===0;)o+=1;let s=n.length-1,a=n.length-2;for(;a>0;){let c=n[s],l=n[a];if((c.length===0||c===`
`)&&(l.length===0||l===`
`))n.splice(s,1),s-=1,a-=1;else break}!n[s].endsWith(`
`)&&n[s].length>0&&(n[s]=`${n[s]}
`);for(let c=0;c<n.length;c++)n[c]=n[c].replace(/\r\n/g,`
`);return{stripped:n,trueStartLine:i}}handleContentChange(e,t,n){let i=t.range.start.line-t.range.end.line+t.text.split(`
`).length-1,o=t.text.length-t.rangeLength,s=t.rangeLength<=0?t.rangeOffset:t.rangeOffset+t.rangeLength-1;n.forEach(a=>{a.endOffset<t.rangeOffset||(a.startOffset>s?(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.startOffset===s?a.deleted||t.rangeLength>0||i===0?a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode:(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode)})}addHiddenLines(e,t,n,i,o,s){let a=s||this.configService.getSettings(void 0).forceIPyKernelDebugger===!0;return e&&this.configService.getSettings(this.notebook.uri).stopOnFirstLineWhileDebugging?a?(t.splice(0,0,`breakpoint()
`),{runtimeLine:1,debuggerStartLine:n+1}):(t.splice(0,0,`breakpoint()
`),{runtimeLine:2,debuggerStartLine:n}):{runtimeLine:1,debuggerStartLine:o?i:i+1}}};var tz=require("vscode");var Fb=class{constructor(e,t,n){this.configService=e;this.storageFactory=t;this.disposables=n;this.codeGenerators=new WeakMap}activate(){tz.workspace.onDidCloseNotebookDocument(this.onDidCloseNotebook,this,this.disposables)}getOrCreate(e){let t=this.get(e);if(t)return t;let n=new D0(this.configService,this.storageFactory.getOrCreate(e),e,this.disposables);return this.codeGenerators.set(e,n),n}get(e){return this.codeGenerators.get(e)}onDidCloseNotebook(e){this.codeGenerators.get(e)?.dispose(),this.codeGenerators.delete(e)}};Fb=v([(0,Lb.injectable)(),d(0,(0,Lb.inject)(le)),d(1,(0,Lb.inject)($s)),d(2,(0,Lb.inject)(F))],Fb);var Af=_(O()),pl=require("vscode");function as(r){if(r.metadata.interactive!==void 0)return r.metadata}function rz(r,e,t){let n=Fe(r,{trim:!1,removeEmptyEntries:!1}),i=t.stripFirstMarkerNoConcat(n),o=LV(i),s=Ic(o,`
`,e.magicCommandsAsComments?Kb:void 0);return mh(s.join(""))}function Rf(r){let e=r;return e&&e.input&&Vn(e.input.uri)&&Vn(e.input.inputBoxUri)}var iz=require("vscode");var kye=y.runCurrentCellAndAddBelow,_ye=y.addCellBelowCommandTitle,Dye=y.debugCellCommandTitle,Tye=y.debugCellCommandTitle,Rye=y.debugStepOverCommandTitle,Aye=y.debugContinueCommandTitle,Nye=y.debugStopCommandTitle,Mye=y.runCellLensCommandTitle,Oye=y.runAllCellsLensCommandTitle,Kye=y.runAllCellsAboveLensCommandTitle,nz=y.runCellAndAllBelowLensCommandTitle,Fye=y.scrollToCellTitleFormatMessage,Ub=class{constructor(e,t,n,i){this.configService=e;this.generatedCodeStorageFactory=n;this.updateEvent=new pl.EventEmitter;this.notebookData=new Map;this.codeLensCache=new Map;this.totalCodeLensUpdateTimeInMs=0;this.codeLensUpdateCount=0;this.maxCellCount=0;pl.workspace.onDidCloseTextDocument(this.onClosedDocument,this,t),pl.workspace.onDidGrantWorkspaceTrust(()=>this.codeLensCache.clear(),this,t),this.configService.getSettings(void 0).onDidChange(this.onChangedSettings,this,t),iz.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,t),i.onDidDisposeKernel(o=>{this.notebookData.delete(o.notebook.uri.toString())},this,t)}getPerfMeasures(){return{totalCodeLensUpdateTimeInMs:this.totalCodeLensUpdateTimeInMs,codeLensUpdateCount:this.codeLensUpdateCount,maxCellCount:this.maxCellCount}}get updateRequired(){return this.updateEvent.event}createCodeLenses(e){let t=this.getCodeLensCacheData(e);return[...t.documentLenses,...t.gotoCellLens]}getCellRanges(e){return this.getCodeLensCacheData(e).cellRanges}getCodeLensCacheData(e){let t=new qe,n=!1,i=e.uri.toString(),o=this.codeLensCache.get(i),s=!1;o||(o={cachedDocumentVersion:void 0,cachedExecutionCounts:new Set,documentLenses:[],cellRanges:[],gotoCellLens:[]},s=!0,this.codeLensCache.set(i,o)),o.cachedDocumentVersion!==e.version&&(o.cellRanges=qC(e,this.configService.getSettings(e.uri)),o.documentLenses=[],o.gotoCellLens=[],o.cachedDocumentVersion=e.version,s=!0);let a=this.getDocumentExecutionCounts(i);if((a.length!==o.cachedExecutionCounts.size||a.find(c=>!o?.cachedExecutionCounts.has(c)))&&(o.gotoCellLens=[],o.cachedExecutionCounts=new Set(a),s=!0),o.documentLenses.length===0&&s&&o.cellRanges.length){n=!0;let c=this.enumerateCommands(e.uri);E(`CodeLensFactory: Generating new code lenses for version ${e.version} of document ${e.uri} for commands ${c.join(", ")}`);let l=!0;o.cellRanges.forEach(u=>{c.forEach(p=>{let m=this.createCodeLens(e,u,p,l);m&&o.documentLenses.push(m)}),l=!1})}else ne(`NOT Generating new code lenses for version ${e.version} of document ${e.uri} - needUpdate: ${s}, cellRanges.length: ${o.cellRanges.length}`);if(s&&o.gotoCellLens.length===0&&o.cellRanges.length&&this.configService.getSettings(e.uri).addGotoCodeLenses){let c=this.generatedCodeStorageFactory.get({fileUri:e.uri}),l=c?c.all.find(u=>u.uri.toString()===e.uri.toString())?.generatedCodes:void 0;l&&l.length&&o.cellRanges.forEach(u=>{let p=this.createExecutionLens(e,u.range,l);p&&o?.gotoCellLens.push(p)})}return n&&(this.totalCodeLensUpdateTimeInMs+=t.elapsedTime,this.codeLensUpdateCount+=1,this.maxCellCount=Math.max(this.maxCellCount,o.cellRanges.length)),o}getDocumentExecutionCounts(e){return[...this.notebookData.values()].map(t=>t.documentExecutionCounts.get(e)).filter(t=>t!==void 0)}onDidChangeNotebookCellExecutionState(e){if(e.cell.notebook.notebookType!==gt||e.state!==pl.NotebookCellExecutionState.Idle||!e.cell.executionSummary?.executionOrder)return;let t=as(e.cell),n=this.notebookData.get(e.cell.notebook.uri.toString());n||(n={cellExecutionCounts:new Map,documentExecutionCounts:new Map},this.notebookData.set(e.cell.notebook.uri.toString(),n)),n!==void 0&&t!==void 0&&(n.cellExecutionCounts.set(t.id,e.cell.executionSummary.executionOrder),n.documentExecutionCounts.set(t.interactive.uristring,e.cell.executionSummary.executionOrder),this.updateEvent.fire())}onClosedDocument(e){this.codeLensCache.delete(e.uri.toString())}onChangedSettings(){this.codeLensCache.clear(),this.updateEvent.fire()}enumerateCommands(e){let t,n=this.configService.getSettings(e).codeLenses;n?t=n.split(",").map(s=>s.trim()):t=ju.DefaultDesignLenses;let i=this.configService.getSettings(e).debugCodeLenses;i?t=t.concat(i.split(",").map(s=>s.trim())):t=t.concat(ju.DefaultDebuggingLenses);let o=[];return pl.workspace.isTrusted||(o=[...ju.DebuggerCommands,...ju.DebuggerCommands,$.RunAllCells,$.RunAllCellsAbove,$.RunAllCellsAbovePalette,$.RunCellAndAllBelowPalette,$.RunCurrentCell,$.RunCurrentCellAdvance,$.RunCurrentCellAndAddBelow,$.RunFileInInteractiveWindows,$.InterruptKernel,$.RunToLine,$.RunCell,$.DebugCell,$.DebugContinue,$.DebugStepOver,$.DebugStop,$.RunCellAndAllBelowPalette]),o&&(t=t.filter(s=>!o.includes(s))),t}createCodeLens(e,t,n,i){let{range:o,cell_type:s}=t;switch(n){case $.RunCurrentCellAndAddBelow:return this.generateCodeLens(o,$.RunCurrentCellAndAddBelow,kye);case $.AddCellBelow:return this.generateCodeLens(o,$.AddCellBelow,_ye,[e.uri,o.start.line]);case $.DebugCurrentCellPalette:return this.generateCodeLens(o,$.DebugCurrentCellPalette,Dye);case $.DebugCell:if(s!=="code")break;return this.generateCodeLens(o,$.DebugCell,Tye,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case $.DebugStepOver:if(s!=="code")break;return this.generateCodeLens(o,$.DebugStepOver,Rye,[e.uri]);case $.DebugContinue:if(s!=="code")break;return this.generateCodeLens(o,$.DebugContinue,Aye,[e.uri]);case $.DebugStop:if(s!=="code")break;return this.generateCodeLens(o,$.DebugStop,Nye,[e.uri]);case $.RunCurrentCell:case $.RunCell:return this.generateCodeLens(o,$.RunCell,Mye,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case $.RunAllCells:return this.generateCodeLens(o,$.RunAllCells,Oye,[e.uri,o.start.line,o.start.character]);case $.RunAllCellsAbovePalette:case $.RunAllCellsAbove:return i?this.generateCodeLens(o,$.RunCellAndAllBelow,nz,[e.uri,o.start.line,o.start.character]):this.generateCodeLens(o,$.RunAllCellsAbove,Kye,[e.uri,o.start.line,o.start.character]);case $.RunCellAndAllBelowPalette:case $.RunCellAndAllBelow:return this.generateCodeLens(o,$.RunCellAndAllBelow,nz,[e.uri,o.start.line,o.start.character]);default:j(`Invalid command for code lens ${n}`);break}}findMatchingCellExecutionCount(e){return[...this.notebookData.values()].find(n=>n.cellExecutionCounts.get(e))?.cellExecutionCounts.get(e)}createExecutionLens(e,t,n){if(n){let i=n.filter(o=>o.line-2===t.start.line).sort((o,s)=>o.timestamp-s.timestamp);if(i&&i.length){let o=i[i.length-1],s=this.findMatchingCellExecutionCount(o.id);if(s!==void 0)return this.generateCodeLens(t,$.ScrollToCell,Fye(s),[e.uri,o.id])}}}generateCodeLens(e,t,n,i){return new pl.CodeLens(e,Lye(t,n,i))}};Ub=v([(0,Af.injectable)(),d(0,(0,Af.inject)(le)),d(1,(0,Af.inject)(F)),d(2,(0,Af.inject)($s)),d(3,(0,Af.inject)(Ke))],Ub);function Lye(r,e,t){return{arguments:t,title:e,command:r}}var dl=_(O()),La=_(require("vscode"));var jb=class{constructor(e,t,n,i,o){this.serviceContainer=e;this.debugLocationTracker=t;this.configuration=n;this.debugService=o;this.totalExecutionTimeInMs=0;this.totalGetCodeLensCalls=0;this.activeCodeWatchers=[];this.didChangeCodeLenses=new La.EventEmitter;i.push(this),i.push(La.workspace.onDidGrantWorkspaceTrust(()=>{this.activeCodeWatchers=Q(this.activeCodeWatchers),this.didChangeCodeLenses.fire()})),i.push(this.debugService.onDidChangeActiveDebugSession(this.onChangeDebugSession.bind(this))),i.push(La.workspace.onDidCloseTextDocument(this.onDidCloseTextDocument.bind(this))),this.debugLocationTracker&&i.push(this.debugLocationTracker.updated(this.onDebugLocationUpdated.bind(this)))}dispose(){this.totalGetCodeLensCalls>0&&A("DS_INTERNAL.CODE_LENS_ACQ_TIME",{duration:this.totalExecutionTimeInMs/this.totalGetCodeLensCalls}),Q(this.activeCodeWatchers)}get onDidChangeCodeLenses(){return this.didChangeCodeLenses.event}provideCodeLenses(e,t){return[_l,kw].includes(e.uri.scheme)?[]:this.getCodeLensTimed(e)}getCodeWatcher(e){return this.matchWatcher(e.uri)}onDebugLocationUpdated(){this.didChangeCodeLenses.fire()}onChangeDebugSession(e){this.didChangeCodeLenses.fire()}onDidCloseTextDocument(e){let t=this.activeCodeWatchers.findIndex(n=>n.uri&&n.uri.toString()===e.uri.toString());t>=0&&this.activeCodeWatchers.splice(t,1)[0].dispose()}getCodeLensTimed(e){let t=new qe,n=this.getCodeLens(e);return this.totalExecutionTimeInMs+=t.elapsedTime,this.totalGetCodeLensCalls+=1,new ir(Ir.HasCodeCells).set(n&&n.length>0).catch(f),this.configuration.getSettings(e.uri).enableCellCodeLens?this.adjustDebuggingLenses(e,n):[]}adjustDebuggingLenses(e,t){let n=ju.DebuggerCommands;if(this.debugLocationTracker&&this.debugService.activeDebugSession){let i=this.debugLocationTracker.getLocation(this.debugService.activeDebugSession),o;try{o=i?La.Uri.parse(i.fileName):void 0}catch{}if(i&&(bi(La.Uri.file(i.fileName),e.uri,!0)||o&&bi(o,e.uri,!0)))return t.filter(a=>{let c=new La.Position(i.lineNumber-1,i.column-1);return a.range.contains(c)}).filter(a=>a.command?n.includes(a.command.command):!1);ne(`Detected debugging context because activeDebugSession is name:"${this.debugService.activeDebugSession.name}", type: "${this.debugService.activeDebugSession.type}", but fell through with debugLocation: ${JSON.stringify(i)}, and document.uri: ${e.uri.toString()}`)}else return t.filter(i=>i.command?!n.includes(i.command.command):!1);return[]}getCodeLens(e){let t=this.matchWatcher(e.uri);return t?t.getCodeLenses():(E(`Creating a new watcher for document ${e.uri}`),this.createNewCodeWatcher(e).getCodeLenses())}matchWatcher(e){let t=this.activeCodeWatchers.findIndex(i=>i.uri&&i.uri.toString()==e.toString());if(t>=0)return this.activeCodeWatchers[t];let n=La.workspace.textDocuments.filter(i=>i.uri.toString()===e.toString());if(n&&n.length>0)return E(`creating new code watcher with matching document ${e}`),this.createNewCodeWatcher(n[0])}createNewCodeWatcher(e){let t=this.serviceContainer.get(I0);return t.setDocument(e),t.codeLensUpdated(this.onWatcherUpdated.bind(this)),this.activeCodeWatchers.push(t),t}onWatcherUpdated(){this.didChangeCodeLenses.fire()}};jb=v([(0,dl.injectable)(),d(0,(0,dl.inject)(ut)),d(1,(0,dl.inject)(YT)),d(1,(0,dl.optional)()),d(2,(0,dl.inject)(le)),d(3,(0,dl.inject)(F)),d(4,(0,dl.inject)(Di))],jb);var _d=_(O()),Se=require("vscode");var Nf=class extends Error{constructor(t){super("Cell failed to execute");this.cell=t}};function Uye(r,e){if(e<=0)throw new RangeError(`Length must be > 0 not ${e}`);return r<0&&(r+=e),r<0?0:r>=e?e-1:r}var tr=class{constructor(e,t,n,i,o){this.interactiveWindowProvider=e;this.configService=t;this.executionHelper=n;this.dataScienceErrorHandler=i;this.codeLensFactory=o;this.version=-1;this.codeLenses=[];this.cells=[];this.codeLensUpdatedEvent=new Se.EventEmitter;this.disposables=[this.codeLensUpdatedEvent]}setDocument(e){this.document=e,this.version=e.version,this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.disposables.push(this.codeLensFactory.updateRequired(this.onCodeLensFactoryUpdated.bind(this))),this.disposables.push(Se.workspace.onDidCloseTextDocument(this.onDocumentClosed.bind(this))),this.disposables.push(Se.workspace.onDidCloseNotebookDocument(this.ondidCloseNotebook.bind(this)))}get codeLensUpdated(){return this.codeLensUpdatedEvent.event}get uri(){return this.document?.uri}getVersion(){return this.version}getCodeLenses(){let e=this.document;return e&&e.version!=this.version&&(this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.version=e.version),this.codeLenses}async debugCurrentCell(){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(Se.window.activeTextEditor.selection,!1,!0)}dispose(){let e=this.codeLensFactory.getPerfMeasures();e&&e.codeLensUpdateCount>0&&A("DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",{codeLensUpdateTime:e.totalCodeLensUpdateTimeInMs/e.codeLensUpdateCount,maxCellCount:e.maxCellCount}),Q(this.disposables)}async runAllCells(e){let t=await this.getActiveInteractiveWindow(),n=this.codeLenses.filter(s=>s.command&&s.command.command===$.RunCell&&s.command.arguments&&s.command.arguments.length>=5),i=n.length,o=Promise.resolve(!0);for(let s of n){let a=new Se.Range(s.command.arguments[1],s.command.arguments[2],s.command.arguments[3],s.command.arguments[4]);if(this.document){i===n.length&&(a=new Se.Range(new Se.Position(0,0),a.end));let c=this.document.getText(a);i-=1,o=this.addCode(t,c,this.document.uri,a.start.line,e)}}if(await o,n.length===0)return this.runFileAsOneCell(e??!1)}async runFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells();if(this.document)return this.runFileAsOneCell(!1)}async debugFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells(!0);if(this.document)return this.runFileAsOneCell(!0)}async runAllCellsAbove(e,t){let n=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(c=>c.command&&c.command.command===$.RunCell),o=i.findIndex(c=>c.range.start.line>=e&&c.range.start.character>=t);o<0&&(o=i.length);let s=o,a=Promise.resolve(!0);for(let c of i)if(o>0&&this.document){let l=new Se.Range(c.range.start,c.range.end);o===s&&(l=new Se.Range(new Se.Position(0,0),l.end)),o-=1;let u=this.document.getText(l);a=this.addCode(n,u,this.document.uri,c.range.start.line)}else break;await a}async runCellAndAllBelow(e,t){let n=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(c=>c.command&&c.command.command===$.RunCell),o=i.findIndex(c=>c.range.start.line>=e&&c.range.start.character>=t),s=o>0?i.length-o:i.length,a=Promise.resolve(!0);for(let c=o;c>=0&&c<i.length;c+=1)if(s>0&&this.document){let l=i[c];s-=1;let u=this.document.getText(l.range);a=this.addCode(n,u,this.document.uri,l.range.start.line)}await a}async runSelectionOrLine(e,t){if(this.document&&e&&bi(e.document.uri,this.document.uri)){let n=await this.getActiveInteractiveWindow(),i;if(t===void 0||Vn(t)?i=this.executionHelper.getSelectedTextToExecute(e):i=t,!i)return;let s=this.configService.getSettings(e.document.uri).normalizeSelectionForInteractiveWindow??!0?await this.executionHelper.normalizeLines(i):i;if(!s||s.trim().length===0)return;await this.addCode(n,s,this.document.uri,e.selection.start.line)}}async runToLine(e){if(this.document&&e>0){let t=await this.getActiveInteractiveWindow(),n=this.document.lineAt(e-1),i=this.document.getText(new Se.Range(0,0,n.range.end.line,n.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,0)}}async runFromLine(e){if(this.document&&e<this.document.lineCount){let t=await this.getActiveInteractiveWindow(),n=this.document.lineAt(this.document.lineCount-1),i=this.document.getText(new Se.Range(e,0,n.range.end.line,n.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,e)}}async runCell(e){if(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document)return;let t=e.contains(Se.window.activeTextEditor.selection.start)&&this.configService.getSettings(Se.window.activeTextEditor.document.uri).enableAutoMoveToNextCell;return this.runMatchingCell(e,t)}async debugCell(e){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(e,!1,!0)}async runCurrentCell(){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(Se.window.activeTextEditor.selection,!1)}async runCurrentCellAndAdvance(){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(Se.window.activeTextEditor.selection,!0)}async addEmptyCellToBottom(){let e=Se.window.activeTextEditor;e&&this.insertCell(e,e.document.lineCount+1)}async runCurrentCellAndAddBelow(){if(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document)return;let e=Se.window.activeTextEditor,t=new fi(this.configService.getSettings(e.document.uri)),n=0,i=this.getDefaultCellMarker(e.document.uri);e&&e.edit(s=>{let a=!0;for(let c=e.selection.end.line+1;c<e.document.lineCount;c+=1)if(t.isCell(e.document.lineAt(c).text)){a=!1,n=c,s.insert(new Se.Position(c,0),`${i}

`);break}a&&(n=e.document.lineCount,s.insert(new Se.Position(e.document.lineCount,0),`
${i}
`))}).then(f,f);let o=new Se.Position(n+1,0);return this.runMatchingCell(e.selection,!1).then(()=>this.advanceToRange(new Se.Range(o,o)))}insertCellBelowPosition(){let e=Se.window.activeTextEditor;e&&e.selection&&this.insertCell(e,e.selection.end.line+1)}insertCellBelow(){let e=Se.window.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.end);t?this.insertCell(e,t.range.end.line+1):this.insertCell(e,e.selection.end.line+1)}}insertCellAbove(){let e=Se.window.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.start);t?this.insertCell(e,t.range.start.line):this.insertCell(e,e.selection.start.line)}}deleteCells(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCells(e.selection);if(!t)return;let n=t[0],i=t[1],o=0,s=0,a=i.range.end.line+1,c=0;n.range.start.line>0&&(o=n.range.start.line-1,s=e.document.lineAt(o).range.end.character,a=i.range.end.line,c=i.range.end.character);let l=new Se.Range(new Se.Position(o,s),new Se.Position(a,c));e.edit(u=>{u.replace(l,""),this.codeLensUpdatedEvent.fire()}).then(f,f)}selectCell(){let e=Se.window.activeTextEditor;if(e&&e.selection){let t=this.getStartEndCells(e.selection);if(t){let n=t[0],i=t[1];e.selection.anchor.isBeforeOrEqual(e.selection.active)?e.selection=new Se.Selection(n.range.start,i.range.end):e.selection=new Se.Selection(i.range.end,n.range.start)}}}selectCellContents(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCellIndex(e.selection);if(!t)return;let n=t[0],i=t[1],o=e.selection.anchor.isBeforeOrEqual(e.selection.active),s=this.cells,a=[];for(let c=n;c<=i;c+=1){let l=s[c],u=l.range.start.line+1,p=0,m=l.range.end.line,h=l.range.end.character;l.range.start.line===l.range.end.line&&(u=l.range.start.line,p=e.document.lineAt(u).range.end.character,m=u,h=p),o?a.push(new Se.Selection(u,p,m,h)):a.push(new Se.Selection(m,h,u,p))}e.selections=a}extendSelectionByCellAbove(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getStartEndCellIndex(e.selection);if(!n)return;let i=e.selection.anchor.isBefore(e.selection.active),o=this.cells,s=n[0],a=n[1],c=o[s],l=o[a];if(!c.range.start.isEqual(t.start)||!l.range.end.isEqual(t.end)){let u;i?s<a?u=new Se.Selection(c.range.start,o[a-1].range.end):u=new Se.Selection(c.range.end,c.range.start):u=new Se.Selection(l.range.end,c.range.start),e.selection=u}else{let u;i&&s<a?(u=o[a-1],e.selection=new Se.Selection(c.range.start,u.range.end)):s>0&&(u=o[s-1],e.selection=new Se.Selection(l.range.end,u.range.start)),u&&e.revealRange(u.range,Se.TextEditorRevealType.Default)}}extendSelectionByCellBelow(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getStartEndCellIndex(e.selection);if(!n)return;let i=e.selection.anchor.isBeforeOrEqual(e.selection.active),o=this.cells,s=n[0],a=n[1],c=o[s],l=o[a];if(!c.range.start.isEqual(t.start)||!l.range.end.isEqual(t.end)){let u;i?u=new Se.Selection(c.range.start,l.range.end):s<a?u=new Se.Selection(o[s+1].range.start,l.range.end):u=new Se.Selection(l.range.start,l.range.end),e.selection=u}else{let u;i||s===a?a<o.length-1&&(u=o[a+1],e.selection=new Se.Selection(c.range.start,u.range.end)):s<a&&(u=o[s+1],e.selection=new Se.Selection(l.range.end,u.range.start)),u&&e.revealRange(u.range,Se.TextEditorRevealType.Default)}}async moveCellsUp(){await this.moveCellsDirection(!0)}async moveCellsDown(){await this.moveCellsDirection(!1)}changeCellToMarkdown(){this.applyToCells((e,t,n)=>this.changeCellTo(e,t,"markdown"))}changeCellToCode(){this.applyToCells((e,t,n)=>this.changeCellTo(e,t,"code"))}gotoNextCell(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getCurrentCellLens(t.start),i=this.getNextCellLens(t.start);n&&i&&this.advanceToRange(i.range)}gotoPreviousCell(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getCurrentCellLens(t.start),i=this.getPreviousCellLens(t.start);n&&i&&this.advanceToRange(i.range)}applyToCells(e){let t=Se.window.activeTextEditor,n=this.getStartEndCellIndex(t?.selection);if(!t||!n)return;let i=this.cells,o=n[0],s=n[1];for(let a=o;a<=s;a+=1)e(t,i[a],a)}changeCellTo(e,t,n){if(n==="raw")throw Error("Cell Type raw not implemented");if(t.cell_type===n)return;let i=new fi(this.configService.getSettings(e.document.uri)),o=e.document.lineAt(t.range.start.line),s=e.document.getText(o.range),a=this.getDefaultCellMarker(e.document.uri),c=n==="markdown"?i.codeExecRegEx.exec(s):i.markdownExecRegEx.exec(s);if(!c)return;let l=c[c.length-1],u=n==="markdown"?`${a} [markdown]${l}`:`${a}${l}`;e.edit(async p=>{p.replace(o.range,u),t.cell_type=n,t.range.start.line<t.range.end.line&&(e.selection=new Se.Selection(t.range.start.line+1,0,t.range.end.line,t.range.end.character),Se.commands.executeCommand("editor.action.removeCommentLine").then(f,f),n==="markdown"&&Se.commands.executeCommand("editor.action.addCommentLine").then(f,f))}).then(f,f)}async moveCellsDirection(e){let t=Se.window.activeTextEditor;if(!t||!t.selection)return!1;let n=this.getStartEndCellIndex(t.selection);if(!n)return!1;let i=n[0],o=n[1],s=this.cells,a=s[i],c=s[o];if(!a||!c)return!1;let l=new Se.Range(a.range.start,c.range.end),u=new Se.Range(t.selection.start.line-l.start.line,t.selection.start.character,t.selection.end.line-l.start.line,t.selection.end.character),p=t.selection.active.isBefore(t.selection.anchor),m;if(e){if(i===0)return!1;{let h=s[i-1];m=this.exchangeTextLines(t,h.range,l).then(b=>(b&&(t.selection=new Se.Selection(h.range.start.line+u.start.line,u.start.character,h.range.start.line+u.end.line,u.end.character)),b))}}else{if(o===s.length-1)return!1;{let h=s[o+1],g=this.exchangeTextLines(t,l,h.range),b=h.range.end.line-h.range.start.line,w=l.end.line-l.start.line,k=b-w;m=g.then(N=>(N&&(t.selection=new Se.Selection(h.range.start.line+k+u.start.line,u.start.character,h.range.start.line+k+u.end.line,u.end.character)),N))}}return m.then(h=>(h&&p&&(t.selection=new Se.Selection(t.selection.active,t.selection.anchor)),!0))}exchangeTextLines(e,t,n){let i=t.start.line,o=t.end.line,s=n.start.line,a=n.end.line;if(o>=s)throw RangeError(`Above lines must be fully above not ${o} <= ${s}`);let c=new Se.Range(i,0,o,e.document.lineAt(o).range.end.character),l=e.document.getText(c),u=new Se.Range(s,0,a,e.document.lineAt(a).range.end.character),p=e.document.getText(u),m="";if(o+1<s){let b=o+1,w=s-1,k=new Se.Range(b,0,w,e.document.lineAt(w).range.end.character);m=`${e.document.getText(k)}
`}let h=`${p}
${m}${l}`,g=new Se.Range(c.start,u.end);return e.edit(b=>{b.replace(g,h),this.codeLensUpdatedEvent.fire()})}getStartEndCells(e){let t=this.getStartEndCellIndex(e);if(t){let n=this.getCellFromIndex(t[0]),i=this.getCellFromIndex(t[1]);return[n,i]}}getStartEndCellIndex(e){if(!e)return;let t=this.getCellIndex(e.start),n=t;if(e.start.line!==e.end.line&&(n=this.getCellIndex(e.end)),t===-1){if(n===-1)return;{t=0;let i=this.getCellFromIndex(0);if(e.start.line>i.range.start.line)throw RangeError(`Should not be able to pick a range with an end in a cell and start after a cell. ${e.start.line} > ${i.range.end.line}`)}}if(t>=0&&n>=0)return[t,n]}insertCell(e,t){let n=this.getDefaultCellMarker(e.document.uri),i=t>=e.document.lineCount?`
${n}
`:`${n}

`,o=new Se.Position(t,0),s=new Se.Position(t+1,0);e.edit(a=>{a.insert(o,i),this.codeLensUpdatedEvent.fire()}).then(f,f),e.selection=new Se.Selection(s,s)}getDefaultCellMarker(e){return this.configService.getSettings(e).defaultCellMarker||Ge.DefaultCodeCellMarker}onCodeLensFactoryUpdated(){this.document&&(this.codeLenses=this.codeLensFactory.createCodeLenses(this.document),this.cells=this.codeLensFactory.getCellRanges(this.document)),this.codeLensUpdatedEvent.fire()}onDocumentClosed(e){this.document&&bi(e.uri,this.document.uri)&&Q(this.disposables)}ondidCloseNotebook(e){e.notebookType===gt&&this.configService.getSettings(this.document?.uri).addGotoCodeLenses&&this.onCodeLensFactoryUpdated()}getActiveInteractiveWindow(){return this.interactiveWindowProvider.getOrCreate(this.document?.uri)}async addCode(e,t,n,i,o){let s=!1;try{o?s=await e.debugCode(t,n,i):s=await e.addCode(t,n,i)}catch(a){a instanceof Nf||await this.dataScienceErrorHandler.handleError(a)}return s}async runMatchingCell(e,t,n){let i=this.getCurrentCellLens(e.start),o=this.getNextCellLens(e.start);if(i&&this.document){let s=mh(this.document.getText(i.range));if(t){let c=Se.window.activeTextEditor,{newCellOnRunLast:l}=this.configService.getSettings(this.document.uri),u=new fi(this.configService.getSettings(this.document.uri));o?this.advanceToRange(o.range):l&&c&&!u.isEmptyCell(s)&&this.insertCell(c,i.range.end.line+1)}let a=await this.getActiveInteractiveWindow();await this.addCode(a,s,this.document.uri,i.range.start.line,n)}}getCellIndex(e){return this.cells.findIndex(t=>e&&t.range.contains(e))}getCellFromIndex(e){let t=this.cells,n=Uye(e,t.length);return t[n]}getCellFromPosition(e){if(!e){let t=Se.window.activeTextEditor;t&&t.selection&&(e=t.selection.active)}if(e){let t=this.getCellIndex(e);if(t>=0)return this.cells[t]}}getCurrentCellLens(e){return this.codeLenses.find(t=>t.range.contains(e)&&t.command!==void 0&&t.command.command===$.RunCell)}getNextCellLens(e){let t=this.codeLenses.findIndex(n=>n.range.contains(e)&&n.command!==void 0&&n.command.command===$.RunCell);if(t>=0)return this.codeLenses.find((n,i)=>n.command!==void 0&&n.command.command===$.RunCell&&i>t)}getPreviousCellLens(e){let t=this.codeLenses.findIndex(n=>n.range.contains(e)&&n.command!==void 0&&n.command.command===$.RunCell);if(t>=1)return this.codeLenses.find((n,i)=>n.command!==void 0&&i<t&&i+1===t)}async runFileAsOneCell(e){if(this.document){let t=await this.getActiveInteractiveWindow(),n=this.document.getText();await this.addCode(t,n,this.document.uri,0,e)}}advanceToRange(e){let t=Se.window.activeTextEditor,n=new Se.Selection(e.start,e.start);t&&(t.selection=n,t.revealRange(e,Se.TextEditorRevealType.Default))}};v([Qr("DATASCIENCE.DEBUG_CURRENT_CELL")],tr.prototype,"debugCurrentCell",1),v([Qr("DATASCIENCE.RUN_ALL_CELLS")],tr.prototype,"runAllCells",1),v([Qr("DATASCIENCE.RUN_FILE_INTERACTIVE")],tr.prototype,"runFileInteractive",1),v([Qr("DATASCIENCE.DEBUG_FILE_INTERACTIVE")],tr.prototype,"debugFileInteractive",1),v([Qr("DATASCIENCE.RUN_ALL_CELLS_ABOVE")],tr.prototype,"runAllCellsAbove",1),v([Qr("DATASCIENCE.RUN_CELL_AND_ALL_BELOW")],tr.prototype,"runCellAndAllBelow",1),v([Qr("DATASCIENCE.RUN_SELECTION_OR_LINE")],tr.prototype,"runSelectionOrLine",1),v([Qr("DATASCIENCE.RUN_TO_LINE")],tr.prototype,"runToLine",1),v([Qr("DATASCIENCE.RUN_FROM_LINE")],tr.prototype,"runFromLine",1),v([ti("CodeWatcher::runCell",4)],tr.prototype,"runCell",1),v([Qr("DATASCIENCE.DEBUG_CURRENT_CELL")],tr.prototype,"debugCell",1),v([Qr("DATASCIENCE.RUN_CURRENT_CELL")],tr.prototype,"runCurrentCell",1),v([Qr("DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE")],tr.prototype,"runCurrentCellAndAdvance",1),v([dr("DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW")],tr.prototype,"runCurrentCellAndAddBelow",1),v([dr("DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION")],tr.prototype,"insertCellBelowPosition",1),v([dr("DATASCIENCE.RUN_INSERT_CELL_BELOW")],tr.prototype,"insertCellBelow",1),v([dr("DATASCIENCE.RUN_INSERT_CELL_ABOVE")],tr.prototype,"insertCellAbove",1),v([dr("DATASCIENCE.RUN_DELETE_CELLS")],tr.prototype,"deleteCells",1),v([dr("DATASCIENCE.RUN_SELECT_CELL")],tr.prototype,"selectCell",1),v([dr("DATASCIENCE.RUN_SELECT_CELL_CONTENTS")],tr.prototype,"selectCellContents",1),v([dr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE")],tr.prototype,"extendSelectionByCellAbove",1),v([dr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW")],tr.prototype,"extendSelectionByCellBelow",1),v([dr("DATASCIENCE.RUN_MOVE_CELLS_UP")],tr.prototype,"moveCellsUp",1),v([dr("DATASCIENCE.RUN_MOVE_CELLS_DOWN")],tr.prototype,"moveCellsDown",1),v([dr("DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN")],tr.prototype,"changeCellToMarkdown",1),v([dr("DATASCIENCE.RUN_CHANGE_CELL_TO_CODE")],tr.prototype,"changeCellToCode",1),v([dr("DATASCIENCE.GOTO_NEXT_CELL_IN_FILE")],tr.prototype,"gotoNextCell",1),v([dr("DATASCIENCE.GOTO_PREV_CELL_IN_FILE")],tr.prototype,"gotoPreviousCell",1),tr=v([(0,_d.injectable)(),d(0,(0,_d.inject)(Oi)),d(1,(0,_d.inject)(le)),d(2,(0,_d.inject)(Bk)),d(3,(0,_d.inject)(Yr)),d(4,(0,_d.inject)(S0))],tr);var Vb=_(O()),Yn=_(require("vscode"));var Dd=require("vscode");var Wb=class{constructor(e,t,n){this.configuration=t;this.extensionChecker=n;this.computeDecorations(),e.push(this),e.push(this.configuration.getSettings(void 0).onDidChange(this.settingsChanged,this)),e.push(Yn.window.onDidChangeActiveTextEditor(this.changedEditor,this)),e.push(Yn.window.onDidChangeTextEditorSelection(this.changedSelection,this)),e.push(Yn.workspace.onDidChangeTextDocument(this.changedDocument,this)),this.settingsChanged()}activate(){}dispose(){this.timer&&clearTimeout(this.timer)}settingsChanged(){Yn.window.activeTextEditor&&this.triggerUpdate(Yn.window.activeTextEditor)}changedEditor(){this.triggerUpdate(void 0)}changedDocument(e){Yn.window.activeTextEditor&&e.document===Yn.window.activeTextEditor.document&&this.triggerUpdate(Dd.window.activeTextEditor)}changedSelection(e){e.textEditor&&e.textEditor.selection.anchor&&this.triggerUpdate(e.textEditor)}triggerUpdate(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>this.update(e),100)}computeDecorations(){this.currentCellTopUnfocused=Dd.window.createTextEditorDecorationType({borderColor:new Yn.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottomUnfocused=Dd.window.createTextEditorDecorationType({borderColor:new Yn.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellTop=Dd.window.createTextEditorDecorationType({borderColor:new Yn.ThemeColor("interactive.activeCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottom=Dd.window.createTextEditorDecorationType({borderColor:new Yn.ThemeColor("interactive.activeCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0})}cellDecorationEnabled(e){return e.decorateCells===!1?!1:e.decorateCells==="currentCell"||e.decorateCells==="allCells"}update(e){let t=e===void 0?Dd.window.visibleTextEditors:[e];for(let n of t)if(n&&n.document&&n.document.languageId===xe&&!Yh(n.document)&&this.currentCellTop&&this.currentCellBottom&&this.currentCellTopUnfocused&&this.currentCellBottomUnfocused&&this.extensionChecker.isPythonExtensionInstalled){let i=this.configuration.getSettings(n.document.uri);if(this.cellDecorationEnabled(i)){let o=qC(n.document,i),s=o.map(u=>u.range).filter(u=>u.contains(n.selection.anchor)),a=s.length>0?[new Yn.Range(s[0].start,s[0].start)]:[],c=i.decorateCells!=="allCells"&&s.length>0?[new Yn.Range(s[0].end,s[0].end)]:[],l=[];i.decorateCells==="allCells"&&o.forEach(u=>{let p=u.range.start;p!==s[0].start&&l.push(new Yn.Range(p,p))}),Dd.window.activeTextEditor===n?(n.setDecorations(this.currentCellTop,a),n.setDecorations(this.currentCellBottom,c),n.setDecorations(this.currentCellTopUnfocused,l),n.setDecorations(this.currentCellBottomUnfocused,[])):(n.setDecorations(this.currentCellTop,[]),n.setDecorations(this.currentCellBottom,[]),n.setDecorations(this.currentCellTopUnfocused,[...l,...a]),n.setDecorations(this.currentCellBottomUnfocused,c))}else n.setDecorations(this.currentCellTop,[]),n.setDecorations(this.currentCellBottom,[]),n.setDecorations(this.currentCellTopUnfocused,[]),n.setDecorations(this.currentCellBottomUnfocused,[])}}};Wb=v([(0,Vb.injectable)(),d(0,(0,Vb.inject)(F)),d(1,(0,Vb.inject)(le)),d(2,(0,Vb.inject)(ze))],Wb);var oz=_(O()),sz=require("vscode");var T0=class{constructor(){this.codeGeneratorsByFile=new uo}clear(){this.codeGeneratorsByFile.clear()}get all(){return[...this.codeGeneratorsByFile.entries()].map(e=>({uri:e[0],generatedCodes:e[1].filter(t=>!t.deleted)})).filter(e=>e.generatedCodes.length>0)}getFileGeneratedCode(e){return this.codeGeneratorsByFile.get(e)||[]}store(e,t){let n=this.codeGeneratorsByFile.get(e)||[],i=!1;for(let o=0;o<n.length&&!i;o+=1){let s=n[o];t.line>=s.line&&t.line<=s.endLine?(n.splice(o,1,t),i=!0):s.line>t.line&&(n.splice(o,0,t),i=!0)}i||n.push(t),this.codeGeneratorsByFile.set(e,n)}};var Bb=class{constructor(){this.storages=new WeakMap}getOrCreate(e){return this.storages.has(e)||this.storages.set(e,new T0),this.storages.get(e)}get(e){if("notebook"in e)return this.storages.get(e.notebook);{let t=sz.workspace.notebookDocuments.find(n=>this.storages.get(n)?.all.find(o=>o.uri.toString()===e.fileUri.toString()));return t?this.storages.get(t):void 0}}};Bb=v([(0,oz.injectable)()],Bb);var ku=_(O()),Td=_(require("vscode"));var qb=class{constructor(e,t,n,i){this.variableProvider=e;this.interactiveProvider=t;this.disposables=n;this.kernelProvider=i;this.runFiles=new Set;this.stopWatch=new qe}activate(){Td.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables),this.kernelProvider.onDidRestartKernel(()=>this.runFiles.clear(),this,this.disposables)}dispose(){this.hoverProviderRegistration&&this.hoverProviderRegistration.dispose()}async onDidChangeNotebookCellExecutionState(e){try{if(e.cell.notebook.notebookType!==gt)return;let t=this.runFiles.size,n=as(e.cell);n!==void 0&&this.runFiles.add(n.interactive.uristring),t!==this.runFiles.size&&await this.initializeHoverProvider()}catch(t){x(t)}}async provideHover(e,t,n){this.stopWatch.reset();let i=await pr(300,this.getVariableHover(e,t,n));return A("DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",{duration:this.stopWatch.elapsedTime},{isResultNull:!!i}),i}async initializeHoverProvider(){this.hoverProviderRegistration||(this.hoverProviderRegistration=Td.languages.registerHoverProvider(Sj,this))}async getVariableHover(e,t,n){let i=e.getWordRangeAtPosition(t);if(i){let o=e.getText(i);if(o){let s=this.getMatchingKernels(e);if(s.length){let a=await fr(n,{},...s.map(l=>this.variableProvider.getVariableProperties(o,l,n))),c=Object.entries(a||{});if(c.length>0){let l=c.reduce((p,m)=>p+`${m[0]}: ${m[1]}
`,"```\n")+"```";return{contents:[new Td.MarkdownString(l)]}}}}}}getMatchingKernels(e){let t=this.interactiveProvider.get(e.uri)?.notebookUri;if(!t)return[];let n=new Set;return Td.workspace.notebookDocuments.filter(i=>t?.toString()===i.uri.toString()).forEach(i=>{let o=this.kernelProvider.get(i);o&&n.add(o)}),Array.from(n)}};qb=v([(0,ku.injectable)(),d(0,(0,ku.inject)(Rn)),d(0,(0,ku.named)(Ge.KERNEL_VARIABLES)),d(1,(0,ku.inject)(Oi)),d(2,(0,ku.inject)(F)),d(3,(0,ku.inject)(Ke))],qb);var To=_(O()),Hr=require("vscode");var Lt=require("vscode");var az=_(So());var Mf=class{constructor(e,t,n,i,o){this.serviceContainer=e;this._owner=t;this.controllerFactory=n;this.inputUri=o;this._onDidChangeViewState=new Lt.EventEmitter;this.closedEvent=new Lt.EventEmitter;this._submitters=[];this.internalDisposables=[];this.fs=this.serviceContainer.get(st),this.configuration=this.serviceContainer.get(le),this.jupyterExporter=this.serviceContainer.get(sg),this.interactiveWindowDebugger=this.serviceContainer.tryGet(x0),this.errorHandler=this.serviceContainer.get(Yr),this.codeGeneratorFactory=this.serviceContainer.get(Ob),this.storageFactory=this.serviceContainer.get($s),this.kernelProvider=this.serviceContainer.get(Ke),this.debuggingManager=this.serviceContainer.get(w0),this.notebookUri=Rf(i)?i.input.uri:i.notebook.uri,this._owner&&this._submitters.push(this._owner),Lt.window.onDidChangeActiveNotebookEditor(s=>{s?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire()},this.internalDisposables),Lt.workspace.onDidCloseNotebookDocument(s=>{s.uri.toString()===this.notebookUri.toString()&&this.closedEvent.fire()},this.internalDisposables),Lt.window.activeNotebookEditor?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire(),this.cellMatcher=new fi(this.configuration.getSettings(this.owningResource)),this.notebookDocument&&this.codeGeneratorFactory.getOrCreate(this.notebookDocument)}get onDidChangeViewState(){return this._onDidChangeViewState.event}get closed(){return this.closedEvent.event}get owner(){return this._owner}get submitters(){return this._submitters}get notebookDocument(){return this._notebookDocument||(this._notebookDocument=Lt.workspace.notebookDocuments.find(e=>e.uri.toString()===this.notebookUri.toString())),this._notebookDocument}get kernelConnectionMetadata(){return this.controller?.metadata}notifyConnectionReset(){if(this.notebookDocument)this.controller||(this.controller=this.initController(this.notebookDocument)),this.controller.setInfoMessageCell(y.noKernelConnected);else{let e=Lt.workspace.onDidOpenNotebookDocument(t=>{t.uri.toString()===this.notebookUri.toString()&&(this._notebookDocument=t,this.controller=this.initController(t),this.internalDisposables.push(this.controller.listenForControllerSelection()),this.controller.setInfoMessageCell(y.noKernelConnected),e.dispose())})}}initController(e){let t=this.controllerFactory.create(e,this.errorHandler,this.kernelProvider,this._owner);return this.internalDisposables.push(t.listenForControllerSelection()),t}async ensureInitialized(){if(!this.notebookDocument&&(E("Showing Interactive editor to initialize codeGenerator from notebook document"),await this.showInteractiveEditor(),!this.notebookDocument))throw new Error("Could not open notebook document for Interactive Window");this.codeGeneratorFactory.get(this.notebookDocument)||this.codeGeneratorFactory.getOrCreate(this.notebookDocument),this.controller||(this.controller=this.initController(this.notebookDocument)),this.controller.controller?this.controller.startKernel().catch(f):(z("No controller selected for Interactive Window initialization"),this.controller.setInfoMessageCell(y.selectKernelForEditor))}async showInteractiveEditor(){let e;Lt.window.tabGroups.all.find(i=>{i.tabs.find(o=>{Rf(o)&&o.input.uri.toString()==this.notebookUri.toString()&&(e=o)})});let t=this.notebookDocument||await this.openNotebookDocument();return await Lt.window.showNotebookDocument(t,{preserveFocus:!0,viewColumn:e?.group.viewColumn})}async openNotebookDocument(){return E(`Opening notebook document ${this.notebookUri}`),await Lt.workspace.openNotebookDocument(this.notebookUri)}dispose(){this.internalDisposables.forEach(e=>e.dispose()),this.controller?.disconnect()}async showErrorForCell(e,t){let n=this.controller?.controller,i=Oh(e);if(n&&i&&t){let o=Gi.getOrCreate(t,new yf(n));try{await o.appendOutput(i)}catch(s){j(`Could not append error message "${i}" to cell: ${s}`)}finally{o.end(!1,t.executionSummary?.timing?.endTime)}}else z(`Could not append error message to cell "${i}"`)}changeMode(e){this.controller?.updateMode(e)}async addCode(e,t,n){return this.submitCode(e,t,n,!1)}useNewDebugMode(){return!!(this.configuration.getSettings(this.owner).forceIPyKernelDebugger||this.controller?.metadata&&!dt(this.controller.metadata))}async debugCode(e,t,n){let i=!0,o=Lt.workspace.textDocuments.find(a=>this.fs.arePathsSame(a.uri,t));if(!this.useNewDebugMode()&&o&&o.isUntitled){let a=[...Lt.workspace.textDocuments];if(i=await o.save(),i){let c=Lt.workspace.textDocuments.filter(l=>a.indexOf(l)===-1);c&&c.length>0&&(t=(c.find(u=>u.languageId==="python")||c.find(u=>!u.fileName.endsWith(".interactive"))||c[0]).uri,await Lt.workspace.openTextDocument(t))}}let s=!0;return i?this.submitCode(e,t,n,!0):s}async submitCode(e,t,n,i){if(this.cellMatcher.isEmptyCell(e)||!this.controller?.controller)return!0;this.updateOwners(t);let o=Fe(e,{trim:!1}),s=new fi(this.configuration.getSettings(t)),a=-1;s.isMarkdown(o[0])&&mm(o,(u,p)=>void 0,(u,p)=>{u&&u.length>0&&a===-1&&(a=p)});let l=(a>0?[o.slice(0,a).join(`
`),o.slice(a).join(`
`)]:[e]).map(u=>{let p=ue();this.controller.setPendingCellAdd(p.promise);let m=this.addNotebookCell(u,t,n),h=this.createExecutionPromise(m,i);return h.catch(g=>{g instanceof Nf?m.then(b=>{g.cell!==b&&this.showErrorForCell(y.cellStopOnErrorMessage,b).then(f,f)}).catch(f):m.then(b=>this.errorHandler.getErrorMessageForDisplayInCell(g,"execution",this.owningResource).then(w=>this.showErrorForCell(w,b))).catch(f)}).finally(()=>{p?.resolve()}),h});return l[l.length-1]}async createExecutionPromise(e,t){if(!this.controller||!this.notebookDocument)return!1;ne("InteractiveWindow.ts.createExecutionPromise.start");let n=this.controller.startKernel(),i=await e,o=!0,s=async()=>void 0;try{let a=await n;await this.generateCodeAndAddMetadata(i,t,a),t&&this.useNewDebugMode()?await this.debuggingManager.start(this.notebookDocument,i):t&&dt(a.kernelConnectionMetadata)&&this.interactiveWindowDebugger&&(s=async()=>this.interactiveWindowDebugger?.detach(a),await this.interactiveWindowDebugger.attach(a),await this.interactiveWindowDebugger.updateSourceMaps(this.storageFactory.get({notebook:i.notebook})?.all||[]),this.interactiveWindowDebugger.enable(a)),ne("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell");let c=as(i);o=await this.kernelProvider.getKernelExecution(a).executeCell(i,c?.generatedCode?.code).then(()=>!0,()=>!1),ne("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell.finished")}finally{await s(),ne("InteractiveWindow.ts.createExecutionPromise.end")}if(!o)throw new Nf(i);return o}async expandAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{await Lt.commands.executeCommand("notebook.cell.expandCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async collapseAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{e.kind===Lt.NotebookCellKind.Code&&await Lt.commands.executeCommand("notebook.cell.collapseCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async scrollToCell(e){let t=await this.showInteractiveEditor(),n=t.notebook.getCells().find(i=>as(i)?.id===e);if(n){let i=new Lt.NotebookRange(n.index,n.index+1);t.revealRange(i,Lt.NotebookEditorRevealType.Default),t.selection=i}}async hasCell(e){let t=this.notebookDocument;return!!t&&t.getCells().some(n=>as(n)?.id===e)}get owningResource(){if(this.owner)return this.owner;let e=Is();if(e)return e}updateOwners(e){this._owner||(this._owner=e,this.controller?.updateOwners(e)),this._submitters.find(t=>t.toString()==e.toString())||this._submitters.push(e)}async addNotebookCell(e,t,n){let i=this.notebookDocument;if(!i)throw new Error("No notebook document");let o=this.configuration.getSettings(this.owningResource),s=this.cellMatcher.getCellType(e)===hS,a=s?eP(Fe(e)).join(""):rz(e,o,this.cellMatcher),c=this.cellMatcher.getFirstMarker(e),l=Lt.workspace.textDocuments.find(g=>g.uri.toString()===this.owner?.toString())?.languageId??xe,u=new Lt.NotebookCellData(s?Lt.NotebookCellKind.Markup:Lt.NotebookCellKind.Code,a,s?hS:l),p={uristring:t.toString(),lineIndex:n,originalSource:e},m={interactiveWindowCellMarker:c,interactive:p,id:(0,az.default)()};u.metadata=m,await qs(i,g=>{let b=Lt.NotebookEdit.insertCells(i.cellCount,[u]);g.set(i.uri,[b])});let h=i.cellCount-1;return i.cellAt(h)}async generateCodeAndAddMetadata(e,t,n){let i=as(e);if(!i)return;let o=!dt(n.kernelConnectionMetadata)||this.configuration.getSettings(void 0).forceIPyKernelDebugger,s=await this.codeGeneratorFactory.getOrCreate(this.notebookDocument).generateCode(i,e.index,t,o),a={...i,generatedCode:s},c=new Lt.WorkspaceEdit,l=Lt.NotebookEdit.updateCellMetadata(e.index,a);c.set(e.notebook.uri,[l]),await Lt.workspace.applyEdit(c)}async export(){if(!this.notebookDocument)throw new Error("no notebook to export.");let{magicCommandsAsComments:e}=this.configuration.getSettings(this.owningResource),t=ez(this.notebookDocument,e);if(t){let n=await new Ka().showDialog("ipynb",this.owningResource);n&&await this.jupyterExporter?.exportToFile(t,Pe(n))}}async exportAs(){if(await this.ensureInitialized(),!this.controller)throw new Error("An active kernel is required to export the notebook.");let e=this.controller.kernel?.value;e&&await aP({},e.kernelConnectionMetadata);let n;if(this.submitters&&this.submitters.length){let i=this.submitters[this.submitters.length-1];n=De(i.path,Wi(i.path))}Br()?Lt.commands.executeCommand($.ExportAsPythonScript,this.notebookDocument,e?.kernelConnectionMetadata.interpreter).then(f,f):Lt.commands.executeCommand($.Export,this.notebookDocument,n,e?.kernelConnectionMetadata.interpreter).then(f,f)}};v([$R()],Mf.prototype,"showErrorForCell",1),v([$R()],Mf.prototype,"createExecutionPromise",1);function cz(r){return y.interactiveWindowTitleFormat(De(r.path))}var lL=class{constructor(e,t,n,i,o,s,a){this.controllerService=e;this.mode=t;this.notebook=n;this.errorHandler=i;this.kernelProvider=o;this.owner=s;this.disposables=[];this.controller=a?.controller,this.metadata=a?.connection}updateMode(e){this.mode=e}updateOwners(e){this.owner=e}async startKernel(){if(this.connectingListener?.dispose(),this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Interactive Window kernel not selected");this.setInfoMessage(this.metadata,0);try{let e=await this.createKernel(),t=async()=>{this.notebook&&this.metadata&&(this.systemInfoCell=void 0,this.setInfoMessage(this.metadata,1))};return this.disposables.push(e.addHook("willRestart",t)),e.onRestarted(async()=>{E("Restart event handled in IW"),this.fileInKernel=void 0;try{await this.setFileInKernel(e)}catch{x("Failed to run initialization after restarting")}finally{this.finishSysInfoMessage(e,1)}},this,this.disposables),this.fileInKernel=void 0,await this.setFileInKernel(e),this.finishSysInfoMessage(e,0),e}catch(e){throw this.owner?this.deleteSysInfoCell():await this.finishSysInfoWithFailureMessage(e),e}}async createKernel(){if(this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Controller not selected");let e=ue();e.promise.catch(f),this.kernel=e;try{let{kernel:t,actualController:n}=await this.controllerService.createKernel(this.metadata,this.controller,this.owner,this.notebook,this.disposables);return this.metadata=t.kernelConnectionMetadata,this.controller=n,this.disposables.push(t),e.resolve(t),t}catch(t){throw e.reject(t),this.disconnect(),t}}async setFileInKernel(e){let t=this.owner;if(!t){ne("Unable to run initialization for IW");return}let n=Pe(t),i=this.kernelProvider.getKernelExecution(e);this.mode==="perFile"&&!this.fileInKernel?(E(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${n.replace(/\\/g,"\\\\")}'`)):(!this.fileInKernel||this.fileInKernel.toString()!==t.toString())&&this.mode!=="perFile"?(E(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${n.replace(/\\/g,"\\\\")}'`)):E(`Not Initializing __file__ in setFileInKernel with ${n} for mode ${this.mode} currently ${this.fileInKernel}`)}setPendingCellAdd(e){this.metadata&&this.notebook&&this.controllerService.getRegisteredController(this.metadata)?.setPendingCellAddition(this.notebook,e)}listenForControllerSelection(){return this.controllerService.onControllerSelected(e=>{if(!(!this.notebook||e.notebook.uri.toString()!==this.notebook?.uri?.toString())&&e.controller.id!==this.controller?.id){let t=!!this.kernel;this.disconnect(),this.controller=e.controller.controller,this.metadata=e.controller.connection,t?this.startKernel().catch(f):(this.connectingListener?.dispose(),this.connectingListener=e.controller.onConnecting(()=>{this.startKernel().catch(f)}),this.disposables.push(this.connectingListener))}},this)}setInfoMessageCell(e){this.systemInfoCell?this.systemInfoCell.updateMessage(e).catch(t=>j(`could not update info cell with message: "${e}", error: ${t}`)):this.systemInfoCell=new k0(this.notebook,e)}setInfoMessage(e,t){let n=zG(e,t);this.setInfoMessageCell(n)}finishSysInfoMessage(e,t){let n=QG(e.kernelConnectionMetadata,t);this.systemInfoCell?.updateMessage(n).catch(i=>j(`System info message was not updated: "${n}" because of error: ${i}`)),this.systemInfoCell=void 0}async finishSysInfoWithFailureMessage(e){let t=await this.errorHandler.getErrorMessageForDisplayInCell(e,"start",this.owner);t=t.split(`
`).join(`  
`),this.systemInfoCell?.updateMessage(t).catch(n=>j(`System info message was not updated: "${t}" because of error: ${n}`)),this.systemInfoCell=void 0}deleteSysInfoCell(){this.systemInfoCell?.deleteCell().then(f,f),this.systemInfoCell=void 0}disconnect(){this.disposables.forEach(e=>e.dispose()),this.disposables=[],this.kernel=void 0}},$C=class{constructor(e,t,n){this.controllerService=e;this.mode=t;this.initialController=n}create(e,t,n,i){let o=this.initialController,s=this.controllerService.getSelectedController(e);return s&&(o=s),new lL(this.controllerService,this.mode,e,t,n,i,o)}};var lz="ds_asked_per_file_interactive",uz="ds_interactive_window_cache",Jb=class{constructor(e,t,n,i,o,s,a,c){this.serviceContainer=e;this.disposables=t;this.fs=n;this.configService=i;this.globalMemento=o;this.workspaceMemento=s;this.notebookEditorProvider=a;this.controllerHelper=c;this._onDidChangeActiveInteractiveWindow=new Hr.EventEmitter;this._windows=[];this.notebookEditorProvider.registerEmbedNotebookProvider(this),this.restoreWindows()}get onDidChangeActiveInteractiveWindow(){return this._onDidChangeActiveInteractiveWindow.event}get activeWindow(){let e=Hr.window.activeNotebookEditor?.notebook.uri.toString();return e?this._windows.find(t=>t.notebookUri?.toString()===e):void 0}restoreWindows(){let e=new Map;Hr.window.tabGroups.all.forEach(t=>{t.tabs.forEach(n=>{Rf(n)&&n.input.uri&&e.set(n.input.uri.toString(),n)})}),this.workspaceMemento.get(uz,[]).forEach(t=>{if(!t.uriString||!e.get(t.uriString))return;let n=e.get(t.uriString);if(!n)return;let i=this.configService.getSettings(n.input.uri).interactiveWindowMode,o=new Mf(this.serviceContainer,Hr.Uri.parse(t.owner),new $C(this.controllerHelper,i),n,Hr.Uri.parse(t.inputBoxUriString));o.notifyConnectionReset(),this._windows.push(o),A("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!1,hasOwner:!!t.owner,mode:i,restored:!0});let s=o.closed(this.onInteractiveWindowClosed.bind(this,o));this.disposables.push(o),this.disposables.push(s),this.disposables.push(o.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this)))}),this._updateWindowCache()}async getOrCreate(e,t){if(!Hr.workspace.isTrusted)throw new Error("Workspace not trusted");let n=await this.getInteractiveMode(e);this.pendingCreations&&await this.pendingCreations.catch(f);let i=this.getExisting(e,n,t);return i||(i=await this.create(e,n,t)),await i.ensureInitialized(),i}get(e){let t=this.configService.getSettings(e).interactiveWindowMode;return this.getExisting(e,t)}async create(e,t,n){let i=ue();this.pendingCreations=i.promise;try{let o=await this.controllerHelper.getInitialController(e,n);z(`Starting interactive window for resource '${W(e)}' with controller '${o?.id}'`);let[s,a]=await this.createEditor(o,e,t);o&&o.controller.updateNotebookAffinity(a.notebook,Hr.NotebookControllerAffinity.Preferred),E(`Interactive Window Editor Created: ${a.notebook.uri.toString()} with input box: ${s.toString()}`);let c=new Mf(this.serviceContainer,e,new $C(this.controllerHelper,t,o),a,s);this._windows.push(c),A("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!!o,hasOwner:!!e,mode:t,restored:!1}),this._updateWindowCache(),this.lastActiveInteractiveWindow=c;let l=c.closed(this.onInteractiveWindowClosed.bind(this,c));return this.disposables.push(c),this.disposables.push(l),this.disposables.push(c.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this))),c}finally{i.resolve()}}async createEditor(e,t,n){let i=e?`${It}/${e.id}`:void 0,o=t!==void 0,s=this.getInteractiveViewColumn(t),{inputUri:a,notebookEditor:c}=await Hr.commands.executeCommand("interactive.open",{viewColumn:s,preserveFocus:o},void 0,i,t&&n==="perFile"?cz(t):void 0);if(!c)throw new Error("Failed to request creation of interactive window from VS Code.");return[a,c]}getInteractiveViewColumn(e){if(e)return Hr.ViewColumn.Beside;let t=this.configService.getSettings(e).interactiveWindowViewColumn;return t==="secondGroup"?Hr.ViewColumn.One:t==="active"?Hr.ViewColumn.Active:Hr.ViewColumn.Beside}async getInteractiveMode(e){let t=this.configService.getSettings(e).interactiveWindowMode;if(t==="multiple"&&e&&!this.globalMemento.get(lz)&&this._windows.length===1&&(!this._windows[0].owner||!this.fs.arePathsSame(this._windows[0].owner,e))){this.globalMemento.update(lz,!0).then(f,f);let n=[y.interactiveWindowModeBannerSwitchYes,y.interactiveWindowModeBannerSwitchNo];await Hr.window.showInformationMessage(y.interactiveWindowModeBannerTitle,...n)===n[0]&&(t="perFile",this._windows[0].changeMode(t),await this.configService.updateSetting("interactiveWindow.creationMode",t,e,Hr.ConfigurationTarget.Global))}return t}_updateWindowCache(){let e=this._windows.map(t=>({owner:t.owner?.toString(),uriString:t.notebookUri.toString(),inputBoxUriString:t.inputUri.toString()}));this.workspaceMemento.update(uz,e).then(f,f)}getExisting(e,t,n){return t==="single"?this._windows.length>0?this._windows[0]:void 0:t==="multiple"?e?this.activeWindow||this.lastActiveInteractiveWindow||this._windows[0]:void 0:this._windows.find(i=>!e&&!i.owner&&!n?!0:e&&i.owner&&this.fs.arePathsSame(e,i.owner)?!n||i.kernelConnectionMetadata?.id===n.id:!1)}raiseOnDidChangeActiveInteractiveWindow(){this.lastActiveInteractiveWindow=this.activeWindow?this.activeWindow:this.lastActiveInteractiveWindow,this._onDidChangeActiveInteractiveWindow.fire(this.activeWindow)}onInteractiveWindowClosed(e){E(`Closing interactive window: ${e.notebookUri?.toString()}`),e.dispose(),this._windows=this._windows.filter(t=>t!==e),this._updateWindowCache(),this.lastActiveInteractiveWindow===e&&(this.lastActiveInteractiveWindow=this._windows[0]),this.raiseOnDidChangeActiveInteractiveWindow()}getActiveOrAssociatedInteractiveWindow(){if(this.activeWindow)return this.activeWindow;if(Hr.window.activeTextEditor===void 0)return;let e=Hr.window.activeTextEditor.document.uri;if(e.scheme!==_l)return this.get(e)}findNotebookEditor(e){let t;if(e&&e.path.endsWith(".interactive"))t=this.get(e)?.notebookDocument;else{let n=this.configService.getSettings(e).interactiveWindowMode;t=this.getExisting(e,n)?.notebookDocument}return t?Hr.window.visibleNotebookEditors.find(n=>n.notebook===t):void 0}findAssociatedNotebookDocument(e){return this._windows.find(i=>i.inputUri?.toString()===e.toString())?.notebookDocument}getInteractiveWindowWithNotebook(e){let t;return e!==void 0?t=this._windows.find(n=>n.notebookUri?.toString()===e.toString()):t=this.getActiveOrAssociatedInteractiveWindow(),t}getInteractiveWindowsWithSubmitter(e){return this._windows.filter(t=>t.submitters.find(n=>this.fs.arePathsSame(e,n)))}};Jb=v([(0,To.injectable)(),d(0,(0,To.inject)(ut)),d(1,(0,To.inject)(F)),d(2,(0,To.inject)(st)),d(3,(0,To.inject)(le)),d(4,(0,To.inject)($e)),d(4,(0,To.named)(St)),d(5,(0,To.inject)($e)),d(5,(0,To.named)(ri)),d(6,(0,To.inject)(mi)),d(7,(0,To.inject)(C0))],Jb);var Rd=_(O());var $b=class{constructor(e,t,n,i,o){this.kernelProvider=e;this.codeGeneratorFactory=n;this.storageFactory=i;this.controllers=o;this.disposables=[];t.push(this)}dispose(){Q(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.controllers.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onNotebookControllerSelected({notebook:e}){this.storageFactory.get({notebook:e})?.clear(),this.codeGeneratorFactory.get(e)?.reset()}onDidCreateKernel(e){let t=e.notebook;e.creator!=="jupyterExtension"||t.notebookType!==gt||(this.storageFactory.get({notebook:t})?.clear(),e.onRestarted(()=>{this.storageFactory.get({notebook:t})?.clear(),this.codeGeneratorFactory.getOrCreate(t).reset()},this,this.disposables))}};$b=v([(0,Rd.injectable)(),d(0,(0,Rd.inject)(Ke)),d(1,(0,Rd.inject)(F)),d(2,(0,Rd.inject)(Ob)),d(3,(0,Rd.inject)($s)),d(4,(0,Rd.inject)(Ct))],$b);var Gb=_(O()),$z=require("vscode");var Jz=qz(),A0=/(;32m[ ->]*?)(\d+)(.*)/g,Hb=class{constructor(e,t,n){this.storageFactory=e;this.platformService=t;this.configurationService=n}format(e,t){if(e.notebook.notebookType!==gt)return t;let n=this.storageFactory.get({notebook:e.notebook}),i=t.some(a=>/^[Input|Cell|File].*?\n.*/.test(a));if(!i&&!n)return t;let s=this.configurationService.getSettings(e.document.uri)?.formatStackTraces??!1;return t.map(a=>i?this.modifyTracebackFrameIPython8(a,n?.all,s):s?this.modifyTracebackFrameIPython7(a,n.all):a)}modifyTracebackFrameIPython8(e,t,n){e=e.replace(/\u001b\[4\dm/g,""),e=e.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),e=e.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(u,p,m,h)=>(h=h.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${p}${m}${h}
`)),ne(`Trace frame to match: ${e}`);let i,o,s=/Cell\s+(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\],\s*line (?<lineNumber>\d+).*/,c=/Input\s+?(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\].*line: (?<lineNumber>\d).*/.exec(e),l=s.exec(e);if(c&&c.groups?.executionCount&&c.groups?.lineNumber?(i=parseInt(c.groups.executionCount),o=c.groups?.lineNumber):l&&l.groups?.executionCount&&l.groups?.lineNumber&&(i=parseInt(l.groups.executionCount),o=l.groups.lineNumber),t&&i){let u,p;for(let m of t)if(p=m.generatedCodes.find(h=>h.executionCount===i),p){u=m.uri;break}if(p&&u){let m=e;return n&&(m=m.replace(A0,(h,g,b,w)=>{let k=parseInt(b,10),V=(p.hasCellMarker?p.line-1:p.line)-1+p.lineOffsetRelativeToIndexOfFirstLineInCell+k;return`${g}<a href='${u?.toString()}?line=${V-1}'>${V}</a>${w}`})),m.replace(/.*?\n/,`File \x1B[1;32m${Pe(u)}:${o}\x1B[0m
`)}}if(n){let u=/^File.*?\[\d;32m(.*):\d+.*\u001b.*\n/.exec(e);if(u&&u.length>1){let p=hh(u[1],Pe(this.platformService.homeDir)),m=$z.Uri.file(p);return e.replace(A0,(h,g,b,w)=>{let k=parseInt(b,10);return`${g}<a href='${m?.toString()}?line=${k-1}'>${k}</a>${w}`})}}return e}modifyTracebackFrameIPython7(e,t){return t.map(i=>i.uri).forEach(i=>{let o=Pe(i),s=W(i),a=this.storageFactory.get({fileUri:i});if(a){if(e.includes(o)&&new RegExp(`\\[.*?;32m${Jz(o)}`).test(e)||e.includes(s)&&new RegExp(`\\[.*?;32m${Jz(s)}`).test(e)){let c="",l=/(;32m[ ->]*?)(\d+)(.*)/g;for(let p=l.exec(e);p&&p.length>3;p=l.exec(e)){let m=tl(p[3]).substr(1);c=`${c}${m}
`}let u=this.findCellOffset(a.getFileGeneratedCode(i),c);u!==void 0&&(e=e.replace(A0,(p,m,h,g)=>{let b=parseInt(h,10),w=u+b-1;return`${m}<a href='${i.toString()}?line=${w}'>${w+1}</a>${g}`}))}if(e.includes(o)){let c=this.findCellOffset(a.getFileGeneratedCode(i),e);if(c)return e.replace(A0,(l,u,p,m)=>{let h=parseInt(p,10),g=c+h-1;return`${u}<a href='${i.toString()}?line=${g}'>${g+1}</a>${m}`})}}}),e}findCellOffset(e,t){if(e){for(let n of e)if(n.trimmedRightCode.indexOf(t)>=0)return n.firstNonBlankLineIndex}}};Hb=v([(0,Gb.injectable)(),d(0,(0,Gb.inject)($s)),d(1,(0,Gb.inject)(Er)),d(2,(0,Gb.inject)(le))],Hb);var _u=_(O());var GC=class extends kn{constructor(e,t,n){let i=t||y.jupyterDebuggerNotInstalledError(e);super("notinstalled",i,n)}};function N0(r){let e={source:{path:Pe(r.uri)},pydevdSourceMaps:[]};return e.pydevdSourceMaps=r.generatedCodes.map(t=>({line:t.debuggerStartLine,endLine:t.endLine,runtimeSource:{path:t.runtimeFile},runtimeLine:t.runtimeLine})),e}var zb=class{constructor(e,t,n,i){this.apiProvider=e;this.configService=t;this.debugService=n;this.platform=i;this.configs=new WeakMap;this.debuggingActive=!1;this.debuggerPackage="debugpy",this.enableDebuggerCode="import debugpy;debugpy.listen(('localhost', 0))",this.waitForDebugClientCode="import debugpy;debugpy.wait_for_client()",this.tracingEnableCode="from debugpy import trace_this_thread;trace_this_thread(True)",this.tracingDisableCode="from debugpy import trace_this_thread;trace_this_thread(False)"}async attach(e){if(!e.session)throw new Error("Notebook not initialized");let t=this.configService.getSettings(e.resourceUri),n=e.kernelConnectionMetadata.interpreter?.uri;return this.startDebugSession(i=>this.debugService.startDebugging(void 0,i),e,{justMyCode:t.debugJustMyCode,python:n})}async detach(e){if(!e.session)return;let t=e.notebook;this.configs.get(t)&&(z("stop debugging"),this.debuggingActive=!1,this.debugService.stop(),e.status!=="dead"&&e.status!=="unknown"&&this.disable(e))}async updateSourceMaps(e){this.debugService.activeDebugSession&&this.debuggingActive&&(ne("Sending debug request for source map"),await Promise.all(e.map(async t=>{if(this.debuggingActive)return this.debugService.activeDebugSession.customRequest("setPydevdSourceMap",N0(t))})))}enable(e){e.session?.kernel&&vn(e.session.kernel,this.tracingEnableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(f)}disable(e){e.session?.kernel&&vn(e.session.kernel,this.tracingDisableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure disabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(f)}async startDebugSession(e,t,n){if(z("start debugging"),!t.session?.kernel)return;let i=await this.connect(t,n);if(i&&(z("connected to notebook during debugging"),this.debuggingActive=await e(i),this.debuggingActive)){this.debugService.removeBreakpoints([]);let o=await vn(t.session.kernel,this.waitForDebugClientCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure starting debug session for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"});o.some(s=>s.output_type==="error")?j(`${this.debuggerPackage} not found in path.`):z(`import startup: ${_D(o)}`),await this.disable(t)}}async connect(e,t){let n=e.notebook,i=n,o=this.configs.get(i);if(o)return{...o,...t};z("enable debugger attach"),await this.appendDebuggerPaths(e),o={type:"python",name:"IPython",request:"attach",...t};let{host:s,port:a}=await this.connectToLocal(e);if(o.host=s,o.port=a,o.port){this.configs.set(n,o);let c=[],l=()=>{this.configs.delete(i),c.forEach(u=>u.dispose())};c.push(e.onDisposed(l)),c.push(e.onRestarted(l))}return o}async calculateDebuggerPathList(e){let t=[],n=this.configService.getSettings(e.resourceUri).debugpyDistPath;if(n&&(this.platform.isWindows&&(n=n.replace(/\\/g,"\\\\")),t.push(n)),dt(e.kernelConnectionMetadata)){let i=await this.getDebuggerPath();this.platform.isWindows&&(i=i.replace(/\\/g,"\\\\")),t.push(i)}if(t&&t.length>0)return t.reduce((i,o)=>(i.length===0?i=`'${o}'`:i=`${i}, '${o}'`,i),"")}getDebuggerPath(){return this.apiProvider.getApi().then(e=>e.getDebuggerPath())}async appendDebuggerPaths(e){let t=await this.calculateDebuggerPathList(e);if(t&&t.length>0){let n=e.session?.kernel?await vn(e.session.kernel,`import sys as _VSCODE_sys\r
_VSCODE_sys.path.extend([${t}])\r
_VSCODE_sys.path\r
del _VSCODE_sys`,{traceErrors:!0,traceErrorsMessage:"Execute_request failure appending debugger paths for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];z(`Appending paths: ${_D(n)}`)}}async connectToLocal(e){let t=e.session?.kernel?await vn(e.session.kernel,this.enableDebuggerCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling debugging for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];if(t.length>0)for(let n of t){let i=_D([n]);if(i){i=em(i);let s=/\('(.*?)', ([0-9]*)\)/.exec(i);if(s)return{port:parseInt(s[2],10),host:s[1]}}}if(t.length>0&&t[0].output_type==="error"){let n=t[0];throw new GC(this.debuggerPackage,n.ename,e.kernelConnectionMetadata)}throw new GC(y.jupyterDebuggerOutputParseError(this.debuggerPackage),void 0,e.kernelConnectionMetadata)}};zb=v([(0,_u.injectable)(),d(0,(0,_u.inject)(Gt)),d(1,(0,_u.inject)(le)),d(2,(0,_u.inject)(Ma)),d(2,(0,_u.named)(Ge.MULTIPLEXING_DEBUGSERVICE)),d(3,(0,_u.inject)(Er))],zb);var ml=_(O()),Ad=require("vscode");var M0=class{constructor(e,t,n){this.debugAdapter=e;this.debugCell=t;this.execution=n;this._ready=ue();this.ready=this._ready.promise;A("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){E(`[Debug-IW] ${e}: ${t}`)}async willSendEvent(e){return nL(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&MC(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){let t=as(this.debugCell);e.command==="setBreakpoints"&&t&&t.generatedCode&&!this.cellDumpInvoked&&(this.debugCellDumped||(this.debugCellDumped=wf(this.execution,this.debugAdapter)),await this.debugCellDumped),e.command==="configurationDone"&&t&&t.generatedCode&&(this.debugCellDumped||(this.debugCellDumped=wf(this.execution,this.debugAdapter)),await this.debugCellDumped,this._ready.resolve())}};var O0=class extends mb{constructor(){super(...arguments);this._ready=ue();this.ready=this._ready.promise}resolve(){this._ready.resolve()}};var uL=require("vscode");var K0=class extends hb{constructor(t,n,i,o,s,a,c){super(t,n,i,o,s,a);this.cellToDebugFileSortedInReverseOrderByLineNumber=[];c&&(this.debugLocationTracker=c.createDebugAdapterTracker(t),this.debugLocationTracker.onWillStartSession&&this.debugLocationTracker.onWillStartSession(),this.onDidSendMessage(l=>{this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(l)},this,this.disposables),this.onDidEndSession(()=>{this.debugLocationTracker?.onWillStopSession&&this.debugLocationTracker.onWillStopSession()},this,this.disposables))}handleClientMessageAsync(t){return ne(`KernelDebugAdapter::handleMessage ${JSON.stringify(t,void 0," ")}`),t.type==="request"&&this.debugLocationTracker?.onWillReceiveMessage&&this.debugLocationTracker.onWillReceiveMessage(t),t.type==="response"&&this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(t),super.handleClientMessageAsync(t)}async dumpCell(t){let n=this.notebookDocument.cellAt(t),i=as(n);if(!i)throw new Error("Not an interactive window cell");try{let o=(i.generatedCode?.code||n.document.getText()).replace(/\r\n/g,`
`),s=await this.session.customRequest("dumpCell",{code:o}),a=In(s.sourcePath);this.fileToCell.set(a,uL.Uri.parse(i.interactive.uristring));let c=0;i.generatedCode&&!i.generatedCode.hasCellMarker&&(c=i.generatedCode.firstNonBlankLineIndex),this.cellToDebugFileSortedInReverseOrderByLineNumber.push({debugFilePath:a,interactiveWindow:uL.Uri.parse(i.interactive.uristring),metadata:i,lineOffset:c+i.interactive.lineIndex+(i.generatedCode?.lineOffsetRelativeToIndexOfFirstLineInCell||0)}),this.cellToDebugFileSortedInReverseOrderByLineNumber.sort((l,u)=>u.metadata.interactive.lineIndex-l.metadata.interactive.lineIndex)}catch(o){x(`Failed to dump cell for ${n.index} with code ${i.interactive.originalSource}`,o)}}translateDebuggerLocationToRealLocation(t,n){if(n=t?.source??n,!n||!n.path)return;let i=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(o=>o.debugFilePath===n.path);i&&(n.name=De(i.interactiveWindow.path),n.path=i.interactiveWindow.toString(),typeof t?.endLine=="number"&&(t.endLine=t.endLine+(i.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line+(i.lineOffset||0)))}translateRealLocationToDebuggerLocation(t,n){let i=t.line;if(n=t?.source??n,!n||!n.path||typeof i!="number")return;let o=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(s=>i>=s.metadata.interactive.lineIndex+1);!o||o.interactiveWindow.path!==n.path||(n.path=o.debugFilePath,typeof t?.endLine=="number"&&(t.endLine=t.endLine-(o.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line-(o.lineOffset||0)))}async sendRequestToJupyterSession(t){if(t.command==="setBreakpoints"){let n=t.arguments;if(delete n.lines,n.source.path!==this.cellToDebugFileSortedInReverseOrderByLineNumber[0]?.interactiveWindow.path)return super.sendRequestToJupyterSession(t);let i,o=[],s=[],a=()=>{if(o.length){let u=JSON.parse(JSON.stringify(t));u.arguments.breakpoints=o,s.push(super.sendRequestToJupyterSession(u))}};for(let u of t.arguments.breakpoints??[]){let p=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(m=>u.line>=m.metadata.generatedCode.line&&u.line<=m.metadata.generatedCode.endLine);if(p&&p.metadata.interactive.lineIndex!==i)a(),i=p.metadata.interactive.lineIndex,o=[u];else if(p)o.push(u);else{let m={...u,verified:!0};s.push(Promise.resolve({body:{breakpoints:[m]}}))}}a();let c=await Promise.all(s),l=JSON.parse(JSON.stringify(c[0]));return c.slice(1).forEach(u=>{l.body.breakpoints=l.body.breakpoints.concat(u.body.breakpoints??[])}),l.command="setBreakpoints",l.type="response",l.success=!0,l.request_seq=t.seq,l}return super.sendRequestToJupyterSession(t)}getDumpFilesForDeletion(){return this.cellToDebugFileSortedInReverseOrderByLineNumber.map(t=>t.debugFilePath)}};var Hz=require("vscode");var F0=class{constructor(e){this.debugCell=e}trace(e,t){E(`[Debug-IWRestart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Showing warning for unsupported restart request"),Hz.window.showWarningMessage(y.restartNotSupported,{modal:!0}).then(f,f),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var Qb=class extends fb{constructor(t,n,i,o,s,a,c){super(t,n,c);this.platform=i;this.debugLocationTrackerFactory=o;this.configService=s;this.debugService=a}activate(){super.activate(),this.disposables.push(Ad.debug.registerDebugAdapterDescriptorFactory(jS,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return 2}async start(t,n){ne("Starting debugging IW"),await this.checkIpykernelAndPrompt(n)===1&&await this.startDebuggingCell(t,n)}async startDebuggingCell(t,n){let i=this.configService.getSettings(t.uri),o={type:jS,name:De(t.uri.toString()),request:"attach",justMyCode:i.debugJustMyCode,__notebookUri:t.uri.toString(),__mode:2,__cellIndex:n.index},s={suppressSaveBeforeStart:!0};await this.startDebuggingConfig(o,s);let a=this.notebookToDebugger.get(t);if(!a){x("Debugger not found, could not start debugging.");return}await a.ready}async createDebugAdapterDescriptor(t){let n=t.configuration;NG(n);let i=Ad.workspace.notebookDocuments.find(s=>s.uri.toString()===n.__notebookUri);if(!i||typeof n.__cellIndex!="number"){x("Invalid debug session for debugging of IW using Jupyter Protocol");return}if(this.notebookInProgress.has(i)){z("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(i)){z("Cannot start debugging. Already debugging this notebook document. Toolbar should update");return}let o=new O0(i,n,t);this.notebookToDebugger.set(i,o);try{return this.notebookInProgress.add(i),await this.doCreateDebugAdapterDescriptor(n,t,i,o)}finally{this.notebookInProgress.delete(i)}}async doCreateDebugAdapterDescriptor(t,n,i,o){let s=await this.ensureKernelIsRunning(i);if(!s?.session){Ad.window.showInformationMessage(y.kernelWasNotStarted).then(f,f);return}let a=new K0(n,i,s.session,s,this.platform,this.debugService,this.debugLocationTrackerFactory);this.disposables.push(a.onDidEndSession(this.endSession.bind(this)));let c=i.cellAt(t.__cellIndex),l=new M0(a,c,this.kernelProvider.getKernelExecution(s));return a.addDebuggingDelegates([l,new F0(c)]),l.ready.then(()=>o.resolve()).catch(u=>console.error("Failed waiting for controller to be ready",u)),this.trackDebugAdapter(i,a),new Ad.DebugAdapterInlineImplementation(a)}async updateSourceMaps(t,n){let i=this.getDebugSession(t.notebook);i&&(ne("Sending debug request for source map"),await Promise.all(n.map(async o=>{if(i)return i.customRequest("setPydevdSourceMap",N0(o))})))}};Qb=v([(0,ml.injectable)(),d(0,(0,ml.inject)(Ke)),d(1,(0,ml.inject)(Ct)),d(2,(0,ml.inject)(Er)),d(3,(0,ml.inject)(QT)),d(4,(0,ml.inject)(le)),d(5,(0,ml.inject)(Di)),d(6,(0,ml.inject)(ut))],Qb);var zC=_(O()),QC=require("vscode");var Gz="InteractiveShiftEnterBanner";var Nd=class{constructor(e,t){this.persistentState=e;this.configuration=t;this.disabledInCurrentSession=!1;this.bannerMessage=VA.bannerMessage;this.bannerLabels=[ye.bannerLabelYes,ye.bannerLabelNo];this.initialize()}initialize(){this.initialized||(this.initialized=!0,this.isEnabled())}isEnabled(){return this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!0).value}async showBanner(){if(!this.isEnabled()||!await this.shouldShowBanner())return;switch(A("DS_INTERNAL.SHIFTENTER_BANNER_SHOWN"),await QC.window.showInformationMessage(this.bannerMessage,...this.bannerLabels)){case this.bannerLabels[0]:{await this.enableInteractiveShiftEnter();break}case this.bannerLabels[1]:{await this.disableInteractiveShiftEnter();break}default:this.disabledInCurrentSession=!0}}async shouldShowBanner(){let e=this.configuration.getSettings();return Promise.resolve(this.isEnabled()&&!this.disabledInCurrentSession&&!e.sendSelectionToInteractiveWindow)}async disableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!1,void 0,QC.ConfigurationTarget.Global),await this.disableBanner()}async enableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!0,void 0,QC.ConfigurationTarget.Global),await this.disableBanner()}async disableBanner(){await this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!1).updateValue(!1)}};v([Qr("DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER")],Nd.prototype,"disableInteractiveShiftEnter",1),v([Qr("DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER")],Nd.prototype,"enableInteractiveShiftEnter",1),Nd=v([(0,zC.injectable)(),d(0,(0,zC.inject)(Ga)),d(1,(0,zC.inject)(le))],Nd);var Of=_(O()),zz=require("vscode");var Yb=class{constructor(e,t,n,i){this.configService=e;this.fs=t;this.context=n;this.registry=i;this.priority=5}activate(){this.registry.register(this,gt)}async getCode(e){if(!_t(e.kernelConnectionMetadata))return[];if(!Br()){if(this.configService.getSettings(void 0).forceIPyKernelDebugger===!0)return[];if(!dt(e.kernelConnectionMetadata))return[]}if(e.notebook?.notebookType===gt){if(!dt(e.kernelConnectionMetadata))return[];this.addRunCellHookContents||(this.addRunCellHookContents=this.fs.readFile(zz.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","kernel","addRunCellHook.py")));let t=await this.addRunCellHookContents;return Fe(t,{trim:!1})}return[]}};Yb=v([(0,Of.injectable)(),d(0,(0,Of.inject)(le)),d(1,(0,Of.inject)(st)),d(2,(0,Of.inject)(lt)),d(3,(0,Of.inject)(Fo))],Yb);var Zb=_(O()),eI=require("vscode");var Xb=class{constructor(e,t,n){this.dataScienceCodeLensProvider=e;this.extensionContext=t;this.configurationService=n}activate(){this.configurationService.getSettings().pythonCellFolding&&this.extensionContext.subscriptions.push(eI.languages.registerFoldingRangeProvider([Pw],this))}provideFoldingRanges(e,t,n){if([_l,kw].includes(e.uri.scheme))return;let i=this.dataScienceCodeLensProvider.getCodeWatcher(e);if(i){let o=i.getCodeLenses();return n.isCancellationRequested||o.length==0?void 0:o.map(s=>new eI.FoldingRange(s.range.start.line,s.range.end.line,eI.FoldingRangeKind.Region))}}};Xb=v([(0,Zb.injectable)(),d(0,(0,Zb.inject)(kd)),d(1,(0,Zb.inject)(lt)),d(2,(0,Zb.inject)(le))],Xb);var YC=_(O());var Qz=require("vscode");var tI=class{constructor(e,t){this.dataScienceCodeLensProvider=e;this.extensionContext=t}activate(){this.extensionContext.subscriptions.push(Qz.languages.registerCodeLensProvider([Pw],this.dataScienceCodeLensProvider))}};tI=v([(0,YC.injectable)(),d(0,(0,YC.inject)(kd)),d(1,(0,YC.inject)(lt))],tI);var Gs=_(O());var pL="LastInteractiveKernelSelected",rI=class{constructor(e,t,n,i,o){this.controllerRegistration=e;this.interpreterService=t;this.disposables=n;this.workspaceMemento=i;this.serviceContainer=o;this.onControllerSelected=this.controllerRegistration.onControllerSelected}async getInitialController(e,t){if(t){let n=this.controllerRegistration.get(t,gt);if(n)return n}if(this.workspaceMemento.get(pL)){let n=this.workspaceMemento.get(pL),i=n?this.controllerRegistration.get(n,gt):void 0;if(i)return i}if(this.interpreterService)return await bbe(gt,e,this.interpreterService,this.controllerRegistration)}getSelectedController(e){return this.controllerRegistration.getSelected(e)}getRegisteredController(e){return this.controllerRegistration.get(e,"interactive")}async createKernel(e,t,n,i,o){await Yo(n,e);let s=(u,p)=>{u!=="start"&&u!=="restart"||ne(`(onStart) Looking for controller ${p.controller.id} in ${this.controllerRegistration.all.map(m=>`${m.kind}:${m.id}`).join(", ")}`)},a=await Vs.connectToNotebookKernel(e,this.serviceContainer,{resource:n||i.uri,notebook:i,controller:t},new Yt(!1),o,"jupyterExtension",s),c=this.controllerRegistration.registered.find(u=>u.id===a.controller.id);if(!c)throw Error(`Controller ${a.controller.id} not found or not yet created`);let l=c.controller;return this.interpreterService&&Ibe(a.kernelConnectionMetadata,n,this.interpreterService).then(async u=>{await this.workspaceMemento.update(pL,u?void 0:a.kernelConnectionMetadata)}).catch(u=>{j("Failed to store kernel connection metadata",u)}),{kernel:a,actualController:l}}};rI=v([(0,Gs.injectable)(),d(0,(0,Gs.inject)(Ct)),d(1,(0,Gs.inject)(tt)),d(1,(0,Gs.optional)()),d(2,(0,Gs.inject)(F)),d(3,(0,Gs.inject)($e)),d(3,(0,Gs.named)(ri)),d(4,(0,Gs.inject)(ut))],rI);async function bbe(r,e,t,n){let i=await t.getActiveInterpreter(e);if(i){let o=await Es(i),s=Ko.create({kernelSpec:o,interpreter:i,id:Pi(o,i)}),a=n.addOrUpdate(s,[r]),c=a[0];return n.trackActiveInterpreterControllers(a),ne(`Active Interpreter Controller ${c.connection.kind}:${c.id} created for View ${r} with resource ${W(e)}`),c}}async function Ibe(r,e,t){return(await t.getActiveInterpreter(e))?.id===r.interpreter?.id}var iI=_(O());var Md=require("vscode");var nI=class{constructor(e,t,n){this.configService=e;this.fs=t;this.registry=n;this.priority=0}activate(){this.registry.register(this,gt)}async getCode(e){let t=await this.getWorkingDirectory(e);return t?Fe(Ja(qa.UpdateCWDAndPath,Pe(t)),{trim:!1}):[]}async getWorkingDirectory(e){if(!dt(e.kernelConnectionMetadata)&&!mP(e.kernelConnectionMetadata)||!_t(e.kernelConnectionMetadata))return;let t=Is(),n=e.resourceUri?.path.endsWith(".interactive")&&t?Md.Uri.joinPath(t,e.resourceUri.path):e.resourceUri,i=await this.calculateWorkingDirectory(e.resourceUri);if(i&&await this.fs.exists(i))return i;if(e.resourceUri&&e.resourceUri.scheme!=="untitled"&&await this.fs.exists(e.resourceUri)&&(i=Md.Uri.file(zh(Pe(i),n,this.configService.getSettings(n))),i&&await this.fs.exists(i)))return i}async calculateWorkingDirectory(e){let t,n=this.configService.getSettings(e),i=Tk(n.notebookFileRoot);if(i&&Md.workspace.workspaceFolders?.length){let o=Md.Uri.file(i),s=Md.workspace.workspaceFolders[0].uri;if(fh(i))await this.fs.exists(o)?t=o:t=s;else if(i.includes("${"))t=o;else{let a=Md.Uri.joinPath(s,i);await this.fs.exists(a)?t=a:t=s}}return t}};nI=v([(0,iI.injectable)(),d(0,(0,iI.inject)(le)),d(1,(0,iI.inject)(st)),d(2,(0,iI.inject)(Fo))],nI);function Yz(r){r.addSingleton(Oi,Jb),r.addSingleton(C0,rI),r.addSingleton(be,Do),r.addSingleton(be,qb),r.add(I0,tr),r.addSingleton(S0,Ub),r.addSingleton(kd,jb),r.addSingleton(be,tI),r.addSingleton(be,Xb),r.addSingleton(be,Wb),r.addSingleton(be,$b),r.addSingleton(be,nI),r.addSingleton(be,Yb),r.addSingleton(Ob,Fb,void 0,[be]),r.addSingleton($s,Bb),r.addSingleton(Qh,Hb),r.addSingleton(x0,zb),r.addSingleton(w0,Qb,void 0,[be]),r.addSingleton(o2,Nd,Gz)}var Du=_(O()),sI=require("vscode");var oI=class{constructor(e,t,n,i){this.jupyterServerHelper=e;this.configService=t;this.fileSystem=n;this.errorHandler=i;this.pruneCells=(e,t)=>e.map(i=>this.pruneCell(i,t));this.pruneCell=(e,t)=>{let n=OV({...e.data});return n.source=this.pruneSource(e.data.source,t),n};this.pruneSource=(e,t)=>{if(Array.isArray(e)&&e.length>0){if(t.isCell(e[0]))return e.slice(1)}else{let n=e.toString().split(`
`).map(i=>`${i}
`);if(n.length>0&&t.isCell(n[0]))return n.slice(1)}return e};this.extractPythonMainVersion=async()=>{if(!this.jupyterServerHelper)return 3;let e=await this.jupyterServerHelper.getUsableJupyterPython(),t=await Jh(e);return e&&t&&t.major||3}}dispose(){}async exportToFile(e,t,n=!0){let i=await this.translateToNotebook(e);try{let o=JSON.stringify(i,void 0,1);if(await this.fileSystem.writeFile(sI.Uri.file(t),o),!n)return;let s=y.exportOpenQuestion1;sI.window.showInformationMessage(y.exportDialogComplete(t),s).then(async a=>{try{a===s&&await P0(sI.Uri.file(t))}catch(c){await this.errorHandler.handleError(c)}},f)}catch(o){x("Error in exporting notebook file"),sI.window.showInformationMessage(y.exportDialogFailed(o)).then(f,f)}}async translateToNotebook(e,t){let n=await this.extractPythonMainVersion(),i={language_info:{codemirror_mode:{name:"ipython",version:n},file_extension:".py",mimetype:"text/x-python",name:"python",nbconvert_exporter:"python",pygments_lexer:`ipython${n}`,version:n},kernelspec:t},o=new fi(this.configService.getSettings());return{cells:this.pruneCells(e,o),nbformat:VR.major,nbformat_minor:VR.minor,metadata:i}}};oI=v([(0,Du.injectable)(),d(0,(0,Du.inject)(up)),d(0,(0,Du.optional)()),d(1,(0,Du.inject)(le)),d(2,(0,Du.inject)(st)),d(3,(0,Du.inject)(Yr))],oI);var Od=_(O()),Xz=require("vscode");var aI=class{constructor(e,t,n,i,o){this.fs=e;this.disposableRegistry=t;this.configuration=n;this.nbConvertDependencyChecker=i;this.exportToPythonService=o;this.isDisposed=!1;this.nbconvertBaseTemplateFormat=`{%- extends '{0}' -%}
{% block codecell %}
{1}
{{ super() }}
{% endblock codecell %}
{% block in_prompt %}{% endblock in_prompt %}
{% block input %}{{ cell.source | ipython2python }}{% endblock input %}
{% block markdowncell scoped %}{1} [markdown]
{{ cell.source | comment_lines }}
{% endblock markdowncell %}`;this.nbconvert5Null="null.tpl";this.nbconvert6Null="base/null.j2";this.dispose=()=>{this.isDisposed=!0};this.addInstructionComments=e=>y.instructionComments(this.defaultCellMarker).concat(e);this.addIPythonImport=e=>Ja(qa.ImportIPython,this.defaultCellMarker,e)}async importFromFile(e,t){let n=await this.nbConvertDependencyChecker.getNbConvertVersion(t);if(n){let i;n.major>=6?(this.template6Promise||(this.template6Promise=this.createTemplateFile(!0)),i=await this.template6Promise):(this.template5Promise||(this.template5Promise=this.createTemplateFile(!1)),i=await this.template5Promise);let o=await this.exportToPythonService.exportNotebookToPython(e,t,i);return o.includes("get_ipython()")&&(o=this.addIPythonImport(o)),this.addInstructionComments(o)}throw new Error(y.jupyterNbConvertNotSupported)}get defaultCellMarker(){return this.configuration.getSettings().defaultCellMarker||Ge.DefaultCodeCellMarker}async createTemplateFile(e){let t=await this.fs.createTemporaryLocalFile(".tpl");if(t)try{return this.disposableRegistry.push(t),await this.fs.writeFile(Xz.Uri.file(t.filePath),Ja(this.nbconvertBaseTemplateFormat,e?this.nbconvert6Null:this.nbconvert5Null,this.defaultCellMarker)),t.filePath}catch{}}};aI=v([(0,Od.injectable)(),d(0,(0,Od.inject)(gr)),d(1,(0,Od.inject)(F)),d(2,(0,Od.inject)(le)),d(3,(0,Od.inject)(ag)),d(4,(0,Od.inject)(IP))],aI);var zs=_(O());var cs=require("vscode");var L0=class{constructor(e,t,n,i,o,s){this.fileConverter=e;this.fs=t;this.interactiveProvider=n;this.controllerRegistration=i;this.preferredKernel=o;this.kernelFinder=s;this.disposables=[]}register(){this.registerCommand($.ExportAsPythonScript,(e,t)=>this.export(e,"python",void 0,t)),this.registerCommand($.ExportToHTML,(e,t,n)=>this.export(e,"html",t,n)),this.registerCommand($.ExportToPDF,(e,t,n)=>this.export(e,"pdf",t,n)),this.registerCommand($.Export,(e,t,n)=>this.export(e,void 0,t,n)),this.registerCommand($.NativeNotebookExport,e=>this.nativeNotebookExport(e))}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommand(e,t){let n=cs.commands.registerCommand(e,t,this);this.disposables.push(n)}async nativeNotebookExport(e){let t=Vn(e)?e:e?.notebookEditor?.notebookUri,n=t?cs.workspace.notebookDocuments.find(i=>this.fs.arePathsSame(i.uri,t)):cs.window.activeNotebookEditor?.notebook;if(n){let i,o=this.kernelFinder.registered.find(c=>c.kind==="localPythonEnvironment"),s=new cs.CancellationTokenSource;try{i=o?await this.preferredKernel.findPreferredLocalKernelSpecConnection(n,o,s.token).then(c=>c?.interpreter):void 0}finally{s.dispose()}let a=this.controllerRegistration.getSelected(n)?.connection.interpreter||i;return this.export(n,void 0,void 0,a)}else return this.export(void 0,void 0,void 0,void 0)}async export(e,t,n,i){if(!e){if(e=cs.window.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,!e){z("Export called without a valid exportable document active");return}i=i||this.controllerRegistration.getSelected(e)?.connection.interpreter,t&&A("DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",void 0,{format:t})}if(t)await this.fileConverter.export(t,e,n,i);else{let o=await this.showExportQuickPickMenu(e,n,i).then(s=>s);o!==void 0?o.handler():A("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK")}}getExportQuickPickItems(e,t,n){let i=[];return(n||e.metadata&&lP(lo(e)))&&i.push({label:y.exportPythonQuickPickLabel,picked:!0,handler:()=>{A("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"python"}),cs.commands.executeCommand($.ExportAsPythonScript,e,n).then(f,f)}}),i.push({label:y.exportHTMLQuickPickLabel,picked:!1,handler:()=>{A("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"html"}),cs.commands.executeCommand($.ExportToHTML,e,t,n).then(f,f)}},{label:y.exportPDFQuickPickLabel,picked:!1,handler:()=>{A("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"pdf"}),cs.commands.executeCommand($.ExportToPDF,e,t,n).then(f,f)}}),i}async showExportQuickPickMenu(e,t,n){let i=this.getExportQuickPickItems(e,t,n),o={ignoreFocusOut:!1,matchOnDescription:!0,matchOnDetail:!0,placeHolder:y.exportAsQuickPickPlaceholder};return cs.window.showQuickPick(i,o)}};var U0=require("vscode");var cI=class{constructor(e,t,n,i,o,s,a){this.disposables=e;this.fileConverter=t;this.fs=n;this.interactiveProvider=i;this.controllerSelection=o;this.kernelFinder=s;this.jupyterConnection=a;this.exportCommand=new L0(this.fileConverter,this.fs,this.interactiveProvider,o,new bd(a),s),U0.workspace.isTrusted||U0.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){U0.workspace.isTrusted&&this.exportCommand?.register()}};cI=v([(0,zs.injectable)(),d(0,(0,zs.inject)(F)),d(1,(0,zs.inject)(Ib)),d(2,(0,zs.inject)(st)),d(3,(0,zs.inject)(Oi)),d(3,(0,zs.optional)()),d(4,(0,zs.inject)(Ct)),d(5,(0,zs.inject)(Rr)),d(6,(0,zs.inject)(cn))],cI);var Kd=_(O()),uI=require("vscode");var Zz=require("vscode");var dL="JVSC_NEVER_PROMPT_EXTENSIONS_LIST",Sbe=new Map([["ms-dotnettools.dotnet-interactive-vscode",{displayName:".NET Interactive Notebooks Preview",extensionLink:"https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.dotnet-interactive-vscode"}]]),xbe=new Map([["c#","ms-dotnettools.dotnet-interactive-vscode"],["csharp","ms-dotnettools.dotnet-interactive-vscode"],["f#","ms-dotnettools.dotnet-interactive-vscode"],["fsharp","ms-dotnettools.dotnet-interactive-vscode"],["powershell","ms-dotnettools.dotnet-interactive-vscode"]]),lI=class{constructor(e,t,n){this.controllerManager=e;this.globalMemento=n;this.disposables=[];this.recommendedInSession=new Set;t.push(this)}dispose(){Q(this.disposables)}activate(){uI.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookDocument,this,this.disposables),this.controllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onDidOpenNotebookDocument(e){if(!Tt(e))return;let t=dP(lo(e));t&&this.recommendExtensionForLanguage(t).catch(f)}onNotebookControllerSelected({controller:e}){if(e.connection.kind!=="startUsingLocalKernelSpec"&&e.connection.kind!=="startUsingRemoteKernelSpec"||_t(e.connection))return;let t=Lo(e.connection);t&&this.recommendExtensionForLanguage(t).catch(f)}async recommendExtensionForLanguage(e){let t=xbe.get(e.toLowerCase());if(!t||Zz.extensions.getExtension(t))return;let n=Sbe.get(t);if(!n||this.globalMemento.get(dL,[]).includes(t)||this.recommendedInSession.has(t))return;this.recommendedInSession.add(t);let i=y.recommendExtensionForNotebookLanguage(`[${n.displayName}](${n.extensionLink})`,e);switch(A("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"displayed"}),await uI.window.showInformationMessage(i,ye.bannerLabelYes,ye.bannerLabelNo,ye.doNotShowAgain)){case ye.bannerLabelYes:{A("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"ok"}),uI.commands.executeCommand("extension.open",t).then(f,f);break}case ye.bannerLabelNo:{A("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"cancel"});break}case ye.doNotShowAgain:{A("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"doNotShowAgain"});let s=this.globalMemento.get(dL,[]);s.includes(t)||(s.push(t),await this.globalMemento.update(dL,s));break}default:A("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"dismissed"})}}};lI=v([(0,Kd.injectable)(),d(0,(0,Kd.inject)(Ct)),d(1,(0,Kd.inject)(F)),d(2,(0,Kd.inject)($e)),d(2,(0,Kd.named)(St))],lI);var fl=_(O()),Ki=require("vscode");var pI=class{constructor(e,t,n,i,o){this.interactiveProvider=e;this.kernelProvider=n;this.controllers=i;this.jupyterUriProviderRegistration=o;this.disposables=[];this.isPythonFileActive=!1;t.push(this),this.nativeContext=new ir(Ir.IsNativeActive),this.canRestartNotebookKernelContext=new ir(Ir.CanRestartNotebookKernel),this.canInterruptNotebookKernelContext=new ir(Ir.CanInterruptNotebookKernel),this.canRestartInteractiveWindowKernelContext=new ir(Ir.CanRestartInteractiveWindowKernel),this.canInterruptInteractiveWindowKernelContext=new ir(Ir.CanInterruptInteractiveWindowKernel),this.interactiveContext=new ir(Ir.IsInteractiveActive),this.interactiveOrNativeContext=new ir(Ir.IsInteractiveOrNativeActive),this.pythonOrNativeContext=new ir(Ir.IsPythonOrNativeActive),this.pythonOrInteractiveContext=new ir(Ir.IsPythonOrInteractiveActive),this.pythonOrInteractiveOrNativeContext=new ir(Ir.IsPythonOrInteractiveOrNativeActive),this.hasNativeNotebookCells=new ir(Ir.HaveNativeCells),this.isPythonNotebook=new ir(Ir.IsPythonNotebook),this.isJupyterKernelSelected=new ir(Ir.IsJupyterKernelSelected),this.hasNativeNotebookOrInteractiveWindowOpen=new ir(Ir.HasNativeNotebookOrInteractiveWindowOpen),this.kernelSourceContext=new ir(Ir.KernelSource)}dispose(){this.disposables.forEach(e=>e.dispose())}activate(){Ki.window.onDidChangeActiveTextEditor(this.onDidChangeActiveTextEditor,this,this.disposables),this.kernelProvider.onKernelStatusChanged(this.onDidKernelStatusChange,this,this.disposables),this.interactiveProvider&&(this.interactiveProvider.onDidChangeActiveInteractiveWindow(this.onDidChangeActiveInteractiveWindow,this,this.disposables),this.interactiveProvider.activeWindow&&this.onDidChangeActiveInteractiveWindow()),Ki.window.activeNotebookEditor&&this.onDidChangeActiveNotebookEditor(Ki.window.activeNotebookEditor),Ki.window.onDidChangeActiveNotebookEditor(this.onDidChangeActiveNotebookEditor,this,this.disposables),Ki.window.activeTextEditor?.document.languageId===xe&&this.onDidChangeActiveTextEditor(Ki.window.activeTextEditor),Ki.window.onDidChangeNotebookEditorSelection(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),Ki.workspace.onDidOpenNotebookDocument(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),Ki.workspace.onDidCloseNotebookDocument(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),this.controllers.onControllerSelectionChanged(()=>this.updateSelectedKernelContext(),this,this.disposables),this.updateSelectedKernelContext()}updateNativeNotebookCellContext(){let e=(Ki.window.activeNotebookEditor?.notebook.cellCount||0)>0;this.hasNativeNotebookCells.set(e).catch(f)}onDidChangeActiveInteractiveWindow(e){this.interactiveContext.set(!!e).catch(f),this.updateNativeNotebookInteractiveWindowOpenContext(),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}onDidChangeActiveNotebookEditor(e){let t=e?e.notebook.notebookType===bt:!1;this.nativeContext.set(t).catch(f),this.isPythonNotebook.set(e&&t?lP(lo(e.notebook)):!1).catch(f),this.updateContextOfActiveNotebookKernel(e),this.updateContextOfActiveInteractiveWindowKernel(),this.updateNativeNotebookInteractiveWindowOpenContext(),this.updateNativeNotebookCellContext(),this.updateMergedContexts()}updateNativeNotebookInteractiveWindowOpenContext(){this.hasNativeNotebookOrInteractiveWindowOpen.set(Ki.workspace.notebookDocuments.some(e=>e.notebookType===bt||e.notebookType===gt)).catch(f)}updateContextOfActiveNotebookKernel(e){let t=e&&e.notebook.notebookType===bt?this.kernelProvider.get(e.notebook):void 0;if(t){let n=this.kernelProvider.getKernelExecution(t),i=t.status!=="unknown"||n.executionCount>0||t.startedAtLeastOnce;this.canRestartNotebookKernelContext.set(!!i).catch(f);let o=t.status==="busy";this.canInterruptNotebookKernelContext.set(!!o).catch(f)}else this.canRestartNotebookKernelContext.set(!1).catch(f),this.canInterruptNotebookKernelContext.set(!1).catch(f);this.updateKernelSourceContext(t).catch(f),this.updateSelectedKernelContext()}async updateKernelSourceContext(e){if(!e||!Ft(e.kernelConnectionMetadata)){this.kernelSourceContext.set("").catch(f);return}let t=e.kernelConnectionMetadata,n=await this.jupyterUriProviderRegistration.jupyterCollections.find(i=>i.extensionId===t.serverProviderHandle.extensionId&&i.id===t.serverProviderHandle.id);if(!n){this.kernelSourceContext.set("").catch(f);return}this.kernelSourceContext.set(n.id).catch(f)}updateSelectedKernelContext(){let e=Ki.window.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument;e&&Tt(e)&&this.controllers.getSelected(e)?this.isJupyterKernelSelected.set(!0).catch(f):this.isJupyterKernelSelected.set(!1).catch(f)}updateContextOfActiveInteractiveWindowKernel(){let e=this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,t=e?this.kernelProvider.get(e):void 0;if(t){let n=t.status!=="unknown";this.canRestartInteractiveWindowKernelContext.set(!!n).catch(f);let i=t.status==="busy";this.canInterruptInteractiveWindowKernelContext.set(!!i).catch(f)}else this.canRestartInteractiveWindowKernelContext.set(!1).catch(f),this.canInterruptInteractiveWindowKernelContext.set(!1).catch(f);this.updateSelectedKernelContext()}onDidKernelStatusChange({kernel:e}){let t=e.notebook;t.notebookType===gt?this.updateContextOfActiveInteractiveWindowKernel():t.notebookType===bt&&t===Ki.window.activeNotebookEditor?.notebook&&this.updateContextOfActiveNotebookKernel(Ki.window.activeNotebookEditor)}onDidChangeActiveTextEditor(e){this.isPythonFileActive=e?.document.languageId===xe&&!Dj(e.document.uri),this.updateNativeNotebookCellContext(),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}updateMergedContexts(){this.interactiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0).catch(f),this.pythonOrNativeContext.set(this.nativeContext.value===!0||this.isPythonFileActive===!0).catch(f),this.pythonOrInteractiveContext.set(this.interactiveContext.value===!0||this.isPythonFileActive===!0).catch(f),this.pythonOrInteractiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0&&this.isPythonFileActive===!0).catch(f)}};pI=v([(0,fl.injectable)(),d(0,(0,fl.inject)(Oi)),d(0,(0,fl.optional)()),d(1,(0,fl.inject)(F)),d(2,(0,fl.inject)(Ke)),d(3,(0,fl.inject)(Ct)),d(4,(0,fl.inject)(Qt))],pI);var j0=_(O()),Ua=require("vscode");var Cbe=/^\s*(from (?<fromImport>\w+)(?:\.\w+)* import \w+(?:, \w+)*(?: as \w+)?|import (?<importImport>\w+(?:, \w+)*)(?: as \w+)?)$/,wbe=1e3,Ebe=Tr(),eQ=Symbol("IImportTracker"),Kf=class{constructor(e){this.pendingChecks=new uo;this.disposables=[];this.sentMatches=new Set;e.push(this),Ua.workspace.onDidOpenNotebookDocument(t=>this.onOpenedOrClosedNotebookDocument(t,"onOpenCloseOrSave"),this.disposables),Ua.workspace.onDidCloseNotebookDocument(t=>this.onOpenedOrClosedNotebookDocument(t,"onOpenCloseOrSave"),this.disposables),Ua.workspace.onDidSaveNotebookDocument(t=>this.onOpenedOrClosedNotebookDocument(t,"onOpenCloseOrSave"),this.disposables),Ua.notebooks.onDidChangeNotebookCellExecutionState(t=>{t.state==Ua.NotebookCellExecutionState.Pending&&!this.isTelemetryDisabled&&this.checkNotebookCell(t.cell,"onExecution").catch(f)},this,e)}get isTelemetryDisabled(){return TE()}dispose(){Q(this.disposables),this.pendingChecks.clear()}activate(){Ua.workspace.notebookDocuments.forEach(e=>this.checkNotebookDocument(e,"onOpenCloseOrSave"))}getDocumentLines(e){let t=[];for(let n=0;n<Math.min(wbe,e.lineCount);n++){let i=e.lineAt(n);i.isEmptyOrWhitespace||t.push(i.text.trim())}return t}onOpenedOrClosedNotebookDocument(e,t){!Tt(e)||this.isTelemetryDisabled||this.scheduleCheck(e.uri,this.checkNotebookDocument.bind(this,e,t))}scheduleCheck(e,t){let n=this.pendingChecks.get(e);n&&(clearTimeout(n),this.pendingChecks.delete(e)),Ebe?t():this.pendingChecks.set(e,setTimeout(t,5e3))}async checkNotebookDocument(e,t){!Tt(e)||this.isTelemetryDisabled||await Promise.all(e.getCells().map(async n=>this.checkNotebookCell(n,t)))}async checkNotebookCell(e,t){if(!(!Tt(e.notebook)||e.kind!==Ua.NotebookCellKind.Code||e.document.languageId!==xe))try{let n=e.notebook.notebookType===bt?"notebook":"interactive";await this.sendTelemetryForImports(this.getDocumentLines(e.document),n,t)}catch(n){if(!Zn)throw n}}lookForImports(e){let t=[];try{for(let n of e){if(!n.includes("import")&&!n.includes("from"))continue;let i=n?Cbe.exec(n):null;i!==null&&i.groups!==void 0&&(i.groups.fromImport!==void 0?t.push(i.groups.fromImport):i.groups.importImport!==void 0&&t.push(...i.groups.importImport.split(",").map(o=>o.trim())))}}catch{}return t}async sendTelemetryForImports(e,t,n){await Promise.all(this.lookForImports(e).map(async i=>{let o=`${i}_${t||""}_${n}`;if(this.sentMatches.has(o))return;this.sentMatches.add(o);let s=await vt(i);A("HASHED_PACKAGE_NAME",void 0,{hashedNamev2:s,resourceType:t,when:n})}))}};Kf=v([(0,j0.injectable)(),d(0,(0,j0.inject)(F))],Kf);var hl=_(O());var mL=require("vscode");var dI=class{constructor(e,t,n,i){this.disposableRegistry=e;this.configuration=t;this.rawSupported=n;this.commandListeners=i;this.isDisposed=!1;this.startTime=Date.now();this.onSettingsChanged=()=>{let t=this.configuration.getSettings(void 0).sendSelectionToInteractiveWindow;new ir(Ir.OwnsSelection).set(t).catch(f)}}get activationStartTime(){return this.startTime}activate(){this.onSettingsChanged(),this.changeHandler=this.configuration.getSettings(void 0).onDidChange(this.onSettingsChanged.bind(this)),this.disposableRegistry.push(this),this.disposableRegistry.push(mL.window.onDidChangeActiveTextEditor(()=>this.onChangedActiveTextEditor())),this.onChangedActiveTextEditor(),this.computeZmqAvailable(),this.commandListeners&&this.commandListeners.forEach(e=>e.register())}async dispose(){this.changeHandler&&(this.changeHandler.dispose(),this.changeHandler=void 0)}computeZmqAvailable(){new ir(Ir.ZmqAvailable).set(this.rawSupported?this.rawSupported.isSupported:!1).then(f,f)}onChangedActiveTextEditor(){let e=new ir(Ir.HasCodeCells),t=mL.window.activeTextEditor;t&&t.document.languageId===xe?e.set(ZG(t.document,this.configuration.getSettings())).catch(f):e.set(!1).catch(f)}};dI=v([(0,hl.injectable)(),d(0,(0,hl.inject)(F)),d(1,(0,hl.inject)(le)),d(2,(0,hl.inject)(li)),d(2,(0,hl.optional)()),d(3,(0,hl.multiInject)(Ih))],dI);var hi=_(O()),W0=require("vscode");var Lf=_(O()),Ff=require("vscode");var rQ=require("vscode");var fL="JUPYTER_API_ACCESS_INFORMATION",tQ=new Set([It.split(".")[0],"rchiodo","donjayamanne","SynapseVSCode"]),hL=new Set(["rchiodo","nuant"]),Tu=class{constructor(e,t){this.globalState=e;this.context=t;this.extensionAccess=new Map;this.promiseChain=new uh}async getAccessInformation(e){let t=!e.extensionId||e.extensionId===IS?"":e.extensionId.split(".")[0]||"";if(this.context.extensionMode===Ff.ExtensionMode.Test||!t||fo()==="insiders"){if(!tQ.has(t)&&!hL.has(t)){j(`Publisher ${t} is allowed to access the Kernel API with a message.`);let s=rQ.extensions.getExtension(e.extensionId)?.packageJSON?.displayName||"",a=s&&e.extensionId?`${s} (${e.extensionId})`:e.extensionId||t;Ff.window.showErrorMessage(y.thanksForUsingJupyterKernelApiPleaseRegisterWithUs(a)).then(f,f)}if(!hL.has(t)||!t||this.context.extensionMode===Ff.ExtensionMode.Test)return{extensionId:e.extensionId,accessAllowed:!0}}if(tQ.has(t))return{extensionId:e.extensionId,accessAllowed:!0};if(!hL.has(t))return Ff.window.showErrorMessage(`Please contact the Jupyter Extension to get access to the Kernel API. Publisher ${t}`).then(f,f),x(`Publisher ${t} is not allowed to access the Kernel API.`),{extensionId:e.extensionId,accessAllowed:!1};let i=this.globalState.get(fL)?.find(s=>s.extensionId===e.extensionId);if(i)return A("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:i.allowed}),{extensionId:e.extensionId,accessAllowed:i.allowed==="yes"};if(this.extensionAccess.get(e.extensionId))return this.extensionAccess.get(e.extensionId);let o=(async()=>{let s=y.allowExtensionToUseJupyterKernelApi(`${e.displayName} (${e.extensionId})`,ye.bannerLabelYes),c=await Ff.window.showInformationMessage(s,{modal:!0},ye.bannerLabelYes,ye.bannerLabelNo)===ye.bannerLabelYes;return this.promiseChain.chainFinally(async()=>{let l=[...this.globalState.get(fL,[])];return l=l.filter(u=>u.extensionId!==e.extensionId),l.push({allowed:c?"yes":"no",extensionId:e.extensionId}),this.globalState.update(fL,l)}).then(f,f),A("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:c?"yes":"no"}),{extensionId:e.extensionId,accessAllowed:c}})();return this.extensionAccess.set(e.extensionId,o),o}};Tu=v([(0,Lf.injectable)(),d(0,(0,Lf.inject)($e)),d(0,(0,Lf.named)(St)),d(1,(0,Lf.inject)(lt))],Tu);var nQ=new WeakMap;function gL(r){let e=nQ.get(r);return e||(e=Pbe(r),nQ.set(r,e)),e}function Pbe(r){return new Proxy(r,{get(e,t){return t==="kernel"?e.kernel?kbe(e.kernel):void 0:Reflect.get(e,t)}})}var iQ=new WeakMap;function kbe(r){let e=iQ.get(r);return e||(e=_be(r),iQ.set(r,e)),e}function _be(r){return new Proxy(r,{get(e,t){return t==="registerCommTarget"?(n,i)=>(J4(r,n),Reflect.get(e,t).apply(e,[n,i])):t==="removeCommTarget"?(n,i)=>($4(r,n),Reflect.get(e,t).apply(e,[n,i])):Reflect.get(e,t)}})}var mI=class{constructor(e,t,n,i,o,s,a,c){this.kernelProvider=e;this.kernelFinder=t;this.thirdPartyKernelProvider=n;this.disposables=i;this.controllerRegistration=o;this.apiAccess=s;this.extensions=a;this.serviceContainer=c;this.chainedApiAccess=new uh;this.extensionApi=new Map}async getService(){let e=this.extensions.determineExtensionFromCallStack(),t=await this.chainedApiAccess.chainFinally(()=>this.apiAccess.getAccessInformation(e));if(!t.accessAllowed)return;if(this.extensionApi.get(t.extensionId))return this.extensionApi.get(t.extensionId);let n=new XC(t.extensionId,this.kernelProvider,this.kernelFinder,this.thirdPartyKernelProvider,this.disposables,this.controllerRegistration,this.serviceContainer);return this.extensionApi.set(t.extensionId,n),n}};mI=v([(0,hi.injectable)(),d(0,(0,hi.inject)(Ke)),d(1,(0,hi.inject)(Rr)),d(2,(0,hi.inject)(dm)),d(3,(0,hi.inject)(F)),d(4,(0,hi.inject)(Ct)),d(5,(0,hi.inject)(Tu)),d(6,(0,hi.inject)(oa)),d(7,(0,hi.inject)(ut))],mI);var XC=class{constructor(e,t,n,i,o,s,a){this.callingExtensionId=e;this.kernelProvider=t;this.kernelFinder=n;this.thirdPartyKernelProvider=i;this.disposables=o;this.controllerRegistration=s;this.serviceContainer=a;this._onDidChangeKernelSpecifications=new W0.EventEmitter;this._onDidChangeKernels=new W0.EventEmitter;this.translatedConnections=new WeakMap;this._onDidChangeStatus=new W0.EventEmitter;this._status=this.kernelFinder.status,this.kernelFinder.onDidChangeStatus(()=>{this._status=this.kernelFinder.status,this._onDidChangeStatus.fire()},this,o),this.kernelProvider.onDidDisposeKernel(c=>{ne(`Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.kernelProvider.onDidStartKernel(c=>{ne(`Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidDisposeKernel(c=>{ne(`Third party Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidStartKernel(c=>{ne(`Third party Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.controllerRegistration.onDidChange(()=>this._onDidChangeKernelSpecifications.fire(),this,o)}get onDidChangeKernelSpecifications(){return A("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernelSpecifications"}),E(`API called from ${this.callingExtensionId}`),this._onDidChangeKernelSpecifications.event}get onDidChangeKernels(){return A("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernels"}),this._onDidChangeKernels.event}get status(){return this._status}get onDidChangeStatus(){return this._onDidChangeStatus.event}async getKernelSpecifications(){return A("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernelSpecifications"}),this.kernelFinder.kernels.map(e=>this.translateKernelConnectionMetadataToExportedType(e))}getActiveKernels(){A("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getActiveKernels"});let e=[],t=new Set;return this.kernelProvider.kernels.filter(n=>n.startedAtLeastOnce||n.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(n=>{let i=this.kernelProvider.get(n.notebook);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(n.kernelConnectionMetadata),uri:n.uri,id:n.id})}),this.thirdPartyKernelProvider.kernels.filter(n=>n.startedAtLeastOnce||n.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(n=>{let i=this.thirdPartyKernelProvider.get(n.uri);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(n.kernelConnectionMetadata),uri:n.uri,id:n.id})}),this.controllerRegistration.registered.forEach(n=>{n.controller.notebookType===bt&&n.connection.kind==="connectToLiveRemoteKernel"&&(!n.connection.kernelModel.id||t.has(n.connection.kernelModel.id)||e.push({metadata:n.connection,uri:void 0,id:n.id}))}),e}getKernel(e){A("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernel"});let t=this.thirdPartyKernelProvider.get(e)??this.kernelProvider.get(e);if(t?.session)return{metadata:this.translateKernelConnectionMetadataToExportedType(t.kernelConnectionMetadata),connection:gL(t.session)}}async startKernel(e,t){return A("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"startKernel"}),this.startOrConnect(e,t)}async connect(e,t){return A("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"connect"}),this.startOrConnect(e,t)}async startOrConnect(e,t){let n=this.kernelFinder.kernels.find(o=>o.id===e.id);if(!n)throw new Error("Not found");let i=await Vs.connectToKernel(n,this.serviceContainer,{resource:t},new Yt(!1),this.disposables,"3rdPartyExtension");if(!i?.session)throw new Error("Not found");return gL(i.session)}translateKernelConnectionMetadataToExportedType(e){if(!this.translatedConnections.has(e)){let t=Object.freeze(xs.fromJSON(e.toJSON()));this.translatedConnections.set(e,t)}return this.translatedConnections.get(e)}};XC=v([d(1,(0,hi.inject)(Ke)),d(2,(0,hi.inject)(Rr)),d(3,(0,hi.inject)(dm)),d(4,(0,hi.inject)(F)),d(5,(0,hi.inject)(Ct)),d(6,(0,hi.inject)(ut))],XC);var V0=_(O()),gl=require("vscode");var oQ=require("vscode");var Uf=class{constructor(e){this.fileSystem=e;this.activatedWorkspaces=new Set;this.disposables=[]}activate(){this.addHandlers(),this.addRemoveDocOpenedHandlers(),this.activateWorkspace(this.getActiveResource()).catch(f)}getActiveResource(){let e=oQ.window.activeTextEditor;return e&&!e.document.isUntitled?e.document.uri:Array.isArray(gl.workspace.workspaceFolders)&&gl.workspace.workspaceFolders.length>0?gl.workspace.workspaceFolders[0].uri:void 0}async activateWorkspace(e){let t=this.getWorkspaceKey(e);this.activatedWorkspaces.has(t)||(this.activatedWorkspaces.add(t),await yJ(this.fileSystem,e))}onDocOpened(e){if(e.languageId!==xe)return;let t=this.getWorkspaceKey(e.uri);if(t===""||(gl.workspace.workspaceFolders||[]).length===0||this.activatedWorkspaces.has(t))return;let n=gl.workspace.getWorkspaceFolder(e.uri);this.activateWorkspace(n?n.uri:void 0).catch(f)}addHandlers(){this.disposables.push(gl.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this))}addRemoveDocOpenedHandlers(){if(this.hasMultipleWorkspaces()){this.docOpenedHandler||(this.docOpenedHandler=gl.workspace.onDidOpenTextDocument(this.onDocOpened,this));return}this.docOpenedHandler&&(this.docOpenedHandler.dispose(),this.docOpenedHandler=void 0)}onWorkspaceFoldersChanged(){let e=(gl.workspace.workspaceFolders||[]).map(i=>this.getWorkspaceKey(i.uri)),n=Array.from(this.activatedWorkspaces.keys()).filter(i=>e.indexOf(i)<0);if(n.length>0)for(let i of n)this.activatedWorkspaces.delete(i);this.addRemoveDocOpenedHandlers()}hasMultipleWorkspaces(){return(gl.workspace.workspaceFolders||[]).length>1}getWorkspaceKey(e){return bs(e,"")}};v([yh("Failed to activate a workspace")],Uf.prototype,"activateWorkspace",1),Uf=v([(0,V0.injectable)(),d(0,(0,V0.inject)(st))],Uf);var hI=_(O());var fI=class{constructor(e){this.syncActivationServices=e}activate(){this.syncActivationServices.map(e=>{try{e.activate()}catch(t){x(`Error in activating extension, failed in ${e.constructor.name}`,t)}})}};fI=v([(0,hI.injectable)(),d(0,(0,hI.optional)()),d(0,(0,hI.multiInject)(be))],fI);var ZC=_(O()),yl=require("vscode");var vL=Symbol("ISurveyBanner");var vl=class{constructor(e,t){this.persistentState=e;this.disposables=t;this.disabledInCurrentSession=!1;this.bannerLabels=[CE.bannerLabelYes,CE.bannerLabelNo];this.showBannerState=new Map;this.NotebookExecutionThreshold=250;this.setPersistentState(0,"ShowInsidersNotebookSurveyBanner"),this.setPersistentState(1,"ShowExperimentNotebookSurveyBanner"),setTimeout(()=>{vl.surveyDelay=!0},10*60*1e3)}isEnabled(e){switch(e){case 0:if(fo()==="insiders")return this.isEnabledInternal(e);break;case 1:if(fo()==="stable")return this.isEnabledInternal(e);break;default:return x("Invalid Banner Type"),!1}return!1}isEnabledInternal(e){return yl.env.uiKind!==yl.UIKind.Desktop?!1:this.showBannerState.get(e).value.expiry?this.showBannerState.get(e).value.expiry<Date.now():!0}activate(){yl.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}async showBanner(e){if(!this.shouldShowBanner(e))return;switch(this.disabledInCurrentSession=!0,await yl.window.showInformationMessage(this.getBannerMessage(e),...this.bannerLabels)){case this.bannerLabels[0]:{await this.launchSurvey(e),await this.disable(0,e);break}default:{await this.disable(1,e);break}}}shouldShowBanner(e){return zd()||!this.isEnabled(e)||this.disabledInCurrentSession||!vl.surveyDelay?!1:this.getExecutionCount(e)>=this.NotebookExecutionThreshold}setPersistentState(e,t){this.showBannerState.set(e,this.persistentState.createGlobalPersistentState(t,{data:!0}))}async launchSurvey(e){Rg(this.getSurveyLink(e))}async disable(e,t){let n=e===0?6:4;n&&await this.showBannerState.get(t).updateValue({expiry:n*31*864e5+Date.now(),data:!0})}getExecutionCount(e){switch(e){case 0:return this.getPersistentState("DS_InsidersNotebookExecutionCount");case 1:return this.getPersistentState("DS_ExperimentNotebookExecutionCount");default:return x("Invalid Banner type"),-1}}getPersistentState(e){return this.persistentState.createGlobalPersistentState(e,0).value}async onDidChangeNotebookCellExecutionState(e){Tt(e.cell.notebook)&&e.state===yl.NotebookCellExecutionState.Executing&&(this.updateStateAndShowBanner("DS_InsidersNotebookExecutionCount",0).catch(f),this.updateStateAndShowBanner("DS_ExperimentNotebookExecutionCount",1).catch(f))}async updateStateAndShowBanner(e,t){let n=this.persistentState.createGlobalPersistentState(e,0);await n.updateValue(n.value+1),this.showBanner(t).catch(f)}getBannerMessage(e){switch(e){case 0:case 1:return BA.bannerMessage;default:return x("Invalid Banner type"),""}}getSurveyLink(e){switch(e){case 0:return"https://aka.ms/vscjupyternb";case 1:return"https://aka.ms/vscnbexp";default:return x("Invalid Banner type"),""}}};vl.surveyDelay=!1,vl=v([(0,ZC.injectable)(),d(0,(0,ZC.inject)(Ga)),d(1,(0,ZC.inject)(F))],vl);var ja=require("vscode");function sQ(r,e){e&&ja.commands.registerCommand("dataScience.ClearCache",async()=>{let t=[];for(let n of r.globalState.keys())t.push(r.globalState.update(n,void 0).then(f,f));for(let n of r.workspaceState.keys())t.push(r.workspaceState.update(n,void 0).then(f,f));t.push(ja.commands.executeCommand($.ClearSavedJupyterUris).then(f,f)),await Promise.all(t).catch(f),await Promise.all([ja.workspace.fs.delete(ja.Uri.joinPath(r.globalStorageUri,"lastExecutedRemoteCell.json")).then(f,f),ja.workspace.fs.delete(ja.Uri.joinPath(r.globalStorageUri,"remoteServersMRUList.json")).then(f,f),ja.workspace.fs.delete(ja.Uri.joinPath(r.globalStorageUri,py)).then(f,f)]),z("Cache cleared")})}function aQ(r,e){sQ(r,e)}var J0=_(O()),$t=require("vscode");var B0=y.percentPipCondaInstallInsteadOfBang("pip"),yL=y.percentPipCondaInstallInsteadOfBang("conda"),cQ=y.matplotlibWidgetInsteadOfOther,q0="Jupyter",gI=class{constructor(e){this.disposables=[];this.notebooksProcessed=new WeakMap;this.cellsToProcess=new Set;this.problems=$t.languages.createDiagnosticCollection(q0),this.disposables.push(this.problems),e.push(this)}dispose(){Q(this.disposables),this.problems.dispose()}activate(){this.disposables.push($t.languages.registerCodeActionsProvider(xe,this)),this.disposables.push($t.languages.registerHoverProvider(xe,this)),$t.workspace.onDidChangeTextDocument(e=>{let t=Yh(e.document);if(!t)return;let n=t.getCells().find(i=>i.document===e.document);n&&this.analyzeNotebookCell(n)},this,this.disposables),$t.workspace.onDidCloseNotebookDocument(e=>{this.problems.delete(e.uri);let t=this.notebooksProcessed.get(e);this.notebooksProcessed.delete(e),t&&t.forEach((n,i)=>this.problems.delete($t.Uri.parse(i)))},this,this.disposables),$t.workspace.onDidOpenNotebookDocument(e=>this.analyzeNotebook(e),this,this.disposables),$t.workspace.onDidChangeNotebookDocument(e=>{let t=this.notebooksProcessed.get(e.notebook);e.contentChanges.forEach(n=>{n.removedCells.forEach(i=>{t?.delete(i.document.uri.toString())}),n.addedCells.forEach(i=>this.queueCellForProcessing(i))}),e.cellChanges.forEach(n=>this.queueCellForProcessing(n.cell))},this,this.disposables),$t.workspace.notebookDocuments.map(e=>this.analyzeNotebook(e))}provideHover(e,t,n){if(Yh(e)?.notebookType!==bt)return;let o=this.problems.get(e.uri);if(!o)return;let s=o.find(c=>c.message===B0||c.message===yL);if(!s||!s.range.contains(t))return;let a=s.message===B0?"pip":"conda";return new $t.Hover(y.pipCondaInstallHoverWarning(a,"https://aka.ms/jupyterCellMagicBangInstall"),s.range)}provideCodeActions(e,t,n,i){if(!Yh(e))return[];let o=[];return n.diagnostics.forEach(s=>{switch(s.message){case B0:o.push(this.createReplaceCodeAction(e,"pip",s));break;case yL:o.push(this.createReplaceCodeAction(e,"conda",s));break;case cQ:o.push(this.createGotoWikiAction(e,$t.Uri.parse("https://aka.ms/vscodejupytermatplotlibwidget"),s));break;default:break}}),o}createReplaceCodeAction(e,t,n){let i=new $t.CodeAction(y.replacePipCondaInstallCodeAction(t),$t.CodeActionKind.QuickFix);i.isPreferred=!0,i.diagnostics=[n];let o=new $t.WorkspaceEdit;return o.replace(e.uri,new $t.Range(n.range.start,new $t.Position(n.range.start.line,n.range.start.character+1)),"%"),i.edit=o,i}createGotoWikiAction(e,t,n){let i=new $t.CodeAction(y.matplotlibWidgetCodeActionTitle,$t.CodeActionKind.QuickFix);return i.isPreferred=!0,i.diagnostics=[n],i.command={title:y.matplotlibWidgetCodeActionTitle,command:"vscode.open",arguments:[t]},i}analyzeNotebook(e){e.notebookType===bt&&e.getCells().forEach((t,n)=>n<100?this.queueCellForProcessing(t):void 0)}queueCellForProcessing(e){this.cellsToProcess.add(e),this.analyzeNotebookCells()}analyzeNotebookCells(){if(this.cellsToProcess.size===0)return;let e=this.cellsToProcess.values().next().value;this.cellsToProcess.delete(e),this.analyzeNotebookCell(e),setTimeout(()=>this.analyzeNotebookCells(),0)}analyzeNotebookCell(e){if(e.kind!==$t.NotebookCellKind.Code||e.document.languageId!==xe||e.notebook.isClosed||e.document.isClosed||this.notebooksProcessed.get(e.notebook)?.get(e.document.uri.toString())===e.document.version)return;this.problems.delete(e.document.uri);let t=this.notebooksProcessed.get(e.notebook)||new Map;t.set(e.document.uri.toString(),e.document.version),this.notebooksProcessed.set(e.notebook,t);for(let n=0;n<Math.min(e.document.lineCount,50);n++){let i=e.document.lineAt(n),o=i.text;if(o.trim().startsWith("!pip install")){let s=o.indexOf("!"),a=o.indexOf("l"),c=new $t.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:B0,range:c,severity:$t.DiagnosticSeverity.Error,source:q0}])}else if(o.trim().startsWith("!conda install")){let s=o.indexOf("!"),a=o.indexOf("l"),c=new $t.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:yL,range:c,severity:$t.DiagnosticSeverity.Error,source:q0}])}else if(o.trim().startsWith("%matplotlib")&&!o.trim().endsWith("widget")&&!o.trim().endsWith("inline")){let s=o.indexOf("%"),a=o.length,c=new $t.Range(i.lineNumber,s,i.lineNumber,a);this.problems.set(e.document.uri,[{message:cQ,range:c,severity:$t.DiagnosticSeverity.Warning,source:q0}])}}}};gI=v([(0,J0.injectable)(),d(0,(0,J0.inject)(F))],gI);var G0=_(O()),br=require("vscode");var lQ=new Map([["method",0],["function",1],["constructor",2],["field",3],["variable",4],["class",5],["struct",6],["interface",7],["module",8],["property",9],["event",10],["operator",11],["unit",12],["value",13],["constant",14],["enum",15],["enumMember",16],["keyword",17],["text",18],["color",19],["file",20],["reference",21],["customcolor",22],["folder",23],["typeParameter",24],["snippet",25],["<unknown>",3]]);function $0(r){if(r>=300)return"ZZZZZZZ";if(r<=25)return`A${String.fromCharCode(65+r)}`;let e=String.fromCharCode(65+Math.ceil(r/25)),t=String.fromCharCode(65+r%25);return`${e}${t}`}var bL=class{constructor(e,t,n){this.kernelId=e;this.kernel=t;this.monacoLanguage=n;this.pendingCompletionRequest=new WeakMap;this.previousCompletionItems=new WeakMap}async provideCompletionItems(e,t,n,i){if(!this.kernel.session?.kernel)return[];let o=e.version;if(this.pendingCompletionRequest.has(e))return[];this.pendingCompletionRequest.set(e,{position:t,version:o});let s=new br.Disposable(()=>{this.pendingCompletionRequest.get(e)?.position.isEqual(t)&&this.pendingCompletionRequest.get(e)?.version===o&&this.pendingCompletionRequest.delete(e)});try{let a=ds(fr(n,Promise.resolve(br.commands.executeCommand("vscode.executeCompletionItemProvider",e.uri,t)).then(m=>m?.items||[]))),c=new qe;if(await ji(100),n.isCancellationRequested)return[];let l=await pr(Li.IntellisenseTimeout,this.provideCompletionItemsFromKernel(e,t,n,i));if(n.isCancellationRequested||!l||!l.length)return[];let u=await pr(0,a.promise);_t(this.kernel.kernelConnectionMetadata)&&!a.completed&&c.elapsedTime<300&&(u=await pr(200,a.promise));let p=new Set((u||[]).map(m=>typeof m.label=="string"?m.label:m.label.label));return l.filter(m=>!p.has(typeof m.label=="string"?m.label:m.label.label))}catch(a){throw a instanceof br.CancellationError||E("Completions failed",a),a}finally{s.dispose()}}async provideCompletionItemsFromKernel(e,t,n,i){if(n.isCancellationRequested||!this.kernel.session?.kernel)return[];let o=new qe,s={duration:0,timesExceededTimeout:0,requestDuration:0,completionItems:0},a={kernelId:this.kernelId,kernelConnectionType:this.kernel.kernelConnectionMetadata.kind,kernelLanguage:Q0(this.kernel),monacoLanguage:this.monacoLanguage,cancelled:!1,kernelStatusBeforeRequest:this.kernel.status,completed:!1,requestSent:!1};if(this.kernel.status!=="idle")return[];let c=e.getText(),l=e.offsetAt(t);a.requestSent=!0;let u=await fr(n,this.kernel.session.kernel.requestComplete({code:c,cursor_pos:l}));if(E(`Jupyter completion time: ${o.elapsedTime}`),a.cancelled=n.isCancellationRequested,a.completed=!n.isCancellationRequested,a.kernelStatusAfterRequest=this.kernel.status,s.requestDuration=n.isCancellationRequested?0:o.elapsedTime,n.isCancellationRequested)return[];if(u?.content?.status!=="ok"||(u?.content?.matches?.length??0)===0)return pQ(this.kernel,s,a),[];let p={matches:u.content.matches,cursor:{start:u.content.cursor_start,end:u.content.cursor_end},metadata:u.content.metadata},m=p.metadata?p.metadata._jupyter_types_experimental:[];s.completionItems=p.matches.length,pQ(this.kernel,s,a);let h={code:c,cursor:p.cursor,documentRef:new WeakRef(e),position:e.positionAt(p.cursor.start)},g=new br.Range(e.positionAt(p.cursor.start),e.positionAt(p.cursor.end)),b=[];return Array.isArray(m)&&m.length>=p.matches.length&&m.every(w=>w&&typeof w.text=="string")?b=u.content.matches.map((w,k)=>{let N=m[k],D=N.type?lQ.get(N.type):br.CompletionItemKind.Field,V=new br.CompletionItem(w,D);return typeof N.start=="number"&&typeof N.end=="number"?V.range=new br.Range(e.positionAt(N.start),e.positionAt(N.end)):V.range=g,V.insertText=N.text,V.sortText=$0(k),_t(this.kernel.kernelConnectionMetadata)&&(w.startsWith("%")||w.startsWith("!"))&&(V.sortText=`ZZZ${V.sortText}`),this.previousCompletionItems.set(V,{...h,originalCompletionItem:JSON.parse(JSON.stringify(V))}),V}):b=p.matches.map((w,k)=>{let N=new br.CompletionItem(w);return N.range=g,N.sortText=$0(k),_t(this.kernel.kernelConnectionMetadata)&&(w.startsWith("%")||w.startsWith("!"))&&(N.sortText=`ZZZ${N.sortText}`),this.previousCompletionItems.set(N,{...h,originalCompletionItem:N}),N}),_t(this.kernel.kernelConnectionMetadata)?Nbe(i.triggerCharacter,this.allowStringFilterForPython,b,e,t):b}async resolveCompletionItem(e,t){if(!e.range||!this.kernel.session?.kernel)return e;let n=this.previousCompletionItems.get(e);if(!n)return e;let{documentRef:i,position:o,originalCompletionItem:s}=n,a=i.deref();return a?sH(e,s,t,this.kernel,this.kernelId,this.monacoLanguage,a,o):e}},uQ=new WeakMap,H0=new WeakMap;function pQ(r,e,t){let n=uQ.get(r),i=H0.get(r)?.count||0;e.duration>=Li.IntellisenseTimeout&&H0.set(r,{count:i+1,measures:e,properties:t}),e.timesExceededTimeout=i,n?n.elapsedTime>6e4&&(A("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",e,t),n.reset(),H0.delete(r)):(A("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",e,t),n=new qe,uQ.set(r,new qe),H0.delete(r))}var IL=class extends Zt{constructor(t,n){super();this.kernel=t;this.notebookEditorProvider=n;this.cellCompletionProviders=new WeakMap;this.completionItemsSent=new WeakMap;this.monacoLanguage=z0(this.kernel);this.registerCompletionProvider(),this._register(br.workspace.onDidChangeConfiguration(i=>{if(i.affectsConfiguration("jupyter.enableKernelCompletions"))if(dQ(this.kernel.notebook.uri))this.completionProvider||this.registerCompletionProvider();else{this.completionProvider?.dispose(),this.completionProvider=void 0;return}!i.affectsConfiguration("jupyter.completionTriggerCharacters")&&!i.affectsConfiguration("jupyter.pythonCompletionTriggerCharacters")||(this.completionProvider?.dispose(),this.completionProvider=void 0,this.registerCompletionProvider())}))}registerCompletionProvider(){if(!dQ(this.kernel.notebook.uri))return;let t=Tbe(this.kernel);if(t.length===0){Rbe(this.kernel);return}z(`Registering Kernel Completion Provider from kernel ${mt(this.kernel.kernelConnectionMetadata)} for language ${this.monacoLanguage}`),this.allowStringFilterForPython=t.includes("'")||t.includes('"'),this.completionProvider=br.languages.registerCompletionItemProvider(this.monacoLanguage,this,...t)}dispose(){super.dispose(),this.completionProvider?.dispose()}async provideCompletionItems(t,n,i,o){if(this.notebookEditorProvider.findAssociatedNotebookDocument(t.uri)!==this.kernel.notebook)return[];let s=this.cellCompletionProviders.get(t);if(!s){let a=await vt(this.kernel.kernelConnectionMetadata.id);s=new bL(a,this.kernel,this.monacoLanguage),this.cellCompletionProviders.set(t,s)}return s.allowStringFilterForPython=this.allowStringFilterForPython,s.provideCompletionItems(t,n,i,o).then(a=>(a.forEach(c=>this.completionItemsSent.set(c,s)),a))}async resolveCompletionItem(t,n){let i=this.completionItemsSent.get(t);return i?i.resolveCompletionItem(t,n):t}},Fd=class extends Zt{constructor(t){super();this.kernelCompletionProviders=new WeakMap;t.push(this)}activate(){let t=Te.instance.get(Ke);this._register(t.onDidStartKernel(async n=>{n.session?.kernel&&_t(n.kernelConnectionMetadata)&&n.session.kernel.requestComplete({code:"__file__.",cursor_pos:9});let i=Te.instance.get(za),o=z0(n);if(!o||!i.inExperiment("KernelCompletions")&&o.toLowerCase()!==xe.toLowerCase()||this.kernelCompletionProviders.has(n))return;let s=Te.instance.get(mi),a=this._register(new IL(n,s));this.kernelCompletionProviders.set(n,a)})),this._register(t.onDidDisposeKernel(n=>{this.kernelCompletionProviders.get(n)?.dispose()}))}};Fd=v([(0,G0.injectable)(),d(0,(0,G0.inject)(F))],Fd);function z0(r){return yc(Q0(r))}function Q0(r){let e="";switch(r.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":e=r.kernelConnectionMetadata.kernelModel.language;break;case"startUsingRemoteKernelSpec":e=r.kernelConnectionMetadata.kernelSpec.language;break;case"startUsingLocalKernelSpec":e=r.kernelConnectionMetadata.kernelSpec.language;break;default:e=r.kernelConnectionMetadata.kernelSpec.language;break}return(e||"").toLowerCase()}function dQ(r){return br.workspace.getConfiguration("jupyter",r).get("enableKernelCompletions",!1)}function Tbe(r){let e=br.workspace.getConfiguration("jupyter",r.notebook.uri).get("completionTriggerCharacters");if(!e||typeof e!="object")return[];let t=Q0(r),n=z0(r);return t in e?Array.isArray(e[t])?e[t]:[]:n in e?Array.isArray(e[n])?e[n]:[]:[]}function Rbe(r){let e=Q0(r),t=z0(r);e.toLowerCase()===t.toLowerCase()?j(br.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,mt(r.kernelConnectionMetadata),`{${e}`)):j(br.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
 or the following: 
jupyter.completionTriggerCharacters = {2}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,mt(r.kernelConnectionMetadata),`{${e}`,`{${t}`))}function Abe(r,e){let t=r.indexOf('"'),n=r.indexOf("'"),i=r.lastIndexOf('"'),o=r.lastIndexOf("'"),s=t>=0?t:n,a=i>=0?i:o;return s>=0&&e.character>s&&e.character<=a}function Nbe(r,e,t,n,i){let o=t,s=i.character===0?void 0:new br.Range(i.line,i.character-1,i.line,i.character),c=(s?n.getText(s):void 0)===".",l=n.getWordRangeAtPosition(c||r==="."?new br.Position(i.line,i.character-1):i),u=l&&s?l.union(s):void 0,p=n.lineAt(i.line).text,m=u?n.getText(u):p,h=m.endsWith(".")||c,g=e&&(r=="'"||r=='"'||Abe(p,i));return ne(`Jupyter completions filtering applied: ${g} on ${p}`),o=o.map((b,w)=>{let k=typeof b.label=="string"?b.label:b.label.label,N=typeof b.label=="string"?b.label:b.label.label;if(N.startsWith("%")||N.startsWith("!"))return{...b,sortText:`ZZZ${b.sortText}`};if(g)return b;let D=m?N.indexOf(m):-1,V,oe,G;if(m&&h&&N.includes(m)){V=N.substring(N.indexOf(m)+(h?m.length:0)),oe=N.substring(N.indexOf(m)+m.length);let pe=(typeof b.label=="string"?b.label.length:b.label.label.length)-oe.length;G=b.range&&"start"in b.range?new br.Range(new br.Position(b.range.start.line,b.range.start.character+pe),b.range.end):b.range}if(!oe&&D>0){V=N.substring(N.indexOf(m)+(h?m.length:0)),oe=N.substring(N.indexOf(m)+m.length);let pe=(typeof b.label=="string"?b.label.length:b.label.label.length)-oe.length;G=b.range&&"start"in b.range?new br.Range(new br.Position(b.range.start.line,b.range.start.character+pe),b.range.end):b.range}return V&&oe&&G&&(b.label=V,k=oe,b.insertText=oe,b.filterText=h?`.${oe}`:oe,b.range=G,b.sortText=$0(w)),k.endsWith("/")?{...b,command:{command:"editor.action.triggerSuggest",title:""}}:(k.includes(" ")&&(k=k.replace(/\\ /g," "),typeof b.label=="string"?b.label=b.label.replace(/\\ /g," "):b.label.label=b.label.label.replace(/\\ /g," ")),g||!k.includes(".")&&!k.endsWith("/")?b:void 0)}).filter(b=>b!==void 0),ne(`Jupyter completions for ${m} at pos ${i.line}:${i.character} with trigger: ${r}
   ${t.map(b=>b.label).join(",")}`),ne(`Jupyter results for ${m} at pos ${i.line}:${i.character} with trigger: ${r}
   ${o.map(b=>b.label).join(",")}`),o}var Ld=_(O()),jf=require("vscode");var hQ=_(Fc());var mQ=require("vscode");function fQ(r){if(r.scheme!=="vscode-interactive-input")return;let e=`${r.path.replace("InteractiveInput-","Interactive-")}.interactive`;return mQ.workspace.notebookDocuments.find(t=>t.uri.path===e)?.uri}var Ud=class{constructor(e,t,n,i,o){this.apiProvider=e;this.extensionChecker=t;this.notebookEditorProvider=n;this.controllerRegistration=i;this.kernelProvider=o;this._isPylanceExtensionInstalled()||(this.extensionChangeHandler=jf.extensions.onDidChange(this.extensionsChangeHandler.bind(this)))}activate(){!this.isUsingPylance()||!this.extensionChecker.isPythonExtensionInstalled||this.apiProvider.getApi().then(e=>{e.registerJupyterPythonPathFunction!==void 0&&e.registerJupyterPythonPathFunction(t=>this._jupyterPythonPathFunction(t)),e.registerGetNotebookUriForTextDocumentUriFunction!==void 0&&e.registerGetNotebookUriForTextDocumentUriFunction(t=>this._getNotebookUriForTextDocumentUri(t))}).catch(f)}async reset(){this._isEnabled=void 0,await this.activate()}_isPylanceExtensionInstalled(){return jf.extensions.getExtension(Qd)!==void 0}async extensionsChangeHandler(){this._isPylanceExtensionInstalled()&&this.extensionChangeHandler&&(this.extensionChangeHandler.dispose(),this.extensionChangeHandler=void 0,await this.reset())}isUsingPylance(){if(this._isEnabled===void 0){let t=jf.workspace.getConfiguration("python")?.get("languageServer");this._isEnabled=!1,t!=="Pylance"&&t!=="Default"?z("Not using Pylance"):(this._isEnabled=!0,z("Using Pylance"))}return this._isEnabled}async _jupyterPythonPathFunction(e){let t=this.notebookEditorProvider.findAssociatedNotebookDocument(e);if(!t)return;let n=this.controllerRegistration.getSelected(t);if(n&&Ft(n.connection)){let o=this.kernelProvider.get(t);if(!o)return;let s=[];if(!o.startedAtLeastOnce){let g=new Promise(b=>o.onStarted(b,void 0,s));await pr(5e3,void 0,g)}if(!o.startedAtLeastOnce)return;let a=this.kernelProvider.getKernelExecution(o),c=`
import os as _VSCODE_os
import sys as _VSCODE_sys
import builtins as _VSCODE_builtins

if _VSCODE_os.path.exists("${__filename}"):
    _VSCODE_builtins.print(f"EXECUTABLE{_VSCODE_sys.executable}EXECUTABLE")

del _VSCODE_os, _VSCODE_sys, _VSCODE_builtins
`,u=(await a.executeHidden(c).catch(f)||[]).find(g=>g.output_type==="stream"&&g.name==="stdout");if(!u||!(u.text||"").toString().includes("EXECUTABLE"))return;let p=(u.text||"").toString();p=p.substring(p.indexOf("EXECUTABLE"));let m=p.split("EXECUTABLE").filter(g=>g.trim().length),h=m.length?m[0].trim():"";return!h||!await hQ.pathExists(h)?void 0:h}let i=n?.connection?.interpreter;return i?Pe(i.uri):(z(`No interpreter for Pylance for Notebook URI "${W(t.uri)}"`),"")}_getNotebookUriForTextDocumentUri(e){let t=fQ(e);if(!t)return;let n;return jf.window.tabGroups.all.find(i=>{i.tabs.find(o=>{if(Rf(o)){let s=o.input.uri.toString();o.input.uri.toString().endsWith(t.path)&&(n=s)}})}),n}};Ud=v([(0,Ld.injectable)(),d(0,(0,Ld.inject)(Gt)),d(1,(0,Ld.inject)(ze)),d(2,(0,Ld.inject)(mi)),d(3,(0,Ld.inject)(Ct)),d(4,(0,Ld.inject)(Ke))],Ud);function gQ(r){r.addSingleton(be,gI),r.addSingleton(Fd,Fd),r.addBinding(Fd,be),r.addSingleton(Ud,Ud),r.addBinding(Ud,be)}var yI=_(O());var vQ=require("vscode");var vI=class{constructor(e,t,n){this.extensionChecker=e;this.disposables=t;this.kernelProvider=n}activate(){this.extensionChecker.onPythonExtensionInstallationStatusChanged(this.onPythonExtensionInstallationStatusChanged,this,this.disposables)}async onPythonExtensionInstallationStatusChanged(e){e==="installed"&&this.anyKernelsAreActive()&&vQ.window.showInformationMessage(y.pythonExtensionInstalled,ye.ok).then(f,f)}anyKernelsAreActive(){return this.kernelProvider.kernels.length>0}};vI=v([(0,yI.injectable)(),d(0,(0,yI.inject)(ze)),d(1,(0,yI.inject)(F)),d(2,(0,yI.inject)(Ke))],vI);var Ur=_(O()),IQ=_(So()),wt=require("vscode");var bl=require("vscode");var Y0=class{constructor(e,t,n,i,o){this.configService=e;this.agentCreator=t;this.requestCreator=n;this.serverUriStorage=i;this.disposables=o;this.savedConnectInfo=new Map;this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}getPasswordConnectionInfo(e){if(!e.url||e.url.length<1)throw new Error("Invalid URL");let t=ew(e.url),n=e.disposables||[],i=!Array.isArray(e.disposables),o=this.savedConnectInfo.get(e.handle);return o||(o=this.getJupyterConnectionInfo({url:t,isTokenEmpty:e.isTokenEmpty,disposables:n,validationErrorMessage:e.validationErrorMessage}).then(s=>((!s||s.requiresPassword&&Object.keys(s).length===1)&&(j(`Password for ${t} was invalid.`),this.savedConnectInfo.delete(e.handle)),s)),o.catch(()=>this.savedConnectInfo.delete(e.handle)),o.finally(()=>{i&&Q(n)}).catch(f),this.savedConnectInfo.set(e.handle,o)),o}async getJupyterConnectionInfo(e){let t,n,i,o,s=await this.needPassword(e.url);if(s||e.isTokenEmpty){if(s&&e.isTokenEmpty){let a=bl.window.createInputBox();e.disposables.push(a),a.title=y.jupyterSelectPasswordTitle,a.placeholder=y.jupyterSelectPasswordPrompt,a.ignoreFocusOut=!0,a.password=!0,a.validationMessage=e.validationErrorMessage||"",a.show(),a.buttons=[bl.QuickInputButtons.Back],o=await new Promise((c,l)=>{a.onDidTriggerButton(u=>{u===bl.QuickInputButtons.Back&&l(Ne.back)},this,e.disposables),a.onDidChangeValue(()=>a.validationMessage="",this,e.disposables),a.onDidAccept(()=>c(a.value),this,e.disposables),a.onDidHide(()=>l(Ne.cancel),this,e.disposables)})}if(typeof o===void 0&&!o&&e.isTokenEmpty)throw new bl.CancellationError;if(o||e.isTokenEmpty)if(t=await this.getXSRFToken(e.url,""),t){let a=await this.getSessionCookie(e.url,t,o||"");n=a.sessionCookieName,i=a.sessionCookieValue}else n="authservice_session",i=o,t=await this.getXSRFToken(e.url,`${n}=${i}`);else return{requiresPassword:s}}else return{requiresPassword:s};return t&&n&&(i||e.isTokenEmpty)?(A("DS_INTERNAL.GET_PASSWORD_SUCCESS"),{requestHeaders:{Cookie:`_xsrf=${t}; ${n}=${i||""}`,"X-XSRFToken":t},requiresPassword:s}):(A("DS_INTERNAL.GET_PASSWORD_FAILURE"),{requiresPassword:s})}addAllowUnauthorized(e,t,n){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...n,agent:i}}return n}async getXSRFToken(e,t){let n,i,o=new URL("login?",ew(e)).toString();t!=""?(o=new URL("tree",ew(e)).toString(),i={Connection:"keep-alive",Cookie:t}):i={Connection:"keep-alive"};let s=await this.makeRequest(o,{method:"get",redirect:"manual",headers:i});if(s!==void 0&&s.ok){let a=this.getCookies(s);a.has("_xsrf")&&(n=a.get("_xsrf")?.split(";")[0])}return n}async needPassword(e){return(await this.makeRequest(new URL("tree?",ew(e)).toString(),{method:"get",redirect:"manual",headers:{Connection:"keep-alive"}})).status!==200}async makeRequest(e,t){let n=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!n,t))}catch(i){if(i.message.indexOf("reason: self signed certificate")>=0){let o=y.jupyterSelfCertEnable,s=y.jupyterSelfCertClose,a=await bl.window.showErrorMessage(y.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return A("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,bl.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&A("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}async getSessionCookie(e,t,n){let i,o,s=new URLSearchParams;s.append("_xsrf",t),s.append("password",n);let a=await this.makeRequest(new URL("login?",ew(e)).toString(),{method:"post",headers:{Cookie:`_xsrf=${t}`,Connection:"keep-alive","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s.toString(),redirect:"manual"});if(a.status===302){let c=this.getCookies(a);c.size>0&&(i=c.entries().next().value[0],o=c.entries().next().value[1])}return{sessionCookieName:i,sessionCookieValue:o}}getCookies(e){let t=new Map,i=(e.headers.raw?e.headers.raw():e.headers)["set-cookie"];return i&&i.forEach(o=>{let s=o.substring(0,o.indexOf("=")),a=o.substring(o.indexOf("=")+1);t.set(s,a)}),t}onDidRemoveServers(e){e.forEach(t=>{t.id.startsWith("_builtin")&&this.savedConnectInfo.delete(t.handle)})}};function ew(r){let e=r;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var Z0=require("vscode");var X0=class{constructor(e,t,n,i,o,s,a){this.multiStepFactory=e;this.asyncDisposableRegistry=t;this.configService=n;this.agentCreator=i;this.requestCreator=o;this.serverUriStorage=s;this.disposables=a;this.savedConnectInfo=new Map;this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}async getPasswordConnectionInfo(e){if(!e.url||e.url.length<1)throw new Error("Invalid URL");if(!await this.isJupyterHub(e.url))throw new Error("Not a Jupyter Hub Url");let t=yQ(e.url),n=e.disposables||[],i=!Array.isArray(e.disposables),o=this.savedConnectInfo.get(e.handle);return o||(o=this.getJupyterHubConnectionInfo(t,e.validationErrorMessage).then(s=>((!s||s.requiresPassword&&Object.keys(s).length===1)&&(j(`Password for ${t} was invalid.`),this.savedConnectInfo.delete(e.handle)),s)),o.catch(()=>this.savedConnectInfo.delete(e.handle)),o.finally(()=>{i&&Q(n)}).catch(f),this.savedConnectInfo.set(e.handle,o)),o}async isJupyterHub(e){try{if(e.toLowerCase().includes("/user/")&&e.includes("token="))return!1;if(e.toLowerCase().includes("/user/")&&!e.includes("token="))return!0;let t=await this.makeRequest(new URL("hub/api",yQ(e)).toString(),{method:"get"});if(t.status!==200)return!1;try{let n=await t.json();return E(`JupyterHub version is ${n&&n.version} for url ${e}`),n&&n.version}catch{}return!1}catch(t){return E(`Error in detecting whether url is isJupyterHub: ${t}`),!1}}async getJupyterHubConnectionInfo(e,t){try{let n=await this.getUserNameAndPassword(t);if(n.username||n.password){let i=await this.getJupyterHubConnectionInfoFromLogin(e,n.username,n.password);if(i){let o=Object.keys(i||{}).length===0,s=o?"emptyResponseFromLogin":"gotResponseFromLogin";A("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:o,info:s})}else{A("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:!0,info:"emptyResponseFromLogin"}),i=await this.getJupyterHubConnectionInfoFromApi(e,n.username,n.password);let o=Object.keys(i||{}).length===0,s=o?"emptyResponseFromApi":"gotResponseFromApi";A("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:o,info:s})}return i}return A("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:!1,info:"passwordNotRequired"}),{requiresPassword:!1}}catch(n){throw A("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:!0,info:"failure"}),n}}async getJupyterHubConnectionInfoFromLogin(e,t,n){let i=new URL(e),o=`${i.protocol}//${i.host}`,s=new URLSearchParams;s.append("username",t||""),s.append("password",n||"");let a=await this.makeRequest(`${o}/hub/login?next=`,{method:"POST",headers:{Connection:"keep-alive",Referer:`${o}/hub/login`,"content-type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s.toString(),redirect:"manual"});if(a&&a.status===302){let l=[...this.getCookies(a).entries()].reduce((u,p)=>`${u};${p[0]}=${p[1]}`,"");if(a=await this.makeRequest(`${o}/hub/api/users/${t}/tokens`,{method:"POST",headers:{Connection:"keep-alive",Cookie:l,Referer:`${o}/hub/login`}}),a.ok&&a.status===200){let u=await a.json();if(u&&u.token&&u.id)return await this.makeRequest(`${o}/hub/api/users/${t}/server`,{method:"POST",headers:{Connection:"keep-alive",Cookie:l,Referer:`${o}/hub/login`}}),this.asyncDisposableRegistry.push({dispose:async()=>{this.makeRequest(`${o}/hub/api/users/${t}/tokens/${u.id}`,{method:"DELETE",headers:{Connection:"keep-alive",Cookie:l,Referer:`${o}/hub/login`}}).catch(f)}}),{requestHeaders:{},remappedBaseUrl:`${o}/user/${t}`,remappedToken:u.token,requiresPassword:!0}}}}async getJupyterHubConnectionInfoFromApi(e,t,n){let i=new URL(e),o=`${i.protocol}//${i.host}`,s=await this.makeRequest(`${o}/hub/api/authorizations/token`,{method:"POST",headers:{Connection:"keep-alive","content-type":"application/json;charset=UTF-8"},body:`{ "username": "${t||""}", "password": "${n||""}"  }`,redirect:"manual"});if(s.ok&&s.status===200){let a=await s.json();if(a&&a.user&&a.user.server&&a.token)return{requestHeaders:{},remappedBaseUrl:`${o}${a.user.server}`,remappedToken:a.token,requiresPassword:!0}}return{requiresPassword:!1}}addAllowUnauthorized(e,t,n){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...n,agent:i}}return n}async getUserNameAndPassword(e){let t=this.multiStepFactory.create(),n={username:"",password:"",validationMessage:e};return await t.run(this.getUserNameMultiStep.bind(this),n),n}async getUserNameMultiStep(e,t){if(t.username=await e.showInputBox({title:y.jupyterSelectUserAndPasswordTitle,prompt:y.jupyterSelectUserPrompt,validate:this.validateUserNameOrPassword,validationMessage:t.validationMessage,value:""}),t.username)return this.getPasswordMultiStep.bind(this)}async validateUserNameOrPassword(e){}async getPasswordMultiStep(e,t){t.password=await e.showInputBox({title:y.jupyterSelectUserAndPasswordTitle,prompt:y.jupyterSelectPasswordPrompt,validate:this.validateUserNameOrPassword,value:"",password:!0})}async makeRequest(e,t){let n=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!n,t))}catch(i){if(i.message.indexOf("reason: self signed certificate")>=0){let o=y.jupyterSelfCertEnable,s=y.jupyterSelfCertClose,a=await Z0.window.showErrorMessage(y.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return A("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,Z0.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&A("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}getCookies(e){let t=new Map,i=(e.headers.raw?e.headers.raw():e.headers)["set-cookie"];return i&&i.forEach(o=>{let s=o.substring(0,o.indexOf("=")),a=o.substring(o.indexOf("=")+1);t.set(s,a)}),t}onDidRemoveServers(e){e.forEach(t=>{t.id.startsWith("_builtin")&&this.savedConnectInfo.delete(t.handle)})}};function yQ(r){let e=r;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var e1="user-jupyter-server-uri-list-version2";var Mbe="DataScienceAllowInsecureConnections",bI=class extends Zt{constructor(t,n,i,o,s,a,c,l,u,p,m,h,g,b=jR){super();this.jupyterConnection=n;this.context=m;this.fs=h;this.jupyterServerProviderRegistry=g;this.id=b;this.extensionId=It;this.documentation=wt.Uri.parse("https://aka.ms/vscodeJuptyerExtKernelPickerExistingServer");this.displayName=y.UserJupyterServerUrlProviderDisplayName;this.detail=y.UserJupyterServerUrlProviderDetail;this._onDidChangeHandles=this._register(new wt.EventEmitter);this.onDidChangeHandles=this._onDidChangeHandles.event;this._onDidChangeServers=this._register(new wt.EventEmitter);this.onDidChangeServers=this._onDidChangeServers.event;a.push(this),this.newStorage=new nw(i),this.secureConnectionValidator=new rw(s),this.jupyterServerUriInput=new tw(p),this.jupyterServerUriDisplayName=new SL,this.jupyterPasswordConnect=new Y0(t,u,p,o,a),this.jupyterHubPasswordConnect=new X0(c,l,t,u,p,o,a)}activate(){let t=this._register(this.jupyterServerProviderRegistry.createJupyterServerCollection(It,this.id,this.displayName,this));t.commandProvider=this,t.documentation=this.documentation,this._register(this.onDidChangeHandles(()=>this._onDidChangeServers.fire(),this)),this._register(wt.commands.registerCommand("dataScience.ClearUserProviderJupyterServerCache",async()=>{await Promise.all([this.newStorage.clear().catch(f),this.fs.delete(wt.Uri.joinPath(this.context.globalStorageUri,py)).catch(f)]),this._onDidChangeHandles.fire()})),this.initializeServers().catch(f)}async resolveJupyterServer(t,n){let i=await this.getServerUri(t.id);return{...t,connectionInformation:{id:t.id,label:t.label,baseUrl:wt.Uri.parse(i.baseUrl),token:i.token,headers:i.authorizationHeader,mappedRemoteNotebookDir:i.mappedRemoteNotebookDir?wt.Uri.file(i.mappedRemoteNotebookDir):void 0}}}async handleCommand(t,n){let i=new wt.CancellationTokenSource;this._register(new wt.Disposable(()=>{i.cancel(),i.dispose()}));try{let o="url"in t?t.url:void 0,s=await this.captureRemoteJupyterUrl(i.token,o);if(!s||s===Ne.cancel)throw new wt.CancellationError;if(s&&s instanceof Ne)return;let c=(await this.provideJupyterServers(i.token)).find(l=>l.id===s);if(!c)throw new Error(`Server ${s} not found`);return c}catch(o){if(o instanceof wt.CancellationError)throw o;x("Failed to select a Jupyter Server",o);return}finally{i.cancel(),i.dispose()}}async provideCommands(t,n){let i="";try{t=(t||"").trim(),["http:","https:"].includes(new URL(t.trim()).protocol.toLowerCase())&&(i=t)}catch{}return i?[{label:y.connectToToTheJupyterServer(i),url:i}]:[{label:y.jupyterSelectUriCommandLabel,canBeAutoSelected:!0}]}async provideJupyterServers(t){return await this.initializeServers(),(await this.newStorage.getServers(!1)).map(i=>({id:i.handle,label:i.serverInfo.displayName}))}async removeJupyterServer(t){await this.initializeServers(),await this.newStorage.remove(t.id),this._onDidChangeHandles.fire()}initializeServers(){if(this._cachedServerInfoInitialized)return this._cachedServerInfoInitialized;let t=ue();return this._cachedServerInfoInitialized=t.promise,(async()=>{this.newStorage.getServers(!1).catch(f),t.resolve()})().then(()=>t.resolve(),n=>t.reject(n)).catch(f),this._cachedServerInfoInitialized}recommendInstallingJupyterHubExtension(){if(!wt.workspace.getConfiguration("jupyter").get("bypassJupyterHubExtensionCheck"))throw wt.extensions.getExtension(ah)?wt.window.showInformationMessage(y.useJupyterHubExtension,{modal:!0,detail:y.useJupyterHubExtensionDetail}).then(()=>{wt.commands.executeCommand("notebook.selectKernel",{notebookEditor:wt.window.activeNotebookEditor}).then(f,f)},f):wt.window.showInformationMessage(y.installJupyterHub,{modal:!0,detail:y.installJupyterHubDetail},ye.install,ye.moreInfo).then(t=>{t===ye.install?wt.commands.executeCommand("workbench.extensions.installExtension",ah,{context:{skipWalkthrough:!0}}).then(f,f):t===ye.moreInfo&&wt.env.openExternal(wt.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter-hub")).then(f,f)},f),new wt.CancellationError}async captureRemoteJupyterUrl(t,n=""){await this.initializeServers();let i=[],o={baseUrl:"",displayName:"",token:""},s="",a=!1,c=!1,l,u="Get Url",p="Get Url",m=n,h=!1;if(n){let g=await this.jupyterServerUriInput.parseUserUriAndGetValidationError(n);typeof g.validationError=="string"?(s=g.validationError,u="Get Url"):(h=!0,o=g.jupyterServerUri,u="Check Passwords")}try{let g=!1,b=!1;for(;;)try{if(l=(0,IQ.default)(),u==="Get Url"){h=!1,u="Check Passwords",p=void 0;let k=s;s="";let N=await this.jupyterServerUriInput.getUrlFromUser(m||n,k,i);o=N.jupyterServerUri,m=N.url}if(t.isCancellationRequested)return Ne.cancel;let w=[];if(u==="Check Passwords"){u="Check Insecure Connections",p=h&&n?void 0:"Get Url";try{let k=s;s="",g=await this.jupyterHubPasswordConnect.isJupyterHub(o.baseUrl),g&&this.recommendInstallingJupyterHubExtension();let N=g?await this.jupyterHubPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,handle:l,displayName:o.displayName,validationErrorMessage:k,disposables:w}):await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:l,validationErrorMessage:k,disposables:w});a=N.requiresPassword,o.authorizationHeader=N.requestHeaders,b=!1}catch(k){if(b=!1,k instanceof wt.CancellationError||k==Ne.back||k==Ne.cancel)throw k;if(!Uo.isSelfCertsError(k)){if(!xc.isSelfCertsExpiredError(k)){Wf(l,o.baseUrl,g,"ConnectionFailure");let N=/(https?:\/\/[^\s]+)/g,D=(k.message||k.toString()).replace(N,V=>`[${V}](${V})`);if(s=(Br()?y.remoteJupyterConnectionFailedWithoutServerWithErrorWeb:y.remoteJupyterConnectionFailedWithoutServerWithError)(D),o.token.length>0&&(k.message||"").toLowerCase()==="Failed to fetch".toLowerCase())b=!0;else{u="Get Url";continue}}}}finally{w.forEach(k=>this._register(k))}}if(t.isCancellationRequested)return Ne.cancel;if(u==="Check Insecure Connections"&&(u="Verify Connection",p=a&&o.token.length===0?"Check Passwords":"Get Url",p==="Get Url"&&(p=h&&n?void 0:"Get Url"),!a&&o.token.length===0&&new URL(o.baseUrl).protocol.toLowerCase()==="http:"&&(c=!0,Q(w),!await this.secureConnectionValidator.promptToUseInsecureConnections())))return Wf(l,o.baseUrl,g,"InsecureHTTP"),Ne.cancel;if(t.isCancellationRequested)return Ne.cancel;if(u==="Verify Connection")try{u="Get Display Name",await this.jupyterConnection.validateRemoteUri({id:this.id,handle:l,extensionId:It},o,!0)}catch(k){if(j("Uri verification error",k),b&&s){u="Get Url";continue}if(k instanceof wt.CancellationError||k==Ne.back||k==Ne.cancel)throw k;if(Uo.isSelfCertsError(k)){s=y.jupyterSelfCertFailErrorMessageOnly,u="Get Url",Wf(l,o.baseUrl,g,"SelfCert");continue}else if(xc.isSelfCertsExpiredError(k)){s=y.jupyterSelfCertExpiredErrorMessageOnly,u="Get Url",Wf(l,o.baseUrl,g,"ExpiredCert");continue}else if(a&&o.token.length===0){s=y.passwordFailure,u="Check Passwords",Wf(l,o.baseUrl,g,"AuthFailure");continue}else{Wf(l,o.baseUrl,g,"ConnectionFailure");let N=/(https?:\/\/[^\s]+)/g,D=(k.message||k.toString()).replace(N,V=>`[${V}](${V})`);s=(Br()?y.remoteJupyterConnectionFailedWithoutServerWithErrorWeb:y.remoteJupyterConnectionFailedWithoutServerWithError)(D),u="Get Url";continue}}finally{Q(w)}if(t.isCancellationRequested)return Ne.cancel;if(u==="Get Display Name"){Q(w),p=c?"Check Insecure Connections":a&&o.token.length===0?"Check Passwords":"Get Url",p==="Get Url"&&(p=h&&n?void 0:"Get Url"),o.displayName=await this.jupyterServerUriDisplayName.getDisplayName(l,o.displayName||new URL(o.baseUrl).hostname);break}}catch(w){if(w instanceof wt.CancellationError||w===Ne.cancel)return Ne.cancel;if(w===Ne.back){if(!p)return Ne.back;u=p;continue}throw w}return t.isCancellationRequested?Ne.cancel:(await this.addNewServer({handle:l,uri:m,serverInfo:o}),K_({extensionId:this.extensionId,id:this.id,handle:l},o.displayName),Wf(l,o.baseUrl,g),l)}catch(g){if(g instanceof wt.CancellationError)return Ne.cancel;throw g}finally{Q(i)}}async addNewServer(t){await this.newStorage.add(t),this._onDidChangeHandles.fire()}async getServerUri(t){let i=(await this.newStorage.getServers(!1)).find(l=>l.handle===t);if(!i)throw new Error("Server not found");let o=i.serverInfo,s=this.jupyterServerUriDisplayName.displayNamesOfHandles.get(t);s&&(o.displayName=s);let a=await this.jupyterHubPasswordConnect.isJupyterHub(o.baseUrl),c=Object.assign({},o);try{let l=a?await this.jupyterHubPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,handle:t,displayName:o.displayName}):await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:t});c=Object.assign({},o,{authorizationHeader:l.requestHeaders||o.authorizationHeader}),a&&l.remappedBaseUrl&&(c.baseUrl=l.remappedBaseUrl),a&&l.remappedToken&&(c.token=l.remappedToken)}catch(l){x("Failed to validate Password info",l)}return c}};bI=v([(0,Ur.injectable)(),d(0,(0,Ur.inject)(le)),d(1,(0,Ur.inject)(cn)),d(2,(0,Ur.inject)(ax)),d(3,(0,Ur.inject)(er)),d(4,(0,Ur.inject)($e)),d(4,(0,Ur.named)(St)),d(5,(0,Ur.inject)(F)),d(6,(0,Ur.inject)(Og)),d(7,(0,Ur.inject)(ni)),d(8,(0,Ur.inject)(dp)),d(8,(0,Ur.optional)()),d(9,(0,Ur.inject)(Fl)),d(10,(0,Ur.inject)(lt)),d(11,(0,Ur.inject)(st)),d(12,(0,Ur.inject)(Qt)),d(13,(0,Ur.optional)()),d(13,(0,Ur.inject)(Date.now().toString()))],bI);var tw=class{constructor(e){this.requestCreator=e}async getUrlFromUser(e,t="",n){if(!e&&!Fw)try{let s=await wt.env.clipboard.readText(),a=s.trim().startsWith("https://github.com/")?void 0:wt.Uri.parse(s.trim(),!0);e=s&&a&&a.scheme.toLowerCase().startsWith("http")?s:""}catch{e=""}let i=wt.window.createInputBox();n.push(i),i.title=y.jupyterSelectUriInputTitle,i.placeholder=y.jupyterSelectUriInputPlaceholder,i.value=e,i.validationMessage=t,i.buttons=[wt.QuickInputButtons.Back],i.ignoreFocusOut=!0,i.show();let o=ue();return i.onDidChangeValue(()=>i.validationMessage="",this,n),i.onDidHide(()=>o.reject(Ne.cancel),this,n),i.onDidTriggerButton(s=>{s===wt.QuickInputButtons.Back&&o.reject(Ne.back)},this,n),i.onDidAccept(async()=>{let s=await this.parseUserUriAndGetValidationError(i.value);if(typeof s.validationError=="string"){i.validationMessage=s.validationError;return}o.resolve(s)}),o.promise}async parseUserUriAndGetValidationError(e){let t=e.trim().replace(/\/(lab|tree)(\??)$/,""),n=xL(t,"");return n?(n.baseUrl=await Obe(t,this.requestCreator)||n.baseUrl,!t.toLowerCase().startsWith("http:")&&!t.toLowerCase().startsWith("https:")?{validationError:y.jupyterSelectURIMustBeHttpOrHttps}:{jupyterServerUri:n,url:t,validationError:void 0}):{validationError:y.jupyterSelectURIInvalidURI}}};tw=v([d(0,(0,Ur.inject)(Fl))],tw);async function Obe(r,e){try{if(r=xL(r,"")?.baseUrl||r,new URL(r).pathname==="/")return r;let t=r.indexOf("token=")>0?r.substring(0,r.indexOf("token=")):r,o=(await e.getFetchMethod()(t,{method:"GET",redirect:"manual"})).headers.get("location");if(o&&o.includes("login?"))return o.substring(0,o.indexOf("login?"))}catch(t){E("Unable to identify the baseUrl of the Jupyter Server",t)}}function Wf(r,e,t,n){e=e.trim().toLowerCase();let i=Wt({handle:r,extensionId:It,id:jR});Promise.all([vt(e.toLowerCase()),vt(i.toLowerCase())]).then(([o,s])=>{A("DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",void 0,{serverIdHash:s,failed:!!n,baseUrlHash:o,isJupyterHub:t,isLocalHost:["localhost","127.0.0.1","::1"].includes(new URL(e).hostname),reason:n})}).catch(o=>x(`Failed to hash remote url ${e}`,o))}var SL=class{constructor(){this.displayNamesOfHandles=new Map}async getDisplayName(e,t){let n=[];try{let i=wt.window.createInputBox();n.push(i),i.ignoreFocusOut=!0,i.title=y.jupyterRenameServer,i.value=t,i.placeholder=y.jupyterServerUriDisplayNameInputPlaceholder,i.buttons=[wt.QuickInputButtons.Back],i.show();let o=ue();return n.push(i.onDidHide(()=>o.reject(Ne.cancel))),i.onDidTriggerButton(s=>{s===wt.QuickInputButtons.Back&&o.reject(Ne.back)},this,n),i.onDidAccept(()=>{let s=i.value.trim()||t;this.displayNamesOfHandles.set(e,s),o.resolve(s)},this,n),await o.promise}finally{Q(n)}}},rw=class{constructor(e){this.globalMemento=e}async promptToUseInsecureConnections(){if(this.globalMemento.get(Mbe,!1))return!0;let e=[],t=ue();try{let n=wt.window.createQuickPick();e.push(n),n.canSelectMany=!1,n.ignoreFocusOut=!0,n.title=y.insecureSessionMessage,n.buttons=[wt.QuickInputButtons.Back],n.items=[{label:ye.bannerLabelYes},{label:ye.bannerLabelNo}],n.show(),e.push(n.onDidHide(()=>t.reject(Ne.cancel))),n.onDidTriggerButton(i=>{i===wt.QuickInputButtons.Back&&t.reject(Ne.back)},this,e),n.onDidAccept(()=>t.resolve(n.selectedItems.some(i=>i.label===ye.bannerLabelYes)),this,e)}finally{Q(e)}return t.promise}};rw=v([d(0,(0,Ur.inject)($e)),d(0,(0,Ur.named)(St))],rw);function xL(r,e){if(!r.startsWith(Ge.REMOTE_URI))try{let t=new URL(r);return{baseUrl:`${t.protocol}//${t.host}${t.pathname==="/lab"||t.pathname==="/tree"?"":t.pathname}`,token:t.searchParams.get("token")||"",displayName:e||t.hostname}}catch(t){x(`Failed to parse URI ${r}`,t);return}}function bQ(r){return r.map(e=>({handle:e.handle,uri:e.uri,displayName:e.serverInfo.displayName}))}function Kbe(r){let e=[];return r.forEach(t=>{let n=xL(t.uri,t.displayName);n&&e.push({handle:t.handle,uri:t.uri,serverInfo:n})}),e}var nw=class{constructor(e){this.encryptedStorage=e;this.updatePromise=Promise.resolve()}async getServers(e){if(this.servers&&!e)return this.servers;let t=await this.encryptedStorage.retrieve(Li.JupyterServerRemoteLaunchService,e1);if(!t||t==="[]")return[];try{return this.servers=Kbe(JSON.parse(t))}catch{return[]}}async add(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e.handle).concat(e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).concat(e);this.servers=t,await this.encryptedStorage.store(Li.JupyterServerRemoteLaunchService,e1,JSON.stringify(bQ(t)))}).catch(f))}async remove(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).filter(n=>n.handle!==e);return this.servers=t,this.encryptedStorage.store(Li.JupyterServerRemoteLaunchService,e1,JSON.stringify(bQ(t)))}).catch(f))}async clear(){this.servers=[],await(this.updatePromise=this.updatePromise.then(async()=>{this.servers=[],await this.encryptedStorage.store(Li.JupyterServerRemoteLaunchService,e1,void 0)}).catch(f))}};nw=v([d(0,(0,Ur.inject)(ax))],nw);var iw=_(O()),SI=require("vscode");var II=class extends Zt{constructor(t,n){super();this.uriProviderRegistration=t;this.serverUriStorage=n;this.handleMappings=new Map;this._onDidChangeHandles=this._register(new SI.EventEmitter);this.extensionId=It;this.id=Ew;this.displayName="Jupyter Server for Testing";this.onDidChangeServers=this._onDidChangeHandles.event}async provideJupyterServers(t){return Array.from(this.handleMappings.values()).map(n=>n.server)}async resolveJupyterServer(t,n){return t}activate(){this._register(this.uriProviderRegistration.createJupyterServerCollection(It,this.id,this.displayName,this)),this._register(SI.commands.registerCommand("jupyter.selectjupyteruri",this.selectJupyterUri,this))}async selectJupyterUri(t){z(`Setting Jupyter Server URI to remote: ${t}`);let n=t.toString(!0),i=new URL(n),o=SI.Uri.parse(`${i.protocol}//${i.host}${i.pathname==="/lab"?"":i.pathname}`),s=i.searchParams.get("token")??"",a=await la(t.toString(!0),"SHA-1"),c={label:this.displayName,id:a,connectionInformation:{baseUrl:o,token:s}};this.handleMappings.set(a,{uri:t,server:c}),await this.serverUriStorage.add({id:this.id,handle:a,extensionId:It}),this._onDidChangeHandles.fire()}};II=v([(0,iw.injectable)(),d(0,(0,iw.inject)(Qt)),d(1,(0,iw.inject)(er))],II);var t1=_(O());var ow=require("vscode");var xI=class{constructor(e){this.disposables=e}activate(){this.registerCommandsIfTrusted()}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){ow.workspace.isTrusted&&this.registerCommand($.ContinueEditSessionInCodespace,this.continueEditSessionInCodespace)}registerCommand(e,t){let n=ow.commands.registerCommand(e,t,this);this.disposables.push(n)}async continueEditSessionInCodespace(){await ow.commands.executeCommand("_workbench.editSessions.actions.continueEditSession.github.codespaces.continueEditSessionInCodespaceWithJupyterServer")}};xI=v([(0,t1.injectable)(),d(0,(0,t1.inject)(F))],xI);var SQ=_(O());var xQ=require("vscode");var CI=class{activate(){this.eagerlyActivateOtherExtensions().catch(f)}async eagerlyActivateOtherExtensions(){await Promise.all(xQ.extensions.all.filter(e=>e.packageJSON?.contributes?.pythonRemoteServerProvider).map(e=>e.isActive?Promise.resolve():e.activate().then(f,f)))}};CI=v([(0,SQ.injectable)()],CI);var r1=_(O()),CQ=require("vscode");var wI=class{constructor(e){this.uriStorage=e}activate(){CQ.commands.registerCommand("jupyter.getUsedAzMLServerHandles",()=>{let e=[];return this.uriStorage.all.forEach(n=>{n.provider.extensionId.toLowerCase()==="ms-toolsai.vscode-ai".toLowerCase()&&e.push(n.provider)}),e})}};wI=v([(0,r1.injectable)(),d(0,(0,r1.inject)(er))],wI);var Ru=require("vscode");var wQ=_(O());var EI=class{activate(){let e=Te.instance.get(F),t=new ma;e.push(t),e.push(Ru.commands.registerCommand("jupyter.manageAccessToKernels",()=>Fbe(t)))}};EI=v([(0,wQ.injectable)()],EI);async function Fbe(r){let e=await l9(),t=[];Array.from(e.entries()).forEach(([s])=>{let a=Ru.extensions.getExtension(s)?.packageJSON?.displayName;a&&t.push({label:a,description:s,extensionId:s})});let n=[];r.add({dispose:()=>{n=Q(n)}});let i=Ru.window.createQuickPick();i.title=Ru.l10n.t("Manage Access To Jupyter Kernels"),i.placeholder=Ru.l10n.t("Choose which extensions can access Jupyter Kernels"),i.items=t,i.selectedItems=t.filter(s=>e.get(s.extensionId)===!0),i.canSelectMany=!0,i.ignoreFocusOut=!1;let o=!1;n.push(i),i.show(),await Promise.race([PN(i.onDidAccept,void 0,n).then(()=>o=!0),PN(i.onDidHide,void 0,n)]),o&&(await u9(i.selectedItems.map(s=>s.extensionId)),n=Q(n))}function EQ(r,e,t){e.addSingleton(be,dI),e.addSingleton(be,Uf),e.addSingleton(be,lI),e.addSingleton(be,pI),e.addSingleton(eQ,Kf),e.addSingleton(be,Kf),e.addSingleton(be,CI),e.addSingleton(be,II),e.add(sg,oI),e.add(bP,aI),e.addSingleton(be,cI),e.addSingleton(be,xI),e.addSingleton(vL,vl),e.addBinding(vL,be),e.add(DP,fI),e.addSingleton(_P,mI),e.addSingleton(Tu,Tu),e.addSingleton(be,vI),gQ(e),aQ(r,t),e.addSingleton(be,bI),e.addSingleton(be,wI),e.addSingleton(be,EI)}var Il=_(O()),Ys=require("vscode");var n1=class{constructor(e,t,n){this.disposedCallback=n,this.callback=e,this.viewChanged=t}async dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged(e)}};var PQ=1e3,Lbe;(t=>(t.Fetching="fetching",t.Skipped="skipped"))(Lbe||={});var Qs;(p=>(p.Started="started",p.UpdateSettings="update_settings",p.InitializeData="init",p.GetAllRowsRequest="get_all_rows_request",p.GetAllRowsResponse="get_all_rows_response",p.GetRowsRequest="get_rows_request",p.GetRowsResponse="get_rows_response",p.CompletedData="complete",p.GetSliceRequest="get_slice_request",p.RefreshDataViewer="refresh_data_viewer",p.SliceEnablementStateChanged="slice_enablement_state_changed"))(Qs||={});var PI=Symbol("IDataViewerFactory"),i1=Symbol("IDataViewer"),o1=Symbol("IJupyterVariableDataProvider"),s1=Symbol("IJupyterVariableDataProviderFactory"),kI=Symbol("IDataViewerDependencyService");var wL;function EL(r,e){return wL&&wL.hasOwnProperty(r)?wL[r]:e}function PL(r,...e){return r.replace(/{(\d+)}/g,(t,n)=>e[n]===void 0?t:e[n])}var Ube=/^\s*((?<StartRange>-?\d+:)|(?<StopRange>-?:\d+)|(?:(?<Start>-?\d+)(?::(?<Stop>-?\d+))?(?::(?<Step>-?\d+))?))\s*$/;function kL(r){let e=r.length-2;return"["+r.map(()=>e>0?(e-=1,"0"):":").join(", ")+"]"}function jbe(r,e){if(r.startsWith("[")&&r.endsWith("]")){let t,n=r.substring(1,r.length-1).split(",").map((i,o)=>{let s=Ube.exec(i);if(s?.groups?.Start&&!s.groups.Stop){let a=parseInt(s.groups.Start),c=e[o];return(a>=0&&a>=c||a<0&&a<-c)&&(t={shapeIndex:o,value:a}),a}});if(t){let{shapeIndex:i,value:o}=t,s=EL("sliceIndexError","Index {0} out of range for axis {1} with {2} elements");return PL(s,o.toString(),i.toString(),e[i].toString())}else if(n&&n.length!==e.length){let i=EL("sliceMismatchedAxesError","Expected {0} axes, got {1} in slice expression");return PL(i,e.length.toString(),n.length.toString())}}return""}function kQ(r,e){return jbe(r,e)===""}var Nu=require("vscode");var Au=class{constructor(e,t,n){this.configService=e;this.rootPath=t;this.scripts=n;this.disposed=!1;this.themeIsDarkPromise=ue();this.webviewInit=ue();this._disposables=[];this.onMessageListeners=[];this._onDidDisposeWebviewPanel=new Nu.EventEmitter;this.onDataScienceSettingsChanged=async()=>{let e=JSON.stringify(await this.generateDataScienceExtraSettings());this.postMessageInternal("update_settings",e).catch(f)};this.onWebViewLoadFailed=async()=>{this.dispose()};this.onPossibleSettingsChange=async e=>{if(e.affectsConfiguration("workbench.colorTheme")||e.affectsConfiguration("editor.fontSize")||e.affectsConfiguration("editor.fontFamily")||e.affectsConfiguration("editor.cursorStyle")||e.affectsConfiguration("editor.cursorBlinking")||e.affectsConfiguration("editor.autoClosingBrackets")||e.affectsConfiguration("editor.autoClosingQuotes")||e.affectsConfiguration("editor.autoSurround")||e.affectsConfiguration("editor.autoIndent")||e.affectsConfiguration("editor.scrollBeyondLastLine")||e.affectsConfiguration("editor.fontLigatures")||e.affectsConfiguration("editor.scrollbar.verticalScrollbarSize")||e.affectsConfiguration("editor.scrollbar.horizontalScrollbarSize")||e.affectsConfiguration("files.autoSave")||e.affectsConfiguration("files.autoSaveDelay")||e.affectsConfiguration("jupyter.widgetScriptSources")){let t=await this.generateDataScienceExtraSettings();if(t){let n=JSON.stringify(t);this.postMessageInternal("update_settings",n).catch(f)}}};this._disposables.push(Nu.workspace.onDidChangeConfiguration(this.onPossibleSettingsChange,this)),this._disposables.push(this.configService.getSettings(void 0).onDidChange(this.onDataScienceSettingsChanged.bind(this)))}get onDidDispose(){return this._onDidDisposeWebviewPanel.event}dispose(){this.disposed||(this.disposed=!0,this._disposables.forEach(e=>e.dispose())),this.webviewInit=void 0,this._onDidDisposeWebviewPanel.fire()}getHTMLById(e){if(!this.activeHTMLRequest)this.activeHTMLRequest=ue(),this.postMessageInternal("get_html_by_id_request",e).catch(f);else throw new Error("getHTMLById request already in progress");return this.activeHTMLRequest.promise}addMessageListener(e){this.onMessageListeners.push(e)}removeMessageListener(e){let t=this.onMessageListeners.indexOf(e);t>=0&&this.onMessageListeners.splice(t,1)}asWebviewUri(e){if(!this.webview)throw new Error("asWebViewUri called too early");return this.webview?.asWebviewUri(e)}postMessage(e,t){return this.postMessageInternal(e.toString(),t)}onMessage(e,t){switch(e){case"started":this.webViewRendered();break;case"get_html_by_id_response":this.activeHTMLRequest&&(this.activeHTMLRequest.resolve(t),this.activeHTMLRequest=void 0);break;default:break}this.onMessageListeners.forEach(n=>{n(e,t)})}async loadWebview(e,t){if(this.disposed=!1,this.webviewInit=this.webviewInit||ue(),this.webview===void 0){let n=await this.generateDataScienceExtraSettings(),i=Nu.workspace.getWorkspaceFolder(e)?.uri;this.webview=await this.provideWebview(e,n,i,t),this._disposables.push(this.webview.loadFailed(this.onWebViewLoadFailed,this))}this.onDataScienceSettingsChanged().catch(f),this.sendLocStrings().catch(f)}async generateDataScienceExtraSettings(){let e=this.owningResource,t=Nu.workspace.getConfiguration("editor"),n=Nu.workspace.getConfiguration("workbench"),i=n?n.get("colorTheme",WR):WR,o=Nu.extensions.getExtension(ei);return{...JSON.parse(JSON.stringify(this.configService.getSettings(e))),extraSettings:{editor:{cursor:this.getValue(t,"cursorStyle","line"),cursorBlink:this.getValue(t,"cursorBlinking","blink"),autoClosingBrackets:this.getValue(t,"autoClosingBrackets","languageDefined"),autoClosingQuotes:this.getValue(t,"autoClosingQuotes","languageDefined"),autoSurround:this.getValue(t,"autoSurround","languageDefined"),autoIndent:this.getValue(t,"autoIndent",!1),fontLigatures:this.getValue(t,"fontLigatures",!1),scrollBeyondLastLine:this.getValue(t,"scrollBeyondLastLine",!0),verticalScrollbarSize:this.getValue(t,"scrollbar.verticalScrollbarSize",14),horizontalScrollbarSize:this.getValue(t,"scrollbar.horizontalScrollbarSize",10),fontSize:this.getValue(t,"fontSize",14),fontFamily:this.getValue(t,"fontFamily","Consolas, 'Courier New', monospace")},theme:i,hasPythonExtension:o!==void 0,isWeb:qr()==="Unknown"}}}async sendLocStrings(){let e={collapseSingle:Bt.collapseSingle,expandSingle:Bt.expandSingle,openExportFileYes:y.openExportFileYes,openExportFileNo:y.openExportFileNo,noRowsInDataViewer:Bt.noRowsInDataViewer,sliceIndexError:Bt.sliceIndexError,sliceMismatchedAxesError:Bt.sliceMismatchedAxesError,filterRowsTooltip:Bt.sliceMismatchedAxesError,fetchingDataViewer:Bt.fetchingDataViewer,dataViewerHideFilters:Bt.dataViewerHideFilters,dataViewerShowFilters:Bt.dataViewerShowFilters,refreshDataViewer:Bt.refreshDataViewer,clearFilters:Bt.refreshDataViewer,sliceSummaryTitle:Bt.sliceSummaryTitle,sliceData:Bt.sliceData,sliceSubmitButton:Bt.sliceSubmitButton,sliceDropdownAxisLabel:Bt.sliceDropdownAxisLabel,sliceDropdownIndexLabel:Bt.sliceDropdownIndexLabel,variableExplorerNameColumn:Bt.variableExplorerNameColumn,variableExplorerTypeColumn:Bt.variableExplorerTypeColumn,variableExplorerCountColumn:Bt.variableExplorerCountColumn,variableExplorerValueColumn:Bt.variableExplorerValueColumn,collapseVariableExplorerLabel:Bt.collapseVariableExplorerLabel,variableLoadingValue:Bt.variableLoadingValue,showDataExplorerTooltip:Bt.showDataExplorerTooltip,noRowsInVariableExplorer:Bt.noRowsInVariableExplorer,loadingRowsInVariableExplorer:Bt.loadingRowsInVariableExplorer,previousPlot:Bt.previousPlot,nextPlot:Bt.nextPlot,panPlot:Bt.panPlot,zoomInPlot:Bt.zoomInPlot,zoomOutPlot:Bt.zoomOutPlot,exportPlot:Bt.exportPlot,deletePlot:Bt.deletePlot,selectedImageListLabel:Bt.selectedImageListLabel,selectedImageLabel:Bt.selectedImageLabel};this.postMessageInternal("loc_init",JSON.stringify(e)).catch(f)}async postMessageInternal(e,t){this.webviewInit&&(await this.webviewInit.promise,this.webview?.postMessage({type:e.toString(),payload:t}))}webViewRendered(){this.webviewInit&&!this.webviewInit.resolved&&this.webviewInit.resolve(),this.sendLocStrings().catch(f),this.onDataScienceSettingsChanged().catch(f)}getValue(e,t,n){return e?e.get(t,n):n}};v([ph()],Au.prototype,"getHTMLById",1),v([ph()],Au.prototype,"addMessageListener",1),v([ph()],Au.prototype,"removeMessageListener",1);var _I=class extends Au{constructor(t,n,i,o,s,a,c){super(t,o,s);this.configService=t;this.provider=n;this._title=a;this.viewColumn=c;this.viewState={visible:!1,active:!1};this.webPanelViewStateChanged=t=>{let n=t.isVisible(),i=t.isActive(),o={visible:n,active:i},s={visible:this.viewState.visible,active:this.viewState.active};this.viewState.visible=n,this.viewState.active=i,this.onViewStateChanged({current:o,previous:s})};this.messageListener=i(this.onMessage.bind(this),this.webPanelViewStateChanged.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webPanel(){if(this.webview)return this.webview}async show(t){this.isDisposed||this.webPanel&&await this.webPanel.show(t)}dispose(){this.isDisposed||this.webPanel&&this.webPanel.close(),super.dispose()}get title(){return this._title}setTitle(t){this._title=t,!this.isDisposed&&this.webPanel&&this.webPanel.setTitle(t)}onViewStateChanged(t){}async provideWebview(t,n,i,o){return this.provider.create({viewColumn:this.viewColumn,listener:this.messageListener,title:this.title,rootPath:this.rootPath,scripts:this.scripts,settings:n,cwd:t,webviewHost:o,additionalPaths:i?[i]:[]})}};var _Q="JupyterDataViewerPreferredViewColumn",Vf=class extends _I{constructor(t,n,i,o,s){let a=sr(s.extensionUri,"dist","webviews","webview-side","viewers");super(n,t,(c,l,u)=>new n1(c,l,u),a,[sr(a,"dataExplorer.js")],y.dataExplorerTitle,i.get(_Q)??Ys.ViewColumn.One);this.globalMemento=i;this.errorHandler=o;this.context=s;this.pendingRowsCount=0;this.sentDataViewerSliceDimensionalityTelemetry=!1;this._onDidDisposeDataViewer=new Ys.EventEmitter;this._onDidChangeDataViewerViewState=new Ys.EventEmitter;this.onDidDispose(this.dataViewerDisposed,this)}get active(){return!!this.webPanel?.isActive()}get refreshPending(){return this.pendingRowsCount>0}get onDidDisposeDataViewer(){return this._onDidDisposeDataViewer.event}get onDidChangeDataViewerViewState(){return this._onDidChangeDataViewerViewState.event}async showData(t,n){if(!this.isDisposed){this.dataProvider=t,await super.loadWebview(Ys.Uri.file(process.cwd())).catch(x),super.setTitle(n),await super.show(!0);let i=await this.prepDataFrameInfo();if(i.shape&&i.shape.length>2){this.maybeSendSliceDataDimensionalityTelemetry(i.shape.length);let o=kL(i.shape);i=await this.getDataFrameInfo(o)}this.postMessage(Qs.InitializeData,i).catch(f)}}get kernel(){if(this.dataProvider&&"kernel"in this.dataProvider)return this.dataProvider.kernel}dataViewerDisposed(){this._onDidDisposeDataViewer.fire(this)}async refreshData(){let t=this.currentSliceExpression;this.dataFrameInfoPromise=void 0;let n=await this.getDataFrameInfo(void 0,!0);if(t!==void 0&&n.shape!==void 0)if(kQ(t,n.shape))n=await this.getDataFrameInfo(t);else{let i=kL(n.shape);n=await this.getDataFrameInfo(i)}z(`Refreshing data viewer for variable ${n.name}`),this.postMessage(Qs.InitializeData,n).catch(f)}dispose(){super.dispose(),this.dataProvider&&(this.dataProvider.dispose(),this.dataProvider=void 0)}async onViewStateChanged(t){t.current.active&&t.current.visible&&t.previous.active&&t.current.visible&&await this.globalMemento.update(_Q,this.webPanel?.viewColumn),this._onDidChangeDataViewerViewState.fire()}get owningResource(){}onMessage(t,n){switch(t){case Qs.GetAllRowsRequest:this.getAllRows(n).catch(f);break;case Qs.GetRowsRequest:this.getRowChunk(n).catch(f);break;case Qs.GetSliceRequest:this.getSlice(n).catch(f);break;case Qs.RefreshDataViewer:this.refreshData().catch(f),A("DATASCIENCE.REFRESH_DATA_VIEWER");break;case Qs.SliceEnablementStateChanged:A("DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",void 0,{newState:n.newState?"checked":"unchecked"});break;default:break}super.onMessage(t,n)}getDataFrameInfo(t,n){return(!this.dataFrameInfoPromise||t!==this.currentSliceExpression)&&(this.dataFrameInfoPromise=this.dataProvider?this.dataProvider.getDataFrameInfo(t,n):Promise.resolve({}),this.currentSliceExpression=t),this.dataFrameInfoPromise}async prepDataFrameInfo(){this.rowsTimer=new qe;let t=await this.getDataFrameInfo();try{A("DATASCIENCE.SHOW_DATA_EXPLORER",void 0,{rows:t.rowCount?t.rowCount:0,columns:t.columns?t.columns.length:0}),this.pendingRowsCount=t.rowCount?t.rowCount:0}catch{}return t}async getAllRows(t){return this.wrapRequest(async()=>{if(this.dataProvider){let n=await this.dataProvider.getAllRows(t);return this.pendingRowsCount=0,this.postMessage(Qs.GetAllRowsResponse,n)}})}getSlice(t){return this.wrapRequest(async()=>{if(this.dataProvider){let n=await this.getDataFrameInfo(t.slice);return n.shape?.length&&this.maybeSendSliceDataDimensionalityTelemetry(n.shape.length),A("DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",void 0,{source:t.source}),this.postMessage(Qs.InitializeData,n)}})}getRowChunk(t){return this.wrapRequest(async()=>{if(this.dataProvider){let n=await this.getDataFrameInfo(t.sliceExpression),i=await this.dataProvider.getRows(t.start,Math.min(t.end,n.rowCount?n.rowCount:0),t.sliceExpression);return this.pendingRowsCount=Math.max(0,this.pendingRowsCount-i.length),this.postMessage(Qs.GetRowsResponse,{rows:i,start:t.start,end:t.end})}})}async wrapRequest(t){try{return await t()}catch(n){if(n instanceof Wy){x(n.message);let i=y.pythonInteractiveHelpLink;Ys.window.showErrorMessage(y.jupyterDataRateExceeded,i).then(o=>{o===i&&Ys.env.openExternal(Ys.Uri.parse(gS.JupyterDataRateHelpLink))},f),this.dispose()}x(n),this.errorHandler.handleError(n).then(f,f)}finally{this.sendElapsedTimeTelemetry()}}sendElapsedTimeTelemetry(){this.rowsTimer&&this.pendingRowsCount===0&&A("DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",void 0,{rowsTimer:this.rowsTimer.elapsedTime})}maybeSendSliceDataDimensionalityTelemetry(t){this.sentDataViewerSliceDimensionalityTelemetry||(A("DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",{numberOfDimensions:t}),this.sentDataViewerSliceDimensionalityTelemetry=!0)}};v([dr("DATAVIEWER.WEBVIEW_LOADED")],Vf.prototype,"showData",1),Vf=v([(0,Il.injectable)(),d(0,(0,Il.inject)(bp)),d(1,(0,Il.inject)(le)),d(2,(0,Il.inject)($e)),d(2,(0,Il.named)(St)),d(3,(0,Il.inject)(Yr)),d(4,(0,Il.inject)(lt))],Vf);var Zr=_(O()),Xs=require("vscode");var c1=require("vscode");var a1=class{constructor(e){this.configuration=e}async isRequestedColumnSizeAllowed(e,t){if(e>PQ&&await this.shouldAskForLargeData(t)){let n=y.tooManyColumnsMessage,i=y.tooManyColumnsYes,o=y.tooManyColumnsNo,s=y.tooManyColumnsDontAskAgain,a=await c1.window.showWarningMessage(n,i,o,s);return a===s&&await this.disableAskForLargeData(),a===i}return!0}async shouldAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();return t&&t.askForLargeDataFrames===!0}async disableAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();t&&(t.askForLargeDataFrames=!1,this.configuration.updateSetting("askForLargeDataFrames",!1,void 0,c1.ConfigurationTarget.Global).catch(f))}};var DI=class{constructor(e,t,n,i,o,s,a,c,l,u,p,m){this.disposables=e;this.debugService=t;this.jupyterVariableDataProviderFactory=i;this.dataViewerFactory=o;this.variableProvider=s;this.errorHandler=a;this.dataViewerDependencyService=c;this.interpreterService=l;this.platformService=u;this.kernelProvider=p;this.interactiveWindowProvider=m;this.dataViewerChecker=new a1(n),Xs.workspace.isTrusted||Xs.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){Xs.workspace.isTrusted&&this.registerCommand($.ShowDataViewer,this.onVariablePanelShowDataViewerRequest)}registerCommand(e,t){let n=Xs.commands.registerCommand(e,t,this);this.disposables.push(n)}async onVariablePanelShowDataViewerRequest(e){let t="variable"in e?e.variable:e;if(A("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX"),this.debugService?.activeDebugSession&&this.variableProvider&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory)try{if(this.debugService.activeDebugSession.configuration&&this.dataViewerDependencyService&&this.interpreterService){let c=await this.getDebugAdapterPython(this.debugService.activeDebugSession.configuration);c&&await this.dataViewerDependencyService.checkAndInstallMissingDependencies(c)}let n=ZT(t),i=await this.variableProvider.getFullVariable(n),o=await this.jupyterVariableDataProviderFactory.create(i),a=(await o.getDataFrameInfo())?.columns?.length;if(a&&await this.dataViewerChecker.isRequestedColumnSizeAllowed(a)){let c=`${y.dataExplorerTitle} - ${i.name}`,l=await this.dataViewerFactory.create(o,c);return A("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX"),l}}catch(n){A("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",void 0,void 0,n),x(n),this.errorHandler.handleError(n).then(f,f)}else try{let n=this.getActiveKernel();if(n&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory){let i=await this.jupyterVariableDataProviderFactory.create(t,n),o=`${y.dataExplorerTitle} - ${t.name}`;return await this.dataViewerFactory.create(i,o)}}catch(n){x(n),A("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER"),Xs.window.showErrorMessage(y.showDataViewerFail).then(f,f)}}getActiveKernel(){let e=Xs.window.activeNotebookEditor?.notebook,t=e?.notebookType==bt?this.kernelProvider.get(e):void 0;if(t)return t;let n=this.getActiveInteractiveWindowDocument(),i=n?this.kernelProvider.get(n):void 0;if(i)return i;let o=this.dataViewerFactory?.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return Xs.workspace.notebookDocuments.find(t=>t===e?.notebookDocument)}async getDebugAdapterPython(e){if(!this.interpreterService){z("Interpreter Service missing when trying getDebugAdapterPython");return}let t="";if(e.debugAdapterPython!==void 0?(z("Found debugAdapterPython on Debug Configuration to use"),t=e.debugAdapterPython):e.pythonPath&&(z("Found pythonPath on Debug Configuration to use"),t=e.pythonPath),t){let n=t;return n.startsWith("~")&&this.platformService.homeDir&&(n=hh(n,this.platformService.homeDir.path)),this.interpreterService.getInterpreterDetails(Xs.Uri.file(n))}else return this.interpreterService.getActiveInterpreter()}};DI=v([(0,Zr.injectable)(),d(0,(0,Zr.inject)(F)),d(1,(0,Zr.inject)(Di)),d(1,(0,Zr.optional)()),d(2,(0,Zr.inject)(le)),d(3,(0,Zr.inject)(s1)),d(3,(0,Zr.optional)()),d(4,(0,Zr.inject)(PI)),d(4,(0,Zr.optional)()),d(5,(0,Zr.inject)(Rn)),d(5,(0,Zr.optional)()),d(5,(0,Zr.named)(Ge.DEBUGGER_VARIABLES)),d(6,(0,Zr.inject)(Yr)),d(7,(0,Zr.inject)(kI)),d(7,(0,Zr.optional)()),d(8,(0,Zr.inject)(tt)),d(8,(0,Zr.optional)()),d(9,(0,Zr.inject)(Er)),d(10,(0,Zr.inject)(Ke)),d(11,(0,Zr.inject)(Oi))],DI);var RI=_(O());var l1="0.20.0";var u1=require("vscode");var Bf=class{async getVersion(e,t){try{let n=await this._getVersion(e,t);return typeof n=="string"?tP(n):n}catch(n){j(y.failedToGetVersionOfPandas,n.message);return}}async promptInstall(e,t,n){let i=n?y.pandasTooOldForViewingFormat(n,l1):y.pandasRequiredForViewing(l1);if((zd()?ye.install:await u1.window.showErrorMessage(i,{modal:!0},ye.install))===ye.install)await this._doInstall(e,t);else throw A("DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS"),new Error(i)}async checkOrInstall(e){let t=new u1.CancellationTokenSource;try{let n=await this.getVersion(e,t.token);if(t.token.isCancellationRequested){A("DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED");return}if(n){if(n.compare(l1)>0){A("DS_INTERNAL.SHOW_DATA_PANDAS_OK");return}A("DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD");let i=`${n.major}.${n.minor}.${n.build}`;await this.promptInstall(e,t,i)}A("DS_INTERNAL.SHOW_DATA_NO_PANDAS"),await this.promptInstall(e,t)}finally{t.dispose()}}};v([dr("DS_INTERNAL.PYTHON_MODULE_INSTALL",{action:"displayed",moduleName:hr.get(23)})],Bf.prototype,"promptInstall",1);var _L="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",Wbe=`import pandas;print(pandas.__version__);print("${_L}")`,p1=class extends Bf{constructor(t,n,i){super();this.installer=t;this.pythonFactory=n;this.interpreterService=i}async _getVersion(t,n){let s=(await(await this.pythonFactory.createActivatedEnvironment({resource:void 0,interpreter:t})).exec(["-c",Wbe],{token:n})).stdout;if(!s?.includes(_L))return j(y.failedToGetVersionOfPandas,`Output is ${s}`),"";let a=Fe(s.trim()),c=a.indexOf(_L);return c>=0?a[c-1]:""}async _doInstall(t,n){let i=t||await this.interpreterService.getActiveInterpreter();if(n.token.isCancellationRequested)return;await fr(n.token,2,this.installer.install(23,i,n))===0&&A("DATASCIENCE.USER_INSTALLED_PANDAS")}async checkAndInstallMissingDependencies(t){A("DATAVIEWER.USING_INTERPRETER"),await this.checkOrInstall(t)}};var DL="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",Vbe=`import pandas as _VSCODE_pandas;print(_VSCODE_pandas.__version__);print("${DL}"); del _VSCODE_pandas`;function Bbe(r){return r.kernelConnectionMetadata.interpreter?.envType==="Conda"?"%conda":"%pip"}var d1=class extends Bf{async execute(e,t){if(!t.session?.kernel)throw new gn;let n=await vn(t.session.kernel,e),i=n.find(o=>o.output_type==="error");return i&&j(y.failedToGetVersionOfPandas,i.message),n.map(o=>o.text?.toString())}async _getVersion(e){let n=(await this.execute(Vbe,e)).map(s=>s?s.toString():void 0).find(s=>s);if(!n?.includes(DL))return j(y.failedToGetVersionOfPandas,`Output is ${n}`),"";let i=Fe(n.trim()),o=i.indexOf(DL);return o>=0?i[o-1]:""}async _doInstall(e){let t=`${Bbe(e)} install pandas`;try{await this.execute(t,e),A("DATASCIENCE.USER_INSTALLED_PANDAS")}catch(n){throw A("DATASCIENCE.USER_INSTALLED_PANDAS",void 0,void 0,n),new Error(y.failedToInstallPandas)}}async checkAndInstallMissingDependencies(e){if(A("DATAVIEWER.USING_KERNEL"),!e.session?.kernel)throw A("DATASCIENCE.NO_ACTIVE_KERNEL_SESSION"),new Error("No no active kernel session.");await this.checkOrInstall(e)}};var TI=class{constructor(e,t,n){this.withKernel=new d1,this.withInterpreter=new p1(e,t,n)}async checkAndInstallMissingDependencies(e){return"controller"in e?this.withKernel.checkAndInstallMissingDependencies(e):this.withInterpreter.checkAndInstallMissingDependencies(e)}};TI=v([(0,RI.injectable)(),d(0,(0,RI.inject)(Ni)),d(1,(0,RI.inject)(Kr)),d(2,(0,RI.inject)(tt))],TI);var AI=_(O());var DQ=require("vscode");var jd=class{constructor(e,t,n){this.serviceContainer=e;this.disposables=n;this.knownViewers=new Set;t.push(this),this.viewContext=new ir(Ir.IsDataViewerActive),this.disposables.push(DQ.commands.registerCommand($.RefreshDataViewer,this.refreshDataViewer,this))}async dispose(){for(let e of this.knownViewers)e.dispose()}async create(e,t){let n,i=this.serviceContainer.get(i1);try{this.knownViewers.add(i),i.onDidDisposeDataViewer(this.updateOpenDataViewers,this,this.disposables),i.onDidChangeDataViewerViewState(this.updateViewStateContext,this,this.disposables),await i.showData(e,t),n=i}finally{n||i.dispose()}return n}get activeViewer(){return[...this.knownViewers.values()].find(e=>e.active)}updateOpenDataViewers(e){this.knownViewers.delete(e)}async updateViewStateContext(){let e=!1;this.knownViewers.forEach(t=>{t.active&&(e=!0)}),await this.viewContext.set(e)}refreshDataViewer(){for(let e of this.knownViewers)e.active&&e.refreshData().then(f,f)}};v([dr("DATASCIENCE.START_SHOW_DATA_EXPLORER")],jd.prototype,"create",1),v([xv(1e3)],jd.prototype,"refreshDataViewer",1),jd=v([(0,AI.injectable)(),d(0,(0,AI.inject)(ut)),d(1,(0,AI.inject)(ni)),d(2,(0,AI.inject)(F))],jd);var Ou=_(O());var Mu=class{constructor(e,t){this.variableManager=e;this.dependencyService=t;this.initialized=!1}get kernel(){return this._kernel}static getNormalizedColumns(e){return e.map(t=>{let n;switch(t.type){case"bool":n="bool";break;case"integer":case"int32":case"int64":case"float":case"float32":case"float64":case"number":n="number";break;default:n="string"}return{key:t.key,type:n}})}static parseShape(e){try{if(e.startsWith("(")&&e.endsWith(")"))return e.substring(1,e.length-1).split(",").map(t=>parseInt(t))}catch{x(`Could not parse IJupyterVariable with malformed shape: ${e}`)}}dispose(){}setDependencies(e,t){this._kernel=t,this.variable=e}async getDataFrameInfo(e,t){let n={};await this.ensureInitialized();let i=this.variable;return i&&((e||t)&&(i=await this.variableManager.getDataFrameInfo(i,this._kernel,e,t)),n={columns:i.columns?Mu.getNormalizedColumns(i.columns):i.columns,indexColumn:i.indexColumn,rowCount:i.rowCount,dataDimensionality:i.dataDimensionality,shape:Mu.parseShape(i.shape),sliceExpression:e,type:i.type,maximumRowChunkSize:i.maximumRowChunkSize,name:i.name,fileName:Pe(i.fileName)}),t&&(this.variable=i),n}async getAllRows(e){let t=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(t=(await this.variableManager.getDataFrameRows(this.variable,0,this.variable.rowCount,this._kernel,e)).data),t}async getRows(e,t,n){let i=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(i=(await this.variableManager.getDataFrameRows(this.variable,e,t,this._kernel,n)).data),i}async ensureInitialized(){!this.initialized&&this.variable&&(this.initialized=!0,this._kernel?.kernelConnectionMetadata&&this.dependencyService&&await this.dependencyService.checkAndInstallMissingDependencies(Vu()?this._kernel:this._kernel?.kernelConnectionMetadata.interpreter||this._kernel),this.variable=await this.variableManager.getDataFrameInfo(this.variable,this._kernel))}};Mu=v([(0,Ou.injectable)(),d(0,(0,Ou.inject)(Rn)),d(0,(0,Ou.named)(Ge.ALL_VARIABLES)),d(1,(0,Ou.inject)(kI)),d(1,(0,Ou.optional)())],Mu);var m1=_(O());var NI=class{constructor(e){this.serviceContainer=e}async create(e,t){let n=this.serviceContainer.get(o1);return n.setDependencies(e,t),n}};NI=v([(0,m1.injectable)(),d(0,(0,m1.inject)(ut))],NI);var sw=_(O()),f1=require("vscode");var MI=class{constructor(e,t){this.kernelProvider=e;this.controllers=t;this.disposables=[];this.widgetOutputsPerNotebook=new WeakMap}dispose(){Q(this.disposables)}activate(){let e=f1.notebooks.createRendererMessaging("jupyter-ipywidget-renderer");e.onDidReceiveMessage(this.onDidReceiveMessage.bind(this,e),this,this.disposables),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables)}onDidStartKernel(e){this.hookupKernel(e),e.onStarted(()=>this.hookupKernel(e),this,this.disposables),e.onRestarted(()=>this.hookupKernel(e),this,this.disposables)}hookupKernel(e){this.widgetOutputsPerNotebook.delete(e.notebook);let t=e.session?.kernel,n=e.session?.kernel?.iopubMessage;if(!n)return;let i=require("@jupyterlab/services"),o=(s,a)=>{s===t&&(i.KernelMessage.isDisplayDataMsg(a)||i.KernelMessage.isUpdateDisplayDataMsg(a)||i.KernelMessage.isExecuteReplyMsg(a)||i.KernelMessage.isExecuteResultMsg(a))&&this.trackModelId(e.notebook,a)};n.connect(o),this.disposables.push(new f1.Disposable(()=>n.disconnect(o)))}trackModelId(e,t){let n=t.content;if(n.data&&typeof n.data=="object"&&Ui in n.data){let i=n.data[Ui];if(i&&"model_id"in i){let o=this.widgetOutputsPerNotebook.get(e)||new Set;o.add(i.model_id),this.widgetOutputsPerNotebook.set(e,o)}}}onDidReceiveMessage(e,{editor:t,message:n}){n&&typeof n=="object"&&n.command==="query-widget-state"&&this.queryWidgetState(e,t,n),n&&typeof n=="object"&&n.command==="ipywidget-renderer-loaded"&&this.sendWidgetVersionAndState(e,t)}queryWidgetState(e,t,n){let i=this.widgetOutputsPerNotebook.get(t.notebook),o=!!this.controllers.getSelected(t.notebook),s=!!i?.has(n.model_id);e.postMessage({command:"query-widget-state",model_id:n.model_id,hasWidgetState:s,kernelSelected:o},t).then(f,f)}sendWidgetVersionAndState(e,t){let n=this.kernelProvider.get(t.notebook),i=n?.ipywidgetsVersion;n?.ipywidgetsVersion&&E(`IPyWidget version in Kernel is ${n?.ipywidgetsVersion}.`);let o=!!this.controllers.getSelected(t.notebook);e.postMessage({command:"ipywidget-renderer-init",version:i,widgetState:void 0,kernelSelected:o},t).then(f,f)}};MI=v([(0,sw.injectable)(),d(0,(0,sw.inject)(Ke)),d(1,(0,sw.inject)(Ct))],MI);var Jf=_(O());var TL=require("vscode");var qf=_(O());var Sl=require("vscode");var h1=class{constructor(e,t,n){this.disposedCallback=n,this.callback=e,this.viewChanged=t}async dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged&&this.viewChanged(e)}};var Zs;(s=>(s.Started="started",s.UpdateSettings="update_settings",s.SendPlot="send_plot",s.CopyPlot="copy_plot",s.ExportPlot="export_plot",s.RemovePlot="remove_plot"))(Zs||={});var TQ=class{static{Zs.Started,Zs.UpdateSettings,Zs.SendPlot,Zs.CopyPlot,Zs.ExportPlot,Zs.RemovePlot}},g1=Symbol("IPlotViewerProvider"),v1=Symbol("IPlotViewer");var OI=class extends _I{constructor(t,n,i,o){let s=new qe,a=sr(o.extensionUri,"dist","webviews","webview-side","viewers");super(n,t,(c,l,u)=>new h1(c,l,u),a,[sr(a,"plotViewer.js")],y.plotViewerTitle,Sl.ViewColumn.One);this.fs=i;this.context=o;this.closedEvent=new Sl.EventEmitter;this.removedEvent=new Sl.EventEmitter;this.addPlot=async t=>{this.isDisposed||(await super.show(!1),this.postMessage(Zs.SendPlot,t).catch(f))};super.loadWebview(Sl.Uri.file(process.cwd())).catch(x).finally(()=>{A("PLOTVIEWER.WEBVIEW_LOADED",{duration:s.elapsedTime})})}get closed(){return this.closedEvent.event}get removed(){return this.removedEvent.event}async show(){if(!this.isDisposed)return super.show(!0)}dispose(){super.dispose(),this.removedEvent.dispose(),this.closedEvent&&this.closedEvent.fire(this)}get owningResource(){}onMessage(t,n){switch(t){case Zs.CopyPlot:this.copyPlot(n.toString()).catch(f);break;case Zs.ExportPlot:this.exportPlot(n).catch(f);break;case Zs.RemovePlot:this.removePlot(n);break;default:break}super.onMessage(t,n)}removePlot(t){this.removedEvent.fire(t)}copyPlot(t){return Promise.resolve()}async exportPlot(t){z("exporting plot...");let n={};n[y.pngFilter]=["png"],n[y.svgFilter]=["svg"];let i=await Sl.window.showSaveDialog({saveLabel:y.exportPlotTitle,filters:n});try{if(i)switch(Wi(i.path).toLowerCase()){case".png":let s=Xh(t.png.replace("data:image/png;base64",""));await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){x(o),Sl.window.showErrorMessage(y.exportImageFailed(o.toString())).then(f,f)}}};OI=v([(0,qf.injectable)(),d(0,(0,qf.inject)(bp)),d(1,(0,qf.inject)(le)),d(2,(0,qf.inject)(st)),d(3,(0,qf.inject)(lt))],OI);var KI=class extends OI{constructor(t,n,i,o){super(t,n,i,o);this.fsNode=i}async exportPlot(t){z("exporting plot...");let n={};n[y.pdfFilter]=["pdf"],n[y.pngFilter]=["png"],n[y.svgFilter]=["svg"];let i=await TL.window.showSaveDialog({saveLabel:y.exportPlotTitle,filters:n});try{if(i)switch(Wi(i.fsPath).toLowerCase()){case".pdf":await RL(t.svg,this.fsNode,i);break;case".png":let s=Xh(t.png.replace("data:image/png;base64",""));await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){x(o),TL.window.showErrorMessage(y.exportImageFailed(o)).then(f,f)}}};KI=v([(0,Jf.injectable)(),d(0,(0,Jf.inject)(bp)),d(1,(0,Jf.inject)(le)),d(2,(0,Jf.inject)(gr)),d(3,(0,Jf.inject)(lt))],KI);async function RL(r,e,t){z("Attempting pdf write...");let n=(await import("svg-to-pdfkit")).default,i=ue(),o=require("pdfkit/js/pdfkit.standalone"),s=new o,a=e.createLocalWriteStream(t.fsPath);z(`Writing pdf to ${t.fsPath}`),a.on("finish",()=>i.resolve),n(s,r,0,0,{preserveAspectRatio:"xMinYMin meet"}),s.pipe(a),s.end(),z(`Finishing pdf to ${t.fsPath}`),await i.promise,z(`Completed pdf to ${t.fsPath}`)}var aw=_(O());var FI=class{constructor(e,t){this.serviceContainer=e;this.imageList=[];this.closedViewer=()=>{this.currentViewer&&(this.currentViewer=void 0),this.currentViewerClosed&&(this.currentViewerClosed.dispose(),this.currentViewerClosed=void 0)};this.removedPlot=e=>{this.imageList.splice(e,1)};t.push(this)}async dispose(){this.currentViewer&&this.currentViewer.dispose()}async showPlot(e){this.imageList.push(e);let t=this.currentViewer?[e]:this.imageList,n=await this.getOrCreate();await Promise.all(t.map(n.addPlot))}async getOrCreate(){return this.currentViewer||(this.currentViewer=this.serviceContainer.get(v1),this.currentViewerClosed=this.currentViewer.closed(this.closedViewer),this.currentViewer.removed(this.removedPlot),A("DATASCIENCE.OPEN_PLOT_VIEWER"),await this.currentViewer.show()),this.currentViewer}};FI=v([(0,aw.injectable)(),d(0,(0,aw.inject)(ut)),d(1,(0,aw.inject)(ni))],FI);var S1=_(O());var b1=_(O()),Wd=require("vscode");var I1="image/svg+xml",y1={"image/png":"png","image/jpeg":"jpeg","image/gif":"gif",[I1]:"svg"},LI=class{constructor(e){this.fs=e}async savePlot(e,t,n){if(e.isClosed)return;let i=qbe(e,t,n);if(!i)return x(`No plot to save ${W(e.uri)}, id: ${t} for ${n}`);if(!(n.toLowerCase()in y1))return x(`Unsupported MimeType ${W(e.uri)}, id: ${t} for ${n}`);let o=await this.getSaveTarget(i,n);o&&(o.path.toLowerCase().endsWith("pdf")?await this.saveAsPdf(i,o):await this.saveAsImage(i,o))}getSaveTarget(e,t){let n=y1[t.toLowerCase()],i={};e.items.find(c=>c.mime.toLowerCase()===I1)&&(i[y.pdfFilter]=["pdf"],i[y.svgFilter]=["svg"]),n==="png"&&(i[y.pngFilter]=["png"]),Object.keys(i).length===0&&(i.Images=[n]);let o=(Wd.workspace.workspaceFolders?.length||0)>0?Wd.workspace.workspaceFolders[0].uri:void 0,s="output",a=o?Wd.Uri.joinPath(o,s):Wd.Uri.file(s);return Wd.window.showSaveDialog({defaultUri:a,saveLabel:y.exportPlotTitle,filters:i})}async saveAsImage(e,t){let n=Wi(t.path).substring(1),i=Object.keys(y1).find(s=>y1[s]===n),o=e.items.find(s=>s.mime===i);if(!o)throw new Error(`Unsupported MimeType ${t.toString()}, available mime Types: ${e.items.map(s=>s.mime).join(", ")}`);await this.fs.writeFile(t,o.data)}async saveAsPdf(e,t){return x("Save as PDF is not yet supported on the web.")}};LI=v([(0,b1.injectable)(),d(0,(0,b1.inject)(st))],LI);function qbe(r,e,t){for(let n of r.getCells())for(let i of n.outputs)if(i.id===e&&i.items.find(o=>o.mime===t))return i}var UI=class extends LI{constructor(t){super(t);this.fsNode=t}async saveAsPdf(t,n){let i=Buffer.from(t.items.find(o=>o.mime===I1).data).toString();await RL(i,this.fsNode,n)}};UI=v([(0,S1.injectable)(),d(0,(0,S1.inject)(gr))],UI);var x1=_(O());var Jbe="image/svg+xml",$be="image/png",Ku=class{constructor(e){this.plotViewProvider=e}async openPlot(e,t){if(e.isClosed)return;let n=RQ(e,t,Jbe),i;if(n)i=new TextDecoder().decode(n.data);else{let o=RQ(e,t,$be);if(!o)return x(`No SVG or PNG Plot to open ${W(e.uri)}, id: ${t}`);i=Hbe(o)}i&&await this.plotViewProvider.showPlot(i)}};Ku=v([(0,x1.injectable)(),d(0,(0,x1.inject)(g1))],Ku);function RQ(r,e,t){for(let n of r.getCells())for(let i of n.outputs)if(i.id===e)return i.items.find(o=>o.mime===t)}function Hbe(r){let e=r.data,t=rP(e),n=Gbe(e);return`<?xml version="1.0" encoding="utf-8" standalone="no"?>
<svg height="${n.height}" width="${n.width}" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g>
        <image xmlns="http://www.w3.org/2000/svg" x="0" y="0" height="100%" width="100%" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="data:image/png;base64,${t}"/>
    </g>
</svg>`}function Gbe(r){if(!zbe(r))throw new Error("The buffer is not a valid png");let e=new DataView(new Uint8Array(r).buffer);return{width:e.getUint32(16,!1),height:e.getUint32(20,!1)}}function zbe(r){return r[0]===137&&r[1]===80&&r[2]===78&&r[3]===71&&r[4]===13&&r[5]===10&&r[6]===26&&r[7]===10&&r.length>8+21}var cw=_(O()),w1=require("vscode");var C1=Symbol("IPlotSaveHandler");var jI=class{constructor(e,t){this.plotSaveHandler=e;this.plotViewHandler=t;this.disposables=[]}dispose(){Q(this.disposables)}activate(){this.activateImpl().catch(f)}async activateImpl(){let e=w1.extensions.getExtension(lh);if(!e)return;e.isActive||await e.activate(),e.exports.onDidReceiveMessage(({editor:n,message:i})=>{let o=n.notebook||w1.window.activeNotebookEditor?.notebook;o&&(i.type==="saveImageAs"?this.plotSaveHandler.savePlot(o,i.outputId,i.mimeType).catch(f):i.type==="openImageInPlotViewer"&&this.plotViewHandler.openPlot(o,i.outputId).catch(f))},this,this.disposables)}};jI=v([(0,cw.injectable)(),d(0,(0,cw.inject)(C1)),d(1,(0,cw.inject)(Ku))],jI);var $f=_(O()),Ro=require("vscode");var WI=class{constructor(e,t,n,i){this.interactiveWindowProvider=e;this.kernelProvider=t;this.dataViewerFactory=n;this.disposables=i;this._onDidFinisheExecutingActiveNotebook=new Ro.EventEmitter;this._onDidChangeActiveNotebook=new Ro.EventEmitter;this._onDidRestartActiveNotebook=new Ro.EventEmitter;this._executionCountTracker=new WeakMap;Ro.window.onDidChangeActiveNotebookEditor(this.activeEditorChanged,this,this.disposables),Ro.workspace.onDidCloseNotebookDocument(this.notebookEditorClosed,this,this.disposables),this.kernelProvider.onDidRestartKernel(o=>{this.handleRestart({state:1,notebook:o.notebook})},this,this.disposables),Ro.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}get onDidChangeActiveNotebook(){return this._onDidChangeActiveNotebook.event}get onDidFinishExecutingActiveNotebook(){return this._onDidFinisheExecutingActiveNotebook.event}get onDidRestartActiveNotebook(){return this._onDidRestartActiveNotebook.event}get activeKernel(){let e=Ro.window.activeNotebookEditor?.notebook,t=e?.notebookType==bt?this.kernelProvider.get(e):void 0;if(t)return t;let n=this.getActiveInteractiveWindowDocument(),i=n?this.kernelProvider.get(n):void 0;if(i)return i;let o=this.dataViewerFactory.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}get activeNotebookExecutionCount(){let e=this.activeKernel?.notebook;return e?this._executionCountTracker.get(e):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return Ro.workspace.notebookDocuments.find(t=>t===e?.notebookDocument)}onDidChangeNotebookCellExecutionState(e){Tt(e.cell.notebook)&&e.state===Ro.NotebookCellExecutionState.Idle&&this.handleExecute({notebook:e.cell.notebook,state:0,cell:e.cell})}handleExecute(e){this.isNonSilentExecution(e)&&(e.cell?.executionSummary?.executionOrder!==void 0&&this._executionCountTracker.set(e.notebook,e.cell.executionSummary?.executionOrder),this.isActiveNotebookEvent(e)&&e.cell?.executionSummary?.executionOrder!==void 0&&this.activeKernel&&this.kernelProvider.getKernelExecution(this.activeKernel).pendingCells.length===0&&this._onDidFinisheExecutingActiveNotebook.fire({executionCount:e.cell.executionSummary?.executionOrder}))}handleRestart(e){this._executionCountTracker.delete(e.notebook),this.isActiveNotebookEvent(e)&&this._onDidRestartActiveNotebook.fire()}notebookEditorClosed(e){this._executionCountTracker.delete(e)}activeEditorChanged(e){let t={};if(e&&Tt(e.notebook)){let n=this._executionCountTracker.get(e.notebook);n&&(t.executionCount=n)}this._onDidChangeActiveNotebook.fire(t)}isNonSilentExecution(e){return!!(e.state===0&&e.cell&&e.cell.executionSummary?.executionOrder)}isActiveNotebookEvent(e){return this.activeKernel?.notebook===e.notebook}};WI=v([(0,$f.injectable)(),d(0,(0,$f.inject)(Oi)),d(1,(0,$f.inject)(Ke)),d(2,(0,$f.inject)(PI)),d(3,(0,$f.inject)(F))],WI);var AQ=class{static{"force_variable_refresh","settings_updated","activate","show_data_explorer","get_variables_request","get_variables_response","variable_explorer_toggle","set_variable_explorer_height","variable_explorer_height_response","open_link","variables_complete","update_settings","loc_init","finish_cell","update_variable_view_execution_count","get_html_by_id_request","get_html_by_id_response","restart_kernel"}},E1=Symbol("INotebookWatcher"),P1=Symbol("IVariableViewProvider");var lw=_(O()),NQ=require("vscode");var VI=class{constructor(e,t){this.extensionContext=e;this.variableViewProvider=t}activate(){this.extensionContext.subscriptions.push(NQ.window.registerWebviewViewProvider(this.variableViewProvider.viewType,this.variableViewProvider,{webviewOptions:{retainContextWhenHidden:!1}}))}};VI=v([(0,lw.injectable)(),d(0,(0,lw.inject)(lt)),d(1,(0,lw.inject)(P1))],VI);var ta=_(O());var ea=require("vscode");var k1=class{constructor(e,t){this.disposedCallback=t,this.callback=e}async dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}};var _1=class extends Au{constructor(t,n,i,o,s){super(t,o,s);this.configService=t;this.provider=i;this.messageListener=n(this.onMessage.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webviewView(){return this.webview&&this.webview}async provideWebview(t,n,i,o){if(!o)throw new Error("WebviewViews must be passed an initial VS Code Webview");return this.provider.create({additionalPaths:i?[i]:[],rootPath:this.rootPath,cwd:t,listener:this.messageListener,scripts:this.scripts,settings:n,webviewHost:o})}};var MQ=require("vscode");var Hf=class extends _1{constructor(t,n,i,o,s,a,c){let l=sr(i.extensionUri,"dist","webviews","webview-side","viewers");super(t,(u,p)=>new k1(u,p),n,l,[sr(l,"variableView.js")]);this.variables=o;this.disposables=s;this.notebookWatcher=a;this.experiments=c;this.notebookWatcher.onDidFinishExecutingActiveNotebook(this.activeNotebookExecuted,this,this.disposables),this.notebookWatcher.onDidChangeActiveNotebook(this.activeNotebookChanged,this,this.disposables),this.notebookWatcher.onDidRestartActiveNotebook(this.activeNotebookRestarted,this,this.disposables),this.variables.refreshRequired(this.sendRefreshMessage,this,this.disposables),ea.window.onDidChangeActiveTextEditor(this.activeTextEditorChanged,this,this.disposables)}get owningResource(){}async load(t){await super.loadWebview(ea.Uri.file(process.cwd()),t).catch(x),this.webviewView&&this.disposables.push(this.webviewView.onDidChangeVisibility(()=>{this.handleVisibilityChanged()})),this.handleVisibilityChanged()}get title(){return"variableView"}onMessage(t,n){switch(t){case"get_variables_request":this.handleMessage(t,n,this.requestVariables);break;case"show_data_explorer":this.handleMessage(t,n,this.showDataViewer);break;default:break}super.onMessage(t,n)}handleMessage(t,n,i){let o=n;i.bind(this)(o)}handleVisibilityChanged(){let t=new ir("jupyter.variableViewVisible"),n=!1;this.webviewView&&(n=this.webviewView.visible),t.set(n).catch(f),n&&(A("DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE"),this.notebookWatcher.activeNotebookExecutionCount!==void 0?this.postMessage("update_variable_view_execution_count",{executionCount:this.notebookWatcher.activeNotebookExecutionCount}).catch(f):this.postMessage("force_variable_refresh").catch(f))}async showDataViewer(t){try{if(this.experiments.inExperiment("DataViewerContribution")&&!t.variable.fileName?.path.endsWith(".interactive")){let n=this.getMatchingVariableViewers(t.variable);if(n.length===0){await ea.commands.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers");return}else if(n.length===1){let i=n[0].jupyterVariableViewers.command;return ea.commands.executeCommand(i,t.variable)}else{let i=n.filter(s=>s.extension.id!==It);if(i.length===1){let s=i[0].jupyterVariableViewers.command;return ea.commands.executeCommand(s,t.variable)}let o=ea.window.createQuickPick();o.title="Select DataFrame Viewer",o.items=n.map(s=>({label:s.jupyterVariableViewers.title,detail:s.extension.packageJSON?.displayName??s.extension.id,command:s.jupyterVariableViewers.command})),o.onDidAccept(()=>{let s=o.selectedItems[0];s&&(o.hide(),ea.commands.executeCommand(s.command,t.variable).then(f,f))}),o.show()}}else return ea.commands.executeCommand($.ShowDataViewer,t.variable)}catch(n){x(n),A("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER"),ea.window.showErrorMessage(y.showDataViewerFail).then(f,f)}}getMatchingVariableViewers(t){return this.getVariableViewers().filter(i=>i.jupyterVariableViewers.dataTypes.includes(t.type))}getVariableViewers(){return MQ.extensions.all.filter(n=>n.packageJSON?.contributes?.jupyterVariableViewers&&n.packageJSON?.contributes?.jupyterVariableViewers.length).map(n=>{let i=n.packageJSON?.contributes;return i?.jupyterVariableViewers?i.jupyterVariableViewers.map(o=>({extension:n,jupyterVariableViewers:o})):[]}).flat()}postProcessSupportsDataExplorer(t){let n=this.getVariableViewers();return t.pageResponse.forEach(i=>{this.experiments.inExperiment("DataViewerContribution")&&(i.supportsDataExplorer=n.some(o=>o.jupyterVariableViewers.dataTypes.includes(i.type)))}),t}async requestVariables(t){let n=this.notebookWatcher.activeKernel;if(n){let i=await this.variables.getVariables(t,n);this.postMessage("get_variables_response",this.postProcessSupportsDataExplorer(i)).catch(f),A("DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",{variableCount:i.totalCount})}else{let i={executionCount:t.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};this.postMessage("get_variables_response",i).catch(f)}}async activeNotebookExecuted(t){this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(f)}async activeNotebookChanged(t){t.executionCount?this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(f):this.postMessage("update_variable_view_execution_count",{executionCount:0}).catch(f),this.postMessage("force_variable_refresh").catch(f)}activeTextEditorChanged(){this.postMessage("force_variable_refresh").catch(f)}async activeNotebookRestarted(){this.postMessage("restart_kernel").catch(f)}async sendRefreshMessage(){this.postMessage("force_variable_refresh").catch(f)}};v([dr("DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED")],Hf.prototype,"load",1),v([Mr()],Hf.prototype,"showDataViewer",1),v([Mr()],Hf.prototype,"requestVariables",1);var BI=class{constructor(e,t,n,i,o,s,a){this.configuration=e;this.webviewViewProvider=t;this.context=n;this.variables=i;this.disposables=o;this.notebookWatcher=s;this.experiments=a;this.viewType="jupyterViewVariables"}get activeVariableView(){if(!Tr())throw new Error("activeVariableView only for test code");return this.variableView?Promise.resolve(this.variableView):(this.activeVariableViewPromise=ue(),this.activeVariableViewPromise.promise)}async resolveWebviewView(e,t,n){e.webview.options={enableScripts:!0},this.variableView=new Hf(this.configuration,this.webviewViewProvider,this.context,this.variables,this.disposables,this.notebookWatcher,this.experiments),this.activeVariableViewPromise&&this.activeVariableViewPromise.resolve(this.variableView),await this.variableView.load(e)}};BI=v([(0,ta.injectable)(),d(0,(0,ta.inject)(le)),d(1,(0,ta.inject)(KP)),d(2,(0,ta.inject)(lt)),d(3,(0,ta.inject)(Rn)),d(3,(0,ta.named)(Ge.ALL_VARIABLES)),d(4,(0,ta.inject)(F)),d(5,(0,ta.inject)(E1)),d(6,(0,ta.inject)(za))],BI);function OQ(r){r.addSingleton(be,jI),r.add(i1,Vf),r.addSingleton(PI,jd),r.addSingleton(kI,TI),r.addSingleton(be,DI),r.add(v1,KI),r.addSingleton(g1,FI),r.addSingleton(C1,UI),r.addSingleton(Ku,Ku),r.addSingleton(E1,WI),r.addSingleton(be,VI),r.addSingleton(be,MI),r.addSingleton(P1,BI),r.add(o1,Mu),r.addSingleton(s1,NI)}var FQ=require("vscode");function LQ(r){let e=FQ.window.createOutputChannel(y.jupyterServerConsoleOutputChannel,"log");r.push(e);let t={get(n,i){let o=n[i];if(typeof o=="function"){if(i==="append")return(...s)=>{e.append(...s),KQ(...s)};if(i==="appendLine")return(...s)=>{e.appendLine(...s),KQ(...s)}}return o}};return new Proxy(e,t)}function KQ(...r){r.length===1?E(Fe(r[0]).map((e,t)=>t===0?e:`    ${e}`).join(`
`)):E(...r)}var HQ=_(AA());var UQ=_(O());var Gf=class{constructor(e){this.container=e}getContainer(){return this.container}add(e,t,n,i){n?this.container.bind(e).to(t).whenTargetNamed(n):this.container.bind(e).to(t),i&&i.forEach(o=>{this.addBinding(e,o)})}addFactory(e,t){this.container.bind(e).toFactory(t)}addBinding(e,t){this.container.bind(t).toService(e)}addSingleton(e,t,n,i){n?this.container.bind(e).to(t).inSingletonScope().whenTargetNamed(n):this.container.bind(e).to(t).inSingletonScope(),i&&i.forEach(o=>{this.addBinding(e,o)})}addSingletonInstance(e,t,n){n?this.container.bind(e).toConstantValue(t).whenTargetNamed(n):this.container.bind(e).toConstantValue(t)}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}rebind(e,t,n){n?this.container.rebind(e).to(t).whenTargetNamed(n):this.container.rebind(e).to(t)}rebindSingleton(e,t,n){n?this.container.rebind(e).to(t).inSingletonScope().whenTargetNamed(n):this.container.rebind(e).to(t).inSingletonScope()}rebindInstance(e,t,n){n?this.container.rebind(e).toConstantValue(t).whenTargetNamed(n):this.container.rebind(e).toConstantValue(t)}dispose(){this.container.unbindAll(),this.container.unload()}};v([ph()],Gf.prototype,"getContainer",1),Gf=v([(0,UQ.injectable)()],Gf);var WQ=AL(),D1=class{constructor(e,t,n){this.channel=e;this.homeReplaceRegEx=t,this.userNameReplaceRegEx=n}format(e,t,...n){let i=e?`${Rw()} [${e}] ${WQ(t,...n)}`:WQ(t,...n);return this.homeReplaceRegEx&&(i=i.replace(this.homeReplaceRegEx,"~")),this.userNameReplaceRegEx&&(i=i.replace(this.userNameReplaceRegEx,"<username>")),i}traceLog(e,...t){this.channel.appendLine(this.format("",e,...t))}traceError(e,...t){this.channel.appendLine(this.format("error",e,...t))}traceWarn(e,...t){this.channel.appendLine(this.format("warn",e,...t))}traceInfo(e,...t){this.channel.appendLine(this.format("info",e,...t))}traceVerbose(e,...t){this.channel.appendLine(this.format("debug",e,...t))}};var NL=AL();function T1(r,e,...t){let i=[...t].length===0?NL(e):NL(e,...t);return r?`${r} ${Rw()}: ${i}`:i}var R1=class{constructor(e){this.prefix=e}traceLog(e,...t){console.log(NL(`${this.prefix||""} ${e}`,...t))}traceError(e,...t){console.error(T1("error",`${this.prefix||""} ${e}`,...t))}traceWarn(e,...t){console.warn(T1("warn",`${this.prefix||""} ${e}`,...t))}traceInfo(e,...t){console.info(T1("info",`${this.prefix||""} ${e}`,...t))}traceVerbose(e,...t){console.log(T1("verbose",`${this.prefix||""} ${e}`,...t))}};var Vd=require("os");var xl=_(require("vscode"));var BQ=_(require("vscode"));var zf=_(require("vscode"));function qI(r){r.sort((t,n)=>t-n);let e=r.shift();return e===void 0?[]:r.reduce(function(t,n){return n<=t[0][1]?t[0][1]=n+1:t.unshift([n,n+1]),t},[[e,e+1]]).reverse().map(t=>new zf.NotebookRange(t[0],t[1]))}function Qbe(r){return zf.workspace.notebookDocuments.find(e=>e.uri.authority===r.uri.authority&&e.uri.path===r.uri.path)}function uw(r){let e=zf.workspace.textDocuments.find(o=>o.uri.toString()===r?.document.uri.toString())??zf.window.activeTextEditor?.document;if(!e)return;let t=Qbe(e);if(!t)return;let i=t.getCells().find(o=>o.document.uri.toString()===e.uri.toString());if(i)return{notebook:t,cell:i}}function ML(r,e){return r.start.line===e.start.line&&r.start.character===e.start.character&&r.end.line===e.end.line&&r.end.character===e.end.character}function gi(){}var VQ="ms-python.vscode-pylance";async function Ybe(r){return await r.activate()}var OL;async function qQ(){let r=BQ.extensions.getExtension(VQ);if(r)return OL||new Promise((e,t)=>{Ybe(r).then(async n=>{if(!n){console.error("Could not start Pylance"),t();return}n.client&&await n.client.start(),OL=n.notebook,e(n.notebook)}).then(gi,gi)})}var _r=_(require("vscode"));var Xbe=_r.window.createTextEditorDecorationType({after:{contentText:"write",margin:"0 0 0 1em",backgroundColor:"red"}}),Zbe=_r.window.createTextEditorDecorationType({after:{contentText:"read",margin:"0 0 0 1em",backgroundColor:"green"}}),JI=class{constructor(e,t,n){this._notebookDocument=e;this._cellExecution=t;this._cellRefs=n}_getVirtualCellList(e){return this._cellExecution.findIndex(n=>n.cell.document.uri.toString()===e.document.uri.toString())===-1?this._notebookDocument.getCells():this._cellExecution.map(n=>n.cell)}getPredecessorCells(e,t=!1){let n=t?this._notebookDocument.getCells():this._getVirtualCellList(e);var i;for(i=n.length-1;i>=0&&n[i].document.uri.toString()!==e.document.uri.toString();i--);if(i===-1)return[];let o=i,s=n.slice(0,o+1),a=new Array(s.length).fill(!1);a[o]=!0;let c=new Map;for(let[p,m]of this._cellRefs.entries()){let h=m.filter(g=>g.kind==="write").map(g=>g.uri.fragment);m.forEach(g=>{let b=g.uri.fragment;c.has(b)?c.get(b)?.push(p):c.set(b,[p])}),m.forEach(g=>{let b=g.uri.fragment;c.has(b)?c.get(b)?.push(...h):c.set(b,h)})}let l=e.document.uri.fragment;this._resolveDependencies(c,a,l,s);let u=[];for(let p=0;p<a.length;p++)a[p]&&u.push(s[p]);return u}getSuccessorCells(e){let t=this._getVirtualCellList(e),n=t.findIndex(a=>a.document.uri.fragment===e.document.uri.fragment);if(n===-1)return[];let i=new Array(t.length).fill(!1);i[n]=!0;let o=new Map;this._cellRefs.forEach(a=>{a.forEach(c=>{if(c.kind==="write"){let l=c.uri.fragment,u=o.get(l)??[];u.push(...a.filter(p=>p!==c)),o.set(l,u)}})});for(let a=n;a<t.length;a++)if(i[a]){let c=this._cellRefs.get(t[a].document.uri.fragment)||[],l=o.get(t[a].document.uri.fragment)||[];[...c,...l].forEach(p=>{let m=t.findIndex(h=>h.document.uri.fragment===p.uri.fragment);m!==-1&&m>=a&&(i[m]=!0)})}let s=[];for(let a=0;a<i.length;a++)i[a]&&s.push(t[a]);return s}_resolveDependencies(e,t,n,i){if(e.has(n))for(let o of e.get(n)){let s=i.findIndex(a=>a.document.uri.fragment===o);if(s===-1)throw new Error(`Dependency ${o} is not in the execution list.`);t[s]||(t[s]=!0,this._resolveDependencies(e,t,o,i))}}};var A1=class{constructor(e,t){this._notebookEditor=e;this._client=t;this._pendingRequests=new Map;this._cellRefs=new Map;this._staleCellRefs=new Map;this._cellExecution=[];this._disposables=[];this._notebookEditor.notebook.getCells().forEach(n=>{this._requestCellSymbols(n,!1).then(gi,gi)}),this._disposables.push(_r.workspace.onDidChangeNotebookDocument(n=>{n.notebook===this._notebookEditor.notebook&&(n.contentChanges.forEach(i=>{i.removedCells.forEach(o=>{this._pendingRequests.delete(o.document.uri.fragment),this._cellRefs.delete(o.document.uri.fragment)}),i.addedCells.forEach(o=>{this._requestCellSymbols(o,!1).then(gi,gi)})}),n.cellChanges.forEach(i=>{this._requestCellSymbols(i.cell,!1).then(gi,gi),this._updateCellStatus(i.cell,0)}))})),this._disposables.push(_r.notebooks.onDidChangeNotebookCellExecutionState(n=>{n.state===_r.NotebookCellExecutionState.Executing&&n.cell.document.languageId==="python"&&this._updateCellStatus(n.cell,1),n.state===_r.NotebookCellExecutionState.Idle&&n.cell.document.languageId==="python"&&(this._cellExecution.push({cell:n.cell,executionCount:n.cell.executionSummary?.executionOrder??0}),this._updateCellStatus(n.cell,2))}))}_updateCellStatus(e,t){this._staleCellRefs.set(e.document.uri.fragment,t)}async requestCellSymbolsSync(){let e=[...this._pendingRequests.keys()];this._pendingRequests.forEach(t=>t.cancel()),this._pendingRequests.clear();for(let t of e){let n=this._notebookEditor.notebook.getCells().find(i=>i.document.uri.fragment===t);n&&await this._requestCellSymbols(n,!0)}}async selectPrecedentCells(e){await this.requestCellSymbolsSync();let t=new JI(this._notebookEditor.notebook,this._cellExecution,this._cellRefs);try{let n=t.getPredecessorCells(e);this._notebookEditor.selections=qI(n.map(i=>i.index));return}catch{}try{let n=t.getPredecessorCells(e,!0);this._notebookEditor.selections=qI(n.map(i=>i.index));return}catch{}}async selectSuccessorCells(e){await this.requestCellSymbolsSync();let n=new JI(this._notebookEditor.notebook,this._cellExecution,this._cellRefs).getSuccessorCells(e),i=qI(n.map(o=>o.index));this._notebookEditor.selections=i}async runPrecedentCells(e){await this.requestCellSymbolsSync();let t=new JI(this._notebookEditor.notebook,this._cellExecution,this._cellRefs),n=[];try{n=t.getPredecessorCells(e)}catch{try{n=t.getPredecessorCells(e,!0)}catch{throw new Error("No precedent cells found")}}let i=n.findIndex(s=>(this._staleCellRefs.get(s.document.uri.fragment)??0)===0),o=qI((i===-1?n:n.slice(i)).map(s=>s.index));await _r.commands.executeCommand("notebook.cell.execute",{ranges:o.map(s=>({start:s.start,end:s.end})),document:this._notebookEditor.notebook.uri}).then(gi,gi)}async runSuccessorCells(e){await this.requestCellSymbolsSync();let n=new JI(this._notebookEditor.notebook,this._cellExecution,this._cellRefs).getSuccessorCells(e),i=qI(n.map(o=>o.index));await _r.commands.executeCommand("notebook.cell.execute",{ranges:i.map(o=>({start:o.start,end:o.end})),document:this._notebookEditor.notebook.uri}).then(gi,gi)}async debugSymbols(){let e=[];await this.requestCellSymbolsSync(),console.log(JSON.stringify(Array.from(this._cellRefs.entries())));for(let n of _r.window.visibleTextEditors){let i=n.document;if(i.uri.scheme==="vscode-notebook-cell"&&i.uri.path===this._notebookEditor.notebook.uri.path){let o=this._cellRefs.get(i.uri.fragment);o&&e.push(...o)}}let t=new Map;e.forEach(n=>{let i=n.uri.fragment;t.has(i)||t.set(i,[]),t.get(i)?.push(n)}),t.forEach((n,i)=>{let o=_r.window.visibleTextEditors.find(s=>s.document.uri.path===this._notebookEditor.notebook.uri.path&&s.document.uri.fragment===i);if(o){let s=[],a=[];n.reduce((l,u)=>l.find(m=>ML(m.range,u.range))?l:l.concat([u]),[]).forEach(l=>{let u=new _r.Position(l.range.end.line,l.range.end.character),p=new _r.Range(u,u);l.kind==="write"?s.push(p):l.kind==="read"&&a.push(p)}),o.setDecorations(Xbe,s),o.setDecorations(Zbe,a)}})}async _requestCellSymbols(e,t){let n=this._pendingRequests.get(e.document.uri.fragment);if(n&&n.cancel(),t){let o=new _r.CancellationTokenSource;await this._doRequestCellSymbols(e,o.token),o.dispose();return}let i=new _r.CancellationTokenSource;this._pendingRequests.set(e.document.uri.fragment,i),setTimeout(()=>{this._pendingRequests.get(e.document.uri.fragment)===i&&(this._pendingRequests.delete(e.document.uri.fragment),!i.token.isCancellationRequested&&this._doRequestCellSymbols(e,i.token).then(gi,gi))},500)}async _getDocumentSymbols(e){return _r.commands.executeCommand("vscode.executeDocumentSymbolProvider",e.document.uri)}async _doRequestCellSymbols(e,t){let n=await this._getDocumentSymbols(e);if(!n)return;let i=[];for(let o of n){let s=await this._client.getReferences(e.document,o.selectionRange.start,{includeDeclaration:!0},t);s&&i.push(...s.map(a=>({...a,associatedSymbol:o})))}i.length&&this._cellRefs.set(e.document.uri.fragment,i.map(o=>({range:o.range,uri:_r.Uri.parse(o.uri),kind:ML(o.range,o.associatedSymbol.selectionRange)?"write":o.kind,associatedSymbol:o.associatedSymbol})))}dispose(){this._pendingRequests.forEach(e=>e.cancel()),this._pendingRequests.clear(),this._disposables.forEach(e=>e.dispose()),this._disposables=[]}},N1=class{constructor(e){this._client=e;this._disposables=[];this._notebookDocumentSymbolTrackers=new Map;_r.window.visibleNotebookEditors.forEach(t=>{this._notebookDocumentSymbolTrackers.set(t.notebook.uri.toString(),new A1(t,this._client))}),this._disposables.push(_r.window.onDidChangeVisibleNotebookEditors(t=>{t.forEach(n=>{this._notebookDocumentSymbolTrackers.has(n.notebook.uri.toString())||this._notebookDocumentSymbolTrackers.set(n.notebook.uri.toString(),new A1(n,this._client))}),this._notebookDocumentSymbolTrackers.forEach((n,i)=>{_r.window.visibleNotebookEditors.find(o=>o.notebook.uri.toString()===i)||(n.dispose(),this._notebookDocumentSymbolTrackers.delete(i))})}))}async debugSymbols(e){let t=this._notebookDocumentSymbolTrackers.get(e.uri.toString());t&&await t.debugSymbols()}async runSuccessorCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.runSuccessorCells(t)}async runPrecedentCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.runPrecedentCells(t)}async selectSuccessorCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.selectSuccessorCells(t)}async selectPrecedentCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.selectPrecedentCells(t)}dispose(){this._disposables.forEach(e=>e.dispose()),this._disposables=[]}};async function JQ(r){if(!xl.workspace.getConfiguration("jupyter").get("executionAnalysis.enabled"))return;let t=await qQ();if(!t)return;let n=new N1(t);r.subscriptions.push(n),r.subscriptions.push(xl.commands.registerCommand("jupyter.selectDependentCells",async i=>{let o=uw(i);if(!o)return;let{notebook:s,cell:a}=o;await n.selectSuccessorCells(s,a)})),r.subscriptions.push(xl.commands.registerCommand("jupyter.runPrecedentCells",async i=>{let o=uw(i);if(!o)return;let{notebook:s,cell:a}=o;await n.runPrecedentCells(s,a)})),r.subscriptions.push(xl.commands.registerCommand("jupyter.runDependentCells",async i=>{let o=uw(i);if(!o)return;let{notebook:s,cell:a}=o;await n.runSuccessorCells(s,a)})),r.subscriptions.push(xl.commands.registerCommand("jupyter.selectPrecedentCells",async i=>{let o=uw(i);if(!o)return;let{notebook:s,cell:a}=o;await n.selectPrecedentCells(s,a)})),r.subscriptions.push(xl.commands.registerCommand("jupyter.debugCellSymbols",async()=>{let i=xl.window.activeNotebookEditor;i&&await n.debugSymbols(i.notebook)}))}function $Q(){}var M1={totalActivateTime:0,codeLoadingTime:0,startActivateTime:0,endActivateTime:0,workspaceFolderCount:0},KL=new qe;M1.codeLoadingTime=KL.elapsedTime;var FL;async function eIe(r){r9(r.subscriptions),yj(lr.env.uiKind==lr.UIKind.Web),Ij(!1),r.subscriptions.push({dispose:()=>fS.isExiting=!0});try{let e,t;return[e,t]=await rIe(r,KL,M1),D9(t,M1,KL).catch(f),await t,e}catch(e){return await iIe(e,M1),x("Failed to active the Jupyter Extension",e),{ready:Promise.resolve(),registerPythonApi:f,registerRemoteServerProvider:()=>({dispose:f}),getKernelService:()=>Promise.resolve(void 0),addRemoteJupyterServer:()=>Promise.resolve(void 0),openNotebook:()=>Promise.reject(),createJupyterServerCollection:()=>{throw new Error("Not Implemented")},kernels:{getKernel:()=>Promise.resolve(void 0)}}}}function tIe(){if(fS.isExiting=!0,FL){let r=FL.get(ni);if(r)return r.dispose()}return $Q(),Promise.resolve()}async function rIe(r,e,t){let n=ue();try{nIe(n.promise),t.startActivateTime=e.elapsedTime;let[i,o]=dIe(r);FL=o,t$(c=>o.get(Lp).getPackageVersions(c));let s=sIe(r,i,o);return t.endActivateTime=e.elapsedTime,n.resolve(),JQ(r).then(f,f),[P9(s,i,o,r),s,o]}finally{n.completed||n.reject()}}function nIe(r){let e={location:lr.ProgressLocation.Window,title:ye.loadingExtension};lr.window.withProgress(e,()=>r).then(f,f)}async function iIe(r,e){oIe(ye.handleExtensionActivationError),console.error("extension activation failed",r),x("extension activation failed",r),await T9(r,e)}function oIe(r){try{lr.window.showErrorMessage(r).then(f,f)}catch(e){x("failed to notify user",e)}}async function sIe(r,e,t){return pIe(r,e,t)}function aIe(){if(process.env.VSC_JUPYTER_FORCE_LOGGING){let r;Zn||(r="Jupyter Extension:"),iA(new R1(r))}}function GQ(r){return r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function cIe(){try{let r=GQ((0,Vd.userInfo)().username);return new RegExp(r,"ig")}catch(r){console.info(`jupyter extension failed to get username info with ${r}
 username will not be obfuscated in local logs`)}}function lIe(){try{let r=GQ(Bg().fsPath);return new RegExp(r,"ig")}catch(r){console.info(`jupyter extension failed to get home directory path with ${r}
 home Path will not be obfuscated in local logs`)}}function uIe(r,e){let t=lr.window.createOutputChannel(jA.jupyter,"log");iA(new D1(t,lIe(),cIe())),e.addSingletonInstance(No,t,Uu),e.addSingletonInstance(No,LQ(r.subscriptions),ch),t.appendLine(`${lr.env.appName} (${lr.version}, ${lr.env.remoteName}, ${lr.env.appHost})`),t.appendLine(`Jupyter Extension Version: ${r.extension.packageJSON.version}.`);let n=lr.extensions.getExtension(ei);n?t.appendLine(`Python Extension Version: ${n.packageJSON.version}.`):t.appendLine("Python Extension not installed.");let i=lr.extensions.getExtension(Qd);i?t.appendLine(`Pylance Extension Version: ${i.packageJSON.version}.`):t.appendLine("Pylance Extension not installed."),t.appendLine(`Platform: ${(0,Vd.platform)()} (${(0,Vd.arch)()}).`),!lr.workspace.workspaceFolders||lr.workspace.workspaceFolders.length===0?t.appendLine("No workspace folder opened."):lr.workspace.workspaceFolders.length===1?t.appendLine(`Workspace folder ${W(lr.workspace.workspaceFolders[0].uri)}, Home = ${Ak.fsPath}`):t.appendLine(`Multiple Workspace folders opened ${lr.workspace.workspaceFolders.map(o=>W(o.uri)).join(", ")}`)}async function pIe(r,e,t){let n=!Tr()&&(r.extensionMode===lr.ExtensionMode.Development||lr.workspace.getConfiguration("jupyter").get("development",!1));e.addSingletonInstance(n2,n),n&&lr.commands.executeCommand("setContext","jupyter.development",!0).then(f,f),lr.commands.executeCommand("setContext","jupyter.webExtension",!1).then(f,f),e2((0,Vd.homedir)()),aIe(),uIe(r,e),J7(e),W4(e,n),GG(e,n),Yz(e),EQ(r,e,n),OQ(e);let i=t.get(za),o=new qe;await i.activate();let s=o.elapsedTime;A("DS_INTERNAL.EXPERIMENT_LOAD",{duration:s});let c=e.get(le).getSettings();oA(c.logging.level),c.onDidChange(()=>{oA(c.logging.level)}),lr.commands.executeCommand("setContext","jupyter.vscode.channel",fo()).then(f,f),t.get(DP).activate();let l=t.get(Jw);l.initialize(),r.subscriptions.push(l)}function dIe(r){let e=new HQ.Container({skipBaseClassChecks:!0}),t=new Gf(e),n=new Te(e);return t.addSingletonInstance(ut,n),t.addSingletonInstance(k9,t),t.addSingletonInstance(F,r.subscriptions),t.addSingletonInstance($e,r.globalState,St),t.addSingletonInstance($e,r.workspaceState,ri),t.addSingletonInstance(lt,r),[t,n]}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

mime-db/index.js:
  (*!
   * mime-db
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015-2022 Douglas Christopher Wilson
   * MIT Licensed
   *)

mime-types/index.js:
  (*!
   * mime-types
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

tmp/lib/tmp.js:
  (*!
   * Tmp
   *
   * Copyright (c) 2011-2015 KARASZI Istvan <github@spam.raszi.hu>
   *
   * MIT Licensed
   *)

strip-comments/index.js:
  (*!
   * strip-comments <https://github.com/jonschlinkert/strip-comments>
   * Copyright (c) 2014-present, Jon Schlinkert.
   * Released under the MIT License.
   *)
*/
